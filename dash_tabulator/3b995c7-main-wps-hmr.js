webpackHotUpdatedash_tabulator("main",{

/***/ "./node_modules/css-loader/dist/cjs.js!./node_modules/tabulator-tables/dist/css/tabulator.min.css":
/*!********************************************************************************************************!*\
  !*** ./node_modules/css-loader/dist/cjs.js!./node_modules/tabulator-tables/dist/css/tabulator.min.css ***!
  \********************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// Imports
var ___CSS_LOADER_API_IMPORT___ = __webpack_require__(/*! ../../../css-loader/dist/runtime/api.js */ "./node_modules/css-loader/dist/runtime/api.js");
exports = ___CSS_LOADER_API_IMPORT___(false);
// Module
exports.push([module.i, "/* Tabulator v4.7.0 (c) Oliver Folkerd */\n.tabulator{position:relative;border:1px solid #999;background-color:#888;font-size:14px;text-align:left;overflow:hidden;transform:translatez(0)}.tabulator[tabulator-layout=fitDataFill] .tabulator-tableHolder .tabulator-table{min-width:100%}.tabulator[tabulator-layout=fitDataTable]{display:inline-block}.tabulator.tabulator-block-select{-webkit-user-select:none;-ms-user-select:none;user-select:none}.tabulator .tabulator-header{position:relative;box-sizing:border-box;width:100%;border-bottom:1px solid #999;background-color:#e6e6e6;color:#555;font-weight:700;white-space:nowrap;overflow:hidden;-moz-user-select:none;-khtml-user-select:none;-webkit-user-select:none;-o-user-select:none}.tabulator .tabulator-header.tabulator-header-hidden{display:none}.tabulator .tabulator-header .tabulator-col{display:inline-block;position:relative;box-sizing:border-box;border-right:1px solid #aaa;background:#e6e6e6;text-align:left;vertical-align:bottom;overflow:hidden}.tabulator .tabulator-header .tabulator-col.tabulator-moving{position:absolute;border:1px solid #999;background:#cdcdcd;pointer-events:none}.tabulator .tabulator-header .tabulator-col .tabulator-col-content{box-sizing:border-box;position:relative;padding:4px}.tabulator .tabulator-header .tabulator-col .tabulator-col-content .tabulator-header-menu-button{padding:0 8px}.tabulator .tabulator-header .tabulator-col .tabulator-col-content .tabulator-header-menu-button:hover{cursor:pointer;opacity:.6}.tabulator .tabulator-header .tabulator-col .tabulator-col-content .tabulator-col-title{box-sizing:border-box;width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;vertical-align:bottom}.tabulator .tabulator-header .tabulator-col .tabulator-col-content .tabulator-col-title .tabulator-title-editor{box-sizing:border-box;width:100%;border:1px solid #999;padding:1px;background:#fff}.tabulator .tabulator-header .tabulator-col .tabulator-col-content .tabulator-arrow{display:inline-block;position:absolute;top:9px;right:8px;width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-bottom:6px solid #bbb}.tabulator .tabulator-header .tabulator-col.tabulator-col-group .tabulator-col-group-cols{position:relative;display:-ms-flexbox;display:flex;border-top:1px solid #aaa;overflow:hidden;margin-right:-1px}.tabulator .tabulator-header .tabulator-col:first-child .tabulator-col-resize-handle.prev{display:none}.tabulator .tabulator-header .tabulator-col .tabulator-header-filter{position:relative;box-sizing:border-box;margin-top:2px;width:100%;text-align:center}.tabulator .tabulator-header .tabulator-col .tabulator-header-filter textarea{height:auto!important}.tabulator .tabulator-header .tabulator-col .tabulator-header-filter svg{margin-top:3px}.tabulator .tabulator-header .tabulator-col .tabulator-header-filter input::-ms-clear{width:0;height:0}.tabulator .tabulator-header .tabulator-col.tabulator-sortable .tabulator-col-title{padding-right:25px}.tabulator .tabulator-header .tabulator-col.tabulator-sortable:hover{cursor:pointer;background-color:#cdcdcd}.tabulator .tabulator-header .tabulator-col.tabulator-sortable[aria-sort=none] .tabulator-col-content .tabulator-arrow{border-top:none;border-bottom:6px solid #bbb}.tabulator .tabulator-header .tabulator-col.tabulator-sortable[aria-sort=asc] .tabulator-col-content .tabulator-arrow{border-top:none;border-bottom:6px solid #666}.tabulator .tabulator-header .tabulator-col.tabulator-sortable[aria-sort=desc] .tabulator-col-content .tabulator-arrow{border-top:6px solid #666;border-bottom:none}.tabulator .tabulator-header .tabulator-col.tabulator-col-vertical .tabulator-col-content .tabulator-col-title{-ms-writing-mode:tb-rl;writing-mode:vertical-rl;text-orientation:mixed;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center}.tabulator .tabulator-header .tabulator-col.tabulator-col-vertical.tabulator-col-vertical-flip .tabulator-col-title{transform:rotate(180deg)}.tabulator .tabulator-header .tabulator-col.tabulator-col-vertical.tabulator-sortable .tabulator-col-title{padding-right:0;padding-top:20px}.tabulator .tabulator-header .tabulator-col.tabulator-col-vertical.tabulator-sortable.tabulator-col-vertical-flip .tabulator-col-title{padding-right:0;padding-bottom:20px}.tabulator .tabulator-header .tabulator-col.tabulator-col-vertical.tabulator-sortable .tabulator-arrow{right:calc(50% - 6px)}.tabulator .tabulator-header .tabulator-frozen{display:inline-block;position:absolute;z-index:10}.tabulator .tabulator-header .tabulator-frozen.tabulator-frozen-left{border-right:2px solid #aaa}.tabulator .tabulator-header .tabulator-frozen.tabulator-frozen-right{border-left:2px solid #aaa}.tabulator .tabulator-header .tabulator-calcs-holder{box-sizing:border-box;min-width:600%;background:#f3f3f3!important;border-top:1px solid #aaa;border-bottom:1px solid #aaa;overflow:hidden}.tabulator .tabulator-header .tabulator-calcs-holder .tabulator-row{background:#f3f3f3!important}.tabulator .tabulator-header .tabulator-calcs-holder .tabulator-row .tabulator-col-resize-handle{display:none}.tabulator .tabulator-header .tabulator-frozen-rows-holder{min-width:600%}.tabulator .tabulator-header .tabulator-frozen-rows-holder:empty{display:none}.tabulator .tabulator-tableHolder{position:relative;width:100%;white-space:nowrap;overflow:auto;-webkit-overflow-scrolling:touch}.tabulator .tabulator-tableHolder:focus{outline:none}.tabulator .tabulator-tableHolder .tabulator-placeholder{box-sizing:border-box;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;width:100%}.tabulator .tabulator-tableHolder .tabulator-placeholder[tabulator-render-mode=virtual]{min-height:100%;min-width:100%}.tabulator .tabulator-tableHolder .tabulator-placeholder span{display:inline-block;margin:0 auto;padding:10px;color:#ccc;font-weight:700;font-size:20px}.tabulator .tabulator-tableHolder .tabulator-table{position:relative;display:inline-block;background-color:#fff;white-space:nowrap;overflow:visible;color:#333}.tabulator .tabulator-tableHolder .tabulator-table .tabulator-row.tabulator-calcs{font-weight:700;background:#e2e2e2!important}.tabulator .tabulator-tableHolder .tabulator-table .tabulator-row.tabulator-calcs.tabulator-calcs-top{border-bottom:2px solid #aaa}.tabulator .tabulator-tableHolder .tabulator-table .tabulator-row.tabulator-calcs.tabulator-calcs-bottom{border-top:2px solid #aaa}.tabulator .tabulator-footer{padding:5px 10px;border-top:1px solid #999;background-color:#e6e6e6;text-align:right;color:#555;font-weight:700;white-space:nowrap;-ms-user-select:none;user-select:none;-moz-user-select:none;-khtml-user-select:none;-webkit-user-select:none;-o-user-select:none}.tabulator .tabulator-footer .tabulator-calcs-holder{box-sizing:border-box;width:calc(100% + 20px);margin:-5px -10px 5px;text-align:left;background:#f3f3f3!important;border-bottom:1px solid #aaa;border-top:1px solid #aaa;overflow:hidden}.tabulator .tabulator-footer .tabulator-calcs-holder .tabulator-row{background:#f3f3f3!important}.tabulator .tabulator-footer .tabulator-calcs-holder .tabulator-row .tabulator-col-resize-handle{display:none}.tabulator .tabulator-footer .tabulator-calcs-holder:only-child{margin-bottom:-5px;border-bottom:none}.tabulator .tabulator-footer .tabulator-paginator{color:#555;font-family:inherit;font-weight:inherit;font-size:inherit}.tabulator .tabulator-footer .tabulator-page-size{display:inline-block;margin:0 5px;padding:2px 5px;border:1px solid #aaa;border-radius:3px}.tabulator .tabulator-footer .tabulator-pages{margin:0 7px}.tabulator .tabulator-footer .tabulator-page{display:inline-block;margin:0 2px;padding:2px 5px;border:1px solid #aaa;border-radius:3px;background:hsla(0,0%,100%,.2)}.tabulator .tabulator-footer .tabulator-page.active{color:#d00}.tabulator .tabulator-footer .tabulator-page:disabled{opacity:.5}.tabulator .tabulator-footer .tabulator-page:not(.disabled):hover{cursor:pointer;background:rgba(0,0,0,.2);color:#fff}.tabulator .tabulator-col-resize-handle{position:absolute;right:0;top:0;bottom:0;width:5px}.tabulator .tabulator-col-resize-handle.prev{left:0;right:auto}.tabulator .tabulator-col-resize-handle:hover{cursor:ew-resize}.tabulator .tabulator-loader{position:absolute;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;top:0;left:0;z-index:100;height:100%;width:100%;background:rgba(0,0,0,.4);text-align:center}.tabulator .tabulator-loader .tabulator-loader-msg{display:inline-block;margin:0 auto;padding:10px 20px;border-radius:10px;background:#fff;font-weight:700;font-size:16px}.tabulator .tabulator-loader .tabulator-loader-msg.tabulator-loading{border:4px solid #333;color:#000}.tabulator .tabulator-loader .tabulator-loader-msg.tabulator-error{border:4px solid #d00;color:#590000}.tabulator-row{position:relative;box-sizing:border-box;min-height:22px;background-color:#fff}.tabulator-row.tabulator-row-even{background-color:#efefef}.tabulator-row.tabulator-selectable:hover{background-color:#bbb;cursor:pointer}.tabulator-row.tabulator-selected{background-color:#9abcea}.tabulator-row.tabulator-selected:hover{background-color:#769bcc;cursor:pointer}.tabulator-row.tabulator-row-moving{border:1px solid #000;background:#fff}.tabulator-row.tabulator-moving{position:absolute;border-top:1px solid #aaa;border-bottom:1px solid #aaa;pointer-events:none;z-index:15}.tabulator-row .tabulator-row-resize-handle{position:absolute;right:0;bottom:0;left:0;height:5px}.tabulator-row .tabulator-row-resize-handle.prev{top:0;bottom:auto}.tabulator-row .tabulator-row-resize-handle:hover{cursor:ns-resize}.tabulator-row .tabulator-frozen{display:inline-block;position:absolute;background-color:inherit;z-index:10}.tabulator-row .tabulator-frozen.tabulator-frozen-left{border-right:2px solid #aaa}.tabulator-row .tabulator-frozen.tabulator-frozen-right{border-left:2px solid #aaa}.tabulator-row .tabulator-responsive-collapse{box-sizing:border-box;padding:5px;border-top:1px solid #aaa;border-bottom:1px solid #aaa}.tabulator-row .tabulator-responsive-collapse:empty{display:none}.tabulator-row .tabulator-responsive-collapse table{font-size:14px}.tabulator-row .tabulator-responsive-collapse table tr td{position:relative}.tabulator-row .tabulator-responsive-collapse table tr td:first-of-type{padding-right:10px}.tabulator-row .tabulator-cell{display:inline-block;position:relative;box-sizing:border-box;padding:4px;border-right:1px solid #aaa;vertical-align:middle;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.tabulator-row .tabulator-cell.tabulator-editing{border:1px solid #1d68cd;padding:0}.tabulator-row .tabulator-cell.tabulator-editing input,.tabulator-row .tabulator-cell.tabulator-editing select{border:1px;background:transparent}.tabulator-row .tabulator-cell.tabulator-validation-fail{border:1px solid #d00}.tabulator-row .tabulator-cell.tabulator-validation-fail input,.tabulator-row .tabulator-cell.tabulator-validation-fail select{border:1px;background:transparent;color:#d00}.tabulator-row .tabulator-cell:first-child .tabulator-col-resize-handle.prev{display:none}.tabulator-row .tabulator-cell.tabulator-row-handle{display:-ms-inline-flexbox;display:inline-flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;-moz-user-select:none;-khtml-user-select:none;-webkit-user-select:none;-o-user-select:none}.tabulator-row .tabulator-cell.tabulator-row-handle .tabulator-row-handle-box{width:80%}.tabulator-row .tabulator-cell.tabulator-row-handle .tabulator-row-handle-box .tabulator-row-handle-bar{width:100%;height:3px;margin-top:2px;background:#666}.tabulator-row .tabulator-cell .tabulator-data-tree-branch{display:inline-block;vertical-align:middle;height:9px;width:7px;margin-top:-9px;margin-right:5px;border-bottom-left-radius:1px;border-left:2px solid #aaa;border-bottom:2px solid #aaa}.tabulator-row .tabulator-cell .tabulator-data-tree-control{display:-ms-inline-flexbox;display:inline-flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;vertical-align:middle;height:11px;width:11px;margin-right:5px;border:1px solid #333;border-radius:2px;background:rgba(0,0,0,.1);overflow:hidden}.tabulator-row .tabulator-cell .tabulator-data-tree-control:hover{cursor:pointer;background:rgba(0,0,0,.2)}.tabulator-row .tabulator-cell .tabulator-data-tree-control .tabulator-data-tree-control-collapse{display:inline-block;position:relative;height:7px;width:1px;background:transparent}.tabulator-row .tabulator-cell .tabulator-data-tree-control .tabulator-data-tree-control-collapse:after{position:absolute;content:\"\";left:-3px;top:3px;height:1px;width:7px;background:#333}.tabulator-row .tabulator-cell .tabulator-data-tree-control .tabulator-data-tree-control-expand{display:inline-block;position:relative;height:7px;width:1px;background:#333}.tabulator-row .tabulator-cell .tabulator-data-tree-control .tabulator-data-tree-control-expand:after{position:absolute;content:\"\";left:-3px;top:3px;height:1px;width:7px;background:#333}.tabulator-row .tabulator-cell .tabulator-responsive-collapse-toggle{display:-ms-inline-flexbox;display:inline-flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;-moz-user-select:none;-khtml-user-select:none;-webkit-user-select:none;-o-user-select:none;height:15px;width:15px;border-radius:20px;background:#666;color:#fff;font-weight:700;font-size:1.1em}.tabulator-row .tabulator-cell .tabulator-responsive-collapse-toggle:hover{opacity:.7}.tabulator-row .tabulator-cell .tabulator-responsive-collapse-toggle.open .tabulator-responsive-collapse-toggle-close{display:initial}.tabulator-row .tabulator-cell .tabulator-responsive-collapse-toggle.open .tabulator-responsive-collapse-toggle-open,.tabulator-row .tabulator-cell .tabulator-responsive-collapse-toggle .tabulator-responsive-collapse-toggle-close{display:none}.tabulator-row .tabulator-cell .tabulator-traffic-light{display:inline-block;height:14px;width:14px;border-radius:14px}.tabulator-row.tabulator-group{box-sizing:border-box;border-bottom:1px solid #999;border-right:1px solid #aaa;border-top:1px solid #999;padding:5px;padding-left:10px;background:#ccc;font-weight:700;min-width:100%}.tabulator-row.tabulator-group:hover{cursor:pointer;background-color:rgba(0,0,0,.1)}.tabulator-row.tabulator-group.tabulator-group-visible .tabulator-arrow{margin-right:10px;border-left:6px solid transparent;border-right:6px solid transparent;border-top:6px solid #666;border-bottom:0}.tabulator-row.tabulator-group.tabulator-group-level-1{padding-left:30px}.tabulator-row.tabulator-group.tabulator-group-level-2{padding-left:50px}.tabulator-row.tabulator-group.tabulator-group-level-3{padding-left:70px}.tabulator-row.tabulator-group.tabulator-group-level-4{padding-left:90px}.tabulator-row.tabulator-group.tabulator-group-level-5{padding-left:110px}.tabulator-row.tabulator-group .tabulator-group-toggle{display:inline-block}.tabulator-row.tabulator-group .tabulator-arrow{display:inline-block;width:0;height:0;margin-right:16px;border-top:6px solid transparent;border-bottom:6px solid transparent;border-right:0;border-left:6px solid #666;vertical-align:middle}.tabulator-row.tabulator-group span{margin-left:10px;color:#d00}.tabulator-menu{position:absolute;display:inline-block;box-sizing:border-box;background:#fff;border:1px solid #aaa;box-shadow:0 0 5px 0 rgba(0,0,0,.2);font-size:14px;overflow-y:auto;-webkit-overflow-scrolling:touch;z-index:10000}.tabulator-menu .tabulator-menu-item{padding:5px 10px;-webkit-user-select:none;-ms-user-select:none;user-select:none}.tabulator-menu .tabulator-menu-item.tabulator-menu-item-disabled{opacity:.5}.tabulator-menu .tabulator-menu-item:not(.tabulator-menu-item-disabled):hover{cursor:pointer;background:#efefef}.tabulator-menu .tabulator-menu-separator{border-top:1px solid #aaa}.tabulator-edit-select-list{position:absolute;display:inline-block;box-sizing:border-box;max-height:200px;background:#fff;border:1px solid #aaa;font-size:14px;overflow-y:auto;-webkit-overflow-scrolling:touch;z-index:10000}.tabulator-edit-select-list .tabulator-edit-select-list-item{padding:4px;color:#333}.tabulator-edit-select-list .tabulator-edit-select-list-item.active{color:#fff;background:#1d68cd}.tabulator-edit-select-list .tabulator-edit-select-list-item.active.focused{outline:1px solid hsla(0,0%,100%,.5)}.tabulator-edit-select-list .tabulator-edit-select-list-item.focused{outline:1px solid #1d68cd}.tabulator-edit-select-list .tabulator-edit-select-list-item:hover{cursor:pointer;color:#fff;background:#1d68cd}.tabulator-edit-select-list .tabulator-edit-select-list-notice{padding:4px;color:#333;text-align:center}.tabulator-edit-select-list .tabulator-edit-select-list-group{border-bottom:1px solid #aaa;padding:4px;padding-top:6px;color:#333;font-weight:700}.tabulator-print-fullscreen{position:absolute;top:0;bottom:0;left:0;right:0;z-index:10000}body.tabulator-print-fullscreen-hide>:not(.tabulator-print-fullscreen){display:none!important}.tabulator-print-table{border-collapse:collapse}.tabulator-print-table .tabulator-data-tree-branch{display:inline-block;vertical-align:middle;height:9px;width:7px;margin-top:-9px;margin-right:5px;border-bottom-left-radius:1px;border-left:2px solid #aaa;border-bottom:2px solid #aaa}.tabulator-print-table .tabulator-print-table-group{box-sizing:border-box;border-bottom:1px solid #999;border-right:1px solid #aaa;border-top:1px solid #999;padding:5px;padding-left:10px;background:#ccc;font-weight:700;min-width:100%}.tabulator-print-table .tabulator-print-table-group:hover{cursor:pointer;background-color:rgba(0,0,0,.1)}.tabulator-print-table .tabulator-print-table-group.tabulator-group-visible .tabulator-arrow{margin-right:10px;border-left:6px solid transparent;border-right:6px solid transparent;border-top:6px solid #666;border-bottom:0}.tabulator-print-table .tabulator-print-table-group.tabulator-group-level-1 td{padding-left:30px!important}.tabulator-print-table .tabulator-print-table-group.tabulator-group-level-2 td{padding-left:50px!important}.tabulator-print-table .tabulator-print-table-group.tabulator-group-level-3 td{padding-left:70px!important}.tabulator-print-table .tabulator-print-table-group.tabulator-group-level-4 td{padding-left:90px!important}.tabulator-print-table .tabulator-print-table-group.tabulator-group-level-5 td{padding-left:110px!important}.tabulator-print-table .tabulator-print-table-group .tabulator-group-toggle{display:inline-block}.tabulator-print-table .tabulator-print-table-group .tabulator-arrow{display:inline-block;width:0;height:0;margin-right:16px;border-top:6px solid transparent;border-bottom:6px solid transparent;border-right:0;border-left:6px solid #666;vertical-align:middle}.tabulator-print-table .tabulator-print-table-group span{margin-left:10px;color:#d00}.tabulator-print-table .tabulator-data-tree-control{display:-ms-inline-flexbox;display:inline-flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;vertical-align:middle;height:11px;width:11px;margin-right:5px;border:1px solid #333;border-radius:2px;background:rgba(0,0,0,.1);overflow:hidden}.tabulator-print-table .tabulator-data-tree-control:hover{cursor:pointer;background:rgba(0,0,0,.2)}.tabulator-print-table .tabulator-data-tree-control .tabulator-data-tree-control-collapse{display:inline-block;position:relative;height:7px;width:1px;background:transparent}.tabulator-print-table .tabulator-data-tree-control .tabulator-data-tree-control-collapse:after{position:absolute;content:\"\";left:-3px;top:3px;height:1px;width:7px;background:#333}.tabulator-print-table .tabulator-data-tree-control .tabulator-data-tree-control-expand{display:inline-block;position:relative;height:7px;width:1px;background:#333}.tabulator-print-table .tabulator-data-tree-control .tabulator-data-tree-control-expand:after{position:absolute;content:\"\";left:-3px;top:3px;height:1px;width:7px;background:#333}\n", ""]);
// Exports
module.exports = exports;


/***/ }),

/***/ "./node_modules/css-loader/dist/runtime/api.js":
/*!*****************************************************!*\
  !*** ./node_modules/css-loader/dist/runtime/api.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/*
  MIT License http://www.opensource.org/licenses/mit-license.php
  Author Tobias Koppers @sokra
*/
// css base code, injected by the css-loader
// eslint-disable-next-line func-names
module.exports = function (useSourceMap) {
  var list = []; // return the list of modules as css string

  list.toString = function toString() {
    return this.map(function (item) {
      var content = cssWithMappingToString(item, useSourceMap);

      if (item[2]) {
        return "@media ".concat(item[2], " {").concat(content, "}");
      }

      return content;
    }).join('');
  }; // import a list of modules into the list
  // eslint-disable-next-line func-names


  list.i = function (modules, mediaQuery, dedupe) {
    if (typeof modules === 'string') {
      // eslint-disable-next-line no-param-reassign
      modules = [[null, modules, '']];
    }

    var alreadyImportedModules = {};

    if (dedupe) {
      for (var i = 0; i < this.length; i++) {
        // eslint-disable-next-line prefer-destructuring
        var id = this[i][0];

        if (id != null) {
          alreadyImportedModules[id] = true;
        }
      }
    }

    for (var _i = 0; _i < modules.length; _i++) {
      var item = [].concat(modules[_i]);

      if (dedupe && alreadyImportedModules[item[0]]) {
        // eslint-disable-next-line no-continue
        continue;
      }

      if (mediaQuery) {
        if (!item[2]) {
          item[2] = mediaQuery;
        } else {
          item[2] = "".concat(mediaQuery, " and ").concat(item[2]);
        }
      }

      list.push(item);
    }
  };

  return list;
};

function cssWithMappingToString(item, useSourceMap) {
  var content = item[1] || ''; // eslint-disable-next-line prefer-destructuring

  var cssMapping = item[3];

  if (!cssMapping) {
    return content;
  }

  if (useSourceMap && typeof btoa === 'function') {
    var sourceMapping = toComment(cssMapping);
    var sourceURLs = cssMapping.sources.map(function (source) {
      return "/*# sourceURL=".concat(cssMapping.sourceRoot || '').concat(source, " */");
    });
    return [content].concat(sourceURLs).concat([sourceMapping]).join('\n');
  }

  return [content].join('\n');
} // Adapted from convert-source-map (MIT)


function toComment(sourceMap) {
  // eslint-disable-next-line no-undef
  var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));
  var data = "sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(base64);
  return "/*# ".concat(data, " */");
}

/***/ }),

/***/ "./node_modules/style-loader/lib/addStyles.js":
/*!****************************************************!*\
  !*** ./node_modules/style-loader/lib/addStyles.js ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/

var stylesInDom = {};

var	memoize = function (fn) {
	var memo;

	return function () {
		if (typeof memo === "undefined") memo = fn.apply(this, arguments);
		return memo;
	};
};

var isOldIE = memoize(function () {
	// Test for IE <= 9 as proposed by Browserhacks
	// @see http://browserhacks.com/#hack-e71d8692f65334173fee715c222cb805
	// Tests for existence of standard globals is to allow style-loader
	// to operate correctly into non-standard environments
	// @see https://github.com/webpack-contrib/style-loader/issues/177
	return window && document && document.all && !window.atob;
});

var getTarget = function (target, parent) {
  if (parent){
    return parent.querySelector(target);
  }
  return document.querySelector(target);
};

var getElement = (function (fn) {
	var memo = {};

	return function(target, parent) {
                // If passing function in options, then use it for resolve "head" element.
                // Useful for Shadow Root style i.e
                // {
                //   insertInto: function () { return document.querySelector("#foo").shadowRoot }
                // }
                if (typeof target === 'function') {
                        return target();
                }
                if (typeof memo[target] === "undefined") {
			var styleTarget = getTarget.call(this, target, parent);
			// Special case to return head of iframe instead of iframe itself
			if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {
				try {
					// This will throw an exception if access to iframe is blocked
					// due to cross-origin restrictions
					styleTarget = styleTarget.contentDocument.head;
				} catch(e) {
					styleTarget = null;
				}
			}
			memo[target] = styleTarget;
		}
		return memo[target]
	};
})();

var singleton = null;
var	singletonCounter = 0;
var	stylesInsertedAtTop = [];

var	fixUrls = __webpack_require__(/*! ./urls */ "./node_modules/style-loader/lib/urls.js");

module.exports = function(list, options) {
	if (typeof DEBUG !== "undefined" && DEBUG) {
		if (typeof document !== "object") throw new Error("The style-loader cannot be used in a non-browser environment");
	}

	options = options || {};

	options.attrs = typeof options.attrs === "object" ? options.attrs : {};

	// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>
	// tags it will allow on a page
	if (!options.singleton && typeof options.singleton !== "boolean") options.singleton = isOldIE();

	// By default, add <style> tags to the <head> element
        if (!options.insertInto) options.insertInto = "head";

	// By default, add <style> tags to the bottom of the target
	if (!options.insertAt) options.insertAt = "bottom";

	var styles = listToStyles(list, options);

	addStylesToDom(styles, options);

	return function update (newList) {
		var mayRemove = [];

		for (var i = 0; i < styles.length; i++) {
			var item = styles[i];
			var domStyle = stylesInDom[item.id];

			domStyle.refs--;
			mayRemove.push(domStyle);
		}

		if(newList) {
			var newStyles = listToStyles(newList, options);
			addStylesToDom(newStyles, options);
		}

		for (var i = 0; i < mayRemove.length; i++) {
			var domStyle = mayRemove[i];

			if(domStyle.refs === 0) {
				for (var j = 0; j < domStyle.parts.length; j++) domStyle.parts[j]();

				delete stylesInDom[domStyle.id];
			}
		}
	};
};

function addStylesToDom (styles, options) {
	for (var i = 0; i < styles.length; i++) {
		var item = styles[i];
		var domStyle = stylesInDom[item.id];

		if(domStyle) {
			domStyle.refs++;

			for(var j = 0; j < domStyle.parts.length; j++) {
				domStyle.parts[j](item.parts[j]);
			}

			for(; j < item.parts.length; j++) {
				domStyle.parts.push(addStyle(item.parts[j], options));
			}
		} else {
			var parts = [];

			for(var j = 0; j < item.parts.length; j++) {
				parts.push(addStyle(item.parts[j], options));
			}

			stylesInDom[item.id] = {id: item.id, refs: 1, parts: parts};
		}
	}
}

function listToStyles (list, options) {
	var styles = [];
	var newStyles = {};

	for (var i = 0; i < list.length; i++) {
		var item = list[i];
		var id = options.base ? item[0] + options.base : item[0];
		var css = item[1];
		var media = item[2];
		var sourceMap = item[3];
		var part = {css: css, media: media, sourceMap: sourceMap};

		if(!newStyles[id]) styles.push(newStyles[id] = {id: id, parts: [part]});
		else newStyles[id].parts.push(part);
	}

	return styles;
}

function insertStyleElement (options, style) {
	var target = getElement(options.insertInto)

	if (!target) {
		throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");
	}

	var lastStyleElementInsertedAtTop = stylesInsertedAtTop[stylesInsertedAtTop.length - 1];

	if (options.insertAt === "top") {
		if (!lastStyleElementInsertedAtTop) {
			target.insertBefore(style, target.firstChild);
		} else if (lastStyleElementInsertedAtTop.nextSibling) {
			target.insertBefore(style, lastStyleElementInsertedAtTop.nextSibling);
		} else {
			target.appendChild(style);
		}
		stylesInsertedAtTop.push(style);
	} else if (options.insertAt === "bottom") {
		target.appendChild(style);
	} else if (typeof options.insertAt === "object" && options.insertAt.before) {
		var nextSibling = getElement(options.insertAt.before, target);
		target.insertBefore(style, nextSibling);
	} else {
		throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");
	}
}

function removeStyleElement (style) {
	if (style.parentNode === null) return false;
	style.parentNode.removeChild(style);

	var idx = stylesInsertedAtTop.indexOf(style);
	if(idx >= 0) {
		stylesInsertedAtTop.splice(idx, 1);
	}
}

function createStyleElement (options) {
	var style = document.createElement("style");

	if(options.attrs.type === undefined) {
		options.attrs.type = "text/css";
	}

	if(options.attrs.nonce === undefined) {
		var nonce = getNonce();
		if (nonce) {
			options.attrs.nonce = nonce;
		}
	}

	addAttrs(style, options.attrs);
	insertStyleElement(options, style);

	return style;
}

function createLinkElement (options) {
	var link = document.createElement("link");

	if(options.attrs.type === undefined) {
		options.attrs.type = "text/css";
	}
	options.attrs.rel = "stylesheet";

	addAttrs(link, options.attrs);
	insertStyleElement(options, link);

	return link;
}

function addAttrs (el, attrs) {
	Object.keys(attrs).forEach(function (key) {
		el.setAttribute(key, attrs[key]);
	});
}

function getNonce() {
	if (false) {}

	return __webpack_require__.nc;
}

function addStyle (obj, options) {
	var style, update, remove, result;

	// If a transform function was defined, run it on the css
	if (options.transform && obj.css) {
	    result = typeof options.transform === 'function'
		 ? options.transform(obj.css) 
		 : options.transform.default(obj.css);

	    if (result) {
	    	// If transform returns a value, use that instead of the original css.
	    	// This allows running runtime transformations on the css.
	    	obj.css = result;
	    } else {
	    	// If the transform function returns a falsy value, don't add this css.
	    	// This allows conditional loading of css
	    	return function() {
	    		// noop
	    	};
	    }
	}

	if (options.singleton) {
		var styleIndex = singletonCounter++;

		style = singleton || (singleton = createStyleElement(options));

		update = applyToSingletonTag.bind(null, style, styleIndex, false);
		remove = applyToSingletonTag.bind(null, style, styleIndex, true);

	} else if (
		obj.sourceMap &&
		typeof URL === "function" &&
		typeof URL.createObjectURL === "function" &&
		typeof URL.revokeObjectURL === "function" &&
		typeof Blob === "function" &&
		typeof btoa === "function"
	) {
		style = createLinkElement(options);
		update = updateLink.bind(null, style, options);
		remove = function () {
			removeStyleElement(style);

			if(style.href) URL.revokeObjectURL(style.href);
		};
	} else {
		style = createStyleElement(options);
		update = applyToTag.bind(null, style);
		remove = function () {
			removeStyleElement(style);
		};
	}

	update(obj);

	return function updateStyle (newObj) {
		if (newObj) {
			if (
				newObj.css === obj.css &&
				newObj.media === obj.media &&
				newObj.sourceMap === obj.sourceMap
			) {
				return;
			}

			update(obj = newObj);
		} else {
			remove();
		}
	};
}

var replaceText = (function () {
	var textStore = [];

	return function (index, replacement) {
		textStore[index] = replacement;

		return textStore.filter(Boolean).join('\n');
	};
})();

function applyToSingletonTag (style, index, remove, obj) {
	var css = remove ? "" : obj.css;

	if (style.styleSheet) {
		style.styleSheet.cssText = replaceText(index, css);
	} else {
		var cssNode = document.createTextNode(css);
		var childNodes = style.childNodes;

		if (childNodes[index]) style.removeChild(childNodes[index]);

		if (childNodes.length) {
			style.insertBefore(cssNode, childNodes[index]);
		} else {
			style.appendChild(cssNode);
		}
	}
}

function applyToTag (style, obj) {
	var css = obj.css;
	var media = obj.media;

	if(media) {
		style.setAttribute("media", media)
	}

	if(style.styleSheet) {
		style.styleSheet.cssText = css;
	} else {
		while(style.firstChild) {
			style.removeChild(style.firstChild);
		}

		style.appendChild(document.createTextNode(css));
	}
}

function updateLink (link, options, obj) {
	var css = obj.css;
	var sourceMap = obj.sourceMap;

	/*
		If convertToAbsoluteUrls isn't defined, but sourcemaps are enabled
		and there is no publicPath defined then lets turn convertToAbsoluteUrls
		on by default.  Otherwise default to the convertToAbsoluteUrls option
		directly
	*/
	var autoFixUrls = options.convertToAbsoluteUrls === undefined && sourceMap;

	if (options.convertToAbsoluteUrls || autoFixUrls) {
		css = fixUrls(css);
	}

	if (sourceMap) {
		// http://stackoverflow.com/a/26603875
		css += "\n/*# sourceMappingURL=data:application/json;base64," + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + " */";
	}

	var blob = new Blob([css], { type: "text/css" });

	var oldSrc = link.href;

	link.href = URL.createObjectURL(blob);

	if(oldSrc) URL.revokeObjectURL(oldSrc);
}


/***/ }),

/***/ "./node_modules/style-loader/lib/urls.js":
/*!***********************************************!*\
  !*** ./node_modules/style-loader/lib/urls.js ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports) {


/**
 * When source maps are enabled, `style-loader` uses a link element with a data-uri to
 * embed the css on the page. This breaks all relative urls because now they are relative to a
 * bundle instead of the current page.
 *
 * One solution is to only use full urls, but that may be impossible.
 *
 * Instead, this function "fixes" the relative urls to be absolute according to the current page location.
 *
 * A rudimentary test suite is located at `test/fixUrls.js` and can be run via the `npm test` command.
 *
 */

module.exports = function (css) {
  // get current location
  var location = typeof window !== "undefined" && window.location;

  if (!location) {
    throw new Error("fixUrls requires window.location");
  }

	// blank or null?
	if (!css || typeof css !== "string") {
	  return css;
  }

  var baseUrl = location.protocol + "//" + location.host;
  var currentDir = baseUrl + location.pathname.replace(/\/[^\/]*$/, "/");

	// convert each url(...)
	/*
	This regular expression is just a way to recursively match brackets within
	a string.

	 /url\s*\(  = Match on the word "url" with any whitespace after it and then a parens
	   (  = Start a capturing group
	     (?:  = Start a non-capturing group
	         [^)(]  = Match anything that isn't a parentheses
	         |  = OR
	         \(  = Match a start parentheses
	             (?:  = Start another non-capturing groups
	                 [^)(]+  = Match anything that isn't a parentheses
	                 |  = OR
	                 \(  = Match a start parentheses
	                     [^)(]*  = Match anything that isn't a parentheses
	                 \)  = Match a end parentheses
	             )  = End Group
              *\) = Match anything and then a close parens
          )  = Close non-capturing group
          *  = Match anything
       )  = Close capturing group
	 \)  = Match a close parens

	 /gi  = Get all matches, not the first.  Be case insensitive.
	 */
	var fixedCss = css.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi, function(fullMatch, origUrl) {
		// strip quotes (if they exist)
		var unquotedOrigUrl = origUrl
			.trim()
			.replace(/^"(.*)"$/, function(o, $1){ return $1; })
			.replace(/^'(.*)'$/, function(o, $1){ return $1; });

		// already a full url? no change
		if (/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(unquotedOrigUrl)) {
		  return fullMatch;
		}

		// convert the url to a full url
		var newUrl;

		if (unquotedOrigUrl.indexOf("//") === 0) {
		  	//TODO: should we add protocol?
			newUrl = unquotedOrigUrl;
		} else if (unquotedOrigUrl.indexOf("/") === 0) {
			// path should be relative to the base url
			newUrl = baseUrl + unquotedOrigUrl; // already starts with '/'
		} else {
			// path should be relative to current directory
			newUrl = currentDir + unquotedOrigUrl.replace(/^\.\//, ""); // Strip leading './'
		}

		// send back the fixed url(...)
		return "url(" + JSON.stringify(newUrl) + ")";
	});

	// send back the fixed css
	return fixedCss;
};


/***/ }),

/***/ "./node_modules/tabulator-tables/dist/css/tabulator.min.css":
/*!******************************************************************!*\
  !*** ./node_modules/tabulator-tables/dist/css/tabulator.min.css ***!
  \******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {


var content = __webpack_require__(/*! !../../../css-loader/dist/cjs.js!./tabulator.min.css */ "./node_modules/css-loader/dist/cjs.js!./node_modules/tabulator-tables/dist/css/tabulator.min.css");

if(typeof content === 'string') content = [[module.i, content, '']];

var transform;
var insertInto;



var options = {"insertAt":"top","hmr":true}

options.transform = transform
options.insertInto = undefined;

var update = __webpack_require__(/*! ../../../style-loader/lib/addStyles.js */ "./node_modules/style-loader/lib/addStyles.js")(content, options);

if(content.locals) module.exports = content.locals;

if(true) {
	module.hot.accept(/*! !../../../css-loader/dist/cjs.js!./tabulator.min.css */ "./node_modules/css-loader/dist/cjs.js!./node_modules/tabulator-tables/dist/css/tabulator.min.css", function() {
		var newContent = __webpack_require__(/*! !../../../css-loader/dist/cjs.js!./tabulator.min.css */ "./node_modules/css-loader/dist/cjs.js!./node_modules/tabulator-tables/dist/css/tabulator.min.css");

		if(typeof newContent === 'string') newContent = [[module.i, newContent, '']];

		var locals = (function(a, b) {
			var key, idx = 0;

			for(key in a) {
				if(!b || a[key] !== b[key]) return false;
				idx++;
			}

			for(key in b) idx--;

			return idx === 0;
		}(content.locals, newContent.locals));

		if(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');

		update(newContent);
	});

	module.hot.dispose(function() { update(); });
}

/***/ }),

/***/ "./node_modules/tabulator-tables/dist/js/tabulator.js":
/*!************************************************************!*\
  !*** ./node_modules/tabulator-tables/dist/js/tabulator.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/* Tabulator v4.7.0 (c) Oliver Folkerd */

;(function (global, factory) {
	if (( false ? undefined : _typeof(exports)) === 'object' && typeof module !== 'undefined') {
		module.exports = factory();
	} else if (true) {
		!(__WEBPACK_AMD_DEFINE_FACTORY__ = (factory),
				__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
				(__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) :
				__WEBPACK_AMD_DEFINE_FACTORY__),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
	} else {}
})(this, function () {

	'use strict';

	// https://tc39.github.io/ecma262/#sec-array.prototype.findIndex


	if (!Array.prototype.findIndex) {

		Object.defineProperty(Array.prototype, 'findIndex', {

			value: function value(predicate) {

				// 1. Let O be ? ToObject(this value).


				if (this == null) {

					throw new TypeError('"this" is null or not defined');
				}

				var o = Object(this);

				// 2. Let len be ? ToLength(? Get(O, "length")).


				var len = o.length >>> 0;

				// 3. If IsCallable(predicate) is false, throw a TypeError exception.


				if (typeof predicate !== 'function') {

					throw new TypeError('predicate must be a function');
				}

				// 4. If thisArg was supplied, let T be thisArg; else let T be undefined.


				var thisArg = arguments[1];

				// 5. Let k be 0.


				var k = 0;

				// 6. Repeat, while k < len


				while (k < len) {

					// a. Let Pk be ! ToString(k).


					// b. Let kValue be ? Get(O, Pk).


					// c. Let testResult be ToBoolean(? Call(predicate, T, « kValue, k, O »)).


					// d. If testResult is true, return k.


					var kValue = o[k];

					if (predicate.call(thisArg, kValue, k, o)) {

						return k;
					}

					// e. Increase k by 1.


					k++;
				}

				// 7. Return -1.


				return -1;
			}

		});
	}

	// https://tc39.github.io/ecma262/#sec-array.prototype.find


	if (!Array.prototype.find) {

		Object.defineProperty(Array.prototype, 'find', {

			value: function value(predicate) {

				// 1. Let O be ? ToObject(this value).


				if (this == null) {

					throw new TypeError('"this" is null or not defined');
				}

				var o = Object(this);

				// 2. Let len be ? ToLength(? Get(O, "length")).


				var len = o.length >>> 0;

				// 3. If IsCallable(predicate) is false, throw a TypeError exception.


				if (typeof predicate !== 'function') {

					throw new TypeError('predicate must be a function');
				}

				// 4. If thisArg was supplied, let T be thisArg; else let T be undefined.


				var thisArg = arguments[1];

				// 5. Let k be 0.


				var k = 0;

				// 6. Repeat, while k < len


				while (k < len) {

					// a. Let Pk be ! ToString(k).


					// b. Let kValue be ? Get(O, Pk).


					// c. Let testResult be ToBoolean(? Call(predicate, T, « kValue, k, O »)).


					// d. If testResult is true, return kValue.


					var kValue = o[k];

					if (predicate.call(thisArg, kValue, k, o)) {

						return kValue;
					}

					// e. Increase k by 1.


					k++;
				}

				// 7. Return undefined.


				return undefined;
			}

		});
	}

	// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/includes#Polyfill


	if (!String.prototype.includes) {

		String.prototype.includes = function (search, start) {

			'use strict';

			if (search instanceof RegExp) {

				throw TypeError('first argument must not be a RegExp');
			}

			if (start === undefined) {
				start = 0;
			}

			return this.indexOf(search, start) !== -1;
		};
	}

	// https://tc39.github.io/ecma262/#sec-array.prototype.includes


	if (!Array.prototype.includes) {

		Object.defineProperty(Array.prototype, 'includes', {

			value: function value(searchElement, fromIndex) {

				if (this == null) {

					throw new TypeError('"this" is null or not defined');
				}

				// 1. Let O be ? ToObject(this value).


				var o = Object(this);

				// 2. Let len be ? ToLength(? Get(O, "length")).


				var len = o.length >>> 0;

				// 3. If len is 0, return false.


				if (len === 0) {

					return false;
				}

				// 4. Let n be ? ToInteger(fromIndex).


				//    (If fromIndex is undefined, this step produces the value 0.)


				var n = fromIndex | 0;

				// 5. If n ≥ 0, then


				//  a. Let k be n.


				// 6. Else n < 0,


				//  a. Let k be len + n.


				//  b. If k < 0, let k be 0.


				var k = Math.max(n >= 0 ? n : len - Math.abs(n), 0);

				function sameValueZero(x, y) {

					return x === y || typeof x === 'number' && typeof y === 'number' && isNaN(x) && isNaN(y);
				}

				// 7. Repeat, while k < len


				while (k < len) {

					// a. Let elementK be the result of ? Get(O, ! ToString(k)).


					// b. If SameValueZero(searchElement, elementK) is true, return true.


					if (sameValueZero(o[k], searchElement)) {

						return true;
					}

					// c. Increase k by 1.


					k++;
				}

				// 8. Return false


				return false;
			}

		});
	}

	// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign#Polyfill


	if (typeof Object.assign !== 'function') {

		// Must be writable: true, enumerable: false, configurable: true


		Object.defineProperty(Object, "assign", {

			value: function assign(target, varArgs) {
				// .length of function is 2


				'use strict';

				if (target === null || target === undefined) {

					throw new TypeError('Cannot convert undefined or null to object');
				}

				var to = Object(target);

				for (var index = 1; index < arguments.length; index++) {

					var nextSource = arguments[index];

					if (nextSource !== null && nextSource !== undefined) {

						for (var nextKey in nextSource) {

							// Avoid bugs when hasOwnProperty is shadowed


							if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {

								to[nextKey] = nextSource[nextKey];
							}
						}
					}
				}

				return to;
			},

			writable: true,

			configurable: true

		});
	}

	var ColumnManager = function ColumnManager(table) {

		this.table = table; //hold parent table


		this.blockHozScrollEvent = false;

		this.headersElement = this.createHeadersElement();

		this.element = this.createHeaderElement(); //containing element


		this.rowManager = null; //hold row manager object


		this.columns = []; // column definition object


		this.columnsByIndex = []; //columns by index


		this.columnsByField = {}; //columns by field


		this.scrollLeft = 0;

		this.element.insertBefore(this.headersElement, this.element.firstChild);
	};

	////////////// Setup Functions /////////////////


	ColumnManager.prototype.createHeadersElement = function () {

		var el = document.createElement("div");

		el.classList.add("tabulator-headers");

		return el;
	};

	ColumnManager.prototype.createHeaderElement = function () {

		var el = document.createElement("div");

		el.classList.add("tabulator-header");

		if (!this.table.options.headerVisible) {

			el.classList.add("tabulator-header-hidden");
		}

		return el;
	};

	ColumnManager.prototype.initialize = function () {

		var self = this;

		//scroll body along with header


		// self.element.addEventListener("scroll", function(e){


		// 	if(!self.blockHozScrollEvent){


		// 		self.table.rowManager.scrollHorizontal(self.element.scrollLeft);


		// 	}


		// });

	};

	//link to row manager


	ColumnManager.prototype.setRowManager = function (manager) {

		this.rowManager = manager;
	};

	//return containing element


	ColumnManager.prototype.getElement = function () {

		return this.element;
	};

	//return header containing element


	ColumnManager.prototype.getHeadersElement = function () {

		return this.headersElement;
	};

	// ColumnManager.prototype.tempScrollBlock = function(){


	// 	clearTimeout(this.blockHozScrollEvent);


	// 	this.blockHozScrollEvent = setTimeout(() => {this.blockHozScrollEvent = false;}, 50);


	// }


	//scroll horizontally to match table body


	ColumnManager.prototype.scrollHorizontal = function (left) {

		var hozAdjust = 0,
		    scrollWidth = this.element.scrollWidth - this.table.element.clientWidth;

		// this.tempScrollBlock();


		this.element.scrollLeft = left;

		//adjust for vertical scrollbar moving table when present


		if (left > scrollWidth) {

			hozAdjust = left - scrollWidth;

			this.element.style.marginLeft = -hozAdjust + "px";
		} else {

			this.element.style.marginLeft = 0;
		}

		//keep frozen columns fixed in position


		//this._calcFrozenColumnsPos(hozAdjust + 3);


		this.scrollLeft = left;

		if (this.table.modExists("frozenColumns")) {

			this.table.modules.frozenColumns.scrollHorizontal();
		}
	};

	///////////// Column Setup Functions /////////////


	ColumnManager.prototype.generateColumnsFromRowData = function (data) {

		var cols = [],
		    row,
		    sorter;

		if (data && data.length) {

			row = data[0];

			for (var key in row) {

				var col = {

					field: key,

					title: key

				};

				var value = row[key];

				switch (typeof value === 'undefined' ? 'undefined' : _typeof(value)) {

					case "undefined":

						sorter = "string";

						break;

					case "boolean":

						sorter = "boolean";

						break;

					case "object":

						if (Array.isArray(value)) {

							sorter = "array";
						} else {

							sorter = "string";
						}

						break;

					default:

						if (!isNaN(value) && value !== "") {

							sorter = "number";
						} else {

							if (value.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)) {

								sorter = "alphanum";
							} else {

								sorter = "string";
							}
						}

						break;

				}

				col.sorter = sorter;

				cols.push(col);
			}

			this.table.options.columns = cols;

			this.setColumns(this.table.options.columns);
		}
	};

	ColumnManager.prototype.setColumns = function (cols, row) {

		var self = this;

		while (self.headersElement.firstChild) {
			self.headersElement.removeChild(self.headersElement.firstChild);
		}self.columns = [];

		self.columnsByIndex = [];

		self.columnsByField = {};

		//reset frozen columns


		if (self.table.modExists("frozenColumns")) {

			self.table.modules.frozenColumns.reset();
		}

		cols.forEach(function (def, i) {

			self._addColumn(def);
		});

		self._reIndexColumns();

		if (self.table.options.responsiveLayout && self.table.modExists("responsiveLayout", true)) {

			self.table.modules.responsiveLayout.initialize();
		}

		self.redraw(true);
	};

	ColumnManager.prototype._addColumn = function (definition, before, nextToColumn) {

		var column = new Column(definition, this),
		    colEl = column.getElement(),
		    index = nextToColumn ? this.findColumnIndex(nextToColumn) : nextToColumn;

		if (nextToColumn && index > -1) {

			var parentIndex = this.columns.indexOf(nextToColumn.getTopColumn());

			var nextEl = nextToColumn.getElement();

			if (before) {

				this.columns.splice(parentIndex, 0, column);

				nextEl.parentNode.insertBefore(colEl, nextEl);
			} else {

				this.columns.splice(parentIndex + 1, 0, column);

				nextEl.parentNode.insertBefore(colEl, nextEl.nextSibling);
			}
		} else {

			if (before) {

				this.columns.unshift(column);

				this.headersElement.insertBefore(column.getElement(), this.headersElement.firstChild);
			} else {

				this.columns.push(column);

				this.headersElement.appendChild(column.getElement());
			}

			column.columnRendered();
		}

		return column;
	};

	ColumnManager.prototype.registerColumnField = function (col) {

		if (col.definition.field) {

			this.columnsByField[col.definition.field] = col;
		}
	};

	ColumnManager.prototype.registerColumnPosition = function (col) {

		this.columnsByIndex.push(col);
	};

	ColumnManager.prototype._reIndexColumns = function () {

		this.columnsByIndex = [];

		this.columns.forEach(function (column) {

			column.reRegisterPosition();
		});
	};

	//ensure column headers take up the correct amount of space in column groups


	ColumnManager.prototype._verticalAlignHeaders = function () {

		var self = this,
		    minHeight = 0;

		self.columns.forEach(function (column) {

			var height;

			column.clearVerticalAlign();

			height = column.getHeight();

			if (height > minHeight) {

				minHeight = height;
			}
		});

		self.columns.forEach(function (column) {

			column.verticalAlign(self.table.options.columnHeaderVertAlign, minHeight);
		});

		self.rowManager.adjustTableSize();
	};

	//////////////// Column Details /////////////////


	ColumnManager.prototype.findColumn = function (subject) {

		var self = this;

		if ((typeof subject === 'undefined' ? 'undefined' : _typeof(subject)) == "object") {

			if (subject instanceof Column) {

				//subject is column element


				return subject;
			} else if (subject instanceof ColumnComponent) {

				//subject is public column component


				return subject._getSelf() || false;
			} else if (typeof HTMLElement !== "undefined" && subject instanceof HTMLElement) {

				//subject is a HTML element of the column header


				var match = self.columns.find(function (column) {

					return column.element === subject;
				});

				return match || false;
			}
		} else {

			//subject should be treated as the field name of the column


			return this.columnsByField[subject] || false;
		}

		//catch all for any other type of input


		return false;
	};

	ColumnManager.prototype.getColumnByField = function (field) {

		return this.columnsByField[field];
	};

	ColumnManager.prototype.getColumnsByFieldRoot = function (root) {
		var _this = this;

		var matches = [];

		Object.keys(this.columnsByField).forEach(function (field) {

			var fieldRoot = field.split(".")[0];

			if (fieldRoot === root) {

				matches.push(_this.columnsByField[field]);
			}
		});

		return matches;
	};

	ColumnManager.prototype.getColumnByIndex = function (index) {

		return this.columnsByIndex[index];
	};

	ColumnManager.prototype.getFirstVisibileColumn = function (index) {

		var index = this.columnsByIndex.findIndex(function (col) {

			return col.visible;
		});

		return index > -1 ? this.columnsByIndex[index] : false;
	};

	ColumnManager.prototype.getColumns = function () {

		return this.columns;
	};

	ColumnManager.prototype.findColumnIndex = function (column) {

		return this.columnsByIndex.findIndex(function (col) {

			return column === col;
		});
	};

	//return all columns that are not groups


	ColumnManager.prototype.getRealColumns = function () {

		return this.columnsByIndex;
	};

	//travers across columns and call action


	ColumnManager.prototype.traverse = function (callback) {

		var self = this;

		self.columnsByIndex.forEach(function (column, i) {

			callback(column, i);
		});
	};

	//get defintions of actual columns


	ColumnManager.prototype.getDefinitions = function (active) {

		var self = this,
		    output = [];

		self.columnsByIndex.forEach(function (column) {

			if (!active || active && column.visible) {

				output.push(column.getDefinition());
			}
		});

		return output;
	};

	//get full nested definition tree


	ColumnManager.prototype.getDefinitionTree = function () {

		var self = this,
		    output = [];

		self.columns.forEach(function (column) {

			output.push(column.getDefinition(true));
		});

		return output;
	};

	ColumnManager.prototype.getComponents = function (structured) {

		var self = this,
		    output = [],
		    columns = structured ? self.columns : self.columnsByIndex;

		columns.forEach(function (column) {

			output.push(column.getComponent());
		});

		return output;
	};

	ColumnManager.prototype.getWidth = function () {

		var width = 0;

		this.columnsByIndex.forEach(function (column) {

			if (column.visible) {

				width += column.getWidth();
			}
		});

		return width;
	};

	ColumnManager.prototype.moveColumn = function (from, to, after) {

		this.moveColumnActual(from, to, after);

		if (this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

			this.table.modules.responsiveLayout.initialize();
		}

		if (this.table.modExists("columnCalcs")) {

			this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows);
		}

		to.element.parentNode.insertBefore(from.element, to.element);

		if (after) {

			to.element.parentNode.insertBefore(to.element, from.element);
		}

		this._verticalAlignHeaders();

		this.table.rowManager.reinitialize();
	};

	ColumnManager.prototype.moveColumnActual = function (from, to, after) {

		if (from.parent.isGroup) {

			this._moveColumnInArray(from.parent.columns, from, to, after);
		} else {

			this._moveColumnInArray(this.columns, from, to, after);
		}

		this._moveColumnInArray(this.columnsByIndex, from, to, after, true);

		if (this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

			this.table.modules.responsiveLayout.initialize();
		}

		if (this.table.options.columnMoved) {

			this.table.options.columnMoved.call(this.table, from.getComponent(), this.table.columnManager.getComponents());
		}

		if (this.table.options.persistence && this.table.modExists("persistence", true) && this.table.modules.persistence.config.columns) {

			this.table.modules.persistence.save("columns");
		}
	};

	ColumnManager.prototype._moveColumnInArray = function (columns, from, to, after, updateRows) {

		var fromIndex = columns.indexOf(from),
		    toIndex;

		if (fromIndex > -1) {

			columns.splice(fromIndex, 1);

			toIndex = columns.indexOf(to);

			if (toIndex > -1) {

				if (after) {

					toIndex = toIndex + 1;
				}
			} else {

				toIndex = fromIndex;
			}

			columns.splice(toIndex, 0, from);

			if (updateRows) {

				this.table.rowManager.rows.forEach(function (row) {

					if (row.cells.length) {

						var cell = row.cells.splice(fromIndex, 1)[0];

						row.cells.splice(toIndex, 0, cell);
					}
				});
			}
		}
	};

	ColumnManager.prototype.scrollToColumn = function (column, position, ifVisible) {
		var _this2 = this;

		var left = 0,
		    offset = 0,
		    adjust = 0,
		    colEl = column.getElement();

		return new Promise(function (resolve, reject) {

			if (typeof position === "undefined") {

				position = _this2.table.options.scrollToColumnPosition;
			}

			if (typeof ifVisible === "undefined") {

				ifVisible = _this2.table.options.scrollToColumnIfVisible;
			}

			if (column.visible) {

				//align to correct position


				switch (position) {

					case "middle":

					case "center":

						adjust = -_this2.element.clientWidth / 2;

						break;

					case "right":

						adjust = colEl.clientWidth - _this2.headersElement.clientWidth;

						break;

				}

				//check column visibility


				if (!ifVisible) {

					offset = colEl.offsetLeft;

					if (offset > 0 && offset + colEl.offsetWidth < _this2.element.clientWidth) {

						return false;
					}
				}

				//calculate scroll position


				left = colEl.offsetLeft + _this2.element.scrollLeft + adjust;

				left = Math.max(Math.min(left, _this2.table.rowManager.element.scrollWidth - _this2.table.rowManager.element.clientWidth), 0);

				_this2.table.rowManager.scrollHorizontal(left);

				_this2.scrollHorizontal(left);

				resolve();
			} else {

				console.warn("Scroll Error - Column not visible");

				reject("Scroll Error - Column not visible");
			}
		});
	};

	//////////////// Cell Management /////////////////


	ColumnManager.prototype.generateCells = function (row) {

		var self = this;

		var cells = [];

		self.columnsByIndex.forEach(function (column) {

			cells.push(column.generateCell(row));
		});

		return cells;
	};

	//////////////// Column Management /////////////////


	ColumnManager.prototype.getFlexBaseWidth = function () {

		var self = this,
		    totalWidth = self.table.element.clientWidth,
		    //table element width


		fixedWidth = 0;

		//adjust for vertical scrollbar if present


		if (self.rowManager.element.scrollHeight > self.rowManager.element.clientHeight) {

			totalWidth -= self.rowManager.element.offsetWidth - self.rowManager.element.clientWidth;
		}

		this.columnsByIndex.forEach(function (column) {

			var width, minWidth, colWidth;

			if (column.visible) {

				width = column.definition.width || 0;

				minWidth = typeof column.minWidth == "undefined" ? self.table.options.columnMinWidth : parseInt(column.minWidth);

				if (typeof width == "string") {

					if (width.indexOf("%") > -1) {

						colWidth = totalWidth / 100 * parseInt(width);
					} else {

						colWidth = parseInt(width);
					}
				} else {

					colWidth = width;
				}

				fixedWidth += colWidth > minWidth ? colWidth : minWidth;
			}
		});

		return fixedWidth;
	};

	ColumnManager.prototype.addColumn = function (definition, before, nextToColumn) {
		var _this3 = this;

		return new Promise(function (resolve, reject) {

			var column = _this3._addColumn(definition, before, nextToColumn);

			_this3._reIndexColumns();

			if (_this3.table.options.responsiveLayout && _this3.table.modExists("responsiveLayout", true)) {

				_this3.table.modules.responsiveLayout.initialize();
			}

			if (_this3.table.modExists("columnCalcs")) {

				_this3.table.modules.columnCalcs.recalc(_this3.table.rowManager.activeRows);
			}

			_this3.redraw();

			if (_this3.table.modules.layout.getMode() != "fitColumns") {

				column.reinitializeWidth();
			}

			_this3._verticalAlignHeaders();

			_this3.table.rowManager.reinitialize();

			resolve(column);
		});
	};

	//remove column from system


	ColumnManager.prototype.deregisterColumn = function (column) {

		var field = column.getField(),
		    index;

		//remove from field list


		if (field) {

			delete this.columnsByField[field];
		}

		//remove from index list


		index = this.columnsByIndex.indexOf(column);

		if (index > -1) {

			this.columnsByIndex.splice(index, 1);
		}

		//remove from column list


		index = this.columns.indexOf(column);

		if (index > -1) {

			this.columns.splice(index, 1);
		}

		if (this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

			this.table.modules.responsiveLayout.initialize();
		}

		this.redraw();
	};

	//redraw columns


	ColumnManager.prototype.redraw = function (force) {

		if (force) {

			if (Tabulator.prototype.helpers.elVisible(this.element)) {

				this._verticalAlignHeaders();
			}

			this.table.rowManager.resetScroll();

			this.table.rowManager.reinitialize();
		}

		if (["fitColumns", "fitDataStretch"].indexOf(this.table.modules.layout.getMode()) > -1) {

			this.table.modules.layout.layout();
		} else {

			if (force) {

				this.table.modules.layout.layout();
			} else {

				if (this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

					this.table.modules.responsiveLayout.update();
				}
			}
		}

		if (this.table.modExists("frozenColumns")) {

			this.table.modules.frozenColumns.layout();
		}

		if (this.table.modExists("columnCalcs")) {

			this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows);
		}

		if (force) {

			if (this.table.options.persistence && this.table.modExists("persistence", true) && this.table.modules.persistence.config.columns) {

				this.table.modules.persistence.save("columns");
			}

			if (this.table.modExists("columnCalcs")) {

				this.table.modules.columnCalcs.redraw();
			}
		}

		this.table.footerManager.redraw();
	};

	//public column object

	var ColumnComponent = function ColumnComponent(column) {

		this._column = column;

		this.type = "ColumnComponent";
	};

	ColumnComponent.prototype.getElement = function () {

		return this._column.getElement();
	};

	ColumnComponent.prototype.getDefinition = function () {

		return this._column.getDefinition();
	};

	ColumnComponent.prototype.getField = function () {

		return this._column.getField();
	};

	ColumnComponent.prototype.getCells = function () {

		var cells = [];

		this._column.cells.forEach(function (cell) {

			cells.push(cell.getComponent());
		});

		return cells;
	};

	ColumnComponent.prototype.getVisibility = function () {

		console.warn("getVisibility function is deprecated, you should now use the isVisible function");

		return this._column.visible;
	};

	ColumnComponent.prototype.isVisible = function () {

		return this._column.visible;
	};

	ColumnComponent.prototype.show = function () {

		if (this._column.isGroup) {

			this._column.columns.forEach(function (column) {

				column.show();
			});
		} else {

			this._column.show();
		}
	};

	ColumnComponent.prototype.hide = function () {

		if (this._column.isGroup) {

			this._column.columns.forEach(function (column) {

				column.hide();
			});
		} else {

			this._column.hide();
		}
	};

	ColumnComponent.prototype.toggle = function () {

		if (this._column.visible) {

			this.hide();
		} else {

			this.show();
		}
	};

	ColumnComponent.prototype.delete = function () {

		return this._column.delete();
	};

	ColumnComponent.prototype.getSubColumns = function () {

		var output = [];

		if (this._column.columns.length) {

			this._column.columns.forEach(function (column) {

				output.push(column.getComponent());
			});
		}

		return output;
	};

	ColumnComponent.prototype.getParentColumn = function () {

		return this._column.parent instanceof Column ? this._column.parent.getComponent() : false;
	};

	ColumnComponent.prototype._getSelf = function () {

		return this._column;
	};

	ColumnComponent.prototype.scrollTo = function () {

		return this._column.table.columnManager.scrollToColumn(this._column);
	};

	ColumnComponent.prototype.getTable = function () {

		return this._column.table;
	};

	ColumnComponent.prototype.headerFilterFocus = function () {

		if (this._column.table.modExists("filter", true)) {

			this._column.table.modules.filter.setHeaderFilterFocus(this._column);
		}
	};

	ColumnComponent.prototype.reloadHeaderFilter = function () {

		if (this._column.table.modExists("filter", true)) {

			this._column.table.modules.filter.reloadHeaderFilter(this._column);
		}
	};

	ColumnComponent.prototype.getHeaderFilterValue = function () {

		if (this._column.table.modExists("filter", true)) {

			return this._column.table.modules.filter.getHeaderFilterValue(this._column);
		}
	};

	ColumnComponent.prototype.setHeaderFilterValue = function (value) {

		if (this._column.table.modExists("filter", true)) {

			this._column.table.modules.filter.setHeaderFilterValue(this._column, value);
		}
	};

	ColumnComponent.prototype.move = function (to, after) {

		var toColumn = this._column.table.columnManager.findColumn(to);

		if (toColumn) {

			this._column.table.columnManager.moveColumn(this._column, toColumn, after);
		} else {

			console.warn("Move Error - No matching column found:", toColumn);
		}
	};

	ColumnComponent.prototype.getNextColumn = function () {

		var nextCol = this._column.nextColumn();

		return nextCol ? nextCol.getComponent() : false;
	};

	ColumnComponent.prototype.getPrevColumn = function () {

		var prevCol = this._column.prevColumn();

		return prevCol ? prevCol.getComponent() : false;
	};

	ColumnComponent.prototype.updateDefinition = function (updates) {

		return this._column.updateDefinition(updates);
	};

	ColumnComponent.prototype.getWidth = function () {

		return this._column.getWidth();
	};

	ColumnComponent.prototype.setWidth = function (width) {

		if (width === true) {

			return this._column.reinitializeWidth(true);
		} else {

			return this._column.setWidth(width);
		}
	};

	ColumnComponent.prototype.validate = function () {

		return this._column.validate();
	};

	var Column = function Column(def, parent) {

		var self = this;

		this.table = parent.table;

		this.definition = def; //column definition

		this.parent = parent; //hold parent object

		this.type = "column"; //type of element

		this.columns = []; //child columns

		this.cells = []; //cells bound to this column

		this.element = this.createElement(); //column header element

		this.contentElement = false;

		this.titleElement = false;

		this.groupElement = this.createGroupElement(); //column group holder element

		this.isGroup = false;

		this.tooltip = false; //hold column tooltip

		this.hozAlign = ""; //horizontal text alignment

		this.vertAlign = ""; //vert text alignment


		//multi dimensional filed handling

		this.field = "";

		this.fieldStructure = "";

		this.getFieldValue = "";

		this.setFieldValue = "";

		this.titleFormatterRendered = false;

		this.setField(this.definition.field);

		if (this.table.options.invalidOptionWarnings) {

			this.checkDefinition();
		}

		this.modules = {}; //hold module variables;


		this.cellEvents = {

			cellClick: false,

			cellDblClick: false,

			cellContext: false,

			cellTap: false,

			cellDblTap: false,

			cellTapHold: false,

			cellMouseEnter: false,

			cellMouseLeave: false,

			cellMouseOver: false,

			cellMouseOut: false,

			cellMouseMove: false

		};

		this.width = null; //column width

		this.widthStyled = ""; //column width prestyled to improve render efficiency

		this.minWidth = null; //column minimum width

		this.minWidthStyled = ""; //column minimum prestyled to improve render efficiency

		this.widthFixed = false; //user has specified a width for this column


		this.visible = true; //default visible state


		this.component = null;

		this._mapDepricatedFunctionality();

		//initialize column

		if (def.columns) {

			this.isGroup = true;

			def.columns.forEach(function (def, i) {

				var newCol = new Column(def, self);

				self.attachColumn(newCol);
			});

			self.checkColumnVisibility();
		} else {

			parent.registerColumnField(this);
		}

		if (def.rowHandle && this.table.options.movableRows !== false && this.table.modExists("moveRow")) {

			this.table.modules.moveRow.setHandle(true);
		}

		this._buildHeader();

		this.bindModuleColumns();
	};

	Column.prototype.createElement = function () {

		var el = document.createElement("div");

		el.classList.add("tabulator-col");

		el.setAttribute("role", "columnheader");

		el.setAttribute("aria-sort", "none");

		return el;
	};

	Column.prototype.createGroupElement = function () {

		var el = document.createElement("div");

		el.classList.add("tabulator-col-group-cols");

		return el;
	};

	Column.prototype.checkDefinition = function () {
		var _this4 = this;

		Object.keys(this.definition).forEach(function (key) {

			if (_this4.defaultOptionList.indexOf(key) === -1) {

				console.warn("Invalid column definition option in '" + (_this4.field || _this4.definition.title) + "' column:", key);
			}
		});
	};

	Column.prototype.setField = function (field) {

		this.field = field;

		this.fieldStructure = field ? this.table.options.nestedFieldSeparator ? field.split(this.table.options.nestedFieldSeparator) : [field] : [];

		this.getFieldValue = this.fieldStructure.length > 1 ? this._getNestedData : this._getFlatData;

		this.setFieldValue = this.fieldStructure.length > 1 ? this._setNestedData : this._setFlatData;
	};

	//register column position with column manager

	Column.prototype.registerColumnPosition = function (column) {

		this.parent.registerColumnPosition(column);
	};

	//register column position with column manager

	Column.prototype.registerColumnField = function (column) {

		this.parent.registerColumnField(column);
	};

	//trigger position registration

	Column.prototype.reRegisterPosition = function () {

		if (this.isGroup) {

			this.columns.forEach(function (column) {

				column.reRegisterPosition();
			});
		} else {

			this.registerColumnPosition(this);
		}
	};

	Column.prototype._mapDepricatedFunctionality = function () {

		if (typeof this.definition.hideInHtml !== "undefined") {

			this.definition.htmlOutput = !this.definition.hideInHtml;

			console.warn("hideInHtml column definition property is deprecated, you should now use htmlOutput");
		}

		if (typeof this.definition.align !== "undefined") {

			this.definition.hozAlign = this.definition.align;

			console.warn("align column definition property is deprecated, you should now use hozAlign");
		}

		if (typeof this.definition.downloadTitle !== "undefined") {

			this.definition.titleDownload = this.definition.downloadTitle;

			console.warn("downloadTitle definition property is deprecated, you should now use titleDownload");
		}
	};

	Column.prototype.setTooltip = function () {

		var self = this,
		    def = self.definition;

		//set header tooltips

		var tooltip = def.headerTooltip || def.tooltip === false ? def.headerTooltip : self.table.options.tooltipsHeader;

		if (tooltip) {

			if (tooltip === true) {

				if (def.field) {

					self.table.modules.localize.bind("columns|" + def.field, function (value) {

						self.element.setAttribute("title", value || def.title);
					});
				} else {

					self.element.setAttribute("title", def.title);
				}
			} else {

				if (typeof tooltip == "function") {

					tooltip = tooltip(self.getComponent());

					if (tooltip === false) {

						tooltip = "";
					}
				}

				self.element.setAttribute("title", tooltip);
			}
		} else {

			self.element.setAttribute("title", "");
		}
	};

	//build header element

	Column.prototype._buildHeader = function () {

		var self = this,
		    def = self.definition;

		while (self.element.firstChild) {
			self.element.removeChild(self.element.firstChild);
		}if (def.headerVertical) {

			self.element.classList.add("tabulator-col-vertical");

			if (def.headerVertical === "flip") {

				self.element.classList.add("tabulator-col-vertical-flip");
			}
		}

		self.contentElement = self._bindEvents();

		self.contentElement = self._buildColumnHeaderContent();

		self.element.appendChild(self.contentElement);

		if (self.isGroup) {

			self._buildGroupHeader();
		} else {

			self._buildColumnHeader();
		}

		self.setTooltip();

		//set resizable handles

		if (self.table.options.resizableColumns && self.table.modExists("resizeColumns")) {

			self.table.modules.resizeColumns.initializeColumn("header", self, self.element);
		}

		//set resizable handles

		if (def.headerFilter && self.table.modExists("filter") && self.table.modExists("edit")) {

			if (typeof def.headerFilterPlaceholder !== "undefined" && def.field) {

				self.table.modules.localize.setHeaderFilterColumnPlaceholder(def.field, def.headerFilterPlaceholder);
			}

			self.table.modules.filter.initializeColumn(self);
		}

		//set resizable handles

		if (self.table.modExists("frozenColumns")) {

			self.table.modules.frozenColumns.initializeColumn(self);
		}

		//set movable column

		if (self.table.options.movableColumns && !self.isGroup && self.table.modExists("moveColumn")) {

			self.table.modules.moveColumn.initializeColumn(self);
		}

		//set calcs column

		if ((def.topCalc || def.bottomCalc) && self.table.modExists("columnCalcs")) {

			self.table.modules.columnCalcs.initializeColumn(self);
		}

		//handle persistence

		if (self.table.modExists("persistence") && self.table.modules.persistence.config.columns) {

			self.table.modules.persistence.initializeColumn(self);
		}

		//update header tooltip on mouse enter

		self.element.addEventListener("mouseenter", function (e) {

			self.setTooltip();
		});
	};

	Column.prototype._bindEvents = function () {

		var self = this,
		    def = self.definition,
		    dblTap,
		    tapHold,
		    tap;

		//setup header click event bindings

		if (typeof def.headerClick == "function") {

			self.element.addEventListener("click", function (e) {
				def.headerClick(e, self.getComponent());
			});
		}

		if (typeof def.headerDblClick == "function") {

			self.element.addEventListener("dblclick", function (e) {
				def.headerDblClick(e, self.getComponent());
			});
		}

		if (typeof def.headerContext == "function") {

			self.element.addEventListener("contextmenu", function (e) {
				def.headerContext(e, self.getComponent());
			});
		}

		//setup header tap event bindings

		if (typeof def.headerTap == "function") {

			tap = false;

			self.element.addEventListener("touchstart", function (e) {

				tap = true;
			}, { passive: true });

			self.element.addEventListener("touchend", function (e) {

				if (tap) {

					def.headerTap(e, self.getComponent());
				}

				tap = false;
			});
		}

		if (typeof def.headerDblTap == "function") {

			dblTap = null;

			self.element.addEventListener("touchend", function (e) {

				if (dblTap) {

					clearTimeout(dblTap);

					dblTap = null;

					def.headerDblTap(e, self.getComponent());
				} else {

					dblTap = setTimeout(function () {

						clearTimeout(dblTap);

						dblTap = null;
					}, 300);
				}
			});
		}

		if (typeof def.headerTapHold == "function") {

			tapHold = null;

			self.element.addEventListener("touchstart", function (e) {

				clearTimeout(tapHold);

				tapHold = setTimeout(function () {

					clearTimeout(tapHold);

					tapHold = null;

					tap = false;

					def.headerTapHold(e, self.getComponent());
				}, 1000);
			}, { passive: true });

			self.element.addEventListener("touchend", function (e) {

				clearTimeout(tapHold);

				tapHold = null;
			});
		}

		//store column cell click event bindings

		if (typeof def.cellClick == "function") {

			self.cellEvents.cellClick = def.cellClick;
		}

		if (typeof def.cellDblClick == "function") {

			self.cellEvents.cellDblClick = def.cellDblClick;
		}

		if (typeof def.cellContext == "function") {

			self.cellEvents.cellContext = def.cellContext;
		}

		//store column mouse event bindings

		if (typeof def.cellMouseEnter == "function") {

			self.cellEvents.cellMouseEnter = def.cellMouseEnter;
		}

		if (typeof def.cellMouseLeave == "function") {

			self.cellEvents.cellMouseLeave = def.cellMouseLeave;
		}

		if (typeof def.cellMouseOver == "function") {

			self.cellEvents.cellMouseOver = def.cellMouseOver;
		}

		if (typeof def.cellMouseOut == "function") {

			self.cellEvents.cellMouseOut = def.cellMouseOut;
		}

		if (typeof def.cellMouseMove == "function") {

			self.cellEvents.cellMouseMove = def.cellMouseMove;
		}

		//setup column cell tap event bindings

		if (typeof def.cellTap == "function") {

			self.cellEvents.cellTap = def.cellTap;
		}

		if (typeof def.cellDblTap == "function") {

			self.cellEvents.cellDblTap = def.cellDblTap;
		}

		if (typeof def.cellTapHold == "function") {

			self.cellEvents.cellTapHold = def.cellTapHold;
		}

		//setup column cell edit callbacks

		if (typeof def.cellEdited == "function") {

			self.cellEvents.cellEdited = def.cellEdited;
		}

		if (typeof def.cellEditing == "function") {

			self.cellEvents.cellEditing = def.cellEditing;
		}

		if (typeof def.cellEditCancelled == "function") {

			self.cellEvents.cellEditCancelled = def.cellEditCancelled;
		}
	};

	//build header element for header

	Column.prototype._buildColumnHeader = function () {

		var self = this,
		    def = self.definition,
		    table = self.table,
		    sortable;

		//set column sorter

		if (table.modExists("sort")) {

			table.modules.sort.initializeColumn(self, self.contentElement);
		}

		//set column header context menu

		if ((def.headerContextMenu || def.headerMenu) && table.modExists("menu")) {

			table.modules.menu.initializeColumnHeader(self);
		}

		//set column formatter

		if (table.modExists("format")) {

			table.modules.format.initializeColumn(self);
		}

		//set column editor

		if (typeof def.editor != "undefined" && table.modExists("edit")) {

			table.modules.edit.initializeColumn(self);
		}

		//set colum validator

		if (typeof def.validator != "undefined" && table.modExists("validate")) {

			table.modules.validate.initializeColumn(self);
		}

		//set column mutator

		if (table.modExists("mutator")) {

			table.modules.mutator.initializeColumn(self);
		}

		//set column accessor

		if (table.modExists("accessor")) {

			table.modules.accessor.initializeColumn(self);
		}

		//set respoviveLayout

		if (_typeof(table.options.responsiveLayout) && table.modExists("responsiveLayout")) {

			table.modules.responsiveLayout.initializeColumn(self);
		}

		//set column visibility

		if (typeof def.visible != "undefined") {

			if (def.visible) {

				self.show(true);
			} else {

				self.hide(true);
			}
		}

		//asign additional css classes to column header

		if (def.cssClass) {

			var classeNames = def.cssClass.split(" ");

			classeNames.forEach(function (className) {

				self.element.classList.add(className);
			});
		}

		if (def.field) {

			this.element.setAttribute("tabulator-field", def.field);
		}

		//set min width if present

		self.setMinWidth(typeof def.minWidth == "undefined" ? self.table.options.columnMinWidth : parseInt(def.minWidth));

		self.reinitializeWidth();

		//set tooltip if present

		self.tooltip = self.definition.tooltip || self.definition.tooltip === false ? self.definition.tooltip : self.table.options.tooltips;

		//set orizontal text alignment

		self.hozAlign = typeof self.definition.hozAlign == "undefined" ? self.table.options.cellHozAlign : self.definition.hozAlign;

		self.vertAlign = typeof self.definition.vertAlign == "undefined" ? self.table.options.cellVertAlign : self.definition.vertAlign;
	};

	Column.prototype._buildColumnHeaderContent = function () {

		var def = this.definition,
		    table = this.table;

		var contentElement = document.createElement("div");

		contentElement.classList.add("tabulator-col-content");

		this.titleElement = this._buildColumnHeaderTitle();

		contentElement.appendChild(this.titleElement);

		return contentElement;
	};

	//build title element of column

	Column.prototype._buildColumnHeaderTitle = function () {

		var self = this,
		    def = self.definition,
		    table = self.table,
		    title;

		var titleHolderElement = document.createElement("div");

		titleHolderElement.classList.add("tabulator-col-title");

		if (def.editableTitle) {

			var titleElement = document.createElement("input");

			titleElement.classList.add("tabulator-title-editor");

			titleElement.addEventListener("click", function (e) {

				e.stopPropagation();

				titleElement.focus();
			});

			titleElement.addEventListener("change", function () {

				def.title = titleElement.value;

				table.options.columnTitleChanged.call(self.table, self.getComponent());
			});

			titleHolderElement.appendChild(titleElement);

			if (def.field) {

				table.modules.localize.bind("columns|" + def.field, function (text) {

					titleElement.value = text || def.title || "&nbsp;";
				});
			} else {

				titleElement.value = def.title || "&nbsp;";
			}
		} else {

			if (def.field) {

				table.modules.localize.bind("columns|" + def.field, function (text) {

					self._formatColumnHeaderTitle(titleHolderElement, text || def.title || "&nbsp;");
				});
			} else {

				self._formatColumnHeaderTitle(titleHolderElement, def.title || "&nbsp;");
			}
		}

		return titleHolderElement;
	};

	Column.prototype._formatColumnHeaderTitle = function (el, title) {
		var _this5 = this;

		var formatter, contents, params, mockCell, onRendered;

		if (this.definition.titleFormatter && this.table.modExists("format")) {

			formatter = this.table.modules.format.getFormatter(this.definition.titleFormatter);

			onRendered = function onRendered(callback) {

				_this5.titleFormatterRendered = callback;
			};

			mockCell = {

				getValue: function getValue() {

					return title;
				},

				getElement: function getElement() {

					return el;
				}

			};

			params = this.definition.titleFormatterParams || {};

			params = typeof params === "function" ? params() : params;

			contents = formatter.call(this.table.modules.format, mockCell, params, onRendered);

			switch (typeof contents === 'undefined' ? 'undefined' : _typeof(contents)) {

				case "object":

					if (contents instanceof Node) {

						el.appendChild(contents);
					} else {

						el.innerHTML = "";

						console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:", contents);
					}

					break;

				case "undefined":

				case "null":

					el.innerHTML = "";

					break;

				default:

					el.innerHTML = contents;

			}
		} else {

			el.innerHTML = title;
		}
	};

	//build header element for column group

	Column.prototype._buildGroupHeader = function () {
		var _this6 = this;

		this.element.classList.add("tabulator-col-group");

		this.element.setAttribute("role", "columngroup");

		this.element.setAttribute("aria-title", this.definition.title);

		//asign additional css classes to column header

		if (this.definition.cssClass) {

			var classeNames = this.definition.cssClass.split(" ");

			classeNames.forEach(function (className) {

				_this6.element.classList.add(className);
			});
		}

		//set column header context menu

		if ((this.definition.headerContextMenu || this.definition.headerMenu) && this.table.modExists("menu")) {

			this.table.modules.menu.initializeColumnHeader(this);
		}

		this.element.appendChild(this.groupElement);
	};

	//flat field lookup

	Column.prototype._getFlatData = function (data) {

		return data[this.field];
	};

	//nested field lookup

	Column.prototype._getNestedData = function (data) {

		var dataObj = data,
		    structure = this.fieldStructure,
		    length = structure.length,
		    output;

		for (var _i = 0; _i < length; _i++) {

			dataObj = dataObj[structure[_i]];

			output = dataObj;

			if (!dataObj) {

				break;
			}
		}

		return output;
	};

	//flat field set

	Column.prototype._setFlatData = function (data, value) {

		if (this.field) {

			data[this.field] = value;
		}
	};

	//nested field set

	Column.prototype._setNestedData = function (data, value) {

		var dataObj = data,
		    structure = this.fieldStructure,
		    length = structure.length;

		for (var _i2 = 0; _i2 < length; _i2++) {

			if (_i2 == length - 1) {

				dataObj[structure[_i2]] = value;
			} else {

				if (!dataObj[structure[_i2]]) {

					if (typeof value !== "undefined") {

						dataObj[structure[_i2]] = {};
					} else {

						break;
					}
				}

				dataObj = dataObj[structure[_i2]];
			}
		}
	};

	//attach column to this group

	Column.prototype.attachColumn = function (column) {

		var self = this;

		if (self.groupElement) {

			self.columns.push(column);

			self.groupElement.appendChild(column.getElement());
		} else {

			console.warn("Column Warning - Column being attached to another column instead of column group");
		}
	};

	//vertically align header in column

	Column.prototype.verticalAlign = function (alignment, height) {

		//calculate height of column header and group holder element

		var parentHeight = this.parent.isGroup ? this.parent.getGroupElement().clientHeight : height || this.parent.getHeadersElement().clientHeight;

		// var parentHeight = this.parent.isGroup ? this.parent.getGroupElement().clientHeight : this.parent.getHeadersElement().clientHeight;


		this.element.style.height = parentHeight + "px";

		if (this.isGroup) {

			this.groupElement.style.minHeight = parentHeight - this.contentElement.offsetHeight + "px";
		}

		//vertically align cell contents

		if (!this.isGroup && alignment !== "top") {

			if (alignment === "bottom") {

				this.element.style.paddingTop = this.element.clientHeight - this.contentElement.offsetHeight + "px";
			} else {

				this.element.style.paddingTop = (this.element.clientHeight - this.contentElement.offsetHeight) / 2 + "px";
			}
		}

		this.columns.forEach(function (column) {

			column.verticalAlign(alignment);
		});
	};

	//clear vertical alignmenet

	Column.prototype.clearVerticalAlign = function () {

		this.element.style.paddingTop = "";

		this.element.style.height = "";

		this.element.style.minHeight = "";

		this.groupElement.style.minHeight = "";

		this.columns.forEach(function (column) {

			column.clearVerticalAlign();
		});
	};

	Column.prototype.bindModuleColumns = function () {

		//check if rownum formatter is being used on a column

		if (this.definition.formatter == "rownum") {

			this.table.rowManager.rowNumColumn = this;
		}
	};

	//// Retreive Column Information ////


	//return column header element

	Column.prototype.getElement = function () {

		return this.element;
	};

	//return colunm group element

	Column.prototype.getGroupElement = function () {

		return this.groupElement;
	};

	//return field name

	Column.prototype.getField = function () {

		return this.field;
	};

	//return the first column in a group

	Column.prototype.getFirstColumn = function () {

		if (!this.isGroup) {

			return this;
		} else {

			if (this.columns.length) {

				return this.columns[0].getFirstColumn();
			} else {

				return false;
			}
		}
	};

	//return the last column in a group

	Column.prototype.getLastColumn = function () {

		if (!this.isGroup) {

			return this;
		} else {

			if (this.columns.length) {

				return this.columns[this.columns.length - 1].getLastColumn();
			} else {

				return false;
			}
		}
	};

	//return all columns in a group

	Column.prototype.getColumns = function () {

		return this.columns;
	};

	//return all columns in a group

	Column.prototype.getCells = function () {

		return this.cells;
	};

	//retreive the top column in a group of columns

	Column.prototype.getTopColumn = function () {

		if (this.parent.isGroup) {

			return this.parent.getTopColumn();
		} else {

			return this;
		}
	};

	//return column definition object

	Column.prototype.getDefinition = function (updateBranches) {

		var colDefs = [];

		if (this.isGroup && updateBranches) {

			this.columns.forEach(function (column) {

				colDefs.push(column.getDefinition(true));
			});

			this.definition.columns = colDefs;
		}

		return this.definition;
	};

	//////////////////// Actions ////////////////////


	Column.prototype.checkColumnVisibility = function () {

		var visible = false;

		this.columns.forEach(function (column) {

			if (column.visible) {

				visible = true;
			}
		});

		if (visible) {

			this.show();

			this.parent.table.options.columnVisibilityChanged.call(this.table, this.getComponent(), false);
		} else {

			this.hide();
		}
	};

	//show column

	Column.prototype.show = function (silent, responsiveToggle) {

		if (!this.visible) {

			this.visible = true;

			this.element.style.display = "";

			if (this.parent.isGroup) {

				this.parent.checkColumnVisibility();
			}

			this.cells.forEach(function (cell) {

				cell.show();
			});

			if (!this.isGroup && this.width === null) {

				this.reinitializeWidth();
			}

			this.table.columnManager._verticalAlignHeaders();

			if (this.table.options.persistence && this.table.modExists("persistence", true) && this.table.modules.persistence.config.columns) {

				this.table.modules.persistence.save("columns");
			}

			if (!responsiveToggle && this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

				this.table.modules.responsiveLayout.updateColumnVisibility(this, this.visible);
			}

			if (!silent) {

				this.table.options.columnVisibilityChanged.call(this.table, this.getComponent(), true);
			}

			if (this.parent.isGroup) {

				this.parent.matchChildWidths();
			}
		}
	};

	//hide column

	Column.prototype.hide = function (silent, responsiveToggle) {

		if (this.visible) {

			this.visible = false;

			this.element.style.display = "none";

			this.table.columnManager._verticalAlignHeaders();

			if (this.parent.isGroup) {

				this.parent.checkColumnVisibility();
			}

			this.cells.forEach(function (cell) {

				cell.hide();
			});

			if (this.table.options.persistence && this.table.modExists("persistence", true) && this.table.modules.persistence.config.columns) {

				this.table.modules.persistence.save("columns");
			}

			if (!responsiveToggle && this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

				this.table.modules.responsiveLayout.updateColumnVisibility(this, this.visible);
			}

			if (!silent) {

				this.table.options.columnVisibilityChanged.call(this.table, this.getComponent(), false);
			}

			if (this.parent.isGroup) {

				this.parent.matchChildWidths();
			}
		}
	};

	Column.prototype.matchChildWidths = function () {

		var childWidth = 0;

		if (this.contentElement && this.columns.length) {

			this.columns.forEach(function (column) {

				if (column.visible) {

					childWidth += column.getWidth();
				}
			});

			this.contentElement.style.maxWidth = childWidth - 1 + "px";

			if (this.parent.isGroup) {

				this.parent.matchChildWidths();
			}
		}
	};

	Column.prototype.setWidth = function (width) {

		this.widthFixed = true;

		this.setWidthActual(width);
	};

	Column.prototype.setWidthActual = function (width) {

		if (isNaN(width)) {

			width = Math.floor(this.table.element.clientWidth / 100 * parseInt(width));
		}

		width = Math.max(this.minWidth, width);

		this.width = width;

		this.widthStyled = width ? width + "px" : "";

		this.element.style.width = this.widthStyled;

		if (!this.isGroup) {

			this.cells.forEach(function (cell) {

				cell.setWidth();
			});
		}

		if (this.parent.isGroup) {

			this.parent.matchChildWidths();
		}

		//set resizable handles

		if (this.table.modExists("frozenColumns")) {

			this.table.modules.frozenColumns.layout();
		}
	};

	Column.prototype.checkCellHeights = function () {

		var rows = [];

		this.cells.forEach(function (cell) {

			if (cell.row.heightInitialized) {

				if (cell.row.getElement().offsetParent !== null) {

					rows.push(cell.row);

					cell.row.clearCellHeight();
				} else {

					cell.row.heightInitialized = false;
				}
			}
		});

		rows.forEach(function (row) {

			row.calcHeight();
		});

		rows.forEach(function (row) {

			row.setCellHeight();
		});
	};

	Column.prototype.getWidth = function () {

		var width = 0;

		if (this.isGroup) {

			this.columns.forEach(function (column) {

				if (column.visible) {

					width += column.getWidth();
				}
			});
		} else {

			width = this.width;
		}

		return width;
	};

	Column.prototype.getHeight = function () {

		return this.element.offsetHeight;
	};

	Column.prototype.setMinWidth = function (minWidth) {

		this.minWidth = minWidth;

		this.minWidthStyled = minWidth ? minWidth + "px" : "";

		this.element.style.minWidth = this.minWidthStyled;

		this.cells.forEach(function (cell) {

			cell.setMinWidth();
		});
	};

	Column.prototype.delete = function () {
		var _this7 = this;

		return new Promise(function (resolve, reject) {

			if (_this7.isGroup) {

				_this7.columns.forEach(function (column) {

					column.delete();
				});
			}

			//cancel edit if column is currently being edited

			if (_this7.table.modExists("edit")) {

				if (_this7.table.modules.edit.currentCell.column === _this7) {

					_this7.table.modules.edit.cancelEdit();
				}
			}

			var cellCount = _this7.cells.length;

			for (var _i3 = 0; _i3 < cellCount; _i3++) {

				_this7.cells[0].delete();
			}

			_this7.element.parentNode.removeChild(_this7.element);

			_this7.table.columnManager.deregisterColumn(_this7);

			resolve();
		});
	};

	Column.prototype.columnRendered = function () {

		if (this.titleFormatterRendered) {

			this.titleFormatterRendered();
		}
	};

	Column.prototype.validate = function () {

		var invalid = [];

		this.cells.forEach(function (cell) {

			if (!cell.validate()) {

				invalid.push(cell.getComponent());
			}
		});

		return invalid.length ? invalid : true;
	};

	//////////////// Cell Management /////////////////


	//generate cell for this column

	Column.prototype.generateCell = function (row) {

		var self = this;

		var cell = new Cell(self, row);

		this.cells.push(cell);

		return cell;
	};

	Column.prototype.nextColumn = function () {

		var index = this.table.columnManager.findColumnIndex(this);

		return index > -1 ? this._nextVisibleColumn(index + 1) : false;
	};

	Column.prototype._nextVisibleColumn = function (index) {

		var column = this.table.columnManager.getColumnByIndex(index);

		return !column || column.visible ? column : this._nextVisibleColumn(index + 1);
	};

	Column.prototype.prevColumn = function () {

		var index = this.table.columnManager.findColumnIndex(this);

		return index > -1 ? this._prevVisibleColumn(index - 1) : false;
	};

	Column.prototype._prevVisibleColumn = function (index) {

		var column = this.table.columnManager.getColumnByIndex(index);

		return !column || column.visible ? column : this._prevVisibleColumn(index - 1);
	};

	Column.prototype.reinitializeWidth = function (force) {

		this.widthFixed = false;

		//set width if present

		if (typeof this.definition.width !== "undefined" && !force) {

			this.setWidth(this.definition.width);
		}

		//hide header filters to prevent them altering column width

		if (this.table.modExists("filter")) {

			this.table.modules.filter.hideHeaderFilterElements();
		}

		this.fitToData();

		//show header filters again after layout is complete

		if (this.table.modExists("filter")) {

			this.table.modules.filter.showHeaderFilterElements();
		}
	};

	//set column width to maximum cell width

	Column.prototype.fitToData = function () {

		var self = this;

		if (!this.widthFixed) {

			this.element.style.width = "";

			self.cells.forEach(function (cell) {

				cell.clearWidth();
			});
		}

		var maxWidth = this.element.offsetWidth;

		if (!self.width || !this.widthFixed) {

			self.cells.forEach(function (cell) {

				var width = cell.getWidth();

				if (width > maxWidth) {

					maxWidth = width;
				}
			});

			if (maxWidth) {

				self.setWidthActual(maxWidth + 1);
			}
		}
	};

	Column.prototype.updateDefinition = function (updates) {
		var _this8 = this;

		return new Promise(function (resolve, reject) {

			var definition;

			if (!_this8.isGroup) {

				definition = Object.assign({}, _this8.getDefinition());

				definition = Object.assign(definition, updates);

				_this8.table.columnManager.addColumn(definition, false, _this8).then(function (column) {

					if (definition.field == _this8.field) {

						_this8.field = false; //cleair field name to prevent deletion of duplicate column from arrays
					}

					_this8.delete().then(function () {

						resolve(column.getComponent());
					}).catch(function (err) {

						reject(err);
					});
				}).catch(function (err) {

					reject(err);
				});
			} else {

				console.warn("Column Update Error - The updateDefintion function is only available on columns, not column groups");

				reject("Column Update Error - The updateDefintion function is only available on columns, not column groups");
			}
		});
	};

	Column.prototype.deleteCell = function (cell) {

		var index = this.cells.indexOf(cell);

		if (index > -1) {

			this.cells.splice(index, 1);
		}
	};

	Column.prototype.defaultOptionList = ["title", "field", "columns", "visible", "align", "hozAlign", "vertAlign", "width", "minWidth", "widthGrow", "widthShrink", "resizable", "frozen", "responsive", "tooltip", "cssClass", "rowHandle", "hideInHtml", "print", "htmlOutput", "sorter", "sorterParams", "formatter", "formatterParams", "variableHeight", "editable", "editor", "editorParams", "validator", "mutator", "mutatorParams", "mutatorData", "mutatorDataParams", "mutatorEdit", "mutatorEditParams", "mutatorClipboard", "mutatorClipboardParams", "accessor", "accessorParams", "accessorData", "accessorDataParams", "accessorDownload", "accessorDownloadParams", "accessorClipboard", "accessorClipboardParams", "accessorPrint", "accessorPrintParams", "accessorHtmlOutput", "accessorHtmlOutputParams", "clipboard", "download", "downloadTitle", "topCalc", "topCalcParams", "topCalcFormatter", "topCalcFormatterParams", "bottomCalc", "bottomCalcParams", "bottomCalcFormatter", "bottomCalcFormatterParams", "cellClick", "cellDblClick", "cellContext", "cellTap", "cellDblTap", "cellTapHold", "cellMouseEnter", "cellMouseLeave", "cellMouseOver", "cellMouseOut", "cellMouseMove", "cellEditing", "cellEdited", "cellEditCancelled", "headerSort", "headerSortStartingDir", "headerSortTristate", "headerClick", "headerDblClick", "headerContext", "headerTap", "headerDblTap", "headerTapHold", "headerTooltip", "headerVertical", "editableTitle", "titleFormatter", "titleFormatterParams", "headerFilter", "headerFilterPlaceholder", "headerFilterParams", "headerFilterEmptyCheck", "headerFilterFunc", "headerFilterFuncParams", "headerFilterLiveFilter", "print", "headerContextMenu", "headerMenu", "contextMenu", "formatterPrint", "formatterPrintParams", "formatterClipboard", "formatterClipboardParams", "formatterHtmlOutput", "formatterHtmlOutputParams", "titlePrint", "titleClipboard", "titleHtmlOutput", "titleDownload"];

	//////////////// Event Bindings /////////////////


	//////////////// Object Generation /////////////////

	Column.prototype.getComponent = function () {

		if (!this.component) {

			this.component = new ColumnComponent(this);
		}

		return this.component;
	};

	var RowManager = function RowManager(table) {

		this.table = table;

		this.element = this.createHolderElement(); //containing element

		this.tableElement = this.createTableElement(); //table element

		this.heightFixer = this.createTableElement(); //table element

		this.columnManager = null; //hold column manager object

		this.height = 0; //hold height of table element


		this.firstRender = false; //handle first render

		this.renderMode = "virtual"; //current rendering mode

		this.fixedHeight = false; //current rendering mode


		this.rows = []; //hold row data objects

		this.activeRows = []; //rows currently available to on display in the table

		this.activeRowsCount = 0; //count of active rows


		this.displayRows = []; //rows currently on display in the table

		this.displayRowsCount = 0; //count of display rows


		this.scrollTop = 0;

		this.scrollLeft = 0;

		this.vDomRowHeight = 20; //approximation of row heights for padding


		this.vDomTop = 0; //hold position for first rendered row in the virtual DOM

		this.vDomBottom = 0; //hold possition for last rendered row in the virtual DOM


		this.vDomScrollPosTop = 0; //last scroll position of the vDom top;

		this.vDomScrollPosBottom = 0; //last scroll position of the vDom bottom;


		this.vDomTopPad = 0; //hold value of padding for top of virtual DOM

		this.vDomBottomPad = 0; //hold value of padding for bottom of virtual DOM


		this.vDomMaxRenderChain = 90; //the maximum number of dom elements that can be rendered in 1 go


		this.vDomWindowBuffer = 0; //window row buffer before removing elements, to smooth scrolling


		this.vDomWindowMinTotalRows = 20; //minimum number of rows to be generated in virtual dom (prevent buffering issues on tables with tall rows)

		this.vDomWindowMinMarginRows = 5; //minimum number of rows to be generated in virtual dom margin


		this.vDomTopNewRows = []; //rows to normalize after appending to optimize render speed

		this.vDomBottomNewRows = []; //rows to normalize after appending to optimize render speed


		this.rowNumColumn = false; //hold column component for row number column


		this.redrawBlock = false; //prevent redraws to allow multiple data manipulations becore continuing

		this.redrawBlockRestoreConfig = false; //store latest redraw function calls for when redraw is needed

		this.redrawBlockRederInPosition = false; //store latest redraw function calls for when redraw is needed
	};

	//////////////// Setup Functions /////////////////


	RowManager.prototype.createHolderElement = function () {

		var el = document.createElement("div");

		el.classList.add("tabulator-tableHolder");

		el.setAttribute("tabindex", 0);

		return el;
	};

	RowManager.prototype.createTableElement = function () {

		var el = document.createElement("div");

		el.classList.add("tabulator-table");

		return el;
	};

	//return containing element

	RowManager.prototype.getElement = function () {

		return this.element;
	};

	//return table element

	RowManager.prototype.getTableElement = function () {

		return this.tableElement;
	};

	//return position of row in table

	RowManager.prototype.getRowPosition = function (row, active) {

		if (active) {

			return this.activeRows.indexOf(row);
		} else {

			return this.rows.indexOf(row);
		}
	};

	//link to column manager

	RowManager.prototype.setColumnManager = function (manager) {

		this.columnManager = manager;
	};

	RowManager.prototype.initialize = function () {

		var self = this;

		self.setRenderMode();

		//initialize manager

		self.element.appendChild(self.tableElement);

		self.firstRender = true;

		//scroll header along with table body

		self.element.addEventListener("scroll", function () {

			var left = self.element.scrollLeft;

			//handle horizontal scrolling

			if (self.scrollLeft != left) {

				self.columnManager.scrollHorizontal(left);

				if (self.table.options.groupBy) {

					self.table.modules.groupRows.scrollHeaders(left);
				}

				if (self.table.modExists("columnCalcs")) {

					self.table.modules.columnCalcs.scrollHorizontal(left);
				}

				self.table.options.scrollHorizontal(left);
			}

			self.scrollLeft = left;
		});

		//handle virtual dom scrolling

		if (this.renderMode === "virtual") {

			self.element.addEventListener("scroll", function () {

				var top = self.element.scrollTop;

				var dir = self.scrollTop > top;

				//handle verical scrolling

				if (self.scrollTop != top) {

					self.scrollTop = top;

					self.scrollVertical(dir);

					if (self.table.options.ajaxProgressiveLoad == "scroll") {

						self.table.modules.ajax.nextPage(self.element.scrollHeight - self.element.clientHeight - top);
					}

					self.table.options.scrollVertical(top);
				} else {

					self.scrollTop = top;
				}
			});
		}
	};

	////////////////// Row Manipulation //////////////////


	RowManager.prototype.findRow = function (subject) {

		var self = this;

		if ((typeof subject === 'undefined' ? 'undefined' : _typeof(subject)) == "object") {

			if (subject instanceof Row) {

				//subject is row element

				return subject;
			} else if (subject instanceof RowComponent) {

				//subject is public row component

				return subject._getSelf() || false;
			} else if (typeof HTMLElement !== "undefined" && subject instanceof HTMLElement) {

				//subject is a HTML element of the row

				var match = self.rows.find(function (row) {

					return row.element === subject;
				});

				return match || false;
			}
		} else if (typeof subject == "undefined" || subject === null) {

			return false;
		} else {

			//subject should be treated as the index of the row

			var _match = self.rows.find(function (row) {

				return row.data[self.table.options.index] == subject;
			});

			return _match || false;
		}

		//catch all for any other type of input


		return false;
	};

	RowManager.prototype.getRowFromDataObject = function (data) {

		var match = this.rows.find(function (row) {

			return row.data === data;
		});

		return match || false;
	};

	RowManager.prototype.getRowFromPosition = function (position, active) {

		if (active) {

			return this.activeRows[position];
		} else {

			return this.rows[position];
		}
	};

	RowManager.prototype.scrollToRow = function (row, position, ifVisible) {
		var _this9 = this;

		var rowIndex = this.getDisplayRows().indexOf(row),
		    rowEl = row.getElement(),
		    rowTop,
		    offset = 0;

		return new Promise(function (resolve, reject) {

			if (rowIndex > -1) {

				if (typeof position === "undefined") {

					position = _this9.table.options.scrollToRowPosition;
				}

				if (typeof ifVisible === "undefined") {

					ifVisible = _this9.table.options.scrollToRowIfVisible;
				}

				if (position === "nearest") {

					switch (_this9.renderMode) {

						case "classic":

							rowTop = Tabulator.prototype.helpers.elOffset(rowEl).top;

							position = Math.abs(_this9.element.scrollTop - rowTop) > Math.abs(_this9.element.scrollTop + _this9.element.clientHeight - rowTop) ? "bottom" : "top";

							break;

						case "virtual":

							position = Math.abs(_this9.vDomTop - rowIndex) > Math.abs(_this9.vDomBottom - rowIndex) ? "bottom" : "top";

							break;

					}
				}

				//check row visibility

				if (!ifVisible) {

					if (Tabulator.prototype.helpers.elVisible(rowEl)) {

						offset = Tabulator.prototype.helpers.elOffset(rowEl).top - Tabulator.prototype.helpers.elOffset(_this9.element).top;

						if (offset > 0 && offset < _this9.element.clientHeight - rowEl.offsetHeight) {

							return false;
						}
					}
				}

				//scroll to row

				switch (_this9.renderMode) {

					case "classic":

						_this9.element.scrollTop = Tabulator.prototype.helpers.elOffset(rowEl).top - Tabulator.prototype.helpers.elOffset(_this9.element).top + _this9.element.scrollTop;

						break;

					case "virtual":

						_this9._virtualRenderFill(rowIndex, true);

						break;

				}

				//align to correct position

				switch (position) {

					case "middle":

					case "center":

						if (_this9.element.scrollHeight - _this9.element.scrollTop == _this9.element.clientHeight) {

							_this9.element.scrollTop = _this9.element.scrollTop + (rowEl.offsetTop - _this9.element.scrollTop) - (_this9.element.scrollHeight - rowEl.offsetTop) / 2;
						} else {

							_this9.element.scrollTop = _this9.element.scrollTop - _this9.element.clientHeight / 2;
						}

						break;

					case "bottom":

						if (_this9.element.scrollHeight - _this9.element.scrollTop == _this9.element.clientHeight) {

							_this9.element.scrollTop = _this9.element.scrollTop - (_this9.element.scrollHeight - rowEl.offsetTop) + rowEl.offsetHeight;
						} else {

							_this9.element.scrollTop = _this9.element.scrollTop - _this9.element.clientHeight + rowEl.offsetHeight;
						}

						break;

				}

				resolve();
			} else {

				console.warn("Scroll Error - Row not visible");

				reject("Scroll Error - Row not visible");
			}
		});
	};

	////////////////// Data Handling //////////////////


	RowManager.prototype.setData = function (data, renderInPosition, columnsChanged) {
		var _this10 = this;

		var self = this;

		return new Promise(function (resolve, reject) {

			if (renderInPosition && _this10.getDisplayRows().length) {

				if (self.table.options.pagination) {

					self._setDataActual(data, true);
				} else {

					_this10.reRenderInPosition(function () {

						self._setDataActual(data);
					});
				}
			} else {

				if (_this10.table.options.autoColumns && columnsChanged) {

					_this10.table.columnManager.generateColumnsFromRowData(data);
				}

				_this10.resetScroll();

				_this10._setDataActual(data);
			}

			resolve();
		});
	};

	RowManager.prototype._setDataActual = function (data, renderInPosition) {

		var self = this;

		self.table.options.dataLoading.call(this.table, data);

		this._wipeElements();

		if (this.table.options.history && this.table.modExists("history")) {

			this.table.modules.history.clear();
		}

		if (Array.isArray(data)) {

			if (this.table.modExists("selectRow")) {

				this.table.modules.selectRow.clearSelectionData();
			}

			if (this.table.options.reactiveData && this.table.modExists("reactiveData", true)) {

				this.table.modules.reactiveData.watchData(data);
			}

			data.forEach(function (def, i) {

				if (def && (typeof def === 'undefined' ? 'undefined' : _typeof(def)) === "object") {

					var row = new Row(def, self);

					self.rows.push(row);
				} else {

					console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:", def);
				}
			});

			self.table.options.dataLoaded.call(this.table, data);

			self.refreshActiveData(false, false, renderInPosition);
		} else {

			console.error("Data Loading Error - Unable to process data due to invalid data type \nExpecting: array \nReceived: ", typeof data === 'undefined' ? 'undefined' : _typeof(data), "\nData:     ", data);
		}
	};

	RowManager.prototype._wipeElements = function () {

		this.rows.forEach(function (row) {

			row.wipe();
		});

		if (this.table.options.groupBy && this.table.modExists("groupRows")) {

			this.table.modules.groupRows.wipe();
		}

		this.rows = [];
	};

	RowManager.prototype.deleteRow = function (row, blockRedraw) {

		var allIndex = this.rows.indexOf(row),
		    activeIndex = this.activeRows.indexOf(row);

		if (activeIndex > -1) {

			this.activeRows.splice(activeIndex, 1);
		}

		if (allIndex > -1) {

			this.rows.splice(allIndex, 1);
		}

		this.setActiveRows(this.activeRows);

		this.displayRowIterator(function (rows) {

			var displayIndex = rows.indexOf(row);

			if (displayIndex > -1) {

				rows.splice(displayIndex, 1);
			}
		});

		if (!blockRedraw) {

			this.reRenderInPosition();
		}

		this.regenerateRowNumbers();

		this.table.options.rowDeleted.call(this.table, row.getComponent());

		this.table.options.dataEdited.call(this.table, this.getData());

		if (this.table.options.groupBy && this.table.modExists("groupRows")) {

			this.table.modules.groupRows.updateGroupRows(true);
		} else if (this.table.options.pagination && this.table.modExists("page")) {

			this.refreshActiveData(false, false, true);
		} else {

			if (this.table.options.pagination && this.table.modExists("page")) {

				this.refreshActiveData("page");
			}
		}
	};

	RowManager.prototype.addRow = function (data, pos, index, blockRedraw) {

		var row = this.addRowActual(data, pos, index, blockRedraw);

		if (this.table.options.history && this.table.modExists("history")) {

			this.table.modules.history.action("rowAdd", row, { data: data, pos: pos, index: index });
		}

		return row;
	};

	//add multiple rows

	RowManager.prototype.addRows = function (data, pos, index) {
		var _this11 = this;

		var self = this,
		    length = 0,
		    rows = [];

		return new Promise(function (resolve, reject) {

			pos = _this11.findAddRowPos(pos);

			if (!Array.isArray(data)) {

				data = [data];
			}

			length = data.length - 1;

			if (typeof index == "undefined" && pos || typeof index !== "undefined" && !pos) {

				data.reverse();
			}

			data.forEach(function (item, i) {

				var row = self.addRow(item, pos, index, true);

				rows.push(row);
			});

			if (_this11.table.options.groupBy && _this11.table.modExists("groupRows")) {

				_this11.table.modules.groupRows.updateGroupRows(true);
			} else if (_this11.table.options.pagination && _this11.table.modExists("page")) {

				_this11.refreshActiveData(false, false, true);
			} else {

				_this11.reRenderInPosition();
			}

			//recalc column calculations if present

			if (_this11.table.modExists("columnCalcs")) {

				_this11.table.modules.columnCalcs.recalc(_this11.table.rowManager.activeRows);
			}

			_this11.regenerateRowNumbers();

			resolve(rows);
		});
	};

	RowManager.prototype.findAddRowPos = function (pos) {

		if (typeof pos === "undefined") {

			pos = this.table.options.addRowPos;
		}

		if (pos === "pos") {

			pos = true;
		}

		if (pos === "bottom") {

			pos = false;
		}

		return pos;
	};

	RowManager.prototype.addRowActual = function (data, pos, index, blockRedraw) {

		var row = data instanceof Row ? data : new Row(data || {}, this),
		    top = this.findAddRowPos(pos),
		    allIndex = -1,
		    activeIndex,
		    dispRows;

		if (!index && this.table.options.pagination && this.table.options.paginationAddRow == "page") {

			dispRows = this.getDisplayRows();

			if (top) {

				if (dispRows.length) {

					index = dispRows[0];
				} else {

					if (this.activeRows.length) {

						index = this.activeRows[this.activeRows.length - 1];

						top = false;
					}
				}
			} else {

				if (dispRows.length) {

					index = dispRows[dispRows.length - 1];

					top = dispRows.length < this.table.modules.page.getPageSize() ? false : true;
				}
			}
		}

		if (typeof index !== "undefined") {

			index = this.findRow(index);
		}

		if (this.table.options.groupBy && this.table.modExists("groupRows")) {

			this.table.modules.groupRows.assignRowToGroup(row);

			var groupRows = row.getGroup().rows;

			if (groupRows.length > 1) {

				if (!index || index && groupRows.indexOf(index) == -1) {

					if (top) {

						if (groupRows[0] !== row) {

							index = groupRows[0];

							this._moveRowInArray(row.getGroup().rows, row, index, !top);
						}
					} else {

						if (groupRows[groupRows.length - 1] !== row) {

							index = groupRows[groupRows.length - 1];

							this._moveRowInArray(row.getGroup().rows, row, index, !top);
						}
					}
				} else {

					this._moveRowInArray(row.getGroup().rows, row, index, !top);
				}
			}
		}

		if (index) {

			allIndex = this.rows.indexOf(index);
		}

		if (index && allIndex > -1) {

			activeIndex = this.activeRows.indexOf(index);

			this.displayRowIterator(function (rows) {

				var displayIndex = rows.indexOf(index);

				if (displayIndex > -1) {

					rows.splice(top ? displayIndex : displayIndex + 1, 0, row);
				}
			});

			if (activeIndex > -1) {

				this.activeRows.splice(top ? activeIndex : activeIndex + 1, 0, row);
			}

			this.rows.splice(top ? allIndex : allIndex + 1, 0, row);
		} else {

			if (top) {

				this.displayRowIterator(function (rows) {

					rows.unshift(row);
				});

				this.activeRows.unshift(row);

				this.rows.unshift(row);
			} else {

				this.displayRowIterator(function (rows) {

					rows.push(row);
				});

				this.activeRows.push(row);

				this.rows.push(row);
			}
		}

		this.setActiveRows(this.activeRows);

		this.table.options.rowAdded.call(this.table, row.getComponent());

		this.table.options.dataEdited.call(this.table, this.getData());

		if (!blockRedraw) {

			this.reRenderInPosition();
		}

		return row;
	};

	RowManager.prototype.moveRow = function (from, to, after) {

		if (this.table.options.history && this.table.modExists("history")) {

			this.table.modules.history.action("rowMove", from, { posFrom: this.getRowPosition(from), posTo: this.getRowPosition(to), to: to, after: after });
		}

		this.moveRowActual(from, to, after);

		this.regenerateRowNumbers();

		this.table.options.rowMoved.call(this.table, from.getComponent());
	};

	RowManager.prototype.moveRowActual = function (from, to, after) {
		var _this12 = this;

		this._moveRowInArray(this.rows, from, to, after);

		this._moveRowInArray(this.activeRows, from, to, after);

		this.displayRowIterator(function (rows) {

			_this12._moveRowInArray(rows, from, to, after);
		});

		if (this.table.options.groupBy && this.table.modExists("groupRows")) {

			if (!after && to instanceof Group) {

				to = this.table.rowManager.prevDisplayRow(from) || to;
			}

			var toGroup = to.getGroup();

			var fromGroup = from.getGroup();

			if (toGroup === fromGroup) {

				this._moveRowInArray(toGroup.rows, from, to, after);
			} else {

				if (fromGroup) {

					fromGroup.removeRow(from);
				}

				toGroup.insertRow(from, to, after);
			}
		}
	};

	RowManager.prototype._moveRowInArray = function (rows, from, to, after) {

		var fromIndex, toIndex, start, end;

		if (from !== to) {

			fromIndex = rows.indexOf(from);

			if (fromIndex > -1) {

				rows.splice(fromIndex, 1);

				toIndex = rows.indexOf(to);

				if (toIndex > -1) {

					if (after) {

						rows.splice(toIndex + 1, 0, from);
					} else {

						rows.splice(toIndex, 0, from);
					}
				} else {

					rows.splice(fromIndex, 0, from);
				}
			}

			//restyle rows

			if (rows === this.getDisplayRows()) {

				start = fromIndex < toIndex ? fromIndex : toIndex;

				end = toIndex > fromIndex ? toIndex : fromIndex + 1;

				for (var _i4 = start; _i4 <= end; _i4++) {

					if (rows[_i4]) {

						this.styleRow(rows[_i4], _i4);
					}
				}
			}
		}
	};

	RowManager.prototype.clearData = function () {

		this.setData([]);
	};

	RowManager.prototype.getRowIndex = function (row) {

		return this.findRowIndex(row, this.rows);
	};

	RowManager.prototype.getDisplayRowIndex = function (row) {

		var index = this.getDisplayRows().indexOf(row);

		return index > -1 ? index : false;
	};

	RowManager.prototype.nextDisplayRow = function (row, rowOnly) {

		var index = this.getDisplayRowIndex(row),
		    nextRow = false;

		if (index !== false && index < this.displayRowsCount - 1) {

			nextRow = this.getDisplayRows()[index + 1];
		}

		if (nextRow && (!(nextRow instanceof Row) || nextRow.type != "row")) {

			return this.nextDisplayRow(nextRow, rowOnly);
		}

		return nextRow;
	};

	RowManager.prototype.prevDisplayRow = function (row, rowOnly) {

		var index = this.getDisplayRowIndex(row),
		    prevRow = false;

		if (index) {

			prevRow = this.getDisplayRows()[index - 1];
		}

		if (rowOnly && prevRow && (!(prevRow instanceof Row) || prevRow.type != "row")) {

			return this.prevDisplayRow(prevRow, rowOnly);
		}

		return prevRow;
	};

	RowManager.prototype.findRowIndex = function (row, list) {

		var rowIndex;

		row = this.findRow(row);

		if (row) {

			rowIndex = list.indexOf(row);

			if (rowIndex > -1) {

				return rowIndex;
			}
		}

		return false;
	};

	RowManager.prototype.getData = function (active, transform) {

		var output = [],
		    rows = this.getRows(active);

		rows.forEach(function (row) {

			if (row.type == "row") {

				output.push(row.getData(transform || "data"));
			}
		});

		return output;
	};

	RowManager.prototype.getComponents = function (active) {

		var output = [],
		    rows = this.getRows(active);

		rows.forEach(function (row) {

			output.push(row.getComponent());
		});

		return output;
	};

	RowManager.prototype.getDataCount = function (active) {

		var rows = this.getRows(active);

		return rows.length;
	};

	RowManager.prototype._genRemoteRequest = function () {
		var _this13 = this;

		var table = this.table,
		    options = table.options,
		    params = {};

		if (table.modExists("page")) {

			//set sort data if defined

			if (options.ajaxSorting) {

				var sorters = this.table.modules.sort.getSort();

				sorters.forEach(function (item) {

					delete item.column;
				});

				params[this.table.modules.page.paginationDataSentNames.sorters] = sorters;
			}

			//set filter data if defined

			if (options.ajaxFiltering) {

				var filters = this.table.modules.filter.getFilters(true, true);

				params[this.table.modules.page.paginationDataSentNames.filters] = filters;
			}

			this.table.modules.ajax.setParams(params, true);
		}

		table.modules.ajax.sendRequest().then(function (data) {

			_this13._setDataActual(data, true);
		}).catch(function (e) {});
	};

	//choose the path to refresh data after a filter update

	RowManager.prototype.filterRefresh = function () {

		var table = this.table,
		    options = table.options,
		    left = this.scrollLeft;

		if (options.ajaxFiltering) {

			if (options.pagination == "remote" && table.modExists("page")) {

				table.modules.page.reset(true);

				table.modules.page.setPage(1).then(function () {}).catch(function () {});
			} else if (options.ajaxProgressiveLoad) {

				table.modules.ajax.loadData().then(function () {}).catch(function () {});
			} else {

				//assume data is url, make ajax call to url to get data

				this._genRemoteRequest();
			}
		} else {

			this.refreshActiveData("filter");
		}

		this.scrollHorizontal(left);
	};

	//choose the path to refresh data after a sorter update

	RowManager.prototype.sorterRefresh = function (loadOrignalData) {

		var table = this.table,
		    options = this.table.options,
		    left = this.scrollLeft;

		if (options.ajaxSorting) {

			if ((options.pagination == "remote" || options.progressiveLoad) && table.modExists("page")) {

				table.modules.page.reset(true);

				table.modules.page.setPage(1).then(function () {}).catch(function () {});
			} else if (options.ajaxProgressiveLoad) {

				table.modules.ajax.loadData().then(function () {}).catch(function () {});
			} else {

				//assume data is url, make ajax call to url to get data

				this._genRemoteRequest();
			}
		} else {

			this.refreshActiveData(loadOrignalData ? "filter" : "sort");
		}

		this.scrollHorizontal(left);
	};

	RowManager.prototype.scrollHorizontal = function (left) {

		this.scrollLeft = left;

		this.element.scrollLeft = left;

		if (this.table.options.groupBy) {

			this.table.modules.groupRows.scrollHeaders(left);
		}

		if (this.table.modExists("columnCalcs")) {

			this.table.modules.columnCalcs.scrollHorizontal(left);
		}
	};

	//set active data set

	RowManager.prototype.refreshActiveData = function (stage, skipStage, renderInPosition) {

		var self = this,
		    table = this.table,
		    cascadeOrder = ["all", "filter", "sort", "display", "freeze", "group", "tree", "page"],
		    displayIndex;

		if (this.redrawBlock) {

			if (!this.redrawBlockRestoreConfig || cascadeOrder.indexOf(stage) < cascadeOrder.indexOf(this.redrawBlockRestoreConfig.stage)) {

				this.redrawBlockRestoreConfig = {

					stage: stage,

					skipStage: skipStage,

					renderInPosition: renderInPosition

				};
			}

			return;
		} else {

			if (self.table.modExists("edit")) {

				self.table.modules.edit.cancelEdit();
			}

			if (!stage) {

				stage = "all";
			}

			if (table.options.selectable && !table.options.selectablePersistence && table.modExists("selectRow")) {

				table.modules.selectRow.deselectRows();
			}

			//cascade through data refresh stages

			switch (stage) {

				case "all":

				case "filter":

					if (!skipStage) {

						if (table.modExists("filter")) {

							self.setActiveRows(table.modules.filter.filter(self.rows));
						} else {

							self.setActiveRows(self.rows.slice(0));
						}
					} else {

						skipStage = false;
					}

				case "sort":

					if (!skipStage) {

						if (table.modExists("sort")) {

							table.modules.sort.sort(this.activeRows);
						}
					} else {

						skipStage = false;
					}

					//regenerate row numbers for row number formatter if in use

					this.regenerateRowNumbers();

				//generic stage to allow for pipeline trigger after the data manipulation stage

				case "display":

					this.resetDisplayRows();

				case "freeze":

					if (!skipStage) {

						if (this.table.modExists("frozenRows")) {

							if (table.modules.frozenRows.isFrozen()) {

								if (!table.modules.frozenRows.getDisplayIndex()) {

									table.modules.frozenRows.setDisplayIndex(this.getNextDisplayIndex());
								}

								displayIndex = table.modules.frozenRows.getDisplayIndex();

								displayIndex = self.setDisplayRows(table.modules.frozenRows.getRows(this.getDisplayRows(displayIndex - 1)), displayIndex);

								if (displayIndex !== true) {

									table.modules.frozenRows.setDisplayIndex(displayIndex);
								}
							}
						}
					} else {

						skipStage = false;
					}

				case "group":

					if (!skipStage) {

						if (table.options.groupBy && table.modExists("groupRows")) {

							if (!table.modules.groupRows.getDisplayIndex()) {

								table.modules.groupRows.setDisplayIndex(this.getNextDisplayIndex());
							}

							displayIndex = table.modules.groupRows.getDisplayIndex();

							displayIndex = self.setDisplayRows(table.modules.groupRows.getRows(this.getDisplayRows(displayIndex - 1)), displayIndex);

							if (displayIndex !== true) {

								table.modules.groupRows.setDisplayIndex(displayIndex);
							}
						}
					} else {

						skipStage = false;
					}

				case "tree":

					if (!skipStage) {

						if (table.options.dataTree && table.modExists("dataTree")) {

							if (!table.modules.dataTree.getDisplayIndex()) {

								table.modules.dataTree.setDisplayIndex(this.getNextDisplayIndex());
							}

							displayIndex = table.modules.dataTree.getDisplayIndex();

							displayIndex = self.setDisplayRows(table.modules.dataTree.getRows(this.getDisplayRows(displayIndex - 1)), displayIndex);

							if (displayIndex !== true) {

								table.modules.dataTree.setDisplayIndex(displayIndex);
							}
						}
					} else {

						skipStage = false;
					}

					if (table.options.pagination && table.modExists("page") && !renderInPosition) {

						if (table.modules.page.getMode() == "local") {

							table.modules.page.reset();
						}
					}

				case "page":

					if (!skipStage) {

						if (table.options.pagination && table.modExists("page")) {

							if (!table.modules.page.getDisplayIndex()) {

								table.modules.page.setDisplayIndex(this.getNextDisplayIndex());
							}

							displayIndex = table.modules.page.getDisplayIndex();

							if (table.modules.page.getMode() == "local") {

								table.modules.page.setMaxRows(this.getDisplayRows(displayIndex - 1).length);
							}

							displayIndex = self.setDisplayRows(table.modules.page.getRows(this.getDisplayRows(displayIndex - 1)), displayIndex);

							if (displayIndex !== true) {

								table.modules.page.setDisplayIndex(displayIndex);
							}
						}
					} else {

						skipStage = false;
					}

			}

			if (Tabulator.prototype.helpers.elVisible(self.element)) {

				if (renderInPosition) {

					self.reRenderInPosition();
				} else {

					self.renderTable();

					if (table.options.layoutColumnsOnNewData) {

						self.table.columnManager.redraw(true);
					}
				}
			}

			if (table.modExists("columnCalcs")) {

				table.modules.columnCalcs.recalc(this.activeRows);
			}
		}
	};

	//regenerate row numbers for row number formatter if in use

	RowManager.prototype.regenerateRowNumbers = function () {
		var _this14 = this;

		if (this.rowNumColumn) {

			this.activeRows.forEach(function (row) {

				var cell = row.getCell(_this14.rowNumColumn);

				if (cell) {

					cell._generateContents();
				}
			});
		}
	};

	RowManager.prototype.setActiveRows = function (activeRows) {

		this.activeRows = activeRows;

		this.activeRowsCount = this.activeRows.length;
	};

	//reset display rows array

	RowManager.prototype.resetDisplayRows = function () {

		this.displayRows = [];

		this.displayRows.push(this.activeRows.slice(0));

		this.displayRowsCount = this.displayRows[0].length;

		if (this.table.modExists("frozenRows")) {

			this.table.modules.frozenRows.setDisplayIndex(0);
		}

		if (this.table.options.groupBy && this.table.modExists("groupRows")) {

			this.table.modules.groupRows.setDisplayIndex(0);
		}

		if (this.table.options.pagination && this.table.modExists("page")) {

			this.table.modules.page.setDisplayIndex(0);
		}
	};

	RowManager.prototype.getNextDisplayIndex = function () {

		return this.displayRows.length;
	};

	//set display row pipeline data

	RowManager.prototype.setDisplayRows = function (displayRows, index) {

		var output = true;

		if (index && typeof this.displayRows[index] != "undefined") {

			this.displayRows[index] = displayRows;

			output = true;
		} else {

			this.displayRows.push(displayRows);

			output = index = this.displayRows.length - 1;
		}

		if (index == this.displayRows.length - 1) {

			this.displayRowsCount = this.displayRows[this.displayRows.length - 1].length;
		}

		return output;
	};

	RowManager.prototype.getDisplayRows = function (index) {

		if (typeof index == "undefined") {

			return this.displayRows.length ? this.displayRows[this.displayRows.length - 1] : [];
		} else {

			return this.displayRows[index] || [];
		}
	};

	RowManager.prototype.getVisibleRows = function (viewable) {

		var topEdge = this.element.scrollTop,
		    bottomEdge = this.element.clientHeight + topEdge,
		    topFound = false,
		    topRow = 0,
		    bottomRow = 0,
		    rows = this.getDisplayRows();

		if (viewable) {

			this.getDisplayRows();

			for (var i = this.vDomTop; i <= this.vDomBottom; i++) {

				if (rows[i]) {

					if (!topFound) {

						if (topEdge - rows[i].getElement().offsetTop >= 0) {

							topRow = i;
						} else {

							topFound = true;

							if (bottomEdge - rows[i].getElement().offsetTop >= 0) {

								bottomRow = i;
							} else {

								break;
							}
						}
					} else {

						if (bottomEdge - rows[i].getElement().offsetTop >= 0) {

							bottomRow = i;
						} else {

							break;
						}
					}
				}
			}
		} else {

			topRow = this.vDomTop;

			bottomRow = this.vDomBottom;
		}

		return rows.slice(topRow, bottomRow + 1);
	};

	//repeat action accross display rows

	RowManager.prototype.displayRowIterator = function (callback) {

		this.displayRows.forEach(callback);

		this.displayRowsCount = this.displayRows[this.displayRows.length - 1].length;
	};

	//return only actual rows (not group headers etc)

	RowManager.prototype.getRows = function (active) {

		var rows;

		switch (active) {

			case "active":

				rows = this.activeRows;

				break;

			case "display":

				rows = this.table.rowManager.getDisplayRows();

				break;

			case "visible":

				rows = this.getVisibleRows(true);

				break;

			default:

				rows = this.rows;

		}

		return rows;
	};

	///////////////// Table Rendering /////////////////


	//trigger rerender of table in current position

	RowManager.prototype.reRenderInPosition = function (callback) {

		if (this.getRenderMode() == "virtual") {

			if (this.redrawBlock) {

				if (callback) {

					callback();
				} else {

					this.redrawBlockRederInPosition = true;
				}
			} else {

				var scrollTop = this.element.scrollTop;

				var topRow = false;

				var topOffset = false;

				var left = this.scrollLeft;

				var rows = this.getDisplayRows();

				for (var i = this.vDomTop; i <= this.vDomBottom; i++) {

					if (rows[i]) {

						var diff = scrollTop - rows[i].getElement().offsetTop;

						if (topOffset === false || Math.abs(diff) < topOffset) {

							topOffset = diff;

							topRow = i;
						} else {

							break;
						}
					}
				}

				if (callback) {

					callback();
				}

				this._virtualRenderFill(topRow === false ? this.displayRowsCount - 1 : topRow, true, topOffset || 0);

				this.scrollHorizontal(left);
			}
		} else {

			this.renderTable();

			if (callback) {

				callback();
			}
		}
	};

	RowManager.prototype.setRenderMode = function () {

		if (this.table.options.virtualDom) {

			this.renderMode = "virtual";

			if (this.table.element.clientHeight || this.table.options.height) {

				this.fixedHeight = true;
			} else {

				this.fixedHeight = false;
			}
		} else {

			this.renderMode = "classic";
		}
	};

	RowManager.prototype.getRenderMode = function () {

		return this.renderMode;
	};

	RowManager.prototype.renderTable = function () {

		this.table.options.renderStarted.call(this.table);

		this.element.scrollTop = 0;

		switch (this.renderMode) {

			case "classic":

				this._simpleRender();

				break;

			case "virtual":

				this._virtualRenderFill();

				break;

		}

		if (this.firstRender) {

			if (this.displayRowsCount) {

				this.firstRender = false;

				this.table.modules.layout.layout();
			} else {

				this.renderEmptyScroll();
			}
		}

		if (this.table.modExists("frozenColumns")) {

			this.table.modules.frozenColumns.layout();
		}

		if (!this.displayRowsCount) {

			if (this.table.options.placeholder) {

				this.table.options.placeholder.setAttribute("tabulator-render-mode", this.renderMode);

				this.getElement().appendChild(this.table.options.placeholder);

				this.table.options.placeholder.style.width = this.table.columnManager.getWidth() + "px";
			}
		}

		this.table.options.renderComplete.call(this.table);
	};

	//simple render on heightless table

	RowManager.prototype._simpleRender = function () {

		this._clearVirtualDom();

		if (this.displayRowsCount) {

			this.checkClassicModeGroupHeaderWidth();
		} else {

			this.renderEmptyScroll();
		}
	};

	RowManager.prototype.checkClassicModeGroupHeaderWidth = function () {

		var self = this,
		    element = this.tableElement,
		    onlyGroupHeaders = true;

		self.getDisplayRows().forEach(function (row, index) {

			self.styleRow(row, index);

			element.appendChild(row.getElement());

			row.initialize(true);

			if (row.type !== "group") {

				onlyGroupHeaders = false;
			}
		});

		if (onlyGroupHeaders) {

			element.style.minWidth = self.table.columnManager.getWidth() + "px";
		} else {

			element.style.minWidth = "";
		}
	};

	//show scrollbars on empty table div

	RowManager.prototype.renderEmptyScroll = function () {

		if (this.table.options.placeholder) {

			this.tableElement.style.display = "none";
		} else {

			this.tableElement.style.minWidth = this.table.columnManager.getWidth() + "px";

			this.tableElement.style.minHeight = "1px";

			this.tableElement.style.visibility = "hidden";
		}
	};

	RowManager.prototype._clearVirtualDom = function () {

		var element = this.tableElement;

		if (this.table.options.placeholder && this.table.options.placeholder.parentNode) {

			this.table.options.placeholder.parentNode.removeChild(this.table.options.placeholder);
		}

		// element.children.detach();

		while (element.firstChild) {
			element.removeChild(element.firstChild);
		}element.style.paddingTop = "";

		element.style.paddingBottom = "";

		element.style.minWidth = "";

		element.style.minHeight = "";

		element.style.display = "";

		element.style.visibility = "";

		this.scrollTop = 0;

		this.scrollLeft = 0;

		this.vDomTop = 0;

		this.vDomBottom = 0;

		this.vDomTopPad = 0;

		this.vDomBottomPad = 0;
	};

	RowManager.prototype.styleRow = function (row, index) {

		var rowEl = row.getElement();

		if (index % 2) {

			rowEl.classList.add("tabulator-row-even");

			rowEl.classList.remove("tabulator-row-odd");
		} else {

			rowEl.classList.add("tabulator-row-odd");

			rowEl.classList.remove("tabulator-row-even");
		}
	};

	//full virtual render

	RowManager.prototype._virtualRenderFill = function (position, forceMove, offset) {

		var self = this,
		    element = self.tableElement,
		    holder = self.element,
		    topPad = 0,
		    rowsHeight = 0,
		    topPadHeight = 0,
		    i = 0,
		    onlyGroupHeaders = true,
		    rows = self.getDisplayRows();

		position = position || 0;

		offset = offset || 0;

		if (!position) {

			self._clearVirtualDom();
		} else {

			while (element.firstChild) {
				element.removeChild(element.firstChild);
			} //check if position is too close to bottom of table

			var heightOccupied = (self.displayRowsCount - position + 1) * self.vDomRowHeight;

			if (heightOccupied < self.height) {

				position -= Math.ceil((self.height - heightOccupied) / self.vDomRowHeight);

				if (position < 0) {

					position = 0;
				}
			}

			//calculate initial pad

			topPad = Math.min(Math.max(Math.floor(self.vDomWindowBuffer / self.vDomRowHeight), self.vDomWindowMinMarginRows), position);

			position -= topPad;
		}

		if (self.displayRowsCount && Tabulator.prototype.helpers.elVisible(self.element)) {

			self.vDomTop = position;

			self.vDomBottom = position - 1;

			while ((rowsHeight <= self.height + self.vDomWindowBuffer || i < self.vDomWindowMinTotalRows) && self.vDomBottom < self.displayRowsCount - 1) {

				var index = self.vDomBottom + 1,
				    row = rows[index],
				    rowHeight = 0;

				self.styleRow(row, index);

				element.appendChild(row.getElement());

				if (!row.initialized) {

					row.initialize(true);
				} else {

					if (!row.heightInitialized) {

						row.normalizeHeight(true);
					}
				}

				rowHeight = row.getHeight();

				if (i < topPad) {

					topPadHeight += rowHeight;
				} else {

					rowsHeight += rowHeight;
				}

				if (rowHeight > this.vDomWindowBuffer) {

					this.vDomWindowBuffer = rowHeight * 2;
				}

				if (row.type !== "group") {

					onlyGroupHeaders = false;
				}

				self.vDomBottom++;

				i++;
			}

			if (!position) {

				this.vDomTopPad = 0;

				//adjust rowheight to match average of rendered elements

				self.vDomRowHeight = Math.floor((rowsHeight + topPadHeight) / i);

				self.vDomBottomPad = self.vDomRowHeight * (self.displayRowsCount - self.vDomBottom - 1);

				self.vDomScrollHeight = topPadHeight + rowsHeight + self.vDomBottomPad - self.height;
			} else {

				self.vDomTopPad = !forceMove ? self.scrollTop - topPadHeight : self.vDomRowHeight * this.vDomTop + offset;

				self.vDomBottomPad = self.vDomBottom == self.displayRowsCount - 1 ? 0 : Math.max(self.vDomScrollHeight - self.vDomTopPad - rowsHeight - topPadHeight, 0);
			}

			element.style.paddingTop = self.vDomTopPad + "px";

			element.style.paddingBottom = self.vDomBottomPad + "px";

			if (forceMove) {

				this.scrollTop = self.vDomTopPad + topPadHeight + offset - (this.element.scrollWidth > this.element.clientWidth ? this.element.offsetHeight - this.element.clientHeight : 0);
			}

			this.scrollTop = Math.min(this.scrollTop, this.element.scrollHeight - this.height);

			//adjust for horizontal scrollbar if present (and not at top of table)

			if (this.element.scrollWidth > this.element.offsetWidth && forceMove) {

				this.scrollTop += this.element.offsetHeight - this.element.clientHeight;
			}

			this.vDomScrollPosTop = this.scrollTop;

			this.vDomScrollPosBottom = this.scrollTop;

			holder.scrollTop = this.scrollTop;

			element.style.minWidth = onlyGroupHeaders ? self.table.columnManager.getWidth() + "px" : "";

			if (self.table.options.groupBy) {

				if (self.table.modules.layout.getMode() != "fitDataFill" && self.displayRowsCount == self.table.modules.groupRows.countGroups()) {

					self.tableElement.style.minWidth = self.table.columnManager.getWidth();
				}
			}
		} else {

			this.renderEmptyScroll();
		}

		if (!this.fixedHeight) {

			this.adjustTableSize();
		}
	};

	//handle vertical scrolling

	RowManager.prototype.scrollVertical = function (dir) {

		var topDiff = this.scrollTop - this.vDomScrollPosTop;

		var bottomDiff = this.scrollTop - this.vDomScrollPosBottom;

		var margin = this.vDomWindowBuffer * 2;

		if (-topDiff > margin || bottomDiff > margin) {

			//if big scroll redraw table;

			var left = this.scrollLeft;

			this._virtualRenderFill(Math.floor(this.element.scrollTop / this.element.scrollHeight * this.displayRowsCount));

			this.scrollHorizontal(left);
		} else {

			if (dir) {

				//scrolling up

				if (topDiff < 0) {

					this._addTopRow(-topDiff);
				}

				if (bottomDiff < 0) {

					//hide bottom row if needed

					if (this.vDomScrollHeight - this.scrollTop > this.vDomWindowBuffer) {

						this._removeBottomRow(-bottomDiff);
					} else {

						this.vDomScrollPosBottom = this.scrollTop;
					}
				}
			} else {

				//scrolling down

				if (topDiff >= 0) {

					//hide top row if needed

					if (this.scrollTop > this.vDomWindowBuffer) {

						this._removeTopRow(topDiff);
					} else {

						this.vDomScrollPosTop = this.scrollTop;
					}
				}

				if (bottomDiff >= 0) {

					this._addBottomRow(bottomDiff);
				}
			}
		}
	};

	RowManager.prototype._addTopRow = function (topDiff) {
		var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;


		var table = this.tableElement,
		    rows = this.getDisplayRows();

		if (this.vDomTop) {

			var index = this.vDomTop - 1,
			    topRow = rows[index],
			    topRowHeight = topRow.getHeight() || this.vDomRowHeight;

			//hide top row if needed

			if (topDiff >= topRowHeight) {

				this.styleRow(topRow, index);

				table.insertBefore(topRow.getElement(), table.firstChild);

				if (!topRow.initialized || !topRow.heightInitialized) {

					this.vDomTopNewRows.push(topRow);

					if (!topRow.heightInitialized) {

						topRow.clearCellHeight();
					}
				}

				topRow.initialize();

				this.vDomTopPad -= topRowHeight;

				if (this.vDomTopPad < 0) {

					this.vDomTopPad = index * this.vDomRowHeight;
				}

				if (!index) {

					this.vDomTopPad = 0;
				}

				table.style.paddingTop = this.vDomTopPad + "px";

				this.vDomScrollPosTop -= topRowHeight;

				this.vDomTop--;
			}

			topDiff = -(this.scrollTop - this.vDomScrollPosTop);

			if (topRow.getHeight() > this.vDomWindowBuffer) {

				this.vDomWindowBuffer = topRow.getHeight() * 2;
			}

			if (i < this.vDomMaxRenderChain && this.vDomTop && topDiff >= (rows[this.vDomTop - 1].getHeight() || this.vDomRowHeight)) {

				this._addTopRow(topDiff, i + 1);
			} else {

				this._quickNormalizeRowHeight(this.vDomTopNewRows);
			}
		}
	};

	RowManager.prototype._removeTopRow = function (topDiff) {

		var table = this.tableElement,
		    topRow = this.getDisplayRows()[this.vDomTop],
		    topRowHeight = topRow.getHeight() || this.vDomRowHeight;

		if (topDiff >= topRowHeight) {

			var rowEl = topRow.getElement();

			rowEl.parentNode.removeChild(rowEl);

			this.vDomTopPad += topRowHeight;

			table.style.paddingTop = this.vDomTopPad + "px";

			this.vDomScrollPosTop += this.vDomTop ? topRowHeight : topRowHeight + this.vDomWindowBuffer;

			this.vDomTop++;

			topDiff = this.scrollTop - this.vDomScrollPosTop;

			this._removeTopRow(topDiff);
		}
	};

	RowManager.prototype._addBottomRow = function (bottomDiff) {
		var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;


		var table = this.tableElement,
		    rows = this.getDisplayRows();

		if (this.vDomBottom < this.displayRowsCount - 1) {

			var index = this.vDomBottom + 1,
			    bottomRow = rows[index],
			    bottomRowHeight = bottomRow.getHeight() || this.vDomRowHeight;

			//hide bottom row if needed

			if (bottomDiff >= bottomRowHeight) {

				this.styleRow(bottomRow, index);

				table.appendChild(bottomRow.getElement());

				if (!bottomRow.initialized || !bottomRow.heightInitialized) {

					this.vDomBottomNewRows.push(bottomRow);

					if (!bottomRow.heightInitialized) {

						bottomRow.clearCellHeight();
					}
				}

				bottomRow.initialize();

				this.vDomBottomPad -= bottomRowHeight;

				if (this.vDomBottomPad < 0 || index == this.displayRowsCount - 1) {

					this.vDomBottomPad = 0;
				}

				table.style.paddingBottom = this.vDomBottomPad + "px";

				this.vDomScrollPosBottom += bottomRowHeight;

				this.vDomBottom++;
			}

			bottomDiff = this.scrollTop - this.vDomScrollPosBottom;

			if (bottomRow.getHeight() > this.vDomWindowBuffer) {

				this.vDomWindowBuffer = bottomRow.getHeight() * 2;
			}

			if (i < this.vDomMaxRenderChain && this.vDomBottom < this.displayRowsCount - 1 && bottomDiff >= (rows[this.vDomBottom + 1].getHeight() || this.vDomRowHeight)) {

				this._addBottomRow(bottomDiff, i + 1);
			} else {

				this._quickNormalizeRowHeight(this.vDomBottomNewRows);
			}
		}
	};

	RowManager.prototype._removeBottomRow = function (bottomDiff) {

		var table = this.tableElement,
		    bottomRow = this.getDisplayRows()[this.vDomBottom],
		    bottomRowHeight = bottomRow.getHeight() || this.vDomRowHeight;

		if (bottomDiff >= bottomRowHeight) {

			var rowEl = bottomRow.getElement();

			if (rowEl.parentNode) {

				rowEl.parentNode.removeChild(rowEl);
			}

			this.vDomBottomPad += bottomRowHeight;

			if (this.vDomBottomPad < 0) {

				this.vDomBottomPad = 0;
			}

			table.style.paddingBottom = this.vDomBottomPad + "px";

			this.vDomScrollPosBottom -= bottomRowHeight;

			this.vDomBottom--;

			bottomDiff = -(this.scrollTop - this.vDomScrollPosBottom);

			this._removeBottomRow(bottomDiff);
		}
	};

	RowManager.prototype._quickNormalizeRowHeight = function (rows) {

		rows.forEach(function (row) {

			row.calcHeight();
		});

		rows.forEach(function (row) {

			row.setCellHeight();
		});

		rows.length = 0;
	};

	//normalize height of active rows

	RowManager.prototype.normalizeHeight = function () {

		this.activeRows.forEach(function (row) {

			row.normalizeHeight();
		});
	};

	//adjust the height of the table holder to fit in the Tabulator element

	RowManager.prototype.adjustTableSize = function () {

		var initialHeight = this.element.clientHeight,
		    modExists;

		if (this.renderMode === "virtual") {

			var otherHeight = this.columnManager.getElement().offsetHeight + (this.table.footerManager && !this.table.footerManager.external ? this.table.footerManager.getElement().offsetHeight : 0);

			if (this.fixedHeight) {

				this.element.style.minHeight = "calc(100% - " + otherHeight + "px)";

				this.element.style.height = "calc(100% - " + otherHeight + "px)";

				this.element.style.maxHeight = "calc(100% - " + otherHeight + "px)";
			} else {

				this.element.style.height = "";

				this.element.style.height = this.table.element.clientHeight - otherHeight + "px";

				this.element.scrollTop = this.scrollTop;
			}

			this.height = this.element.clientHeight;

			this.vDomWindowBuffer = this.table.options.virtualDomBuffer || this.height;

			//check if the table has changed size when dealing with variable height tables

			if (!this.fixedHeight && initialHeight != this.element.clientHeight) {

				modExists = this.table.modExists("resizeTable");

				if (modExists && !this.table.modules.resizeTable.autoResize || !modExists) {

					this.redraw();
				}
			}
		}
	};

	//renitialize all rows

	RowManager.prototype.reinitialize = function () {

		this.rows.forEach(function (row) {

			row.reinitialize();
		});
	};

	//prevent table from being redrawn

	RowManager.prototype.blockRedraw = function () {

		this.redrawBlock = true;

		this.redrawBlockRestoreConfig = false;
	};

	//restore table redrawing

	RowManager.prototype.restoreRedraw = function () {

		this.redrawBlock = false;

		if (this.redrawBlockRestoreConfig) {

			this.refreshActiveData(this.redrawBlockRestoreConfig.stage, this.redrawBlockRestoreConfig.skipStage, this.redrawBlockRestoreConfig.renderInPosition);

			this.redrawBlockRestoreConfig = false;
		} else {

			if (this.redrawBlockRederInPosition) {

				this.reRenderInPosition();
			}
		}

		this.redrawBlockRederInPosition = false;
	};

	//redraw table

	RowManager.prototype.redraw = function (force) {

		var pos = 0,
		    left = this.scrollLeft;

		this.adjustTableSize();

		this.table.tableWidth = this.table.element.clientWidth;

		if (!force) {

			if (this.renderMode == "classic") {

				if (this.table.options.groupBy) {

					this.refreshActiveData("group", false, false);
				} else {

					this._simpleRender();
				}
			} else {

				this.reRenderInPosition();

				this.scrollHorizontal(left);
			}

			if (!this.displayRowsCount) {

				if (this.table.options.placeholder) {

					this.getElement().appendChild(this.table.options.placeholder);
				}
			}
		} else {

			this.renderTable();
		}
	};

	RowManager.prototype.resetScroll = function () {

		this.element.scrollLeft = 0;

		this.element.scrollTop = 0;

		if (this.table.browser === "ie") {

			var event = document.createEvent("Event");

			event.initEvent("scroll", false, true);

			this.element.dispatchEvent(event);
		} else {

			this.element.dispatchEvent(new Event('scroll'));
		}
	};

	//public row object

	var RowComponent = function RowComponent(row) {

		this._row = row;
	};

	RowComponent.prototype.getData = function (transform) {

		return this._row.getData(transform);
	};

	RowComponent.prototype.getElement = function () {

		return this._row.getElement();
	};

	RowComponent.prototype.getCells = function () {

		var cells = [];

		this._row.getCells().forEach(function (cell) {

			cells.push(cell.getComponent());
		});

		return cells;
	};

	RowComponent.prototype.getCell = function (column) {

		var cell = this._row.getCell(column);

		return cell ? cell.getComponent() : false;
	};

	RowComponent.prototype.getIndex = function () {

		return this._row.getData("data")[this._row.table.options.index];
	};

	RowComponent.prototype.getPosition = function (active) {

		return this._row.table.rowManager.getRowPosition(this._row, active);
	};

	RowComponent.prototype.delete = function () {

		return this._row.delete();
	};

	RowComponent.prototype.scrollTo = function () {

		return this._row.table.rowManager.scrollToRow(this._row);
	};

	RowComponent.prototype.pageTo = function () {

		if (this._row.table.modExists("page", true)) {

			return this._row.table.modules.page.setPageToRow(this._row);
		}
	};

	RowComponent.prototype.move = function (to, after) {

		this._row.moveToRow(to, after);
	};

	RowComponent.prototype.update = function (data) {

		return this._row.updateData(data);
	};

	RowComponent.prototype.normalizeHeight = function () {

		this._row.normalizeHeight(true);
	};

	RowComponent.prototype.select = function () {

		this._row.table.modules.selectRow.selectRows(this._row);
	};

	RowComponent.prototype.deselect = function () {

		this._row.table.modules.selectRow.deselectRows(this._row);
	};

	RowComponent.prototype.toggleSelect = function () {

		this._row.table.modules.selectRow.toggleRow(this._row);
	};

	RowComponent.prototype.isSelected = function () {

		return this._row.table.modules.selectRow.isRowSelected(this._row);
	};

	RowComponent.prototype._getSelf = function () {

		return this._row;
	};

	RowComponent.prototype.validate = function () {

		return this._row.validate();
	};

	RowComponent.prototype.freeze = function () {

		if (this._row.table.modExists("frozenRows", true)) {

			this._row.table.modules.frozenRows.freezeRow(this._row);
		}
	};

	RowComponent.prototype.unfreeze = function () {

		if (this._row.table.modExists("frozenRows", true)) {

			this._row.table.modules.frozenRows.unfreezeRow(this._row);
		}
	};

	RowComponent.prototype.isFrozen = function () {

		if (this._row.table.modExists("frozenRows", true)) {

			var index = this._row.table.modules.frozenRows.rows.indexOf(this._row);

			return index > -1;
		}

		return false;
	};

	RowComponent.prototype.treeCollapse = function () {

		if (this._row.table.modExists("dataTree", true)) {

			this._row.table.modules.dataTree.collapseRow(this._row);
		}
	};

	RowComponent.prototype.treeExpand = function () {

		if (this._row.table.modExists("dataTree", true)) {

			this._row.table.modules.dataTree.expandRow(this._row);
		}
	};

	RowComponent.prototype.treeToggle = function () {

		if (this._row.table.modExists("dataTree", true)) {

			this._row.table.modules.dataTree.toggleRow(this._row);
		}
	};

	RowComponent.prototype.getTreeParent = function () {

		if (this._row.table.modExists("dataTree", true)) {

			return this._row.table.modules.dataTree.getTreeParent(this._row);
		}

		return false;
	};

	RowComponent.prototype.getTreeChildren = function () {

		if (this._row.table.modExists("dataTree", true)) {

			return this._row.table.modules.dataTree.getTreeChildren(this._row);
		}

		return false;
	};

	RowComponent.prototype.addTreeChild = function (data, pos, index) {

		if (this._row.table.modExists("dataTree", true)) {

			return this._row.table.modules.dataTree.addTreeChildRow(this._row, data, pos, index);
		}

		return false;
	};

	RowComponent.prototype.reformat = function () {

		return this._row.reinitialize();
	};

	RowComponent.prototype.getGroup = function () {

		return this._row.getGroup().getComponent();
	};

	RowComponent.prototype.getTable = function () {

		return this._row.table;
	};

	RowComponent.prototype.getNextRow = function () {

		var row = this._row.nextRow();

		return row ? row.getComponent() : row;
	};

	RowComponent.prototype.getPrevRow = function () {

		var row = this._row.prevRow();

		return row ? row.getComponent() : row;
	};

	var Row = function Row(data, parent) {
		var type = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "row";


		this.table = parent.table;

		this.parent = parent;

		this.data = {};

		this.type = type; //type of element

		this.element = this.createElement();

		this.modules = {}; //hold module variables;

		this.cells = [];

		this.height = 0; //hold element height

		this.heightStyled = ""; //hold element height prestyled to improve render efficiency

		this.manualHeight = false; //user has manually set row height

		this.outerHeight = 0; //holde lements outer height

		this.initialized = false; //element has been rendered

		this.heightInitialized = false; //element has resized cells to fit


		this.component = null;

		this.setData(data);

		this.generateElement();
	};

	Row.prototype.createElement = function () {

		var el = document.createElement("div");

		el.classList.add("tabulator-row");

		el.setAttribute("role", "row");

		return el;
	};

	Row.prototype.getElement = function () {

		return this.element;
	};

	Row.prototype.detachElement = function () {

		if (this.element && this.element.parentNode) {

			this.element.parentNode.removeChild(this.element);
		}
	};

	Row.prototype.generateElement = function () {

		var self = this,
		    dblTap,
		    tapHold,
		    tap;

		//set row selection characteristics

		if (self.table.options.selectable !== false && self.table.modExists("selectRow")) {

			self.table.modules.selectRow.initializeRow(this);
		}

		//setup movable rows

		if (self.table.options.movableRows !== false && self.table.modExists("moveRow")) {

			self.table.modules.moveRow.initializeRow(this);
		}

		//setup data tree

		if (self.table.options.dataTree !== false && self.table.modExists("dataTree")) {

			self.table.modules.dataTree.initializeRow(this);
		}

		//setup column colapse container

		if (self.table.options.responsiveLayout === "collapse" && self.table.modExists("responsiveLayout")) {

			self.table.modules.responsiveLayout.initializeRow(this);
		}

		//set column menu

		if (self.table.options.rowContextMenu && this.table.modExists("menu")) {

			self.table.modules.menu.initializeRow(this);
		}

		//handle row click events

		if (self.table.options.rowClick) {

			self.element.addEventListener("click", function (e) {

				self.table.options.rowClick(e, self.getComponent());
			});
		}

		if (self.table.options.rowDblClick) {

			self.element.addEventListener("dblclick", function (e) {

				self.table.options.rowDblClick(e, self.getComponent());
			});
		}

		if (self.table.options.rowContext) {

			self.element.addEventListener("contextmenu", function (e) {

				self.table.options.rowContext(e, self.getComponent());
			});
		}

		//handle mouse events

		if (self.table.options.rowMouseEnter) {

			self.element.addEventListener("mouseenter", function (e) {

				self.table.options.rowMouseEnter(e, self.getComponent());
			});
		}

		if (self.table.options.rowMouseLeave) {

			self.element.addEventListener("mouseleave", function (e) {

				self.table.options.rowMouseLeave(e, self.getComponent());
			});
		}

		if (self.table.options.rowMouseOver) {

			self.element.addEventListener("mouseover", function (e) {

				self.table.options.rowMouseOver(e, self.getComponent());
			});
		}

		if (self.table.options.rowMouseOut) {

			self.element.addEventListener("mouseout", function (e) {

				self.table.options.rowMouseOut(e, self.getComponent());
			});
		}

		if (self.table.options.rowMouseMove) {

			self.element.addEventListener("mousemove", function (e) {

				self.table.options.rowMouseMove(e, self.getComponent());
			});
		}

		if (self.table.options.rowTap) {

			tap = false;

			self.element.addEventListener("touchstart", function (e) {

				tap = true;
			}, { passive: true });

			self.element.addEventListener("touchend", function (e) {

				if (tap) {

					self.table.options.rowTap(e, self.getComponent());
				}

				tap = false;
			});
		}

		if (self.table.options.rowDblTap) {

			dblTap = null;

			self.element.addEventListener("touchend", function (e) {

				if (dblTap) {

					clearTimeout(dblTap);

					dblTap = null;

					self.table.options.rowDblTap(e, self.getComponent());
				} else {

					dblTap = setTimeout(function () {

						clearTimeout(dblTap);

						dblTap = null;
					}, 300);
				}
			});
		}

		if (self.table.options.rowTapHold) {

			tapHold = null;

			self.element.addEventListener("touchstart", function (e) {

				clearTimeout(tapHold);

				tapHold = setTimeout(function () {

					clearTimeout(tapHold);

					tapHold = null;

					tap = false;

					self.table.options.rowTapHold(e, self.getComponent());
				}, 1000);
			}, { passive: true });

			self.element.addEventListener("touchend", function (e) {

				clearTimeout(tapHold);

				tapHold = null;
			});
		}
	};

	Row.prototype.generateCells = function () {

		this.cells = this.table.columnManager.generateCells(this);
	};

	//functions to setup on first render

	Row.prototype.initialize = function (force) {

		var self = this;

		if (!self.initialized || force) {

			self.deleteCells();

			while (self.element.firstChild) {
				self.element.removeChild(self.element.firstChild);
			} //handle frozen cells

			if (this.table.modExists("frozenColumns")) {

				this.table.modules.frozenColumns.layoutRow(this);
			}

			this.generateCells();

			self.cells.forEach(function (cell) {

				self.element.appendChild(cell.getElement());

				cell.cellRendered();
			});

			if (force) {

				self.normalizeHeight();
			}

			//setup movable rows

			if (self.table.options.dataTree && self.table.modExists("dataTree")) {

				self.table.modules.dataTree.layoutRow(this);
			}

			//setup column colapse container

			if (self.table.options.responsiveLayout === "collapse" && self.table.modExists("responsiveLayout")) {

				self.table.modules.responsiveLayout.layoutRow(this);
			}

			if (self.table.options.rowFormatter) {

				self.table.options.rowFormatter(self.getComponent());
			}

			//set resizable handles

			if (self.table.options.resizableRows && self.table.modExists("resizeRows")) {

				self.table.modules.resizeRows.initializeRow(self);
			}

			self.initialized = true;
		}
	};

	Row.prototype.reinitializeHeight = function () {

		this.heightInitialized = false;

		if (this.element.offsetParent !== null) {

			this.normalizeHeight(true);
		}
	};

	Row.prototype.reinitialize = function () {

		this.initialized = false;

		this.heightInitialized = false;

		if (!this.manualHeight) {

			this.height = 0;

			this.heightStyled = "";
		}

		if (this.element.offsetParent !== null) {

			this.initialize(true);
		}
	};

	//get heights when doing bulk row style calcs in virtual DOM

	Row.prototype.calcHeight = function (force) {

		var maxHeight = 0,
		    minHeight = this.table.options.resizableRows ? this.element.clientHeight : 0;

		this.cells.forEach(function (cell) {

			var height = cell.getHeight();

			if (height > maxHeight) {

				maxHeight = height;
			}
		});

		if (force) {

			this.height = Math.max(maxHeight, minHeight);
		} else {

			this.height = this.manualHeight ? this.height : Math.max(maxHeight, minHeight);
		}

		this.heightStyled = this.height ? this.height + "px" : "";

		this.outerHeight = this.element.offsetHeight;
	};

	//set of cells

	Row.prototype.setCellHeight = function () {

		this.cells.forEach(function (cell) {

			cell.setHeight();
		});

		this.heightInitialized = true;
	};

	Row.prototype.clearCellHeight = function () {

		this.cells.forEach(function (cell) {

			cell.clearHeight();
		});
	};

	//normalize the height of elements in the row

	Row.prototype.normalizeHeight = function (force) {

		if (force) {

			this.clearCellHeight();
		}

		this.calcHeight(force);

		this.setCellHeight();
	};

	// Row.prototype.setHeight = function(height){

	// 	this.height = height;


	// 	this.setCellHeight();

	// };


	//set height of rows

	Row.prototype.setHeight = function (height, force) {

		if (this.height != height || force) {

			this.manualHeight = true;

			this.height = height;

			this.heightStyled = height ? height + "px" : "";

			this.setCellHeight();

			// this.outerHeight = this.element.outerHeight();

			this.outerHeight = this.element.offsetHeight;
		}
	};

	//return rows outer height

	Row.prototype.getHeight = function () {

		return this.outerHeight;
	};

	//return rows outer Width

	Row.prototype.getWidth = function () {

		return this.element.offsetWidth;
	};

	//////////////// Cell Management /////////////////


	Row.prototype.deleteCell = function (cell) {

		var index = this.cells.indexOf(cell);

		if (index > -1) {

			this.cells.splice(index, 1);
		}
	};

	//////////////// Data Management /////////////////


	Row.prototype.setData = function (data) {

		if (this.table.modExists("mutator")) {

			data = this.table.modules.mutator.transformRow(data, "data");
		}

		this.data = data;

		if (this.table.options.reactiveData && this.table.modExists("reactiveData", true)) {

			this.table.modules.reactiveData.watchRow(this);
		}
	};

	//update the rows data

	Row.prototype.updateData = function (updatedData) {
		var _this15 = this;

		var visible = Tabulator.prototype.helpers.elVisible(this.element),
		    tempData = {},
		    newRowData;

		return new Promise(function (resolve, reject) {

			if (typeof updatedData === "string") {

				updatedData = JSON.parse(updatedData);
			}

			if (_this15.table.options.reactiveData && _this15.table.modExists("reactiveData", true)) {

				_this15.table.modules.reactiveData.block();
			}

			//mutate incomming data if needed

			if (_this15.table.modExists("mutator")) {

				tempData = Object.assign(tempData, _this15.data);

				tempData = Object.assign(tempData, updatedData);

				newRowData = _this15.table.modules.mutator.transformRow(tempData, "data", updatedData);
			} else {

				newRowData = updatedData;
			}

			//set data

			for (var attrname in newRowData) {

				_this15.data[attrname] = newRowData[attrname];
			}

			if (_this15.table.options.reactiveData && _this15.table.modExists("reactiveData", true)) {

				_this15.table.modules.reactiveData.unblock();
			}

			//update affected cells only

			for (var attrname in updatedData) {

				var columns = _this15.table.columnManager.getColumnsByFieldRoot(attrname);

				columns.forEach(function (column) {

					var cell = _this15.getCell(column.getField());

					if (cell) {

						var value = column.getFieldValue(newRowData);

						if (cell.getValue() != value) {

							cell.setValueProcessData(value);

							if (visible) {

								cell.cellRendered();
							}
						}
					}
				});
			}

			//Partial reinitialization if visible

			if (visible) {

				_this15.normalizeHeight(true);

				if (_this15.table.options.rowFormatter) {

					_this15.table.options.rowFormatter(_this15.getComponent());
				}
			} else {

				_this15.initialized = false;

				_this15.height = 0;

				_this15.heightStyled = "";
			}

			if (_this15.table.options.dataTree !== false && _this15.table.modExists("dataTree") && _this15.table.modules.dataTree.redrawNeeded(updatedData)) {

				_this15.table.modules.dataTree.initializeRow(_this15);

				_this15.table.modules.dataTree.layoutRow(_this15);

				_this15.table.rowManager.refreshActiveData("tree", false, true);
			}

			//this.reinitialize();


			_this15.table.options.rowUpdated.call(_this15.table, _this15.getComponent());

			resolve();
		});
	};

	Row.prototype.getData = function (transform) {

		var self = this;

		if (transform) {

			if (self.table.modExists("accessor")) {

				return self.table.modules.accessor.transformRow(self.data, transform);
			}
		} else {

			return this.data;
		}
	};

	Row.prototype.getCell = function (column) {

		var match = false;

		column = this.table.columnManager.findColumn(column);

		match = this.cells.find(function (cell) {

			return cell.column === column;
		});

		return match;
	};

	Row.prototype.getCellIndex = function (findCell) {

		return this.cells.findIndex(function (cell) {

			return cell === findCell;
		});
	};

	Row.prototype.findNextEditableCell = function (index) {

		var nextCell = false;

		if (index < this.cells.length - 1) {

			for (var i = index + 1; i < this.cells.length; i++) {

				var cell = this.cells[i];

				if (cell.column.modules.edit && Tabulator.prototype.helpers.elVisible(cell.getElement())) {

					var allowEdit = true;

					if (typeof cell.column.modules.edit.check == "function") {

						allowEdit = cell.column.modules.edit.check(cell.getComponent());
					}

					if (allowEdit) {

						nextCell = cell;

						break;
					}
				}
			}
		}

		return nextCell;
	};

	Row.prototype.findPrevEditableCell = function (index) {

		var prevCell = false;

		if (index > 0) {

			for (var i = index - 1; i >= 0; i--) {

				var cell = this.cells[i],
				    allowEdit = true;

				if (cell.column.modules.edit && Tabulator.prototype.helpers.elVisible(cell.getElement())) {

					if (typeof cell.column.modules.edit.check == "function") {

						allowEdit = cell.column.modules.edit.check(cell.getComponent());
					}

					if (allowEdit) {

						prevCell = cell;

						break;
					}
				}
			}
		}

		return prevCell;
	};

	Row.prototype.getCells = function () {

		return this.cells;
	};

	Row.prototype.nextRow = function () {

		var row = this.table.rowManager.nextDisplayRow(this, true);

		return row || false;
	};

	Row.prototype.prevRow = function () {

		var row = this.table.rowManager.prevDisplayRow(this, true);

		return row || false;
	};

	Row.prototype.moveToRow = function (to, before) {

		var toRow = this.table.rowManager.findRow(to);

		if (toRow) {

			this.table.rowManager.moveRowActual(this, toRow, !before);

			this.table.rowManager.refreshActiveData("display", false, true);
		} else {

			console.warn("Move Error - No matching row found:", to);
		}
	};

	Row.prototype.validate = function () {

		var invalid = [];

		this.cells.forEach(function (cell) {

			if (!cell.validate()) {

				invalid.push(cell.getComponent());
			}
		});

		return invalid.length ? invalid : true;
	};

	///////////////////// Actions  /////////////////////


	Row.prototype.delete = function () {
		var _this16 = this;

		return new Promise(function (resolve, reject) {

			var index, rows;

			if (_this16.table.options.history && _this16.table.modExists("history")) {

				if (_this16.table.options.groupBy && _this16.table.modExists("groupRows")) {

					rows = _this16.getGroup().rows;

					index = rows.indexOf(_this16);

					if (index) {

						index = rows[index - 1];
					}
				} else {

					index = _this16.table.rowManager.getRowIndex(_this16);

					if (index) {

						index = _this16.table.rowManager.rows[index - 1];
					}
				}

				_this16.table.modules.history.action("rowDelete", _this16, { data: _this16.getData(), pos: !index, index: index });
			}

			_this16.deleteActual();

			resolve();
		});
	};

	Row.prototype.deleteActual = function (blockRedraw) {

		var index = this.table.rowManager.getRowIndex(this);

		//deselect row if it is selected

		if (this.table.modExists("selectRow")) {

			this.table.modules.selectRow._deselectRow(this, true);
		}

		//cancel edit if row is currently being edited

		if (this.table.modExists("edit")) {

			if (this.table.modules.edit.currentCell.row === this) {

				this.table.modules.edit.cancelEdit();
			}
		}

		// if(this.table.options.dataTree && this.table.modExists("dataTree")){

		// 	this.table.modules.dataTree.collapseRow(this, true);

		// }


		//remove any reactive data watchers from row object

		if (this.table.options.reactiveData && this.table.modExists("reactiveData", true)) {}

		// this.table.modules.reactiveData.unwatchRow(this);

		//remove from group

		if (this.modules.group) {

			this.modules.group.removeRow(this);
		}

		this.table.rowManager.deleteRow(this, blockRedraw);

		this.deleteCells();

		this.initialized = false;

		this.heightInitialized = false;

		if (this.table.options.dataTree && this.table.modExists("dataTree", true)) {

			this.table.modules.dataTree.rowDelete(this);
		}

		//recalc column calculations if present

		if (this.table.modExists("columnCalcs")) {

			if (this.table.options.groupBy && this.table.modExists("groupRows")) {

				this.table.modules.columnCalcs.recalcRowGroup(this);
			} else {

				this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows);
			}
		}
	};

	Row.prototype.deleteCells = function () {

		var cellCount = this.cells.length;

		for (var _i5 = 0; _i5 < cellCount; _i5++) {

			this.cells[0].delete();
		}
	};

	Row.prototype.wipe = function () {

		this.deleteCells();

		while (this.element.firstChild) {
			this.element.removeChild(this.element.firstChild);
		}this.element = false;

		this.modules = {};

		if (this.element.parentNode) {

			this.element.parentNode.removeChild(this.element);
		}
	};

	Row.prototype.getGroup = function () {

		return this.modules.group || false;
	};

	//////////////// Object Generation /////////////////

	Row.prototype.getComponent = function () {

		if (!this.component) {

			this.component = new RowComponent(this);
		}

		return this.component;
	};

	//public row object

	var CellComponent = function CellComponent(cell) {

		this._cell = cell;
	};

	CellComponent.prototype.getValue = function () {

		return this._cell.getValue();
	};

	CellComponent.prototype.getOldValue = function () {

		return this._cell.getOldValue();
	};

	CellComponent.prototype.getElement = function () {

		return this._cell.getElement();
	};

	CellComponent.prototype.getRow = function () {

		return this._cell.row.getComponent();
	};

	CellComponent.prototype.getData = function () {

		return this._cell.row.getData();
	};

	CellComponent.prototype.getField = function () {

		return this._cell.column.getField();
	};

	CellComponent.prototype.getColumn = function () {

		return this._cell.column.getComponent();
	};

	CellComponent.prototype.setValue = function (value, mutate) {

		if (typeof mutate == "undefined") {

			mutate = true;
		}

		this._cell.setValue(value, mutate);
	};

	CellComponent.prototype.restoreOldValue = function () {

		this._cell.setValueActual(this._cell.getOldValue());
	};

	CellComponent.prototype.edit = function (force) {

		return this._cell.edit(force);
	};

	CellComponent.prototype.cancelEdit = function () {

		this._cell.cancelEdit();
	};

	CellComponent.prototype.isEdited = function () {

		return !!this._cell.modules.edit && this._cell.modules.edit.edited;
	};

	CellComponent.prototype.clearEdited = function () {

		if (self.table.modExists("edit", true)) {

			this._cell.table.modules.edit.clearEdited(this._cell);
		}
	};

	CellComponent.prototype.isValid = function () {

		return this._cell.modules.validate ? !this._cell.modules.validate.invalid : true;
	};

	CellComponent.prototype.validate = function () {

		return this._cell.validate();
	};

	CellComponent.prototype.clearValidation = function () {

		if (self.table.modExists("validate", true)) {

			this._cell.table.modules.validate.clearValidation(this._cell);
		}
	};

	CellComponent.prototype.nav = function () {

		return this._cell.nav();
	};

	CellComponent.prototype.checkHeight = function () {

		this._cell.checkHeight();
	};

	CellComponent.prototype.getTable = function () {

		return this._cell.table;
	};

	CellComponent.prototype._getSelf = function () {

		return this._cell;
	};

	var Cell = function Cell(column, row) {

		this.table = column.table;

		this.column = column;

		this.row = row;

		this.element = null;

		this.value = null;

		this.oldValue = null;

		this.modules = {};

		this.height = null;

		this.width = null;

		this.minWidth = null;

		this.component = null;

		this.build();
	};

	//////////////// Setup Functions /////////////////


	//generate element

	Cell.prototype.build = function () {

		this.generateElement();

		this.setWidth();

		this._configureCell();

		this.setValueActual(this.column.getFieldValue(this.row.data));
	};

	Cell.prototype.generateElement = function () {

		this.element = document.createElement('div');

		this.element.className = "tabulator-cell";

		this.element.setAttribute("role", "gridcell");

		this.element = this.element;
	};

	Cell.prototype._configureCell = function () {

		var self = this,
		    cellEvents = self.column.cellEvents,
		    element = self.element,
		    field = this.column.getField(),
		    vertAligns = {

			top: "flex-start",

			bottom: "flex-end",

			middle: "center"

		},
		    hozAligns = {

			left: "flex-start",

			right: "flex-end",

			center: "center"

		};

		//set text alignment

		element.style.textAlign = self.column.hozAlign;

		if (self.column.vertAlign) {

			element.style.display = "inline-flex";

			element.style.alignItems = vertAligns[self.column.vertAlign] || "";

			if (self.column.hozAlign) {

				element.style.justifyContent = hozAligns[self.column.hozAlign] || "";
			}
		}

		if (field) {

			element.setAttribute("tabulator-field", field);
		}

		//add class to cell if needed

		if (self.column.definition.cssClass) {

			var classNames = self.column.definition.cssClass.split(" ");

			classNames.forEach(function (className) {

				element.classList.add(className);
			});
		}

		//update tooltip on mouse enter

		if (this.table.options.tooltipGenerationMode === "hover") {

			element.addEventListener("mouseenter", function (e) {

				self._generateTooltip();
			});
		}

		self._bindClickEvents(cellEvents);

		self._bindTouchEvents(cellEvents);

		self._bindMouseEvents(cellEvents);

		if (self.column.modules.edit) {

			self.table.modules.edit.bindEditor(self);
		}

		if (self.column.definition.rowHandle && self.table.options.movableRows !== false && self.table.modExists("moveRow")) {

			self.table.modules.moveRow.initializeCell(self);
		}

		//hide cell if not visible

		if (!self.column.visible) {

			self.hide();
		}
	};

	Cell.prototype._bindClickEvents = function (cellEvents) {

		var self = this,
		    element = self.element;

		//set event bindings

		if (cellEvents.cellClick || self.table.options.cellClick) {

			element.addEventListener("click", function (e) {

				var component = self.getComponent();

				if (cellEvents.cellClick) {

					cellEvents.cellClick.call(self.table, e, component);
				}

				if (self.table.options.cellClick) {

					self.table.options.cellClick.call(self.table, e, component);
				}
			});
		}

		if (cellEvents.cellDblClick || this.table.options.cellDblClick) {

			element.addEventListener("dblclick", function (e) {

				var component = self.getComponent();

				if (cellEvents.cellDblClick) {

					cellEvents.cellDblClick.call(self.table, e, component);
				}

				if (self.table.options.cellDblClick) {

					self.table.options.cellDblClick.call(self.table, e, component);
				}
			});
		} else {

			element.addEventListener("dblclick", function (e) {

				if (self.table.modExists("edit")) {

					if (self.table.modules.edit.currentCell === self) {

						return; //prevent instant selection of editor content
					}
				}

				e.preventDefault();

				try {

					if (document.selection) {
						// IE

						var range = document.body.createTextRange();

						range.moveToElementText(self.element);

						range.select();
					} else if (window.getSelection) {

						var range = document.createRange();

						range.selectNode(self.element);

						window.getSelection().removeAllRanges();

						window.getSelection().addRange(range);
					}
				} catch (e) {}
			});
		}

		if (cellEvents.cellContext || this.table.options.cellContext) {

			element.addEventListener("contextmenu", function (e) {

				var component = self.getComponent();

				if (cellEvents.cellContext) {

					cellEvents.cellContext.call(self.table, e, component);
				}

				if (self.table.options.cellContext) {

					self.table.options.cellContext.call(self.table, e, component);
				}
			});
		}
	};

	Cell.prototype._bindMouseEvents = function (cellEvents) {

		var self = this,
		    element = self.element;

		if (cellEvents.cellMouseEnter || self.table.options.cellMouseEnter) {

			element.addEventListener("mouseenter", function (e) {

				var component = self.getComponent();

				if (cellEvents.cellMouseEnter) {

					cellEvents.cellMouseEnter.call(self.table, e, component);
				}

				if (self.table.options.cellMouseEnter) {

					self.table.options.cellMouseEnter.call(self.table, e, component);
				}
			});
		}

		if (cellEvents.cellMouseLeave || self.table.options.cellMouseLeave) {

			element.addEventListener("mouseleave", function (e) {

				var component = self.getComponent();

				if (cellEvents.cellMouseLeave) {

					cellEvents.cellMouseLeave.call(self.table, e, component);
				}

				if (self.table.options.cellMouseLeave) {

					self.table.options.cellMouseLeave.call(self.table, e, component);
				}
			});
		}

		if (cellEvents.cellMouseOver || self.table.options.cellMouseOver) {

			element.addEventListener("mouseover", function (e) {

				var component = self.getComponent();

				if (cellEvents.cellMouseOver) {

					cellEvents.cellMouseOver.call(self.table, e, component);
				}

				if (self.table.options.cellMouseOver) {

					self.table.options.cellMouseOver.call(self.table, e, component);
				}
			});
		}

		if (cellEvents.cellMouseOut || self.table.options.cellMouseOut) {

			element.addEventListener("mouseout", function (e) {

				var component = self.getComponent();

				if (cellEvents.cellMouseOut) {

					cellEvents.cellMouseOut.call(self.table, e, component);
				}

				if (self.table.options.cellMouseOut) {

					self.table.options.cellMouseOut.call(self.table, e, component);
				}
			});
		}

		if (cellEvents.cellMouseMove || self.table.options.cellMouseMove) {

			element.addEventListener("mousemove", function (e) {

				var component = self.getComponent();

				if (cellEvents.cellMouseMove) {

					cellEvents.cellMouseMove.call(self.table, e, component);
				}

				if (self.table.options.cellMouseMove) {

					self.table.options.cellMouseMove.call(self.table, e, component);
				}
			});
		}
	};

	Cell.prototype._bindTouchEvents = function (cellEvents) {

		var self = this,
		    element = self.element,
		    dblTap,
		    tapHold,
		    tap;

		if (cellEvents.cellTap || this.table.options.cellTap) {

			tap = false;

			element.addEventListener("touchstart", function (e) {

				tap = true;
			}, { passive: true });

			element.addEventListener("touchend", function (e) {

				if (tap) {

					var component = self.getComponent();

					if (cellEvents.cellTap) {

						cellEvents.cellTap.call(self.table, e, component);
					}

					if (self.table.options.cellTap) {

						self.table.options.cellTap.call(self.table, e, component);
					}
				}

				tap = false;
			});
		}

		if (cellEvents.cellDblTap || this.table.options.cellDblTap) {

			dblTap = null;

			element.addEventListener("touchend", function (e) {

				if (dblTap) {

					clearTimeout(dblTap);

					dblTap = null;

					var component = self.getComponent();

					if (cellEvents.cellDblTap) {

						cellEvents.cellDblTap.call(self.table, e, component);
					}

					if (self.table.options.cellDblTap) {

						self.table.options.cellDblTap.call(self.table, e, component);
					}
				} else {

					dblTap = setTimeout(function () {

						clearTimeout(dblTap);

						dblTap = null;
					}, 300);
				}
			});
		}

		if (cellEvents.cellTapHold || this.table.options.cellTapHold) {

			tapHold = null;

			element.addEventListener("touchstart", function (e) {

				clearTimeout(tapHold);

				tapHold = setTimeout(function () {

					clearTimeout(tapHold);

					tapHold = null;

					tap = false;

					var component = self.getComponent();

					if (cellEvents.cellTapHold) {

						cellEvents.cellTapHold.call(self.table, e, component);
					}

					if (self.table.options.cellTapHold) {

						self.table.options.cellTapHold.call(self.table, e, component);
					}
				}, 1000);
			}, { passive: true });

			element.addEventListener("touchend", function (e) {

				clearTimeout(tapHold);

				tapHold = null;
			});
		}
	};

	//generate cell contents

	Cell.prototype._generateContents = function () {

		var val;

		if (this.table.modExists("format")) {

			val = this.table.modules.format.formatValue(this);
		} else {

			val = this.element.innerHTML = this.value;
		}

		switch (typeof val === 'undefined' ? 'undefined' : _typeof(val)) {

			case "object":

				if (val instanceof Node) {

					//clear previous cell contents

					while (this.element.firstChild) {
						this.element.removeChild(this.element.firstChild);
					}this.element.appendChild(val);
				} else {

					this.element.innerHTML = "";

					if (val != null) {

						console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:", val);
					}
				}

				break;

			case "undefined":

			case "null":

				this.element.innerHTML = "";

				break;

			default:

				this.element.innerHTML = val;

		}
	};

	Cell.prototype.cellRendered = function () {

		if (this.table.modExists("format") && this.table.modules.format.cellRendered) {

			this.table.modules.format.cellRendered(this);
		}
	};

	//generate tooltip text

	Cell.prototype._generateTooltip = function () {

		var tooltip = this.column.tooltip;

		if (tooltip) {

			if (tooltip === true) {

				tooltip = this.value;
			} else if (typeof tooltip == "function") {

				tooltip = tooltip(this.getComponent());

				if (tooltip === false) {

					tooltip = "";
				}
			}

			if (typeof tooltip === "undefined") {

				tooltip = "";
			}

			this.element.setAttribute("title", tooltip);
		} else {

			this.element.setAttribute("title", "");
		}
	};

	//////////////////// Getters ////////////////////

	Cell.prototype.getElement = function () {

		return this.element;
	};

	Cell.prototype.getValue = function () {

		return this.value;
	};

	Cell.prototype.getOldValue = function () {

		return this.oldValue;
	};

	//////////////////// Actions ////////////////////


	Cell.prototype.setValue = function (value, mutate) {

		var changed = this.setValueProcessData(value, mutate),
		    component;

		if (changed) {

			if (this.table.options.history && this.table.modExists("history")) {

				this.table.modules.history.action("cellEdit", this, { oldValue: this.oldValue, newValue: this.value });
			}

			component = this.getComponent();

			if (this.column.cellEvents.cellEdited) {

				this.column.cellEvents.cellEdited.call(this.table, component);
			}

			this.cellRendered();

			this.table.options.cellEdited.call(this.table, component);

			this.table.options.dataEdited.call(this.table, this.table.rowManager.getData());
		}
	};

	Cell.prototype.setValueProcessData = function (value, mutate) {

		var changed = false;

		if (this.value != value) {

			changed = true;

			if (mutate) {

				if (this.column.modules.mutate) {

					value = this.table.modules.mutator.transformCell(this, value);
				}
			}
		}

		this.setValueActual(value);

		if (changed && this.table.modExists("columnCalcs")) {

			if (this.column.definition.topCalc || this.column.definition.bottomCalc) {

				if (this.table.options.groupBy && this.table.modExists("groupRows")) {

					if (this.table.options.columnCalcs == "table" || this.table.options.columnCalcs == "both") {

						this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows);
					}

					if (this.table.options.columnCalcs != "table") {

						this.table.modules.columnCalcs.recalcRowGroup(this.row);
					}
				} else {

					this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows);
				}
			}
		}

		return changed;
	};

	Cell.prototype.setValueActual = function (value) {

		this.oldValue = this.value;

		this.value = value;

		if (this.table.options.reactiveData && this.table.modExists("reactiveData")) {

			this.table.modules.reactiveData.block();
		}

		this.column.setFieldValue(this.row.data, value);

		if (this.table.options.reactiveData && this.table.modExists("reactiveData")) {

			this.table.modules.reactiveData.unblock();
		}

		this._generateContents();

		this._generateTooltip();

		//set resizable handles

		if (this.table.options.resizableColumns && this.table.modExists("resizeColumns")) {

			this.table.modules.resizeColumns.initializeColumn("cell", this.column, this.element);
		}

		//set column menu

		if (this.column.definition.contextMenu && this.table.modExists("menu")) {

			this.table.modules.menu.initializeCell(this);
		}

		//handle frozen cells

		if (this.table.modExists("frozenColumns")) {

			this.table.modules.frozenColumns.layoutElement(this.element, this.column);
		}
	};

	Cell.prototype.setWidth = function () {

		this.width = this.column.width;

		this.element.style.width = this.column.widthStyled;
	};

	Cell.prototype.clearWidth = function () {

		this.width = "";

		this.element.style.width = "";
	};

	Cell.prototype.getWidth = function () {

		return this.width || this.element.offsetWidth;
	};

	Cell.prototype.setMinWidth = function () {

		this.minWidth = this.column.minWidth;

		this.element.style.minWidth = this.column.minWidthStyled;
	};

	Cell.prototype.checkHeight = function () {

		// var height = this.element.css("height");

		this.row.reinitializeHeight();
	};

	Cell.prototype.clearHeight = function () {

		this.element.style.height = "";

		this.height = null;
	};

	Cell.prototype.setHeight = function () {

		this.height = this.row.height;

		this.element.style.height = this.row.heightStyled;
	};

	Cell.prototype.getHeight = function () {

		return this.height || this.element.offsetHeight;
	};

	Cell.prototype.show = function () {

		this.element.style.display = "";
	};

	Cell.prototype.hide = function () {

		this.element.style.display = "none";
	};

	Cell.prototype.edit = function (force) {

		if (this.table.modExists("edit", true)) {

			return this.table.modules.edit.editCell(this, force);
		}
	};

	Cell.prototype.cancelEdit = function () {

		if (this.table.modExists("edit", true)) {

			var editing = this.table.modules.edit.getCurrentCell();

			if (editing && editing._getSelf() === this) {

				this.table.modules.edit.cancelEdit();
			} else {

				console.warn("Cancel Editor Error - This cell is not currently being edited ");
			}
		}
	};

	Cell.prototype.validate = function () {

		if (this.column.modules.validate && this.table.modExists("validate", true)) {

			var valid = this.table.modules.validate.validate(this.column.modules.validate, this, this.getValue());

			return valid === true;
		} else {

			return true;
		}
	};

	Cell.prototype.delete = function () {

		if (!this.table.rowManager.redrawBlock) {

			this.element.parentNode.removeChild(this.element);
		}

		if (this.modules.validate && this.modules.validate.invalid) {

			this.table.modules.validate.clearValidation(this);
		}

		if (this.modules.edit && this.modules.edit.edited) {

			this.table.modules.edit.clearEdited(this);
		}

		this.element = false;

		this.column.deleteCell(this);

		this.row.deleteCell(this);

		this.calcs = {};
	};

	//////////////// Navigation /////////////////


	Cell.prototype.nav = function () {

		var self = this,
		    nextCell = false,
		    index = this.row.getCellIndex(this);

		return {

			next: function next() {

				var nextCell = this.right(),
				    nextRow;

				if (!nextCell) {

					nextRow = self.table.rowManager.nextDisplayRow(self.row, true);

					if (nextRow) {

						nextCell = nextRow.findNextEditableCell(-1);

						if (nextCell) {

							nextCell.edit();

							return true;
						}
					}
				} else {

					return true;
				}

				return false;
			},

			prev: function prev() {

				var nextCell = this.left(),
				    prevRow;

				if (!nextCell) {

					prevRow = self.table.rowManager.prevDisplayRow(self.row, true);

					if (prevRow) {

						nextCell = prevRow.findPrevEditableCell(prevRow.cells.length);

						if (nextCell) {

							nextCell.edit();

							return true;
						}
					}
				} else {

					return true;
				}

				return false;
			},

			left: function left() {

				nextCell = self.row.findPrevEditableCell(index);

				if (nextCell) {

					nextCell.edit();

					return true;
				} else {

					return false;
				}
			},

			right: function right() {

				nextCell = self.row.findNextEditableCell(index);

				if (nextCell) {

					nextCell.edit();

					return true;
				} else {

					return false;
				}
			},

			up: function up() {

				var nextRow = self.table.rowManager.prevDisplayRow(self.row, true);

				if (nextRow) {

					nextRow.cells[index].edit();
				}
			},

			down: function down() {

				var nextRow = self.table.rowManager.nextDisplayRow(self.row, true);

				if (nextRow) {

					nextRow.cells[index].edit();
				}
			}

		};
	};

	Cell.prototype.getIndex = function () {

		this.row.getCellIndex(this);
	};

	//////////////// Object Generation /////////////////

	Cell.prototype.getComponent = function () {

		if (!this.component) {

			this.component = new CellComponent(this);
		}

		return this.component;
	};

	var FooterManager = function FooterManager(table) {

		this.table = table;

		this.active = false;

		this.element = this.createElement(); //containing element

		this.external = false;

		this.links = [];

		this._initialize();
	};

	FooterManager.prototype.createElement = function () {

		var el = document.createElement("div");

		el.classList.add("tabulator-footer");

		return el;
	};

	FooterManager.prototype._initialize = function (element) {

		if (this.table.options.footerElement) {

			switch (_typeof(this.table.options.footerElement)) {

				case "string":

					if (this.table.options.footerElement[0] === "<") {

						this.element.innerHTML = this.table.options.footerElement;
					} else {

						this.external = true;

						this.element = document.querySelector(this.table.options.footerElement);
					}

					break;

				default:

					this.element = this.table.options.footerElement;

					break;

			}
		}
	};

	FooterManager.prototype.getElement = function () {

		return this.element;
	};

	FooterManager.prototype.append = function (element, parent) {

		this.activate(parent);

		this.element.appendChild(element);

		this.table.rowManager.adjustTableSize();
	};

	FooterManager.prototype.prepend = function (element, parent) {

		this.activate(parent);

		this.element.insertBefore(element, this.element.firstChild);

		this.table.rowManager.adjustTableSize();
	};

	FooterManager.prototype.remove = function (element) {

		element.parentNode.removeChild(element);

		this.deactivate();
	};

	FooterManager.prototype.deactivate = function (force) {

		if (!this.element.firstChild || force) {

			if (!this.external) {

				this.element.parentNode.removeChild(this.element);
			}

			this.active = false;
		}

		// this.table.rowManager.adjustTableSize();
	};

	FooterManager.prototype.activate = function (parent) {

		if (!this.active) {

			this.active = true;

			if (!this.external) {

				this.table.element.appendChild(this.getElement());

				this.table.element.style.display = '';
			}
		}

		if (parent) {

			this.links.push(parent);
		}
	};

	FooterManager.prototype.redraw = function () {

		this.links.forEach(function (link) {

			link.footerRedraw();
		});
	};

	var Tabulator = function Tabulator(element, options) {

		this.options = {};

		this.columnManager = null; // hold Column Manager

		this.rowManager = null; //hold Row Manager

		this.footerManager = null; //holder Footer Manager

		this.browser = ""; //hold current browser type

		this.browserSlow = false; //handle reduced functionality for slower browsers

		this.browserMobile = false; //check if running on moble, prevent resize cancelling edit on keyboard appearence


		this.modules = {}; //hold all modules bound to this table


		this.initializeElement(element);

		this.initializeOptions(options || {});

		this._create();

		Tabulator.prototype.comms.register(this); //register table for inderdevice communication
	};

	//default setup options

	Tabulator.prototype.defaultOptions = {

		height: false, //height of tabulator

		minHeight: false, //minimum height of tabulator

		maxHeight: false, //maximum height of tabulator


		layout: "fitData", ///layout type "fitColumns" | "fitData"

		layoutColumnsOnNewData: false, //update column widths on setData


		columnMinWidth: 40, //minimum global width for a column

		columnHeaderVertAlign: "top", //vertical alignment of column headers

		columnVertAlign: false, // DEPRECATED - Left to allow warning


		resizableColumns: true, //resizable columns

		resizableRows: false, //resizable rows

		autoResize: true, //auto resize table


		columns: [], //store for colum header info


		cellHozAlign: "", //horizontal align columns

		cellVertAlign: "", //certical align columns


		data: [], //default starting data


		autoColumns: false, //build columns from data row structure


		reactiveData: false, //enable data reactivity


		nestedFieldSeparator: ".", //seperatpr for nested data


		tooltips: false, //Tool tip value

		tooltipsHeader: false, //Tool tip for headers

		tooltipGenerationMode: "load", //when to generate tooltips


		initialSort: false, //initial sorting criteria

		initialFilter: false, //initial filtering criteria

		initialHeaderFilter: false, //initial header filtering criteria


		columnHeaderSortMulti: true, //multiple or single column sorting


		sortOrderReverse: false, //reverse internal sort ordering


		headerSort: true, //set default global header sort

		headerSortTristate: false, //set default tristate header sorting


		footerElement: false, //hold footer element


		index: "id", //filed for row index


		keybindings: [], //array for keybindings


		tabEndNewRow: false, //create new row when tab to end of table


		invalidOptionWarnings: true, //allow toggling of invalid option warnings


		clipboard: false, //enable clipboard

		clipboardCopyStyled: true, //formatted table data

		clipboardCopyConfig: false, //clipboard config

		clipboardCopyFormatter: false, //DEPRICATED - REMOVE in 5.0

		clipboardCopyRowRange: "active", //restrict clipboard to visible rows only

		clipboardPasteParser: "table", //convert pasted clipboard data to rows

		clipboardPasteAction: "insert", //how to insert pasted data into the table


		clipboardCopied: function clipboardCopied() {}, //data has been copied to the clipboard

		clipboardPasted: function clipboardPasted() {}, //data has been pasted into the table

		clipboardPasteError: function clipboardPasteError() {}, //data has not successfully been pasted into the table


		downloadDataFormatter: false, //function to manipulate table data before it is downloaded

		downloadReady: function downloadReady(data, blob) {
			return blob;
		}, //function to manipulate download data

		downloadComplete: false, //function to manipulate download data

		downloadConfig: {}, //download config

		downloadRowRange: "active", //restrict download to active rows only


		dataTree: false, //enable data tree

		dataTreeElementColumn: false,

		dataTreeBranchElement: true, //show data tree branch element

		dataTreeChildIndent: 9, //data tree child indent in px

		dataTreeChildField: "_children", //data tre column field to look for child rows

		dataTreeCollapseElement: false, //data tree row collapse element

		dataTreeExpandElement: false, //data tree row expand element

		dataTreeStartExpanded: false,

		dataTreeRowExpanded: function dataTreeRowExpanded() {}, //row has been expanded

		dataTreeRowCollapsed: function dataTreeRowCollapsed() {}, //row has been collapsed

		dataTreeChildColumnCalcs: false, //include visible data tree rows in column calculations

		dataTreeSelectPropagate: false, //seleccting a parent row selects its children


		printAsHtml: false, //enable print as html

		printFormatter: false, //printing page formatter

		printHeader: false, //page header contents

		printFooter: false, //page footer contents

		printCopyStyle: true, //DEPRICATED - REMOVE in 5.0

		printStyled: true, //enable print as html styling

		printVisibleRows: true, //DEPRICATED - REMOVE in 5.0

		printRowRange: "visible", //restrict print to visible rows only

		printConfig: {}, //print config options


		addRowPos: "bottom", //position to insert blank rows, top|bottom


		selectable: "highlight", //highlight rows on hover

		selectableRangeMode: "drag", //highlight rows on hover

		selectableRollingSelection: true, //roll selection once maximum number of selectable rows is reached

		selectablePersistence: true, // maintain selection when table view is updated

		selectableCheck: function selectableCheck(data, row) {
			return true;
		}, //check wheather row is selectable


		headerFilterLiveFilterDelay: 300, //delay before updating column after user types in header filter

		headerFilterPlaceholder: false, //placeholder text to display in header filters


		headerVisible: true, //hide header


		history: false, //enable edit history


		locale: false, //current system language

		langs: {},

		virtualDom: true, //enable DOM virtualization

		virtualDomBuffer: 0, // set virtual DOM buffer size


		persistentLayout: false, //DEPRICATED - REMOVE in 5.0

		persistentSort: false, //DEPRICATED - REMOVE in 5.0

		persistentFilter: false, //DEPRICATED - REMOVE in 5.0

		persistenceID: "", //key for persistent storage

		persistenceMode: true, //mode for storing persistence information

		persistenceReaderFunc: false, //function for handling persistence data reading

		persistenceWriterFunc: false, //function for handling persistence data writing


		persistence: false,

		responsiveLayout: false, //responsive layout flags

		responsiveLayoutCollapseStartOpen: true, //start showing collapsed data

		responsiveLayoutCollapseUseFormatters: true, //responsive layout collapse formatter

		responsiveLayoutCollapseFormatter: false, //responsive layout collapse formatter


		pagination: false, //set pagination type

		paginationSize: false, //set number of rows to a page

		paginationInitialPage: 1, //initail page to show on load

		paginationButtonCount: 5, // set count of page button

		paginationSizeSelector: false, //add pagination size selector element

		paginationElement: false, //element to hold pagination numbers

		paginationDataSent: {}, //pagination data sent to the server

		paginationDataReceived: {}, //pagination data received from the server

		paginationAddRow: "page", //add rows on table or page


		ajaxURL: false, //url for ajax loading

		ajaxURLGenerator: false,

		ajaxParams: {}, //params for ajax loading

		ajaxConfig: "get", //ajax request type

		ajaxContentType: "form", //ajax request type

		ajaxRequestFunc: false, //promise function

		ajaxLoader: true, //show loader

		ajaxLoaderLoading: false, //loader element

		ajaxLoaderError: false, //loader element

		ajaxFiltering: false,

		ajaxSorting: false,

		ajaxProgressiveLoad: false, //progressive loading

		ajaxProgressiveLoadDelay: 0, //delay between requests

		ajaxProgressiveLoadScrollMargin: 0, //margin before scroll begins


		groupBy: false, //enable table grouping and set field to group by

		groupStartOpen: true, //starting state of group

		groupValues: false,

		groupHeader: false, //header generation function

		groupHeaderPrint: null,

		groupHeaderClipboard: null,

		groupHeaderHtmlOutput: null,

		groupHeaderDownload: null,

		htmlOutputConfig: false, //html outypu config


		movableColumns: false, //enable movable columns


		movableRows: false, //enable movable rows

		movableRowsConnectedTables: false, //tables for movable rows to be connected to

		movableRowsConnectedElements: false, //other elements for movable rows to be connected to

		movableRowsSender: false,

		movableRowsReceiver: "insert",

		movableRowsSendingStart: function movableRowsSendingStart() {},

		movableRowsSent: function movableRowsSent() {},

		movableRowsSentFailed: function movableRowsSentFailed() {},

		movableRowsSendingStop: function movableRowsSendingStop() {},

		movableRowsReceivingStart: function movableRowsReceivingStart() {},

		movableRowsReceived: function movableRowsReceived() {},

		movableRowsReceivedFailed: function movableRowsReceivedFailed() {},

		movableRowsReceivingStop: function movableRowsReceivingStop() {},

		movableRowsElementDrop: function movableRowsElementDrop() {},

		scrollToRowPosition: "top",

		scrollToRowIfVisible: true,

		scrollToColumnPosition: "left",

		scrollToColumnIfVisible: true,

		rowFormatter: false,

		rowFormatterPrint: null,

		rowFormatterClipboard: null,

		rowFormatterHtmlOutput: null,

		placeholder: false,

		//table building callbacks

		tableBuilding: function tableBuilding() {},

		tableBuilt: function tableBuilt() {},

		//render callbacks

		renderStarted: function renderStarted() {},

		renderComplete: function renderComplete() {},

		//row callbacks

		rowClick: false,

		rowDblClick: false,

		rowContext: false,

		rowTap: false,

		rowDblTap: false,

		rowTapHold: false,

		rowMouseEnter: false,

		rowMouseLeave: false,

		rowMouseOver: false,

		rowMouseOut: false,

		rowMouseMove: false,

		rowContextMenu: false,

		rowAdded: function rowAdded() {},

		rowDeleted: function rowDeleted() {},

		rowMoved: function rowMoved() {},

		rowUpdated: function rowUpdated() {},

		rowSelectionChanged: function rowSelectionChanged() {},

		rowSelected: function rowSelected() {},

		rowDeselected: function rowDeselected() {},

		rowResized: function rowResized() {},

		//cell callbacks

		//row callbacks

		cellClick: false,

		cellDblClick: false,

		cellContext: false,

		cellTap: false,

		cellDblTap: false,

		cellTapHold: false,

		cellMouseEnter: false,

		cellMouseLeave: false,

		cellMouseOver: false,

		cellMouseOut: false,

		cellMouseMove: false,

		cellEditing: function cellEditing() {},

		cellEdited: function cellEdited() {},

		cellEditCancelled: function cellEditCancelled() {},

		//column callbacks

		columnMoved: false,

		columnResized: function columnResized() {},

		columnTitleChanged: function columnTitleChanged() {},

		columnVisibilityChanged: function columnVisibilityChanged() {},

		//HTML iport callbacks

		htmlImporting: function htmlImporting() {},

		htmlImported: function htmlImported() {},

		//data callbacks

		dataLoading: function dataLoading() {},

		dataLoaded: function dataLoaded() {},

		dataEdited: function dataEdited() {},

		//ajax callbacks

		ajaxRequesting: function ajaxRequesting() {},

		ajaxResponse: false,

		ajaxError: function ajaxError() {},

		//filtering callbacks

		dataFiltering: false,

		dataFiltered: false,

		//sorting callbacks

		dataSorting: function dataSorting() {},

		dataSorted: function dataSorted() {},

		//grouping callbacks

		groupToggleElement: "arrow",

		groupClosedShowCalcs: false,

		dataGrouping: function dataGrouping() {},

		dataGrouped: false,

		groupVisibilityChanged: function groupVisibilityChanged() {},

		groupClick: false,

		groupDblClick: false,

		groupContext: false,

		groupContextMenu: false,

		groupTap: false,

		groupDblTap: false,

		groupTapHold: false,

		columnCalcs: true,

		//pagination callbacks

		pageLoaded: function pageLoaded() {},

		//localization callbacks

		localized: function localized() {},

		//validation callbacks

		validationMode: "blocking",

		validationFailed: function validationFailed() {},

		//history callbacks

		historyUndo: function historyUndo() {},

		historyRedo: function historyRedo() {},

		//scroll callbacks

		scrollHorizontal: function scrollHorizontal() {},

		scrollVertical: function scrollVertical() {}

	};

	Tabulator.prototype.initializeOptions = function (options) {

		//warn user if option is not available

		if (options.invalidOptionWarnings !== false) {

			for (var key in options) {

				if (typeof this.defaultOptions[key] === "undefined") {

					console.warn("Invalid table constructor option:", key);
				}
			}
		}

		//assign options to table

		for (var key in this.defaultOptions) {

			if (key in options) {

				this.options[key] = options[key];
			} else {

				if (Array.isArray(this.defaultOptions[key])) {

					this.options[key] = [];
				} else if (_typeof(this.defaultOptions[key]) === "object" && this.defaultOptions[key] !== null) {

					this.options[key] = {};
				} else {

					this.options[key] = this.defaultOptions[key];
				}
			}
		}
	};

	Tabulator.prototype.initializeElement = function (element) {

		if (typeof HTMLElement !== "undefined" && element instanceof HTMLElement) {

			this.element = element;

			return true;
		} else if (typeof element === "string") {

			this.element = document.querySelector(element);

			if (this.element) {

				return true;
			} else {

				console.error("Tabulator Creation Error - no element found matching selector: ", element);

				return false;
			}
		} else {

			console.error("Tabulator Creation Error - Invalid element provided:", element);

			return false;
		}
	};

	//convert depricated functionality to new functions

	Tabulator.prototype._mapDepricatedFunctionality = function () {

		//map depricated persistance setup options

		if (this.options.persistentLayout || this.options.persistentSort || this.options.persistentFilter) {

			if (!this.options.persistence) {

				this.options.persistence = {};
			}
		}

		if (this.options.downloadDataFormatter) {

			console.warn("DEPRECATION WARNING - downloadDataFormatter option has been deprecated");
		}

		if (typeof this.options.clipboardCopyHeader !== "undefined") {

			this.options.columnHeaders = this.options.clipboardCopyHeader;

			console.warn("DEPRECATION WARNING - clipboardCopyHeader option has been deprecated, please use the columnHeaders property on the clipboardCopyConfig option");
		}

		if (this.options.printVisibleRows !== true) {

			console.warn("printVisibleRows option is deprecated, you should now use the printRowRange option");

			this.options.persistence.printRowRange = "active";
		}

		if (this.options.printCopyStyle !== true) {

			console.warn("printCopyStyle option is deprecated, you should now use the printStyled option");

			this.options.persistence.printStyled = this.options.printCopyStyle;
		}

		if (this.options.persistentLayout) {

			console.warn("persistentLayout option is deprecated, you should now use the persistence option");

			if (this.options.persistence !== true && typeof this.options.persistence.columns === "undefined") {

				this.options.persistence.columns = true;
			}
		}

		if (this.options.persistentSort) {

			console.warn("persistentSort option is deprecated, you should now use the persistence option");

			if (this.options.persistence !== true && typeof this.options.persistence.sort === "undefined") {

				this.options.persistence.sort = true;
			}
		}

		if (this.options.persistentFilter) {

			console.warn("persistentFilter option is deprecated, you should now use the persistence option");

			if (this.options.persistence !== true && typeof this.options.persistence.filter === "undefined") {

				this.options.persistence.filter = true;
			}
		}

		if (this.options.columnVertAlign) {

			console.warn("columnVertAlign option is deprecated, you should now use the columnHeaderVertAlign option");

			this.options.columnHeaderVertAlign = this.options.columnVertAlign;
		}
	};

	Tabulator.prototype._clearSelection = function () {

		this.element.classList.add("tabulator-block-select");

		if (window.getSelection) {

			if (window.getSelection().empty) {
				// Chrome

				window.getSelection().empty();
			} else if (window.getSelection().removeAllRanges) {
				// Firefox

				window.getSelection().removeAllRanges();
			}
		} else if (document.selection) {
			// IE?

			document.selection.empty();
		}

		this.element.classList.remove("tabulator-block-select");
	};

	//concreate table

	Tabulator.prototype._create = function () {

		this._clearObjectPointers();

		this._mapDepricatedFunctionality();

		this.bindModules();

		if (this.element.tagName === "TABLE") {

			if (this.modExists("htmlTableImport", true)) {

				this.modules.htmlTableImport.parseTable();
			}
		}

		this.columnManager = new ColumnManager(this);

		this.rowManager = new RowManager(this);

		this.footerManager = new FooterManager(this);

		this.columnManager.setRowManager(this.rowManager);

		this.rowManager.setColumnManager(this.columnManager);

		this._buildElement();

		this._loadInitialData();
	};

	//clear pointers to objects in default config object

	Tabulator.prototype._clearObjectPointers = function () {

		this.options.columns = this.options.columns.slice(0);

		if (!this.options.reactiveData) {

			this.options.data = this.options.data.slice(0);
		}
	};

	//build tabulator element

	Tabulator.prototype._buildElement = function () {
		var _this17 = this;

		var element = this.element,
		    mod = this.modules,
		    options = this.options;

		options.tableBuilding.call(this);

		element.classList.add("tabulator");

		element.setAttribute("role", "grid");

		//empty element

		while (element.firstChild) {
			element.removeChild(element.firstChild);
		} //set table height

		if (options.height) {

			options.height = isNaN(options.height) ? options.height : options.height + "px";

			element.style.height = options.height;
		}

		//set table min height

		if (options.minHeight !== false) {

			options.minHeight = isNaN(options.minHeight) ? options.minHeight : options.minHeight + "px";

			element.style.minHeight = options.minHeight;
		}

		//set table maxHeight

		if (options.maxHeight !== false) {

			options.maxHeight = isNaN(options.maxHeight) ? options.maxHeight : options.maxHeight + "px";

			element.style.maxHeight = options.maxHeight;
		}

		this.columnManager.initialize();

		this.rowManager.initialize();

		this._detectBrowser();

		if (this.modExists("layout", true)) {

			mod.layout.initialize(options.layout);
		}

		//set localization

		if (options.headerFilterPlaceholder !== false) {

			mod.localize.setHeaderFilterPlaceholder(options.headerFilterPlaceholder);
		}

		for (var locale in options.langs) {

			mod.localize.installLang(locale, options.langs[locale]);
		}

		mod.localize.setLocale(options.locale);

		//configure placeholder element

		if (typeof options.placeholder == "string") {

			var el = document.createElement("div");

			el.classList.add("tabulator-placeholder");

			var span = document.createElement("span");

			span.innerHTML = options.placeholder;

			el.appendChild(span);

			options.placeholder = el;
		}

		//build table elements

		element.appendChild(this.columnManager.getElement());

		element.appendChild(this.rowManager.getElement());

		if (options.footerElement) {

			this.footerManager.activate();
		}

		if (options.persistence && this.modExists("persistence", true)) {

			mod.persistence.initialize();
		}

		if (options.persistence && this.modExists("persistence", true) && mod.persistence.config.columns) {

			options.columns = mod.persistence.load("columns", options.columns);
		}

		if (options.movableRows && this.modExists("moveRow")) {

			mod.moveRow.initialize();
		}

		if (options.autoColumns && this.options.data) {

			this.columnManager.generateColumnsFromRowData(this.options.data);
		}

		if (this.modExists("columnCalcs")) {

			mod.columnCalcs.initialize();
		}

		this.columnManager.setColumns(options.columns);

		if (options.dataTree && this.modExists("dataTree", true)) {

			mod.dataTree.initialize();
		}

		if (this.modExists("frozenRows")) {

			this.modules.frozenRows.initialize();
		}

		if ((options.persistence && this.modExists("persistence", true) && mod.persistence.config.sort || options.initialSort) && this.modExists("sort", true)) {

			var sorters = [];

			if (options.persistence && this.modExists("persistence", true) && mod.persistence.config.sort) {

				sorters = mod.persistence.load("sort");

				if (sorters === false && options.initialSort) {

					sorters = options.initialSort;
				}
			} else if (options.initialSort) {

				sorters = options.initialSort;
			}

			mod.sort.setSort(sorters);
		}

		if ((options.persistence && this.modExists("persistence", true) && mod.persistence.config.filter || options.initialFilter) && this.modExists("filter", true)) {

			var filters = [];

			if (options.persistence && this.modExists("persistence", true) && mod.persistence.config.filter) {

				filters = mod.persistence.load("filter");

				if (filters === false && options.initialFilter) {

					filters = options.initialFilter;
				}
			} else if (options.initialFilter) {

				filters = options.initialFilter;
			}

			mod.filter.setFilter(filters);
		}

		if (options.initialHeaderFilter && this.modExists("filter", true)) {

			options.initialHeaderFilter.forEach(function (item) {

				var column = _this17.columnManager.findColumn(item.field);

				if (column) {

					mod.filter.setHeaderFilterValue(column, item.value);
				} else {

					console.warn("Column Filter Error - No matching column found:", item.field);

					return false;
				}
			});
		}

		if (this.modExists("ajax")) {

			mod.ajax.initialize();
		}

		if (options.pagination && this.modExists("page", true)) {

			mod.page.initialize();
		}

		if (options.groupBy && this.modExists("groupRows", true)) {

			mod.groupRows.initialize();
		}

		if (this.modExists("keybindings")) {

			mod.keybindings.initialize();
		}

		if (this.modExists("selectRow")) {

			mod.selectRow.clearSelectionData(true);
		}

		if (options.autoResize && this.modExists("resizeTable")) {

			mod.resizeTable.initialize();
		}

		if (this.modExists("clipboard")) {

			mod.clipboard.initialize();
		}

		if (options.printAsHtml && this.modExists("print")) {

			mod.print.initialize();
		}

		options.tableBuilt.call(this);
	};

	Tabulator.prototype._loadInitialData = function () {

		var self = this;

		if (self.options.pagination && self.modExists("page")) {

			self.modules.page.reset(true, true);

			if (self.options.pagination == "local") {

				if (self.options.data.length) {

					self.rowManager.setData(self.options.data, false, true);
				} else {

					if ((self.options.ajaxURL || self.options.ajaxURLGenerator) && self.modExists("ajax")) {

						self.modules.ajax.loadData(false, true).then(function () {}).catch(function () {

							if (self.options.paginationInitialPage) {

								self.modules.page.setPage(self.options.paginationInitialPage);
							}
						});

						return;
					} else {

						self.rowManager.setData(self.options.data, false, true);
					}
				}

				if (self.options.paginationInitialPage) {

					self.modules.page.setPage(self.options.paginationInitialPage);
				}
			} else {

				if (self.options.ajaxURL) {

					self.modules.page.setPage(self.options.paginationInitialPage).then(function () {}).catch(function () {});
				} else {

					self.rowManager.setData([], false, true);
				}
			}
		} else {

			if (self.options.data.length) {

				self.rowManager.setData(self.options.data);
			} else {

				if ((self.options.ajaxURL || self.options.ajaxURLGenerator) && self.modExists("ajax")) {

					self.modules.ajax.loadData(false, true).then(function () {}).catch(function () {});
				} else {

					self.rowManager.setData(self.options.data, false, true);
				}
			}
		}
	};

	//deconstructor

	Tabulator.prototype.destroy = function () {

		var element = this.element;

		Tabulator.prototype.comms.deregister(this); //deregister table from inderdevice communication


		if (this.options.reactiveData && this.modExists("reactiveData", true)) {

			this.modules.reactiveData.unwatchData();
		}

		//clear row data

		this.rowManager.rows.forEach(function (row) {

			row.wipe();
		});

		this.rowManager.rows = [];

		this.rowManager.activeRows = [];

		this.rowManager.displayRows = [];

		//clear event bindings

		if (this.options.autoResize && this.modExists("resizeTable")) {

			this.modules.resizeTable.clearBindings();
		}

		if (this.modExists("keybindings")) {

			this.modules.keybindings.clearBindings();
		}

		//clear DOM

		while (element.firstChild) {
			element.removeChild(element.firstChild);
		}element.classList.remove("tabulator");
	};

	Tabulator.prototype._detectBrowser = function () {

		var ua = navigator.userAgent || navigator.vendor || window.opera;

		if (ua.indexOf("Trident") > -1) {

			this.browser = "ie";

			this.browserSlow = true;
		} else if (ua.indexOf("Edge") > -1) {

			this.browser = "edge";

			this.browserSlow = true;
		} else if (ua.indexOf("Firefox") > -1) {

			this.browser = "firefox";

			this.browserSlow = false;
		} else {

			this.browser = "other";

			this.browserSlow = false;
		}

		this.browserMobile = /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(ua) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(ua.substr(0, 4));
	};

	////////////////// Data Handling //////////////////


	//block table redrawing

	Tabulator.prototype.blockRedraw = function () {

		return this.rowManager.blockRedraw();
	};

	//restore table redrawing

	Tabulator.prototype.restoreRedraw = function () {

		return this.rowManager.restoreRedraw();
	};

	//local data from local file

	Tabulator.prototype.setDataFromLocalFile = function (extensions) {
		var _this18 = this;

		return new Promise(function (resolve, reject) {

			var input = document.createElement("input");

			input.type = "file";

			input.accept = extensions || ".json,application/json";

			input.addEventListener("change", function (e) {

				var file = input.files[0],
				    reader = new FileReader(),
				    data;

				reader.readAsText(file);

				reader.onload = function (e) {

					try {

						data = JSON.parse(reader.result);
					} catch (e) {

						console.warn("File Load Error - File contents is invalid JSON", e);

						reject(e);

						return;
					}

					_this18._setData(data).then(function (data) {

						resolve(data);
					}).catch(function (err) {

						resolve(err);
					});
				};

				reader.onerror = function (e) {

					console.warn("File Load Error - Unable to read file");

					reject();
				};
			});

			input.click();
		});
	};

	//load data

	Tabulator.prototype.setData = function (data, params, config) {

		if (this.modExists("ajax")) {

			this.modules.ajax.blockActiveRequest();
		}

		return this._setData(data, params, config, false, true);
	};

	Tabulator.prototype._setData = function (data, params, config, inPosition, columnsChanged) {

		var self = this;

		if (typeof data === "string") {

			if (data.indexOf("{") == 0 || data.indexOf("[") == 0) {

				//data is a json encoded string

				return self.rowManager.setData(JSON.parse(data), inPosition, columnsChanged);
			} else {

				if (self.modExists("ajax", true)) {

					if (params) {

						self.modules.ajax.setParams(params);
					}

					if (config) {

						self.modules.ajax.setConfig(config);
					}

					self.modules.ajax.setUrl(data);

					if (self.options.pagination == "remote" && self.modExists("page", true)) {

						self.modules.page.reset(true, true);

						return self.modules.page.setPage(1);
					} else {

						//assume data is url, make ajax call to url to get data

						return self.modules.ajax.loadData(inPosition, columnsChanged);
					}
				}
			}
		} else {

			if (data) {

				//asume data is already an object

				return self.rowManager.setData(data, inPosition, columnsChanged);
			} else {

				//no data provided, check if ajaxURL is present;

				if (self.modExists("ajax") && (self.modules.ajax.getUrl || self.options.ajaxURLGenerator)) {

					if (self.options.pagination == "remote" && self.modExists("page", true)) {

						self.modules.page.reset(true, true);

						return self.modules.page.setPage(1);
					} else {

						return self.modules.ajax.loadData(inPosition, columnsChanged);
					}
				} else {

					//empty data

					return self.rowManager.setData([], inPosition, columnsChanged);
				}
			}
		}
	};

	//clear data

	Tabulator.prototype.clearData = function () {

		if (this.modExists("ajax")) {

			this.modules.ajax.blockActiveRequest();
		}

		this.rowManager.clearData();
	};

	//get table data array

	Tabulator.prototype.getData = function (active) {

		if (active === true) {

			console.warn("passing a boolean to the getData function is deprecated, you should now pass the string 'active'");

			active = "active";
		}

		return this.rowManager.getData(active);
	};

	//get table data array count

	Tabulator.prototype.getDataCount = function (active) {

		if (active === true) {

			console.warn("passing a boolean to the getDataCount function is deprecated, you should now pass the string 'active'");

			active = "active";
		}

		return this.rowManager.getDataCount(active);
	};

	//search for specific row components

	Tabulator.prototype.searchRows = function (field, type, value) {

		if (this.modExists("filter", true)) {

			return this.modules.filter.search("rows", field, type, value);
		}
	};

	//search for specific data

	Tabulator.prototype.searchData = function (field, type, value) {

		if (this.modExists("filter", true)) {

			return this.modules.filter.search("data", field, type, value);
		}
	};

	//get table html

	Tabulator.prototype.getHtml = function (visible, style, config) {

		if (this.modExists("export", true)) {

			return this.modules.export.getHtml(visible, style, config);
		}
	};

	//get print html

	Tabulator.prototype.print = function (visible, style, config) {

		if (this.modExists("print", true)) {

			return this.modules.print.printFullscreen(visible, style, config);
		}
	};

	//retrieve Ajax URL

	Tabulator.prototype.getAjaxUrl = function () {

		if (this.modExists("ajax", true)) {

			return this.modules.ajax.getUrl();
		}
	};

	//replace data, keeping table in position with same sort

	Tabulator.prototype.replaceData = function (data, params, config) {

		if (this.modExists("ajax")) {

			this.modules.ajax.blockActiveRequest();
		}

		return this._setData(data, params, config, true);
	};

	//update table data

	Tabulator.prototype.updateData = function (data) {
		var _this19 = this;

		var self = this;

		var responses = 0;

		return new Promise(function (resolve, reject) {

			if (_this19.modExists("ajax")) {

				_this19.modules.ajax.blockActiveRequest();
			}

			if (typeof data === "string") {

				data = JSON.parse(data);
			}

			if (data) {

				data.forEach(function (item) {

					var row = self.rowManager.findRow(item[self.options.index]);

					if (row) {

						responses++;

						row.updateData(item).then(function () {

							responses--;

							if (!responses) {

								resolve();
							}
						});
					}
				});
			} else {

				console.warn("Update Error - No data provided");

				reject("Update Error - No data provided");
			}
		});
	};

	Tabulator.prototype.addData = function (data, pos, index) {
		var _this20 = this;

		return new Promise(function (resolve, reject) {

			if (_this20.modExists("ajax")) {

				_this20.modules.ajax.blockActiveRequest();
			}

			if (typeof data === "string") {

				data = JSON.parse(data);
			}

			if (data) {

				_this20.rowManager.addRows(data, pos, index).then(function (rows) {

					var output = [];

					rows.forEach(function (row) {

						output.push(row.getComponent());
					});

					resolve(output);
				});
			} else {

				console.warn("Update Error - No data provided");

				reject("Update Error - No data provided");
			}
		});
	};

	//update table data

	Tabulator.prototype.updateOrAddData = function (data) {
		var _this21 = this;

		var self = this,
		    rows = [],
		    responses = 0;

		return new Promise(function (resolve, reject) {

			if (_this21.modExists("ajax")) {

				_this21.modules.ajax.blockActiveRequest();
			}

			if (typeof data === "string") {

				data = JSON.parse(data);
			}

			if (data) {

				data.forEach(function (item) {

					var row = self.rowManager.findRow(item[self.options.index]);

					responses++;

					if (row) {

						row.updateData(item).then(function () {

							responses--;

							rows.push(row.getComponent());

							if (!responses) {

								resolve(rows);
							}
						});
					} else {

						self.rowManager.addRows(item).then(function (newRows) {

							responses--;

							rows.push(newRows[0].getComponent());

							if (!responses) {

								resolve(rows);
							}
						});
					}
				});
			} else {

				console.warn("Update Error - No data provided");

				reject("Update Error - No data provided");
			}
		});
	};

	//get row object

	Tabulator.prototype.getRow = function (index) {

		var row = this.rowManager.findRow(index);

		if (row) {

			return row.getComponent();
		} else {

			console.warn("Find Error - No matching row found:", index);

			return false;
		}
	};

	//get row object

	Tabulator.prototype.getRowFromPosition = function (position, active) {

		var row = this.rowManager.getRowFromPosition(position, active);

		if (row) {

			return row.getComponent();
		} else {

			console.warn("Find Error - No matching row found:", position);

			return false;
		}
	};

	//delete row from table

	Tabulator.prototype.deleteRow = function (index) {
		var _this22 = this;

		return new Promise(function (resolve, reject) {

			var self = _this22,
			    count = 0,
			    successCount = 0,
			    foundRows = [];

			function doneCheck() {

				count++;

				if (count == index.length) {

					if (successCount) {

						self.rowManager.reRenderInPosition();

						resolve();
					}
				}
			}

			if (!Array.isArray(index)) {

				index = [index];
			}

			//find matching rows

			index.forEach(function (item) {

				var row = _this22.rowManager.findRow(item, true);

				if (row) {

					foundRows.push(row);
				} else {

					console.warn("Delete Error - No matching row found:", item);

					reject("Delete Error - No matching row found");

					doneCheck();
				}
			});

			//sort rows into correct order to ensure smooth delete from table

			foundRows.sort(function (a, b) {

				return _this22.rowManager.rows.indexOf(a) > _this22.rowManager.rows.indexOf(b) ? 1 : -1;
			});

			foundRows.forEach(function (row) {

				row.delete().then(function () {

					successCount++;

					doneCheck();
				}).catch(function (err) {

					doneCheck();

					reject(err);
				});
			});
		});
	};

	//add row to table

	Tabulator.prototype.addRow = function (data, pos, index) {
		var _this23 = this;

		return new Promise(function (resolve, reject) {

			if (typeof data === "string") {

				data = JSON.parse(data);
			}

			_this23.rowManager.addRows(data, pos, index).then(function (rows) {

				//recalc column calculations if present

				if (_this23.modExists("columnCalcs")) {

					_this23.modules.columnCalcs.recalc(_this23.rowManager.activeRows);
				}

				resolve(rows[0].getComponent());
			});
		});
	};

	//update a row if it exitsts otherwise create it

	Tabulator.prototype.updateOrAddRow = function (index, data) {
		var _this24 = this;

		return new Promise(function (resolve, reject) {

			var row = _this24.rowManager.findRow(index);

			if (typeof data === "string") {

				data = JSON.parse(data);
			}

			if (row) {

				row.updateData(data).then(function () {

					//recalc column calculations if present

					if (_this24.modExists("columnCalcs")) {

						_this24.modules.columnCalcs.recalc(_this24.rowManager.activeRows);
					}

					resolve(row.getComponent());
				}).catch(function (err) {

					reject(err);
				});
			} else {

				row = _this24.rowManager.addRows(data).then(function (rows) {

					//recalc column calculations if present

					if (_this24.modExists("columnCalcs")) {

						_this24.modules.columnCalcs.recalc(_this24.rowManager.activeRows);
					}

					resolve(rows[0].getComponent());
				}).catch(function (err) {

					reject(err);
				});
			}
		});
	};

	//update row data

	Tabulator.prototype.updateRow = function (index, data) {
		var _this25 = this;

		return new Promise(function (resolve, reject) {

			var row = _this25.rowManager.findRow(index);

			if (typeof data === "string") {

				data = JSON.parse(data);
			}

			if (row) {

				row.updateData(data).then(function () {

					resolve(row.getComponent());
				}).catch(function (err) {

					reject(err);
				});
			} else {

				console.warn("Update Error - No matching row found:", index);

				reject("Update Error - No matching row found");
			}
		});
	};

	//scroll to row in DOM

	Tabulator.prototype.scrollToRow = function (index, position, ifVisible) {
		var _this26 = this;

		return new Promise(function (resolve, reject) {

			var row = _this26.rowManager.findRow(index);

			if (row) {

				_this26.rowManager.scrollToRow(row, position, ifVisible).then(function () {

					resolve();
				}).catch(function (err) {

					reject(err);
				});
			} else {

				console.warn("Scroll Error - No matching row found:", index);

				reject("Scroll Error - No matching row found");
			}
		});
	};

	Tabulator.prototype.moveRow = function (from, to, after) {

		var fromRow = this.rowManager.findRow(from);

		if (fromRow) {

			fromRow.moveToRow(to, after);
		} else {

			console.warn("Move Error - No matching row found:", from);
		}
	};

	Tabulator.prototype.getRows = function (active) {

		if (active === true) {

			console.warn("passing a boolean to the getRows function is deprecated, you should now pass the string 'active'");

			active = "active";
		}

		return this.rowManager.getComponents(active);
	};

	//get position of row in table

	Tabulator.prototype.getRowPosition = function (index, active) {

		var row = this.rowManager.findRow(index);

		if (row) {

			return this.rowManager.getRowPosition(row, active);
		} else {

			console.warn("Position Error - No matching row found:", index);

			return false;
		}
	};

	//copy table data to clipboard

	Tabulator.prototype.copyToClipboard = function (selector) {

		if (this.modExists("clipboard", true)) {

			this.modules.clipboard.copy(selector);
		}
	};

	/////////////// Column Functions  ///////////////


	Tabulator.prototype.setColumns = function (definition) {

		this.columnManager.setColumns(definition);
	};

	Tabulator.prototype.getColumns = function (structured) {

		return this.columnManager.getComponents(structured);
	};

	Tabulator.prototype.getColumn = function (field) {

		var col = this.columnManager.findColumn(field);

		if (col) {

			return col.getComponent();
		} else {

			console.warn("Find Error - No matching column found:", field);

			return false;
		}
	};

	Tabulator.prototype.getColumnDefinitions = function () {

		return this.columnManager.getDefinitionTree();
	};

	Tabulator.prototype.getColumnLayout = function () {

		if (this.modExists("persistence", true)) {

			return this.modules.persistence.parseColumns(this.columnManager.getColumns());
		}
	};

	Tabulator.prototype.setColumnLayout = function (layout) {

		if (this.modExists("persistence", true)) {

			this.columnManager.setColumns(this.modules.persistence.mergeDefinition(this.options.columns, layout));

			return true;
		}

		return false;
	};

	Tabulator.prototype.showColumn = function (field) {

		var column = this.columnManager.findColumn(field);

		if (column) {

			column.show();

			if (this.options.responsiveLayout && this.modExists("responsiveLayout", true)) {

				this.modules.responsiveLayout.update();
			}
		} else {

			console.warn("Column Show Error - No matching column found:", field);

			return false;
		}
	};

	Tabulator.prototype.hideColumn = function (field) {

		var column = this.columnManager.findColumn(field);

		if (column) {

			column.hide();

			if (this.options.responsiveLayout && this.modExists("responsiveLayout", true)) {

				this.modules.responsiveLayout.update();
			}
		} else {

			console.warn("Column Hide Error - No matching column found:", field);

			return false;
		}
	};

	Tabulator.prototype.toggleColumn = function (field) {

		var column = this.columnManager.findColumn(field);

		if (column) {

			if (column.visible) {

				column.hide();
			} else {

				column.show();
			}
		} else {

			console.warn("Column Visibility Toggle Error - No matching column found:", field);

			return false;
		}
	};

	Tabulator.prototype.addColumn = function (definition, before, field) {
		var _this27 = this;

		return new Promise(function (resolve, reject) {

			var column = _this27.columnManager.findColumn(field);

			_this27.columnManager.addColumn(definition, before, column).then(function (column) {

				resolve(column.getComponent());
			}).catch(function (err) {

				reject(err);
			});
		});
	};

	Tabulator.prototype.deleteColumn = function (field) {
		var _this28 = this;

		return new Promise(function (resolve, reject) {

			var column = _this28.columnManager.findColumn(field);

			if (column) {

				column.delete().then(function () {

					resolve();
				}).catch(function (err) {

					reject(err);
				});
			} else {

				console.warn("Column Delete Error - No matching column found:", field);

				reject();
			}
		});
	};

	Tabulator.prototype.updateColumnDefinition = function (field, definition) {
		var _this29 = this;

		return new Promise(function (resolve, reject) {

			var column = _this29.columnManager.findColumn(field);

			if (column) {

				column.updateDefinition(definition).then(function (col) {

					resolve(col);
				}).catch(function (err) {

					reject(err);
				});
			} else {

				console.warn("Column Update Error - No matching column found:", field);

				reject();
			}
		});
	};

	Tabulator.prototype.moveColumn = function (from, to, after) {

		var fromColumn = this.columnManager.findColumn(from);

		var toColumn = this.columnManager.findColumn(to);

		if (fromColumn) {

			if (toColumn) {

				this.columnManager.moveColumn(fromColumn, toColumn, after);
			} else {

				console.warn("Move Error - No matching column found:", toColumn);
			}
		} else {

			console.warn("Move Error - No matching column found:", from);
		}
	};

	//scroll to column in DOM

	Tabulator.prototype.scrollToColumn = function (field, position, ifVisible) {
		var _this30 = this;

		return new Promise(function (resolve, reject) {

			var column = _this30.columnManager.findColumn(field);

			if (column) {

				_this30.columnManager.scrollToColumn(column, position, ifVisible).then(function () {

					resolve();
				}).catch(function (err) {

					reject(err);
				});
			} else {

				console.warn("Scroll Error - No matching column found:", field);

				reject("Scroll Error - No matching column found");
			}
		});
	};

	//////////// Localization Functions  ////////////

	Tabulator.prototype.setLocale = function (locale) {

		this.modules.localize.setLocale(locale);
	};

	Tabulator.prototype.getLocale = function () {

		return this.modules.localize.getLocale();
	};

	Tabulator.prototype.getLang = function (locale) {

		return this.modules.localize.getLang(locale);
	};

	//////////// General Public Functions ////////////


	//redraw list without updating data

	Tabulator.prototype.redraw = function (force) {

		this.columnManager.redraw(force);

		this.rowManager.redraw(force);
	};

	Tabulator.prototype.setHeight = function (height) {

		if (this.rowManager.renderMode !== "classic") {

			this.options.height = isNaN(height) ? height : height + "px";

			this.element.style.height = this.options.height;

			this.rowManager.setRenderMode();

			this.rowManager.redraw();
		} else {

			console.warn("setHeight function is not available in classic render mode");
		}
	};

	///////////////////// Sorting ////////////////////


	//trigger sort

	Tabulator.prototype.setSort = function (sortList, dir) {

		if (this.modExists("sort", true)) {

			this.modules.sort.setSort(sortList, dir);

			this.rowManager.sorterRefresh();
		}
	};

	Tabulator.prototype.getSorters = function () {

		if (this.modExists("sort", true)) {

			return this.modules.sort.getSort();
		}
	};

	Tabulator.prototype.clearSort = function () {

		if (this.modExists("sort", true)) {

			this.modules.sort.clear();

			this.rowManager.sorterRefresh();
		}
	};

	///////////////////// Filtering ////////////////////


	//set standard filters

	Tabulator.prototype.setFilter = function (field, type, value, params) {

		if (this.modExists("filter", true)) {

			this.modules.filter.setFilter(field, type, value, params);

			this.rowManager.filterRefresh();
		}
	};

	//add filter to array

	Tabulator.prototype.addFilter = function (field, type, value, params) {

		if (this.modExists("filter", true)) {

			this.modules.filter.addFilter(field, type, value, params);

			this.rowManager.filterRefresh();
		}
	};

	//get all filters

	Tabulator.prototype.getFilters = function (all) {

		if (this.modExists("filter", true)) {

			return this.modules.filter.getFilters(all);
		}
	};

	Tabulator.prototype.setHeaderFilterFocus = function (field) {

		if (this.modExists("filter", true)) {

			var column = this.columnManager.findColumn(field);

			if (column) {

				this.modules.filter.setHeaderFilterFocus(column);
			} else {

				console.warn("Column Filter Focus Error - No matching column found:", field);

				return false;
			}
		}
	};

	Tabulator.prototype.getHeaderFilterValue = function (field) {

		if (this.modExists("filter", true)) {

			var column = this.columnManager.findColumn(field);

			if (column) {

				return this.modules.filter.getHeaderFilterValue(column);
			} else {

				console.warn("Column Filter Error - No matching column found:", field);
			}
		}
	};

	Tabulator.prototype.setHeaderFilterValue = function (field, value) {

		if (this.modExists("filter", true)) {

			var column = this.columnManager.findColumn(field);

			if (column) {

				this.modules.filter.setHeaderFilterValue(column, value);
			} else {

				console.warn("Column Filter Error - No matching column found:", field);

				return false;
			}
		}
	};

	Tabulator.prototype.getHeaderFilters = function () {

		if (this.modExists("filter", true)) {

			return this.modules.filter.getHeaderFilters();
		}
	};

	//remove filter from array

	Tabulator.prototype.removeFilter = function (field, type, value) {

		if (this.modExists("filter", true)) {

			this.modules.filter.removeFilter(field, type, value);

			this.rowManager.filterRefresh();
		}
	};

	//clear filters

	Tabulator.prototype.clearFilter = function (all) {

		if (this.modExists("filter", true)) {

			this.modules.filter.clearFilter(all);

			this.rowManager.filterRefresh();
		}
	};

	//clear header filters

	Tabulator.prototype.clearHeaderFilter = function () {

		if (this.modExists("filter", true)) {

			this.modules.filter.clearHeaderFilter();

			this.rowManager.filterRefresh();
		}
	};

	///////////////////// select ////////////////////

	Tabulator.prototype.selectRow = function (rows) {

		if (this.modExists("selectRow", true)) {

			if (rows === true) {

				console.warn("passing a boolean to the selectRowselectRow function is deprecated, you should now pass the string 'active'");

				rows = "active";
			}

			this.modules.selectRow.selectRows(rows);
		}
	};

	Tabulator.prototype.deselectRow = function (rows) {

		if (this.modExists("selectRow", true)) {

			this.modules.selectRow.deselectRows(rows);
		}
	};

	Tabulator.prototype.toggleSelectRow = function (row) {

		if (this.modExists("selectRow", true)) {

			this.modules.selectRow.toggleRow(row);
		}
	};

	Tabulator.prototype.getSelectedRows = function () {

		if (this.modExists("selectRow", true)) {

			return this.modules.selectRow.getSelectedRows();
		}
	};

	Tabulator.prototype.getSelectedData = function () {

		if (this.modExists("selectRow", true)) {

			return this.modules.selectRow.getSelectedData();
		}
	};

	///////////////////// validation  ////////////////////

	Tabulator.prototype.getInvalidCells = function () {

		if (this.modExists("validate", true)) {

			return this.modules.validate.getInvalidCells();
		}
	};

	Tabulator.prototype.clearCellValidation = function (cells) {
		var _this31 = this;

		if (this.modExists("validate", true)) {

			if (!cells) {

				cells = this.modules.validate.getInvalidCells();
			}

			if (!Array.isArray(cells)) {

				cells = [cells];
			}

			cells.forEach(function (cell) {

				_this31.modules.validate.clearValidation(cell._getSelf());
			});
		}
	};

	Tabulator.prototype.validate = function (cells) {

		var output = [];

		//clear row data

		this.rowManager.rows.forEach(function (row) {

			var valid = row.validate();

			if (valid !== true) {

				output = output.concat(valid);
			}
		});

		return output.length ? output : true;
	};

	//////////// Pagination Functions  ////////////


	Tabulator.prototype.setMaxPage = function (max) {

		if (this.options.pagination && this.modExists("page")) {

			this.modules.page.setMaxPage(max);
		} else {

			return false;
		}
	};

	Tabulator.prototype.setPage = function (page) {

		if (this.options.pagination && this.modExists("page")) {

			return this.modules.page.setPage(page);
		} else {

			return new Promise(function (resolve, reject) {
				reject();
			});
		}
	};

	Tabulator.prototype.setPageToRow = function (row) {
		var _this32 = this;

		return new Promise(function (resolve, reject) {

			if (_this32.options.pagination && _this32.modExists("page")) {

				row = _this32.rowManager.findRow(row);

				if (row) {

					_this32.modules.page.setPageToRow(row).then(function () {

						resolve();
					}).catch(function () {

						reject();
					});
				} else {

					reject();
				}
			} else {

				reject();
			}
		});
	};

	Tabulator.prototype.setPageSize = function (size) {

		if (this.options.pagination && this.modExists("page")) {

			this.modules.page.setPageSize(size);

			this.modules.page.setPage(1).then(function () {}).catch(function () {});
		} else {

			return false;
		}
	};

	Tabulator.prototype.getPageSize = function () {

		if (this.options.pagination && this.modExists("page", true)) {

			return this.modules.page.getPageSize();
		}
	};

	Tabulator.prototype.previousPage = function () {

		if (this.options.pagination && this.modExists("page")) {

			this.modules.page.previousPage();
		} else {

			return false;
		}
	};

	Tabulator.prototype.nextPage = function () {

		if (this.options.pagination && this.modExists("page")) {

			this.modules.page.nextPage();
		} else {

			return false;
		}
	};

	Tabulator.prototype.getPage = function () {

		if (this.options.pagination && this.modExists("page")) {

			return this.modules.page.getPage();
		} else {

			return false;
		}
	};

	Tabulator.prototype.getPageMax = function () {

		if (this.options.pagination && this.modExists("page")) {

			return this.modules.page.getPageMax();
		} else {

			return false;
		}
	};

	///////////////// Grouping Functions ///////////////


	Tabulator.prototype.setGroupBy = function (groups) {

		if (this.modExists("groupRows", true)) {

			this.options.groupBy = groups;

			this.modules.groupRows.initialize();

			this.rowManager.refreshActiveData("display");

			if (this.options.persistence && this.modExists("persistence", true) && this.modules.persistence.config.group) {

				this.modules.persistence.save("group");
			}
		} else {

			return false;
		}
	};

	Tabulator.prototype.setGroupStartOpen = function (values) {

		if (this.modExists("groupRows", true)) {

			this.options.groupStartOpen = values;

			this.modules.groupRows.initialize();

			if (this.options.groupBy) {

				this.rowManager.refreshActiveData("group");

				if (this.options.persistence && this.modExists("persistence", true) && this.modules.persistence.config.group) {

					this.modules.persistence.save("group");
				}
			} else {

				console.warn("Grouping Update - cant refresh view, no groups have been set");
			}
		} else {

			return false;
		}
	};

	Tabulator.prototype.setGroupHeader = function (values) {

		if (this.modExists("groupRows", true)) {

			this.options.groupHeader = values;

			this.modules.groupRows.initialize();

			if (this.options.groupBy) {

				this.rowManager.refreshActiveData("group");

				if (this.options.persistence && this.modExists("persistence", true) && this.modules.persistence.config.group) {

					this.modules.persistence.save("group");
				}
			} else {

				console.warn("Grouping Update - cant refresh view, no groups have been set");
			}
		} else {

			return false;
		}
	};

	Tabulator.prototype.getGroups = function (values) {

		if (this.modExists("groupRows", true)) {

			return this.modules.groupRows.getGroups(true);
		} else {

			return false;
		}
	};

	// get grouped table data in the same format as getData()

	Tabulator.prototype.getGroupedData = function () {

		if (this.modExists("groupRows", true)) {

			return this.options.groupBy ? this.modules.groupRows.getGroupedData() : this.getData();
		}
	};

	Tabulator.prototype.getEditedCells = function () {

		if (this.modExists("edit", true)) {

			return this.modules.edit.getEditedCells();
		}
	};

	Tabulator.prototype.clearCellEdited = function (cells) {
		var _this33 = this;

		if (this.modExists("edit", true)) {

			if (!cells) {

				cells = this.modules.edit.getEditedCells();
			}

			if (!Array.isArray(cells)) {

				cells = [cells];
			}

			cells.forEach(function (cell) {

				_this33.modules.edit.clearEdited(cell._getSelf());
			});
		}
	};

	///////////////// Column Calculation Functions ///////////////

	Tabulator.prototype.getCalcResults = function () {

		if (this.modExists("columnCalcs", true)) {

			return this.modules.columnCalcs.getResults();
		} else {

			return false;
		}
	};

	Tabulator.prototype.recalc = function () {

		if (this.modExists("columnCalcs", true)) {

			this.modules.columnCalcs.recalcAll(this.rowManager.activeRows);
		}
	};

	/////////////// Navigation Management //////////////


	Tabulator.prototype.navigatePrev = function () {

		var cell = false;

		if (this.modExists("edit", true)) {

			cell = this.modules.edit.currentCell;

			if (cell) {

				return cell.nav().prev();
			}
		}

		return false;
	};

	Tabulator.prototype.navigateNext = function () {

		var cell = false;

		if (this.modExists("edit", true)) {

			cell = this.modules.edit.currentCell;

			if (cell) {

				return cell.nav().next();
			}
		}

		return false;
	};

	Tabulator.prototype.navigateLeft = function () {

		var cell = false;

		if (this.modExists("edit", true)) {

			cell = this.modules.edit.currentCell;

			if (cell) {

				e.preventDefault();

				return cell.nav().left();
			}
		}

		return false;
	};

	Tabulator.prototype.navigateRight = function () {

		var cell = false;

		if (this.modExists("edit", true)) {

			cell = this.modules.edit.currentCell;

			if (cell) {

				e.preventDefault();

				return cell.nav().right();
			}
		}

		return false;
	};

	Tabulator.prototype.navigateUp = function () {

		var cell = false;

		if (this.modExists("edit", true)) {

			cell = this.modules.edit.currentCell;

			if (cell) {

				e.preventDefault();

				return cell.nav().up();
			}
		}

		return false;
	};

	Tabulator.prototype.navigateDown = function () {

		var cell = false;

		if (this.modExists("edit", true)) {

			cell = this.modules.edit.currentCell;

			if (cell) {

				e.preventDefault();

				return cell.nav().down();
			}
		}

		return false;
	};

	/////////////// History Management //////////////

	Tabulator.prototype.undo = function () {

		if (this.options.history && this.modExists("history", true)) {

			return this.modules.history.undo();
		} else {

			return false;
		}
	};

	Tabulator.prototype.redo = function () {

		if (this.options.history && this.modExists("history", true)) {

			return this.modules.history.redo();
		} else {

			return false;
		}
	};

	Tabulator.prototype.getHistoryUndoSize = function () {

		if (this.options.history && this.modExists("history", true)) {

			return this.modules.history.getHistoryUndoSize();
		} else {

			return false;
		}
	};

	Tabulator.prototype.getHistoryRedoSize = function () {

		if (this.options.history && this.modExists("history", true)) {

			return this.modules.history.getHistoryRedoSize();
		} else {

			return false;
		}
	};

	/////////////// Download Management //////////////


	Tabulator.prototype.download = function (type, filename, options, active) {

		if (this.modExists("download", true)) {

			this.modules.download.download(type, filename, options, active);
		}
	};

	Tabulator.prototype.downloadToTab = function (type, filename, options, active) {

		if (this.modExists("download", true)) {

			this.modules.download.download(type, filename, options, active, true);
		}
	};

	/////////// Inter Table Communications ///////////


	Tabulator.prototype.tableComms = function (table, module, action, data) {

		this.modules.comms.receive(table, module, action, data);
	};

	////////////// Extension Management //////////////


	//object to hold module

	Tabulator.prototype.moduleBindings = {};

	//extend module

	Tabulator.prototype.extendModule = function (name, property, values) {

		if (Tabulator.prototype.moduleBindings[name]) {

			var source = Tabulator.prototype.moduleBindings[name].prototype[property];

			if (source) {

				if ((typeof values === 'undefined' ? 'undefined' : _typeof(values)) == "object") {

					for (var key in values) {

						source[key] = values[key];
					}
				} else {

					console.warn("Module Error - Invalid value type, it must be an object");
				}
			} else {

				console.warn("Module Error - property does not exist:", property);
			}
		} else {

			console.warn("Module Error - module does not exist:", name);
		}
	};

	//add module to tabulator

	Tabulator.prototype.registerModule = function (name, module) {

		var self = this;

		Tabulator.prototype.moduleBindings[name] = module;
	};

	//ensure that module are bound to instantiated function

	Tabulator.prototype.bindModules = function () {

		this.modules = {};

		for (var name in Tabulator.prototype.moduleBindings) {

			this.modules[name] = new Tabulator.prototype.moduleBindings[name](this);
		}
	};

	//Check for module

	Tabulator.prototype.modExists = function (plugin, required) {

		if (this.modules[plugin]) {

			return true;
		} else {

			if (required) {

				console.error("Tabulator Module Not Installed: " + plugin);
			}

			return false;
		}
	};

	Tabulator.prototype.helpers = {

		elVisible: function elVisible(el) {

			return !(el.offsetWidth <= 0 && el.offsetHeight <= 0);
		},

		elOffset: function elOffset(el) {

			var box = el.getBoundingClientRect();

			return {

				top: box.top + window.pageYOffset - document.documentElement.clientTop,

				left: box.left + window.pageXOffset - document.documentElement.clientLeft

			};
		},

		deepClone: function deepClone(obj) {

			var clone = Array.isArray(obj) ? [] : {};

			for (var i in obj) {

				if (obj[i] != null && _typeof(obj[i]) === "object") {

					if (obj[i] instanceof Date) {

						clone[i] = new Date(obj[i]);
					} else {

						clone[i] = this.deepClone(obj[i]);
					}
				} else {

					clone[i] = obj[i];
				}
			}

			return clone;
		}

	};

	Tabulator.prototype.comms = {

		tables: [],

		register: function register(table) {

			Tabulator.prototype.comms.tables.push(table);
		},

		deregister: function deregister(table) {

			var index = Tabulator.prototype.comms.tables.indexOf(table);

			if (index > -1) {

				Tabulator.prototype.comms.tables.splice(index, 1);
			}
		},

		lookupTable: function lookupTable(query, silent) {

			var results = [],
			    matches,
			    match;

			if (typeof query === "string") {

				matches = document.querySelectorAll(query);

				if (matches.length) {

					for (var i = 0; i < matches.length; i++) {

						match = Tabulator.prototype.comms.matchElement(matches[i]);

						if (match) {

							results.push(match);
						}
					}
				}
			} else if (typeof HTMLElement !== "undefined" && query instanceof HTMLElement || query instanceof Tabulator) {

				match = Tabulator.prototype.comms.matchElement(query);

				if (match) {

					results.push(match);
				}
			} else if (Array.isArray(query)) {

				query.forEach(function (item) {

					results = results.concat(Tabulator.prototype.comms.lookupTable(item));
				});
			} else {

				if (!silent) {

					console.warn("Table Connection Error - Invalid Selector", query);
				}
			}

			return results;
		},

		matchElement: function matchElement(element) {

			return Tabulator.prototype.comms.tables.find(function (table) {

				return element instanceof Tabulator ? table === element : table.element === element;
			});
		}

	};

	Tabulator.prototype.findTable = function (query) {

		var results = Tabulator.prototype.comms.lookupTable(query, true);

		return Array.isArray(results) && !results.length ? false : results;
	};

	var Layout = function Layout(table) {

		this.table = table;

		this.mode = null;
	};

	//initialize layout system


	Layout.prototype.initialize = function (layout) {

		if (this.modes[layout]) {

			this.mode = layout;
		} else {

			console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : " + layout);

			this.mode = 'fitData';
		}

		this.table.element.setAttribute("tabulator-layout", this.mode);
	};

	Layout.prototype.getMode = function () {

		return this.mode;
	};

	//trigger table layout


	Layout.prototype.layout = function () {

		this.modes[this.mode].call(this, this.table.columnManager.columnsByIndex);
	};

	//layout render functions


	Layout.prototype.modes = {

		//resize columns to fit data they contain


		"fitData": function fitData(columns) {

			columns.forEach(function (column) {

				column.reinitializeWidth();
			});

			if (this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

				this.table.modules.responsiveLayout.update();
			}
		},

		//resize columns to fit data they contain and stretch row to fill table


		"fitDataFill": function fitDataFill(columns) {

			columns.forEach(function (column) {

				column.reinitializeWidth();
			});

			if (this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

				this.table.modules.responsiveLayout.update();
			}
		},

		//resize columns to fit data they contain


		"fitDataTable": function fitDataTable(columns) {

			columns.forEach(function (column) {

				column.reinitializeWidth();
			});

			if (this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

				this.table.modules.responsiveLayout.update();
			}
		},

		//resize columns to fit data the contain and stretch last column to fill table


		"fitDataStretch": function fitDataStretch(columns) {
			var _this34 = this;

			var colsWidth = 0,
			    tableWidth = this.table.rowManager.element.clientWidth,
			    gap = 0,
			    lastCol = false;

			columns.forEach(function (column, i) {

				if (!column.widthFixed) {

					column.reinitializeWidth();
				}

				if (_this34.table.options.responsiveLayout ? column.modules.responsive.visible : column.visible) {

					lastCol = column;
				}

				if (column.visible) {

					colsWidth += column.getWidth();
				}
			});

			if (lastCol) {

				gap = tableWidth - colsWidth + lastCol.getWidth();

				if (this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

					lastCol.setWidth(0);

					this.table.modules.responsiveLayout.update();
				}

				if (gap > 0) {

					lastCol.setWidth(gap);
				} else {

					lastCol.reinitializeWidth();
				}
			} else {

				if (this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

					this.table.modules.responsiveLayout.update();
				}
			}
		},

		//resize columns to fit


		"fitColumns": function fitColumns(columns) {

			var self = this;

			var totalWidth = self.table.element.clientWidth; //table element width


			var fixedWidth = 0; //total width of columns with a defined width


			var flexWidth = 0; //total width available to flexible columns


			var flexGrowUnits = 0; //total number of widthGrow blocks accross all columns


			var flexColWidth = 0; //desired width of flexible columns


			var flexColumns = []; //array of flexible width columns


			var fixedShrinkColumns = []; //array of fixed width columns that can shrink


			var flexShrinkUnits = 0; //total number of widthShrink blocks accross all columns


			var overflowWidth = 0; //horizontal overflow width


			var gapFill = 0; //number of pixels to be added to final column to close and half pixel gaps


			function calcWidth(width) {

				var colWidth;

				if (typeof width == "string") {

					if (width.indexOf("%") > -1) {

						colWidth = totalWidth / 100 * parseInt(width);
					} else {

						colWidth = parseInt(width);
					}
				} else {

					colWidth = width;
				}

				return colWidth;
			}

			//ensure columns resize to take up the correct amount of space


			function scaleColumns(columns, freeSpace, colWidth, shrinkCols) {

				var oversizeCols = [],
				    oversizeSpace = 0,
				    remainingSpace = 0,
				    nextColWidth = 0,
				    gap = 0,
				    changeUnits = 0,
				    undersizeCols = [];

				function calcGrow(col) {

					return colWidth * (col.column.definition.widthGrow || 1);
				}

				function calcShrink(col) {

					return calcWidth(col.width) - colWidth * (col.column.definition.widthShrink || 0);
				}

				columns.forEach(function (col, i) {

					var width = shrinkCols ? calcShrink(col) : calcGrow(col);

					if (col.column.minWidth >= width) {

						oversizeCols.push(col);
					} else {

						undersizeCols.push(col);

						changeUnits += shrinkCols ? col.column.definition.widthShrink || 1 : col.column.definition.widthGrow || 1;
					}
				});

				if (oversizeCols.length) {

					oversizeCols.forEach(function (col) {

						oversizeSpace += shrinkCols ? col.width - col.column.minWidth : col.column.minWidth;

						col.width = col.column.minWidth;
					});

					remainingSpace = freeSpace - oversizeSpace;

					nextColWidth = changeUnits ? Math.floor(remainingSpace / changeUnits) : remainingSpace;

					gap = remainingSpace - nextColWidth * changeUnits;

					gap += scaleColumns(undersizeCols, remainingSpace, nextColWidth, shrinkCols);
				} else {

					gap = changeUnits ? freeSpace - Math.floor(freeSpace / changeUnits) * changeUnits : freeSpace;

					undersizeCols.forEach(function (column) {

						column.width = shrinkCols ? calcShrink(column) : calcGrow(column);
					});
				}

				return gap;
			}

			if (this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

				this.table.modules.responsiveLayout.update();
			}

			//adjust for vertical scrollbar if present


			if (this.table.rowManager.element.scrollHeight > this.table.rowManager.element.clientHeight) {

				totalWidth -= this.table.rowManager.element.offsetWidth - this.table.rowManager.element.clientWidth;
			}

			columns.forEach(function (column) {

				var width, minWidth, colWidth;

				if (column.visible) {

					width = column.definition.width;

					minWidth = parseInt(column.minWidth);

					if (width) {

						colWidth = calcWidth(width);

						fixedWidth += colWidth > minWidth ? colWidth : minWidth;

						if (column.definition.widthShrink) {

							fixedShrinkColumns.push({

								column: column,

								width: colWidth > minWidth ? colWidth : minWidth

							});

							flexShrinkUnits += column.definition.widthShrink;
						}
					} else {

						flexColumns.push({

							column: column,

							width: 0

						});

						flexGrowUnits += column.definition.widthGrow || 1;
					}
				}
			});

			//calculate available space


			flexWidth = totalWidth - fixedWidth;

			//calculate correct column size


			flexColWidth = Math.floor(flexWidth / flexGrowUnits);

			//generate column widths


			var gapFill = scaleColumns(flexColumns, flexWidth, flexColWidth, false);

			//increase width of last column to account for rounding errors


			if (flexColumns.length && gapFill > 0) {

				flexColumns[flexColumns.length - 1].width += +gapFill;
			}

			//caculate space for columns to be shrunk into


			flexColumns.forEach(function (col) {

				flexWidth -= col.width;
			});

			overflowWidth = Math.abs(gapFill) + flexWidth;

			//shrink oversize columns if there is no available space


			if (overflowWidth > 0 && flexShrinkUnits) {

				gapFill = scaleColumns(fixedShrinkColumns, overflowWidth, Math.floor(overflowWidth / flexShrinkUnits), true);
			}

			//decrease width of last column to account for rounding errors


			if (fixedShrinkColumns.length) {

				fixedShrinkColumns[fixedShrinkColumns.length - 1].width -= gapFill;
			}

			flexColumns.forEach(function (col) {

				col.column.setWidth(col.width);
			});

			fixedShrinkColumns.forEach(function (col) {

				col.column.setWidth(col.width);
			});
		}

	};

	Tabulator.prototype.registerModule("layout", Layout);

	var Localize = function Localize(table) {

		this.table = table; //hold Tabulator object

		this.locale = "default"; //current locale

		this.lang = false; //current language

		this.bindings = {}; //update events to call when locale is changed
	};

	//set header placehoder

	Localize.prototype.setHeaderFilterPlaceholder = function (placeholder) {

		this.langs.default.headerFilters.default = placeholder;
	};

	//set header filter placeholder by column

	Localize.prototype.setHeaderFilterColumnPlaceholder = function (column, placeholder) {

		this.langs.default.headerFilters.columns[column] = placeholder;

		if (this.lang && !this.lang.headerFilters.columns[column]) {

			this.lang.headerFilters.columns[column] = placeholder;
		}
	};

	//setup a lang description object

	Localize.prototype.installLang = function (locale, lang) {

		if (this.langs[locale]) {

			this._setLangProp(this.langs[locale], lang);
		} else {

			this.langs[locale] = lang;
		}
	};

	Localize.prototype._setLangProp = function (lang, values) {

		for (var key in values) {

			if (lang[key] && _typeof(lang[key]) == "object") {

				this._setLangProp(lang[key], values[key]);
			} else {

				lang[key] = values[key];
			}
		}
	};

	//set current locale

	Localize.prototype.setLocale = function (desiredLocale) {

		var self = this;

		desiredLocale = desiredLocale || "default";

		//fill in any matching languge values

		function traverseLang(trans, path) {

			for (var prop in trans) {

				if (_typeof(trans[prop]) == "object") {

					if (!path[prop]) {

						path[prop] = {};
					}

					traverseLang(trans[prop], path[prop]);
				} else {

					path[prop] = trans[prop];
				}
			}
		}

		//determing correct locale to load

		if (desiredLocale === true && navigator.language) {

			//get local from system

			desiredLocale = navigator.language.toLowerCase();
		}

		if (desiredLocale) {

			//if locale is not set, check for matching top level locale else use default

			if (!self.langs[desiredLocale]) {

				var prefix = desiredLocale.split("-")[0];

				if (self.langs[prefix]) {

					console.warn("Localization Error - Exact matching locale not found, using closest match: ", desiredLocale, prefix);

					desiredLocale = prefix;
				} else {

					console.warn("Localization Error - Matching locale not found, using default: ", desiredLocale);

					desiredLocale = "default";
				}
			}
		}

		self.locale = desiredLocale;

		//load default lang template

		self.lang = Tabulator.prototype.helpers.deepClone(self.langs.default || {});

		if (desiredLocale != "default") {

			traverseLang(self.langs[desiredLocale], self.lang);
		}

		self.table.options.localized.call(self.table, self.locale, self.lang);

		self._executeBindings();
	};

	//get current locale

	Localize.prototype.getLocale = function (locale) {

		return self.locale;
	};

	//get lang object for given local or current if none provided

	Localize.prototype.getLang = function (locale) {

		return locale ? this.langs[locale] : this.lang;
	};

	//get text for current locale

	Localize.prototype.getText = function (path, value) {

		var path = value ? path + "|" + value : path,
		    pathArray = path.split("|"),
		    text = this._getLangElement(pathArray, this.locale);

		// if(text === false){

		// 	console.warn("Localization Error - Matching localized text not found for given path: ", path);

		// }


		return text || "";
	};

	//traverse langs object and find localized copy

	Localize.prototype._getLangElement = function (path, locale) {

		var self = this;

		var root = self.lang;

		path.forEach(function (level) {

			var rootPath;

			if (root) {

				rootPath = root[level];

				if (typeof rootPath != "undefined") {

					root = rootPath;
				} else {

					root = false;
				}
			}
		});

		return root;
	};

	//set update binding

	Localize.prototype.bind = function (path, callback) {

		if (!this.bindings[path]) {

			this.bindings[path] = [];
		}

		this.bindings[path].push(callback);

		callback(this.getText(path), this.lang);
	};

	//itterate through bindings and trigger updates

	Localize.prototype._executeBindings = function () {

		var self = this;

		var _loop = function _loop(path) {

			self.bindings[path].forEach(function (binding) {

				binding(self.getText(path), self.lang);
			});
		};

		for (var path in self.bindings) {
			_loop(path);
		}
	};

	//Localized text listings

	Localize.prototype.langs = {

		"default": { //hold default locale text

			"groups": {

				"item": "item",

				"items": "items"

			},

			"columns": {},

			"ajax": {

				"loading": "Loading",

				"error": "Error"

			},

			"pagination": {

				"page_size": "Page Size",

				"page_title": "Show Page",

				"first": "First",

				"first_title": "First Page",

				"last": "Last",

				"last_title": "Last Page",

				"prev": "Prev",

				"prev_title": "Prev Page",

				"next": "Next",

				"next_title": "Next Page",

				"all": "All"

			},

			"headerFilters": {

				"default": "filter column...",

				"columns": {}

			}

		}

	};

	Tabulator.prototype.registerModule("localize", Localize);

	var Comms = function Comms(table) {

		this.table = table;
	};

	Comms.prototype.getConnections = function (selectors) {

		var self = this,
		    connections = [],
		    connection;

		connection = Tabulator.prototype.comms.lookupTable(selectors);

		connection.forEach(function (con) {

			if (self.table !== con) {

				connections.push(con);
			}
		});

		return connections;
	};

	Comms.prototype.send = function (selectors, module, action, data) {

		var self = this,
		    connections = this.getConnections(selectors);

		connections.forEach(function (connection) {

			connection.tableComms(self.table.element, module, action, data);
		});

		if (!connections.length && selectors) {

			console.warn("Table Connection Error - No tables matching selector found", selectors);
		}
	};

	Comms.prototype.receive = function (table, module, action, data) {

		if (this.table.modExists(module)) {

			return this.table.modules[module].commsReceived(table, action, data);
		} else {

			console.warn("Inter-table Comms Error - no such module:", module);
		}
	};

	Tabulator.prototype.registerModule("comms", Comms);

	var Accessor = function Accessor(table) {
		this.table = table; //hold Tabulator object
		this.allowedTypes = ["", "data", "download", "clipboard", "print", "htmlOutput"]; //list of accessor types
	};

	//initialize column accessor
	Accessor.prototype.initializeColumn = function (column) {
		var self = this,
		    match = false,
		    config = {};

		this.allowedTypes.forEach(function (type) {
			var key = "accessor" + (type.charAt(0).toUpperCase() + type.slice(1)),
			    accessor;

			if (column.definition[key]) {
				accessor = self.lookupAccessor(column.definition[key]);

				if (accessor) {
					match = true;

					config[key] = {
						accessor: accessor,
						params: column.definition[key + "Params"] || {}
					};
				}
			}
		});

		if (match) {
			column.modules.accessor = config;
		}
	};

	Accessor.prototype.lookupAccessor = function (value) {
		var accessor = false;

		//set column accessor
		switch (typeof value === 'undefined' ? 'undefined' : _typeof(value)) {
			case "string":
				if (this.accessors[value]) {
					accessor = this.accessors[value];
				} else {
					console.warn("Accessor Error - No such accessor found, ignoring: ", value);
				}
				break;

			case "function":
				accessor = value;
				break;
		}

		return accessor;
	};

	//apply accessor to row
	Accessor.prototype.transformRow = function (dataIn, type) {
		var self = this,
		    key = "accessor" + (type.charAt(0).toUpperCase() + type.slice(1));

		//clone data object with deep copy to isolate internal data from returned result
		var data = Tabulator.prototype.helpers.deepClone(dataIn || {});

		self.table.columnManager.traverse(function (column) {
			var value, accessor, params, component;

			if (column.modules.accessor) {

				accessor = column.modules.accessor[key] || column.modules.accessor.accessor || false;

				if (accessor) {
					value = column.getFieldValue(data);

					if (value != "undefined") {
						component = column.getComponent();
						params = typeof accessor.params === "function" ? accessor.params(value, data, type, component) : accessor.params;
						column.setFieldValue(data, accessor.accessor(value, data, type, params, component));
					}
				}
			}
		});

		return data;
	},

	//default accessors
	Accessor.prototype.accessors = {};

	Tabulator.prototype.registerModule("accessor", Accessor);
	var Ajax = function Ajax(table) {

		this.table = table; //hold Tabulator object
		this.config = false; //hold config object for ajax request
		this.url = ""; //request URL
		this.urlGenerator = false;
		this.params = false; //request parameters

		this.loaderElement = this.createLoaderElement(); //loader message div
		this.msgElement = this.createMsgElement(); //message element
		this.loadingElement = false;
		this.errorElement = false;
		this.loaderPromise = false;

		this.progressiveLoad = false;
		this.loading = false;

		this.requestOrder = 0; //prevent requests comming out of sequence if overridden by another load request
	};

	//initialize setup options
	Ajax.prototype.initialize = function () {
		var template;

		this.loaderElement.appendChild(this.msgElement);

		if (this.table.options.ajaxLoaderLoading) {
			if (typeof this.table.options.ajaxLoaderLoading == "string") {
				template = document.createElement('template');
				template.innerHTML = this.table.options.ajaxLoaderLoading.trim();
				this.loadingElement = template.content.firstChild;
			} else {
				this.loadingElement = this.table.options.ajaxLoaderLoading;
			}
		}

		this.loaderPromise = this.table.options.ajaxRequestFunc || this.defaultLoaderPromise;

		this.urlGenerator = this.table.options.ajaxURLGenerator || this.defaultURLGenerator;

		if (this.table.options.ajaxLoaderError) {
			if (typeof this.table.options.ajaxLoaderError == "string") {
				template = document.createElement('template');
				template.innerHTML = this.table.options.ajaxLoaderError.trim();
				this.errorElement = template.content.firstChild;
			} else {
				this.errorElement = this.table.options.ajaxLoaderError;
			}
		}

		if (this.table.options.ajaxParams) {
			this.setParams(this.table.options.ajaxParams);
		}

		if (this.table.options.ajaxConfig) {
			this.setConfig(this.table.options.ajaxConfig);
		}

		if (this.table.options.ajaxURL) {
			this.setUrl(this.table.options.ajaxURL);
		}

		if (this.table.options.ajaxProgressiveLoad) {
			if (this.table.options.pagination) {
				this.progressiveLoad = false;
				console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time");
			} else {
				if (this.table.modExists("page")) {
					this.progressiveLoad = this.table.options.ajaxProgressiveLoad;
					this.table.modules.page.initializeProgressive(this.progressiveLoad);
				} else {
					console.error("Pagination plugin is required for progressive ajax loading");
				}
			}
		}
	};

	Ajax.prototype.createLoaderElement = function () {
		var el = document.createElement("div");
		el.classList.add("tabulator-loader");
		return el;
	};

	Ajax.prototype.createMsgElement = function () {
		var el = document.createElement("div");

		el.classList.add("tabulator-loader-msg");
		el.setAttribute("role", "alert");

		return el;
	};

	//set ajax params
	Ajax.prototype.setParams = function (params, update) {
		if (update) {
			this.params = this.params || {};

			for (var key in params) {
				this.params[key] = params[key];
			}
		} else {
			this.params = params;
		}
	};

	Ajax.prototype.getParams = function () {
		return this.params || {};
	};

	//load config object
	Ajax.prototype.setConfig = function (config) {
		this._loadDefaultConfig();

		if (typeof config == "string") {
			this.config.method = config;
		} else {
			for (var key in config) {
				this.config[key] = config[key];
			}
		}
	};

	//create config object from default
	Ajax.prototype._loadDefaultConfig = function (force) {
		var self = this;
		if (!self.config || force) {

			self.config = {};

			//load base config from defaults
			for (var key in self.defaultConfig) {
				self.config[key] = self.defaultConfig[key];
			}
		}
	};

	//set request url
	Ajax.prototype.setUrl = function (url) {
		this.url = url;
	};

	//get request url
	Ajax.prototype.getUrl = function () {
		return this.url;
	};

	//lstandard loading function
	Ajax.prototype.loadData = function (inPosition, columnsChanged) {
		var self = this;

		if (this.progressiveLoad) {
			return this._loadDataProgressive();
		} else {
			return this._loadDataStandard(inPosition, columnsChanged);
		}
	};

	Ajax.prototype.nextPage = function (diff) {
		var margin;

		if (!this.loading) {

			margin = this.table.options.ajaxProgressiveLoadScrollMargin || this.table.rowManager.getElement().clientHeight * 2;

			if (diff < margin) {
				this.table.modules.page.nextPage().then(function () {}).catch(function () {});
			}
		}
	};

	Ajax.prototype.blockActiveRequest = function () {
		this.requestOrder++;
	};

	Ajax.prototype._loadDataProgressive = function () {
		this.table.rowManager.setData([]);
		return this.table.modules.page.setPage(1);
	};

	Ajax.prototype._loadDataStandard = function (inPosition, columnsChanged) {
		var _this35 = this;

		return new Promise(function (resolve, reject) {
			_this35.sendRequest(inPosition).then(function (data) {
				_this35.table.rowManager.setData(data, inPosition, columnsChanged).then(function () {
					resolve();
				}).catch(function (e) {
					reject(e);
				});
			}).catch(function (e) {
				reject(e);
			});
		});
	};

	Ajax.prototype.generateParamsList = function (data, prefix) {
		var self = this,
		    output = [];

		prefix = prefix || "";

		if (Array.isArray(data)) {
			data.forEach(function (item, i) {
				output = output.concat(self.generateParamsList(item, prefix ? prefix + "[" + i + "]" : i));
			});
		} else if ((typeof data === 'undefined' ? 'undefined' : _typeof(data)) === "object") {
			for (var key in data) {
				output = output.concat(self.generateParamsList(data[key], prefix ? prefix + "[" + key + "]" : key));
			}
		} else {
			output.push({ key: prefix, value: data });
		}

		return output;
	};

	Ajax.prototype.serializeParams = function (params) {
		var output = this.generateParamsList(params),
		    encoded = [];

		output.forEach(function (item) {
			encoded.push(encodeURIComponent(item.key) + "=" + encodeURIComponent(item.value));
		});

		return encoded.join("&");
	};

	//send ajax request
	Ajax.prototype.sendRequest = function (silent) {
		var _this36 = this;

		var self = this,
		    url = self.url,
		    requestNo,
		    esc,
		    query;

		self.requestOrder++;
		requestNo = self.requestOrder;

		self._loadDefaultConfig();

		return new Promise(function (resolve, reject) {
			if (self.table.options.ajaxRequesting.call(_this36.table, self.url, self.params) !== false) {

				self.loading = true;

				if (!silent) {
					self.showLoader();
				}

				_this36.loaderPromise(url, self.config, self.params).then(function (data) {
					if (requestNo === self.requestOrder) {
						if (self.table.options.ajaxResponse) {
							data = self.table.options.ajaxResponse.call(self.table, self.url, self.params, data);
						}
						resolve(data);

						self.hideLoader();
						self.loading = false;
					} else {
						console.warn("Ajax Response Blocked - An active ajax request was blocked by an attempt to change table data while the request was being made");
					}
				}).catch(function (error) {
					console.error("Ajax Load Error: ", error);
					self.table.options.ajaxError.call(self.table, error);

					self.showError();

					setTimeout(function () {
						self.hideLoader();
					}, 3000);

					self.loading = false;

					reject();
				});
			} else {
				reject();
			}
		});
	};

	Ajax.prototype.showLoader = function () {
		var shouldLoad = typeof this.table.options.ajaxLoader === "function" ? this.table.options.ajaxLoader() : this.table.options.ajaxLoader;

		if (shouldLoad) {

			this.hideLoader();

			while (this.msgElement.firstChild) {
				this.msgElement.removeChild(this.msgElement.firstChild);
			}this.msgElement.classList.remove("tabulator-error");
			this.msgElement.classList.add("tabulator-loading");

			if (this.loadingElement) {
				this.msgElement.appendChild(this.loadingElement);
			} else {
				this.msgElement.innerHTML = this.table.modules.localize.getText("ajax|loading");
			}

			this.table.element.appendChild(this.loaderElement);
		}
	};

	Ajax.prototype.showError = function () {
		this.hideLoader();

		while (this.msgElement.firstChild) {
			this.msgElement.removeChild(this.msgElement.firstChild);
		}this.msgElement.classList.remove("tabulator-loading");
		this.msgElement.classList.add("tabulator-error");

		if (this.errorElement) {
			this.msgElement.appendChild(this.errorElement);
		} else {
			this.msgElement.innerHTML = this.table.modules.localize.getText("ajax|error");
		}

		this.table.element.appendChild(this.loaderElement);
	};

	Ajax.prototype.hideLoader = function () {
		if (this.loaderElement.parentNode) {
			this.loaderElement.parentNode.removeChild(this.loaderElement);
		}
	};

	//default ajax config object
	Ajax.prototype.defaultConfig = {
		method: "GET"
	};

	Ajax.prototype.defaultURLGenerator = function (url, config, params) {

		if (url) {
			if (params && Object.keys(params).length) {
				if (!config.method || config.method.toLowerCase() == "get") {
					config.method = "get";

					url += (url.includes("?") ? "&" : "?") + this.serializeParams(params);
				}
			}
		}

		return url;
	};

	Ajax.prototype.defaultLoaderPromise = function (url, config, params) {
		var self = this,
		    contentType;

		return new Promise(function (resolve, reject) {

			//set url
			url = self.urlGenerator(url, config, params);

			//set body content if not GET request
			if (config.method.toUpperCase() != "GET") {
				contentType = _typeof(self.table.options.ajaxContentType) === "object" ? self.table.options.ajaxContentType : self.contentTypeFormatters[self.table.options.ajaxContentType];
				if (contentType) {

					for (var key in contentType.headers) {
						if (!config.headers) {
							config.headers = {};
						}

						if (typeof config.headers[key] === "undefined") {
							config.headers[key] = contentType.headers[key];
						}
					}

					config.body = contentType.body.call(self, url, config, params);
				} else {
					console.warn("Ajax Error - Invalid ajaxContentType value:", self.table.options.ajaxContentType);
				}
			}

			if (url) {

				//configure headers
				if (typeof config.headers === "undefined") {
					config.headers = {};
				}

				if (typeof config.headers.Accept === "undefined") {
					config.headers.Accept = "application/json";
				}

				if (typeof config.headers["X-Requested-With"] === "undefined") {
					config.headers["X-Requested-With"] = "XMLHttpRequest";
				}

				if (typeof config.mode === "undefined") {
					config.mode = "cors";
				}

				if (config.mode == "cors") {

					if (typeof config.headers["Access-Control-Allow-Origin"] === "undefined") {
						config.headers["Access-Control-Allow-Origin"] = window.location.origin;
					}

					if (typeof config.credentials === "undefined") {
						config.credentials = 'same-origin';
					}
				} else {
					if (typeof config.credentials === "undefined") {
						config.credentials = 'include';
					}
				}

				//send request
				fetch(url, config).then(function (response) {
					if (response.ok) {
						response.json().then(function (data) {
							resolve(data);
						}).catch(function (error) {
							reject(error);
							console.warn("Ajax Load Error - Invalid JSON returned", error);
						});
					} else {
						console.error("Ajax Load Error - Connection Error: " + response.status, response.statusText);
						reject(response);
					}
				}).catch(function (error) {
					console.error("Ajax Load Error - Connection Error: ", error);
					reject(error);
				});
			} else {
				console.warn("Ajax Load Error - No URL Set");
				resolve([]);
			}
		});
	};

	Ajax.prototype.contentTypeFormatters = {
		"json": {
			headers: {
				'Content-Type': 'application/json'
			},
			body: function body(url, config, params) {
				return JSON.stringify(params);
			}
		},
		"form": {
			headers: {},
			body: function body(url, config, params) {
				var output = this.generateParamsList(params),
				    form = new FormData();

				output.forEach(function (item) {
					form.append(item.key, item.value);
				});

				return form;
			}
		}
	};

	Tabulator.prototype.registerModule("ajax", Ajax);

	var ColumnCalcs = function ColumnCalcs(table) {
		this.table = table; //hold Tabulator object
		this.topCalcs = [];
		this.botCalcs = [];
		this.genColumn = false;
		this.topElement = this.createElement();
		this.botElement = this.createElement();
		this.topRow = false;
		this.botRow = false;
		this.topInitialized = false;
		this.botInitialized = false;

		this.initialize();
	};

	ColumnCalcs.prototype.createElement = function () {
		var el = document.createElement("div");
		el.classList.add("tabulator-calcs-holder");
		return el;
	};

	ColumnCalcs.prototype.initialize = function () {
		this.genColumn = new Column({ field: "value" }, this);
	};

	//dummy functions to handle being mock column manager
	ColumnCalcs.prototype.registerColumnField = function () {};

	//initialize column calcs
	ColumnCalcs.prototype.initializeColumn = function (column) {
		var def = column.definition;

		var config = {
			topCalcParams: def.topCalcParams || {},
			botCalcParams: def.bottomCalcParams || {}
		};

		if (def.topCalc) {

			switch (_typeof(def.topCalc)) {
				case "string":
					if (this.calculations[def.topCalc]) {
						config.topCalc = this.calculations[def.topCalc];
					} else {
						console.warn("Column Calc Error - No such calculation found, ignoring: ", def.topCalc);
					}
					break;

				case "function":
					config.topCalc = def.topCalc;
					break;

			}

			if (config.topCalc) {
				column.modules.columnCalcs = config;
				this.topCalcs.push(column);

				if (this.table.options.columnCalcs != "group") {
					this.initializeTopRow();
				}
			}
		}

		if (def.bottomCalc) {
			switch (_typeof(def.bottomCalc)) {
				case "string":
					if (this.calculations[def.bottomCalc]) {
						config.botCalc = this.calculations[def.bottomCalc];
					} else {
						console.warn("Column Calc Error - No such calculation found, ignoring: ", def.bottomCalc);
					}
					break;

				case "function":
					config.botCalc = def.bottomCalc;
					break;

			}

			if (config.botCalc) {
				column.modules.columnCalcs = config;
				this.botCalcs.push(column);

				if (this.table.options.columnCalcs != "group") {
					this.initializeBottomRow();
				}
			}
		}
	};

	ColumnCalcs.prototype.removeCalcs = function () {
		var changed = false;

		if (this.topInitialized) {
			this.topInitialized = false;
			this.topElement.parentNode.removeChild(this.topElement);
			changed = true;
		}

		if (this.botInitialized) {
			this.botInitialized = false;
			this.table.footerManager.remove(this.botElement);
			changed = true;
		}

		if (changed) {
			this.table.rowManager.adjustTableSize();
		}
	};

	ColumnCalcs.prototype.initializeTopRow = function () {
		if (!this.topInitialized) {
			// this.table.columnManager.headersElement.after(this.topElement);
			this.table.columnManager.getElement().insertBefore(this.topElement, this.table.columnManager.headersElement.nextSibling);
			this.topInitialized = true;
		}
	};

	ColumnCalcs.prototype.initializeBottomRow = function () {
		if (!this.botInitialized) {
			this.table.footerManager.prepend(this.botElement);
			this.botInitialized = true;
		}
	};

	ColumnCalcs.prototype.scrollHorizontal = function (left) {
		var hozAdjust = 0,
		    scrollWidth = this.table.columnManager.getElement().scrollWidth - this.table.element.clientWidth;

		if (this.botInitialized) {
			this.botRow.getElement().style.marginLeft = -left + "px";
		}
	};

	ColumnCalcs.prototype.recalc = function (rows) {
		var data, row;

		if (this.topInitialized || this.botInitialized) {
			data = this.rowsToData(rows);

			if (this.topInitialized) {
				if (this.topRow) {
					this.topRow.deleteCells();
				}

				row = this.generateRow("top", this.rowsToData(rows));
				this.topRow = row;
				while (this.topElement.firstChild) {
					this.topElement.removeChild(this.topElement.firstChild);
				}this.topElement.appendChild(row.getElement());
				row.initialize(true);
			}

			if (this.botInitialized) {
				if (this.botRow) {
					this.botRow.deleteCells();
				}

				row = this.generateRow("bottom", this.rowsToData(rows));
				this.botRow = row;
				while (this.botElement.firstChild) {
					this.botElement.removeChild(this.botElement.firstChild);
				}this.botElement.appendChild(row.getElement());
				row.initialize(true);
			}

			this.table.rowManager.adjustTableSize();

			//set resizable handles
			if (this.table.modExists("frozenColumns")) {
				this.table.modules.frozenColumns.layout();
			}
		}
	};

	ColumnCalcs.prototype.recalcRowGroup = function (row) {
		this.recalcGroup(this.table.modules.groupRows.getRowGroup(row));
	};

	ColumnCalcs.prototype.recalcAll = function () {
		var _this37 = this;

		if (this.topCalcs.length || this.botCalcs.length) {
			if (this.table.options.columnCalcs !== "group") {
				this.recalc(this.table.rowManager.activeRows);
			}

			if (this.table.options.groupBy && this.table.options.columnCalcs !== "table") {

				var groups = table.modules.groupRows.getChildGroups();

				groups.forEach(function (group) {
					_this37.recalcGroup(group);
				});
			}
		}
	};

	ColumnCalcs.prototype.recalcGroup = function (group) {
		var data, rowData;

		if (group) {
			if (group.calcs) {
				if (group.calcs.bottom) {
					data = this.rowsToData(group.rows);
					rowData = this.generateRowData("bottom", data);

					group.calcs.bottom.updateData(rowData);
					group.calcs.bottom.reinitialize();
				}

				if (group.calcs.top) {
					data = this.rowsToData(group.rows);
					rowData = this.generateRowData("top", data);

					group.calcs.top.updateData(rowData);
					group.calcs.top.reinitialize();
				}
			}
		}
	};

	//generate top stats row
	ColumnCalcs.prototype.generateTopRow = function (rows) {
		return this.generateRow("top", this.rowsToData(rows));
	};
	//generate bottom stats row
	ColumnCalcs.prototype.generateBottomRow = function (rows) {
		return this.generateRow("bottom", this.rowsToData(rows));
	};

	ColumnCalcs.prototype.rowsToData = function (rows) {
		var _this38 = this;

		var data = [];

		rows.forEach(function (row) {
			data.push(row.getData());

			if (_this38.table.options.dataTree && _this38.table.options.dataTreeChildColumnCalcs) {
				if (row.modules.dataTree.open) {
					var children = _this38.rowsToData(_this38.table.modules.dataTree.getFilteredTreeChildren(row));
					data = data.concat(children);
				}
			}
		});

		return data;
	};

	//generate stats row
	ColumnCalcs.prototype.generateRow = function (pos, data) {
		var self = this,
		    rowData = this.generateRowData(pos, data),
		    row;

		if (self.table.modExists("mutator")) {
			self.table.modules.mutator.disable();
		}

		row = new Row(rowData, this, "calc");

		if (self.table.modExists("mutator")) {
			self.table.modules.mutator.enable();
		}

		row.getElement().classList.add("tabulator-calcs", "tabulator-calcs-" + pos);

		row.generateCells = function () {

			var cells = [];

			self.table.columnManager.columnsByIndex.forEach(function (column) {

				//set field name of mock column
				self.genColumn.setField(column.getField());
				self.genColumn.hozAlign = column.hozAlign;

				if (column.definition[pos + "CalcFormatter"] && self.table.modExists("format")) {

					self.genColumn.modules.format = {
						formatter: self.table.modules.format.getFormatter(column.definition[pos + "CalcFormatter"]),
						params: column.definition[pos + "CalcFormatterParams"]
					};
				} else {
					self.genColumn.modules.format = {
						formatter: self.table.modules.format.getFormatter("plaintext"),
						params: {}
					};
				}

				//ensure css class defintion is replicated to calculation cell
				self.genColumn.definition.cssClass = column.definition.cssClass;

				//generate cell and assign to correct column
				var cell = new Cell(self.genColumn, row);
				cell.column = column;
				cell.setWidth();

				column.cells.push(cell);
				cells.push(cell);

				if (!column.visible) {
					cell.hide();
				}
			});

			this.cells = cells;
		};

		return row;
	};

	//generate stats row
	ColumnCalcs.prototype.generateRowData = function (pos, data) {
		var rowData = {},
		    calcs = pos == "top" ? this.topCalcs : this.botCalcs,
		    type = pos == "top" ? "topCalc" : "botCalc",
		    params,
		    paramKey;

		calcs.forEach(function (column) {
			var values = [];

			if (column.modules.columnCalcs && column.modules.columnCalcs[type]) {
				data.forEach(function (item) {
					values.push(column.getFieldValue(item));
				});

				paramKey = type + "Params";
				params = typeof column.modules.columnCalcs[paramKey] === "function" ? column.modules.columnCalcs[paramKey](values, data) : column.modules.columnCalcs[paramKey];

				column.setFieldValue(rowData, column.modules.columnCalcs[type](values, data, params));
			}
		});

		return rowData;
	};

	ColumnCalcs.prototype.hasTopCalcs = function () {
		return !!this.topCalcs.length;
	};

	ColumnCalcs.prototype.hasBottomCalcs = function () {
		return !!this.botCalcs.length;
	};

	//handle table redraw
	ColumnCalcs.prototype.redraw = function () {
		if (this.topRow) {
			this.topRow.normalizeHeight(true);
		}
		if (this.botRow) {
			this.botRow.normalizeHeight(true);
		}
	};

	//return the calculated
	ColumnCalcs.prototype.getResults = function () {
		var self = this,
		    results = {},
		    groups;

		if (this.table.options.groupBy && this.table.modExists("groupRows")) {
			groups = this.table.modules.groupRows.getGroups(true);

			groups.forEach(function (group) {
				results[group.getKey()] = self.getGroupResults(group);
			});
		} else {
			results = {
				top: this.topRow ? this.topRow.getData() : {},
				bottom: this.botRow ? this.botRow.getData() : {}
			};
		}

		return results;
	};

	//get results from a group
	ColumnCalcs.prototype.getGroupResults = function (group) {
		var self = this,
		    groupObj = group._getSelf(),
		    subGroups = group.getSubGroups(),
		    subGroupResults = {},
		    results = {};

		subGroups.forEach(function (subgroup) {
			subGroupResults[subgroup.getKey()] = self.getGroupResults(subgroup);
		});

		results = {
			top: groupObj.calcs.top ? groupObj.calcs.top.getData() : {},
			bottom: groupObj.calcs.bottom ? groupObj.calcs.bottom.getData() : {},
			groups: subGroupResults
		};

		return results;
	};

	//default calculations
	ColumnCalcs.prototype.calculations = {
		"avg": function avg(values, data, calcParams) {
			var output = 0,
			    precision = typeof calcParams.precision !== "undefined" ? calcParams.precision : 2;

			if (values.length) {
				output = values.reduce(function (sum, value) {
					value = Number(value);
					return sum + value;
				});

				output = output / values.length;

				output = precision !== false ? output.toFixed(precision) : output;
			}

			return parseFloat(output).toString();
		},
		"max": function max(values, data, calcParams) {
			var output = null,
			    precision = typeof calcParams.precision !== "undefined" ? calcParams.precision : false;

			values.forEach(function (value) {

				value = Number(value);

				if (value > output || output === null) {
					output = value;
				}
			});

			return output !== null ? precision !== false ? output.toFixed(precision) : output : "";
		},
		"min": function min(values, data, calcParams) {
			var output = null,
			    precision = typeof calcParams.precision !== "undefined" ? calcParams.precision : false;

			values.forEach(function (value) {

				value = Number(value);

				if (value < output || output === null) {
					output = value;
				}
			});

			return output !== null ? precision !== false ? output.toFixed(precision) : output : "";
		},
		"sum": function sum(values, data, calcParams) {
			var output = 0,
			    precision = typeof calcParams.precision !== "undefined" ? calcParams.precision : false;

			if (values.length) {
				values.forEach(function (value) {
					value = Number(value);

					output += !isNaN(value) ? Number(value) : 0;
				});
			}

			return precision !== false ? output.toFixed(precision) : output;
		},
		"concat": function concat(values, data, calcParams) {
			var output = 0;

			if (values.length) {
				output = values.reduce(function (sum, value) {
					return String(sum) + String(value);
				});
			}

			return output;
		},
		"count": function count(values, data, calcParams) {
			var output = 0;

			if (values.length) {
				values.forEach(function (value) {
					if (value) {
						output++;
					}
				});
			}

			return output;
		}
	};

	Tabulator.prototype.registerModule("columnCalcs", ColumnCalcs);

	var Clipboard = function Clipboard(table) {
		this.table = table;
		this.mode = true;

		this.pasteParser = function () {};
		this.pasteAction = function () {};
		this.customSelection = false;
		this.rowRange = false;
		this.blocked = true; //block copy actions not originating from this command
	};

	Clipboard.prototype.initialize = function () {
		var _this39 = this;

		this.mode = this.table.options.clipboard;

		this.rowRange = this.table.options.clipboardCopyRowRange;

		if (this.mode === true || this.mode === "copy") {
			this.table.element.addEventListener("copy", function (e) {
				var plain, html, list;

				if (!_this39.blocked) {
					e.preventDefault();

					if (_this39.customSelection) {
						plain = _this39.customSelection;

						if (_this39.table.options.clipboardCopyFormatter) {
							plain = _this39.table.options.clipboardCopyFormatter("plain", plain);
						}
					} else {

						var list = _this39.table.modules.export.generateExportList(_this39.rowRange, _this39.table.options.clipboardCopyStyled, _this39.table.options.clipboardCopyConfig, "clipboard");

						html = _this39.table.modules.export.genereateHTMLTable(list);
						plain = html ? _this39.generatePlainContent(list) : "";

						if (_this39.table.options.clipboardCopyFormatter) {
							plain = _this39.table.options.clipboardCopyFormatter("plain", plain);
							html = _this39.table.options.clipboardCopyFormatter("html", html);
						}
					}

					if (window.clipboardData && window.clipboardData.setData) {
						window.clipboardData.setData('Text', plain);
					} else if (e.clipboardData && e.clipboardData.setData) {
						e.clipboardData.setData('text/plain', plain);
						if (html) {
							e.clipboardData.setData('text/html', html);
						}
					} else if (e.originalEvent && e.originalEvent.clipboardData.setData) {
						e.originalEvent.clipboardData.setData('text/plain', plain);
						if (html) {
							e.originalEvent.clipboardData.setData('text/html', html);
						}
					}

					_this39.table.options.clipboardCopied.call(_this39.table, plain, html);

					_this39.reset();
				}
			});
		}

		if (this.mode === true || this.mode === "paste") {
			this.table.element.addEventListener("paste", function (e) {
				_this39.paste(e);
			});
		}

		this.setPasteParser(this.table.options.clipboardPasteParser);
		this.setPasteAction(this.table.options.clipboardPasteAction);
	};

	Clipboard.prototype.reset = function () {
		this.blocked = false;
		this.originalSelectionText = "";
	};

	Clipboard.prototype.generatePlainContent = function (list) {
		var output = [];

		list.forEach(function (row) {
			var rowData = [];

			row.columns.forEach(function (col) {
				var value = "";

				if (col) {

					if (row.type === "group") {
						col.value = col.component.getKey();
					}

					switch (_typeof(col.value)) {
						case "object":
							value = JSON.stringify(col.value);
							break;

						case "undefined":
						case "null":
							value = "";
							break;

						default:
							value = col.value;
					}
				}

				rowData.push(value);
			});

			output.push(rowData.join("\t"));
		});

		return output.join("\n");
	};

	Clipboard.prototype.copy = function (range, internal) {
		var range, sel, textRange;
		this.blocked = false;
		this.customSelection = false;

		if (this.mode === true || this.mode === "copy") {

			this.rowRange = range || this.table.options.clipboardCopyRowRange;

			if (typeof window.getSelection != "undefined" && typeof document.createRange != "undefined") {
				range = document.createRange();
				range.selectNodeContents(this.table.element);
				sel = window.getSelection();

				if (sel.toString() && internal) {
					this.customSelection = sel.toString();
				}

				sel.removeAllRanges();
				sel.addRange(range);
			} else if (typeof document.selection != "undefined" && typeof document.body.createTextRange != "undefined") {
				textRange = document.body.createTextRange();
				textRange.moveToElementText(this.table.element);
				textRange.select();
			}

			document.execCommand('copy');

			if (sel) {
				sel.removeAllRanges();
			}
		}
	};

	//PASTE EVENT HANDLING

	Clipboard.prototype.setPasteAction = function (action) {

		switch (typeof action === 'undefined' ? 'undefined' : _typeof(action)) {
			case "string":
				this.pasteAction = this.pasteActions[action];

				if (!this.pasteAction) {
					console.warn("Clipboard Error - No such paste action found:", action);
				}
				break;

			case "function":
				this.pasteAction = action;
				break;
		}
	};

	Clipboard.prototype.setPasteParser = function (parser) {
		switch (typeof parser === 'undefined' ? 'undefined' : _typeof(parser)) {
			case "string":
				this.pasteParser = this.pasteParsers[parser];

				if (!this.pasteParser) {
					console.warn("Clipboard Error - No such paste parser found:", parser);
				}
				break;

			case "function":
				this.pasteParser = parser;
				break;
		}
	};

	Clipboard.prototype.paste = function (e) {
		var data, rowData, rows;

		if (this.checkPaseOrigin(e)) {

			data = this.getPasteData(e);

			rowData = this.pasteParser.call(this, data);

			if (rowData) {
				e.preventDefault();

				if (this.table.modExists("mutator")) {
					rowData = this.mutateData(rowData);
				}

				rows = this.pasteAction.call(this, rowData);
				this.table.options.clipboardPasted.call(this.table, data, rowData, rows);
			} else {
				this.table.options.clipboardPasteError.call(this.table, data);
			}
		}
	};

	Clipboard.prototype.mutateData = function (data) {
		var self = this,
		    output = [];

		if (Array.isArray(data)) {
			data.forEach(function (row) {
				output.push(self.table.modules.mutator.transformRow(row, "clipboard"));
			});
		} else {
			output = data;
		}

		return output;
	};

	Clipboard.prototype.checkPaseOrigin = function (e) {
		var valid = true;

		if (e.target.tagName != "DIV" || this.table.modules.edit.currentCell) {
			valid = false;
		}

		return valid;
	};

	Clipboard.prototype.getPasteData = function (e) {
		var data;

		if (window.clipboardData && window.clipboardData.getData) {
			data = window.clipboardData.getData('Text');
		} else if (e.clipboardData && e.clipboardData.getData) {
			data = e.clipboardData.getData('text/plain');
		} else if (e.originalEvent && e.originalEvent.clipboardData.getData) {
			data = e.originalEvent.clipboardData.getData('text/plain');
		}

		return data;
	};

	Clipboard.prototype.pasteParsers = {
		table: function table(clipboard) {
			var data = [],
			    success = false,
			    headerFindSuccess = true,
			    columns = this.table.columnManager.columns,
			    columnMap = [],
			    rows = [];

			//get data from clipboard into array of columns and rows.
			clipboard = clipboard.split("\n");

			clipboard.forEach(function (row) {
				data.push(row.split("\t"));
			});

			if (data.length && !(data.length === 1 && data[0].length < 2)) {
				success = true;

				//check if headers are present by title
				data[0].forEach(function (value) {
					var column = columns.find(function (column) {
						return value && column.definition.title && value.trim() && column.definition.title.trim() === value.trim();
					});

					if (column) {
						columnMap.push(column);
					} else {
						headerFindSuccess = false;
					}
				});

				//check if column headers are present by field
				if (!headerFindSuccess) {
					headerFindSuccess = true;
					columnMap = [];

					data[0].forEach(function (value) {
						var column = columns.find(function (column) {
							return value && column.field && value.trim() && column.field.trim() === value.trim();
						});

						if (column) {
							columnMap.push(column);
						} else {
							headerFindSuccess = false;
						}
					});

					if (!headerFindSuccess) {
						columnMap = this.table.columnManager.columnsByIndex;
					}
				}

				//remove header row if found
				if (headerFindSuccess) {
					data.shift();
				}

				data.forEach(function (item) {
					var row = {};

					item.forEach(function (value, i) {
						if (columnMap[i]) {
							row[columnMap[i].field] = value;
						}
					});

					rows.push(row);
				});

				return rows;
			} else {
				return false;
			}
		}
	};

	Clipboard.prototype.pasteActions = {
		replace: function replace(rows) {
			return this.table.setData(rows);
		},
		update: function update(rows) {
			return this.table.updateOrAddData(rows);
		},
		insert: function insert(rows) {
			return this.table.addData(rows);
		}
	};

	Tabulator.prototype.registerModule("clipboard", Clipboard);

	var DataTree = function DataTree(table) {
		this.table = table;
		this.indent = 10;
		this.field = "";
		this.collapseEl = null;
		this.expandEl = null;
		this.branchEl = null;
		this.elementField = false;

		this.startOpen = function () {};

		this.displayIndex = 0;
	};

	DataTree.prototype.initialize = function () {
		var dummyEl = null,
		    firstCol = this.table.columnManager.getFirstVisibileColumn(),
		    options = this.table.options;

		this.field = options.dataTreeChildField;
		this.indent = options.dataTreeChildIndent;
		this.elementField = options.dataTreeElementColumn || (firstCol ? firstCol.field : false);

		if (options.dataTreeBranchElement) {

			if (options.dataTreeBranchElement === true) {
				this.branchEl = document.createElement("div");
				this.branchEl.classList.add("tabulator-data-tree-branch");
			} else {
				if (typeof options.dataTreeBranchElement === "string") {
					dummyEl = document.createElement("div");
					dummyEl.innerHTML = options.dataTreeBranchElement;
					this.branchEl = dummyEl.firstChild;
				} else {
					this.branchEl = options.dataTreeBranchElement;
				}
			}
		}

		if (options.dataTreeCollapseElement) {
			if (typeof options.dataTreeCollapseElement === "string") {
				dummyEl = document.createElement("div");
				dummyEl.innerHTML = options.dataTreeCollapseElement;
				this.collapseEl = dummyEl.firstChild;
			} else {
				this.collapseEl = options.dataTreeCollapseElement;
			}
		} else {
			this.collapseEl = document.createElement("div");
			this.collapseEl.classList.add("tabulator-data-tree-control");
			this.collapseEl.tabIndex = 0;
			this.collapseEl.innerHTML = "<div class='tabulator-data-tree-control-collapse'></div>";
		}

		if (options.dataTreeExpandElement) {
			if (typeof options.dataTreeExpandElement === "string") {
				dummyEl = document.createElement("div");
				dummyEl.innerHTML = options.dataTreeExpandElement;
				this.expandEl = dummyEl.firstChild;
			} else {
				this.expandEl = options.dataTreeExpandElement;
			}
		} else {
			this.expandEl = document.createElement("div");
			this.expandEl.classList.add("tabulator-data-tree-control");
			this.expandEl.tabIndex = 0;
			this.expandEl.innerHTML = "<div class='tabulator-data-tree-control-expand'></div>";
		}

		switch (_typeof(options.dataTreeStartExpanded)) {
			case "boolean":
				this.startOpen = function (row, index) {
					return options.dataTreeStartExpanded;
				};
				break;

			case "function":
				this.startOpen = options.dataTreeStartExpanded;
				break;

			default:
				this.startOpen = function (row, index) {
					return options.dataTreeStartExpanded[index];
				};
				break;
		}
	};

	DataTree.prototype.initializeRow = function (row) {
		var childArray = row.getData()[this.field];
		var isArray = Array.isArray(childArray);

		var children = isArray || !isArray && (typeof childArray === 'undefined' ? 'undefined' : _typeof(childArray)) === "object" && childArray !== null;

		if (!children && row.modules.dataTree && row.modules.dataTree.branchEl) {
			row.modules.dataTree.branchEl.parentNode.removeChild(row.modules.dataTree.branchEl);
		}

		if (!children && row.modules.dataTree && row.modules.dataTree.controlEl) {
			row.modules.dataTree.controlEl.parentNode.removeChild(row.modules.dataTree.controlEl);
		}

		row.modules.dataTree = {
			index: row.modules.dataTree ? row.modules.dataTree.index : 0,
			open: children ? row.modules.dataTree ? row.modules.dataTree.open : this.startOpen(row.getComponent(), 0) : false,
			controlEl: row.modules.dataTree && children ? row.modules.dataTree.controlEl : false,
			branchEl: row.modules.dataTree && children ? row.modules.dataTree.branchEl : false,
			parent: row.modules.dataTree ? row.modules.dataTree.parent : false,
			children: children
		};
	};

	DataTree.prototype.layoutRow = function (row) {
		var cell = this.elementField ? row.getCell(this.elementField) : row.getCells()[0],
		    el = cell.getElement(),
		    config = row.modules.dataTree;

		if (config.branchEl) {
			if (config.branchEl.parentNode) {
				config.branchEl.parentNode.removeChild(config.branchEl);
			}
			config.branchEl = false;
		}

		if (config.controlEl) {
			if (config.controlEl.parentNode) {
				config.controlEl.parentNode.removeChild(config.controlEl);
			}
			config.controlEl = false;
		}

		this.generateControlElement(row, el);

		row.element.classList.add("tabulator-tree-level-" + config.index);

		if (config.index) {
			if (this.branchEl) {
				config.branchEl = this.branchEl.cloneNode(true);
				el.insertBefore(config.branchEl, el.firstChild);
				config.branchEl.style.marginLeft = (config.branchEl.offsetWidth + config.branchEl.style.marginRight) * (config.index - 1) + config.index * this.indent + "px";
			} else {
				el.style.paddingLeft = parseInt(window.getComputedStyle(el, null).getPropertyValue('padding-left')) + config.index * this.indent + "px";
			}
		}
	};

	DataTree.prototype.generateControlElement = function (row, el) {
		var _this40 = this;

		var config = row.modules.dataTree,
		    el = el || row.getCells()[0].getElement(),
		    oldControl = config.controlEl;

		if (config.children !== false) {

			if (config.open) {
				config.controlEl = this.collapseEl.cloneNode(true);
				config.controlEl.addEventListener("click", function (e) {
					e.stopPropagation();
					_this40.collapseRow(row);
				});
			} else {
				config.controlEl = this.expandEl.cloneNode(true);
				config.controlEl.addEventListener("click", function (e) {
					e.stopPropagation();
					_this40.expandRow(row);
				});
			}

			config.controlEl.addEventListener("mousedown", function (e) {
				e.stopPropagation();
			});

			if (oldControl && oldControl.parentNode === el) {
				oldControl.parentNode.replaceChild(config.controlEl, oldControl);
			} else {
				el.insertBefore(config.controlEl, el.firstChild);
			}
		}
	};

	DataTree.prototype.setDisplayIndex = function (index) {
		this.displayIndex = index;
	};

	DataTree.prototype.getDisplayIndex = function () {
		return this.displayIndex;
	};

	DataTree.prototype.getRows = function (rows) {
		var _this41 = this;

		var output = [];

		rows.forEach(function (row, i) {
			var config, children;

			output.push(row);

			if (row instanceof Row) {

				config = row.modules.dataTree.children;

				if (!config.index && config.children !== false) {
					children = _this41.getChildren(row);

					children.forEach(function (child) {
						output.push(child);
					});
				}
			}
		});

		return output;
	};

	DataTree.prototype.getChildren = function (row) {
		var _this42 = this;

		var config = row.modules.dataTree,
		    children = [],
		    output = [];

		if (config.children !== false && config.open) {
			if (!Array.isArray(config.children)) {
				config.children = this.generateChildren(row);
			}

			if (this.table.modExists("filter")) {
				children = this.table.modules.filter.filter(config.children);
			} else {
				children = config.children;
			}

			if (this.table.modExists("sort")) {
				this.table.modules.sort.sort(children);
			}

			children.forEach(function (child) {
				output.push(child);

				var subChildren = _this42.getChildren(child);

				subChildren.forEach(function (sub) {
					output.push(sub);
				});
			});
		}

		return output;
	};

	DataTree.prototype.generateChildren = function (row) {
		var _this43 = this;

		var children = [];

		var childArray = row.getData()[this.field];

		if (!Array.isArray(childArray)) {
			childArray = [childArray];
		}

		childArray.forEach(function (childData) {
			var childRow = new Row(childData || {}, _this43.table.rowManager);
			childRow.modules.dataTree.index = row.modules.dataTree.index + 1;
			childRow.modules.dataTree.parent = row;
			if (childRow.modules.dataTree.children) {
				childRow.modules.dataTree.open = _this43.startOpen(childRow.getComponent(), childRow.modules.dataTree.index);
			}
			children.push(childRow);
		});

		return children;
	};

	DataTree.prototype.expandRow = function (row, silent) {
		var config = row.modules.dataTree;

		if (config.children !== false) {
			config.open = true;

			row.reinitialize();

			this.table.rowManager.refreshActiveData("tree", false, true);

			this.table.options.dataTreeRowExpanded(row.getComponent(), row.modules.dataTree.index);
		}
	};

	DataTree.prototype.collapseRow = function (row) {
		var config = row.modules.dataTree;

		if (config.children !== false) {
			config.open = false;

			row.reinitialize();

			this.table.rowManager.refreshActiveData("tree", false, true);

			this.table.options.dataTreeRowCollapsed(row.getComponent(), row.modules.dataTree.index);
		}
	};

	DataTree.prototype.toggleRow = function (row) {
		var config = row.modules.dataTree;

		if (config.children !== false) {
			if (config.open) {
				this.collapseRow(row);
			} else {
				this.expandRow(row);
			}
		}
	};

	DataTree.prototype.getTreeParent = function (row) {
		return row.modules.dataTree.parent ? row.modules.dataTree.parent.getComponent() : false;
	};

	DataTree.prototype.getFilteredTreeChildren = function (row) {
		var config = row.modules.dataTree,
		    output = [],
		    children;

		if (config.children) {

			if (!Array.isArray(config.children)) {
				config.children = this.generateChildren(row);
			}

			if (this.table.modExists("filter")) {
				children = this.table.modules.filter.filter(config.children);
			} else {
				children = config.children;
			}

			children.forEach(function (childRow) {
				if (childRow instanceof Row) {
					output.push(childRow);
				}
			});
		}

		return output;
	};

	DataTree.prototype.rowDelete = function (row) {
		var parent = row.modules.dataTree.parent,
		    childIndex;

		if (parent) {
			childIndex = this.findChildIndex(row, parent);

			if (childIndex !== false) {
				parent.data[this.field].splice(childIndex, 1);
			}

			if (!parent.data[this.field].length) {
				delete parent.data[this.field];
			}

			this.initializeRow(parent);
			this.layoutRow(parent);
		}

		this.table.rowManager.refreshActiveData("tree", false, true);
	};

	DataTree.prototype.addTreeChildRow = function (row, data, top, index) {
		var childIndex = false;

		if (typeof data === "string") {
			data = JSON.parse(data);
		}

		if (!Array.isArray(row.data[this.field])) {
			row.data[this.field] = [];

			row.modules.dataTree.open = this.startOpen(row.getComponent(), row.modules.dataTree.index);
		}

		if (typeof index !== "undefined") {
			childIndex = this.findChildIndex(index, row);

			if (childIndex !== false) {
				row.data[this.field].splice(top ? childIndex : childIndex + 1, 0, data);
			}
		}

		if (childIndex === false) {
			if (top) {
				row.data[this.field].unshift(data);
			} else {
				row.data[this.field].push(data);
			}
		}

		this.initializeRow(row);
		this.layoutRow(row);

		this.table.rowManager.refreshActiveData("tree", false, true);
	};

	DataTree.prototype.findChildIndex = function (subject, parent) {
		var _this44 = this;

		var match = false;

		if ((typeof subject === 'undefined' ? 'undefined' : _typeof(subject)) == "object") {

			if (subject instanceof Row) {
				//subject is row element
				match = subject.data;
			} else if (subject instanceof RowComponent) {
				//subject is public row component
				match = subject._getSelf().data;
			} else if (typeof HTMLElement !== "undefined" && subject instanceof HTMLElement) {
				if (parent.modules.dataTree) {
					match = parent.modules.dataTree.children.find(function (childRow) {
						return childRow instanceof Row ? childRow.element === subject : false;
					});

					if (match) {
						match = match.data;
					}
				}
			}
		} else if (typeof subject == "undefined" || subject === null) {
			match = false;
		} else {
			//subject should be treated as the index of the row
			match = parent.data[this.field].find(function (row) {
				return row.data[_this44.table.options.index] == subject;
			});
		}

		if (match) {

			if (Array.isArray(parent.data[this.field])) {
				match = parent.data[this.field].indexOf(match);
			}

			if (match == -1) {
				match = false;
			}
		}

		//catch all for any other type of input

		return match;
	};

	DataTree.prototype.getTreeChildren = function (row) {
		var config = row.modules.dataTree,
		    output = [];

		if (config.children) {

			if (!Array.isArray(config.children)) {
				config.children = this.generateChildren(row);
			}

			config.children.forEach(function (childRow) {
				if (childRow instanceof Row) {
					output.push(childRow.getComponent());
				}
			});
		}

		return output;
	};

	DataTree.prototype.checkForRestyle = function (cell) {
		if (!cell.row.cells.indexOf(cell)) {
			cell.row.reinitialize();
		}
	};

	DataTree.prototype.getChildField = function () {
		return this.field;
	};

	DataTree.prototype.redrawNeeded = function (data) {
		return (this.field ? typeof data[this.field] !== "undefined" : false) || (this.elementField ? typeof data[this.elementField] !== "undefined" : false);
	};

	Tabulator.prototype.registerModule("dataTree", DataTree);

	var Download = function Download(table) {
		this.table = table; //hold Tabulator object
	};

	//trigger file download
	Download.prototype.download = function (type, filename, options, range, interceptCallback) {
		var self = this,
		    downloadFunc = false;

		function buildLink(data, mime) {
			if (interceptCallback) {
				if (interceptCallback === true) {
					self.triggerDownload(data, mime, type, filename, true);
				} else {
					interceptCallback(data);
				}
			} else {
				self.triggerDownload(data, mime, type, filename);
			}
		}

		if (typeof type == "function") {
			downloadFunc = type;
		} else {
			if (self.downloaders[type]) {
				downloadFunc = self.downloaders[type];
			} else {
				console.warn("Download Error - No such download type found: ", type);
			}
		}

		if (downloadFunc) {
			var list = this.generateExportList(range);

			downloadFunc.call(this.table, list, options || {}, buildLink);
		}
	};

	Download.prototype.generateExportList = function (range) {
		var list = this.table.modules.export.generateExportList(this.table.options.downloadConfig, false, range || this.table.options.downloadRowRange, "download");

		//assign group header formatter
		var groupHeader = this.table.options.groupHeaderDownload;

		if (groupHeader && !Array.isArray(groupHeader)) {
			groupHeader = [groupHeader];
		}

		list.forEach(function (row) {
			var group;

			if (row.type === "group") {
				group = row.columns[0];

				if (groupHeader && groupHeader[row.indent]) {
					group.value = groupHeader[row.indent](group.value, row.component._group.getRowCount(), row.component._group.getData(), row.component);
				}
			}
		});

		return list;
	};

	Download.prototype.triggerDownload = function (data, mime, type, filename, newTab) {
		var element = document.createElement('a'),
		    blob = new Blob([data], { type: mime }),
		    filename = filename || "Tabulator." + (typeof type === "function" ? "txt" : type);

		blob = this.table.options.downloadReady.call(this.table, data, blob);

		if (blob) {

			if (newTab) {
				window.open(window.URL.createObjectURL(blob));
			} else {
				if (navigator.msSaveOrOpenBlob) {
					navigator.msSaveOrOpenBlob(blob, filename);
				} else {
					element.setAttribute('href', window.URL.createObjectURL(blob));

					//set file title
					element.setAttribute('download', filename);

					//trigger download
					element.style.display = 'none';
					document.body.appendChild(element);
					element.click();

					//remove temporary link element
					document.body.removeChild(element);
				}
			}

			if (this.table.options.downloadComplete) {
				this.table.options.downloadComplete();
			}
		}
	};

	Download.prototype.commsReceived = function (table, action, data) {
		switch (action) {
			case "intercept":
				this.download(data.type, "", data.options, data.active, data.intercept);
				break;
		}
	};

	//downloaders
	Download.prototype.downloaders = {
		csv: function csv(list, options, setFileContents) {
			var delimiter = options && options.delimiter ? options.delimiter : ",",
			    fileContents = [],
			    headers = [];

			list.forEach(function (row) {
				var item = [];

				switch (row.type) {
					case "group":
						console.warn("Download Warning - CSV downloader cannot process row groups");
						break;

					case "calc":
						console.warn("Download Warning - CSV downloader cannot process column calculations");
						break;

					case "header":
						row.columns.forEach(function (col, i) {
							if (col && col.depth === 1) {
								headers[i] = typeof col.value == "undefined" || typeof col.value == "null" ? "" : col.value;
							}
						});
						break;

					case "row":
						row.columns.forEach(function (col) {

							if (col) {

								switch (_typeof(col.value)) {
									case "object":
										col.value = JSON.stringify(col.value);
										break;

									case "undefined":
									case "null":
										col.value = "";
										break;
								}

								item.push('"' + String(col.value).split('"').join('""') + '"');
							}
						});

						fileContents.push(item.join(delimiter));
						break;
				}
			});

			if (headers.length) {
				fileContents = [headers].concat(fileContents);
			}

			fileContents = fileContents.join("\n");

			if (options.bom) {
				fileContents = '\uFEFF' + fileContents;
			}

			setFileContents(fileContents, "text/csv");
		},

		json: function json(list, options, setFileContents) {
			var fileContents = [];

			list.forEach(function (row) {
				var item = {};

				switch (row.type) {
					case "header":
						break;

					case "group":
						console.warn("Download Warning - JSON downloader cannot process row groups");
						break;

					case "calc":
						console.warn("Download Warning - JSON downloader cannot process column calculations");
						break;

					case "row":
						row.columns.forEach(function (col) {
							if (col) {
								item[col.component.getField()] = col.value;
							}
						});

						fileContents.push(item);
						break;
				}
			});

			fileContents = JSON.stringify(fileContents, null, '\t');

			setFileContents(fileContents, "application/json");
		},

		pdf: function pdf(list, options, setFileContents) {
			var header = [],
			    body = [],
			    autoTableParams = {},
			    rowGroupStyles = options.rowGroupStyles || {
				fontStyle: "bold",
				fontSize: 12,
				cellPadding: 6,
				fillColor: 220
			},
			    rowCalcStyles = options.rowCalcStyles || {
				fontStyle: "bold",
				fontSize: 10,
				cellPadding: 4,
				fillColor: 232
			},
			    jsPDFParams = options.jsPDF || {},
			    title = options && options.title ? options.title : "";

			if (!jsPDFParams.orientation) {
				jsPDFParams.orientation = options.orientation || "landscape";
			}

			if (!jsPDFParams.unit) {
				jsPDFParams.unit = "pt";
			}

			//parse row list
			list.forEach(function (row) {
				var item = {};

				switch (row.type) {
					case "header":
						header.push(parseRow(row));
						break;

					case "group":
						body.push(parseRow(row, rowGroupStyles));
						break;

					case "calc":
						body.push(parseRow(row, rowCalcStyles));
						break;

					case "row":
						body.push(parseRow(row));
						break;
				}
			});

			function parseRow(row, styles) {
				var rowData = [];

				row.columns.forEach(function (col) {
					var cell;

					if (col) {
						switch (_typeof(col.value)) {
							case "object":
								col.value = JSON.stringify(col.value);
								break;

							case "undefined":
							case "null":
								col.value = "";
								break;
						}

						cell = {
							content: col.value,
							colSpan: col.width,
							rowSpan: col.height
						};

						if (styles) {
							cell.styles = styles;
						}

						rowData.push(cell);
					} else {
						rowData.push("");
					}
				});

				return rowData;
			}

			//configure PDF
			var doc = new jsPDF(jsPDFParams); //set document to landscape, better for most tables

			if (options && options.autoTable) {
				if (typeof options.autoTable === "function") {
					autoTableParams = options.autoTable(doc) || {};
				} else {
					autoTableParams = options.autoTable;
				}
			}

			if (title) {
				autoTableParams.addPageContent = function (data) {
					doc.text(title, 40, 30);
				};
			}

			autoTableParams.head = header;
			autoTableParams.body = body;

			doc.autoTable(autoTableParams);

			if (options && options.documentProcessing) {
				options.documentProcessing(doc);
			}

			setFileContents(doc.output("arraybuffer"), "application/pdf");
		},

		xlsx: function xlsx(list, options, setFileContents) {
			var self = this,
			    sheetName = options.sheetName || "Sheet1",
			    workbook = XLSX.utils.book_new(),
			    output;

			workbook.SheetNames = [];
			workbook.Sheets = {};

			function generateSheet() {
				var rows = [],
				    merges = [],
				    worksheet = {},
				    range = { s: { c: 0, r: 0 }, e: { c: list[0] ? list[0].columns.reduce(function (a, b) {
							return a + (b && b.width ? b.width : 1);
						}, 0) : 0, r: list.length } };

				//parse row list
				list.forEach(function (row, i) {
					var rowData = [];

					row.columns.forEach(function (col, j) {

						if (col) {
							rowData.push(!(col.value instanceof Date) && _typeof(col.value) === "object" ? JSON.stringify(col.value) : col.value);

							if (col.width > 1 || col.height > -1) {
								merges.push({ s: { r: i, c: j }, e: { r: i + col.height - 1, c: j + col.width - 1 } });
							}
						} else {
							rowData.push("");
						}
					});

					rows.push(rowData);
				});

				//convert rows to worksheet
				XLSX.utils.sheet_add_aoa(worksheet, rows);

				worksheet['!ref'] = XLSX.utils.encode_range(range);

				if (merges.length) {
					worksheet["!merges"] = merges;
				}

				return worksheet;
			}

			if (options.sheetOnly) {
				setFileContents(generateSheet());
				return;
			}

			if (options.sheets) {
				for (var sheet in options.sheets) {

					if (options.sheets[sheet] === true) {
						workbook.SheetNames.push(sheet);
						workbook.Sheets[sheet] = generateSheet();
					} else {

						workbook.SheetNames.push(sheet);

						this.table.modules.comms.send(options.sheets[sheet], "download", "intercept", {
							type: "xlsx",
							options: { sheetOnly: true },
							active: self.active,
							intercept: function intercept(data) {
								workbook.Sheets[sheet] = data;
							}
						});
					}
				}
			} else {
				workbook.SheetNames.push(sheetName);
				workbook.Sheets[sheetName] = generateSheet();
			}

			if (options.documentProcessing) {
				workbook = options.documentProcessing(workbook);
			}

			//convert workbook to binary array
			function s2ab(s) {
				var buf = new ArrayBuffer(s.length);
				var view = new Uint8Array(buf);
				for (var i = 0; i != s.length; ++i) {
					view[i] = s.charCodeAt(i) & 0xFF;
				}return buf;
			}

			output = XLSX.write(workbook, { bookType: 'xlsx', bookSST: true, type: 'binary' });

			setFileContents(s2ab(output), "application/octet-stream");
		},

		html: function html(list, options, setFileContents) {
			if (this.modExists("export", true)) {
				setFileContents(this.modules.export.genereateHTMLTable(list), "text/html");
			}
		}

	};

	Tabulator.prototype.registerModule("download", Download);

	var Edit = function Edit(table) {
		this.table = table; //hold Tabulator object
		this.currentCell = false; //hold currently editing cell
		this.mouseClick = false; //hold mousedown state to prevent click binding being overriden by editor opening
		this.recursionBlock = false; //prevent focus recursion
		this.invalidEdit = false;
		this.editedCells = [];
	};

	//initialize column editor
	Edit.prototype.initializeColumn = function (column) {
		var self = this,
		    config = {
			editor: false,
			blocked: false,
			check: column.definition.editable,
			params: column.definition.editorParams || {}
		};

		//set column editor
		switch (_typeof(column.definition.editor)) {
			case "string":

				if (column.definition.editor === "tick") {
					column.definition.editor = "tickCross";
					console.warn("DEPRECATION WARNING - the tick editor has been deprecated, please use the tickCross editor");
				}

				if (self.editors[column.definition.editor]) {
					config.editor = self.editors[column.definition.editor];
				} else {
					console.warn("Editor Error - No such editor found: ", column.definition.editor);
				}
				break;

			case "function":
				config.editor = column.definition.editor;
				break;

			case "boolean":

				if (column.definition.editor === true) {

					if (typeof column.definition.formatter !== "function") {

						if (column.definition.formatter === "tick") {
							column.definition.formatter = "tickCross";
							console.warn("DEPRECATION WARNING - the tick editor has been deprecated, please use the tickCross editor");
						}

						if (self.editors[column.definition.formatter]) {
							config.editor = self.editors[column.definition.formatter];
						} else {
							config.editor = self.editors["input"];
						}
					} else {
						console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ", column.definition.formatter);
					}
				}
				break;
		}

		if (config.editor) {
			column.modules.edit = config;
		}
	};

	Edit.prototype.getCurrentCell = function () {
		return this.currentCell ? this.currentCell.getComponent() : false;
	};

	Edit.prototype.clearEditor = function (cancel) {
		var cell = this.currentCell,
		    cellEl;

		this.invalidEdit = false;

		if (cell) {
			this.currentCell = false;

			cellEl = cell.getElement();

			if (cancel) {
				cell.validate();
			} else {
				cellEl.classList.remove("tabulator-validation-fail");
			}

			cellEl.classList.remove("tabulator-editing");
			while (cellEl.firstChild) {
				cellEl.removeChild(cellEl.firstChild);
			}cell.row.getElement().classList.remove("tabulator-row-editing");
		}
	};

	Edit.prototype.cancelEdit = function () {

		if (this.currentCell) {
			var cell = this.currentCell;
			var component = this.currentCell.getComponent();

			this.clearEditor(true);
			cell.setValueActual(cell.getValue());
			cell.cellRendered();

			if (cell.column.cellEvents.cellEditCancelled) {
				cell.column.cellEvents.cellEditCancelled.call(this.table, component);
			}

			this.table.options.cellEditCancelled.call(this.table, component);
		}
	};

	//return a formatted value for a cell
	Edit.prototype.bindEditor = function (cell) {
		var self = this,
		    element = cell.getElement();

		element.setAttribute("tabindex", 0);

		element.addEventListener("click", function (e) {
			if (!element.classList.contains("tabulator-editing")) {
				element.focus({ preventScroll: true });
			}
		});

		element.addEventListener("mousedown", function (e) {
			self.mouseClick = true;
		});

		element.addEventListener("focus", function (e) {
			if (!self.recursionBlock) {
				self.edit(cell, e, false);
			}
		});
	};

	Edit.prototype.focusCellNoEvent = function (cell, block) {
		this.recursionBlock = true;
		if (!(block && this.table.browser === "ie")) {
			cell.getElement().focus({ preventScroll: true });
		}
		this.recursionBlock = false;
	};

	Edit.prototype.editCell = function (cell, forceEdit) {
		this.focusCellNoEvent(cell);
		this.edit(cell, false, forceEdit);
	};

	Edit.prototype.focusScrollAdjust = function (cell) {
		if (this.table.rowManager.getRenderMode() == "virtual") {
			var topEdge = this.table.rowManager.element.scrollTop,
			    bottomEdge = this.table.rowManager.element.clientHeight + this.table.rowManager.element.scrollTop,
			    rowEl = cell.row.getElement(),
			    offset = rowEl.offsetTop;

			if (rowEl.offsetTop < topEdge) {
				this.table.rowManager.element.scrollTop -= topEdge - rowEl.offsetTop;
			} else {
				if (rowEl.offsetTop + rowEl.offsetHeight > bottomEdge) {
					this.table.rowManager.element.scrollTop += rowEl.offsetTop + rowEl.offsetHeight - bottomEdge;
				}
			}
		}
	};

	Edit.prototype.edit = function (cell, e, forceEdit) {
		var self = this,
		    allowEdit = true,
		    rendered = function rendered() {},
		    element = cell.getElement(),
		    cellEditor,
		    component,
		    params;

		//prevent editing if another cell is refusing to leave focus (eg. validation fail)
		if (this.currentCell) {
			if (!this.invalidEdit) {
				this.cancelEdit();
			}
			return;
		}

		//handle successfull value change
		function success(value) {
			if (self.currentCell === cell) {
				var valid = true;

				if (cell.column.modules.validate && self.table.modExists("validate") && self.table.options.validationMode != "manual") {
					valid = self.table.modules.validate.validate(cell.column.modules.validate, cell, value);
				}

				if (valid === true || self.table.options.validationMode === "highlight") {
					self.clearEditor();
					cell.setValue(value, true);

					if (!cell.modules.edit) {
						cell.modules.edit = {};
					}

					cell.modules.edit.edited = true;

					if (self.editedCells.indexOf(cell) == -1) {
						self.editedCells.push(cell);
					}

					if (self.table.options.dataTree && self.table.modExists("dataTree")) {
						self.table.modules.dataTree.checkForRestyle(cell);
					}

					if (valid !== true) {
						element.classList.add("tabulator-validation-fail");
						return false;
					}

					return true;
				} else {
					self.invalidEdit = true;
					element.classList.add("tabulator-validation-fail");
					self.focusCellNoEvent(cell, true);
					rendered();
					self.table.options.validationFailed.call(self.table, cell.getComponent(), value, valid);

					return false;
				}
			} else {
				// console.warn("Edit Success Error - cannot call success on a cell that is no longer being edited");
			}
		}

		//handle aborted edit
		function cancel() {
			if (self.currentCell === cell) {
				self.cancelEdit();

				if (self.table.options.dataTree && self.table.modExists("dataTree")) {
					self.table.modules.dataTree.checkForRestyle(cell);
				}
			} else {
				// console.warn("Edit Success Error - cannot call cancel on a cell that is no longer being edited");
			}
		}

		function onRendered(callback) {
			rendered = callback;
		}

		if (!cell.column.modules.edit.blocked) {
			if (e) {
				e.stopPropagation();
			}

			switch (_typeof(cell.column.modules.edit.check)) {
				case "function":
					allowEdit = cell.column.modules.edit.check(cell.getComponent());
					break;

				case "boolean":
					allowEdit = cell.column.modules.edit.check;
					break;
			}

			if (allowEdit || forceEdit) {

				self.cancelEdit();

				self.currentCell = cell;

				this.focusScrollAdjust(cell);

				component = cell.getComponent();

				if (this.mouseClick) {
					this.mouseClick = false;

					if (cell.column.cellEvents.cellClick) {
						cell.column.cellEvents.cellClick.call(this.table, e, component);
					}
				}

				if (cell.column.cellEvents.cellEditing) {
					cell.column.cellEvents.cellEditing.call(this.table, component);
				}

				self.table.options.cellEditing.call(this.table, component);

				params = typeof cell.column.modules.edit.params === "function" ? cell.column.modules.edit.params(component) : cell.column.modules.edit.params;

				cellEditor = cell.column.modules.edit.editor.call(self, component, onRendered, success, cancel, params);

				//if editor returned, add to DOM, if false, abort edit
				if (cellEditor !== false) {

					if (cellEditor instanceof Node) {
						element.classList.add("tabulator-editing");
						cell.row.getElement().classList.add("tabulator-row-editing");
						while (element.firstChild) {
							element.removeChild(element.firstChild);
						}element.appendChild(cellEditor);

						//trigger onRendered Callback
						rendered();

						//prevent editing from triggering rowClick event
						var children = element.children;

						for (var i = 0; i < children.length; i++) {
							children[i].addEventListener("click", function (e) {
								e.stopPropagation();
							});
						}
					} else {
						console.warn("Edit Error - Editor should return an instance of Node, the editor returned:", cellEditor);
						element.blur();
						return false;
					}
				} else {
					element.blur();
					return false;
				}

				return true;
			} else {
				this.mouseClick = false;
				element.blur();
				return false;
			}
		} else {
			this.mouseClick = false;
			element.blur();
			return false;
		}
	};

	Edit.prototype.maskInput = function (el, options) {
		var mask = options.mask,
		    maskLetter = typeof options.maskLetterChar !== "undefined" ? options.maskLetterChar : "A",
		    maskNumber = typeof options.maskNumberChar !== "undefined" ? options.maskNumberChar : "9",
		    maskWildcard = typeof options.maskWildcardChar !== "undefined" ? options.maskWildcardChar : "*",
		    success = false;

		function fillSymbols(index) {
			var symbol = mask[index];
			if (typeof symbol !== "undefined" && symbol !== maskWildcard && symbol !== maskLetter && symbol !== maskNumber) {
				el.value = el.value + "" + symbol;
				fillSymbols(index + 1);
			}
		}

		el.addEventListener("keydown", function (e) {
			var index = el.value.length,
			    char = e.key;

			if (e.keyCode > 46) {
				if (index >= mask.length) {
					e.preventDefault();
					e.stopPropagation();
					success = false;
					return false;
				} else {
					switch (mask[index]) {
						case maskLetter:
							if (char.toUpperCase() == char.toLowerCase()) {
								e.preventDefault();
								e.stopPropagation();
								success = false;
								return false;
							}
							break;

						case maskNumber:
							if (isNaN(char)) {
								e.preventDefault();
								e.stopPropagation();
								success = false;
								return false;
							}
							break;

						case maskWildcard:
							break;

						default:
							if (char !== mask[index]) {
								e.preventDefault();
								e.stopPropagation();
								success = false;
								return false;
							}
					}
				}

				success = true;
			}

			return;
		});

		el.addEventListener("keyup", function (e) {
			if (e.keyCode > 46) {
				if (options.maskAutoFill) {
					fillSymbols(el.value.length);
				}
			}
		});

		if (!el.placeholder) {
			el.placeholder = mask;
		}

		if (options.maskAutoFill) {
			fillSymbols(el.value.length);
		}
	};

	Edit.prototype.getEditedCells = function () {
		var output = [];

		this.editedCells.forEach(function (cell) {
			output.push(cell.getComponent());
		});

		return output;
	};

	Edit.prototype.clearEdited = function (cell) {
		var editIndex;

		if (cell.modules.edit && cell.modules.edit.edited) {
			cell.modules.validate.invalid = false;

			editIndex = this.editedCells.indexOf(cell);

			if (editIndex > -1) {
				this.editedCells.splice(editIndex, 1);
			}
		}
	};

	//default data editors
	Edit.prototype.editors = {

		//input element
		input: function input(cell, onRendered, success, cancel, editorParams) {

			//create and style input
			var cellValue = cell.getValue(),
			    input = document.createElement("input");

			input.setAttribute("type", editorParams.search ? "search" : "text");

			input.style.padding = "4px";
			input.style.width = "100%";
			input.style.boxSizing = "border-box";

			if (editorParams.elementAttributes && _typeof(editorParams.elementAttributes) == "object") {
				for (var key in editorParams.elementAttributes) {
					if (key.charAt(0) == "+") {
						key = key.slice(1);
						input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
					} else {
						input.setAttribute(key, editorParams.elementAttributes[key]);
					}
				}
			}

			input.value = typeof cellValue !== "undefined" ? cellValue : "";

			onRendered(function () {
				input.focus({ preventScroll: true });
				input.style.height = "100%";
			});

			function onChange(e) {
				if ((cellValue === null || typeof cellValue === "undefined") && input.value !== "" || input.value !== cellValue) {
					if (success(input.value)) {
						cellValue = input.value; //persist value if successfully validated incase editor is used as header filter
					}
				} else {
					cancel();
				}
			}

			//submit new value on blur or change
			input.addEventListener("change", onChange);
			input.addEventListener("blur", onChange);

			//submit new value on enter
			input.addEventListener("keydown", function (e) {
				switch (e.keyCode) {
					// case 9:
					case 13:
						onChange(e);
						break;

					case 27:
						cancel();
						break;
				}
			});

			if (editorParams.mask) {
				this.table.modules.edit.maskInput(input, editorParams);
			}

			return input;
		},

		//resizable text area element
		textarea: function textarea(cell, onRendered, success, cancel, editorParams) {
			var self = this,
			    cellValue = cell.getValue(),
			    vertNav = editorParams.verticalNavigation || "hybrid",
			    value = String(cellValue !== null && typeof cellValue !== "undefined" ? cellValue : ""),
			    count = (value.match(/(?:\r\n|\r|\n)/g) || []).length + 1,
			    input = document.createElement("textarea"),
			    scrollHeight = 0;

			//create and style input
			input.style.display = "block";
			input.style.padding = "2px";
			input.style.height = "100%";
			input.style.width = "100%";
			input.style.boxSizing = "border-box";
			input.style.whiteSpace = "pre-wrap";
			input.style.resize = "none";

			if (editorParams.elementAttributes && _typeof(editorParams.elementAttributes) == "object") {
				for (var key in editorParams.elementAttributes) {
					if (key.charAt(0) == "+") {
						key = key.slice(1);
						input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
					} else {
						input.setAttribute(key, editorParams.elementAttributes[key]);
					}
				}
			}

			input.value = value;

			onRendered(function () {
				input.focus({ preventScroll: true });
				input.style.height = "100%";
			});

			function onChange(e) {

				if ((cellValue === null || typeof cellValue === "undefined") && input.value !== "" || input.value !== cellValue) {

					if (success(input.value)) {
						cellValue = input.value; //persist value if successfully validated incase editor is used as header filter
					}

					setTimeout(function () {
						cell.getRow().normalizeHeight();
					}, 300);
				} else {
					cancel();
				}
			}

			//submit new value on blur or change
			input.addEventListener("change", onChange);
			input.addEventListener("blur", onChange);

			input.addEventListener("keyup", function () {

				input.style.height = "";

				var heightNow = input.scrollHeight;

				input.style.height = heightNow + "px";

				if (heightNow != scrollHeight) {
					scrollHeight = heightNow;
					cell.getRow().normalizeHeight();
				}
			});

			input.addEventListener("keydown", function (e) {

				switch (e.keyCode) {
					case 27:
						cancel();
						break;

					case 38:
						//up arrow
						if (vertNav == "editor" || vertNav == "hybrid" && input.selectionStart) {
							e.stopImmediatePropagation();
							e.stopPropagation();
						}

						break;

					case 40:
						//down arrow
						if (vertNav == "editor" || vertNav == "hybrid" && input.selectionStart !== input.value.length) {
							e.stopImmediatePropagation();
							e.stopPropagation();
						}
						break;
				}
			});

			if (editorParams.mask) {
				this.table.modules.edit.maskInput(input, editorParams);
			}

			return input;
		},

		//input element with type of number
		number: function number(cell, onRendered, success, cancel, editorParams) {

			var cellValue = cell.getValue(),
			    vertNav = editorParams.verticalNavigation || "editor",
			    input = document.createElement("input");

			input.setAttribute("type", "number");

			if (typeof editorParams.max != "undefined") {
				input.setAttribute("max", editorParams.max);
			}

			if (typeof editorParams.min != "undefined") {
				input.setAttribute("min", editorParams.min);
			}

			if (typeof editorParams.step != "undefined") {
				input.setAttribute("step", editorParams.step);
			}

			//create and style input
			input.style.padding = "4px";
			input.style.width = "100%";
			input.style.boxSizing = "border-box";

			if (editorParams.elementAttributes && _typeof(editorParams.elementAttributes) == "object") {
				for (var key in editorParams.elementAttributes) {
					if (key.charAt(0) == "+") {
						key = key.slice(1);
						input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
					} else {
						input.setAttribute(key, editorParams.elementAttributes[key]);
					}
				}
			}

			input.value = cellValue;

			var blurFunc = function blurFunc(e) {
				onChange();
			};

			onRendered(function () {
				//submit new value on blur
				input.removeEventListener("blur", blurFunc);

				input.focus({ preventScroll: true });
				input.style.height = "100%";

				//submit new value on blur
				input.addEventListener("blur", blurFunc);
			});

			function onChange() {
				var value = input.value;

				if (!isNaN(value) && value !== "") {
					value = Number(value);
				}

				if (value !== cellValue) {
					if (success(value)) {
						cellValue = value; //persist value if successfully validated incase editor is used as header filter
					}
				} else {
					cancel();
				}
			}

			//submit new value on enter
			input.addEventListener("keydown", function (e) {
				switch (e.keyCode) {
					case 13:
						// case 9:
						onChange();
						break;

					case 27:
						cancel();
						break;

					case 38: //up arrow
					case 40:
						//down arrow
						if (vertNav == "editor") {
							e.stopImmediatePropagation();
							e.stopPropagation();
						}
						break;
				}
			});

			if (editorParams.mask) {
				this.table.modules.edit.maskInput(input, editorParams);
			}

			return input;
		},

		//input element with type of number
		range: function range(cell, onRendered, success, cancel, editorParams) {

			var cellValue = cell.getValue(),
			    input = document.createElement("input");

			input.setAttribute("type", "range");

			if (typeof editorParams.max != "undefined") {
				input.setAttribute("max", editorParams.max);
			}

			if (typeof editorParams.min != "undefined") {
				input.setAttribute("min", editorParams.min);
			}

			if (typeof editorParams.step != "undefined") {
				input.setAttribute("step", editorParams.step);
			}

			//create and style input
			input.style.padding = "4px";
			input.style.width = "100%";
			input.style.boxSizing = "border-box";

			if (editorParams.elementAttributes && _typeof(editorParams.elementAttributes) == "object") {
				for (var key in editorParams.elementAttributes) {
					if (key.charAt(0) == "+") {
						key = key.slice(1);
						input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
					} else {
						input.setAttribute(key, editorParams.elementAttributes[key]);
					}
				}
			}

			input.value = cellValue;

			onRendered(function () {
				input.focus({ preventScroll: true });
				input.style.height = "100%";
			});

			function onChange() {
				var value = input.value;

				if (!isNaN(value) && value !== "") {
					value = Number(value);
				}

				if (value != cellValue) {
					if (success(value)) {
						cellValue = value; //persist value if successfully validated incase editor is used as header filter
					}
				} else {
					cancel();
				}
			}

			//submit new value on blur
			input.addEventListener("blur", function (e) {
				onChange();
			});

			//submit new value on enter
			input.addEventListener("keydown", function (e) {
				switch (e.keyCode) {
					case 13:
						// case 9:
						onChange();
						break;

					case 27:
						cancel();
						break;
				}
			});

			return input;
		},

		//select
		select: function select(cell, onRendered, success, cancel, editorParams) {
			var self = this,
			    cellEl = cell.getElement(),
			    initialValue = cell.getValue(),
			    vertNav = editorParams.verticalNavigation || "editor",
			    initialDisplayValue = typeof initialValue !== "undefined" || initialValue === null ? initialValue : typeof editorParams.defaultValue !== "undefined" ? editorParams.defaultValue : [],
			    input = document.createElement("input"),
			    listEl = document.createElement("div"),
			    multiselect = editorParams.multiselect,
			    dataItems = [],
			    currentItem = {},
			    displayItems = [],
			    currentItems = [],
			    blurable = true;

			this.table.rowManager.element.addEventListener("scroll", cancelItem);

			if (Array.isArray(editorParams) || !Array.isArray(editorParams) && (typeof editorParams === 'undefined' ? 'undefined' : _typeof(editorParams)) === "object" && !editorParams.values) {
				console.warn("DEPRECATION WARNING - values for the select editor must now be passed into the values property of the editorParams object, not as the editorParams object");
				editorParams = { values: editorParams };
			}

			function getUniqueColumnValues(field) {
				var output = {},
				    data = self.table.getData(),
				    column;

				if (field) {
					column = self.table.columnManager.getColumnByField(field);
				} else {
					column = cell.getColumn()._getSelf();
				}

				if (column) {
					data.forEach(function (row) {
						var val = column.getFieldValue(row);

						if (val !== null && typeof val !== "undefined" && val !== "") {
							output[val] = true;
						}
					});

					if (editorParams.sortValuesList) {
						if (editorParams.sortValuesList == "asc") {
							output = Object.keys(output).sort();
						} else {
							output = Object.keys(output).sort().reverse();
						}
					} else {
						output = Object.keys(output);
					}
				} else {
					console.warn("unable to find matching column to create select lookup list:", field);
				}

				return output;
			}

			function parseItems(inputValues, curentValues) {
				var dataList = [];
				var displayList = [];

				function processComplexListItem(item) {
					var item = {
						label: item.label,
						value: item.value,
						itemParams: item.itemParams,
						elementAttributes: item.elementAttributes,
						element: false
					};

					// if(item.value === curentValue || (!isNaN(parseFloat(item.value)) && !isNaN(parseFloat(item.value)) && parseFloat(item.value) === parseFloat(curentValue))){
					// 	setCurrentItem(item);
					// }

					if (curentValues.indexOf(item.value) > -1) {
						setItem(item);
					}

					dataList.push(item);
					displayList.push(item);

					return item;
				}

				if (typeof inputValues == "function") {
					inputValues = inputValues(cell);
				}

				if (Array.isArray(inputValues)) {
					inputValues.forEach(function (value) {
						var item;

						if ((typeof value === 'undefined' ? 'undefined' : _typeof(value)) === "object") {

							if (value.options) {
								item = {
									label: value.label,
									group: true,
									itemParams: value.itemParams,
									elementAttributes: value.elementAttributes,
									element: false
								};

								displayList.push(item);

								value.options.forEach(function (item) {
									processComplexListItem(item);
								});
							} else {
								processComplexListItem(value);
							}
						} else {

							item = {
								label: value,
								value: value,
								element: false
							};

							// if(item.value === curentValue || (!isNaN(parseFloat(item.value)) && !isNaN(parseFloat(item.value)) && parseFloat(item.value) === parseFloat(curentValue))){
							// 	setCurrentItem(item);
							// }

							if (curentValues.indexOf(item.value) > -1) {
								setItem(item);
							}

							dataList.push(item);
							displayList.push(item);
						}
					});
				} else {
					for (var key in inputValues) {
						var item = {
							label: inputValues[key],
							value: key,
							element: false
						};

						// if(item.value === curentValue || (!isNaN(parseFloat(item.value)) && !isNaN(parseFloat(item.value)) && parseFloat(item.value) === parseFloat(curentValue))){
						// 	setCurrentItem(item);
						// }

						if (curentValues.indexOf(item.value) > -1) {
							setItem(item);
						}

						dataList.push(item);
						displayList.push(item);
					}
				}

				dataItems = dataList;
				displayItems = displayList;

				fillList();
			}

			function fillList() {
				while (listEl.firstChild) {
					listEl.removeChild(listEl.firstChild);
				}displayItems.forEach(function (item) {

					var el = item.element;

					if (!el) {
						el = document.createElement("div");
						item.label = editorParams.listItemFormatter ? editorParams.listItemFormatter(item.value, item.label, cell, el, item.itemParams) : item.label;
						if (item.group) {
							el.classList.add("tabulator-edit-select-list-group");
							el.tabIndex = 0;
							el.innerHTML = item.label === "" ? "&nbsp;" : item.label;
						} else {
							el.classList.add("tabulator-edit-select-list-item");
							el.tabIndex = 0;
							el.innerHTML = item.label === "" ? "&nbsp;" : item.label;

							el.addEventListener("click", function () {
								// setCurrentItem(item);
								// chooseItem();
								if (multiselect) {
									toggleItem(item);
									input.focus();
								} else {
									chooseItem(item);
								}
							});

							// if(item === currentItem){
							// 	el.classList.add("active");
							// }

							if (currentItems.indexOf(item) > -1) {
								el.classList.add("active");
							}
						}

						if (item.elementAttributes && _typeof(item.elementAttributes) == "object") {
							for (var key in item.elementAttributes) {
								if (key.charAt(0) == "+") {
									key = key.slice(1);
									el.setAttribute(key, input.getAttribute(key) + item.elementAttributes["+" + key]);
								} else {
									el.setAttribute(key, item.elementAttributes[key]);
								}
							}
						}
						el.addEventListener("mousedown", function () {
							blurable = false;

							setTimeout(function () {
								blurable = true;
							}, 10);
						});

						item.element = el;
					}

					listEl.appendChild(el);
				});
			}

			function setCurrentItem(item, active) {

				if (!multiselect && currentItem && currentItem.element) {
					currentItem.element.classList.remove("active");
				}

				if (currentItem && currentItem.element) {
					currentItem.element.classList.remove("focused");
				}

				currentItem = item;

				if (item.element) {
					item.element.classList.add("focused");
					if (active) {
						item.element.classList.add("active");
					}
				}
			}

			// function chooseItem(){
			// 	hideList();

			// 	if(initialValue !== currentItem.value){
			// 		initialValue = currentItem.value;
			// 		success(currentItem.value);
			// 	}else{
			// 		cancel();
			// 	}
			// }

			function setItem(item) {
				var index = currentItems.indexOf(item);

				if (index == -1) {
					currentItems.push(item);
					setCurrentItem(item, true);
				}

				fillInput();
			}

			function unsetItem(index) {
				var item = currentItems[index];

				if (index > -1) {
					currentItems.splice(index, 1);
					if (item.element) {
						item.element.classList.remove("active");
					}
				}
			}

			function toggleItem(item) {
				if (!item) {
					item = currentItem;
				}

				var index = currentItems.indexOf(item);

				if (index > -1) {
					unsetItem(index);
				} else {
					if (multiselect !== true && currentItems.length >= multiselect) {
						unsetItem(0);
					}

					setItem(item);
				}

				fillInput();
			}

			function chooseItem(item) {
				hideList();

				if (!item) {
					item = currentItem;
				}

				if (item) {
					success(item.value);
				}
			}

			function chooseItems() {
				hideList();

				var output = [];

				currentItems.forEach(function (item) {
					output.push(item.value);
				});

				success(output);
			}

			function fillInput() {
				var output = [];

				currentItems.forEach(function (item) {
					output.push(item.label);
				});

				input.value = output.join(", ");
			}

			function cancelItem() {
				hideList();
				cancel();
			}

			function showList() {
				if (!listEl.parentNode) {

					if (editorParams.values === true) {
						parseItems(getUniqueColumnValues(), initialDisplayValue);
					} else if (typeof editorParams.values === "string") {
						parseItems(getUniqueColumnValues(editorParams.values), initialDisplayValue);
					} else {
						parseItems(editorParams.values || [], initialDisplayValue);
					}

					var offset = Tabulator.prototype.helpers.elOffset(cellEl);

					listEl.style.minWidth = cellEl.offsetWidth + "px";

					listEl.style.top = offset.top + cellEl.offsetHeight + "px";
					listEl.style.left = offset.left + "px";

					listEl.addEventListener("mousedown", function (e) {
						blurable = false;

						setTimeout(function () {
							blurable = true;
						}, 10);
					});

					document.body.appendChild(listEl);
				}
			}

			function hideList() {
				if (listEl.parentNode) {
					listEl.parentNode.removeChild(listEl);
				}

				removeScrollListener();
			}

			function removeScrollListener() {
				self.table.rowManager.element.removeEventListener("scroll", cancelItem);
			}

			//style input
			input.setAttribute("type", "text");

			input.style.padding = "4px";
			input.style.width = "100%";
			input.style.boxSizing = "border-box";
			input.style.cursor = "default";
			input.readOnly = this.currentCell != false;

			if (editorParams.elementAttributes && _typeof(editorParams.elementAttributes) == "object") {
				for (var key in editorParams.elementAttributes) {
					if (key.charAt(0) == "+") {
						key = key.slice(1);
						input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
					} else {
						input.setAttribute(key, editorParams.elementAttributes[key]);
					}
				}
			}

			input.value = typeof initialValue !== "undefined" || initialValue === null ? initialValue : "";

			// if(editorParams.values === true){
			// 	parseItems(getUniqueColumnValues(), initialValue);
			// }else if(typeof editorParams.values === "string"){
			// 	parseItems(getUniqueColumnValues(editorParams.values), initialValue);
			// }else{
			// 	parseItems(editorParams.values || [], initialValue);
			// }

			//allow key based navigation
			input.addEventListener("keydown", function (e) {
				var index;

				switch (e.keyCode) {
					case 38:
						//up arrow
						index = dataItems.indexOf(currentItem);

						if (vertNav == "editor" || vertNav == "hybrid" && index) {
							e.stopImmediatePropagation();
							e.stopPropagation();
							e.preventDefault();

							if (index > 0) {
								setCurrentItem(dataItems[index - 1], !multiselect);
							}
						}
						break;

					case 40:
						//down arrow
						index = dataItems.indexOf(currentItem);

						if (vertNav == "editor" || vertNav == "hybrid" && index < dataItems.length - 1) {
							e.stopImmediatePropagation();
							e.stopPropagation();
							e.preventDefault();

							if (index < dataItems.length - 1) {
								if (index == -1) {
									setCurrentItem(dataItems[0], !multiselect);
								} else {
									setCurrentItem(dataItems[index + 1], !multiselect);
								}
							}
						}
						break;

					case 37: //left arrow
					case 39:
						//right arrow
						e.stopImmediatePropagation();
						e.stopPropagation();
						e.preventDefault();
						break;

					case 13:
						//enter
						// chooseItem();

						if (multiselect) {
							toggleItem();
						} else {
							chooseItem();
						}

						break;

					case 27:
						//escape
						cancelItem();
						break;
				}
			});

			input.addEventListener("blur", function (e) {
				if (blurable) {
					if (multiselect) {
						chooseItems();
					} else {
						cancelItem();
					}
				}
			});

			input.addEventListener("focus", function (e) {
				showList();
			});

			//style list element
			listEl = document.createElement("div");
			listEl.classList.add("tabulator-edit-select-list");

			onRendered(function () {
				input.style.height = "100%";
				input.focus({ preventScroll: true });
			});

			return input;
		},

		//autocomplete
		autocomplete: function autocomplete(cell, onRendered, success, cancel, editorParams) {
			var self = this,
			    cellEl = cell.getElement(),
			    initialValue = cell.getValue(),
			    vertNav = editorParams.verticalNavigation || "editor",
			    initialDisplayValue = typeof initialValue !== "undefined" || initialValue === null ? initialValue : typeof editorParams.defaultValue !== "undefined" ? editorParams.defaultValue : "",
			    input = document.createElement("input"),
			    listEl = document.createElement("div"),
			    allItems = [],
			    displayItems = [],
			    values = [],
			    currentItem = false,
			    blurable = true,
			    uniqueColumnValues = false;

			this.table.rowManager.element.addEventListener("scroll", cancelItem);

			//style input
			input.setAttribute("type", "search");

			input.style.padding = "4px";
			input.style.width = "100%";
			input.style.boxSizing = "border-box";

			if (editorParams.elementAttributes && _typeof(editorParams.elementAttributes) == "object") {
				for (var key in editorParams.elementAttributes) {
					if (key.charAt(0) == "+") {
						key = key.slice(1);
						input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
					} else {
						input.setAttribute(key, editorParams.elementAttributes[key]);
					}
				}
			}

			//style list element
			listEl.classList.add("tabulator-edit-select-list");

			listEl.addEventListener("mousedown", function (e) {
				blurable = false;

				setTimeout(function () {
					blurable = true;
				}, 10);
			});

			function genUniqueColumnValues() {
				if (editorParams.values === true) {
					uniqueColumnValues = getUniqueColumnValues();
				} else if (typeof editorParams.values === "string") {
					uniqueColumnValues = getUniqueColumnValues(editorParams.values);
				}
			}

			function getUniqueColumnValues(field) {
				var output = {},
				    data = self.table.getData(),
				    column;

				if (field) {
					column = self.table.columnManager.getColumnByField(field);
				} else {
					column = cell.getColumn()._getSelf();
				}

				if (column) {
					data.forEach(function (row) {
						var val = column.getFieldValue(row);

						if (val !== null && typeof val !== "undefined" && val !== "") {
							output[val] = true;
						}
					});

					if (editorParams.sortValuesList) {
						if (editorParams.sortValuesList == "asc") {
							output = Object.keys(output).sort();
						} else {
							output = Object.keys(output).sort().reverse();
						}
					} else {
						output = Object.keys(output);
					}
				} else {
					console.warn("unable to find matching column to create autocomplete lookup list:", field);
				}

				return output;
			}

			function filterList(term, intialLoad) {
				var matches = [],
				    values,
				    items,
				    searchEl;

				//lookup base values list
				if (uniqueColumnValues) {
					values = uniqueColumnValues;
				} else {
					values = editorParams.values || [];
				}

				if (editorParams.searchFunc) {
					matches = editorParams.searchFunc(term, values);

					if (matches instanceof Promise) {

						addNotice(typeof editorParams.searchingPlaceholder !== "undefined" ? editorParams.searchingPlaceholder : "Searching...");

						matches.then(function (result) {
							fillListIfNotEmpty(parseItems(result), intialLoad);
						}).catch(function (err) {
							console.err("error in autocomplete search promise:", err);
						});
					} else {
						fillListIfNotEmpty(parseItems(matches), intialLoad);
					}
				} else {
					items = parseItems(values);

					if (term === "") {
						if (editorParams.showListOnEmpty) {
							matches = items;
						}
					} else {
						items.forEach(function (item) {
							if (item.value !== null || typeof item.value !== "undefined") {
								if (String(item.value).toLowerCase().indexOf(String(term).toLowerCase()) > -1 || String(item.title).toLowerCase().indexOf(String(term).toLowerCase()) > -1) {
									matches.push(item);
								}
							}
						});
					}

					fillListIfNotEmpty(matches, intialLoad);
				}
			}

			function addNotice(notice) {
				var searchEl = document.createElement("div");

				clearList();

				if (notice !== false) {
					searchEl.classList.add("tabulator-edit-select-list-notice");
					searchEl.tabIndex = 0;

					if (notice instanceof Node) {
						searchEl.appendChild(notice);
					} else {
						searchEl.innerHTML = notice;
					}

					listEl.appendChild(searchEl);
				}
			}

			function parseItems(inputValues) {
				var itemList = [];

				if (Array.isArray(inputValues)) {
					inputValues.forEach(function (value) {

						var item = {};

						if ((typeof value === 'undefined' ? 'undefined' : _typeof(value)) === "object") {
							item.title = editorParams.listItemFormatter ? editorParams.listItemFormatter(value.value, value.label) : value.label;
							item.value = value.value;
						} else {
							item.title = editorParams.listItemFormatter ? editorParams.listItemFormatter(value, value) : value;
							item.value = value;
						}

						itemList.push(item);
					});
				} else {
					for (var key in inputValues) {
						var item = {
							title: editorParams.listItemFormatter ? editorParams.listItemFormatter(key, inputValues[key]) : inputValues[key],
							value: key
						};

						itemList.push(item);
					}
				}

				return itemList;
			}

			function clearList() {
				while (listEl.firstChild) {
					listEl.removeChild(listEl.firstChild);
				}
			}

			function fillListIfNotEmpty(items, intialLoad) {
				if (items.length) {
					fillList(items, intialLoad);
				} else {
					if (editorParams.emptyPlaceholder) {
						addNotice(editorParams.emptyPlaceholder);
					}
				}
			}

			function fillList(items, intialLoad) {
				var current = false;

				clearList();

				displayItems = items;

				displayItems.forEach(function (item) {
					var el = item.element;

					if (!el) {
						el = document.createElement("div");
						el.classList.add("tabulator-edit-select-list-item");
						el.tabIndex = 0;
						el.innerHTML = item.title;

						el.addEventListener("click", function (e) {
							setCurrentItem(item);
							chooseItem();
						});

						el.addEventListener("mousedown", function (e) {
							blurable = false;

							setTimeout(function () {
								blurable = true;
							}, 10);
						});

						item.element = el;

						if (intialLoad && item.value == initialValue) {
							input.value = item.title;
							item.element.classList.add("active");
							current = true;
						}

						if (item === currentItem) {
							item.element.classList.add("active");
							current = true;
						}
					}

					listEl.appendChild(el);
				});

				if (!current) {
					setCurrentItem(false);
				}
			}

			function chooseItem() {
				hideList();

				if (currentItem) {
					if (initialValue !== currentItem.value) {
						initialValue = currentItem.value;
						input.value = currentItem.title;
						success(currentItem.value);
					} else {
						cancel();
					}
				} else {
					if (editorParams.freetext) {
						initialValue = input.value;
						success(input.value);
					} else {
						if (editorParams.allowEmpty && input.value === "") {
							initialValue = input.value;
							success(input.value);
						} else {
							cancel();
						}
					}
				}
			}

			function showList() {
				if (!listEl.parentNode) {
					while (listEl.firstChild) {
						listEl.removeChild(listEl.firstChild);
					}var offset = Tabulator.prototype.helpers.elOffset(cellEl);

					listEl.style.minWidth = cellEl.offsetWidth + "px";

					listEl.style.top = offset.top + cellEl.offsetHeight + "px";
					listEl.style.left = offset.left + "px";
					document.body.appendChild(listEl);
				}
			}

			function setCurrentItem(item, showInputValue) {
				if (currentItem && currentItem.element) {
					currentItem.element.classList.remove("active");
				}

				currentItem = item;

				if (item && item.element) {
					item.element.classList.add("active");
				}
			}

			function hideList() {
				if (listEl.parentNode) {
					listEl.parentNode.removeChild(listEl);
				}

				removeScrollListener();
			}

			function cancelItem() {
				hideList();
				cancel();
			}

			function removeScrollListener() {
				self.table.rowManager.element.removeEventListener("scroll", cancelItem);
			}

			//allow key based navigation
			input.addEventListener("keydown", function (e) {
				var index;

				switch (e.keyCode) {
					case 38:
						//up arrow
						index = displayItems.indexOf(currentItem);

						if (vertNav == "editor" || vertNav == "hybrid" && index) {
							e.stopImmediatePropagation();
							e.stopPropagation();
							e.preventDefault();

							if (index > 0) {
								setCurrentItem(displayItems[index - 1]);
							} else {
								setCurrentItem(false);
							}
						}
						break;

					case 40:
						//down arrow

						index = displayItems.indexOf(currentItem);

						if (vertNav == "editor" || vertNav == "hybrid" && index < displayItems.length - 1) {

							e.stopImmediatePropagation();
							e.stopPropagation();
							e.preventDefault();

							if (index < displayItems.length - 1) {
								if (index == -1) {
									setCurrentItem(displayItems[0]);
								} else {
									setCurrentItem(displayItems[index + 1]);
								}
							}
						}
						break;

					case 37: //left arrow
					case 39:
						//right arrow
						e.stopImmediatePropagation();
						e.stopPropagation();
						// e.preventDefault();
						break;

					case 13:
						//enter
						chooseItem();
						break;

					case 27:
						//escape
						cancelItem();
						break;

					case 36: //home
					case 35:
						//end
						//prevent table navigation while using input element
						e.stopImmediatePropagation();
						break;
				}
			});

			input.addEventListener("keyup", function (e) {

				switch (e.keyCode) {
					case 38: //up arrow
					case 37: //left arrow
					case 39: //up arrow
					case 40: //right arrow
					case 13: //enter
					case 27:
						//escape
						break;

					default:
						filterList(input.value);
				}
			});

			input.addEventListener("search", function (e) {
				filterList(input.value);
			});

			input.addEventListener("blur", function (e) {
				if (blurable) {
					chooseItem();
				}
			});

			input.addEventListener("focus", function (e) {
				var value = initialDisplayValue;
				genUniqueColumnValues();
				showList();
				input.value = value;
				filterList(value, true);
			});

			onRendered(function () {
				input.style.height = "100%";
				input.focus({ preventScroll: true });
			});

			if (editorParams.mask) {
				this.table.modules.edit.maskInput(input, editorParams);
			}

			return input;
		},

		//star rating
		star: function star(cell, onRendered, success, cancel, editorParams) {
			var self = this,
			    element = cell.getElement(),
			    value = cell.getValue(),
			    maxStars = element.getElementsByTagName("svg").length || 5,
			    size = element.getElementsByTagName("svg")[0] ? element.getElementsByTagName("svg")[0].getAttribute("width") : 14,
			    stars = [],
			    starsHolder = document.createElement("div"),
			    star = document.createElementNS('http://www.w3.org/2000/svg', "svg");

			//change star type
			function starChange(val) {
				stars.forEach(function (star, i) {
					if (i < val) {
						if (self.table.browser == "ie") {
							star.setAttribute("class", "tabulator-star-active");
						} else {
							star.classList.replace("tabulator-star-inactive", "tabulator-star-active");
						}

						star.innerHTML = '<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';
					} else {
						if (self.table.browser == "ie") {
							star.setAttribute("class", "tabulator-star-inactive");
						} else {
							star.classList.replace("tabulator-star-active", "tabulator-star-inactive");
						}

						star.innerHTML = '<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';
					}
				});
			}

			//build stars
			function buildStar(i) {

				var starHolder = document.createElement("span");
				var nextStar = star.cloneNode(true);

				stars.push(nextStar);

				starHolder.addEventListener("mouseenter", function (e) {
					e.stopPropagation();
					e.stopImmediatePropagation();
					starChange(i);
				});

				starHolder.addEventListener("mousemove", function (e) {
					e.stopPropagation();
					e.stopImmediatePropagation();
				});

				starHolder.addEventListener("click", function (e) {
					e.stopPropagation();
					e.stopImmediatePropagation();
					success(i);
					element.blur();
				});

				starHolder.appendChild(nextStar);
				starsHolder.appendChild(starHolder);
			}

			//handle keyboard navigation value change
			function changeValue(val) {
				value = val;
				starChange(val);
			}

			//style cell
			element.style.whiteSpace = "nowrap";
			element.style.overflow = "hidden";
			element.style.textOverflow = "ellipsis";

			//style holding element
			starsHolder.style.verticalAlign = "middle";
			starsHolder.style.display = "inline-block";
			starsHolder.style.padding = "4px";

			//style star
			star.setAttribute("width", size);
			star.setAttribute("height", size);
			star.setAttribute("viewBox", "0 0 512 512");
			star.setAttribute("xml:space", "preserve");
			star.style.padding = "0 1px";

			if (editorParams.elementAttributes && _typeof(editorParams.elementAttributes) == "object") {
				for (var key in editorParams.elementAttributes) {
					if (key.charAt(0) == "+") {
						key = key.slice(1);
						starsHolder.setAttribute(key, starsHolder.getAttribute(key) + editorParams.elementAttributes["+" + key]);
					} else {
						starsHolder.setAttribute(key, editorParams.elementAttributes[key]);
					}
				}
			}

			//create correct number of stars
			for (var i = 1; i <= maxStars; i++) {
				buildStar(i);
			}

			//ensure value does not exceed number of stars
			value = Math.min(parseInt(value), maxStars);

			// set initial styling of stars
			starChange(value);

			starsHolder.addEventListener("mousemove", function (e) {
				starChange(0);
			});

			starsHolder.addEventListener("click", function (e) {
				success(0);
			});

			element.addEventListener("blur", function (e) {
				cancel();
			});

			//allow key based navigation
			element.addEventListener("keydown", function (e) {
				switch (e.keyCode) {
					case 39:
						//right arrow
						changeValue(value + 1);
						break;

					case 37:
						//left arrow
						changeValue(value - 1);
						break;

					case 13:
						//enter
						success(value);
						break;

					case 27:
						//escape
						cancel();
						break;
				}
			});

			return starsHolder;
		},

		//draggable progress bar
		progress: function progress(cell, onRendered, success, cancel, editorParams) {
			var element = cell.getElement(),
			    max = typeof editorParams.max === "undefined" ? element.getElementsByTagName("div")[0].getAttribute("max") || 100 : editorParams.max,
			    min = typeof editorParams.min === "undefined" ? element.getElementsByTagName("div")[0].getAttribute("min") || 0 : editorParams.min,
			    percent = (max - min) / 100,
			    value = cell.getValue() || 0,
			    handle = document.createElement("div"),
			    bar = document.createElement("div"),
			    mouseDrag,
			    mouseDragWidth;

			//set new value
			function updateValue() {
				var calcVal = percent * Math.round(bar.offsetWidth / (element.clientWidth / 100)) + min;
				success(calcVal);
				element.setAttribute("aria-valuenow", calcVal);
				element.setAttribute("aria-label", value);
			}

			//style handle
			handle.style.position = "absolute";
			handle.style.right = "0";
			handle.style.top = "0";
			handle.style.bottom = "0";
			handle.style.width = "5px";
			handle.classList.add("tabulator-progress-handle");

			//style bar
			bar.style.display = "inline-block";
			bar.style.position = "relative";
			// bar.style.top = "8px";
			// bar.style.bottom = "8px";
			// bar.style.left = "4px";
			// bar.style.marginRight = "4px";
			bar.style.height = "100%";
			bar.style.backgroundColor = "#488CE9";
			bar.style.maxWidth = "100%";
			bar.style.minWidth = "0%";

			if (editorParams.elementAttributes && _typeof(editorParams.elementAttributes) == "object") {
				for (var key in editorParams.elementAttributes) {
					if (key.charAt(0) == "+") {
						key = key.slice(1);
						bar.setAttribute(key, bar.getAttribute(key) + editorParams.elementAttributes["+" + key]);
					} else {
						bar.setAttribute(key, editorParams.elementAttributes[key]);
					}
				}
			}

			//style cell
			element.style.padding = "4px 4px";

			//make sure value is in range
			value = Math.min(parseFloat(value), max);
			value = Math.max(parseFloat(value), min);

			//workout percentage
			value = Math.round((value - min) / percent);
			// bar.style.right = value + "%";
			bar.style.width = value + "%";

			element.setAttribute("aria-valuemin", min);
			element.setAttribute("aria-valuemax", max);

			bar.appendChild(handle);

			handle.addEventListener("mousedown", function (e) {
				mouseDrag = e.screenX;
				mouseDragWidth = bar.offsetWidth;
			});

			handle.addEventListener("mouseover", function () {
				handle.style.cursor = "ew-resize";
			});

			element.addEventListener("mousemove", function (e) {
				if (mouseDrag) {
					bar.style.width = mouseDragWidth + e.screenX - mouseDrag + "px";
				}
			});

			element.addEventListener("mouseup", function (e) {
				if (mouseDrag) {
					e.stopPropagation();
					e.stopImmediatePropagation();

					mouseDrag = false;
					mouseDragWidth = false;

					updateValue();
				}
			});

			//allow key based navigation
			element.addEventListener("keydown", function (e) {
				switch (e.keyCode) {
					case 39:
						//right arrow
						e.preventDefault();
						bar.style.width = bar.clientWidth + element.clientWidth / 100 + "px";
						break;

					case 37:
						//left arrow
						e.preventDefault();
						bar.style.width = bar.clientWidth - element.clientWidth / 100 + "px";
						break;

					case 9: //tab
					case 13:
						//enter
						updateValue();
						break;

					case 27:
						//escape
						cancel();
						break;

				}
			});

			element.addEventListener("blur", function () {
				cancel();
			});

			return bar;
		},

		//checkbox
		tickCross: function tickCross(cell, onRendered, success, cancel, editorParams) {
			var value = cell.getValue(),
			    input = document.createElement("input"),
			    tristate = editorParams.tristate,
			    indetermValue = typeof editorParams.indeterminateValue === "undefined" ? null : editorParams.indeterminateValue,
			    indetermState = false;

			input.setAttribute("type", "checkbox");
			input.style.marginTop = "5px";
			input.style.boxSizing = "border-box";

			if (editorParams.elementAttributes && _typeof(editorParams.elementAttributes) == "object") {
				for (var key in editorParams.elementAttributes) {
					if (key.charAt(0) == "+") {
						key = key.slice(1);
						input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
					} else {
						input.setAttribute(key, editorParams.elementAttributes[key]);
					}
				}
			}

			input.value = value;

			if (tristate && (typeof value === "undefined" || value === indetermValue || value === "")) {
				indetermState = true;
				input.indeterminate = true;
			}

			if (this.table.browser != "firefox") {
				//prevent blur issue on mac firefox
				onRendered(function () {
					input.focus({ preventScroll: true });
				});
			}

			input.checked = value === true || value === "true" || value === "True" || value === 1;

			function setValue(blur) {
				if (tristate) {
					if (!blur) {
						if (input.checked && !indetermState) {
							input.checked = false;
							input.indeterminate = true;
							indetermState = true;
							return indetermValue;
						} else {
							indetermState = false;
							return input.checked;
						}
					} else {
						if (indetermState) {
							return indetermValue;
						} else {
							return input.checked;
						}
					}
				} else {
					return input.checked;
				}
			}

			//submit new value on blur
			input.addEventListener("change", function (e) {
				success(setValue());
			});

			input.addEventListener("blur", function (e) {
				success(setValue(true));
			});

			//submit new value on enter
			input.addEventListener("keydown", function (e) {
				if (e.keyCode == 13) {
					success(setValue());
				}
				if (e.keyCode == 27) {
					cancel();
				}
			});

			return input;
		}
	};

	Tabulator.prototype.registerModule("edit", Edit);

	var ExportRow = function ExportRow(type, columns, component, indent) {
		this.type = type;
		this.columns = columns;
		this.component = component || false;
		this.indent = indent || 0;
	};

	var ExportColumn = function ExportColumn(value, component, width, height, depth) {
		this.value = value;
		this.component = component || false;
		this.width = width;
		this.height = height;
		this.depth = depth;
	};

	var Export = function Export(table) {
		this.table = table; //hold Tabulator object
		this.config = {};
		this.cloneTableStyle = true;
		this.colVisProp = "";
	};

	Export.prototype.generateExportList = function (config, style, range, colVisProp) {
		this.cloneTableStyle = style;
		this.config = config || {};
		this.colVisProp = colVisProp;

		var headers = this.config.columnHeaders !== false ? this.headersToExportRows(this.generateColumnGroupHeaders()) : [];
		var body = this.bodyToExportRows(this.rowLookup(range));

		return headers.concat(body);
	};

	Export.prototype.genereateTable = function (config, style, range, colVisProp) {
		var list = this.generateExportList(config, style, range, colVisProp);

		return this.genereateTableElement(list);
	};

	Export.prototype.rowLookup = function (range) {
		var _this45 = this;

		var rows = [];

		if (typeof range == "function") {
			range.call(this.table).forEach(function (row) {
				row = _this45.table.rowManager.findRow(row);

				if (row) {
					rows.push(row);
				}
			});
		} else {
			switch (range) {
				case true:
				case "visible":
					rows = this.table.rowManager.getVisibleRows(true);
					break;

				case "all":
					rows = this.table.rowManager.rows;
					break;

				case "selected":
					rows = this.table.modules.selectRow.selectedRows;
					break;

				case "active":
				default:
					rows = this.table.rowManager.getDisplayRows();
			}
		}

		return Object.assign([], rows);
	};

	Export.prototype.generateColumnGroupHeaders = function () {
		var _this46 = this;

		var output = [];

		var columns = this.config.columnGroups !== false ? this.table.columnManager.columns : this.table.columnManager.columnsByIndex;

		columns.forEach(function (column) {
			var colData = _this46.processColumnGroup(column);

			if (colData) {
				output.push(colData);
			}
		});

		return output;
	};

	Export.prototype.processColumnGroup = function (column) {
		var _this47 = this;

		var subGroups = column.columns,
		    maxDepth = 0,
		    title = column.definition["title" + (this.colVisProp.charAt(0).toUpperCase() + this.colVisProp.slice(1))] || column.definition.title;

		var groupData = {
			title: title,
			column: column,
			depth: 1
		};

		if (subGroups.length) {
			groupData.subGroups = [];
			groupData.width = 0;

			subGroups.forEach(function (subGroup) {
				var subGroupData = _this47.processColumnGroup(subGroup);

				if (subGroupData) {
					groupData.width += subGroupData.width;
					groupData.subGroups.push(subGroupData);

					if (subGroupData.depth > maxDepth) {
						maxDepth = subGroupData.depth;
					}
				}
			});

			groupData.depth += maxDepth;

			if (!groupData.width) {
				return false;
			}
		} else {
			if (this.columnVisCheck(column)) {
				groupData.width = 1;
			} else {
				return false;
			}
		}

		return groupData;
	};

	Export.prototype.columnVisCheck = function (column) {
		return column.definition[this.colVisProp] !== false && (column.visible || !column.visible && column.definition[this.colVisProp]);
	};

	Export.prototype.headersToExportRows = function (columns) {
		var headers = [],
		    headerDepth = 0,
		    exportRows = [];

		function parseColumnGroup(column, level) {

			var depth = headerDepth - level;

			if (typeof headers[level] === "undefined") {
				headers[level] = [];
			}

			column.height = column.subGroups ? 1 : depth - column.depth + 1;

			headers[level].push(column);

			if (column.height > 1) {
				for (var _i6 = 1; _i6 < column.height; _i6++) {

					if (typeof headers[level + _i6] === "undefined") {
						headers[level + _i6] = [];
					}

					headers[level + _i6].push(false);
				}
			}

			if (column.width > 1) {
				for (var _i7 = 1; _i7 < column.width; _i7++) {
					headers[level].push(false);
				}
			}

			if (column.subGroups) {
				column.subGroups.forEach(function (subGroup) {
					parseColumnGroup(subGroup, level + 1);
				});
			}
		}

		//calculate maximum header debth
		columns.forEach(function (column) {
			if (column.depth > headerDepth) {
				headerDepth = column.depth;
			}
		});

		columns.forEach(function (column) {
			parseColumnGroup(column, 0);
		});

		headers.forEach(function (header) {
			var columns = [];

			header.forEach(function (col) {
				if (col) {
					columns.push(new ExportColumn(col.title, col.column.getComponent(), col.width, col.height, col.depth));
				} else {
					columns.push(null);
				}
			});

			exportRows.push(new ExportRow("header", columns));
		});

		return exportRows;
	};

	Export.prototype.bodyToExportRows = function (rows) {
		var _this48 = this;

		var columns = [];
		var exportRows = [];

		this.table.columnManager.columnsByIndex.forEach(function (column) {
			if (_this48.columnVisCheck(column)) {
				columns.push(column.getComponent());
			}
		});

		if (this.config.columnCalcs !== false && this.table.modExists("columnCalcs")) {
			if (this.table.modules.columnCalcs.topInitialized) {
				rows.unshift(this.table.modules.columnCalcs.topRow);
			}

			if (this.table.modules.columnCalcs.botInitialized) {
				rows.push(this.table.modules.columnCalcs.botRow);
			}
		}

		rows = rows.filter(function (row) {
			switch (row.type) {
				case "group":
					return _this48.config.rowGroups !== false;
					break;

				case "calc":
					return _this48.config.columnCalcs !== false;
					break;

				case "row":
					return !(_this48.table.options.dataTree && _this48.config.dataTree === false && row.modules.dataTree.parent);
					break;
			}

			return true;
		});

		rows.forEach(function (row, i) {
			var rowData = row.getData(_this48.colVisProp);
			var exportCols = [];
			var indent = 0;

			switch (row.type) {
				case "group":
					indent = row.level;
					exportCols.push(new ExportColumn(row.key, row.getComponent(), columns.length, 1));
					break;

				case "calc":
				case "row":
					columns.forEach(function (col) {
						exportCols.push(new ExportColumn(col._column.getFieldValue(rowData), col, 1, 1));
					});

					if (_this48.table.options.dataTree && _this48.config.dataTree !== false) {
						indent = row.modules.dataTree.index;
					}
					break;
			}

			exportRows.push(new ExportRow(row.type, exportCols, row.getComponent(), indent));
		});

		return exportRows;
	};

	Export.prototype.genereateTableElement = function (list) {
		var _this49 = this;

		var table = document.createElement("table"),
		    headerEl = document.createElement("thead"),
		    bodyEl = document.createElement("tbody"),
		    styles = this.lookupTableStyles(),
		    rowFormatter = this.table.options["rowFormatter" + (this.colVisProp.charAt(0).toUpperCase() + this.colVisProp.slice(1))],
		    setup = {};

		setup.rowFormatter = rowFormatter !== null ? rowFormatter : this.table.options.rowFormatter;

		if (this.table.options.dataTree && this.config.dataTree !== false && this.table.modExists("columnCalcs")) {
			setup.treeElementField = this.table.modules.dataTree.elementField;
		}

		//assign group header formatter
		setup.groupHeader = this.table.options["groupHeader" + (this.colVisProp.charAt(0).toUpperCase() + this.colVisProp.slice(1))];

		if (setup.groupHeader && !Array.isArray(setup.groupHeader)) {
			setup.groupHeader = [setup.groupHeader];
		}

		table.classList.add("tabulator-print-table");

		this.mapElementStyles(this.table.columnManager.getHeadersElement(), headerEl, ["border-top", "border-left", "border-right", "border-bottom", "background-color", "color", "font-weight", "font-family", "font-size"]);

		if (list.length > 1000) {
			console.warn("It may take a long time to render an HTML table with more than 1000 rows");
		}

		list.forEach(function (row, i) {
			switch (row.type) {
				case "header":
					headerEl.appendChild(_this49.genereateHeaderElement(row, setup, styles));
					break;

				case "group":
					bodyEl.appendChild(_this49.genereateGroupElement(row, setup, styles));
					break;

				case "calc":
					bodyEl.appendChild(_this49.genereateCalcElement(row, setup, styles));
					break;

				case "row":
					var rowEl = _this49.genereateRowElement(row, setup, styles);
					_this49.mapElementStyles(i % 2 && styles.evenRow ? styles.evenRow : styles.oddRow, rowEl, ["border-top", "border-left", "border-right", "border-bottom", "color", "font-weight", "font-family", "font-size", "background-color"]);
					bodyEl.appendChild(rowEl);
					break;
			}
		});

		if (headerEl.innerHTML) {
			table.appendChild(headerEl);
		}

		table.appendChild(bodyEl);

		this.mapElementStyles(this.table.element, table, ["border-top", "border-left", "border-right", "border-bottom"]);
		return table;
	};

	Export.prototype.lookupTableStyles = function () {
		var styles = {};

		//lookup row styles
		if (this.cloneTableStyle && window.getComputedStyle) {
			styles.oddRow = this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)");
			styles.evenRow = this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)");
			styles.calcRow = this.table.element.querySelector(".tabulator-row.tabulator-calcs");
			styles.firstRow = this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)");
			styles.firstGroup = this.table.element.getElementsByClassName("tabulator-group")[0];

			if (styles.firstRow) {
				styles.styleCells = styles.firstRow.getElementsByClassName("tabulator-cell");
				styles.firstCell = styles.styleCells[0];
				styles.lastCell = styles.styleCells[styles.styleCells.length - 1];
			}
		}

		return styles;
	};

	Export.prototype.genereateHeaderElement = function (row, setup, styles) {
		var _this50 = this;

		var rowEl = document.createElement("tr");

		row.columns.forEach(function (column) {
			if (column) {
				var cellEl = document.createElement("th");
				var classNames = column.component._column.definition.cssClass ? column.component._column.definition.cssClass.split(" ") : [];

				cellEl.colSpan = column.width;
				cellEl.rowSpan = column.height;

				cellEl.innerHTML = column.value;

				if (_this50.cloneTableStyle) {
					cellEl.style.boxSizing = "border-box";
				}

				classNames.forEach(function (className) {
					cellEl.classList.add(className);
				});

				_this50.mapElementStyles(column.component.getElement(), cellEl, ["text-align", "border-top", "border-left", "border-right", "border-bottom", "background-color", "color", "font-weight", "font-family", "font-size"]);
				_this50.mapElementStyles(column.component._column.contentElement, cellEl, ["padding-top", "padding-left", "padding-right", "padding-bottom"]);

				if (column.component._column.visible) {
					_this50.mapElementStyles(column.component.getElement(), cellEl, ["width"]);
				} else {
					if (column.component._column.definition.width) {
						cellEl.style.width = column.component._column.definition.width + "px";
					}
				}

				if (column.component._column.parent) {
					_this50.mapElementStyles(column.component._column.parent.groupElement, cellEl, ["border-top"]);
				}

				rowEl.appendChild(cellEl);
			}
		});

		return rowEl;
	};

	Export.prototype.genereateGroupElement = function (row, setup, styles) {

		var rowEl = document.createElement("tr"),
		    cellEl = document.createElement("td"),
		    group = row.columns[0];

		rowEl.classList.add("tabulator-print-table-row");

		if (setup.groupHeader && setup.groupHeader[row.indent]) {
			group.value = setup.groupHeader[row.indent](group.value, row.component._group.getRowCount(), row.component._group.getData(), row.component);
		} else {
			if (setup.groupHeader === false) {
				group.value = group.value;
			} else {
				group.value = row.component._group.generator(group.value, row.component._group.getRowCount(), row.component._group.getData(), row.component);
			}
		}

		cellEl.colSpan = group.width;
		cellEl.innerHTML = group.value;

		rowEl.classList.add("tabulator-print-table-group");
		rowEl.classList.add("tabulator-group-level-" + row.indent);

		if (group.component.getVisibility()) {
			rowEl.classList.add("tabulator-group-visible");
		}

		this.mapElementStyles(styles.firstGroup, rowEl, ["border-top", "border-left", "border-right", "border-bottom", "color", "font-weight", "font-family", "font-size", "background-color"]);
		this.mapElementStyles(styles.firstGroup, cellEl, ["padding-top", "padding-left", "padding-right", "padding-bottom"]);

		rowEl.appendChild(cellEl);

		return rowEl;
	};

	Export.prototype.genereateCalcElement = function (row, setup, styles) {
		var rowEl = this.genereateRowElement(row, setup, styles);

		rowEl.classList.add("tabulator-print-table-calcs");
		this.mapElementStyles(styles.calcRow, rowEl, ["border-top", "border-left", "border-right", "border-bottom", "color", "font-weight", "font-family", "font-size", "background-color"]);

		return rowEl;
	};

	Export.prototype.genereateRowElement = function (row, setup, styles) {
		var _this51 = this;

		var rowEl = document.createElement("tr");

		rowEl.classList.add("tabulator-print-table-row");

		row.columns.forEach(function (col) {

			if (col) {
				var cellEl = document.createElement("td"),
				    column = col.component._column,
				    value = col.value;

				var cellWrapper = {
					modules: {},
					getValue: function getValue() {
						return value;
					},
					getField: function getField() {
						return column.definition.field;
					},
					getElement: function getElement() {
						return cellEl;
					},
					getColumn: function getColumn() {
						return column.getComponent();
					},
					getData: function getData() {
						return rowData;
					},
					getRow: function getRow() {
						return row.getComponent();
					},
					getComponent: function getComponent() {
						return cellWrapper;
					},
					column: column
				};

				var classNames = column.definition.cssClass ? column.definition.cssClass.split(" ") : [];

				classNames.forEach(function (className) {
					cellEl.classList.add(className);
				});

				if (_this51.table.modExists("format") && _this51.config.formatCells !== false) {
					value = _this51.table.modules.format.formatExportValue(cellWrapper, _this51.colVisProp);
				} else {
					switch (typeof value === 'undefined' ? 'undefined' : _typeof(value)) {
						case "object":
							value = JSON.stringify(value);
							break;

						case "undefined":
						case "null":
							value = "";
							break;

						default:
							value = value;
					}
				}

				if (value instanceof Node) {
					cellEl.appendChild(value);
				} else {
					cellEl.innerHTML = value;
				}

				if (styles.firstCell) {
					_this51.mapElementStyles(styles.firstCell, cellEl, ["padding-top", "padding-left", "padding-right", "padding-bottom", "border-top", "border-left", "border-right", "border-bottom", "color", "font-weight", "font-family", "font-size"]);

					if (column.definition.align) {
						cellEl.style.textAlign = column.definition.align;
					}
				}

				if (_this51.table.options.dataTree && _this51.config.dataTree !== false) {
					if (setup.treeElementField && setup.treeElementField == column.field || !setup.treeElementField && i == 0) {
						if (row.component._row.modules.dataTree.controlEl) {
							cellEl.insertBefore(row.component._row.modules.dataTree.controlEl.cloneNode(true), cellEl.firstChild);
						}
						if (row.component._row.modules.dataTree.branchEl) {
							cellEl.insertBefore(row.component._row.modules.dataTree.branchEl.cloneNode(true), cellEl.firstChild);
						}
					}
				}

				rowEl.appendChild(cellEl);

				if (cellWrapper.modules.format && cellWrapper.modules.format.renderedCallback) {
					cellWrapper.modules.format.renderedCallback();
				}

				if (setup.rowFormatter && _this51.config.formatCells !== false) {
					var rowComponent = row.getComponent();

					rowComponent.getElement = function () {
						return rowEl;
					};

					setup.rowFormatter(rowComponent);
				}
			}
		});

		return rowEl;
	};

	Export.prototype.genereateHTMLTable = function (list) {
		var holder = document.createElement("div");

		holder.appendChild(this.genereateTableElement(list));

		return holder.innerHTML;
	};

	Export.prototype.getHtml = function (visible, style, config, colVisProp) {
		var list = this.generateExportList(config || this.table.options.htmlOutputConfig, style, visible, colVisProp || "htmlOutput");

		return this.genereateHTMLTable(list);
	};

	Export.prototype.mapElementStyles = function (from, to, props) {
		if (this.cloneTableStyle && from && to) {

			var lookup = {
				"background-color": "backgroundColor",
				"color": "fontColor",
				"width": "width",
				"font-weight": "fontWeight",
				"font-family": "fontFamily",
				"font-size": "fontSize",
				"text-align": "textAlign",
				"border-top": "borderTop",
				"border-left": "borderLeft",
				"border-right": "borderRight",
				"border-bottom": "borderBottom",
				"padding-top": "paddingTop",
				"padding-left": "paddingLeft",
				"padding-right": "paddingRight",
				"padding-bottom": "paddingBottom"
			};

			if (window.getComputedStyle) {
				var fromStyle = window.getComputedStyle(from);

				props.forEach(function (prop) {
					to.style[lookup[prop]] = fromStyle.getPropertyValue(prop);
				});
			}
		}
	};

	Tabulator.prototype.registerModule("export", Export);

	var Filter = function Filter(table) {

		this.table = table; //hold Tabulator object

		this.filterList = []; //hold filter list
		this.headerFilters = {}; //hold column filters
		this.headerFilterColumns = []; //hold columns that use header filters

		this.prevHeaderFilterChangeCheck = "";
		this.prevHeaderFilterChangeCheck = "{}";

		this.changed = false; //has filtering changed since last render
	};

	//initialize column header filter
	Filter.prototype.initializeColumn = function (column, value) {
		var self = this,
		    field = column.getField(),
		    params;

		//handle successfull value change
		function success(value) {
			var filterType = column.modules.filter.tagType == "input" && column.modules.filter.attrType == "text" || column.modules.filter.tagType == "textarea" ? "partial" : "match",
			    type = "",
			    filterChangeCheck = "",
			    filterFunc;

			if (typeof column.modules.filter.prevSuccess === "undefined" || column.modules.filter.prevSuccess !== value) {

				column.modules.filter.prevSuccess = value;

				if (!column.modules.filter.emptyFunc(value)) {
					column.modules.filter.value = value;

					switch (_typeof(column.definition.headerFilterFunc)) {
						case "string":
							if (self.filters[column.definition.headerFilterFunc]) {
								type = column.definition.headerFilterFunc;
								filterFunc = function filterFunc(data) {
									var params = column.definition.headerFilterFuncParams || {};
									var fieldVal = column.getFieldValue(data);

									params = typeof params === "function" ? params(value, fieldVal, data) : params;

									return self.filters[column.definition.headerFilterFunc](value, fieldVal, data, params);
								};
							} else {
								console.warn("Header Filter Error - Matching filter function not found: ", column.definition.headerFilterFunc);
							}
							break;

						case "function":
							filterFunc = function filterFunc(data) {
								var params = column.definition.headerFilterFuncParams || {};
								var fieldVal = column.getFieldValue(data);

								params = typeof params === "function" ? params(value, fieldVal, data) : params;

								return column.definition.headerFilterFunc(value, fieldVal, data, params);
							};

							type = filterFunc;
							break;
					}

					if (!filterFunc) {
						switch (filterType) {
							case "partial":
								filterFunc = function filterFunc(data) {
									var colVal = column.getFieldValue(data);

									if (typeof colVal !== 'undefined' && colVal !== null) {
										return String(colVal).toLowerCase().indexOf(String(value).toLowerCase()) > -1;
									} else {
										return false;
									}
								};
								type = "like";
								break;

							default:
								filterFunc = function filterFunc(data) {
									return column.getFieldValue(data) == value;
								};
								type = "=";
						}
					}

					self.headerFilters[field] = { value: value, func: filterFunc, type: type, params: params || {} };
				} else {
					delete self.headerFilters[field];
				}

				filterChangeCheck = JSON.stringify(self.headerFilters);

				if (self.prevHeaderFilterChangeCheck !== filterChangeCheck) {
					self.prevHeaderFilterChangeCheck = filterChangeCheck;

					self.changed = true;
					self.table.rowManager.filterRefresh();
				}
			}

			return true;
		}

		column.modules.filter = {
			success: success,
			attrType: false,
			tagType: false,
			emptyFunc: false
		};

		this.generateHeaderFilterElement(column);
	};

	Filter.prototype.generateHeaderFilterElement = function (column, initialValue, reinitialize) {
		var _this52 = this;

		var self = this,
		    success = column.modules.filter.success,
		    field = column.getField(),
		    filterElement,
		    editor,
		    editorElement,
		    cellWrapper,
		    typingTimer,
		    searchTrigger,
		    params;

		//handle aborted edit
		function cancel() {}

		if (column.modules.filter.headerElement && column.modules.filter.headerElement.parentNode) {
			column.contentElement.removeChild(column.modules.filter.headerElement.parentNode);
		}

		if (field) {

			//set empty value function
			column.modules.filter.emptyFunc = column.definition.headerFilterEmptyCheck || function (value) {
				return !value && value !== "0";
			};

			filterElement = document.createElement("div");
			filterElement.classList.add("tabulator-header-filter");

			//set column editor
			switch (_typeof(column.definition.headerFilter)) {
				case "string":
					if (self.table.modules.edit.editors[column.definition.headerFilter]) {
						editor = self.table.modules.edit.editors[column.definition.headerFilter];

						if ((column.definition.headerFilter === "tick" || column.definition.headerFilter === "tickCross") && !column.definition.headerFilterEmptyCheck) {
							column.modules.filter.emptyFunc = function (value) {
								return value !== true && value !== false;
							};
						}
					} else {
						console.warn("Filter Error - Cannot build header filter, No such editor found: ", column.definition.editor);
					}
					break;

				case "function":
					editor = column.definition.headerFilter;
					break;

				case "boolean":
					if (column.modules.edit && column.modules.edit.editor) {
						editor = column.modules.edit.editor;
					} else {
						if (column.definition.formatter && self.table.modules.edit.editors[column.definition.formatter]) {
							editor = self.table.modules.edit.editors[column.definition.formatter];

							if ((column.definition.formatter === "tick" || column.definition.formatter === "tickCross") && !column.definition.headerFilterEmptyCheck) {
								column.modules.filter.emptyFunc = function (value) {
									return value !== true && value !== false;
								};
							}
						} else {
							editor = self.table.modules.edit.editors["input"];
						}
					}
					break;
			}

			if (editor) {

				cellWrapper = {
					getValue: function getValue() {
						return typeof initialValue !== "undefined" ? initialValue : "";
					},
					getField: function getField() {
						return column.definition.field;
					},
					getElement: function getElement() {
						return filterElement;
					},
					getColumn: function getColumn() {
						return column.getComponent();
					},
					getRow: function getRow() {
						return {
							normalizeHeight: function normalizeHeight() {}
						};
					}
				};

				params = column.definition.headerFilterParams || {};

				params = typeof params === "function" ? params.call(self.table) : params;

				editorElement = editor.call(this.table.modules.edit, cellWrapper, function () {}, success, cancel, params);

				if (!editorElement) {
					console.warn("Filter Error - Cannot add filter to " + field + " column, editor returned a value of false");
					return;
				}

				if (!(editorElement instanceof Node)) {
					console.warn("Filter Error - Cannot add filter to " + field + " column, editor should return an instance of Node, the editor returned:", editorElement);
					return;
				}

				//set Placeholder Text
				if (field) {
					self.table.modules.localize.bind("headerFilters|columns|" + column.definition.field, function (value) {
						editorElement.setAttribute("placeholder", typeof value !== "undefined" && value ? value : self.table.modules.localize.getText("headerFilters|default"));
					});
				} else {
					self.table.modules.localize.bind("headerFilters|default", function (value) {
						editorElement.setAttribute("placeholder", typeof self.column.definition.headerFilterPlaceholder !== "undefined" && self.column.definition.headerFilterPlaceholder ? self.column.definition.headerFilterPlaceholder : value);
					});
				}

				//focus on element on click
				editorElement.addEventListener("click", function (e) {
					e.stopPropagation();
					editorElement.focus();
				});

				editorElement.addEventListener("focus", function (e) {
					var left = _this52.table.columnManager.element.scrollLeft;

					if (left !== _this52.table.rowManager.element.scrollLeft) {
						_this52.table.rowManager.scrollHorizontal(left);
						_this52.table.columnManager.scrollHorizontal(left);
					}
				});

				//live update filters as user types
				typingTimer = false;

				searchTrigger = function searchTrigger(e) {
					if (typingTimer) {
						clearTimeout(typingTimer);
					}

					typingTimer = setTimeout(function () {
						success(editorElement.value);
					}, self.table.options.headerFilterLiveFilterDelay);
				};

				column.modules.filter.headerElement = editorElement;
				column.modules.filter.attrType = editorElement.hasAttribute("type") ? editorElement.getAttribute("type").toLowerCase() : "";
				column.modules.filter.tagType = editorElement.tagName.toLowerCase();

				if (column.definition.headerFilterLiveFilter !== false) {

					if (!(column.definition.headerFilter === 'autocomplete' || column.definition.headerFilter === 'tickCross' || (column.definition.editor === 'autocomplete' || column.definition.editor === 'tickCross') && column.definition.headerFilter === true)) {
						editorElement.addEventListener("keyup", searchTrigger);
						editorElement.addEventListener("search", searchTrigger);

						//update number filtered columns on change
						if (column.modules.filter.attrType == "number") {
							editorElement.addEventListener("change", function (e) {
								success(editorElement.value);
							});
						}

						//change text inputs to search inputs to allow for clearing of field
						if (column.modules.filter.attrType == "text" && this.table.browser !== "ie") {
							editorElement.setAttribute("type", "search");
							// editorElement.off("change blur"); //prevent blur from triggering filter and preventing selection click
						}
					}

					//prevent input and select elements from propegating click to column sorters etc
					if (column.modules.filter.tagType == "input" || column.modules.filter.tagType == "select" || column.modules.filter.tagType == "textarea") {
						editorElement.addEventListener("mousedown", function (e) {
							e.stopPropagation();
						});
					}
				}

				filterElement.appendChild(editorElement);

				column.contentElement.appendChild(filterElement);

				if (!reinitialize) {
					self.headerFilterColumns.push(column);
				}
			}
		} else {
			console.warn("Filter Error - Cannot add header filter, column has no field set:", column.definition.title);
		}
	};

	//hide all header filter elements (used to ensure correct column widths in "fitData" layout mode)
	Filter.prototype.hideHeaderFilterElements = function () {
		this.headerFilterColumns.forEach(function (column) {
			if (column.modules.filter && column.modules.filter.headerElement) {
				column.modules.filter.headerElement.style.display = 'none';
			}
		});
	};

	//show all header filter elements (used to ensure correct column widths in "fitData" layout mode)
	Filter.prototype.showHeaderFilterElements = function () {
		this.headerFilterColumns.forEach(function (column) {
			if (column.modules.filter && column.modules.filter.headerElement) {
				column.modules.filter.headerElement.style.display = '';
			}
		});
	};

	//programatically set focus of header filter
	Filter.prototype.setHeaderFilterFocus = function (column) {
		if (column.modules.filter && column.modules.filter.headerElement) {
			column.modules.filter.headerElement.focus();
		} else {
			console.warn("Column Filter Focus Error - No header filter set on column:", column.getField());
		}
	};

	//programmatically get value of header filter
	Filter.prototype.getHeaderFilterValue = function (column) {
		if (column.modules.filter && column.modules.filter.headerElement) {
			return column.modules.filter.headerElement.value;
		} else {
			console.warn("Column Filter Error - No header filter set on column:", column.getField());
		}
	};

	//programatically set value of header filter
	Filter.prototype.setHeaderFilterValue = function (column, value) {
		if (column) {
			if (column.modules.filter && column.modules.filter.headerElement) {
				this.generateHeaderFilterElement(column, value, true);
				column.modules.filter.success(value);
			} else {
				console.warn("Column Filter Error - No header filter set on column:", column.getField());
			}
		}
	};

	Filter.prototype.reloadHeaderFilter = function (column) {
		if (column) {
			if (column.modules.filter && column.modules.filter.headerElement) {
				this.generateHeaderFilterElement(column, column.modules.filter.value, true);
			} else {
				console.warn("Column Filter Error - No header filter set on column:", column.getField());
			}
		}
	};

	//check if the filters has changed since last use
	Filter.prototype.hasChanged = function () {
		var changed = this.changed;
		this.changed = false;
		return changed;
	};

	//set standard filters
	Filter.prototype.setFilter = function (field, type, value, params) {
		var self = this;

		self.filterList = [];

		if (!Array.isArray(field)) {
			field = [{ field: field, type: type, value: value, params: params }];
		}

		self.addFilter(field);
	};

	//add filter to array
	Filter.prototype.addFilter = function (field, type, value, params) {
		var self = this;

		if (!Array.isArray(field)) {
			field = [{ field: field, type: type, value: value, params: params }];
		}

		field.forEach(function (filter) {

			filter = self.findFilter(filter);

			if (filter) {
				self.filterList.push(filter);

				self.changed = true;
			}
		});

		if (this.table.options.persistence && this.table.modExists("persistence", true) && this.table.modules.persistence.config.filter) {
			this.table.modules.persistence.save("filter");
		}
	};

	Filter.prototype.findFilter = function (filter) {
		var self = this,
		    column;

		if (Array.isArray(filter)) {
			return this.findSubFilters(filter);
		}

		var filterFunc = false;

		if (typeof filter.field == "function") {
			filterFunc = function filterFunc(data) {
				return filter.field(data, filter.type || {}); // pass params to custom filter function
			};
		} else {

			if (self.filters[filter.type]) {

				column = self.table.columnManager.getColumnByField(filter.field);

				if (column) {
					filterFunc = function filterFunc(data) {
						return self.filters[filter.type](filter.value, column.getFieldValue(data), data, filter.params || {});
					};
				} else {
					filterFunc = function filterFunc(data) {
						return self.filters[filter.type](filter.value, data[filter.field], data, filter.params || {});
					};
				}
			} else {
				console.warn("Filter Error - No such filter type found, ignoring: ", filter.type);
			}
		}

		filter.func = filterFunc;

		return filter.func ? filter : false;
	};

	Filter.prototype.findSubFilters = function (filters) {
		var self = this,
		    output = [];

		filters.forEach(function (filter) {
			filter = self.findFilter(filter);

			if (filter) {
				output.push(filter);
			}
		});

		return output.length ? output : false;
	};

	//get all filters
	Filter.prototype.getFilters = function (all, ajax) {
		var output = [];

		if (all) {
			output = this.getHeaderFilters();
		}

		if (ajax) {
			output.forEach(function (item) {
				if (typeof item.type == "function") {
					item.type = "function";
				}
			});
		}

		output = output.concat(this.filtersToArray(this.filterList, ajax));

		return output;
	};

	//filter to Object
	Filter.prototype.filtersToArray = function (filterList, ajax) {
		var _this53 = this;

		var output = [];

		filterList.forEach(function (filter) {
			var item;

			if (Array.isArray(filter)) {
				output.push(_this53.filtersToArray(filter, ajax));
			} else {
				item = { field: filter.field, type: filter.type, value: filter.value };

				if (ajax) {
					if (typeof item.type == "function") {
						item.type = "function";
					}
				}

				output.push(item);
			}
		});

		return output;
	};

	//get all filters
	Filter.prototype.getHeaderFilters = function () {
		var self = this,
		    output = [];

		for (var key in this.headerFilters) {
			output.push({ field: key, type: this.headerFilters[key].type, value: this.headerFilters[key].value });
		}

		return output;
	};

	//remove filter from array
	Filter.prototype.removeFilter = function (field, type, value) {
		var self = this;

		if (!Array.isArray(field)) {
			field = [{ field: field, type: type, value: value }];
		}

		field.forEach(function (filter) {
			var index = -1;

			if (_typeof(filter.field) == "object") {
				index = self.filterList.findIndex(function (element) {
					return filter === element;
				});
			} else {
				index = self.filterList.findIndex(function (element) {
					return filter.field === element.field && filter.type === element.type && filter.value === element.value;
				});
			}

			if (index > -1) {
				self.filterList.splice(index, 1);
				self.changed = true;
			} else {
				console.warn("Filter Error - No matching filter type found, ignoring: ", filter.type);
			}
		});

		if (this.table.options.persistence && this.table.modExists("persistence", true) && this.table.modules.persistence.config.filter) {
			this.table.modules.persistence.save("filter");
		}
	};

	//clear filters
	Filter.prototype.clearFilter = function (all) {
		this.filterList = [];

		if (all) {
			this.clearHeaderFilter();
		}

		this.changed = true;

		if (this.table.options.persistence && this.table.modExists("persistence", true) && this.table.modules.persistence.config.filter) {
			this.table.modules.persistence.save("filter");
		}
	};

	//clear header filters
	Filter.prototype.clearHeaderFilter = function () {
		var self = this;

		this.headerFilters = {};
		self.prevHeaderFilterChangeCheck = "{}";

		this.headerFilterColumns.forEach(function (column) {
			column.modules.filter.value = null;
			column.modules.filter.prevSuccess = undefined;
			self.reloadHeaderFilter(column);
		});

		this.changed = true;
	};

	//search data and return matching rows
	Filter.prototype.search = function (searchType, field, type, value) {
		var self = this,
		    activeRows = [],
		    filterList = [];

		if (!Array.isArray(field)) {
			field = [{ field: field, type: type, value: value }];
		}

		field.forEach(function (filter) {
			filter = self.findFilter(filter);

			if (filter) {
				filterList.push(filter);
			}
		});

		this.table.rowManager.rows.forEach(function (row) {
			var match = true;

			filterList.forEach(function (filter) {
				if (!self.filterRecurse(filter, row.getData())) {
					match = false;
				}
			});

			if (match) {
				activeRows.push(searchType === "data" ? row.getData("data") : row.getComponent());
			}
		});

		return activeRows;
	};

	//filter row array
	Filter.prototype.filter = function (rowList, filters) {
		var self = this,
		    activeRows = [],
		    activeRowComponents = [];

		if (self.table.options.dataFiltering) {
			self.table.options.dataFiltering.call(self.table, self.getFilters());
		}

		if (!self.table.options.ajaxFiltering && (self.filterList.length || Object.keys(self.headerFilters).length)) {

			rowList.forEach(function (row) {
				if (self.filterRow(row)) {
					activeRows.push(row);
				}
			});
		} else {
			activeRows = rowList.slice(0);
		}

		if (self.table.options.dataFiltered) {

			activeRows.forEach(function (row) {
				activeRowComponents.push(row.getComponent());
			});

			self.table.options.dataFiltered.call(self.table, self.getFilters(), activeRowComponents);
		}

		return activeRows;
	};

	//filter individual row
	Filter.prototype.filterRow = function (row, filters) {
		var self = this,
		    match = true,
		    data = row.getData();

		self.filterList.forEach(function (filter) {
			if (!self.filterRecurse(filter, data)) {
				match = false;
			}
		});

		for (var field in self.headerFilters) {
			if (!self.headerFilters[field].func(data)) {
				match = false;
			}
		}

		return match;
	};

	Filter.prototype.filterRecurse = function (filter, data) {
		var self = this,
		    match = false;

		if (Array.isArray(filter)) {
			filter.forEach(function (subFilter) {
				if (self.filterRecurse(subFilter, data)) {
					match = true;
				}
			});
		} else {
			match = filter.func(data);
		}

		return match;
	};

	//list of available filters
	Filter.prototype.filters = {

		//equal to
		"=": function _(filterVal, rowVal, rowData, filterParams) {
			return rowVal == filterVal ? true : false;
		},

		//less than
		"<": function _(filterVal, rowVal, rowData, filterParams) {
			return rowVal < filterVal ? true : false;
		},

		//less than or equal to
		"<=": function _(filterVal, rowVal, rowData, filterParams) {
			return rowVal <= filterVal ? true : false;
		},

		//greater than
		">": function _(filterVal, rowVal, rowData, filterParams) {
			return rowVal > filterVal ? true : false;
		},

		//greater than or equal to
		">=": function _(filterVal, rowVal, rowData, filterParams) {
			return rowVal >= filterVal ? true : false;
		},

		//not equal to
		"!=": function _(filterVal, rowVal, rowData, filterParams) {
			return rowVal != filterVal ? true : false;
		},

		"regex": function regex(filterVal, rowVal, rowData, filterParams) {

			if (typeof filterVal == "string") {
				filterVal = new RegExp(filterVal);
			}

			return filterVal.test(rowVal);
		},

		//contains the string
		"like": function like(filterVal, rowVal, rowData, filterParams) {
			if (filterVal === null || typeof filterVal === "undefined") {
				return rowVal === filterVal ? true : false;
			} else {
				if (typeof rowVal !== 'undefined' && rowVal !== null) {
					return String(rowVal).toLowerCase().indexOf(filterVal.toLowerCase()) > -1;
				} else {
					return false;
				}
			}
		},

		//contains the keywords
		"keywords": function keywords(filterVal, rowVal, rowData, filterParams) {
			var keywords = filterVal.toLowerCase().split(typeof filterParams.separator === "undefined" ? " " : filterParams.separator),
			    value = String(rowVal === null || typeof rowVal === "undefined" ? "" : rowVal).toLowerCase(),
			    matches = [];

			keywords.forEach(function (keyword) {
				if (value.includes(keyword)) {
					matches.push(true);
				}
			});

			return filterParams.matchAll ? matches.length === keywords.length : !!matches.length;
		},

		//starts with the string
		"starts": function starts(filterVal, rowVal, rowData, filterParams) {
			if (filterVal === null || typeof filterVal === "undefined") {
				return rowVal === filterVal ? true : false;
			} else {
				if (typeof rowVal !== 'undefined' && rowVal !== null) {
					return String(rowVal).toLowerCase().startsWith(filterVal.toLowerCase());
				} else {
					return false;
				}
			}
		},

		//ends with the string
		"ends": function ends(filterVal, rowVal, rowData, filterParams) {
			if (filterVal === null || typeof filterVal === "undefined") {
				return rowVal === filterVal ? true : false;
			} else {
				if (typeof rowVal !== 'undefined' && rowVal !== null) {
					return String(rowVal).toLowerCase().endsWith(filterVal.toLowerCase());
				} else {
					return false;
				}
			}
		},

		//in array
		"in": function _in(filterVal, rowVal, rowData, filterParams) {
			if (Array.isArray(filterVal)) {
				return filterVal.indexOf(rowVal) > -1;
			} else {
				console.warn("Filter Error - filter value is not an array:", filterVal);
				return false;
			}
		}
	};

	Tabulator.prototype.registerModule("filter", Filter);

	var Format = function Format(table) {
		this.table = table; //hold Tabulator object
	};

	//initialize column formatter
	Format.prototype.initializeColumn = function (column) {
		column.modules.format = this.lookupFormatter(column, "");

		if (typeof column.definition.formatterPrint !== "undefined") {
			column.modules.format.print = this.lookupFormatter(column, "Print");
		}

		if (typeof column.definition.formatterClipboard !== "undefined") {
			column.modules.format.clipboard = this.lookupFormatter(column, "Clipboard");
		}

		if (typeof column.definition.formatterHtmlOutput !== "undefined") {
			column.modules.format.htmlOutput = this.lookupFormatter(column, "HtmlOutput");
		}
	};

	Format.prototype.lookupFormatter = function (column, type) {
		var config = { params: column.definition["formatter" + type + "Params"] || {} },
		    formatter = column.definition["formatter" + type];

		//set column formatter
		switch (typeof formatter === 'undefined' ? 'undefined' : _typeof(formatter)) {
			case "string":

				if (formatter === "tick") {
					formatter = "tickCross";

					if (typeof config.params.crossElement == "undefined") {
						config.params.crossElement = false;
					}

					console.warn("DEPRECATION WARNING - the tick formatter has been deprecated, please use the tickCross formatter with the crossElement param set to false");
				}

				if (this.formatters[formatter]) {
					config.formatter = this.formatters[formatter];
				} else {
					console.warn("Formatter Error - No such formatter found: ", formatter);
					config.formatter = this.formatters.plaintext;
				}
				break;

			case "function":
				config.formatter = formatter;
				break;

			default:
				config.formatter = this.formatters.plaintext;
				break;
		}

		return config;
	};

	Format.prototype.cellRendered = function (cell) {
		if (cell.modules.format && cell.modules.format.renderedCallback) {
			cell.modules.format.renderedCallback();
		}
	};

	//return a formatted value for a cell
	Format.prototype.formatValue = function (cell) {
		var component = cell.getComponent(),
		    params = typeof cell.column.modules.format.params === "function" ? cell.column.modules.format.params(component) : cell.column.modules.format.params;

		function onRendered(callback) {
			if (!cell.modules.format) {
				cell.modules.format = {};
			}

			cell.modules.format.renderedCallback = callback;
		}

		return cell.column.modules.format.formatter.call(this, component, params, onRendered);
	};

	Format.prototype.formatExportValue = function (cell, type) {
		var formatter = cell.column.modules.format[type],
		    params;

		if (formatter) {
			var onRendered = function onRendered(callback) {
				if (!cell.modules.format) {
					cell.modules.format = {};
				}

				cell.modules.format.renderedCallback = callback;
			};

			params = typeof formatter.params === "function" ? formatter.params(component) : formatter.params;

			return formatter.formatter.call(this, cell.getComponent(), params, onRendered);
		} else {
			return this.formatValue(cell);
		}
	};

	Format.prototype.sanitizeHTML = function (value) {
		if (value) {
			var entityMap = {
				'&': '&amp;',
				'<': '&lt;',
				'>': '&gt;',
				'"': '&quot;',
				"'": '&#39;',
				'/': '&#x2F;',
				'`': '&#x60;',
				'=': '&#x3D;'
			};

			return String(value).replace(/[&<>"'`=\/]/g, function (s) {
				return entityMap[s];
			});
		} else {
			return value;
		}
	};

	Format.prototype.emptyToSpace = function (value) {
		return value === null || typeof value === "undefined" || value === "" ? "&nbsp;" : value;
	};

	//get formatter for cell
	Format.prototype.getFormatter = function (formatter) {
		var formatter;

		switch (typeof formatter === 'undefined' ? 'undefined' : _typeof(formatter)) {
			case "string":
				if (this.formatters[formatter]) {
					formatter = this.formatters[formatter];
				} else {
					console.warn("Formatter Error - No such formatter found: ", formatter);
					formatter = this.formatters.plaintext;
				}
				break;

			case "function":
				formatter = formatter;
				break;

			default:
				formatter = this.formatters.plaintext;
				break;
		}

		return formatter;
	};

	//default data formatters
	Format.prototype.formatters = {
		//plain text value
		plaintext: function plaintext(cell, formatterParams, onRendered) {
			return this.emptyToSpace(this.sanitizeHTML(cell.getValue()));
		},

		//html text value
		html: function html(cell, formatterParams, onRendered) {
			return cell.getValue();
		},

		//multiline text area
		textarea: function textarea(cell, formatterParams, onRendered) {
			cell.getElement().style.whiteSpace = "pre-wrap";
			return this.emptyToSpace(this.sanitizeHTML(cell.getValue()));
		},

		//currency formatting
		money: function money(cell, formatterParams, onRendered) {
			var floatVal = parseFloat(cell.getValue()),
			    number,
			    integer,
			    decimal,
			    rgx;

			var decimalSym = formatterParams.decimal || ".";
			var thousandSym = formatterParams.thousand || ",";
			var symbol = formatterParams.symbol || "";
			var after = !!formatterParams.symbolAfter;
			var precision = typeof formatterParams.precision !== "undefined" ? formatterParams.precision : 2;

			if (isNaN(floatVal)) {
				return this.emptyToSpace(this.sanitizeHTML(cell.getValue()));
			}

			number = precision !== false ? floatVal.toFixed(precision) : floatVal;
			number = String(number).split(".");

			integer = number[0];
			decimal = number.length > 1 ? decimalSym + number[1] : "";

			rgx = /(\d+)(\d{3})/;

			while (rgx.test(integer)) {
				integer = integer.replace(rgx, "$1" + thousandSym + "$2");
			}

			return after ? integer + decimal + symbol : symbol + integer + decimal;
		},

		//clickable anchor tag
		link: function link(cell, formatterParams, onRendered) {
			var value = cell.getValue(),
			    urlPrefix = formatterParams.urlPrefix || "",
			    download = formatterParams.download,
			    label = value,
			    el = document.createElement("a"),
			    data;

			if (formatterParams.labelField) {
				data = cell.getData();
				label = data[formatterParams.labelField];
			}

			if (formatterParams.label) {
				switch (_typeof(formatterParams.label)) {
					case "string":
						label = formatterParams.label;
						break;

					case "function":
						label = formatterParams.label(cell);
						break;
				}
			}

			if (label) {
				if (formatterParams.urlField) {
					data = cell.getData();
					value = data[formatterParams.urlField];
				}

				if (formatterParams.url) {
					switch (_typeof(formatterParams.url)) {
						case "string":
							value = formatterParams.url;
							break;

						case "function":
							value = formatterParams.url(cell);
							break;
					}
				}

				el.setAttribute("href", urlPrefix + value);

				if (formatterParams.target) {
					el.setAttribute("target", formatterParams.target);
				}

				if (formatterParams.download) {

					if (typeof download == "function") {
						download = download(cell);
					} else {
						download = download === true ? "" : download;
					}

					el.setAttribute("download", download);
				}

				el.innerHTML = this.emptyToSpace(this.sanitizeHTML(label));

				return el;
			} else {
				return "&nbsp;";
			}
		},

		//image element
		image: function image(cell, formatterParams, onRendered) {
			var el = document.createElement("img");
			el.setAttribute("src", cell.getValue());

			switch (_typeof(formatterParams.height)) {
				case "number":
					el.style.height = formatterParams.height + "px";
					break;

				case "string":
					el.style.height = formatterParams.height;
					break;
			}

			switch (_typeof(formatterParams.width)) {
				case "number":
					el.style.width = formatterParams.width + "px";
					break;

				case "string":
					el.style.width = formatterParams.width;
					break;
			}

			el.addEventListener("load", function () {
				cell.getRow().normalizeHeight();
			});

			return el;
		},

		//tick or cross
		tickCross: function tickCross(cell, formatterParams, onRendered) {
			var value = cell.getValue(),
			    element = cell.getElement(),
			    empty = formatterParams.allowEmpty,
			    truthy = formatterParams.allowTruthy,
			    tick = typeof formatterParams.tickElement !== "undefined" ? formatterParams.tickElement : '<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',
			    cross = typeof formatterParams.crossElement !== "undefined" ? formatterParams.crossElement : '<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';

			if (truthy && value || value === true || value === "true" || value === "True" || value === 1 || value === "1") {
				element.setAttribute("aria-checked", true);
				return tick || "";
			} else {
				if (empty && (value === "null" || value === "" || value === null || typeof value === "undefined")) {
					element.setAttribute("aria-checked", "mixed");
					return "";
				} else {
					element.setAttribute("aria-checked", false);
					return cross || "";
				}
			}
		},

		datetime: function datetime(cell, formatterParams, onRendered) {
			var inputFormat = formatterParams.inputFormat || "YYYY-MM-DD hh:mm:ss";
			var outputFormat = formatterParams.outputFormat || "DD/MM/YYYY hh:mm:ss";
			var invalid = typeof formatterParams.invalidPlaceholder !== "undefined" ? formatterParams.invalidPlaceholder : "";
			var value = cell.getValue();

			var newDatetime = moment(value, inputFormat);

			if (newDatetime.isValid()) {
				return formatterParams.timezone ? newDatetime.tz(formatterParams.timezone).format(outputFormat) : newDatetime.format(outputFormat);
			} else {

				if (invalid === true) {
					return value;
				} else if (typeof invalid === "function") {
					return invalid(value);
				} else {
					return invalid;
				}
			}
		},

		datetimediff: function datetime(cell, formatterParams, onRendered) {
			var inputFormat = formatterParams.inputFormat || "YYYY-MM-DD hh:mm:ss";
			var invalid = typeof formatterParams.invalidPlaceholder !== "undefined" ? formatterParams.invalidPlaceholder : "";
			var suffix = typeof formatterParams.suffix !== "undefined" ? formatterParams.suffix : false;
			var unit = typeof formatterParams.unit !== "undefined" ? formatterParams.unit : undefined;
			var humanize = typeof formatterParams.humanize !== "undefined" ? formatterParams.humanize : false;
			var date = typeof formatterParams.date !== "undefined" ? formatterParams.date : moment();
			var value = cell.getValue();

			var newDatetime = moment(value, inputFormat);

			if (newDatetime.isValid()) {
				if (humanize) {
					return moment.duration(newDatetime.diff(date)).humanize(suffix);
				} else {
					return newDatetime.diff(date, unit) + (suffix ? " " + suffix : "");
				}
			} else {

				if (invalid === true) {
					return value;
				} else if (typeof invalid === "function") {
					return invalid(value);
				} else {
					return invalid;
				}
			}
		},

		//select
		lookup: function lookup(cell, formatterParams, onRendered) {
			var value = cell.getValue();

			if (typeof formatterParams[value] === "undefined") {
				console.warn('Missing display value for ' + value);
				return value;
			}

			return formatterParams[value];
		},

		//star rating
		star: function star(cell, formatterParams, onRendered) {
			var value = cell.getValue(),
			    element = cell.getElement(),
			    maxStars = formatterParams && formatterParams.stars ? formatterParams.stars : 5,
			    stars = document.createElement("span"),
			    star = document.createElementNS('http://www.w3.org/2000/svg', "svg"),
			    starActive = '<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',
			    starInactive = '<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';

			//style stars holder
			stars.style.verticalAlign = "middle";

			//style star
			star.setAttribute("width", "14");
			star.setAttribute("height", "14");
			star.setAttribute("viewBox", "0 0 512 512");
			star.setAttribute("xml:space", "preserve");
			star.style.padding = "0 1px";

			value = value && !isNaN(value) ? parseInt(value) : 0;

			value = Math.max(0, Math.min(value, maxStars));

			for (var i = 1; i <= maxStars; i++) {
				var nextStar = star.cloneNode(true);
				nextStar.innerHTML = i <= value ? starActive : starInactive;

				stars.appendChild(nextStar);
			}

			element.style.whiteSpace = "nowrap";
			element.style.overflow = "hidden";
			element.style.textOverflow = "ellipsis";

			element.setAttribute("aria-label", value);

			return stars;
		},

		traffic: function traffic(cell, formatterParams, onRendered) {
			var value = this.sanitizeHTML(cell.getValue()) || 0,
			    el = document.createElement("span"),
			    max = formatterParams && formatterParams.max ? formatterParams.max : 100,
			    min = formatterParams && formatterParams.min ? formatterParams.min : 0,
			    colors = formatterParams && typeof formatterParams.color !== "undefined" ? formatterParams.color : ["red", "orange", "green"],
			    color = "#666666",
			    percent,
			    percentValue;

			if (isNaN(value) || typeof cell.getValue() === "undefined") {
				return;
			}

			el.classList.add("tabulator-traffic-light");

			//make sure value is in range
			percentValue = parseFloat(value) <= max ? parseFloat(value) : max;
			percentValue = parseFloat(percentValue) >= min ? parseFloat(percentValue) : min;

			//workout percentage
			percent = (max - min) / 100;
			percentValue = Math.round((percentValue - min) / percent);

			//set color
			switch (typeof colors === 'undefined' ? 'undefined' : _typeof(colors)) {
				case "string":
					color = colors;
					break;
				case "function":
					color = colors(value);
					break;
				case "object":
					if (Array.isArray(colors)) {
						var unit = 100 / colors.length;
						var index = Math.floor(percentValue / unit);

						index = Math.min(index, colors.length - 1);
						index = Math.max(index, 0);
						color = colors[index];
						break;
					}
			}

			el.style.backgroundColor = color;

			return el;
		},

		//progress bar
		progress: function progress(cell, formatterParams, onRendered) {
			//progress bar
			var value = this.sanitizeHTML(cell.getValue()) || 0,
			    element = cell.getElement(),
			    max = formatterParams && formatterParams.max ? formatterParams.max : 100,
			    min = formatterParams && formatterParams.min ? formatterParams.min : 0,
			    legendAlign = formatterParams && formatterParams.legendAlign ? formatterParams.legendAlign : "center",
			    percent,
			    percentValue,
			    color,
			    legend,
			    legendColor,
			    top,
			    left,
			    right,
			    bottom;

			//make sure value is in range
			percentValue = parseFloat(value) <= max ? parseFloat(value) : max;
			percentValue = parseFloat(percentValue) >= min ? parseFloat(percentValue) : min;

			//workout percentage
			percent = (max - min) / 100;
			percentValue = Math.round((percentValue - min) / percent);

			//set bar color
			switch (_typeof(formatterParams.color)) {
				case "string":
					color = formatterParams.color;
					break;
				case "function":
					color = formatterParams.color(value);
					break;
				case "object":
					if (Array.isArray(formatterParams.color)) {
						var unit = 100 / formatterParams.color.length;
						var index = Math.floor(percentValue / unit);

						index = Math.min(index, formatterParams.color.length - 1);
						index = Math.max(index, 0);
						color = formatterParams.color[index];
						break;
					}
				default:
					color = "#2DC214";
			}

			//generate legend
			switch (_typeof(formatterParams.legend)) {
				case "string":
					legend = formatterParams.legend;
					break;
				case "function":
					legend = formatterParams.legend(value);
					break;
				case "boolean":
					legend = value;
					break;
				default:
					legend = false;
			}

			//set legend color
			switch (_typeof(formatterParams.legendColor)) {
				case "string":
					legendColor = formatterParams.legendColor;
					break;
				case "function":
					legendColor = formatterParams.legendColor(value);
					break;
				case "object":
					if (Array.isArray(formatterParams.legendColor)) {
						var unit = 100 / formatterParams.legendColor.length;
						var index = Math.floor(percentValue / unit);

						index = Math.min(index, formatterParams.legendColor.length - 1);
						index = Math.max(index, 0);
						legendColor = formatterParams.legendColor[index];
					}
					break;
				default:
					legendColor = "#000";
			}

			element.style.minWidth = "30px";
			element.style.position = "relative";

			element.setAttribute("aria-label", percentValue);

			var barEl = document.createElement("div");
			barEl.style.display = "inline-block";
			barEl.style.position = "relative";
			barEl.style.width = percentValue + "%";
			barEl.style.backgroundColor = color;
			barEl.style.height = "100%";

			barEl.setAttribute('data-max', max);
			barEl.setAttribute('data-min', min);

			if (legend) {
				var legendEl = document.createElement("div");
				legendEl.style.position = "absolute";
				legendEl.style.top = "4px";
				legendEl.style.left = 0;
				legendEl.style.textAlign = legendAlign;
				legendEl.style.width = "100%";
				legendEl.style.color = legendColor;
				legendEl.innerHTML = legend;
			}

			onRendered(function () {

				//handle custom element needed if formatter is to be included in printed/downloaded output
				if (!(cell instanceof CellComponent)) {
					var holderEl = document.createElement("div");
					holderEl.style.position = "absolute";
					holderEl.style.top = "4px";
					holderEl.style.bottom = "4px";
					holderEl.style.left = "4px";
					holderEl.style.right = "4px";

					element.appendChild(holderEl);

					element = holderEl;
				}

				element.appendChild(barEl);

				if (legend) {
					element.appendChild(legendEl);
				}
			});

			return "";
		},

		//background color
		color: function color(cell, formatterParams, onRendered) {
			cell.getElement().style.backgroundColor = this.sanitizeHTML(cell.getValue());
			return "";
		},

		//tick icon
		buttonTick: function buttonTick(cell, formatterParams, onRendered) {
			return '<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>';
		},

		//cross icon
		buttonCross: function buttonCross(cell, formatterParams, onRendered) {
			return '<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';
		},

		//current row number
		rownum: function rownum(cell, formatterParams, onRendered) {
			return this.table.rowManager.activeRows.indexOf(cell.getRow()._getSelf()) + 1;
		},

		//row handle
		handle: function handle(cell, formatterParams, onRendered) {
			cell.getElement().classList.add("tabulator-row-handle");
			return "<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>";
		},

		responsiveCollapse: function responsiveCollapse(cell, formatterParams, onRendered) {
			var self = this,
			    open = false,
			    el = document.createElement("div"),
			    config = cell.getRow()._row.modules.responsiveLayout;

			el.classList.add("tabulator-responsive-collapse-toggle");
			el.innerHTML = "<span class='tabulator-responsive-collapse-toggle-open'>+</span><span class='tabulator-responsive-collapse-toggle-close'>-</span>";

			cell.getElement().classList.add("tabulator-row-handle");

			function toggleList(isOpen) {
				var collapseEl = config.element;

				config.open = isOpen;

				if (collapseEl) {

					if (config.open) {
						el.classList.add("open");
						collapseEl.style.display = '';
					} else {
						el.classList.remove("open");
						collapseEl.style.display = 'none';
					}
				}
			}

			el.addEventListener("click", function (e) {
				e.stopImmediatePropagation();
				toggleList(!config.open);
			});

			toggleList(config.open);

			return el;
		},

		rowSelection: function rowSelection(cell) {
			var _this54 = this;

			var checkbox = document.createElement("input");

			checkbox.type = 'checkbox';

			if (this.table.modExists("selectRow", true)) {

				checkbox.addEventListener("click", function (e) {
					e.stopPropagation();
				});

				if (typeof cell.getRow == 'function') {
					var row = cell.getRow();

					checkbox.addEventListener("change", function (e) {
						row.toggleSelect();
					});

					checkbox.checked = row.isSelected();
					this.table.modules.selectRow.registerRowSelectCheckbox(row, checkbox);
				} else {
					checkbox.addEventListener("change", function (e) {
						if (_this54.table.modules.selectRow.selectedRows.length) {
							_this54.table.deselectRow();
						} else {
							_this54.table.selectRow();
						}
					});

					this.table.modules.selectRow.registerHeaderSelectCheckbox(checkbox);
				}
			}
			return checkbox;
		}
	};

	Tabulator.prototype.registerModule("format", Format);

	var FrozenColumns = function FrozenColumns(table) {
		this.table = table; //hold Tabulator object
		this.leftColumns = [];
		this.rightColumns = [];
		this.leftMargin = 0;
		this.rightMargin = 0;
		this.rightPadding = 0;
		this.initializationMode = "left";
		this.active = false;
		this.scrollEndTimer = false;
	};

	//reset initial state
	FrozenColumns.prototype.reset = function () {
		this.initializationMode = "left";
		this.leftColumns = [];
		this.rightColumns = [];
		this.leftMargin = 0;
		this.rightMargin = 0;
		this.rightMargin = 0;
		this.active = false;

		this.table.columnManager.headersElement.style.marginLeft = 0;
		this.table.columnManager.element.style.paddingRight = 0;
	};

	//initialize specific column
	FrozenColumns.prototype.initializeColumn = function (column) {
		var config = { margin: 0, edge: false };

		if (!column.isGroup) {

			if (this.frozenCheck(column)) {

				config.position = this.initializationMode;

				if (this.initializationMode == "left") {
					this.leftColumns.push(column);
				} else {
					this.rightColumns.unshift(column);
				}

				this.active = true;

				column.modules.frozen = config;
			} else {
				this.initializationMode = "right";
			}
		}
	};

	FrozenColumns.prototype.frozenCheck = function (column) {
		var frozen = false;

		if (column.parent.isGroup && column.definition.frozen) {
			console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups");
		}

		if (column.parent.isGroup) {
			return this.frozenCheck(column.parent);
		} else {
			return column.definition.frozen;
		}

		return frozen;
	};

	//quick layout to smooth horizontal scrolling
	FrozenColumns.prototype.scrollHorizontal = function () {
		var _this55 = this;

		var rows;

		if (this.active) {
			clearTimeout(this.scrollEndTimer);

			//layout all rows after scroll is complete
			this.scrollEndTimer = setTimeout(function () {
				_this55.layout();
			}, 100);

			rows = this.table.rowManager.getVisibleRows();

			this.calcMargins();

			this.layoutColumnPosition();

			this.layoutCalcRows();

			rows.forEach(function (row) {
				if (row.type === "row") {
					_this55.layoutRow(row);
				}
			});

			this.table.rowManager.tableElement.style.marginRight = this.rightMargin;
		}
	};

	//calculate margins for rows
	FrozenColumns.prototype.calcMargins = function () {
		this.leftMargin = this._calcSpace(this.leftColumns, this.leftColumns.length) + "px";
		this.table.columnManager.headersElement.style.marginLeft = this.leftMargin;

		this.rightMargin = this._calcSpace(this.rightColumns, this.rightColumns.length) + "px";
		this.table.columnManager.element.style.paddingRight = this.rightMargin;

		//calculate right frozen columns
		this.rightPadding = this.table.rowManager.element.clientWidth + this.table.columnManager.scrollLeft;
	};

	//layout calculation rows
	FrozenColumns.prototype.layoutCalcRows = function () {
		if (this.table.modExists("columnCalcs")) {
			if (this.table.modules.columnCalcs.topInitialized && this.table.modules.columnCalcs.topRow) {
				this.layoutRow(this.table.modules.columnCalcs.topRow);
			}
			if (this.table.modules.columnCalcs.botInitialized && this.table.modules.columnCalcs.botRow) {
				this.layoutRow(this.table.modules.columnCalcs.botRow);
			}
		}
	};

	//calculate column positions and layout headers
	FrozenColumns.prototype.layoutColumnPosition = function (allCells) {
		var _this56 = this;

		var leftParents = [];

		this.leftColumns.forEach(function (column, i) {
			column.modules.frozen.margin = _this56._calcSpace(_this56.leftColumns, i) + _this56.table.columnManager.scrollLeft + "px";

			if (i == _this56.leftColumns.length - 1) {
				column.modules.frozen.edge = true;
			} else {
				column.modules.frozen.edge = false;
			}

			if (column.parent.isGroup) {
				var parentEl = _this56.getColGroupParentElement(column);
				if (!leftParents.includes(parentEl)) {
					_this56.layoutElement(parentEl, column);
					leftParents.push(parentEl);
				}

				if (column.modules.frozen.edge) {
					parentEl.classList.add("tabulator-frozen-" + column.modules.frozen.position);
				}
			} else {
				_this56.layoutElement(column.getElement(), column);
			}

			if (allCells) {
				column.cells.forEach(function (cell) {
					_this56.layoutElement(cell.getElement(), column);
				});
			}
		});

		this.rightColumns.forEach(function (column, i) {
			column.modules.frozen.margin = _this56.rightPadding - _this56._calcSpace(_this56.rightColumns, i + 1) + "px";

			if (i == _this56.rightColumns.length - 1) {
				column.modules.frozen.edge = true;
			} else {
				column.modules.frozen.edge = false;
			}

			if (column.parent.isGroup) {
				_this56.layoutElement(_this56.getColGroupParentElement(column), column);
			} else {
				_this56.layoutElement(column.getElement(), column);
			}

			if (allCells) {
				column.cells.forEach(function (cell) {
					_this56.layoutElement(cell.getElement(), column);
				});
			}
		});
	};

	FrozenColumns.prototype.getColGroupParentElement = function (column) {
		return column.parent.isGroup ? this.getColGroupParentElement(column.parent) : column.getElement();
	};

	//layout columns appropropriatly
	FrozenColumns.prototype.layout = function () {
		var self = this,
		    rightMargin = 0;

		if (self.active) {

			//calculate row padding
			this.calcMargins();

			// self.table.rowManager.activeRows.forEach(function(row){
			// 	self.layoutRow(row);
			// });

			// if(self.table.options.dataTree){
			self.table.rowManager.getDisplayRows().forEach(function (row) {
				if (row.type === "row") {
					self.layoutRow(row);
				}
			});
			// }

			this.layoutCalcRows();

			//calculate left columns
			this.layoutColumnPosition(true);

			// if(tableHolder.scrollHeight > tableHolder.clientHeight){
			// 	rightMargin -= tableHolder.offsetWidth - tableHolder.clientWidth;
			// }

			this.table.rowManager.tableElement.style.marginRight = this.rightMargin;
		}
	};

	FrozenColumns.prototype.layoutRow = function (row) {
		var _this57 = this;

		var rowEl = row.getElement();

		rowEl.style.paddingLeft = this.leftMargin;
		// rowEl.style.paddingRight = this.rightMargin + "px";

		this.leftColumns.forEach(function (column) {
			var cell = row.getCell(column);

			if (cell) {
				_this57.layoutElement(cell.getElement(), column);
			}
		});

		this.rightColumns.forEach(function (column) {
			var cell = row.getCell(column);

			if (cell) {
				_this57.layoutElement(cell.getElement(), column);
			}
		});
	};

	FrozenColumns.prototype.layoutElement = function (element, column) {

		if (column.modules.frozen) {
			element.style.position = "absolute";
			element.style.left = column.modules.frozen.margin;

			element.classList.add("tabulator-frozen");

			if (column.modules.frozen.edge) {
				element.classList.add("tabulator-frozen-" + column.modules.frozen.position);
			}
		}
	};

	FrozenColumns.prototype._calcSpace = function (columns, index) {
		var width = 0;

		for (var _i8 = 0; _i8 < index; _i8++) {
			if (columns[_i8].visible) {
				width += columns[_i8].getWidth();
			}
		}

		return width;
	};

	Tabulator.prototype.registerModule("frozenColumns", FrozenColumns);
	var FrozenRows = function FrozenRows(table) {
		this.table = table; //hold Tabulator object
		this.topElement = document.createElement("div");
		this.rows = [];
		this.displayIndex = 0; //index in display pipeline
	};

	FrozenRows.prototype.initialize = function () {
		this.rows = [];

		this.topElement.classList.add("tabulator-frozen-rows-holder");

		// this.table.columnManager.element.append(this.topElement);
		this.table.columnManager.getElement().insertBefore(this.topElement, this.table.columnManager.headersElement.nextSibling);
	};

	FrozenRows.prototype.setDisplayIndex = function (index) {
		this.displayIndex = index;
	};

	FrozenRows.prototype.getDisplayIndex = function () {
		return this.displayIndex;
	};

	FrozenRows.prototype.isFrozen = function () {
		return !!this.rows.length;
	};

	//filter frozen rows out of display data
	FrozenRows.prototype.getRows = function (rows) {
		var self = this,
		    frozen = [],
		    output = rows.slice(0);

		this.rows.forEach(function (row) {
			var index = output.indexOf(row);

			if (index > -1) {
				output.splice(index, 1);
			}
		});

		return output;
	};

	FrozenRows.prototype.freezeRow = function (row) {
		if (!row.modules.frozen) {
			row.modules.frozen = true;
			this.topElement.appendChild(row.getElement());
			row.initialize();
			row.normalizeHeight();
			this.table.rowManager.adjustTableSize();

			this.rows.push(row);

			this.table.rowManager.refreshActiveData("display");

			this.styleRows();
		} else {
			console.warn("Freeze Error - Row is already frozen");
		}
	};

	FrozenRows.prototype.unfreezeRow = function (row) {
		var index = this.rows.indexOf(row);

		if (row.modules.frozen) {

			row.modules.frozen = false;

			var rowEl = row.getElement();
			rowEl.parentNode.removeChild(rowEl);

			this.table.rowManager.adjustTableSize();

			this.rows.splice(index, 1);

			this.table.rowManager.refreshActiveData("display");

			if (this.rows.length) {
				this.styleRows();
			}
		} else {
			console.warn("Freeze Error - Row is already unfrozen");
		}
	};

	FrozenRows.prototype.styleRows = function (row) {
		var self = this;

		this.rows.forEach(function (row, i) {
			self.table.rowManager.styleRow(row, i);
		});
	};

	Tabulator.prototype.registerModule("frozenRows", FrozenRows);

	//public group object
	var GroupComponent = function GroupComponent(group) {
		this._group = group;
		this.type = "GroupComponent";
	};

	GroupComponent.prototype.getKey = function () {
		return this._group.key;
	};

	GroupComponent.prototype.getField = function () {
		return this._group.field;
	};

	GroupComponent.prototype.getElement = function () {
		return this._group.element;
	};

	GroupComponent.prototype.getRows = function () {
		return this._group.getRows(true);
	};

	GroupComponent.prototype.getSubGroups = function () {
		return this._group.getSubGroups(true);
	};

	GroupComponent.prototype.getParentGroup = function () {
		return this._group.parent ? this._group.parent.getComponent() : false;
	};

	GroupComponent.prototype.getVisibility = function () {
		console.warn("getVisibility function is deprecated, you should now use the isVisible function");
		return this._group.visible;
	};

	GroupComponent.prototype.isVisible = function () {
		return this._group.visible;
	};

	GroupComponent.prototype.show = function () {
		this._group.show();
	};

	GroupComponent.prototype.hide = function () {
		this._group.hide();
	};

	GroupComponent.prototype.toggle = function () {
		this._group.toggleVisibility();
	};

	GroupComponent.prototype._getSelf = function () {
		return this._group;
	};

	GroupComponent.prototype.getTable = function () {
		return this._group.groupManager.table;
	};

	//////////////////////////////////////////////////
	//////////////// Group Functions /////////////////
	//////////////////////////////////////////////////

	var Group = function Group(groupManager, parent, level, key, field, generator, oldGroup) {

		this.groupManager = groupManager;
		this.parent = parent;
		this.key = key;
		this.level = level;
		this.field = field;
		this.hasSubGroups = level < groupManager.groupIDLookups.length - 1;
		this.addRow = this.hasSubGroups ? this._addRowToGroup : this._addRow;
		this.type = "group"; //type of element
		this.old = oldGroup;
		this.rows = [];
		this.groups = [];
		this.groupList = [];
		this.generator = generator;
		this.elementContents = false;
		this.height = 0;
		this.outerHeight = 0;
		this.initialized = false;
		this.calcs = {};
		this.initialized = false;
		this.modules = {};
		this.arrowElement = false;

		this.visible = oldGroup ? oldGroup.visible : typeof groupManager.startOpen[level] !== "undefined" ? groupManager.startOpen[level] : groupManager.startOpen[0];

		this.component = null;

		this.createElements();
		this.addBindings();

		this.createValueGroups();
	};

	Group.prototype.wipe = function () {
		if (this.groupList.length) {
			this.groupList.forEach(function (group) {
				group.wipe();
			});
		} else {
			this.element = false;
			this.arrowElement = false;
			this.elementContents = false;
		}
	};

	Group.prototype.createElements = function () {
		var arrow = document.createElement("div");
		arrow.classList.add("tabulator-arrow");

		this.element = document.createElement("div");
		this.element.classList.add("tabulator-row");
		this.element.classList.add("tabulator-group");
		this.element.classList.add("tabulator-group-level-" + this.level);
		this.element.setAttribute("role", "rowgroup");

		this.arrowElement = document.createElement("div");
		this.arrowElement.classList.add("tabulator-group-toggle");
		this.arrowElement.appendChild(arrow);

		//setup movable rows
		if (this.groupManager.table.options.movableRows !== false && this.groupManager.table.modExists("moveRow")) {
			this.groupManager.table.modules.moveRow.initializeGroupHeader(this);
		}
	};

	Group.prototype.createValueGroups = function () {
		var _this58 = this;

		var level = this.level + 1;
		if (this.groupManager.allowedValues && this.groupManager.allowedValues[level]) {
			this.groupManager.allowedValues[level].forEach(function (value) {
				_this58._createGroup(value, level);
			});
		}
	};

	Group.prototype.addBindings = function () {
		var self = this,
		    dblTap,
		    tapHold,
		    tap,
		    toggleElement;

		//handle group click events
		if (self.groupManager.table.options.groupClick) {
			self.element.addEventListener("click", function (e) {
				self.groupManager.table.options.groupClick.call(self.groupManager.table, e, self.getComponent());
			});
		}

		if (self.groupManager.table.options.groupDblClick) {
			self.element.addEventListener("dblclick", function (e) {
				self.groupManager.table.options.groupDblClick.call(self.groupManager.table, e, self.getComponent());
			});
		}

		if (self.groupManager.table.options.groupContext) {
			self.element.addEventListener("contextmenu", function (e) {
				self.groupManager.table.options.groupContext.call(self.groupManager.table, e, self.getComponent());
			});
		}

		if (self.groupManager.table.options.groupContextMenu && self.groupManager.table.modExists("menu")) {
			self.groupManager.table.modules.menu.initializeGroup.call(self.groupManager.table.modules.menu, self);
		}

		if (self.groupManager.table.options.groupTap) {

			tap = false;

			self.element.addEventListener("touchstart", function (e) {
				tap = true;
			}, { passive: true });

			self.element.addEventListener("touchend", function (e) {
				if (tap) {
					self.groupManager.table.options.groupTap(e, self.getComponent());
				}

				tap = false;
			});
		}

		if (self.groupManager.table.options.groupDblTap) {

			dblTap = null;

			self.element.addEventListener("touchend", function (e) {

				if (dblTap) {
					clearTimeout(dblTap);
					dblTap = null;

					self.groupManager.table.options.groupDblTap(e, self.getComponent());
				} else {

					dblTap = setTimeout(function () {
						clearTimeout(dblTap);
						dblTap = null;
					}, 300);
				}
			});
		}

		if (self.groupManager.table.options.groupTapHold) {

			tapHold = null;

			self.element.addEventListener("touchstart", function (e) {
				clearTimeout(tapHold);

				tapHold = setTimeout(function () {
					clearTimeout(tapHold);
					tapHold = null;
					tap = false;
					self.groupManager.table.options.groupTapHold(e, self.getComponent());
				}, 1000);
			}, { passive: true });

			self.element.addEventListener("touchend", function (e) {
				clearTimeout(tapHold);
				tapHold = null;
			});
		}

		if (self.groupManager.table.options.groupToggleElement) {
			toggleElement = self.groupManager.table.options.groupToggleElement == "arrow" ? self.arrowElement : self.element;

			toggleElement.addEventListener("click", function (e) {
				e.stopPropagation();
				e.stopImmediatePropagation();
				self.toggleVisibility();
			});
		}
	};

	Group.prototype._createGroup = function (groupID, level) {
		var groupKey = level + "_" + groupID;
		var group = new Group(this.groupManager, this, level, groupID, this.groupManager.groupIDLookups[level].field, this.groupManager.headerGenerator[level] || this.groupManager.headerGenerator[0], this.old ? this.old.groups[groupKey] : false);

		this.groups[groupKey] = group;
		this.groupList.push(group);
	};

	Group.prototype._addRowToGroup = function (row) {

		var level = this.level + 1;

		if (this.hasSubGroups) {
			var groupID = this.groupManager.groupIDLookups[level].func(row.getData()),
			    groupKey = level + "_" + groupID;

			if (this.groupManager.allowedValues && this.groupManager.allowedValues[level]) {
				if (this.groups[groupKey]) {
					this.groups[groupKey].addRow(row);
				}
			} else {
				if (!this.groups[groupKey]) {
					this._createGroup(groupID, level);
				}

				this.groups[groupKey].addRow(row);
			}
		}
	};

	Group.prototype._addRow = function (row) {
		this.rows.push(row);
		row.modules.group = this;
	};

	Group.prototype.insertRow = function (row, to, after) {
		var data = this.conformRowData({});

		row.updateData(data);

		var toIndex = this.rows.indexOf(to);

		if (toIndex > -1) {
			if (after) {
				this.rows.splice(toIndex + 1, 0, row);
			} else {
				this.rows.splice(toIndex, 0, row);
			}
		} else {
			if (after) {
				this.rows.push(row);
			} else {
				this.rows.unshift(row);
			}
		}

		row.modules.group = this;

		this.generateGroupHeaderContents();

		if (this.groupManager.table.modExists("columnCalcs") && this.groupManager.table.options.columnCalcs != "table") {
			this.groupManager.table.modules.columnCalcs.recalcGroup(this);
		}

		this.groupManager.updateGroupRows(true);
	};

	Group.prototype.scrollHeader = function (left) {
		this.arrowElement.style.marginLeft = left;

		this.groupList.forEach(function (child) {
			child.scrollHeader(left);
		});
	};

	Group.prototype.getRowIndex = function (row) {};

	//update row data to match grouping contraints
	Group.prototype.conformRowData = function (data) {
		if (this.field) {
			data[this.field] = this.key;
		} else {
			console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function");
		}

		if (this.parent) {
			data = this.parent.conformRowData(data);
		}

		return data;
	};

	Group.prototype.removeRow = function (row) {
		var index = this.rows.indexOf(row);
		var el = row.getElement();

		if (index > -1) {
			this.rows.splice(index, 1);
		}

		if (!this.groupManager.table.options.groupValues && !this.rows.length) {
			if (this.parent) {
				this.parent.removeGroup(this);
			} else {
				this.groupManager.removeGroup(this);
			}

			this.groupManager.updateGroupRows(true);
		} else {

			if (el.parentNode) {
				el.parentNode.removeChild(el);
			}

			this.generateGroupHeaderContents();

			if (this.groupManager.table.modExists("columnCalcs") && this.groupManager.table.options.columnCalcs != "table") {
				this.groupManager.table.modules.columnCalcs.recalcGroup(this);
			}
		}
	};

	Group.prototype.removeGroup = function (group) {
		var groupKey = group.level + "_" + group.key,
		    index;

		if (this.groups[groupKey]) {
			delete this.groups[groupKey];

			index = this.groupList.indexOf(group);

			if (index > -1) {
				this.groupList.splice(index, 1);
			}

			if (!this.groupList.length) {
				if (this.parent) {
					this.parent.removeGroup(this);
				} else {
					this.groupManager.removeGroup(this);
				}
			}
		}
	};

	Group.prototype.getHeadersAndRows = function (noCalc) {
		var output = [];

		output.push(this);

		this._visSet();

		if (this.visible) {
			if (this.groupList.length) {
				this.groupList.forEach(function (group) {
					output = output.concat(group.getHeadersAndRows(noCalc));
				});
			} else {
				if (!noCalc && this.groupManager.table.options.columnCalcs != "table" && this.groupManager.table.modExists("columnCalcs") && this.groupManager.table.modules.columnCalcs.hasTopCalcs()) {
					if (this.calcs.top) {
						this.calcs.top.detachElement();
						this.calcs.top.deleteCells();
					}

					this.calcs.top = this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows);
					output.push(this.calcs.top);
				}

				output = output.concat(this.rows);

				if (!noCalc && this.groupManager.table.options.columnCalcs != "table" && this.groupManager.table.modExists("columnCalcs") && this.groupManager.table.modules.columnCalcs.hasBottomCalcs()) {
					if (this.calcs.bottom) {
						this.calcs.bottom.detachElement();
						this.calcs.bottom.deleteCells();
					}

					this.calcs.bottom = this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows);
					output.push(this.calcs.bottom);
				}
			}
		} else {
			if (!this.groupList.length && this.groupManager.table.options.columnCalcs != "table") {

				if (this.groupManager.table.modExists("columnCalcs")) {

					if (!noCalc && this.groupManager.table.modules.columnCalcs.hasTopCalcs()) {
						if (this.calcs.top) {
							this.calcs.top.detachElement();
							this.calcs.top.deleteCells();
						}

						if (this.groupManager.table.options.groupClosedShowCalcs) {
							this.calcs.top = this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows);
							output.push(this.calcs.top);
						}
					}

					if (!noCalc && this.groupManager.table.modules.columnCalcs.hasBottomCalcs()) {
						if (this.calcs.bottom) {
							this.calcs.bottom.detachElement();
							this.calcs.bottom.deleteCells();
						}

						if (this.groupManager.table.options.groupClosedShowCalcs) {
							this.calcs.bottom = this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows);
							output.push(this.calcs.bottom);
						}
					}
				}
			}
		}

		return output;
	};

	Group.prototype.getData = function (visible, transform) {
		var self = this,
		    output = [];

		this._visSet();

		if (!visible || visible && this.visible) {
			this.rows.forEach(function (row) {
				output.push(row.getData(transform || "data"));
			});
		}

		return output;
	};

	// Group.prototype.getRows = function(){
	// 	this._visSet();

	// 	return this.visible ? this.rows : [];
	// };

	Group.prototype.getRowCount = function () {
		var count = 0;

		if (this.groupList.length) {
			this.groupList.forEach(function (group) {
				count += group.getRowCount();
			});
		} else {
			count = this.rows.length;
		}
		return count;
	};

	Group.prototype.toggleVisibility = function () {
		if (this.visible) {
			this.hide();
		} else {
			this.show();
		}
	};

	Group.prototype.hide = function () {
		this.visible = false;

		if (this.groupManager.table.rowManager.getRenderMode() == "classic" && !this.groupManager.table.options.pagination) {

			this.element.classList.remove("tabulator-group-visible");

			if (this.groupList.length) {
				this.groupList.forEach(function (group) {

					var rows = group.getHeadersAndRows();

					rows.forEach(function (row) {
						row.detachElement();
					});
				});
			} else {
				this.rows.forEach(function (row) {
					var rowEl = row.getElement();
					rowEl.parentNode.removeChild(rowEl);
				});
			}

			this.groupManager.table.rowManager.setDisplayRows(this.groupManager.updateGroupRows(), this.groupManager.getDisplayIndex());

			this.groupManager.table.rowManager.checkClassicModeGroupHeaderWidth();
		} else {
			this.groupManager.updateGroupRows(true);
		}

		this.groupManager.table.options.groupVisibilityChanged.call(this.table, this.getComponent(), false);
	};

	Group.prototype.show = function () {
		var self = this;

		self.visible = true;

		if (this.groupManager.table.rowManager.getRenderMode() == "classic" && !this.groupManager.table.options.pagination) {

			this.element.classList.add("tabulator-group-visible");

			var prev = self.getElement();

			if (this.groupList.length) {
				this.groupList.forEach(function (group) {
					var rows = group.getHeadersAndRows();

					rows.forEach(function (row) {
						var rowEl = row.getElement();
						prev.parentNode.insertBefore(rowEl, prev.nextSibling);
						row.initialize();
						prev = rowEl;
					});
				});
			} else {
				self.rows.forEach(function (row) {
					var rowEl = row.getElement();
					prev.parentNode.insertBefore(rowEl, prev.nextSibling);
					row.initialize();
					prev = rowEl;
				});
			}

			this.groupManager.table.rowManager.setDisplayRows(this.groupManager.updateGroupRows(), this.groupManager.getDisplayIndex());

			this.groupManager.table.rowManager.checkClassicModeGroupHeaderWidth();
		} else {
			this.groupManager.updateGroupRows(true);
		}

		this.groupManager.table.options.groupVisibilityChanged.call(this.table, this.getComponent(), true);
	};

	Group.prototype._visSet = function () {
		var data = [];

		if (typeof this.visible == "function") {

			this.rows.forEach(function (row) {
				data.push(row.getData());
			});

			this.visible = this.visible(this.key, this.getRowCount(), data, this.getComponent());
		}
	};

	Group.prototype.getRowGroup = function (row) {
		var match = false;
		if (this.groupList.length) {
			this.groupList.forEach(function (group) {
				var result = group.getRowGroup(row);

				if (result) {
					match = result;
				}
			});
		} else {
			if (this.rows.find(function (item) {
				return item === row;
			})) {
				match = this;
			}
		}

		return match;
	};

	Group.prototype.getSubGroups = function (component) {
		var output = [];

		this.groupList.forEach(function (child) {
			output.push(component ? child.getComponent() : child);
		});

		return output;
	};

	Group.prototype.getRows = function (compoment) {
		var output = [];

		this.rows.forEach(function (row) {
			output.push(compoment ? row.getComponent() : row);
		});

		return output;
	};

	Group.prototype.generateGroupHeaderContents = function () {
		var data = [];

		this.rows.forEach(function (row) {
			data.push(row.getData());
		});

		this.elementContents = this.generator(this.key, this.getRowCount(), data, this.getComponent());

		while (this.element.firstChild) {
			this.element.removeChild(this.element.firstChild);
		}if (typeof this.elementContents === "string") {
			this.element.innerHTML = this.elementContents;
		} else {
			this.element.appendChild(this.elementContents);
		}

		this.element.insertBefore(this.arrowElement, this.element.firstChild);
	};

	////////////// Standard Row Functions //////////////

	Group.prototype.getElement = function () {
		this.addBindingsd = false;

		this._visSet();

		if (this.visible) {
			this.element.classList.add("tabulator-group-visible");
		} else {
			this.element.classList.remove("tabulator-group-visible");
		}

		for (var i = 0; i < this.element.childNodes.length; ++i) {
			this.element.childNodes[i].parentNode.removeChild(this.element.childNodes[i]);
		}

		this.generateGroupHeaderContents();

		// this.addBindings();

		return this.element;
	};

	Group.prototype.detachElement = function () {
		if (this.element && this.element.parentNode) {
			this.element.parentNode.removeChild(this.element);
		}
	};

	//normalize the height of elements in the row
	Group.prototype.normalizeHeight = function () {
		this.setHeight(this.element.clientHeight);
	};

	Group.prototype.initialize = function (force) {
		if (!this.initialized || force) {
			this.normalizeHeight();
			this.initialized = true;
		}
	};

	Group.prototype.reinitialize = function () {
		this.initialized = false;
		this.height = 0;

		if (Tabulator.prototype.helpers.elVisible(this.element)) {
			this.initialize(true);
		}
	};

	Group.prototype.setHeight = function (height) {
		if (this.height != height) {
			this.height = height;
			this.outerHeight = this.element.offsetHeight;
		}
	};

	//return rows outer height
	Group.prototype.getHeight = function () {
		return this.outerHeight;
	};

	Group.prototype.getGroup = function () {
		return this;
	};

	Group.prototype.reinitializeHeight = function () {};
	Group.prototype.calcHeight = function () {};
	Group.prototype.setCellHeight = function () {};
	Group.prototype.clearCellHeight = function () {};

	//////////////// Object Generation /////////////////
	Group.prototype.getComponent = function () {
		if (!this.component) {
			this.component = new GroupComponent(this);
		}

		return this.component;
	};

	//////////////////////////////////////////////////
	////////////// Group Row Extension ///////////////
	//////////////////////////////////////////////////

	var GroupRows = function GroupRows(table) {

		this.table = table; //hold Tabulator object

		this.groupIDLookups = false; //enable table grouping and set field to group by
		this.startOpen = [function () {
			return false;
		}]; //starting state of group
		this.headerGenerator = [function () {
			return "";
		}];
		this.groupList = []; //ordered list of groups
		this.allowedValues = false;
		this.groups = {}; //hold row groups
		this.displayIndex = 0; //index in display pipeline
	};

	//initialize group configuration
	GroupRows.prototype.initialize = function () {
		var self = this,
		    groupBy = self.table.options.groupBy,
		    startOpen = self.table.options.groupStartOpen,
		    groupHeader = self.table.options.groupHeader;

		this.allowedValues = self.table.options.groupValues;

		if (Array.isArray(groupBy) && Array.isArray(groupHeader) && groupBy.length > groupHeader.length) {
			console.warn("Error creating group headers, groupHeader array is shorter than groupBy array");
		}

		self.headerGenerator = [function () {
			return "";
		}];
		this.startOpen = [function () {
			return false;
		}]; //starting state of group

		self.table.modules.localize.bind("groups|item", function (langValue, lang) {
			self.headerGenerator[0] = function (value, count, data) {
				//header layout function
				return (typeof value === "undefined" ? "" : value) + "<span>(" + count + " " + (count === 1 ? langValue : lang.groups.items) + ")</span>";
			};
		});

		this.groupIDLookups = [];

		if (Array.isArray(groupBy) || groupBy) {
			if (this.table.modExists("columnCalcs") && this.table.options.columnCalcs != "table" && this.table.options.columnCalcs != "both") {
				this.table.modules.columnCalcs.removeCalcs();
			}
		} else {
			if (this.table.modExists("columnCalcs") && this.table.options.columnCalcs != "group") {

				var cols = this.table.columnManager.getRealColumns();

				cols.forEach(function (col) {
					if (col.definition.topCalc) {
						self.table.modules.columnCalcs.initializeTopRow();
					}

					if (col.definition.bottomCalc) {
						self.table.modules.columnCalcs.initializeBottomRow();
					}
				});
			}
		}

		if (!Array.isArray(groupBy)) {
			groupBy = [groupBy];
		}

		groupBy.forEach(function (group, i) {
			var lookupFunc, column;

			if (typeof group == "function") {
				lookupFunc = group;
			} else {
				column = self.table.columnManager.getColumnByField(group);

				if (column) {
					lookupFunc = function lookupFunc(data) {
						return column.getFieldValue(data);
					};
				} else {
					lookupFunc = function lookupFunc(data) {
						return data[group];
					};
				}
			}

			self.groupIDLookups.push({
				field: typeof group === "function" ? false : group,
				func: lookupFunc,
				values: self.allowedValues ? self.allowedValues[i] : false
			});
		});

		if (startOpen) {

			if (!Array.isArray(startOpen)) {
				startOpen = [startOpen];
			}

			startOpen.forEach(function (level) {
				level = typeof level == "function" ? level : function () {
					return true;
				};
			});

			self.startOpen = startOpen;
		}

		if (groupHeader) {
			self.headerGenerator = Array.isArray(groupHeader) ? groupHeader : [groupHeader];
		}

		this.initialized = true;
	};

	GroupRows.prototype.setDisplayIndex = function (index) {
		this.displayIndex = index;
	};

	GroupRows.prototype.getDisplayIndex = function () {
		return this.displayIndex;
	};

	//return appropriate rows with group headers
	GroupRows.prototype.getRows = function (rows) {
		if (this.groupIDLookups.length) {

			this.table.options.dataGrouping.call(this.table);

			this.generateGroups(rows);

			if (this.table.options.dataGrouped) {
				this.table.options.dataGrouped.call(this.table, this.getGroups(true));
			}

			return this.updateGroupRows();
		} else {
			return rows.slice(0);
		}
	};

	GroupRows.prototype.getGroups = function (compoment) {
		var groupComponents = [];

		this.groupList.forEach(function (group) {
			groupComponents.push(compoment ? group.getComponent() : group);
		});

		return groupComponents;
	};

	GroupRows.prototype.getChildGroups = function (group) {
		var _this59 = this;

		var groupComponents = [];

		if (!group) {
			group = this;
		}

		group.groupList.forEach(function (child) {
			if (child.groupList.length) {
				groupComponents = groupComponents.concat(_this59.getChildGroups(child));
			} else {
				groupComponents.push(child);
			}
		});

		return groupComponents;
	};

	GroupRows.prototype.wipe = function () {
		this.groupList.forEach(function (group) {
			group.wipe();
		});
	};

	GroupRows.prototype.pullGroupListData = function (groupList) {
		var self = this;
		var groupListData = [];

		groupList.forEach(function (group) {
			var groupHeader = {};
			groupHeader.level = 0;
			groupHeader.rowCount = 0;
			groupHeader.headerContent = "";
			var childData = [];

			if (group.hasSubGroups) {
				childData = self.pullGroupListData(group.groupList);

				groupHeader.level = group.level;
				groupHeader.rowCount = childData.length - group.groupList.length; // data length minus number of sub-headers
				groupHeader.headerContent = group.generator(group.key, groupHeader.rowCount, group.rows, group);

				groupListData.push(groupHeader);
				groupListData = groupListData.concat(childData);
			} else {
				groupHeader.level = group.level;
				groupHeader.headerContent = group.generator(group.key, group.rows.length, group.rows, group);
				groupHeader.rowCount = group.getRows().length;

				groupListData.push(groupHeader);

				group.getRows().forEach(function (row) {
					groupListData.push(row.getData("data"));
				});
			}
		});

		return groupListData;
	};

	GroupRows.prototype.getGroupedData = function () {

		return this.pullGroupListData(this.groupList);
	};

	GroupRows.prototype.getRowGroup = function (row) {
		var match = false;

		this.groupList.forEach(function (group) {
			var result = group.getRowGroup(row);

			if (result) {
				match = result;
			}
		});

		return match;
	};

	GroupRows.prototype.countGroups = function () {
		return this.groupList.length;
	};

	GroupRows.prototype.generateGroups = function (rows) {
		var self = this,
		    oldGroups = self.groups;

		self.groups = {};
		self.groupList = [];

		if (this.allowedValues && this.allowedValues[0]) {
			this.allowedValues[0].forEach(function (value) {
				self.createGroup(value, 0, oldGroups);
			});

			rows.forEach(function (row) {
				self.assignRowToExistingGroup(row, oldGroups);
			});
		} else {
			rows.forEach(function (row) {
				self.assignRowToGroup(row, oldGroups);
			});
		}
	};

	GroupRows.prototype.createGroup = function (groupID, level, oldGroups) {
		var groupKey = level + "_" + groupID,
		    group;

		oldGroups = oldGroups || [];

		group = new Group(this, false, level, groupID, this.groupIDLookups[0].field, this.headerGenerator[0], oldGroups[groupKey]);

		this.groups[groupKey] = group;
		this.groupList.push(group);
	};

	// GroupRows.prototype.assignRowToGroup = function(row, oldGroups){
	// 	var groupID = this.groupIDLookups[0].func(row.getData()),
	// 	groupKey = "0_" + groupID;

	// 	if(!this.groups[groupKey]){
	// 		this.createGroup(groupID, 0, oldGroups);
	// 	}

	// 	this.groups[groupKey].addRow(row);
	// };

	GroupRows.prototype.assignRowToExistingGroup = function (row, oldGroups) {
		var groupID = this.groupIDLookups[0].func(row.getData()),
		    groupKey = "0_" + groupID;

		if (this.groups[groupKey]) {
			this.groups[groupKey].addRow(row);
		}
	};

	GroupRows.prototype.assignRowToGroup = function (row, oldGroups) {
		var groupID = this.groupIDLookups[0].func(row.getData()),
		    newGroupNeeded = !this.groups["0_" + groupID];

		if (newGroupNeeded) {
			this.createGroup(groupID, 0, oldGroups);
		}

		this.groups["0_" + groupID].addRow(row);

		return !newGroupNeeded;
	};

	GroupRows.prototype.updateGroupRows = function (force) {
		var self = this,
		    output = [],
		    oldRowCount;

		self.groupList.forEach(function (group) {
			output = output.concat(group.getHeadersAndRows());
		});

		//force update of table display
		if (force) {

			var displayIndex = self.table.rowManager.setDisplayRows(output, this.getDisplayIndex());

			if (displayIndex !== true) {
				this.setDisplayIndex(displayIndex);
			}

			self.table.rowManager.refreshActiveData("group", true, true);
		}

		return output;
	};

	GroupRows.prototype.scrollHeaders = function (left) {
		left = left + "px";

		this.groupList.forEach(function (group) {
			group.scrollHeader(left);
		});
	};

	GroupRows.prototype.removeGroup = function (group) {
		var groupKey = group.level + "_" + group.key,
		    index;

		if (this.groups[groupKey]) {
			delete this.groups[groupKey];

			index = this.groupList.indexOf(group);

			if (index > -1) {
				this.groupList.splice(index, 1);
			}
		}
	};

	Tabulator.prototype.registerModule("groupRows", GroupRows);
	var History = function History(table) {
		this.table = table; //hold Tabulator object

		this.history = [];
		this.index = -1;
	};

	History.prototype.clear = function () {
		this.history = [];
		this.index = -1;
	};

	History.prototype.action = function (type, component, data) {

		this.history = this.history.slice(0, this.index + 1);

		this.history.push({
			type: type,
			component: component,
			data: data
		});

		this.index++;
	};

	History.prototype.getHistoryUndoSize = function () {
		return this.index + 1;
	};

	History.prototype.getHistoryRedoSize = function () {
		return this.history.length - (this.index + 1);
	};

	History.prototype.undo = function () {

		if (this.index > -1) {
			var action = this.history[this.index];

			this.undoers[action.type].call(this, action);

			this.index--;

			this.table.options.historyUndo.call(this.table, action.type, action.component.getComponent(), action.data);

			return true;
		} else {
			console.warn("History Undo Error - No more history to undo");
			return false;
		}
	};

	History.prototype.redo = function () {
		if (this.history.length - 1 > this.index) {

			this.index++;

			var action = this.history[this.index];

			this.redoers[action.type].call(this, action);

			this.table.options.historyRedo.call(this.table, action.type, action.component.getComponent(), action.data);

			return true;
		} else {
			console.warn("History Redo Error - No more history to redo");
			return false;
		}
	};

	History.prototype.undoers = {
		cellEdit: function cellEdit(action) {
			action.component.setValueProcessData(action.data.oldValue);
		},

		rowAdd: function rowAdd(action) {
			action.component.deleteActual();
		},

		rowDelete: function rowDelete(action) {
			var newRow = this.table.rowManager.addRowActual(action.data.data, action.data.pos, action.data.index);

			if (this.table.options.groupBy && this.table.modExists("groupRows")) {
				this.table.modules.groupRows.updateGroupRows(true);
			}

			this._rebindRow(action.component, newRow);
		},

		rowMove: function rowMove(action) {
			this.table.rowManager.moveRowActual(action.component, this.table.rowManager.rows[action.data.posFrom], !action.data.after);
			this.table.rowManager.redraw();
		}
	};

	History.prototype.redoers = {
		cellEdit: function cellEdit(action) {
			action.component.setValueProcessData(action.data.newValue);
		},

		rowAdd: function rowAdd(action) {
			var newRow = this.table.rowManager.addRowActual(action.data.data, action.data.pos, action.data.index);

			if (this.table.options.groupBy && this.table.modExists("groupRows")) {
				this.table.modules.groupRows.updateGroupRows(true);
			}

			this._rebindRow(action.component, newRow);
		},

		rowDelete: function rowDelete(action) {
			action.component.deleteActual();
		},

		rowMove: function rowMove(action) {
			this.table.rowManager.moveRowActual(action.component, this.table.rowManager.rows[action.data.posTo], action.data.after);
			this.table.rowManager.redraw();
		}
	};

	//rebind rows to new element after deletion
	History.prototype._rebindRow = function (oldRow, newRow) {
		this.history.forEach(function (action) {
			if (action.component instanceof Row) {
				if (action.component === oldRow) {
					action.component = newRow;
				}
			} else if (action.component instanceof Cell) {
				if (action.component.row === oldRow) {
					var field = action.component.column.getField();

					if (field) {
						action.component = newRow.getCell(field);
					}
				}
			}
		});
	};

	Tabulator.prototype.registerModule("history", History);
	var HtmlTableImport = function HtmlTableImport(table) {
		this.table = table; //hold Tabulator object
		this.fieldIndex = [];
		this.hasIndex = false;
	};

	HtmlTableImport.prototype.parseTable = function () {
		var self = this,
		    element = self.table.element,
		    options = self.table.options,
		    columns = options.columns,
		    headers = element.getElementsByTagName("th"),
		    rows = element.getElementsByTagName("tbody")[0],
		    data = [],
		    newTable;

		self.hasIndex = false;

		self.table.options.htmlImporting.call(this.table);

		rows = rows ? rows.getElementsByTagName("tr") : [];

		//check for tablator inline options
		self._extractOptions(element, options);

		if (headers.length) {
			self._extractHeaders(headers, rows);
		} else {
			self._generateBlankHeaders(headers, rows);
		}

		//iterate through table rows and build data set
		for (var index = 0; index < rows.length; index++) {
			var row = rows[index],
			    cells = row.getElementsByTagName("td"),
			    item = {};

			//create index if the dont exist in table
			if (!self.hasIndex) {
				item[options.index] = index;
			}

			for (var i = 0; i < cells.length; i++) {
				var cell = cells[i];
				if (typeof this.fieldIndex[i] !== "undefined") {
					item[this.fieldIndex[i]] = cell.innerHTML;
				}
			}

			//add row data to item
			data.push(item);
		}

		//create new element
		var newElement = document.createElement("div");

		//transfer attributes to new element
		var attributes = element.attributes;

		// loop through attributes and apply them on div

		for (var i in attributes) {
			if (_typeof(attributes[i]) == "object") {
				newElement.setAttribute(attributes[i].name, attributes[i].value);
			}
		}

		// replace table with div element
		element.parentNode.replaceChild(newElement, element);

		options.data = data;

		self.table.options.htmlImported.call(this.table);

		// // newElement.tabulator(options);

		this.table.element = newElement;
	};

	//extract tabulator attribute options
	HtmlTableImport.prototype._extractOptions = function (element, options, defaultOptions) {
		var attributes = element.attributes;
		var optionsArr = defaultOptions ? Object.assign([], defaultOptions) : Object.keys(options);
		var optionsList = {};

		optionsArr.forEach(function (item) {
			optionsList[item.toLowerCase()] = item;
		});

		for (var index in attributes) {
			var attrib = attributes[index];
			var name;

			if (attrib && (typeof attrib === 'undefined' ? 'undefined' : _typeof(attrib)) == "object" && attrib.name && attrib.name.indexOf("tabulator-") === 0) {
				name = attrib.name.replace("tabulator-", "");

				if (typeof optionsList[name] !== "undefined") {
					options[optionsList[name]] = this._attribValue(attrib.value);
				}
			}
		}
	};

	//get value of attribute
	HtmlTableImport.prototype._attribValue = function (value) {
		if (value === "true") {
			return true;
		}

		if (value === "false") {
			return false;
		}

		return value;
	};

	//find column if it has already been defined
	HtmlTableImport.prototype._findCol = function (title) {
		var match = this.table.options.columns.find(function (column) {
			return column.title === title;
		});

		return match || false;
	};

	//extract column from headers
	HtmlTableImport.prototype._extractHeaders = function (headers, rows) {
		for (var index = 0; index < headers.length; index++) {
			var header = headers[index],
			    exists = false,
			    col = this._findCol(header.textContent),
			    width,
			    attributes;

			if (col) {
				exists = true;
			} else {
				col = { title: header.textContent.trim() };
			}

			if (!col.field) {
				col.field = header.textContent.trim().toLowerCase().replace(" ", "_");
			}

			width = header.getAttribute("width");

			if (width && !col.width) {
				col.width = width;
			}

			//check for tablator inline options
			attributes = header.attributes;

			// //check for tablator inline options
			this._extractOptions(header, col, Column.prototype.defaultOptionList);

			this.fieldIndex[index] = col.field;

			if (col.field == this.table.options.index) {
				this.hasIndex = true;
			}

			if (!exists) {
				this.table.options.columns.push(col);
			}
		}
	};

	//generate blank headers
	HtmlTableImport.prototype._generateBlankHeaders = function (headers, rows) {
		for (var index = 0; index < headers.length; index++) {
			var header = headers[index],
			    col = { title: "", field: "col" + index };

			this.fieldIndex[index] = col.field;

			var width = header.getAttribute("width");

			if (width) {
				col.width = width;
			}

			this.table.options.columns.push(col);
		}
	};

	Tabulator.prototype.registerModule("htmlTableImport", HtmlTableImport);
	var Keybindings = function Keybindings(table) {
		this.table = table; //hold Tabulator object
		this.watchKeys = null;
		this.pressedKeys = null;
		this.keyupBinding = false;
		this.keydownBinding = false;
	};

	Keybindings.prototype.initialize = function () {
		var bindings = this.table.options.keybindings,
		    mergedBindings = {};

		this.watchKeys = {};
		this.pressedKeys = [];

		if (bindings !== false) {

			for (var key in this.bindings) {
				mergedBindings[key] = this.bindings[key];
			}

			if (Object.keys(bindings).length) {

				for (var _key in bindings) {
					mergedBindings[_key] = bindings[_key];
				}
			}

			this.mapBindings(mergedBindings);
			this.bindEvents();
		}
	};

	Keybindings.prototype.mapBindings = function (bindings) {
		var _this60 = this;

		var self = this;

		var _loop2 = function _loop2(key) {

			if (_this60.actions[key]) {

				if (bindings[key]) {

					if (_typeof(bindings[key]) !== "object") {
						bindings[key] = [bindings[key]];
					}

					bindings[key].forEach(function (binding) {
						self.mapBinding(key, binding);
					});
				}
			} else {
				console.warn("Key Binding Error - no such action:", key);
			}
		};

		for (var key in bindings) {
			_loop2(key);
		}
	};

	Keybindings.prototype.mapBinding = function (action, symbolsList) {
		var self = this;

		var binding = {
			action: this.actions[action],
			keys: [],
			ctrl: false,
			shift: false,
			meta: false
		};

		var symbols = symbolsList.toString().toLowerCase().split(" ").join("").split("+");

		symbols.forEach(function (symbol) {
			switch (symbol) {
				case "ctrl":
					binding.ctrl = true;
					break;

				case "shift":
					binding.shift = true;
					break;

				case "meta":
					binding.meta = true;
					break;

				default:
					symbol = parseInt(symbol);
					binding.keys.push(symbol);

					if (!self.watchKeys[symbol]) {
						self.watchKeys[symbol] = [];
					}

					self.watchKeys[symbol].push(binding);
			}
		});
	};

	Keybindings.prototype.bindEvents = function () {
		var self = this;

		this.keyupBinding = function (e) {
			var code = e.keyCode;
			var bindings = self.watchKeys[code];

			if (bindings) {

				self.pressedKeys.push(code);

				bindings.forEach(function (binding) {
					self.checkBinding(e, binding);
				});
			}
		};

		this.keydownBinding = function (e) {
			var code = e.keyCode;
			var bindings = self.watchKeys[code];

			if (bindings) {

				var index = self.pressedKeys.indexOf(code);

				if (index > -1) {
					self.pressedKeys.splice(index, 1);
				}
			}
		};

		this.table.element.addEventListener("keydown", this.keyupBinding);

		this.table.element.addEventListener("keyup", this.keydownBinding);
	};

	Keybindings.prototype.clearBindings = function () {
		if (this.keyupBinding) {
			this.table.element.removeEventListener("keydown", this.keyupBinding);
		}

		if (this.keydownBinding) {
			this.table.element.removeEventListener("keyup", this.keydownBinding);
		}
	};

	Keybindings.prototype.checkBinding = function (e, binding) {
		var self = this,
		    match = true;

		if (e.ctrlKey == binding.ctrl && e.shiftKey == binding.shift && e.metaKey == binding.meta) {
			binding.keys.forEach(function (key) {
				var index = self.pressedKeys.indexOf(key);

				if (index == -1) {
					match = false;
				}
			});

			if (match) {
				binding.action.call(self, e);
			}

			return true;
		}

		return false;
	};

	//default bindings
	Keybindings.prototype.bindings = {
		navPrev: "shift + 9",
		navNext: 9,
		navUp: 38,
		navDown: 40,
		scrollPageUp: 33,
		scrollPageDown: 34,
		scrollToStart: 36,
		scrollToEnd: 35,
		undo: "ctrl + 90",
		redo: "ctrl + 89",
		copyToClipboard: "ctrl + 67"
	};

	//default actions
	Keybindings.prototype.actions = {
		keyBlock: function keyBlock(e) {
			e.stopPropagation();
			e.preventDefault();
		},
		scrollPageUp: function scrollPageUp(e) {
			var rowManager = this.table.rowManager,
			    newPos = rowManager.scrollTop - rowManager.height,
			    scrollMax = rowManager.element.scrollHeight;

			e.preventDefault();

			if (rowManager.displayRowsCount) {
				if (newPos >= 0) {
					rowManager.element.scrollTop = newPos;
				} else {
					rowManager.scrollToRow(rowManager.getDisplayRows()[0]);
				}
			}

			this.table.element.focus();
		},
		scrollPageDown: function scrollPageDown(e) {
			var rowManager = this.table.rowManager,
			    newPos = rowManager.scrollTop + rowManager.height,
			    scrollMax = rowManager.element.scrollHeight;

			e.preventDefault();

			if (rowManager.displayRowsCount) {
				if (newPos <= scrollMax) {
					rowManager.element.scrollTop = newPos;
				} else {
					rowManager.scrollToRow(rowManager.getDisplayRows()[rowManager.displayRowsCount - 1]);
				}
			}

			this.table.element.focus();
		},
		scrollToStart: function scrollToStart(e) {
			var rowManager = this.table.rowManager;

			e.preventDefault();

			if (rowManager.displayRowsCount) {
				rowManager.scrollToRow(rowManager.getDisplayRows()[0]);
			}

			this.table.element.focus();
		},
		scrollToEnd: function scrollToEnd(e) {
			var rowManager = this.table.rowManager;

			e.preventDefault();

			if (rowManager.displayRowsCount) {
				rowManager.scrollToRow(rowManager.getDisplayRows()[rowManager.displayRowsCount - 1]);
			}

			this.table.element.focus();
		},
		navPrev: function navPrev(e) {
			var cell = false;

			if (this.table.modExists("edit")) {
				cell = this.table.modules.edit.currentCell;

				if (cell) {
					e.preventDefault();
					cell.nav().prev();
				}
			}
		},

		navNext: function navNext(e) {
			var cell = false;
			var newRow = this.table.options.tabEndNewRow;
			var nav;

			if (this.table.modExists("edit")) {
				cell = this.table.modules.edit.currentCell;

				if (cell) {
					e.preventDefault();

					nav = cell.nav();

					if (!nav.next()) {
						if (newRow) {

							cell.getElement().firstChild.blur();

							if (newRow === true) {
								newRow = this.table.addRow({});
							} else {
								if (typeof newRow == "function") {
									newRow = this.table.addRow(newRow(cell.row.getComponent()));
								} else {
									newRow = this.table.addRow(Object.assign({}, newRow));
								}
							}

							newRow.then(function () {
								setTimeout(function () {
									nav.next();
								});
							});
						}
					}
				}
			}
		},

		navLeft: function navLeft(e) {
			var cell = false;

			if (this.table.modExists("edit")) {
				cell = this.table.modules.edit.currentCell;

				if (cell) {
					e.preventDefault();
					cell.nav().left();
				}
			}
		},

		navRight: function navRight(e) {
			var cell = false;

			if (this.table.modExists("edit")) {
				cell = this.table.modules.edit.currentCell;

				if (cell) {
					e.preventDefault();
					cell.nav().right();
				}
			}
		},

		navUp: function navUp(e) {
			var cell = false;

			if (this.table.modExists("edit")) {
				cell = this.table.modules.edit.currentCell;

				if (cell) {
					e.preventDefault();
					cell.nav().up();
				}
			}
		},

		navDown: function navDown(e) {
			var cell = false;

			if (this.table.modExists("edit")) {
				cell = this.table.modules.edit.currentCell;

				if (cell) {
					e.preventDefault();
					cell.nav().down();
				}
			}
		},

		undo: function undo(e) {
			var cell = false;
			if (this.table.options.history && this.table.modExists("history") && this.table.modExists("edit")) {

				cell = this.table.modules.edit.currentCell;

				if (!cell) {
					e.preventDefault();
					this.table.modules.history.undo();
				}
			}
		},

		redo: function redo(e) {
			var cell = false;
			if (this.table.options.history && this.table.modExists("history") && this.table.modExists("edit")) {

				cell = this.table.modules.edit.currentCell;

				if (!cell) {
					e.preventDefault();
					this.table.modules.history.redo();
				}
			}
		},

		copyToClipboard: function copyToClipboard(e) {
			if (!this.table.modules.edit.currentCell) {
				if (this.table.modExists("clipboard", true)) {
					this.table.modules.clipboard.copy(false, true);
				}
			}
		}
	};

	Tabulator.prototype.registerModule("keybindings", Keybindings);
	var Menu = function Menu(table) {
		this.table = table; //hold Tabulator object
		this.menuEl = false;
		this.blurEvent = this.hideMenu.bind(this);
		this.escEvent = this.escMenu.bind(this);
		this.nestedMenuBlock = false;
	};

	Menu.prototype.initializeColumnHeader = function (column) {
		var _this61 = this;

		var headerMenuEl;

		if (column.definition.headerContextMenu) {
			column.getElement().addEventListener("contextmenu", function (e) {
				var menu = typeof column.definition.headerContextMenu == "function" ? column.definition.headerContextMenu(column.getComponent()) : column.definition.headerContextMenu;

				e.preventDefault();

				_this61.loadMenu(e, column, menu);
			});
		}

		if (column.definition.headerMenu) {

			headerMenuEl = document.createElement("span");
			headerMenuEl.classList.add("tabulator-header-menu-button");
			headerMenuEl.innerHTML = "&vellip;";

			headerMenuEl.addEventListener("click", function (e) {
				var menu = typeof column.definition.headerMenu == "function" ? column.definition.headerMenu(column.getComponent()) : column.definition.headerMenu;
				e.stopPropagation();
				e.preventDefault();

				_this61.loadMenu(e, column, menu);
			});

			column.titleElement.insertBefore(headerMenuEl, column.titleElement.firstChild);
		}
	};

	Menu.prototype.initializeCell = function (cell) {
		var _this62 = this;

		cell.getElement().addEventListener("contextmenu", function (e) {
			var menu = typeof cell.column.definition.contextMenu == "function" ? cell.column.definition.contextMenu(cell.getComponent()) : cell.column.definition.contextMenu;

			e.stopImmediatePropagation();

			_this62.loadMenu(e, cell, menu);
		});
	};

	Menu.prototype.initializeRow = function (row) {
		var _this63 = this;

		row.getElement().addEventListener("contextmenu", function (e) {
			var menu = typeof _this63.table.options.rowContextMenu == "function" ? _this63.table.options.rowContextMenu(row.getComponent()) : _this63.table.options.rowContextMenu;

			_this63.loadMenu(e, row, menu);
		});
	};

	Menu.prototype.initializeGroup = function (group) {
		var _this64 = this;

		group.getElement().addEventListener("contextmenu", function (e) {
			var menu = typeof _this64.table.options.groupContextMenu == "function" ? _this64.table.options.groupContextMenu(group.getComponent()) : _this64.table.options.groupContextMenu;

			_this64.loadMenu(e, group, menu);
		});
	};

	Menu.prototype.loadMenu = function (e, component, menu) {
		var _this65 = this;

		var docHeight = Math.max(document.body.offsetHeight, window.innerHeight);

		e.preventDefault();

		//abort if no menu set
		if (!menu || !menu.length) {
			return;
		}

		if (this.nestedMenuBlock) {
			//abort if child menu already open
			if (this.isOpen()) {
				return;
			}
		} else {
			this.nestedMenuBlock = setTimeout(function () {
				_this65.nestedMenuBlock = false;
			}, 100);
		}

		this.hideMenu();

		this.menuEl = document.createElement("div");
		this.menuEl.classList.add("tabulator-menu");

		menu.forEach(function (item) {
			var itemEl = document.createElement("div");
			var label = item.label;
			var disabled = item.disabled;

			if (item.separator) {
				itemEl.classList.add("tabulator-menu-separator");
			} else {
				itemEl.classList.add("tabulator-menu-item");

				if (typeof label == "function") {
					label = label(component.getComponent());
				}

				if (label instanceof Node) {
					itemEl.appendChild(label);
				} else {
					itemEl.innerHTML = label;
				}

				if (typeof disabled == "function") {
					disabled = disabled(component.getComponent());
				}

				if (disabled) {
					itemEl.classList.add("tabulator-menu-item-disabled");
					itemEl.addEventListener("click", function (e) {
						e.stopPropagation();
					});
				} else {
					itemEl.addEventListener("click", function (e) {
						_this65.hideMenu();
						item.action(e, component.getComponent());
					});
				}
			}

			_this65.menuEl.appendChild(itemEl);
		});

		this.menuEl.style.top = e.pageY + "px";
		this.menuEl.style.left = e.pageX + "px";

		document.body.addEventListener("click", this.blurEvent);
		this.table.rowManager.element.addEventListener("scroll", this.blurEvent);

		setTimeout(function () {
			document.body.addEventListener("contextmenu", _this65.blurEvent);
		}, 100);

		document.body.addEventListener("keydown", this.escEvent);

		document.body.appendChild(this.menuEl);

		//move menu to start on right edge if it is too close to the edge of the screen
		if (e.pageX + this.menuEl.offsetWidth >= document.body.offsetWidth) {
			this.menuEl.style.left = "";
			this.menuEl.style.right = document.body.offsetWidth - e.pageX + "px";
		}

		//move menu to start on bottom edge if it is too close to the edge of the screen
		if (e.pageY + this.menuEl.offsetHeight >= docHeight) {
			this.menuEl.style.top = "";
			this.menuEl.style.bottom = docHeight - e.pageY + "px";
		}
	};

	Menu.prototype.isOpen = function () {
		return !!this.menuEl.parentNode;
	};

	Menu.prototype.escMenu = function (e) {
		if (e.keyCode == 27) {
			this.hideMenu();
		}
	};

	Menu.prototype.hideMenu = function () {
		if (this.menuEl.parentNode) {
			this.menuEl.parentNode.removeChild(this.menuEl);
		}

		if (this.escEvent) {
			document.body.removeEventListener("keydown", this.escEvent);
		}

		if (this.blurEvent) {
			document.body.removeEventListener("click", this.blurEvent);
			document.body.removeEventListener("contextmenu", this.blurEvent);
			this.table.rowManager.element.removeEventListener("scroll", this.blurEvent);
		}
	};

	//default accessors
	Menu.prototype.menus = {};

	Tabulator.prototype.registerModule("menu", Menu);
	var MoveColumns = function MoveColumns(table) {
		this.table = table; //hold Tabulator object
		this.placeholderElement = this.createPlaceholderElement();
		this.hoverElement = false; //floating column header element
		this.checkTimeout = false; //click check timeout holder
		this.checkPeriod = 250; //period to wait on mousedown to consider this a move and not a click
		this.moving = false; //currently moving column
		this.toCol = false; //destination column
		this.toColAfter = false; //position of moving column relative to the desitnation column
		this.startX = 0; //starting position within header element
		this.autoScrollMargin = 40; //auto scroll on edge when within margin
		this.autoScrollStep = 5; //auto scroll distance in pixels
		this.autoScrollTimeout = false; //auto scroll timeout
		this.touchMove = false;

		this.moveHover = this.moveHover.bind(this);
		this.endMove = this.endMove.bind(this);
	};

	MoveColumns.prototype.createPlaceholderElement = function () {
		var el = document.createElement("div");

		el.classList.add("tabulator-col");
		el.classList.add("tabulator-col-placeholder");

		return el;
	};

	MoveColumns.prototype.initializeColumn = function (column) {
		var self = this,
		    config = {},
		    colEl;

		if (!column.modules.frozen) {

			colEl = column.getElement();

			config.mousemove = function (e) {
				if (column.parent === self.moving.parent) {
					if ((self.touchMove ? e.touches[0].pageX : e.pageX) - Tabulator.prototype.helpers.elOffset(colEl).left + self.table.columnManager.element.scrollLeft > column.getWidth() / 2) {
						if (self.toCol !== column || !self.toColAfter) {
							colEl.parentNode.insertBefore(self.placeholderElement, colEl.nextSibling);
							self.moveColumn(column, true);
						}
					} else {
						if (self.toCol !== column || self.toColAfter) {
							colEl.parentNode.insertBefore(self.placeholderElement, colEl);
							self.moveColumn(column, false);
						}
					}
				}
			}.bind(self);

			colEl.addEventListener("mousedown", function (e) {
				self.touchMove = false;
				if (e.which === 1) {
					self.checkTimeout = setTimeout(function () {
						self.startMove(e, column);
					}, self.checkPeriod);
				}
			});

			colEl.addEventListener("mouseup", function (e) {
				if (e.which === 1) {
					if (self.checkTimeout) {
						clearTimeout(self.checkTimeout);
					}
				}
			});

			self.bindTouchEvents(column);
		}

		column.modules.moveColumn = config;
	};

	MoveColumns.prototype.bindTouchEvents = function (column) {
		var self = this,
		    colEl = column.getElement(),
		    startXMove = false,
		    //shifting center position of the cell
		dir = false,
		    currentCol,
		    nextCol,
		    prevCol,
		    nextColWidth,
		    prevColWidth,
		    nextColWidthLast,
		    prevColWidthLast;

		colEl.addEventListener("touchstart", function (e) {
			self.checkTimeout = setTimeout(function () {
				self.touchMove = true;
				currentCol = column;
				nextCol = column.nextColumn();
				nextColWidth = nextCol ? nextCol.getWidth() / 2 : 0;
				prevCol = column.prevColumn();
				prevColWidth = prevCol ? prevCol.getWidth() / 2 : 0;
				nextColWidthLast = 0;
				prevColWidthLast = 0;
				startXMove = false;

				self.startMove(e, column);
			}, self.checkPeriod);
		}, { passive: true });

		colEl.addEventListener("touchmove", function (e) {
			var halfCol, diff, moveToCol;

			if (self.moving) {
				self.moveHover(e);

				if (!startXMove) {
					startXMove = e.touches[0].pageX;
				}

				diff = e.touches[0].pageX - startXMove;

				if (diff > 0) {
					if (nextCol && diff - nextColWidthLast > nextColWidth) {
						moveToCol = nextCol;

						if (moveToCol !== column) {
							startXMove = e.touches[0].pageX;
							moveToCol.getElement().parentNode.insertBefore(self.placeholderElement, moveToCol.getElement().nextSibling);
							self.moveColumn(moveToCol, true);
						}
					}
				} else {
					if (prevCol && -diff - prevColWidthLast > prevColWidth) {
						moveToCol = prevCol;

						if (moveToCol !== column) {
							startXMove = e.touches[0].pageX;
							moveToCol.getElement().parentNode.insertBefore(self.placeholderElement, moveToCol.getElement());
							self.moveColumn(moveToCol, false);
						}
					}
				}

				if (moveToCol) {
					currentCol = moveToCol;
					nextCol = moveToCol.nextColumn();
					nextColWidthLast = nextColWidth;
					nextColWidth = nextCol ? nextCol.getWidth() / 2 : 0;
					prevCol = moveToCol.prevColumn();
					prevColWidthLast = prevColWidth;
					prevColWidth = prevCol ? prevCol.getWidth() / 2 : 0;
				}
			}
		}, { passive: true });

		colEl.addEventListener("touchend", function (e) {
			if (self.checkTimeout) {
				clearTimeout(self.checkTimeout);
			}
			if (self.moving) {
				self.endMove(e);
			}
		});
	};

	MoveColumns.prototype.startMove = function (e, column) {
		var element = column.getElement();

		this.moving = column;
		this.startX = (this.touchMove ? e.touches[0].pageX : e.pageX) - Tabulator.prototype.helpers.elOffset(element).left;

		this.table.element.classList.add("tabulator-block-select");

		//create placeholder
		this.placeholderElement.style.width = column.getWidth() + "px";
		this.placeholderElement.style.height = column.getHeight() + "px";

		element.parentNode.insertBefore(this.placeholderElement, element);
		element.parentNode.removeChild(element);

		//create hover element
		this.hoverElement = element.cloneNode(true);
		this.hoverElement.classList.add("tabulator-moving");

		this.table.columnManager.getElement().appendChild(this.hoverElement);

		this.hoverElement.style.left = "0";
		this.hoverElement.style.bottom = "0";

		if (!this.touchMove) {
			this._bindMouseMove();

			document.body.addEventListener("mousemove", this.moveHover);
			document.body.addEventListener("mouseup", this.endMove);
		}

		this.moveHover(e);
	};

	MoveColumns.prototype._bindMouseMove = function () {
		this.table.columnManager.columnsByIndex.forEach(function (column) {
			if (column.modules.moveColumn.mousemove) {
				column.getElement().addEventListener("mousemove", column.modules.moveColumn.mousemove);
			}
		});
	};

	MoveColumns.prototype._unbindMouseMove = function () {
		this.table.columnManager.columnsByIndex.forEach(function (column) {
			if (column.modules.moveColumn.mousemove) {
				column.getElement().removeEventListener("mousemove", column.modules.moveColumn.mousemove);
			}
		});
	};

	MoveColumns.prototype.moveColumn = function (column, after) {
		var movingCells = this.moving.getCells();

		this.toCol = column;
		this.toColAfter = after;

		if (after) {
			column.getCells().forEach(function (cell, i) {
				var cellEl = cell.getElement();
				cellEl.parentNode.insertBefore(movingCells[i].getElement(), cellEl.nextSibling);
			});
		} else {
			column.getCells().forEach(function (cell, i) {
				var cellEl = cell.getElement();
				cellEl.parentNode.insertBefore(movingCells[i].getElement(), cellEl);
			});
		}
	};

	MoveColumns.prototype.endMove = function (e) {
		if (e.which === 1 || this.touchMove) {
			this._unbindMouseMove();

			this.placeholderElement.parentNode.insertBefore(this.moving.getElement(), this.placeholderElement.nextSibling);
			this.placeholderElement.parentNode.removeChild(this.placeholderElement);
			this.hoverElement.parentNode.removeChild(this.hoverElement);

			this.table.element.classList.remove("tabulator-block-select");

			if (this.toCol) {
				this.table.columnManager.moveColumnActual(this.moving, this.toCol, this.toColAfter);
			}

			this.moving = false;
			this.toCol = false;
			this.toColAfter = false;

			if (!this.touchMove) {
				document.body.removeEventListener("mousemove", this.moveHover);
				document.body.removeEventListener("mouseup", this.endMove);
			}
		}
	};

	MoveColumns.prototype.moveHover = function (e) {
		var self = this,
		    columnHolder = self.table.columnManager.getElement(),
		    scrollLeft = columnHolder.scrollLeft,
		    xPos = (self.touchMove ? e.touches[0].pageX : e.pageX) - Tabulator.prototype.helpers.elOffset(columnHolder).left + scrollLeft,
		    scrollPos;

		self.hoverElement.style.left = xPos - self.startX + "px";

		if (xPos - scrollLeft < self.autoScrollMargin) {
			if (!self.autoScrollTimeout) {
				self.autoScrollTimeout = setTimeout(function () {
					scrollPos = Math.max(0, scrollLeft - 5);
					self.table.rowManager.getElement().scrollLeft = scrollPos;
					self.autoScrollTimeout = false;
				}, 1);
			}
		}

		if (scrollLeft + columnHolder.clientWidth - xPos < self.autoScrollMargin) {
			if (!self.autoScrollTimeout) {
				self.autoScrollTimeout = setTimeout(function () {
					scrollPos = Math.min(columnHolder.clientWidth, scrollLeft + 5);
					self.table.rowManager.getElement().scrollLeft = scrollPos;
					self.autoScrollTimeout = false;
				}, 1);
			}
		}
	};

	Tabulator.prototype.registerModule("moveColumn", MoveColumns);

	var MoveRows = function MoveRows(table) {

		this.table = table; //hold Tabulator object
		this.placeholderElement = this.createPlaceholderElement();
		this.hoverElement = false; //floating row header element
		this.checkTimeout = false; //click check timeout holder
		this.checkPeriod = 150; //period to wait on mousedown to consider this a move and not a click
		this.moving = false; //currently moving row
		this.toRow = false; //destination row
		this.toRowAfter = false; //position of moving row relative to the desitnation row
		this.hasHandle = false; //row has handle instead of fully movable row
		this.startY = 0; //starting Y position within header element
		this.startX = 0; //starting X position within header element

		this.moveHover = this.moveHover.bind(this);
		this.endMove = this.endMove.bind(this);
		this.tableRowDropEvent = false;

		this.touchMove = false;

		this.connection = false;
		this.connectionSelectorsTables = false;
		this.connectionSelectorsElements = false;
		this.connectionElements = [];
		this.connections = [];

		this.connectedTable = false;
		this.connectedRow = false;
	};

	MoveRows.prototype.createPlaceholderElement = function () {
		var el = document.createElement("div");

		el.classList.add("tabulator-row");
		el.classList.add("tabulator-row-placeholder");

		return el;
	};

	MoveRows.prototype.initialize = function (handle) {
		this.connectionSelectorsTables = this.table.options.movableRowsConnectedTables;
		this.connectionSelectorsElements = this.table.options.movableRowsConnectedElements;

		this.connection = this.connectionSelectorsTables || this.connectionSelectorsElements;
	};

	MoveRows.prototype.setHandle = function (handle) {
		this.hasHandle = handle;
	};

	MoveRows.prototype.initializeGroupHeader = function (group) {
		var self = this,
		    config = {},
		    rowEl;

		//inter table drag drop
		config.mouseup = function (e) {
			self.tableRowDrop(e, row);
		}.bind(self);

		//same table drag drop
		config.mousemove = function (e) {
			if (e.pageY - Tabulator.prototype.helpers.elOffset(group.element).top + self.table.rowManager.element.scrollTop > group.getHeight() / 2) {
				if (self.toRow !== group || !self.toRowAfter) {
					var rowEl = group.getElement();
					rowEl.parentNode.insertBefore(self.placeholderElement, rowEl.nextSibling);
					self.moveRow(group, true);
				}
			} else {
				if (self.toRow !== group || self.toRowAfter) {
					var rowEl = group.getElement();
					if (rowEl.previousSibling) {
						rowEl.parentNode.insertBefore(self.placeholderElement, rowEl);
						self.moveRow(group, false);
					}
				}
			}
		}.bind(self);

		group.modules.moveRow = config;
	};

	MoveRows.prototype.initializeRow = function (row) {
		var self = this,
		    config = {},
		    rowEl;

		//inter table drag drop
		config.mouseup = function (e) {
			self.tableRowDrop(e, row);
		}.bind(self);

		//same table drag drop
		config.mousemove = function (e) {
			if (e.pageY - Tabulator.prototype.helpers.elOffset(row.element).top + self.table.rowManager.element.scrollTop > row.getHeight() / 2) {
				if (self.toRow !== row || !self.toRowAfter) {
					var rowEl = row.getElement();
					rowEl.parentNode.insertBefore(self.placeholderElement, rowEl.nextSibling);
					self.moveRow(row, true);
				}
			} else {
				if (self.toRow !== row || self.toRowAfter) {
					var rowEl = row.getElement();
					rowEl.parentNode.insertBefore(self.placeholderElement, rowEl);
					self.moveRow(row, false);
				}
			}
		}.bind(self);

		if (!this.hasHandle) {

			rowEl = row.getElement();

			rowEl.addEventListener("mousedown", function (e) {
				if (e.which === 1) {
					self.checkTimeout = setTimeout(function () {
						self.startMove(e, row);
					}, self.checkPeriod);
				}
			});

			rowEl.addEventListener("mouseup", function (e) {
				if (e.which === 1) {
					if (self.checkTimeout) {
						clearTimeout(self.checkTimeout);
					}
				}
			});

			this.bindTouchEvents(row, row.getElement());
		}

		row.modules.moveRow = config;
	};

	MoveRows.prototype.initializeCell = function (cell) {
		var self = this,
		    cellEl = cell.getElement();

		cellEl.addEventListener("mousedown", function (e) {
			if (e.which === 1) {
				self.checkTimeout = setTimeout(function () {
					self.startMove(e, cell.row);
				}, self.checkPeriod);
			}
		});

		cellEl.addEventListener("mouseup", function (e) {
			if (e.which === 1) {
				if (self.checkTimeout) {
					clearTimeout(self.checkTimeout);
				}
			}
		});

		this.bindTouchEvents(cell.row, cell.getElement());
	};

	MoveRows.prototype.bindTouchEvents = function (row, element) {
		var self = this,
		    startYMove = false,
		    //shifting center position of the cell
		dir = false,
		    currentRow,
		    nextRow,
		    prevRow,
		    nextRowHeight,
		    prevRowHeight,
		    nextRowHeightLast,
		    prevRowHeightLast;

		element.addEventListener("touchstart", function (e) {
			self.checkTimeout = setTimeout(function () {
				self.touchMove = true;
				currentRow = row;
				nextRow = row.nextRow();
				nextRowHeight = nextRow ? nextRow.getHeight() / 2 : 0;
				prevRow = row.prevRow();
				prevRowHeight = prevRow ? prevRow.getHeight() / 2 : 0;
				nextRowHeightLast = 0;
				prevRowHeightLast = 0;
				startYMove = false;

				self.startMove(e, row);
			}, self.checkPeriod);
		}, { passive: true });
		this.moving, this.toRow, this.toRowAfter;
		element.addEventListener("touchmove", function (e) {

			var halfCol, diff, moveToRow;

			if (self.moving) {
				e.preventDefault();

				self.moveHover(e);

				if (!startYMove) {
					startYMove = e.touches[0].pageY;
				}

				diff = e.touches[0].pageY - startYMove;

				if (diff > 0) {
					if (nextRow && diff - nextRowHeightLast > nextRowHeight) {
						moveToRow = nextRow;

						if (moveToRow !== row) {
							startYMove = e.touches[0].pageY;
							moveToRow.getElement().parentNode.insertBefore(self.placeholderElement, moveToRow.getElement().nextSibling);
							self.moveRow(moveToRow, true);
						}
					}
				} else {
					if (prevRow && -diff - prevRowHeightLast > prevRowHeight) {
						moveToRow = prevRow;

						if (moveToRow !== row) {
							startYMove = e.touches[0].pageY;
							moveToRow.getElement().parentNode.insertBefore(self.placeholderElement, moveToRow.getElement());
							self.moveRow(moveToRow, false);
						}
					}
				}

				if (moveToRow) {
					currentRow = moveToRow;
					nextRow = moveToRow.nextRow();
					nextRowHeightLast = nextRowHeight;
					nextRowHeight = nextRow ? nextRow.getHeight() / 2 : 0;
					prevRow = moveToRow.prevRow();
					prevRowHeightLast = prevRowHeight;
					prevRowHeight = prevRow ? prevRow.getHeight() / 2 : 0;
				}
			}
		});

		element.addEventListener("touchend", function (e) {
			if (self.checkTimeout) {
				clearTimeout(self.checkTimeout);
			}
			if (self.moving) {
				self.endMove(e);
				self.touchMove = false;
			}
		});
	};

	MoveRows.prototype._bindMouseMove = function () {
		var self = this;

		self.table.rowManager.getDisplayRows().forEach(function (row) {
			if ((row.type === "row" || row.type === "group") && row.modules.moveRow.mousemove) {
				row.getElement().addEventListener("mousemove", row.modules.moveRow.mousemove);
			}
		});
	};

	MoveRows.prototype._unbindMouseMove = function () {
		var self = this;

		self.table.rowManager.getDisplayRows().forEach(function (row) {
			if ((row.type === "row" || row.type === "group") && row.modules.moveRow.mousemove) {
				row.getElement().removeEventListener("mousemove", row.modules.moveRow.mousemove);
			}
		});
	};

	MoveRows.prototype.startMove = function (e, row) {
		var element = row.getElement();

		this.setStartPosition(e, row);

		this.moving = row;

		this.table.element.classList.add("tabulator-block-select");

		//create placeholder
		this.placeholderElement.style.width = row.getWidth() + "px";
		this.placeholderElement.style.height = row.getHeight() + "px";

		if (!this.connection) {
			element.parentNode.insertBefore(this.placeholderElement, element);
			element.parentNode.removeChild(element);
		} else {
			this.table.element.classList.add("tabulator-movingrow-sending");
			this.connectToTables(row);
		}

		//create hover element
		this.hoverElement = element.cloneNode(true);
		this.hoverElement.classList.add("tabulator-moving");

		if (this.connection) {
			document.body.appendChild(this.hoverElement);
			this.hoverElement.style.left = "0";
			this.hoverElement.style.top = "0";
			this.hoverElement.style.width = this.table.element.clientWidth + "px";
			this.hoverElement.style.whiteSpace = "nowrap";
			this.hoverElement.style.overflow = "hidden";
			this.hoverElement.style.pointerEvents = "none";
		} else {
			this.table.rowManager.getTableElement().appendChild(this.hoverElement);

			this.hoverElement.style.left = "0";
			this.hoverElement.style.top = "0";

			this._bindMouseMove();
		}

		document.body.addEventListener("mousemove", this.moveHover);
		document.body.addEventListener("mouseup", this.endMove);

		this.moveHover(e);
	};

	MoveRows.prototype.setStartPosition = function (e, row) {
		var pageX = this.touchMove ? e.touches[0].pageX : e.pageX,
		    pageY = this.touchMove ? e.touches[0].pageY : e.pageY,
		    element,
		    position;

		element = row.getElement();
		if (this.connection) {
			position = element.getBoundingClientRect();

			this.startX = position.left - pageX + window.pageXOffset;
			this.startY = position.top - pageY + window.pageYOffset;
		} else {
			this.startY = pageY - element.getBoundingClientRect().top;
		}
	};

	MoveRows.prototype.endMove = function (e) {
		if (!e || e.which === 1 || this.touchMove) {
			this._unbindMouseMove();

			if (!this.connection) {
				this.placeholderElement.parentNode.insertBefore(this.moving.getElement(), this.placeholderElement.nextSibling);
				this.placeholderElement.parentNode.removeChild(this.placeholderElement);
			}

			this.hoverElement.parentNode.removeChild(this.hoverElement);

			this.table.element.classList.remove("tabulator-block-select");

			if (this.toRow) {
				this.table.rowManager.moveRow(this.moving, this.toRow, this.toRowAfter);
			}

			this.moving = false;
			this.toRow = false;
			this.toRowAfter = false;

			document.body.removeEventListener("mousemove", this.moveHover);
			document.body.removeEventListener("mouseup", this.endMove);

			if (this.connection) {
				this.table.element.classList.remove("tabulator-movingrow-sending");
				this.disconnectFromTables();
			}
		}
	};

	MoveRows.prototype.moveRow = function (row, after) {
		this.toRow = row;
		this.toRowAfter = after;
	};

	MoveRows.prototype.moveHover = function (e) {
		if (this.connection) {
			this.moveHoverConnections.call(this, e);
		} else {
			this.moveHoverTable.call(this, e);
		}
	};

	MoveRows.prototype.moveHoverTable = function (e) {
		var rowHolder = this.table.rowManager.getElement(),
		    scrollTop = rowHolder.scrollTop,
		    yPos = (this.touchMove ? e.touches[0].pageY : e.pageY) - rowHolder.getBoundingClientRect().top + scrollTop,
		    scrollPos;

		this.hoverElement.style.top = yPos - this.startY + "px";
	};

	MoveRows.prototype.moveHoverConnections = function (e) {
		this.hoverElement.style.left = this.startX + (this.touchMove ? e.touches[0].pageX : e.pageX) + "px";
		this.hoverElement.style.top = this.startY + (this.touchMove ? e.touches[0].pageY : e.pageY) + "px";
	};

	MoveRows.prototype.elementRowDrop = function (e, element, row) {
		if (this.table.options.movableRowsElementDrop) {
			this.table.options.movableRowsElementDrop(e, element, row ? row.getComponent() : false);
		}
	};

	//establish connection with other tables
	MoveRows.prototype.connectToTables = function (row) {
		var _this66 = this;

		var connectionTables;

		if (this.connectionSelectorsTables) {
			connectionTables = this.table.modules.comms.getConnections(this.connectionSelectorsTables);

			this.table.options.movableRowsSendingStart.call(this.table, connectionTables);

			this.table.modules.comms.send(this.connectionSelectorsTables, "moveRow", "connect", {
				row: row
			});
		}

		if (this.connectionSelectorsElements) {

			this.connectionElements = [];

			if (!Array.isArray(this.connectionSelectorsElements)) {
				this.connectionSelectorsElements = [this.connectionSelectorsElements];
			}

			this.connectionSelectorsElements.forEach(function (query) {
				if (typeof query === "string") {
					_this66.connectionElements = _this66.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(query)));
				} else {
					_this66.connectionElements.push(query);
				}
			});

			this.connectionElements.forEach(function (element) {
				var dropEvent = function dropEvent(e) {
					_this66.elementRowDrop(e, element, _this66.moving);
				};

				element.addEventListener("mouseup", dropEvent);
				element.tabulatorElementDropEvent = dropEvent;

				element.classList.add("tabulator-movingrow-receiving");
			});
		}
	};

	//disconnect from other tables
	MoveRows.prototype.disconnectFromTables = function () {
		var connectionTables;

		if (this.connectionSelectorsTables) {
			connectionTables = this.table.modules.comms.getConnections(this.connectionSelectorsTables);

			this.table.options.movableRowsSendingStop.call(this.table, connectionTables);

			this.table.modules.comms.send(this.connectionSelectorsTables, "moveRow", "disconnect");
		}

		this.connectionElements.forEach(function (element) {
			element.classList.remove("tabulator-movingrow-receiving");
			element.removeEventListener("mouseup", element.tabulatorElementDropEvent);
			delete element.tabulatorElementDropEvent;
		});
	};

	//accept incomming connection
	MoveRows.prototype.connect = function (table, row) {
		var self = this;
		if (!this.connectedTable) {
			this.connectedTable = table;
			this.connectedRow = row;

			this.table.element.classList.add("tabulator-movingrow-receiving");

			self.table.rowManager.getDisplayRows().forEach(function (row) {
				if (row.type === "row" && row.modules.moveRow && row.modules.moveRow.mouseup) {
					row.getElement().addEventListener("mouseup", row.modules.moveRow.mouseup);
				}
			});

			self.tableRowDropEvent = self.tableRowDrop.bind(self);

			self.table.element.addEventListener("mouseup", self.tableRowDropEvent);

			this.table.options.movableRowsReceivingStart.call(this.table, row, table);

			return true;
		} else {
			console.warn("Move Row Error - Table cannot accept connection, already connected to table:", this.connectedTable);
			return false;
		}
	};

	//close incomming connection
	MoveRows.prototype.disconnect = function (table) {
		var self = this;
		if (table === this.connectedTable) {
			this.connectedTable = false;
			this.connectedRow = false;

			this.table.element.classList.remove("tabulator-movingrow-receiving");

			self.table.rowManager.getDisplayRows().forEach(function (row) {
				if (row.type === "row" && row.modules.moveRow && row.modules.moveRow.mouseup) {
					row.getElement().removeEventListener("mouseup", row.modules.moveRow.mouseup);
				}
			});

			self.table.element.removeEventListener("mouseup", self.tableRowDropEvent);

			this.table.options.movableRowsReceivingStop.call(this.table, table);
		} else {
			console.warn("Move Row Error - trying to disconnect from non connected table");
		}
	};

	MoveRows.prototype.dropComplete = function (table, row, success) {
		var sender = false;

		if (success) {

			switch (_typeof(this.table.options.movableRowsSender)) {
				case "string":
					sender = this.senders[this.table.options.movableRowsSender];
					break;

				case "function":
					sender = this.table.options.movableRowsSender;
					break;
			}

			if (sender) {
				sender.call(this, this.moving.getComponent(), row ? row.getComponent() : undefined, table);
			} else {
				if (this.table.options.movableRowsSender) {
					console.warn("Mover Row Error - no matching sender found:", this.table.options.movableRowsSender);
				}
			}

			this.table.options.movableRowsSent.call(this.table, this.moving.getComponent(), row ? row.getComponent() : undefined, table);
		} else {
			this.table.options.movableRowsSentFailed.call(this.table, this.moving.getComponent(), row ? row.getComponent() : undefined, table);
		}

		this.endMove();
	};

	MoveRows.prototype.tableRowDrop = function (e, row) {
		var receiver = false,
		    success = false;

		console.trace("drop");

		e.stopImmediatePropagation();

		switch (_typeof(this.table.options.movableRowsReceiver)) {
			case "string":
				receiver = this.receivers[this.table.options.movableRowsReceiver];
				break;

			case "function":
				receiver = this.table.options.movableRowsReceiver;
				break;
		}

		if (receiver) {
			success = receiver.call(this, this.connectedRow.getComponent(), row ? row.getComponent() : undefined, this.connectedTable);
		} else {
			console.warn("Mover Row Error - no matching receiver found:", this.table.options.movableRowsReceiver);
		}

		if (success) {
			this.table.options.movableRowsReceived.call(this.table, this.connectedRow.getComponent(), row ? row.getComponent() : undefined, this.connectedTable);
		} else {
			this.table.options.movableRowsReceivedFailed.call(this.table, this.connectedRow.getComponent(), row ? row.getComponent() : undefined, this.connectedTable);
		}

		this.table.modules.comms.send(this.connectedTable, "moveRow", "dropcomplete", {
			row: row,
			success: success
		});
	};

	MoveRows.prototype.receivers = {
		insert: function insert(fromRow, toRow, fromTable) {
			this.table.addRow(fromRow.getData(), undefined, toRow);
			return true;
		},

		add: function add(fromRow, toRow, fromTable) {
			this.table.addRow(fromRow.getData());
			return true;
		},

		update: function update(fromRow, toRow, fromTable) {
			if (toRow) {
				toRow.update(fromRow.getData());
				return true;
			}

			return false;
		},

		replace: function replace(fromRow, toRow, fromTable) {
			if (toRow) {
				this.table.addRow(fromRow.getData(), undefined, toRow);
				toRow.delete();
				return true;
			}

			return false;
		}
	};

	MoveRows.prototype.senders = {
		delete: function _delete(fromRow, toRow, toTable) {
			fromRow.delete();
		}
	};

	MoveRows.prototype.commsReceived = function (table, action, data) {
		switch (action) {
			case "connect":
				return this.connect(table, data.row);
				break;

			case "disconnect":
				return this.disconnect(table);
				break;

			case "dropcomplete":
				return this.dropComplete(table, data.row, data.success);
				break;
		}
	};

	Tabulator.prototype.registerModule("moveRow", MoveRows);
	var Mutator = function Mutator(table) {
		this.table = table; //hold Tabulator object
		this.allowedTypes = ["", "data", "edit", "clipboard"]; //list of muatation types
		this.enabled = true;
	};

	//initialize column mutator
	Mutator.prototype.initializeColumn = function (column) {
		var self = this,
		    match = false,
		    config = {};

		this.allowedTypes.forEach(function (type) {
			var key = "mutator" + (type.charAt(0).toUpperCase() + type.slice(1)),
			    mutator;

			if (column.definition[key]) {
				mutator = self.lookupMutator(column.definition[key]);

				if (mutator) {
					match = true;

					config[key] = {
						mutator: mutator,
						params: column.definition[key + "Params"] || {}
					};
				}
			}
		});

		if (match) {
			column.modules.mutate = config;
		}
	};

	Mutator.prototype.lookupMutator = function (value) {
		var mutator = false;

		//set column mutator
		switch (typeof value === 'undefined' ? 'undefined' : _typeof(value)) {
			case "string":
				if (this.mutators[value]) {
					mutator = this.mutators[value];
				} else {
					console.warn("Mutator Error - No such mutator found, ignoring: ", value);
				}
				break;

			case "function":
				mutator = value;
				break;
		}

		return mutator;
	};

	//apply mutator to row
	Mutator.prototype.transformRow = function (data, type, updatedData) {
		var self = this,
		    key = "mutator" + (type.charAt(0).toUpperCase() + type.slice(1)),
		    value;

		if (this.enabled) {

			self.table.columnManager.traverse(function (column) {
				var mutator, params, component;

				if (column.modules.mutate) {
					mutator = column.modules.mutate[key] || column.modules.mutate.mutator || false;

					if (mutator) {
						value = column.getFieldValue(typeof updatedData !== "undefined" ? updatedData : data);

						if (type == "data" || typeof value !== "undefined") {
							component = column.getComponent();
							params = typeof mutator.params === "function" ? mutator.params(value, data, type, component) : mutator.params;
							column.setFieldValue(data, mutator.mutator(value, data, type, params, component));
						}
					}
				}
			});
		}

		return data;
	};

	//apply mutator to new cell value
	Mutator.prototype.transformCell = function (cell, value) {
		var mutator = cell.column.modules.mutate.mutatorEdit || cell.column.modules.mutate.mutator || false,
		    tempData = {};

		if (mutator) {
			tempData = Object.assign(tempData, cell.row.getData());
			cell.column.setFieldValue(tempData, value);
			return mutator.mutator(value, tempData, "edit", mutator.params, cell.getComponent());
		} else {
			return value;
		}
	};

	Mutator.prototype.enable = function () {
		this.enabled = true;
	};

	Mutator.prototype.disable = function () {
		this.enabled = false;
	};

	//default mutators
	Mutator.prototype.mutators = {};

	Tabulator.prototype.registerModule("mutator", Mutator);
	var Page = function Page(table) {

		this.table = table; //hold Tabulator object

		this.mode = "local";
		this.progressiveLoad = false;

		this.size = 0;
		this.page = 1;
		this.count = 5;
		this.max = 1;

		this.displayIndex = 0; //index in display pipeline

		this.initialLoad = true;

		this.pageSizes = [];

		this.dataReceivedNames = {};
		this.dataSentNames = {};

		this.createElements();
	};

	Page.prototype.createElements = function () {

		var button;

		this.element = document.createElement("span");
		this.element.classList.add("tabulator-paginator");

		this.pagesElement = document.createElement("span");
		this.pagesElement.classList.add("tabulator-pages");

		button = document.createElement("button");
		button.classList.add("tabulator-page");
		button.setAttribute("type", "button");
		button.setAttribute("role", "button");
		button.setAttribute("aria-label", "");
		button.setAttribute("title", "");

		this.firstBut = button.cloneNode(true);
		this.firstBut.setAttribute("data-page", "first");

		this.prevBut = button.cloneNode(true);
		this.prevBut.setAttribute("data-page", "prev");

		this.nextBut = button.cloneNode(true);
		this.nextBut.setAttribute("data-page", "next");

		this.lastBut = button.cloneNode(true);
		this.lastBut.setAttribute("data-page", "last");

		if (this.table.options.paginationSizeSelector) {
			this.pageSizeSelect = document.createElement("select");
			this.pageSizeSelect.classList.add("tabulator-page-size");
		}
	};

	Page.prototype.generatePageSizeSelectList = function () {
		var _this67 = this;

		var pageSizes = [];

		if (this.pageSizeSelect) {

			if (Array.isArray(this.table.options.paginationSizeSelector)) {
				pageSizes = this.table.options.paginationSizeSelector;
				this.pageSizes = pageSizes;

				if (this.pageSizes.indexOf(this.size) == -1) {
					pageSizes.unshift(this.size);
				}
			} else {

				if (this.pageSizes.indexOf(this.size) == -1) {
					pageSizes = [];

					for (var _i9 = 1; _i9 < 5; _i9++) {
						pageSizes.push(this.size * _i9);
					}

					this.pageSizes = pageSizes;
				} else {
					pageSizes = this.pageSizes;
				}
			}

			while (this.pageSizeSelect.firstChild) {
				this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);
			}pageSizes.forEach(function (item) {
				var itemEl = document.createElement("option");
				itemEl.value = item;

				if (item === true) {
					_this67.table.modules.localize.bind("pagination|all", function (value) {
						itemEl.innerHTML = value;
					});
				} else {
					itemEl.innerHTML = item;
				}

				_this67.pageSizeSelect.appendChild(itemEl);
			});

			this.pageSizeSelect.value = this.size;
		}
	};

	//setup pageination
	Page.prototype.initialize = function (hidden) {
		var self = this,
		    pageSelectLabel,
		    testElRow,
		    testElCell;

		//update param names
		this.dataSentNames = Object.assign({}, this.paginationDataSentNames);
		this.dataSentNames = Object.assign(this.dataSentNames, this.table.options.paginationDataSent);

		this.dataReceivedNames = Object.assign({}, this.paginationDataReceivedNames);
		this.dataReceivedNames = Object.assign(this.dataReceivedNames, this.table.options.paginationDataReceived);

		//build pagination element

		//bind localizations
		self.table.modules.localize.bind("pagination|first", function (value) {
			self.firstBut.innerHTML = value;
		});

		self.table.modules.localize.bind("pagination|first_title", function (value) {
			self.firstBut.setAttribute("aria-label", value);
			self.firstBut.setAttribute("title", value);
		});

		self.table.modules.localize.bind("pagination|prev", function (value) {
			self.prevBut.innerHTML = value;
		});

		self.table.modules.localize.bind("pagination|prev_title", function (value) {
			self.prevBut.setAttribute("aria-label", value);
			self.prevBut.setAttribute("title", value);
		});

		self.table.modules.localize.bind("pagination|next", function (value) {
			self.nextBut.innerHTML = value;
		});

		self.table.modules.localize.bind("pagination|next_title", function (value) {
			self.nextBut.setAttribute("aria-label", value);
			self.nextBut.setAttribute("title", value);
		});

		self.table.modules.localize.bind("pagination|last", function (value) {
			self.lastBut.innerHTML = value;
		});

		self.table.modules.localize.bind("pagination|last_title", function (value) {
			self.lastBut.setAttribute("aria-label", value);
			self.lastBut.setAttribute("title", value);
		});

		//click bindings
		self.firstBut.addEventListener("click", function () {
			self.setPage(1);
		});

		self.prevBut.addEventListener("click", function () {
			self.previousPage();
		});

		self.nextBut.addEventListener("click", function () {
			self.nextPage().then(function () {}).catch(function () {});
		});

		self.lastBut.addEventListener("click", function () {
			self.setPage(self.max);
		});

		if (self.table.options.paginationElement) {
			self.element = self.table.options.paginationElement;
		}

		if (this.pageSizeSelect) {
			pageSelectLabel = document.createElement("label");

			self.table.modules.localize.bind("pagination|page_size", function (value) {
				self.pageSizeSelect.setAttribute("aria-label", value);
				self.pageSizeSelect.setAttribute("title", value);
				pageSelectLabel.innerHTML = value;
			});

			self.element.appendChild(pageSelectLabel);
			self.element.appendChild(self.pageSizeSelect);

			self.pageSizeSelect.addEventListener("change", function (e) {
				self.setPageSize(self.pageSizeSelect.value == "true" ? true : self.pageSizeSelect.value);
				self.setPage(1).then(function () {}).catch(function () {});
			});
		}

		//append to DOM
		self.element.appendChild(self.firstBut);
		self.element.appendChild(self.prevBut);
		self.element.appendChild(self.pagesElement);
		self.element.appendChild(self.nextBut);
		self.element.appendChild(self.lastBut);

		if (!self.table.options.paginationElement && !hidden) {
			self.table.footerManager.append(self.element, self);
		}

		//set default values
		self.mode = self.table.options.pagination;

		if (self.table.options.paginationSize) {
			self.size = self.table.options.paginationSize;
		} else {
			testElRow = document.createElement("div");
			testElRow.classList.add("tabulator-row");
			testElRow.style.visibility = hidden;

			testElCell = document.createElement("div");
			testElCell.classList.add("tabulator-cell");
			testElCell.innerHTML = "Page Row Test";

			testElRow.appendChild(testElCell);

			self.table.rowManager.getTableElement().appendChild(testElRow);

			self.size = Math.floor(self.table.rowManager.getElement().clientHeight / testElRow.offsetHeight);

			self.table.rowManager.getTableElement().removeChild(testElRow);
		}

		// self.page = self.table.options.paginationInitialPage || 1;
		self.count = self.table.options.paginationButtonCount;

		self.generatePageSizeSelectList();
	};

	Page.prototype.initializeProgressive = function (mode) {
		this.initialize(true);
		this.mode = "progressive_" + mode;
		this.progressiveLoad = true;
	};

	Page.prototype.setDisplayIndex = function (index) {
		this.displayIndex = index;
	};

	Page.prototype.getDisplayIndex = function () {
		return this.displayIndex;
	};

	//calculate maximum page from number of rows
	Page.prototype.setMaxRows = function (rowCount) {
		if (!rowCount) {
			this.max = 1;
		} else {
			this.max = this.size === true ? 1 : Math.ceil(rowCount / this.size);
		}

		if (this.page > this.max) {
			this.page = this.max;
		}
	};

	//reset to first page without triggering action
	Page.prototype.reset = function (force, columnsChanged) {
		if (this.mode == "local" || force) {
			this.page = 1;
		}

		if (columnsChanged) {
			this.initialLoad = true;
		}

		return true;
	};

	//set the maxmum page
	Page.prototype.setMaxPage = function (max) {

		max = parseInt(max);

		this.max = max || 1;

		if (this.page > this.max) {
			this.page = this.max;
			this.trigger();
		}
	};

	//set current page number
	Page.prototype.setPage = function (page) {
		var _this68 = this;

		var self = this;

		switch (page) {
			case "first":
				return this.setPage(1);
				break;

			case "prev":
				return this.previousPage();
				break;

			case "next":
				return this.nextPage();
				break;

			case "last":
				return this.setPage(this.max);
				break;
		}

		return new Promise(function (resolve, reject) {

			page = parseInt(page);

			if (page > 0 && page <= _this68.max) {
				_this68.page = page;
				_this68.trigger().then(function () {
					resolve();
				}).catch(function () {
					reject();
				});

				if (self.table.options.persistence && self.table.modExists("persistence", true) && self.table.modules.persistence.config.page) {
					self.table.modules.persistence.save("page");
				}
			} else {
				console.warn("Pagination Error - Requested page is out of range of 1 - " + _this68.max + ":", page);
				reject();
			}
		});
	};

	Page.prototype.setPageToRow = function (row) {
		var _this69 = this;

		return new Promise(function (resolve, reject) {

			var rows = _this69.table.rowManager.getDisplayRows(_this69.displayIndex - 1);
			var index = rows.indexOf(row);

			if (index > -1) {
				var page = _this69.size === true ? 1 : Math.ceil((index + 1) / _this69.size);

				_this69.setPage(page).then(function () {
					resolve();
				}).catch(function () {
					reject();
				});
			} else {
				console.warn("Pagination Error - Requested row is not visible");
				reject();
			}
		});
	};

	Page.prototype.setPageSize = function (size) {
		if (size !== true) {
			size = parseInt(size);
		}

		if (size > 0) {
			this.size = size;
		}

		if (this.pageSizeSelect) {
			// this.pageSizeSelect.value = size;
			this.generatePageSizeSelectList();
		}

		if (this.table.options.persistence && this.table.modExists("persistence", true) && this.table.modules.persistence.config.page) {
			this.table.modules.persistence.save("page");
		}
	};

	//setup the pagination buttons
	Page.prototype._setPageButtons = function () {
		var self = this;

		var leftSize = Math.floor((this.count - 1) / 2);
		var rightSize = Math.ceil((this.count - 1) / 2);
		var min = this.max - this.page + leftSize + 1 < this.count ? this.max - this.count + 1 : Math.max(this.page - leftSize, 1);
		var max = this.page <= rightSize ? Math.min(this.count, this.max) : Math.min(this.page + rightSize, this.max);

		while (self.pagesElement.firstChild) {
			self.pagesElement.removeChild(self.pagesElement.firstChild);
		}if (self.page == 1) {
			self.firstBut.disabled = true;
			self.prevBut.disabled = true;
		} else {
			self.firstBut.disabled = false;
			self.prevBut.disabled = false;
		}

		if (self.page == self.max) {
			self.lastBut.disabled = true;
			self.nextBut.disabled = true;
		} else {
			self.lastBut.disabled = false;
			self.nextBut.disabled = false;
		}

		for (var _i10 = min; _i10 <= max; _i10++) {
			if (_i10 > 0 && _i10 <= self.max) {
				self.pagesElement.appendChild(self._generatePageButton(_i10));
			}
		}

		this.footerRedraw();
	};

	Page.prototype._generatePageButton = function (page) {
		var self = this,
		    button = document.createElement("button");

		button.classList.add("tabulator-page");
		if (page == self.page) {
			button.classList.add("active");
		}

		button.setAttribute("type", "button");
		button.setAttribute("role", "button");

		self.table.modules.localize.bind("pagination|page_title", function (value) {
			button.setAttribute("aria-label", value + " " + page);
			button.setAttribute("title", value + " " + page);
		});

		button.setAttribute("data-page", page);
		button.textContent = page;

		button.addEventListener("click", function (e) {
			self.setPage(page);
		});

		return button;
	};

	//previous page
	Page.prototype.previousPage = function () {
		var _this70 = this;

		return new Promise(function (resolve, reject) {
			if (_this70.page > 1) {
				_this70.page--;
				_this70.trigger().then(function () {
					resolve();
				}).catch(function () {
					reject();
				});

				if (_this70.table.options.persistence && _this70.table.modExists("persistence", true) && _this70.table.modules.persistence.config.page) {
					_this70.table.modules.persistence.save("page");
				}
			} else {
				console.warn("Pagination Error - Previous page would be less than page 1:", 0);
				reject();
			}
		});
	};

	//next page
	Page.prototype.nextPage = function () {
		var _this71 = this;

		return new Promise(function (resolve, reject) {
			if (_this71.page < _this71.max) {
				_this71.page++;
				_this71.trigger().then(function () {
					resolve();
				}).catch(function () {
					reject();
				});

				if (_this71.table.options.persistence && _this71.table.modExists("persistence", true) && _this71.table.modules.persistence.config.page) {
					_this71.table.modules.persistence.save("page");
				}
			} else {
				if (!_this71.progressiveLoad) {
					console.warn("Pagination Error - Next page would be greater than maximum page of " + _this71.max + ":", _this71.max + 1);
				}
				reject();
			}
		});
	};

	//return current page number
	Page.prototype.getPage = function () {
		return this.page;
	};

	//return max page number
	Page.prototype.getPageMax = function () {
		return this.max;
	};

	Page.prototype.getPageSize = function (size) {
		return this.size;
	};

	Page.prototype.getMode = function () {
		return this.mode;
	};

	//return appropriate rows for current page
	Page.prototype.getRows = function (data) {
		var output, start, end;

		if (this.mode == "local") {
			output = [];

			if (this.size === true) {
				start = 0;
				end = data.length - 1;
			} else {
				start = this.size * (this.page - 1);
				end = start + parseInt(this.size);
			}

			this._setPageButtons();

			for (var _i11 = start; _i11 < end; _i11++) {
				if (data[_i11]) {
					output.push(data[_i11]);
				}
			}

			return output;
		} else {

			this._setPageButtons();

			return data.slice(0);
		}
	};

	Page.prototype.trigger = function () {
		var _this72 = this;

		var left;

		return new Promise(function (resolve, reject) {

			switch (_this72.mode) {
				case "local":
					left = _this72.table.rowManager.scrollLeft;

					_this72.table.rowManager.refreshActiveData("page");
					_this72.table.rowManager.scrollHorizontal(left);

					_this72.table.options.pageLoaded.call(_this72.table, _this72.getPage());
					resolve();
					break;

				case "remote":
				case "progressive_load":
				case "progressive_scroll":
					_this72.table.modules.ajax.blockActiveRequest();
					_this72._getRemotePage().then(function () {
						resolve();
					}).catch(function () {
						reject();
					});
					break;

				default:
					console.warn("Pagination Error - no such pagination mode:", _this72.mode);
					reject();
			}
		});
	};

	Page.prototype._getRemotePage = function () {
		var _this73 = this;

		var self = this,
		    oldParams,
		    pageParams;

		return new Promise(function (resolve, reject) {

			if (!self.table.modExists("ajax", true)) {
				reject();
			}

			//record old params and restore after request has been made
			oldParams = Tabulator.prototype.helpers.deepClone(self.table.modules.ajax.getParams() || {});
			pageParams = self.table.modules.ajax.getParams();

			//configure request params
			pageParams[_this73.dataSentNames.page] = self.page;

			//set page size if defined
			if (_this73.size) {
				pageParams[_this73.dataSentNames.size] = _this73.size;
			}

			//set sort data if defined
			if (_this73.table.options.ajaxSorting && _this73.table.modExists("sort")) {
				var sorters = self.table.modules.sort.getSort();

				sorters.forEach(function (item) {
					delete item.column;
				});

				pageParams[_this73.dataSentNames.sorters] = sorters;
			}

			//set filter data if defined
			if (_this73.table.options.ajaxFiltering && _this73.table.modExists("filter")) {
				var filters = self.table.modules.filter.getFilters(true, true);
				pageParams[_this73.dataSentNames.filters] = filters;
			}

			self.table.modules.ajax.setParams(pageParams);

			self.table.modules.ajax.sendRequest(_this73.progressiveLoad).then(function (data) {
				self._parseRemoteData(data);
				resolve();
			}).catch(function (e) {
				reject();
			});

			self.table.modules.ajax.setParams(oldParams);
		});
	};

	Page.prototype._parseRemoteData = function (data) {
		var self = this,
		    left,
		    data,
		    margin;

		if (typeof data[this.dataReceivedNames.last_page] === "undefined") {
			console.warn("Remote Pagination Error - Server response missing '" + this.dataReceivedNames.last_page + "' property");
		}

		if (data[this.dataReceivedNames.data]) {
			this.max = parseInt(data[this.dataReceivedNames.last_page]) || 1;

			if (this.progressiveLoad) {
				switch (this.mode) {
					case "progressive_load":

						if (this.page == 1) {
							this.table.rowManager.setData(data[this.dataReceivedNames.data], false, this.initialLoad && this.page == 1);
						} else {
							this.table.rowManager.addRows(data[this.dataReceivedNames.data]);
						}

						if (this.page < this.max) {
							setTimeout(function () {
								self.nextPage().then(function () {}).catch(function () {});
							}, self.table.options.ajaxProgressiveLoadDelay);
						}
						break;

					case "progressive_scroll":
						data = this.table.rowManager.getData().concat(data[this.dataReceivedNames.data]);

						this.table.rowManager.setData(data, true, this.initialLoad && this.page == 1);

						margin = this.table.options.ajaxProgressiveLoadScrollMargin || this.table.rowManager.element.clientHeight * 2;

						if (self.table.rowManager.element.scrollHeight <= self.table.rowManager.element.clientHeight + margin) {
							self.nextPage().then(function () {}).catch(function () {});
						}
						break;
				}
			} else {
				left = this.table.rowManager.scrollLeft;

				this.table.rowManager.setData(data[this.dataReceivedNames.data], false, this.initialLoad && this.page == 1);

				this.table.rowManager.scrollHorizontal(left);

				this.table.columnManager.scrollHorizontal(left);

				this.table.options.pageLoaded.call(this.table, this.getPage());
			}

			this.initialLoad = false;
		} else {
			console.warn("Remote Pagination Error - Server response missing '" + this.dataReceivedNames.data + "' property");
		}
	};

	//handle the footer element being redrawn
	Page.prototype.footerRedraw = function () {
		var footer = this.table.footerManager.element;

		if (Math.ceil(footer.clientWidth) - footer.scrollWidth < 0) {
			this.pagesElement.style.display = 'none';
		} else {
			this.pagesElement.style.display = '';

			if (Math.ceil(footer.clientWidth) - footer.scrollWidth < 0) {
				this.pagesElement.style.display = 'none';
			}
		}
	};

	//set the paramter names for pagination requests
	Page.prototype.paginationDataSentNames = {
		"page": "page",
		"size": "size",
		"sorters": "sorters",
		// "sort_dir":"sort_dir",
		"filters": "filters"
		// "filter_value":"filter_value",
		// "filter_type":"filter_type",
	};

	//set the property names for pagination responses
	Page.prototype.paginationDataReceivedNames = {
		"current_page": "current_page",
		"last_page": "last_page",
		"data": "data"
	};

	Tabulator.prototype.registerModule("page", Page);

	var Persistence = function Persistence(table) {
		this.table = table; //hold Tabulator object
		this.mode = "";
		this.id = "";
		// this.persistProps = ["field", "width", "visible"];
		this.defWatcherBlock = false;
		this.config = {};
		this.readFunc = false;
		this.writeFunc = false;
	};

	// Test for whether localStorage is available for use.
	Persistence.prototype.localStorageTest = function () {
		var testKey = "_tabulator_test";

		try {
			window.localStorage.setItem(testKey, testKey);
			window.localStorage.removeItem(testKey);
			return true;
		} catch (e) {
			return false;
		}
	};

	//setup parameters
	Persistence.prototype.initialize = function () {
		//determine persistent layout storage type

		var mode = this.table.options.persistenceMode,
		    id = this.table.options.persistenceID,
		    retreivedData;

		this.mode = mode !== true ? mode : this.localStorageTest() ? "local" : "cookie";

		if (this.table.options.persistenceReaderFunc) {
			if (typeof this.table.options.persistenceReaderFunc === "function") {
				this.readFunc = this.table.options.persistenceReaderFunc;
			} else {
				if (this.readers[this.table.options.persistenceReaderFunc]) {
					this.readFunc = this.readers[this.table.options.persistenceReaderFunc];
				} else {
					console.warn("Persistence Read Error - invalid reader set", this.table.options.persistenceReaderFunc);
				}
			}
		} else {
			if (this.readers[this.mode]) {
				this.readFunc = this.readers[this.mode];
			} else {
				console.warn("Persistence Read Error - invalid reader set", this.mode);
			}
		}

		if (this.table.options.persistenceWriterFunc) {
			if (typeof this.table.options.persistenceWriterFunc === "function") {
				this.writeFunc = this.table.options.persistenceWriterFunc;
			} else {
				if (this.readers[this.table.options.persistenceWriterFunc]) {
					this.writeFunc = this.readers[this.table.options.persistenceWriterFunc];
				} else {
					console.warn("Persistence Write Error - invalid reader set", this.table.options.persistenceWriterFunc);
				}
			}
		} else {
			if (this.writers[this.mode]) {
				this.writeFunc = this.writers[this.mode];
			} else {
				console.warn("Persistence Write Error - invalid writer set", this.mode);
			}
		}

		//set storage tag
		this.id = "tabulator-" + (id || this.table.element.getAttribute("id") || "");

		this.config = {
			sort: this.table.options.persistence === true || this.table.options.persistence.sort,
			filter: this.table.options.persistence === true || this.table.options.persistence.filter,
			group: this.table.options.persistence === true || this.table.options.persistence.group,
			page: this.table.options.persistence === true || this.table.options.persistence.page,
			columns: this.table.options.persistence === true ? ["title", "width", "visible"] : this.table.options.persistence.columns
		};

		//load pagination data if needed
		if (this.config.page) {
			retreivedData = this.retreiveData("page");

			if (retreivedData) {
				if (typeof retreivedData.paginationSize !== "undefined" && (this.config.page === true || this.config.page.size)) {
					this.table.options.paginationSize = retreivedData.paginationSize;
				}

				if (typeof retreivedData.paginationInitialPage !== "undefined" && (this.config.page === true || this.config.page.page)) {
					this.table.options.paginationInitialPage = retreivedData.paginationInitialPage;
				}
			}
		}

		//load group data if needed
		if (this.config.group) {
			retreivedData = this.retreiveData("group");

			if (retreivedData) {
				if (typeof retreivedData.groupBy !== "undefined" && (this.config.group === true || this.config.group.groupBy)) {
					this.table.options.groupBy = retreivedData.groupBy;
				}
				if (typeof retreivedData.groupStartOpen !== "undefined" && (this.config.group === true || this.config.group.groupStartOpen)) {
					this.table.options.groupStartOpen = retreivedData.groupStartOpen;
				}
				if (typeof retreivedData.groupHeader !== "undefined" && (this.config.group === true || this.config.group.groupHeader)) {
					this.table.options.groupHeader = retreivedData.groupHeader;
				}
			}
		}
	};

	Persistence.prototype.initializeColumn = function (column) {
		var self = this,
		    def,
		    keys;

		if (this.config.columns) {
			this.defWatcherBlock = true;

			def = column.getDefinition();

			keys = this.config.columns === true ? Object.keys(def) : this.config.columns;

			keys.forEach(function (key) {
				var props = Object.getOwnPropertyDescriptor(def, key);
				var value = def[key];
				if (props) {
					Object.defineProperty(def, key, {
						set: function set(newValue) {
							value = newValue;

							if (!self.defWatcherBlock) {
								self.save("columns");
							}

							if (props.set) {
								props.set(newValue);
							}
						},
						get: function get() {
							if (props.get) {
								props.get();
							}
							return value;
						}
					});
				}
			});

			this.defWatcherBlock = false;
		}
	};

	//load saved definitions
	Persistence.prototype.load = function (type, current) {
		var data = this.retreiveData(type);

		if (current) {
			data = data ? this.mergeDefinition(current, data) : current;
		}

		return data;
	};

	//retreive data from memory
	Persistence.prototype.retreiveData = function (type) {
		return this.readFunc ? this.readFunc(this.id, type) : false;
	};

	//merge old and new column definitions
	Persistence.prototype.mergeDefinition = function (oldCols, newCols) {
		var self = this,
		    output = [];

		// oldCols = oldCols || [];
		newCols = newCols || [];

		newCols.forEach(function (column, to) {

			var from = self._findColumn(oldCols, column),
			    keys;

			if (from) {

				if (self.config.columns === true || self.config.columns == undefined) {
					keys = Object.keys(from);
					keys.push("width");
				} else {
					keys = self.config.columns;
				}

				keys.forEach(function (key) {
					if (typeof column[key] !== "undefined") {
						from[key] = column[key];
					}
				});

				if (from.columns) {
					from.columns = self.mergeDefinition(from.columns, column.columns);
				}

				output.push(from);
			}
		});

		oldCols.forEach(function (column, i) {
			var from = self._findColumn(newCols, column);
			if (!from) {
				if (output.length > i) {
					output.splice(i, 0, column);
				} else {
					output.push(column);
				}
			}
		});

		return output;
	};

	//find matching columns
	Persistence.prototype._findColumn = function (columns, subject) {
		var type = subject.columns ? "group" : subject.field ? "field" : "object";

		return columns.find(function (col) {
			switch (type) {
				case "group":
					return col.title === subject.title && col.columns.length === subject.columns.length;
					break;

				case "field":
					return col.field === subject.field;
					break;

				case "object":
					return col === subject;
					break;
			}
		});
	};

	//save data
	Persistence.prototype.save = function (type) {
		var data = {};

		switch (type) {
			case "columns":
				data = this.parseColumns(this.table.columnManager.getColumns());
				break;

			case "filter":
				data = this.table.modules.filter.getFilters();
				break;

			case "sort":
				data = this.validateSorters(this.table.modules.sort.getSort());
				break;

			case "group":
				data = this.getGroupConfig();
				break;

			case "page":
				data = this.getPageConfig();
				break;
		}

		if (this.writeFunc) {
			this.writeFunc(this.id, type, data);
		}
	};

	//ensure sorters contain no function data
	Persistence.prototype.validateSorters = function (data) {
		data.forEach(function (item) {
			item.column = item.field;
			delete item.field;
		});

		return data;
	};

	Persistence.prototype.getGroupConfig = function () {
		if (this.config.group) {
			if (this.config.group === true || this.config.group.groupBy) {
				data.groupBy = this.table.options.groupBy;
			}

			if (this.config.group === true || this.config.group.groupStartOpen) {
				data.groupStartOpen = this.table.options.groupStartOpen;
			}

			if (this.config.group === true || this.config.group.groupHeader) {
				data.groupHeader = this.table.options.groupHeader;
			}
		}

		return data;
	};

	Persistence.prototype.getPageConfig = function () {
		var data = {};

		if (this.config.page) {
			if (this.config.page === true || this.config.page.size) {
				data.paginationSize = this.table.modules.page.getPageSize();
			}

			if (this.config.page === true || this.config.page.page) {
				data.paginationInitialPage = this.table.modules.page.getPage();
			}
		}

		return data;
	};

	//parse columns for data to store
	Persistence.prototype.parseColumns = function (columns) {
		var self = this,
		    definitions = [];

		columns.forEach(function (column) {
			var defStore = {},
			    colDef = column.getDefinition(),
			    keys;

			if (column.isGroup) {
				defStore.title = colDef.title;
				defStore.columns = self.parseColumns(column.getColumns());
			} else {
				defStore.field = column.getField();

				if (self.config.columns === true || self.config.columns == undefined) {
					keys = Object.keys(colDef);
					keys.push("width");
				} else {
					keys = self.config.columns;
				}

				keys.forEach(function (key) {

					switch (key) {
						case "width":
							defStore.width = column.getWidth();
							break;
						case "visible":
							defStore.visible = column.visible;
							break;

						default:
							defStore[key] = colDef[key];
					}
				});
			}

			definitions.push(defStore);
		});

		return definitions;
	};

	// read peristence information from storage
	Persistence.prototype.readers = {
		local: function local(id, type) {
			var data = localStorage.getItem(id + "-" + type);

			return data ? JSON.parse(data) : false;
		},
		cookie: function cookie(id, type) {
			var cookie = document.cookie,
			    key = id + "-" + type,
			    cookiePos = cookie.indexOf(key + "="),
			    end,
			    data;

			//if cookie exists, decode and load column data into tabulator
			if (cookiePos > -1) {
				cookie = cookie.substr(cookiePos);

				end = cookie.indexOf(";");

				if (end > -1) {
					cookie = cookie.substr(0, end);
				}

				data = cookie.replace(key + "=", "");
			}

			return data ? JSON.parse(data) : false;
		}
	};

	//write persistence information to storage
	Persistence.prototype.writers = {
		local: function local(id, type, data) {
			localStorage.setItem(id + "-" + type, JSON.stringify(data));
		},
		cookie: function cookie(id, type, data) {
			var expireDate = new Date();

			expireDate.setDate(expireDate.getDate() + 10000);

			document.cookie = id + "-" + type + "=" + JSON.stringify(data) + "; expires=" + expireDate.toUTCString();
		}
	};

	Tabulator.prototype.registerModule("persistence", Persistence);

	var Print = function Print(table) {
		this.table = table; //hold Tabulator object
		this.element = false;
		this.manualBlock = false;
	};

	Print.prototype.initialize = function () {
		window.addEventListener("beforeprint", this.replaceTable.bind(this));
		window.addEventListener("afterprint", this.cleanup.bind(this));
	};

	Print.prototype.replaceTable = function () {
		if (!this.manualBlock) {
			this.element = document.createElement("div");
			this.element.classList.add("tabulator-print-table");

			this.element.appendChild(this.table.modules.export.genereateTable(this.table.options.printConfig, this.table.options.printStyled, this.table.options.printRowRange, "print"));

			this.table.element.style.display = "none";

			this.table.element.parentNode.insertBefore(this.element, this.table.element);
		}
	};

	Print.prototype.cleanup = function () {
		document.body.classList.remove("tabulator-print-fullscreen-hide");

		if (this.element && this.element.parentNode) {
			this.element.parentNode.removeChild(this.element);
			this.table.element.style.display = "";
		}
	};

	Print.prototype.printFullscreen = function (visible, style, config) {
		var scrollX = window.scrollX,
		    scrollY = window.scrollY,
		    headerEl = document.createElement("div"),
		    footerEl = document.createElement("div"),
		    tableEl = this.table.modules.export.genereateTable(typeof config != "undefined" ? config : this.table.options.printConfig, typeof style != "undefined" ? style : this.table.options.printStyled, visible, "print"),
		    headerContent,
		    footerContent;

		this.manualBlock = true;

		this.element = document.createElement("div");
		this.element.classList.add("tabulator-print-fullscreen");

		if (this.table.options.printHeader) {
			headerEl.classList.add("tabulator-print-header");

			headerContent = typeof this.table.options.printHeader == "function" ? this.table.options.printHeader.call(this.table) : this.table.options.printHeader;

			if (typeof headerContent == "string") {
				headerEl.innerHTML = headerContent;
			} else {
				headerEl.appendChild(headerContent);
			}

			this.element.appendChild(headerEl);
		}

		this.element.appendChild(tableEl);

		if (this.table.options.printFooter) {
			footerEl.classList.add("tabulator-print-footer");

			footerContent = typeof this.table.options.printFooter == "function" ? this.table.options.printFooter.call(this.table) : this.table.options.printFooter;

			if (typeof footerContent == "string") {
				footerEl.innerHTML = footerContent;
			} else {
				footerEl.appendChild(footerContent);
			}

			this.element.appendChild(footerEl);
		}

		document.body.classList.add("tabulator-print-fullscreen-hide");
		document.body.appendChild(this.element);

		if (this.table.options.printFormatter) {
			this.table.options.printFormatter(this.element, tableEl);
		}

		window.print();

		this.cleanup();

		window.scrollTo(scrollX, scrollY);

		this.manualBlock = false;
	};

	Tabulator.prototype.registerModule("print", Print);
	var ReactiveData = function ReactiveData(table) {
		this.table = table; //hold Tabulator object
		this.data = false;
		this.blocked = false; //block reactivity while performing update
		this.origFuncs = {}; // hold original data array functions to allow replacement after data is done with
		this.currentVersion = 0;
	};

	ReactiveData.prototype.watchData = function (data) {
		var self = this,
		    pushFunc,
		    version;

		this.currentVersion++;

		version = this.currentVersion;

		self.unwatchData();

		self.data = data;

		//override array push function
		self.origFuncs.push = data.push;

		Object.defineProperty(self.data, "push", {
			enumerable: false,
			configurable: true,
			value: function value() {
				var args = Array.from(arguments);

				if (!self.blocked && version === self.currentVersion) {
					args.forEach(function (arg) {
						self.table.rowManager.addRowActual(arg, false);
					});
				}

				return self.origFuncs.push.apply(data, arguments);
			}
		});

		//override array unshift function
		self.origFuncs.unshift = data.unshift;

		Object.defineProperty(self.data, "unshift", {
			enumerable: false,
			configurable: true,
			value: function value() {
				var args = Array.from(arguments);

				if (!self.blocked && version === self.currentVersion) {
					args.forEach(function (arg) {
						self.table.rowManager.addRowActual(arg, true);
					});
				}

				return self.origFuncs.unshift.apply(data, arguments);
			}
		});

		//override array shift function
		self.origFuncs.shift = data.shift;

		Object.defineProperty(self.data, "shift", {
			enumerable: false,
			configurable: true,
			value: function value() {
				var row;

				if (!self.blocked && version === self.currentVersion) {
					if (self.data.length) {
						row = self.table.rowManager.getRowFromDataObject(self.data[0]);

						if (row) {
							row.deleteActual();
						}
					}
				}

				return self.origFuncs.shift.call(data);
			}
		});

		//override array pop function
		self.origFuncs.pop = data.pop;

		Object.defineProperty(self.data, "pop", {
			enumerable: false,
			configurable: true,
			value: function value() {
				var row;
				if (!self.blocked && version === self.currentVersion) {
					if (self.data.length) {
						row = self.table.rowManager.getRowFromDataObject(self.data[self.data.length - 1]);

						if (row) {
							row.deleteActual();
						}
					}
				}
				return self.origFuncs.pop.call(data);
			}
		});

		//override array splice function
		self.origFuncs.splice = data.splice;

		Object.defineProperty(self.data, "splice", {
			enumerable: false,
			configurable: true,
			value: function value() {
				var args = Array.from(arguments),
				    start = args[0] < 0 ? data.length + args[0] : args[0],
				    end = args[1],
				    newRows = args[2] ? args.slice(2) : false,
				    startRow;

				if (!self.blocked && version === self.currentVersion) {

					//add new rows
					if (newRows) {
						startRow = data[start] ? self.table.rowManager.getRowFromDataObject(data[start]) : false;

						if (startRow) {
							newRows.forEach(function (rowData) {
								self.table.rowManager.addRowActual(rowData, true, startRow, true);
							});
						} else {
							newRows = newRows.slice().reverse();

							newRows.forEach(function (rowData) {
								self.table.rowManager.addRowActual(rowData, true, false, true);
							});
						}
					}

					//delete removed rows
					if (end !== 0) {
						var oldRows = data.slice(start, typeof args[1] === "undefined" ? args[1] : start + end);

						oldRows.forEach(function (rowData, i) {
							var row = self.table.rowManager.getRowFromDataObject(rowData);

							if (row) {
								row.deleteActual(i !== oldRows.length - 1);
							}
						});
					}

					if (newRows || end !== 0) {
						self.table.rowManager.reRenderInPosition();
					}
				}

				return self.origFuncs.splice.apply(data, arguments);
			}
		});
	};

	ReactiveData.prototype.unwatchData = function () {
		if (this.data !== false) {
			for (var key in this.origFuncs) {
				Object.defineProperty(this.data, key, {
					enumerable: true,
					configurable: true,
					writable: true,
					value: this.origFuncs.key
				});
			}
		}
	};

	ReactiveData.prototype.watchRow = function (row) {
		var self = this,
		    data = row.getData();

		this.blocked = true;

		for (var key in data) {
			this.watchKey(row, data, key);
		}

		this.blocked = false;
	};

	ReactiveData.prototype.watchKey = function (row, data, key) {
		var self = this,
		    props = Object.getOwnPropertyDescriptor(data, key),
		    value = data[key],
		    version = this.currentVersion;

		Object.defineProperty(data, key, {
			set: function set(newValue) {
				value = newValue;
				if (!self.blocked && version === self.currentVersion) {
					var update = {};
					update[key] = newValue;
					row.updateData(update);
				}

				if (props.set) {
					props.set(newValue);
				}
			},
			get: function get() {

				if (props.get) {
					props.get();
				}

				return value;
			}
		});
	};

	ReactiveData.prototype.unwatchRow = function (row) {
		var data = row.getData();

		for (var key in data) {
			Object.defineProperty(data, key, {
				value: data[key]
			});
		}
	};

	ReactiveData.prototype.block = function () {
		this.blocked = true;
	};

	ReactiveData.prototype.unblock = function () {
		this.blocked = false;
	};

	Tabulator.prototype.registerModule("reactiveData", ReactiveData);

	var ResizeColumns = function ResizeColumns(table) {
		this.table = table; //hold Tabulator object
		this.startColumn = false;
		this.startX = false;
		this.startWidth = false;
		this.handle = null;
		this.prevHandle = null;
	};

	ResizeColumns.prototype.initializeColumn = function (type, column, element) {
		var self = this,
		    variableHeight = false,
		    mode = this.table.options.resizableColumns;

		//set column resize mode
		if (type === "header") {
			variableHeight = column.definition.formatter == "textarea" || column.definition.variableHeight;
			column.modules.resize = { variableHeight: variableHeight };
		}

		if (mode === true || mode == type) {

			var handle = document.createElement('div');
			handle.className = "tabulator-col-resize-handle";

			var prevHandle = document.createElement('div');
			prevHandle.className = "tabulator-col-resize-handle prev";

			handle.addEventListener("click", function (e) {
				e.stopPropagation();
			});

			var handleDown = function handleDown(e) {
				var nearestColumn = column.getLastColumn();

				if (nearestColumn && self._checkResizability(nearestColumn)) {
					self.startColumn = column;
					self._mouseDown(e, nearestColumn, handle);
				}
			};

			handle.addEventListener("mousedown", handleDown);
			handle.addEventListener("touchstart", handleDown, { passive: true });

			//reszie column on  double click
			handle.addEventListener("dblclick", function (e) {
				var col = column.getLastColumn();

				if (col && self._checkResizability(col)) {
					e.stopPropagation();
					col.reinitializeWidth(true);
				}
			});

			prevHandle.addEventListener("click", function (e) {
				e.stopPropagation();
			});

			var prevHandleDown = function prevHandleDown(e) {
				var nearestColumn, colIndex, prevColumn;

				nearestColumn = column.getFirstColumn();

				if (nearestColumn) {
					colIndex = self.table.columnManager.findColumnIndex(nearestColumn);
					prevColumn = colIndex > 0 ? self.table.columnManager.getColumnByIndex(colIndex - 1) : false;

					if (prevColumn && self._checkResizability(prevColumn)) {
						self.startColumn = column;
						self._mouseDown(e, prevColumn, prevHandle);
					}
				}
			};

			prevHandle.addEventListener("mousedown", prevHandleDown);
			prevHandle.addEventListener("touchstart", prevHandleDown, { passive: true });

			//resize column on double click
			prevHandle.addEventListener("dblclick", function (e) {
				var nearestColumn, colIndex, prevColumn;

				nearestColumn = column.getFirstColumn();

				if (nearestColumn) {
					colIndex = self.table.columnManager.findColumnIndex(nearestColumn);
					prevColumn = colIndex > 0 ? self.table.columnManager.getColumnByIndex(colIndex - 1) : false;

					if (prevColumn && self._checkResizability(prevColumn)) {
						e.stopPropagation();
						prevColumn.reinitializeWidth(true);
					}
				}
			});

			element.appendChild(handle);
			element.appendChild(prevHandle);
		}
	};

	ResizeColumns.prototype._checkResizability = function (column) {
		return typeof column.definition.resizable != "undefined" ? column.definition.resizable : this.table.options.resizableColumns;
	};

	ResizeColumns.prototype._mouseDown = function (e, column, handle) {
		var self = this;

		self.table.element.classList.add("tabulator-block-select");

		function mouseMove(e) {
			// self.table.columnManager.tempScrollBlock();

			column.setWidth(self.startWidth + ((typeof e.screenX === "undefined" ? e.touches[0].screenX : e.screenX) - self.startX));

			if (!self.table.browserSlow && column.modules.resize && column.modules.resize.variableHeight) {
				column.checkCellHeights();
			}
		}

		function mouseUp(e) {

			//block editor from taking action while resizing is taking place
			if (self.startColumn.modules.edit) {
				self.startColumn.modules.edit.blocked = false;
			}

			if (self.table.browserSlow && column.modules.resize && column.modules.resize.variableHeight) {
				column.checkCellHeights();
			}

			document.body.removeEventListener("mouseup", mouseUp);
			document.body.removeEventListener("mousemove", mouseMove);

			handle.removeEventListener("touchmove", mouseMove);
			handle.removeEventListener("touchend", mouseUp);

			self.table.element.classList.remove("tabulator-block-select");

			if (self.table.options.persistence && self.table.modExists("persistence", true) && self.table.modules.persistence.config.columns) {
				self.table.modules.persistence.save("columns");
			}

			self.table.options.columnResized.call(self.table, column.getComponent());
		}

		e.stopPropagation(); //prevent resize from interfereing with movable columns

		//block editor from taking action while resizing is taking place
		if (self.startColumn.modules.edit) {
			self.startColumn.modules.edit.blocked = true;
		}

		self.startX = typeof e.screenX === "undefined" ? e.touches[0].screenX : e.screenX;
		self.startWidth = column.getWidth();

		document.body.addEventListener("mousemove", mouseMove);
		document.body.addEventListener("mouseup", mouseUp);
		handle.addEventListener("touchmove", mouseMove, { passive: true });
		handle.addEventListener("touchend", mouseUp);
	};

	Tabulator.prototype.registerModule("resizeColumns", ResizeColumns);
	var ResizeRows = function ResizeRows(table) {
		this.table = table; //hold Tabulator object
		this.startColumn = false;
		this.startY = false;
		this.startHeight = false;
		this.handle = null;
		this.prevHandle = null;
	};

	ResizeRows.prototype.initializeRow = function (row) {
		var self = this,
		    rowEl = row.getElement();

		var handle = document.createElement('div');
		handle.className = "tabulator-row-resize-handle";

		var prevHandle = document.createElement('div');
		prevHandle.className = "tabulator-row-resize-handle prev";

		handle.addEventListener("click", function (e) {
			e.stopPropagation();
		});

		var handleDown = function handleDown(e) {
			self.startRow = row;
			self._mouseDown(e, row, handle);
		};

		handle.addEventListener("mousedown", handleDown);
		handle.addEventListener("touchstart", handleDown, { passive: true });

		prevHandle.addEventListener("click", function (e) {
			e.stopPropagation();
		});

		var prevHandleDown = function prevHandleDown(e) {
			var prevRow = self.table.rowManager.prevDisplayRow(row);

			if (prevRow) {
				self.startRow = prevRow;
				self._mouseDown(e, prevRow, prevHandle);
			}
		};

		prevHandle.addEventListener("mousedown", prevHandleDown);
		prevHandle.addEventListener("touchstart", prevHandleDown, { passive: true });

		rowEl.appendChild(handle);
		rowEl.appendChild(prevHandle);
	};

	ResizeRows.prototype._mouseDown = function (e, row, handle) {
		var self = this;

		self.table.element.classList.add("tabulator-block-select");

		function mouseMove(e) {
			row.setHeight(self.startHeight + ((typeof e.screenY === "undefined" ? e.touches[0].screenY : e.screenY) - self.startY));
		}

		function mouseUp(e) {

			// //block editor from taking action while resizing is taking place
			// if(self.startColumn.modules.edit){
			// 	self.startColumn.modules.edit.blocked = false;
			// }

			document.body.removeEventListener("mouseup", mouseMove);
			document.body.removeEventListener("mousemove", mouseMove);

			handle.removeEventListener("touchmove", mouseMove);
			handle.removeEventListener("touchend", mouseUp);

			self.table.element.classList.remove("tabulator-block-select");

			self.table.options.rowResized.call(this.table, row.getComponent());
		}

		e.stopPropagation(); //prevent resize from interfereing with movable columns

		//block editor from taking action while resizing is taking place
		// if(self.startColumn.modules.edit){
		// 	self.startColumn.modules.edit.blocked = true;
		// }

		self.startY = typeof e.screenY === "undefined" ? e.touches[0].screenY : e.screenY;
		self.startHeight = row.getHeight();

		document.body.addEventListener("mousemove", mouseMove);
		document.body.addEventListener("mouseup", mouseUp);

		handle.addEventListener("touchmove", mouseMove, { passive: true });
		handle.addEventListener("touchend", mouseUp);
	};

	Tabulator.prototype.registerModule("resizeRows", ResizeRows);
	var ResizeTable = function ResizeTable(table) {
		this.table = table; //hold Tabulator object
		this.binding = false;
		this.observer = false;
		this.containerObserver = false;

		this.tableHeight = 0;
		this.tableWidth = 0;
		this.containerHeight = 0;
		this.containerWidth = 0;

		this.autoResize = false;
	};

	ResizeTable.prototype.initialize = function (row) {
		var _this74 = this;

		var table = this.table,
		    tableStyle;

		this.tableHeight = table.element.clientHeight;
		this.tableWidth = table.element.clientWidth;

		if (table.element.parentNode) {
			this.containerHeight = table.element.parentNode.clientHeight;
			this.containerWidth = table.element.parentNode.clientWidth;
		}

		if (typeof ResizeObserver !== "undefined" && table.rowManager.getRenderMode() === "virtual") {

			this.autoResize = true;

			this.observer = new ResizeObserver(function (entry) {
				if (!table.browserMobile || table.browserMobile && !table.modules.edit.currentCell) {

					var nodeHeight = Math.floor(entry[0].contentRect.height);
					var nodeWidth = Math.floor(entry[0].contentRect.width);

					if (_this74.tableHeight != nodeHeight || _this74.tableWidth != nodeWidth) {
						_this74.tableHeight = nodeHeight;
						_this74.tableWidth = nodeWidth;

						if (table.element.parentNode) {
							_this74.containerHeight = table.element.parentNode.clientHeight;
							_this74.containerWidth = table.element.parentNode.clientWidth;
						}

						table.redraw();
					}
				}
			});

			this.observer.observe(table.element);

			tableStyle = window.getComputedStyle(table.element);

			if (this.table.element.parentNode && !this.table.rowManager.fixedHeight && (tableStyle.getPropertyValue("max-height") || tableStyle.getPropertyValue("min-height"))) {

				this.containerObserver = new ResizeObserver(function (entry) {
					if (!table.browserMobile || table.browserMobile && !table.modules.edit.currentCell) {

						var nodeHeight = Math.floor(entry[0].contentRect.height);
						var nodeWidth = Math.floor(entry[0].contentRect.width);

						if (_this74.containerHeight != nodeHeight || _this74.containerWidth != nodeWidth) {
							_this74.containerHeight = nodeHeight;
							_this74.containerWidth = nodeWidth;
							_this74.tableHeight = table.element.clientHeight;
							_this74.tableWidth = table.element.clientWidth;

							table.redraw();
						}

						table.redraw();
					}
				});

				this.containerObserver.observe(this.table.element.parentNode);
			}
		} else {
			this.binding = function () {
				if (!table.browserMobile || table.browserMobile && !table.modules.edit.currentCell) {
					table.redraw();
				}
			};

			window.addEventListener("resize", this.binding);
		}
	};

	ResizeTable.prototype.clearBindings = function (row) {
		if (this.binding) {
			window.removeEventListener("resize", this.binding);
		}

		if (this.observer) {
			this.observer.unobserve(this.table.element);
		}

		if (this.containerObserver) {
			this.containerObserver.unobserve(this.table.element.parentNode);
		}
	};

	Tabulator.prototype.registerModule("resizeTable", ResizeTable);
	var ResponsiveLayout = function ResponsiveLayout(table) {
		this.table = table; //hold Tabulator object
		this.columns = [];
		this.hiddenColumns = [];
		this.mode = "";
		this.index = 0;
		this.collapseFormatter = [];
		this.collapseStartOpen = true;
		this.collapseHandleColumn = false;
	};

	//generate resposive columns list
	ResponsiveLayout.prototype.initialize = function () {
		var self = this,
		    columns = [];

		this.mode = this.table.options.responsiveLayout;
		this.collapseFormatter = this.table.options.responsiveLayoutCollapseFormatter || this.formatCollapsedData;
		this.collapseStartOpen = this.table.options.responsiveLayoutCollapseStartOpen;
		this.hiddenColumns = [];

		//detemine level of responsivity for each column
		this.table.columnManager.columnsByIndex.forEach(function (column, i) {
			if (column.modules.responsive) {
				if (column.modules.responsive.order && column.modules.responsive.visible) {
					column.modules.responsive.index = i;
					columns.push(column);

					if (!column.visible && self.mode === "collapse") {
						self.hiddenColumns.push(column);
					}
				}
			}
		});

		//sort list by responsivity
		columns = columns.reverse();
		columns = columns.sort(function (a, b) {
			var diff = b.modules.responsive.order - a.modules.responsive.order;
			return diff || b.modules.responsive.index - a.modules.responsive.index;
		});

		this.columns = columns;

		if (this.mode === "collapse") {
			this.generateCollapsedContent();
		}

		//assign collapse column
		for (var _iterator = this.table.columnManager.columnsByIndex, _isArray = Array.isArray(_iterator), _i12 = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
			var _ref;

			if (_isArray) {
				if (_i12 >= _iterator.length) break;
				_ref = _iterator[_i12++];
			} else {
				_i12 = _iterator.next();
				if (_i12.done) break;
				_ref = _i12.value;
			}

			var col = _ref;

			if (col.definition.formatter == "responsiveCollapse") {
				this.collapseHandleColumn = col;
				break;
			}
		}

		if (this.collapseHandleColumn) {
			if (this.hiddenColumns.length) {
				this.collapseHandleColumn.show();
			} else {
				this.collapseHandleColumn.hide();
			}
		}
	};

	//define layout information
	ResponsiveLayout.prototype.initializeColumn = function (column) {
		var def = column.getDefinition();

		column.modules.responsive = { order: typeof def.responsive === "undefined" ? 1 : def.responsive, visible: def.visible === false ? false : true };
	};

	ResponsiveLayout.prototype.initializeRow = function (row) {
		var el;

		if (row.type !== "calc") {
			el = document.createElement("div");
			el.classList.add("tabulator-responsive-collapse");

			row.modules.responsiveLayout = {
				element: el,
				open: this.collapseStartOpen
			};

			if (!this.collapseStartOpen) {
				el.style.display = 'none';
			}
		}
	};

	ResponsiveLayout.prototype.layoutRow = function (row) {
		var rowEl = row.getElement();

		if (row.modules.responsiveLayout) {
			rowEl.appendChild(row.modules.responsiveLayout.element);
			this.generateCollapsedRowContent(row);
		}
	};

	//update column visibility
	ResponsiveLayout.prototype.updateColumnVisibility = function (column, visible) {
		var index;
		if (column.modules.responsive) {
			column.modules.responsive.visible = visible;
			this.initialize();
		}
	};

	ResponsiveLayout.prototype.hideColumn = function (column) {
		var colCount = this.hiddenColumns.length;

		column.hide(false, true);

		if (this.mode === "collapse") {
			this.hiddenColumns.unshift(column);
			this.generateCollapsedContent();

			if (this.collapseHandleColumn && !colCount) {
				this.collapseHandleColumn.show();
			}
		}
	};

	ResponsiveLayout.prototype.showColumn = function (column) {
		var index;

		column.show(false, true);
		//set column width to prevent calculation loops on uninitialized columns
		column.setWidth(column.getWidth());

		if (this.mode === "collapse") {
			index = this.hiddenColumns.indexOf(column);

			if (index > -1) {
				this.hiddenColumns.splice(index, 1);
			}

			this.generateCollapsedContent();

			if (this.collapseHandleColumn && !this.hiddenColumns.length) {
				this.collapseHandleColumn.hide();
			}
		}
	};

	//redraw columns to fit space
	ResponsiveLayout.prototype.update = function () {
		var self = this,
		    working = true;

		while (working) {

			var width = self.table.modules.layout.getMode() == "fitColumns" ? self.table.columnManager.getFlexBaseWidth() : self.table.columnManager.getWidth();

			var diff = (self.table.options.headerVisible ? self.table.columnManager.element.clientWidth : self.table.element.clientWidth) - width;

			if (diff < 0) {
				//table is too wide
				var column = self.columns[self.index];

				if (column) {
					self.hideColumn(column);
					self.index++;
				} else {
					working = false;
				}
			} else {

				//table has spare space
				var _column = self.columns[self.index - 1];

				if (_column) {
					if (diff > 0) {
						if (diff >= _column.getWidth()) {
							self.showColumn(_column);
							self.index--;
						} else {
							working = false;
						}
					} else {
						working = false;
					}
				} else {
					working = false;
				}
			}

			if (!self.table.rowManager.activeRowsCount) {
				self.table.rowManager.renderEmptyScroll();
			}
		}
	};

	ResponsiveLayout.prototype.generateCollapsedContent = function () {
		var self = this,
		    rows = this.table.rowManager.getDisplayRows();

		rows.forEach(function (row) {
			self.generateCollapsedRowContent(row);
		});
	};

	ResponsiveLayout.prototype.generateCollapsedRowContent = function (row) {
		var el, contents;

		if (row.modules.responsiveLayout) {
			el = row.modules.responsiveLayout.element;

			while (el.firstChild) {
				el.removeChild(el.firstChild);
			}contents = this.collapseFormatter(this.generateCollapsedRowData(row));
			if (contents) {
				el.appendChild(contents);
			}
		}
	};

	ResponsiveLayout.prototype.generateCollapsedRowData = function (row) {
		var self = this,
		    data = row.getData(),
		    output = [],
		    mockCellComponent;

		this.hiddenColumns.forEach(function (column) {
			var value = column.getFieldValue(data);

			if (column.definition.title && column.field) {
				if (column.modules.format && self.table.options.responsiveLayoutCollapseUseFormatters) {

					mockCellComponent = {
						value: false,
						data: {},
						getValue: function getValue() {
							return value;
						},
						getData: function getData() {
							return data;
						},
						getElement: function getElement() {
							return document.createElement("div");
						},
						getRow: function getRow() {
							return row.getComponent();
						},
						getColumn: function getColumn() {
							return column.getComponent();
						}
					};

					output.push({
						title: column.definition.title,
						value: column.modules.format.formatter.call(self.table.modules.format, mockCellComponent, column.modules.format.params)
					});
				} else {
					output.push({
						title: column.definition.title,
						value: value
					});
				}
			}
		});

		return output;
	};

	ResponsiveLayout.prototype.formatCollapsedData = function (data) {
		var list = document.createElement("table"),
		    listContents = "";

		data.forEach(function (item) {
			var div = document.createElement("div");

			if (item.value instanceof Node) {
				div.appendChild(item.value);
				item.value = div.innerHTML;
			}

			listContents += "<tr><td><strong>" + item.title + "</strong></td><td>" + item.value + "</td></tr>";
		});

		list.innerHTML = listContents;

		return Object.keys(data).length ? list : "";
	};

	Tabulator.prototype.registerModule("responsiveLayout", ResponsiveLayout);

	var SelectRow = function SelectRow(table) {
		this.table = table; //hold Tabulator object
		this.selecting = false; //flag selecting in progress
		this.lastClickedRow = false; //last clicked row
		this.selectPrev = []; //hold previously selected element for drag drop selection
		this.selectedRows = []; //hold selected rows
		this.headerCheckboxElement = null; // hold header select element
	};

	SelectRow.prototype.clearSelectionData = function (silent) {
		this.selecting = false;
		this.lastClickedRow = false;
		this.selectPrev = [];
		this.selectedRows = [];

		if (!silent) {
			this._rowSelectionChanged();
		}
	};

	SelectRow.prototype.initializeRow = function (row) {
		var self = this,
		    element = row.getElement();

		// trigger end of row selection
		var endSelect = function endSelect() {

			setTimeout(function () {
				self.selecting = false;
			}, 50);

			document.body.removeEventListener("mouseup", endSelect);
		};

		row.modules.select = { selected: false };

		//set row selection class
		if (self.table.options.selectableCheck.call(this.table, row.getComponent())) {
			element.classList.add("tabulator-selectable");
			element.classList.remove("tabulator-unselectable");

			if (self.table.options.selectable && self.table.options.selectable != "highlight") {
				if (self.table.options.selectableRangeMode === "click") {
					element.addEventListener("click", function (e) {
						if (e.shiftKey) {
							self.table._clearSelection();
							self.lastClickedRow = self.lastClickedRow || row;

							var lastClickedRowIdx = self.table.rowManager.getDisplayRowIndex(self.lastClickedRow);
							var rowIdx = self.table.rowManager.getDisplayRowIndex(row);

							var fromRowIdx = lastClickedRowIdx <= rowIdx ? lastClickedRowIdx : rowIdx;
							var toRowIdx = lastClickedRowIdx >= rowIdx ? lastClickedRowIdx : rowIdx;

							var rows = self.table.rowManager.getDisplayRows().slice(0);
							var toggledRows = rows.splice(fromRowIdx, toRowIdx - fromRowIdx + 1);

							if (e.ctrlKey || e.metaKey) {
								toggledRows.forEach(function (toggledRow) {
									if (toggledRow !== self.lastClickedRow) {

										if (self.table.options.selectable !== true && !self.isRowSelected(row)) {
											if (self.selectedRows.length < self.table.options.selectable) {
												self.toggleRow(toggledRow);
											}
										} else {
											self.toggleRow(toggledRow);
										}
									}
								});
								self.lastClickedRow = row;
							} else {
								self.deselectRows(undefined, true);

								if (self.table.options.selectable !== true) {
									if (toggledRows.length > self.table.options.selectable) {
										toggledRows = toggledRows.slice(0, self.table.options.selectable);
									}
								}

								self.selectRows(toggledRows);
							}
							self.table._clearSelection();
						} else if (e.ctrlKey || e.metaKey) {
							self.toggleRow(row);
							self.lastClickedRow = row;
						} else {
							self.deselectRows(undefined, true);
							self.selectRows(row);
							self.lastClickedRow = row;
						}
					});
				} else {
					element.addEventListener("click", function (e) {
						if (!self.table.modExists("edit") || !self.table.modules.edit.getCurrentCell()) {
							self.table._clearSelection();
						}

						if (!self.selecting) {
							self.toggleRow(row);
						}
					});

					element.addEventListener("mousedown", function (e) {
						if (e.shiftKey) {
							self.table._clearSelection();

							self.selecting = true;

							self.selectPrev = [];

							document.body.addEventListener("mouseup", endSelect);
							document.body.addEventListener("keyup", endSelect);

							self.toggleRow(row);

							return false;
						}
					});

					element.addEventListener("mouseenter", function (e) {
						if (self.selecting) {
							self.table._clearSelection();
							self.toggleRow(row);

							if (self.selectPrev[1] == row) {
								self.toggleRow(self.selectPrev[0]);
							}
						}
					});

					element.addEventListener("mouseout", function (e) {
						if (self.selecting) {
							self.table._clearSelection();
							self.selectPrev.unshift(row);
						}
					});
				}
			}
		} else {
			element.classList.add("tabulator-unselectable");
			element.classList.remove("tabulator-selectable");
		}
	};

	//toggle row selection
	SelectRow.prototype.toggleRow = function (row) {
		if (this.table.options.selectableCheck.call(this.table, row.getComponent())) {
			if (row.modules.select && row.modules.select.selected) {
				this._deselectRow(row);
			} else {
				this._selectRow(row);
			}
		}
	};

	//select a number of rows
	SelectRow.prototype.selectRows = function (rows) {
		var _this75 = this;

		var rowMatch;

		switch (typeof rows === 'undefined' ? 'undefined' : _typeof(rows)) {
			case "undefined":
				this.table.rowManager.rows.forEach(function (row) {
					_this75._selectRow(row, true, true);
				});

				this._rowSelectionChanged();
				break;

			case "string":

				rowMatch = this.table.rowManager.findRow(rows);

				if (rowMatch) {
					this._selectRow(rowMatch, true, true);
				} else {
					this.table.rowManager.getRows(rows).forEach(function (row) {
						_this75._selectRow(row, true, true);
					});
				}

				this._rowSelectionChanged();
				break;

			default:
				if (Array.isArray(rows)) {
					rows.forEach(function (row) {
						_this75._selectRow(row, true, true);
					});

					this._rowSelectionChanged();
				} else {
					this._selectRow(rows, false, true);
				}
				break;
		}
	};

	//select an individual row
	SelectRow.prototype._selectRow = function (rowInfo, silent, force) {
		var index;

		//handle max row count
		if (!isNaN(this.table.options.selectable) && this.table.options.selectable !== true && !force) {
			if (this.selectedRows.length >= this.table.options.selectable) {
				if (this.table.options.selectableRollingSelection) {
					this._deselectRow(this.selectedRows[0]);
				} else {
					return false;
				}
			}
		}

		var row = this.table.rowManager.findRow(rowInfo);

		if (row) {
			if (this.selectedRows.indexOf(row) == -1) {
				if (!row.modules.select) {
					row.modules.select = {};
				}

				row.modules.select.selected = true;
				if (row.modules.select.checkboxEl) {
					row.modules.select.checkboxEl.checked = true;
				}
				row.getElement().classList.add("tabulator-selected");

				this.selectedRows.push(row);

				if (this.table.options.dataTreeSelectPropagate) {
					this.childRowSelection(row, true);
				}

				if (!silent) {
					this.table.options.rowSelected.call(this.table, row.getComponent());
				}

				this._rowSelectionChanged(silent);
			}
		} else {
			if (!silent) {
				console.warn("Selection Error - No such row found, ignoring selection:" + rowInfo);
			}
		}
	};

	SelectRow.prototype.isRowSelected = function (row) {
		return this.selectedRows.indexOf(row) !== -1;
	};

	//deselect a number of rows
	SelectRow.prototype.deselectRows = function (rows, silent) {
		var self = this,
		    rowCount;

		if (typeof rows == "undefined") {

			rowCount = self.selectedRows.length;

			for (var _i13 = 0; _i13 < rowCount; _i13++) {
				self._deselectRow(self.selectedRows[0], true);
			}

			self._rowSelectionChanged(silent);
		} else {
			if (Array.isArray(rows)) {
				rows.forEach(function (row) {
					self._deselectRow(row, true);
				});

				self._rowSelectionChanged(silent);
			} else {
				self._deselectRow(rows, silent);
			}
		}
	};

	//deselect an individual row
	SelectRow.prototype._deselectRow = function (rowInfo, silent) {
		var self = this,
		    row = self.table.rowManager.findRow(rowInfo),
		    index;

		if (row) {
			index = self.selectedRows.findIndex(function (selectedRow) {
				return selectedRow == row;
			});

			if (index > -1) {

				if (!row.modules.select) {
					row.modules.select = {};
				}

				row.modules.select.selected = false;
				if (row.modules.select.checkboxEl) {
					row.modules.select.checkboxEl.checked = false;
				}
				row.getElement().classList.remove("tabulator-selected");
				self.selectedRows.splice(index, 1);

				if (this.table.options.dataTreeSelectPropagate) {
					this.childRowSelection(row, false);
				}

				if (!silent) {
					self.table.options.rowDeselected.call(this.table, row.getComponent());
				}

				self._rowSelectionChanged(silent);
			}
		} else {
			if (!silent) {
				console.warn("Deselection Error - No such row found, ignoring selection:" + rowInfo);
			}
		}
	};

	SelectRow.prototype.getSelectedData = function () {
		var data = [];

		this.selectedRows.forEach(function (row) {
			data.push(row.getData());
		});

		return data;
	};

	SelectRow.prototype.getSelectedRows = function () {

		var rows = [];

		this.selectedRows.forEach(function (row) {
			rows.push(row.getComponent());
		});

		return rows;
	};

	SelectRow.prototype._rowSelectionChanged = function (silent) {
		if (this.headerCheckboxElement) {
			if (this.selectedRows.length === 0) {
				this.headerCheckboxElement.checked = false;
				this.headerCheckboxElement.indeterminate = false;
			} else if (this.table.rowManager.rows.length === this.selectedRows.length) {
				this.headerCheckboxElement.checked = true;
				this.headerCheckboxElement.indeterminate = false;
			} else {
				this.headerCheckboxElement.indeterminate = true;
				this.headerCheckboxElement.checked = false;
			}
		}

		if (!silent) {
			this.table.options.rowSelectionChanged.call(this.table, this.getSelectedData(), this.getSelectedRows());
		}
	};

	SelectRow.prototype.registerRowSelectCheckbox = function (row, element) {
		if (!row._row.modules.select) {
			row._row.modules.select = {};
		}

		row._row.modules.select.checkboxEl = element;
	};

	SelectRow.prototype.registerHeaderSelectCheckbox = function (element) {
		this.headerCheckboxElement = element;
	};

	SelectRow.prototype.childRowSelection = function (row, select) {
		var children = this.table.modules.dataTree.getChildren(row);

		if (select) {
			for (var _iterator2 = children, _isArray2 = Array.isArray(_iterator2), _i14 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {
				var _ref2;

				if (_isArray2) {
					if (_i14 >= _iterator2.length) break;
					_ref2 = _iterator2[_i14++];
				} else {
					_i14 = _iterator2.next();
					if (_i14.done) break;
					_ref2 = _i14.value;
				}

				var child = _ref2;

				this._selectRow(child, true);
			}
		} else {
			for (var _iterator3 = children, _isArray3 = Array.isArray(_iterator3), _i15 = 0, _iterator3 = _isArray3 ? _iterator3 : _iterator3[Symbol.iterator]();;) {
				var _ref3;

				if (_isArray3) {
					if (_i15 >= _iterator3.length) break;
					_ref3 = _iterator3[_i15++];
				} else {
					_i15 = _iterator3.next();
					if (_i15.done) break;
					_ref3 = _i15.value;
				}

				var _child = _ref3;

				this._deselectRow(_child, true);
			}
		}
	};

	Tabulator.prototype.registerModule("selectRow", SelectRow);

	var Sort = function Sort(table) {
		this.table = table; //hold Tabulator object
		this.sortList = []; //holder current sort
		this.changed = false; //has the sort changed since last render
	};

	//initialize column header for sorting
	Sort.prototype.initializeColumn = function (column, content) {
		var self = this,
		    sorter = false,
		    colEl,
		    arrowEl;

		switch (_typeof(column.definition.sorter)) {
			case "string":
				if (self.sorters[column.definition.sorter]) {
					sorter = self.sorters[column.definition.sorter];
				} else {
					console.warn("Sort Error - No such sorter found: ", column.definition.sorter);
				}
				break;

			case "function":
				sorter = column.definition.sorter;
				break;
		}

		column.modules.sort = {
			sorter: sorter, dir: "none",
			params: column.definition.sorterParams || {},
			startingDir: column.definition.headerSortStartingDir || "asc",
			tristate: typeof column.definition.headerSortTristate !== "undefined" ? column.definition.headerSortTristate : this.table.options.headerSortTristate
		};

		if (typeof column.definition.headerSort === "undefined" ? this.table.options.headerSort !== false : column.definition.headerSort !== false) {

			colEl = column.getElement();

			colEl.classList.add("tabulator-sortable");

			arrowEl = document.createElement("div");
			arrowEl.classList.add("tabulator-arrow");
			//create sorter arrow
			content.appendChild(arrowEl);

			//sort on click
			colEl.addEventListener("click", function (e) {
				var dir = "",
				    sorters = [],
				    match = false;

				if (column.modules.sort) {
					if (column.modules.sort.tristate) {
						if (column.modules.sort.dir == "none") {
							dir = column.modules.sort.startingDir;
						} else {
							if (column.modules.sort.dir == column.modules.sort.startingDir) {
								dir = column.modules.sort.dir == "asc" ? "desc" : "asc";
							} else {
								dir = "none";
							}
						}
					} else {
						switch (column.modules.sort.dir) {
							case "asc":
								dir = "desc";
								break;

							case "desc":
								dir = "asc";
								break;

							default:
								dir = column.modules.sort.startingDir;
						}
					}

					if (self.table.options.columnHeaderSortMulti && (e.shiftKey || e.ctrlKey)) {
						sorters = self.getSort();

						match = sorters.findIndex(function (sorter) {
							return sorter.field === column.getField();
						});

						if (match > -1) {
							sorters[match].dir = dir;

							if (match != sorters.length - 1) {
								match = sorters.splice(match, 1)[0];
								if (dir != "none") {
									sorters.push(match);
								}
							}
						} else {
							if (dir != "none") {
								sorters.push({ column: column, dir: dir });
							}
						}

						//add to existing sort
						self.setSort(sorters);
					} else {
						if (dir == "none") {
							self.clear();
						} else {
							//sort by column only
							self.setSort(column, dir);
						}
					}

					self.table.rowManager.sorterRefresh(!self.sortList.length);
				}
			});
		}
	};

	//check if the sorters have changed since last use
	Sort.prototype.hasChanged = function () {
		var changed = this.changed;
		this.changed = false;
		return changed;
	};

	//return current sorters
	Sort.prototype.getSort = function () {
		var self = this,
		    sorters = [];

		self.sortList.forEach(function (item) {
			if (item.column) {
				sorters.push({ column: item.column.getComponent(), field: item.column.getField(), dir: item.dir });
			}
		});

		return sorters;
	};

	//change sort list and trigger sort
	Sort.prototype.setSort = function (sortList, dir) {
		var self = this,
		    newSortList = [];

		if (!Array.isArray(sortList)) {
			sortList = [{ column: sortList, dir: dir }];
		}

		sortList.forEach(function (item) {
			var column;

			column = self.table.columnManager.findColumn(item.column);

			if (column) {
				item.column = column;
				newSortList.push(item);
				self.changed = true;
			} else {
				console.warn("Sort Warning - Sort field does not exist and is being ignored: ", item.column);
			}
		});

		self.sortList = newSortList;

		if (this.table.options.persistence && this.table.modExists("persistence", true) && this.table.modules.persistence.config.sort) {
			this.table.modules.persistence.save("sort");
		}
	};

	//clear sorters
	Sort.prototype.clear = function () {
		this.setSort([]);
	};

	//find appropriate sorter for column
	Sort.prototype.findSorter = function (column) {
		var row = this.table.rowManager.activeRows[0],
		    sorter = "string",
		    field,
		    value;

		if (row) {
			row = row.getData();
			field = column.getField();

			if (field) {

				value = column.getFieldValue(row);

				switch (typeof value === 'undefined' ? 'undefined' : _typeof(value)) {
					case "undefined":
						sorter = "string";
						break;

					case "boolean":
						sorter = "boolean";
						break;

					default:
						if (!isNaN(value) && value !== "") {
							sorter = "number";
						} else {
							if (value.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)) {
								sorter = "alphanum";
							}
						}
						break;
				}
			}
		}

		return this.sorters[sorter];
	};

	//work through sort list sorting data
	Sort.prototype.sort = function (data) {
		var self = this,
		    sortList = this.table.options.sortOrderReverse ? self.sortList.slice().reverse() : self.sortList,
		    sortListActual = [],
		    rowComponents = [],
		    lastSort;

		if (self.table.options.dataSorting) {
			self.table.options.dataSorting.call(self.table, self.getSort());
		}

		self.clearColumnHeaders();

		if (!self.table.options.ajaxSorting) {

			//build list of valid sorters and trigger column specific callbacks before sort begins
			sortList.forEach(function (item, i) {
				var sortObj = item.column.modules.sort;

				if (item.column && sortObj) {

					//if no sorter has been defined, take a guess
					if (!sortObj.sorter) {
						sortObj.sorter = self.findSorter(item.column);
					}

					item.params = typeof sortObj.params === "function" ? sortObj.params(item.column.getComponent(), item.dir) : sortObj.params;

					sortListActual.push(item);
				}

				self.setColumnHeader(item.column, item.dir);
			});

			//sort data
			if (sortListActual.length) {
				self._sortItems(data, sortListActual);
			}
		} else {
			sortList.forEach(function (item, i) {
				self.setColumnHeader(item.column, item.dir);
			});
		}

		if (self.table.options.dataSorted) {
			data.forEach(function (row) {
				rowComponents.push(row.getComponent());
			});

			self.table.options.dataSorted.call(self.table, self.getSort(), rowComponents);
		}
	};

	//clear sort arrows on columns
	Sort.prototype.clearColumnHeaders = function () {
		this.table.columnManager.getRealColumns().forEach(function (column) {
			if (column.modules.sort) {
				column.modules.sort.dir = "none";
				column.getElement().setAttribute("aria-sort", "none");
			}
		});
	};

	//set the column header sort direction
	Sort.prototype.setColumnHeader = function (column, dir) {
		column.modules.sort.dir = dir;
		column.getElement().setAttribute("aria-sort", dir);
	};

	//sort each item in sort list
	Sort.prototype._sortItems = function (data, sortList) {
		var _this76 = this;

		var sorterCount = sortList.length - 1;

		data.sort(function (a, b) {
			var result;

			for (var i = sorterCount; i >= 0; i--) {
				var sortItem = sortList[i];

				result = _this76._sortRow(a, b, sortItem.column, sortItem.dir, sortItem.params);

				if (result !== 0) {
					break;
				}
			}

			return result;
		});
	};

	//process individual rows for a sort function on active data
	Sort.prototype._sortRow = function (a, b, column, dir, params) {
		var el1Comp, el2Comp, colComp;

		//switch elements depending on search direction
		var el1 = dir == "asc" ? a : b;
		var el2 = dir == "asc" ? b : a;

		a = column.getFieldValue(el1.getData());
		b = column.getFieldValue(el2.getData());

		a = typeof a !== "undefined" ? a : "";
		b = typeof b !== "undefined" ? b : "";

		el1Comp = el1.getComponent();
		el2Comp = el2.getComponent();

		return column.modules.sort.sorter.call(this, a, b, el1Comp, el2Comp, column.getComponent(), dir, params);
	};

	//default data sorters
	Sort.prototype.sorters = {

		//sort numbers
		number: function number(a, b, aRow, bRow, column, dir, params) {
			var alignEmptyValues = params.alignEmptyValues;
			var decimal = params.decimalSeparator || ".";
			var thousand = params.thousandSeparator || ",";
			var emptyAlign = 0;

			a = parseFloat(String(a).split(thousand).join("").split(decimal).join("."));
			b = parseFloat(String(b).split(thousand).join("").split(decimal).join("."));

			//handle non numeric values
			if (isNaN(a)) {
				emptyAlign = isNaN(b) ? 0 : -1;
			} else if (isNaN(b)) {
				emptyAlign = 1;
			} else {
				//compare valid values
				return a - b;
			}

			//fix empty values in position
			if (alignEmptyValues === "top" && dir === "desc" || alignEmptyValues === "bottom" && dir === "asc") {
				emptyAlign *= -1;
			}

			return emptyAlign;
		},

		//sort strings
		string: function string(a, b, aRow, bRow, column, dir, params) {
			var alignEmptyValues = params.alignEmptyValues;
			var emptyAlign = 0;
			var locale;

			//handle empty values
			if (!a) {
				emptyAlign = !b ? 0 : -1;
			} else if (!b) {
				emptyAlign = 1;
			} else {
				//compare valid values
				switch (_typeof(params.locale)) {
					case "boolean":
						if (params.locale) {
							locale = this.table.modules.localize.getLocale();
						}
						break;
					case "string":
						locale = params.locale;
						break;
				}

				return String(a).toLowerCase().localeCompare(String(b).toLowerCase(), locale);
			}

			//fix empty values in position
			if (alignEmptyValues === "top" && dir === "desc" || alignEmptyValues === "bottom" && dir === "asc") {
				emptyAlign *= -1;
			}

			return emptyAlign;
		},

		//sort date
		date: function date(a, b, aRow, bRow, column, dir, params) {
			if (!params.format) {
				params.format = "DD/MM/YYYY";
			}

			return this.sorters.datetime.call(this, a, b, aRow, bRow, column, dir, params);
		},

		//sort HH:mm formatted times
		time: function time(a, b, aRow, bRow, column, dir, params) {
			if (!params.format) {
				params.format = "HH:mm";
			}

			return this.sorters.datetime.call(this, a, b, aRow, bRow, column, dir, params);
		},

		//sort datetime
		datetime: function datetime(a, b, aRow, bRow, column, dir, params) {
			var format = params.format || "DD/MM/YYYY HH:mm:ss",
			    alignEmptyValues = params.alignEmptyValues,
			    emptyAlign = 0;

			if (typeof moment != "undefined") {
				a = moment(a, format);
				b = moment(b, format);

				if (!a.isValid()) {
					emptyAlign = !b.isValid() ? 0 : -1;
				} else if (!b.isValid()) {
					emptyAlign = 1;
				} else {
					//compare valid values
					return a - b;
				}

				//fix empty values in position
				if (alignEmptyValues === "top" && dir === "desc" || alignEmptyValues === "bottom" && dir === "asc") {
					emptyAlign *= -1;
				}

				return emptyAlign;
			} else {
				console.error("Sort Error - 'datetime' sorter is dependant on moment.js");
			}
		},

		//sort booleans
		boolean: function boolean(a, b, aRow, bRow, column, dir, params) {
			var el1 = a === true || a === "true" || a === "True" || a === 1 ? 1 : 0;
			var el2 = b === true || b === "true" || b === "True" || b === 1 ? 1 : 0;

			return el1 - el2;
		},

		//sort if element contains any data
		array: function array(a, b, aRow, bRow, column, dir, params) {
			var el1 = 0;
			var el2 = 0;
			var type = params.type || "length";
			var alignEmptyValues = params.alignEmptyValues;
			var emptyAlign = 0;

			function calc(value) {

				switch (type) {
					case "length":
						return value.length;
						break;

					case "sum":
						return value.reduce(function (c, d) {
							return c + d;
						});
						break;

					case "max":
						return Math.max.apply(null, value);
						break;

					case "min":
						return Math.min.apply(null, value);
						break;

					case "avg":
						return value.reduce(function (c, d) {
							return c + d;
						}) / value.length;
						break;
				}
			}

			//handle non array values
			if (!Array.isArray(a)) {
				alignEmptyValues = !Array.isArray(b) ? 0 : -1;
			} else if (!Array.isArray(b)) {
				alignEmptyValues = 1;
			} else {

				//compare valid values
				el1 = a ? calc(a) : 0;
				el2 = b ? calc(b) : 0;

				return el1 - el2;
			}

			//fix empty values in position
			if (alignEmptyValues === "top" && dir === "desc" || alignEmptyValues === "bottom" && dir === "asc") {
				emptyAlign *= -1;
			}

			return emptyAlign;
		},

		//sort if element contains any data
		exists: function exists(a, b, aRow, bRow, column, dir, params) {
			var el1 = typeof a == "undefined" ? 0 : 1;
			var el2 = typeof b == "undefined" ? 0 : 1;

			return el1 - el2;
		},

		//sort alpha numeric strings
		alphanum: function alphanum(as, bs, aRow, bRow, column, dir, params) {
			var a,
			    b,
			    a1,
			    b1,
			    i = 0,
			    L,
			    rx = /(\d+)|(\D+)/g,
			    rd = /\d/;
			var alignEmptyValues = params.alignEmptyValues;
			var emptyAlign = 0;

			//handle empty values
			if (!as && as !== 0) {
				emptyAlign = !bs && bs !== 0 ? 0 : -1;
			} else if (!bs && bs !== 0) {
				emptyAlign = 1;
			} else {

				if (isFinite(as) && isFinite(bs)) return as - bs;
				a = String(as).toLowerCase();
				b = String(bs).toLowerCase();
				if (a === b) return 0;
				if (!(rd.test(a) && rd.test(b))) return a > b ? 1 : -1;
				a = a.match(rx);
				b = b.match(rx);
				L = a.length > b.length ? b.length : a.length;
				while (i < L) {
					a1 = a[i];
					b1 = b[i++];
					if (a1 !== b1) {
						if (isFinite(a1) && isFinite(b1)) {
							if (a1.charAt(0) === "0") a1 = "." + a1;
							if (b1.charAt(0) === "0") b1 = "." + b1;
							return a1 - b1;
						} else return a1 > b1 ? 1 : -1;
					}
				}

				return a.length > b.length;
			}

			//fix empty values in position
			if (alignEmptyValues === "top" && dir === "desc" || alignEmptyValues === "bottom" && dir === "asc") {
				emptyAlign *= -1;
			}

			return emptyAlign;
		}
	};

	Tabulator.prototype.registerModule("sort", Sort);

	var Validate = function Validate(table) {
		this.table = table;
		this.invalidCells = [];
	};

	//validate
	Validate.prototype.initializeColumn = function (column) {
		var self = this,
		    config = [],
		    validator;

		if (column.definition.validator) {

			if (Array.isArray(column.definition.validator)) {
				column.definition.validator.forEach(function (item) {
					validator = self._extractValidator(item);

					if (validator) {
						config.push(validator);
					}
				});
			} else {
				validator = this._extractValidator(column.definition.validator);

				if (validator) {
					config.push(validator);
				}
			}

			column.modules.validate = config.length ? config : false;
		}
	};

	Validate.prototype._extractValidator = function (value) {
		var type, params, pos;

		switch (typeof value === 'undefined' ? 'undefined' : _typeof(value)) {
			case "string":
				pos = value.indexOf(':');

				if (pos > -1) {
					type = value.substring(0, pos);
					params = value.substring(pos + 1);
				} else {
					type = value;
				}

				return this._buildValidator(type, params);
				break;

			case "function":
				return this._buildValidator(value);
				break;

			case "object":
				return this._buildValidator(value.type, value.parameters);
				break;
		}
	};

	Validate.prototype._buildValidator = function (type, params) {

		var func = typeof type == "function" ? type : this.validators[type];

		if (!func) {
			console.warn("Validator Setup Error - No matching validator found:", type);
			return false;
		} else {
			return {
				type: typeof type == "function" ? "function" : type,
				func: func,
				params: params
			};
		}
	};

	Validate.prototype.validate = function (validators, cell, value) {
		var self = this,
		    valid = [],
		    invalidIndex = this.invalidCells.indexOf(cell);

		if (validators) {
			validators.forEach(function (item) {
				if (!item.func.call(self, cell.getComponent(), value, item.params)) {
					valid.push({
						type: item.type,
						parameters: item.params
					});
				}
			});
		}

		valid = valid.length ? valid : true;

		if (!cell.modules.validate) {
			cell.modules.validate = {};
		}

		if (valid === true) {
			cell.modules.validate.invalid = false;
			cell.getElement().classList.remove("tabulator-validation-fail");

			if (invalidIndex > -1) {
				this.invalidCells.splice(invalidIndex, 1);
			}
		} else {
			cell.modules.validate.invalid = true;

			if (this.table.options.validationMode !== "manual") {
				cell.getElement().classList.add("tabulator-validation-fail");
			}

			if (invalidIndex == -1) {
				this.invalidCells.push(cell);
			}
		}

		return valid;
	};

	Validate.prototype.getInvalidCells = function () {
		var output = [];

		this.invalidCells.forEach(function (cell) {
			output.push(cell.getComponent());
		});

		return output;
	};

	Validate.prototype.clearValidation = function (cell) {
		var invalidIndex;

		if (cell.modules.validate && cell.modules.validate.invalid) {

			cell.element.classList.remove("tabulator-validation-fail");
			cell.modules.validate.invalid = false;

			invalidIndex = this.invalidCells.indexOf(cell);

			if (invalidIndex > -1) {
				this.invalidCells.splice(invalidIndex, 1);
			}
		}
	};

	Validate.prototype.validators = {

		//is integer
		integer: function integer(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			value = Number(value);
			return typeof value === 'number' && isFinite(value) && Math.floor(value) === value;
		},

		//is float
		float: function float(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			value = Number(value);
			return typeof value === 'number' && isFinite(value) && value % 1 !== 0;
		},

		//must be a number
		numeric: function numeric(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			return !isNaN(value);
		},

		//must be a string
		string: function string(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			return isNaN(value);
		},

		//maximum value
		max: function max(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			return parseFloat(value) <= parameters;
		},

		//minimum value
		min: function min(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			return parseFloat(value) >= parameters;
		},

		//starts with  value
		starts: function starts(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			return String(value).toLowerCase().startsWith(String(parameters).toLowerCase());
		},

		//ends with  value
		ends: function ends(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			return String(value).toLowerCase().endsWith(String(parameters).toLowerCase());
		},

		//minimum string length
		minLength: function minLength(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			return String(value).length >= parameters;
		},

		//maximum string length
		maxLength: function maxLength(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			return String(value).length <= parameters;
		},

		//in provided value list
		in: function _in(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			if (typeof parameters == "string") {
				parameters = parameters.split("|");
			}

			return value === "" || parameters.indexOf(value) > -1;
		},

		//must match provided regex
		regex: function regex(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			var reg = new RegExp(parameters);

			return reg.test(value);
		},

		//value must be unique in this column
		unique: function unique(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			var unique = true;

			var cellData = cell.getData();
			var column = cell.getColumn()._getSelf();

			this.table.rowManager.rows.forEach(function (row) {
				var data = row.getData();

				if (data !== cellData) {
					if (value == column.getFieldValue(data)) {
						unique = false;
					}
				}
			});

			return unique;
		},

		//must have a value
		required: function required(cell, value, parameters) {
			return value !== "" && value !== null && typeof value !== "undefined";
		}
	};

	Tabulator.prototype.registerModule("validate", Validate);

	return Tabulator;
});

/***/ }),

/***/ "./src/lib/components/DashTabulator.react.js":
/*!***************************************************!*\
  !*** ./src/lib/components/DashTabulator.react.js ***!
  \***************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return DashTabulator; });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var prop_types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! prop-types */ "./node_modules/prop-types/index.js");
/* harmony import */ var prop_types__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var tabulator_tables__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! tabulator-tables */ "./node_modules/tabulator-tables/dist/js/tabulator.js");
/* harmony import */ var tabulator_tables__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(tabulator_tables__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var tabulator_tables_dist_css_tabulator_min_css__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! tabulator-tables/dist/css/tabulator.min.css */ "./node_modules/tabulator-tables/dist/css/tabulator.min.css");
/* harmony import */ var tabulator_tables_dist_css_tabulator_min_css__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(tabulator_tables_dist_css_tabulator_min_css__WEBPACK_IMPORTED_MODULE_3__);
function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }



 //import Tabulator library

 //import Tabulator stylesheet

/**
 * ExampleComponent is an example component.
 * It takes a property, `label`, and
 * displays it.
 * It renders an input with the property `value`
 * which is editable by the user.
 */

var DashTabulator = /*#__PURE__*/function (_Component) {
  _inherits(DashTabulator, _Component);

  var _super = _createSuper(DashTabulator);

  function DashTabulator() {
    _classCallCheck(this, DashTabulator);

    return _super.apply(this, arguments);
  }

  _createClass(DashTabulator, [{
    key: "render",
    value: function render() {
      var _this$props = this.props,
          id = _this$props.id,
          label = _this$props.label,
          setProps = _this$props.setProps,
          value = _this$props.value;
      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div", {
        id: id
      }, "ExampleComponent: ", label, "\xA0", /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("input", {
        value: value,
        onChange:
        /*
         * Send the new value to the parent component.
         * setProps is a prop that is automatically supplied
         * by dash's front-end ("dash-renderer").
         * In a Dash app, this will update the component's
         * props and send the data back to the Python Dash
         * app server if a callback uses the modified prop as
         * Input or State.
         */
        function onChange(e) {
          return setProps({
            value: e.target.value
          });
        }
      }));
    }
  }]);

  return DashTabulator;
}(react__WEBPACK_IMPORTED_MODULE_0__["Component"]);


DashTabulator.defaultProps = {};
DashTabulator.propTypes = {
  /**
   * The ID used to identify this component in Dash callbacks.
   */
  id: prop_types__WEBPACK_IMPORTED_MODULE_1___default.a.string,

  /**
   * A label that will be printed when this component is rendered.
   */
  label: prop_types__WEBPACK_IMPORTED_MODULE_1___default.a.string.isRequired,

  /**
   * The value displayed in the input.
   */
  value: prop_types__WEBPACK_IMPORTED_MODULE_1___default.a.string,

  /**
   * Dash-assigned callback that should be called to report property changes
   * to Dash, to make them available for callbacks.
   */
  setProps: prop_types__WEBPACK_IMPORTED_MODULE_1___default.a.func
};

/***/ })

})
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9kYXNoX3RhYnVsYXRvci8uL25vZGVfbW9kdWxlcy90YWJ1bGF0b3ItdGFibGVzL2Rpc3QvY3NzL3RhYnVsYXRvci5taW4uY3NzIiwid2VicGFjazovL2Rhc2hfdGFidWxhdG9yLy4vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvZGlzdC9ydW50aW1lL2FwaS5qcyIsIndlYnBhY2s6Ly9kYXNoX3RhYnVsYXRvci8uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvbGliL2FkZFN0eWxlcy5qcyIsIndlYnBhY2s6Ly9kYXNoX3RhYnVsYXRvci8uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvbGliL3VybHMuanMiLCJ3ZWJwYWNrOi8vZGFzaF90YWJ1bGF0b3IvLi9ub2RlX21vZHVsZXMvdGFidWxhdG9yLXRhYmxlcy9kaXN0L2Nzcy90YWJ1bGF0b3IubWluLmNzcz8yYTZmIiwid2VicGFjazovL2Rhc2hfdGFidWxhdG9yLy4vbm9kZV9tb2R1bGVzL3RhYnVsYXRvci10YWJsZXMvZGlzdC9qcy90YWJ1bGF0b3IuanMiLCJ3ZWJwYWNrOi8vZGFzaF90YWJ1bGF0b3IvLi9zcmMvbGliL2NvbXBvbmVudHMvRGFzaFRhYnVsYXRvci5yZWFjdC5qcyJdLCJuYW1lcyI6WyJEYXNoVGFidWxhdG9yIiwicHJvcHMiLCJpZCIsImxhYmVsIiwic2V0UHJvcHMiLCJ2YWx1ZSIsImUiLCJ0YXJnZXQiLCJDb21wb25lbnQiLCJkZWZhdWx0UHJvcHMiLCJwcm9wVHlwZXMiLCJQcm9wVHlwZXMiLCJzdHJpbmciLCJpc1JlcXVpcmVkIiwiZnVuYyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7QUFDQSxrQ0FBa0MsbUJBQU8sQ0FBQyw4RkFBeUM7QUFDbkY7QUFDQTtBQUNBLGNBQWMsUUFBUyx5REFBeUQsa0JBQWtCLHNCQUFzQixzQkFBc0IsZUFBZSxnQkFBZ0IsZ0JBQWdCLHdCQUF3QixpRkFBaUYsZUFBZSwwQ0FBMEMscUJBQXFCLGtDQUFrQyx5QkFBeUIscUJBQXFCLGlCQUFpQiw2QkFBNkIsa0JBQWtCLHNCQUFzQixXQUFXLDZCQUE2Qix5QkFBeUIsV0FBVyxnQkFBZ0IsbUJBQW1CLGdCQUFnQixzQkFBc0Isd0JBQXdCLHlCQUF5QixvQkFBb0IscURBQXFELGFBQWEsNENBQTRDLHFCQUFxQixrQkFBa0Isc0JBQXNCLDRCQUE0QixtQkFBbUIsZ0JBQWdCLHNCQUFzQixnQkFBZ0IsNkRBQTZELGtCQUFrQixzQkFBc0IsbUJBQW1CLG9CQUFvQixtRUFBbUUsc0JBQXNCLGtCQUFrQixZQUFZLGlHQUFpRyxjQUFjLHVHQUF1RyxlQUFlLFdBQVcsd0ZBQXdGLHNCQUFzQixXQUFXLG1CQUFtQixnQkFBZ0IsdUJBQXVCLHNCQUFzQixnSEFBZ0gsc0JBQXNCLFdBQVcsc0JBQXNCLFlBQVksZ0JBQWdCLG9GQUFvRixxQkFBcUIsa0JBQWtCLFFBQVEsVUFBVSxRQUFRLFNBQVMsa0NBQWtDLG1DQUFtQyw2QkFBNkIsMEZBQTBGLGtCQUFrQixvQkFBb0IsYUFBYSwwQkFBMEIsZ0JBQWdCLGtCQUFrQiwwRkFBMEYsYUFBYSxxRUFBcUUsa0JBQWtCLHNCQUFzQixlQUFlLFdBQVcsa0JBQWtCLDhFQUE4RSxzQkFBc0IseUVBQXlFLGVBQWUsc0ZBQXNGLFFBQVEsU0FBUyxvRkFBb0YsbUJBQW1CLHFFQUFxRSxlQUFlLHlCQUF5Qix1SEFBdUgsZ0JBQWdCLDZCQUE2QixzSEFBc0gsZ0JBQWdCLDZCQUE2Qix1SEFBdUgsMEJBQTBCLG1CQUFtQiwrR0FBK0csdUJBQXVCLHlCQUF5Qix1QkFBdUIsb0JBQW9CLGFBQWEsc0JBQXNCLG1CQUFtQixxQkFBcUIsdUJBQXVCLG9IQUFvSCx5QkFBeUIsMkdBQTJHLGdCQUFnQixpQkFBaUIsdUlBQXVJLGdCQUFnQixvQkFBb0IsdUdBQXVHLHNCQUFzQiwrQ0FBK0MscUJBQXFCLGtCQUFrQixXQUFXLHFFQUFxRSw0QkFBNEIsc0VBQXNFLDJCQUEyQixxREFBcUQsc0JBQXNCLGVBQWUsNkJBQTZCLDBCQUEwQiw2QkFBNkIsZ0JBQWdCLG9FQUFvRSw2QkFBNkIsaUdBQWlHLGFBQWEsMkRBQTJELGVBQWUsaUVBQWlFLGFBQWEsa0NBQWtDLGtCQUFrQixXQUFXLG1CQUFtQixjQUFjLGlDQUFpQyx3Q0FBd0MsYUFBYSx5REFBeUQsc0JBQXNCLG9CQUFvQixhQUFhLHNCQUFzQixtQkFBbUIsV0FBVyx3RkFBd0YsZ0JBQWdCLGVBQWUsOERBQThELHFCQUFxQixjQUFjLGFBQWEsV0FBVyxnQkFBZ0IsZUFBZSxtREFBbUQsa0JBQWtCLHFCQUFxQixzQkFBc0IsbUJBQW1CLGlCQUFpQixXQUFXLGtGQUFrRixnQkFBZ0IsNkJBQTZCLHNHQUFzRyw2QkFBNkIseUdBQXlHLDBCQUEwQiw2QkFBNkIsaUJBQWlCLDBCQUEwQix5QkFBeUIsaUJBQWlCLFdBQVcsZ0JBQWdCLG1CQUFtQixxQkFBcUIsaUJBQWlCLHNCQUFzQix3QkFBd0IseUJBQXlCLG9CQUFvQixxREFBcUQsc0JBQXNCLHdCQUF3QixzQkFBc0IsZ0JBQWdCLDZCQUE2Qiw2QkFBNkIsMEJBQTBCLGdCQUFnQixvRUFBb0UsNkJBQTZCLGlHQUFpRyxhQUFhLGdFQUFnRSxtQkFBbUIsbUJBQW1CLGtEQUFrRCxXQUFXLG9CQUFvQixvQkFBb0Isa0JBQWtCLGtEQUFrRCxxQkFBcUIsYUFBYSxnQkFBZ0Isc0JBQXNCLGtCQUFrQiw4Q0FBOEMsYUFBYSw2Q0FBNkMscUJBQXFCLGFBQWEsZ0JBQWdCLHNCQUFzQixrQkFBa0IsOEJBQThCLG9EQUFvRCxXQUFXLHNEQUFzRCxXQUFXLGtFQUFrRSxlQUFlLDBCQUEwQixXQUFXLHdDQUF3QyxrQkFBa0IsUUFBUSxNQUFNLFNBQVMsVUFBVSw2Q0FBNkMsT0FBTyxXQUFXLDhDQUE4QyxpQkFBaUIsNkJBQTZCLGtCQUFrQixvQkFBb0IsYUFBYSxzQkFBc0IsbUJBQW1CLE1BQU0sT0FBTyxZQUFZLFlBQVksV0FBVywwQkFBMEIsa0JBQWtCLG1EQUFtRCxxQkFBcUIsY0FBYyxrQkFBa0IsbUJBQW1CLGdCQUFnQixnQkFBZ0IsZUFBZSxxRUFBcUUsc0JBQXNCLFdBQVcsbUVBQW1FLHNCQUFzQixjQUFjLGVBQWUsa0JBQWtCLHNCQUFzQixnQkFBZ0Isc0JBQXNCLGtDQUFrQyx5QkFBeUIsMENBQTBDLHNCQUFzQixlQUFlLGtDQUFrQyx5QkFBeUIsd0NBQXdDLHlCQUF5QixlQUFlLG9DQUFvQyxzQkFBc0IsZ0JBQWdCLGdDQUFnQyxrQkFBa0IsMEJBQTBCLDZCQUE2QixvQkFBb0IsV0FBVyw0Q0FBNEMsa0JBQWtCLFFBQVEsU0FBUyxPQUFPLFdBQVcsaURBQWlELE1BQU0sWUFBWSxrREFBa0QsaUJBQWlCLGlDQUFpQyxxQkFBcUIsa0JBQWtCLHlCQUF5QixXQUFXLHVEQUF1RCw0QkFBNEIsd0RBQXdELDJCQUEyQiw4Q0FBOEMsc0JBQXNCLFlBQVksMEJBQTBCLDZCQUE2QixvREFBb0QsYUFBYSxvREFBb0QsZUFBZSwwREFBMEQsa0JBQWtCLHdFQUF3RSxtQkFBbUIsK0JBQStCLHFCQUFxQixrQkFBa0Isc0JBQXNCLFlBQVksNEJBQTRCLHNCQUFzQixtQkFBbUIsZ0JBQWdCLHVCQUF1QixpREFBaUQseUJBQXlCLFVBQVUsK0dBQStHLFdBQVcsdUJBQXVCLHlEQUF5RCxzQkFBc0IsK0hBQStILFdBQVcsdUJBQXVCLFdBQVcsNkVBQTZFLGFBQWEsb0RBQW9ELDJCQUEyQixvQkFBb0Isc0JBQXNCLG1CQUFtQixxQkFBcUIsdUJBQXVCLHNCQUFzQix3QkFBd0IseUJBQXlCLG9CQUFvQiw4RUFBOEUsVUFBVSx3R0FBd0csV0FBVyxXQUFXLGVBQWUsZ0JBQWdCLDJEQUEyRCxxQkFBcUIsc0JBQXNCLFdBQVcsVUFBVSxnQkFBZ0IsaUJBQWlCLDhCQUE4QiwyQkFBMkIsNkJBQTZCLDREQUE0RCwyQkFBMkIsb0JBQW9CLHFCQUFxQix1QkFBdUIsc0JBQXNCLG1CQUFtQixzQkFBc0IsWUFBWSxXQUFXLGlCQUFpQixzQkFBc0Isa0JBQWtCLDBCQUEwQixnQkFBZ0Isa0VBQWtFLGVBQWUsMEJBQTBCLGtHQUFrRyxxQkFBcUIsa0JBQWtCLFdBQVcsVUFBVSx1QkFBdUIsd0dBQXdHLGtCQUFrQixhQUFhLFVBQVUsUUFBUSxXQUFXLFVBQVUsZ0JBQWdCLGdHQUFnRyxxQkFBcUIsa0JBQWtCLFdBQVcsVUFBVSxnQkFBZ0Isc0dBQXNHLGtCQUFrQixhQUFhLFVBQVUsUUFBUSxXQUFXLFVBQVUsZ0JBQWdCLHFFQUFxRSwyQkFBMkIsb0JBQW9CLHNCQUFzQixtQkFBbUIscUJBQXFCLHVCQUF1QixzQkFBc0Isd0JBQXdCLHlCQUF5QixvQkFBb0IsWUFBWSxXQUFXLG1CQUFtQixnQkFBZ0IsV0FBVyxnQkFBZ0IsZ0JBQWdCLDJFQUEyRSxXQUFXLHNIQUFzSCxnQkFBZ0Isc09BQXNPLGFBQWEsd0RBQXdELHFCQUFxQixZQUFZLFdBQVcsbUJBQW1CLCtCQUErQixzQkFBc0IsNkJBQTZCLDRCQUE0QiwwQkFBMEIsWUFBWSxrQkFBa0IsZ0JBQWdCLGdCQUFnQixlQUFlLHFDQUFxQyxlQUFlLGdDQUFnQyx3RUFBd0Usa0JBQWtCLGtDQUFrQyxtQ0FBbUMsMEJBQTBCLGdCQUFnQix1REFBdUQsa0JBQWtCLHVEQUF1RCxrQkFBa0IsdURBQXVELGtCQUFrQix1REFBdUQsa0JBQWtCLHVEQUF1RCxtQkFBbUIsdURBQXVELHFCQUFxQixnREFBZ0QscUJBQXFCLFFBQVEsU0FBUyxrQkFBa0IsaUNBQWlDLG9DQUFvQyxlQUFlLDJCQUEyQixzQkFBc0Isb0NBQW9DLGlCQUFpQixXQUFXLGdCQUFnQixrQkFBa0IscUJBQXFCLHNCQUFzQixnQkFBZ0Isc0JBQXNCLG9DQUFvQyxlQUFlLGdCQUFnQixpQ0FBaUMsY0FBYyxxQ0FBcUMsaUJBQWlCLHlCQUF5QixxQkFBcUIsaUJBQWlCLGtFQUFrRSxXQUFXLDhFQUE4RSxlQUFlLG1CQUFtQiwwQ0FBMEMsMEJBQTBCLDRCQUE0QixrQkFBa0IscUJBQXFCLHNCQUFzQixpQkFBaUIsZ0JBQWdCLHNCQUFzQixlQUFlLGdCQUFnQixpQ0FBaUMsY0FBYyw2REFBNkQsWUFBWSxXQUFXLG9FQUFvRSxXQUFXLG1CQUFtQiw0RUFBNEUscUNBQXFDLHFFQUFxRSwwQkFBMEIsbUVBQW1FLGVBQWUsV0FBVyxtQkFBbUIsK0RBQStELFlBQVksV0FBVyxrQkFBa0IsOERBQThELDZCQUE2QixZQUFZLGdCQUFnQixXQUFXLGdCQUFnQiw0QkFBNEIsa0JBQWtCLE1BQU0sU0FBUyxPQUFPLFFBQVEsY0FBYyx1RUFBdUUsdUJBQXVCLHVCQUF1Qix5QkFBeUIsbURBQW1ELHFCQUFxQixzQkFBc0IsV0FBVyxVQUFVLGdCQUFnQixpQkFBaUIsOEJBQThCLDJCQUEyQiw2QkFBNkIsb0RBQW9ELHNCQUFzQiw2QkFBNkIsNEJBQTRCLDBCQUEwQixZQUFZLGtCQUFrQixnQkFBZ0IsZ0JBQWdCLGVBQWUsMERBQTBELGVBQWUsZ0NBQWdDLDZGQUE2RixrQkFBa0Isa0NBQWtDLG1DQUFtQywwQkFBMEIsZ0JBQWdCLCtFQUErRSw0QkFBNEIsK0VBQStFLDRCQUE0QiwrRUFBK0UsNEJBQTRCLCtFQUErRSw0QkFBNEIsK0VBQStFLDZCQUE2Qiw0RUFBNEUscUJBQXFCLHFFQUFxRSxxQkFBcUIsUUFBUSxTQUFTLGtCQUFrQixpQ0FBaUMsb0NBQW9DLGVBQWUsMkJBQTJCLHNCQUFzQix5REFBeUQsaUJBQWlCLFdBQVcsb0RBQW9ELDJCQUEyQixvQkFBb0IscUJBQXFCLHVCQUF1QixzQkFBc0IsbUJBQW1CLHNCQUFzQixZQUFZLFdBQVcsaUJBQWlCLHNCQUFzQixrQkFBa0IsMEJBQTBCLGdCQUFnQiwwREFBMEQsZUFBZSwwQkFBMEIsMEZBQTBGLHFCQUFxQixrQkFBa0IsV0FBVyxVQUFVLHVCQUF1QixnR0FBZ0csa0JBQWtCLGFBQWEsVUFBVSxRQUFRLFdBQVcsVUFBVSxnQkFBZ0Isd0ZBQXdGLHFCQUFxQixrQkFBa0IsV0FBVyxVQUFVLGdCQUFnQiw4RkFBOEYsa0JBQWtCLGFBQWEsVUFBVSxRQUFRLFdBQVcsVUFBVSxnQkFBZ0I7QUFDeGtuQjtBQUNBOzs7Ozs7Ozs7Ozs7O0FDTmE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0I7O0FBRWhCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDRDQUE0QyxxQkFBcUI7QUFDakU7O0FBRUE7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EscUJBQXFCLGlCQUFpQjtBQUN0QztBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsb0JBQW9CLHFCQUFxQjtBQUN6Qzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsOEJBQThCOztBQUU5Qjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBLENBQUM7OztBQUdEO0FBQ0E7QUFDQTtBQUNBLHFEQUFxRCxjQUFjO0FBQ25FO0FBQ0EsQzs7Ozs7Ozs7Ozs7QUM3RkE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QztBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTs7QUFFQSxjQUFjLG1CQUFPLENBQUMsdURBQVE7O0FBRTlCO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQSxpQkFBaUIsbUJBQW1CO0FBQ3BDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGlCQUFpQixzQkFBc0I7QUFDdkM7O0FBRUE7QUFDQSxtQkFBbUIsMkJBQTJCOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZ0JBQWdCLG1CQUFtQjtBQUNuQztBQUNBOztBQUVBO0FBQ0E7O0FBRUEsaUJBQWlCLDJCQUEyQjtBQUM1QztBQUNBOztBQUVBLFFBQVEsdUJBQXVCO0FBQy9CO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUEsaUJBQWlCLHVCQUF1QjtBQUN4QztBQUNBOztBQUVBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBLGdCQUFnQixpQkFBaUI7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7O0FBRWQsa0RBQWtELHNCQUFzQjtBQUN4RTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjs7QUFFQTtBQUNBLEtBQUssS0FBd0MsRUFBRSxFQUU3Qzs7QUFFRixRQUFRLHNCQUFpQjtBQUN6Qjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx1REFBdUQ7QUFDdkQ7O0FBRUEsNkJBQTZCLG1CQUFtQjs7QUFFaEQ7O0FBRUE7O0FBRUE7QUFDQTs7Ozs7Ozs7Ozs7OztBQzlZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0MsV0FBVyxFQUFFO0FBQ3JELHdDQUF3QyxXQUFXLEVBQUU7O0FBRXJEO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0Esc0NBQXNDO0FBQ3RDLEdBQUc7QUFDSDtBQUNBLDhEQUE4RDtBQUM5RDs7QUFFQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7QUN2RkEsY0FBYyxtQkFBTyxDQUFDLDhKQUF1RDs7QUFFN0UsNENBQTRDLFFBQVM7O0FBRXJEO0FBQ0E7Ozs7QUFJQSxlQUFlOztBQUVmO0FBQ0E7O0FBRUEsYUFBYSxtQkFBTyxDQUFDLDRGQUF5Qzs7QUFFOUQ7O0FBRUEsR0FBRyxJQUFVO0FBQ2IsbUJBQW1CLDhKQUF1RDtBQUMxRSxtQkFBbUIsbUJBQU8sQ0FBQyw4SkFBdUQ7O0FBRWxGLG9EQUFvRCxRQUFTOztBQUU3RDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBLEVBQUU7O0FBRUYsZ0NBQWdDLFVBQVUsRUFBRTtBQUM1QyxDOzs7Ozs7Ozs7OztBQzVDQSxzS0FBb0csbUJBQW1CLEVBQUUsbUJBQW1CLDhIQUE4SDs7QUFFMVE7O0FBRUEsQ0FBQztBQUNELE1BQU0sTUFBOEIsR0FBRyxTQUFXO0FBQ2xEO0FBQ0EsRUFBRSxVQUFVLElBQTBDO0FBQ3RELEVBQUUsb0NBQU8sT0FBTztBQUFBO0FBQUE7QUFBQTtBQUFBLG9HQUFDO0FBQ2pCLEVBQUUsTUFBTSxFQUVOO0FBQ0YsQ0FBQzs7QUFFRDs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7O0FBRUE7OztBQUdBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7OztBQUdBOztBQUVBOzs7QUFHQTs7QUFFQTtBQUNBOztBQUVBLG9EQUFvRDs7O0FBR3BEOztBQUVBOzs7QUFHQTs7QUFFQTs7O0FBR0E7O0FBRUE7OztBQUdBOzs7QUFHQTs7O0FBR0E7OztBQUdBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7OztBQUdBO0FBQ0E7O0FBRUE7OztBQUdBO0FBQ0E7O0FBRUEsR0FBRztBQUNIOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7O0FBR0E7O0FBRUE7OztBQUdBOztBQUVBO0FBQ0E7O0FBRUEsb0RBQW9EOzs7QUFHcEQ7O0FBRUE7OztBQUdBOztBQUVBOzs7QUFHQTs7QUFFQTs7O0FBR0E7OztBQUdBOzs7QUFHQTs7O0FBR0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7QUFDQTs7QUFFQTs7O0FBR0E7QUFDQTs7QUFFQSxHQUFHO0FBQ0g7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7OztBQUdBOztBQUVBOzs7QUFHQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7O0FBR0E7O0FBRUE7OztBQUdBOzs7QUFHQTs7O0FBR0E7OztBQUdBOzs7QUFHQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7O0FBR0E7OztBQUdBOztBQUVBO0FBQ0E7O0FBRUE7OztBQUdBO0FBQ0E7O0FBRUE7OztBQUdBO0FBQ0E7O0FBRUEsR0FBRztBQUNIOztBQUVBOzs7QUFHQTs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTs7O0FBR0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQSx1QkFBdUIsMEJBQTBCOztBQUVqRDs7QUFFQTs7QUFFQTs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7O0FBRUEsR0FBRztBQUNIOztBQUVBOztBQUVBLHFCQUFxQjs7O0FBR3JCOztBQUVBOztBQUVBLDRDQUE0Qzs7O0FBRzVDLHlCQUF5Qjs7O0FBR3pCLG9CQUFvQjs7O0FBR3BCLDJCQUEyQjs7O0FBRzNCLDJCQUEyQjs7O0FBRzNCOztBQUVBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOzs7QUFHQTs7O0FBR0E7OztBQUdBOzs7QUFHQTs7O0FBR0EsTUFBTTs7QUFFTjs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7OztBQUdBLGtEQUFrRCxrQ0FBa0M7OztBQUdwRjs7O0FBR0E7OztBQUdBOztBQUVBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7O0FBR0E7OztBQUdBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsT0FBTzs7QUFFUDtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsT0FBTzs7QUFFUDs7QUFFQTtBQUNBLFFBQVE7O0FBRVI7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBOztBQUVBOzs7QUFHQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7OztBQUdBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOzs7QUFHQTtBQUNBLElBQUk7O0FBRUo7OztBQUdBO0FBQ0EsSUFBSTs7QUFFSjs7O0FBR0E7O0FBRUE7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQSxHQUFHOztBQUVIOzs7QUFHQTtBQUNBOztBQUVBOzs7QUFHQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7OztBQUdBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBO0FBQ0E7QUFDQTs7O0FBR0E7O0FBRUE7OztBQUdBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxNQUFNOztBQUVOO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRztBQUNIOztBQUVBOzs7QUFHQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJO0FBQ0osR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJO0FBQ0osR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTtBQUNKOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQSx3QkFBd0I7O0FBRXhCLHVCQUF1Qjs7QUFFdkIsdUJBQXVCOztBQUV2QixvQkFBb0I7O0FBRXBCLGtCQUFrQjs7QUFFbEIsc0NBQXNDOztBQUV0Qzs7QUFFQTs7QUFFQSxnREFBZ0Q7O0FBRWhEOztBQUVBLHVCQUF1Qjs7QUFFdkIscUJBQXFCOztBQUVyQixzQkFBc0I7OztBQUd0Qjs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBLG9CQUFvQjs7O0FBR3BCOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBLG9CQUFvQjs7QUFFcEIsd0JBQXdCOztBQUV4Qix1QkFBdUI7O0FBRXZCLDJCQUEyQjs7QUFFM0IsMEJBQTBCOzs7QUFHMUIsc0JBQXNCOzs7QUFHdEI7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLE1BQU07QUFDTixLQUFLOztBQUVMO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSSxHQUFHLGdCQUFnQjs7QUFFdkI7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7O0FBRUE7O0FBRUE7QUFDQSxNQUFNO0FBQ047QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxLQUFLO0FBQ0wsSUFBSSxHQUFHLGdCQUFnQjs7QUFFdkI7O0FBRUE7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKOztBQUVBOztBQUVBOztBQUVBLHNEQUFzRDtBQUN0RCxLQUFLO0FBQ0wsSUFBSTs7QUFFSiw2Q0FBNkM7QUFDN0M7QUFDQSxHQUFHOztBQUVIOztBQUVBOztBQUVBLG1GQUFtRjtBQUNuRixLQUFLO0FBQ0wsSUFBSTs7QUFFSiwwRUFBMEU7QUFDMUU7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLE1BQU07O0FBRU47O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsa0JBQWtCLGFBQWE7O0FBRS9COztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsbUJBQW1CLGNBQWM7O0FBRWpDOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTs7QUFFQTtBQUNBLE1BQU07O0FBRU47QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUEsb0JBQW9CLGlCQUFpQjs7QUFFckM7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQSxpQ0FBaUM7O0FBRWpDOztBQUVBOztBQUVBOztBQUVBLDJCQUEyQjtBQUMzQjs7QUFFQTs7QUFFQTtBQUNBLE1BQU07O0FBRU47QUFDQSxNQUFNO0FBQ04sS0FBSzs7QUFFTDtBQUNBLEtBQUs7QUFDTCxJQUFJOztBQUVKOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUEsNENBQTRDOztBQUU1QyxnREFBZ0Q7O0FBRWhELCtDQUErQzs7QUFFL0MsNEJBQTRCOztBQUU1QixrQkFBa0I7OztBQUdsQiwyQkFBMkI7O0FBRTNCLDhCQUE4Qjs7QUFFOUIsMkJBQTJCOzs7QUFHM0IsaUJBQWlCOztBQUVqQix1QkFBdUI7O0FBRXZCLDJCQUEyQjs7O0FBRzNCLHdCQUF3Qjs7QUFFeEIsNEJBQTRCOzs7QUFHNUI7O0FBRUE7O0FBRUEsMEJBQTBCOzs7QUFHMUIsbUJBQW1COztBQUVuQixzQkFBc0I7OztBQUd0Qiw0QkFBNEI7O0FBRTVCLCtCQUErQjs7O0FBRy9CLHNCQUFzQjs7QUFFdEIseUJBQXlCOzs7QUFHekIsK0JBQStCOzs7QUFHL0IsNEJBQTRCOzs7QUFHNUIsbUNBQW1DOztBQUVuQyxtQ0FBbUM7OztBQUduQywyQkFBMkI7O0FBRTNCLDhCQUE4Qjs7O0FBRzlCLDRCQUE0Qjs7O0FBRzVCLDJCQUEyQjs7QUFFM0Isd0NBQXdDOztBQUV4QywwQ0FBMEM7QUFDMUM7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQTs7QUFFQTs7O0FBR0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxPQUFPOztBQUVQO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxPQUFPOztBQUVQO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7OztBQUdBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMOztBQUVBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUEscURBQXFELHFDQUFxQztBQUMxRjs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0EsSUFBSTs7QUFFSjtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQSwyREFBMkQ7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsTUFBTTs7QUFFTjs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQSx1REFBdUQsMkZBQTJGO0FBQ2xKOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLE1BQU07O0FBRU47QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBLHlCQUF5QixZQUFZOztBQUVyQzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsR0FBRyx1QkFBdUI7QUFDMUI7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBLHFEQUFxRCxzQkFBc0I7QUFDM0UsSUFBSTs7QUFFSixxREFBcUQsc0JBQXNCO0FBQzNFLElBQUk7O0FBRUo7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQSxxREFBcUQsc0JBQXNCO0FBQzNFLElBQUk7O0FBRUoscURBQXFELHNCQUFzQjtBQUMzRSxJQUFJOztBQUVKOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLE9BQU87O0FBRVA7QUFDQTtBQUNBLE1BQU07O0FBRU47QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNOztBQUVOO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxNQUFNOztBQUVOO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxNQUFNOztBQUVOO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxNQUFNOztBQUVOO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQSw2QkFBNkIsc0JBQXNCOztBQUVuRDs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLE9BQU87O0FBRVA7O0FBRUE7O0FBRUE7QUFDQSxRQUFROztBQUVSO0FBQ0E7QUFDQTtBQUNBLE1BQU07O0FBRU47O0FBRUE7QUFDQSxPQUFPOztBQUVQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQSw4QkFBOEIsc0JBQXNCOztBQUVwRDs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLE9BQU87O0FBRVA7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOzs7QUFHQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOzs7QUFHQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7OztBQUdBOztBQUVBOztBQUVBOztBQUVBLG1CQUFtQjs7QUFFbkI7O0FBRUEsb0JBQW9COztBQUVwQjs7QUFFQSxrQkFBa0I7O0FBRWxCLHlCQUF5Qjs7QUFFekIsNEJBQTRCOztBQUU1Qix1QkFBdUI7O0FBRXZCLDJCQUEyQjs7QUFFM0IsaUNBQWlDOzs7QUFHakM7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUksR0FBRyxnQkFBZ0I7O0FBRXZCOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMOztBQUVBOztBQUVBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsS0FBSztBQUNMLElBQUksR0FBRyxnQkFBZ0I7O0FBRXZCOztBQUVBOztBQUVBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOzs7QUFHQTs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsbUJBQW1CO0FBQ25COztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUEsMEJBQTBCLHVCQUF1Qjs7QUFFakQ7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUEsMEJBQTBCLFFBQVE7O0FBRWxDO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBOzs7QUFHQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxLQUFLOztBQUVMOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSxnRUFBZ0UscURBQXFEO0FBQ3JIOztBQUVBOztBQUVBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBLG1CQUFtQixpQkFBaUI7O0FBRXBDO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUEsR0FBRztBQUNIOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7O0FBRUg7O0FBRUE7O0FBRUE7O0FBRUEsYUFBYTtBQUNiO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLE1BQU07O0FBRU47O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTCxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUksR0FBRyxnQkFBZ0I7O0FBRXZCOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEtBQUs7O0FBRUw7O0FBRUE7O0FBRUE7QUFDQSxNQUFNO0FBQ047QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMLElBQUksR0FBRyxnQkFBZ0I7O0FBRXZCOztBQUVBOztBQUVBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLE1BQU07QUFDTixLQUFLOztBQUVMOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQSx5REFBeUQsZ0RBQWdEO0FBQ3pHOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQSxJQUFJOztBQUVKOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBLHNDQUFzQzs7QUFFdEM7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsTUFBTTs7QUFFTjs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7O0FBRUEsNEJBQTRCOztBQUU1Qix5QkFBeUI7O0FBRXpCLDRCQUE0Qjs7QUFFNUIsb0JBQW9COztBQUVwQiwyQkFBMkI7O0FBRTNCLDZCQUE2Qjs7O0FBRzdCLG9CQUFvQjs7O0FBR3BCOztBQUVBLHNDQUFzQzs7QUFFdEM7O0FBRUEsMkNBQTJDO0FBQzNDOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOzs7QUFHQTs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBOzs7QUFHQTs7O0FBR0E7O0FBRUE7OztBQUdBOzs7QUFHQTs7O0FBR0E7OztBQUdBOzs7QUFHQTs7QUFFQTs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7OztBQUdBOzs7QUFHQTs7O0FBR0E7O0FBRUE7OztBQUdBOzs7QUFHQTs7O0FBR0E7OztBQUdBOzs7QUFHQTs7O0FBR0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7OztBQUdBLGdEQUFnRDs7QUFFaEQsZ0RBQWdEOztBQUVoRCx3REFBd0Q7OztBQUd4RDs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQSxvQkFBb0I7O0FBRXBCOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQSx3REFBd0Q7O0FBRXhELDBEQUEwRDs7QUFFMUQ7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBLGlCQUFpQjs7O0FBR2pCOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7O0FBR0g7O0FBRUE7OztBQUdBOzs7QUFHQTs7O0FBR0E7O0FBRUEsV0FBVzs7QUFFWDs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQSx3QkFBd0I7O0FBRXhCLDRCQUE0Qjs7QUFFNUI7OztBQUdBOztBQUVBOztBQUVBLGdCQUFnQjs7QUFFaEI7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOzs7QUFHQTs7O0FBR0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUEsZ0VBQWdFOztBQUVoRSxnREFBZ0Q7O0FBRWhELDREQUE0RDs7QUFFNUQsOERBQThEOztBQUU5RCxvRUFBb0U7O0FBRXBFLHdEQUF3RDs7QUFFeEQsb0VBQW9FOztBQUVwRSxrRUFBa0U7O0FBRWxFLDhEQUE4RDs7QUFFOUQ7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUEsNENBQTRDOztBQUU1QyxzQ0FBc0M7O0FBRXRDOztBQUVBLDRDQUE0Qzs7QUFFNUMsOENBQThDOztBQUU5Qzs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQSxrQ0FBa0M7O0FBRWxDLHNDQUFzQzs7QUFFdEMsa0NBQWtDOztBQUVsQyxzQ0FBc0M7O0FBRXRDLHdEQUF3RDs7QUFFeEQsd0NBQXdDOztBQUV4Qyw0Q0FBNEM7O0FBRTVDLHNDQUFzQzs7QUFFdEM7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUEsd0NBQXdDOztBQUV4QyxzQ0FBc0M7O0FBRXRDLG9EQUFvRDs7QUFFcEQ7O0FBRUE7O0FBRUEsNENBQTRDOztBQUU1QyxzREFBc0Q7O0FBRXRELGdFQUFnRTs7QUFFaEU7O0FBRUEsNENBQTRDOztBQUU1QywwQ0FBMEM7O0FBRTFDOztBQUVBLHdDQUF3Qzs7QUFFeEMsc0NBQXNDOztBQUV0QyxzQ0FBc0M7O0FBRXRDOztBQUVBLDhDQUE4Qzs7QUFFOUM7O0FBRUEsb0NBQW9DOztBQUVwQzs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQSx3Q0FBd0M7O0FBRXhDLHNDQUFzQzs7QUFFdEM7O0FBRUE7O0FBRUE7O0FBRUEsMENBQTBDOztBQUUxQzs7QUFFQSw4REFBOEQ7O0FBRTlEOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBLHNDQUFzQzs7QUFFdEM7O0FBRUEsb0NBQW9DOztBQUVwQzs7QUFFQTs7QUFFQSxrREFBa0Q7O0FBRWxEOztBQUVBLHdDQUF3Qzs7QUFFeEMsd0NBQXdDOztBQUV4Qzs7QUFFQSxrREFBa0Q7O0FBRWxEOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMOztBQUVBLGlFQUFpRTs7QUFFakU7O0FBRUE7QUFDQTtBQUNBLE9BQU87O0FBRVA7QUFDQSxNQUFNOztBQUVOO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQSxzRkFBc0Ysc0JBQXNCO0FBQzVHLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUEsZ0VBQWdFLHNCQUFzQjtBQUN0RixLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUEsNkNBQTZDOzs7QUFHN0M7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxNQUFNOztBQUVOOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxNQUFNOztBQUVOO0FBQ0EsTUFBTTtBQUNOOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQSxzQkFBc0I7O0FBRXRCOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxNQUFNOztBQUVOOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxNQUFNOztBQUVOO0FBQ0E7QUFDQSxLQUFLOztBQUVMOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLEtBQUs7QUFDTCxJQUFJOztBQUVKOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxNQUFNOztBQUVOO0FBQ0EsS0FBSztBQUNMLElBQUk7O0FBRUo7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLE9BQU87QUFDUCxNQUFNOztBQUVOOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxLQUFLO0FBQ0wsSUFBSTs7QUFFSjs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7O0FBRUE7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxLQUFLOztBQUVMO0FBQ0EsS0FBSztBQUNMLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQSxLQUFLO0FBQ0w7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBLEtBQUs7QUFDTCxJQUFJOztBQUVKOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQSxLQUFLO0FBQ0wsSUFBSTs7QUFFSjs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBLEtBQUs7QUFDTCxJQUFJOztBQUVKOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQSxLQUFLO0FBQ0wsSUFBSTs7QUFFSjs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQSxLQUFLO0FBQ0wsSUFBSTs7QUFFSjs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBLE1BQU07QUFDTixLQUFLOztBQUVMO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUEsbURBQW1ELHNCQUFzQjtBQUN6RSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLE1BQU07O0FBRU47QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQSxvQkFBb0Isb0JBQW9COztBQUV4Qzs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQSxLQUFLO0FBQ0wsSUFBSTs7QUFFSjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBOztBQUVBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOzs7QUFHQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7OztBQUdBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7O0FBR0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7O0FBR0E7O0FBRUE7O0FBRUEsbURBQW1EOzs7QUFHbkQsc0JBQXNCOzs7QUFHdEIscUJBQXFCOzs7QUFHckIseUJBQXlCOzs7QUFHekIsd0JBQXdCOzs7QUFHeEIsd0JBQXdCOzs7QUFHeEIsK0JBQStCOzs7QUFHL0IsMkJBQTJCOzs7QUFHM0IseUJBQXlCOzs7QUFHekIsbUJBQW1COzs7QUFHbkI7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxNQUFNOztBQUVOO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsTUFBTTs7QUFFTjs7QUFFQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLE1BQU07O0FBRU47O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMOztBQUVBOztBQUVBO0FBQ0EsTUFBTTtBQUNOOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQSxRQUFROztBQUVSO0FBQ0E7QUFDQSxNQUFNOztBQUVOOztBQUVBOztBQUVBOztBQUVBLE9BQU87O0FBRVA7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjs7O0FBR0E7O0FBRUE7OztBQUdBOztBQUVBOzs7QUFHQTs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQSxJQUFJOztBQUVKOztBQUVBOzs7QUFHQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQSxxQkFBcUI7O0FBRXJCLDBCQUEwQjs7QUFFMUIsb0JBQW9COztBQUVwQixxQkFBcUI7QUFDckI7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUEsNEVBQTRFOztBQUU1RTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7O0FBR0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQSxjQUFjOztBQUVkOztBQUVBOztBQUVBOztBQUVBLElBQUk7O0FBRUosZ0JBQWdCOztBQUVoQjs7QUFFQTs7QUFFQTs7QUFFQSxJQUFJOztBQUVKOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLHFCQUFxQjtBQUNyQixtRkFBbUY7QUFDbkY7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsK0RBQStEOztBQUUvRDtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0EsRUFBRTs7QUFFRjtBQUNBOztBQUVBO0FBQ0E7O0FBRUEscUJBQXFCO0FBQ3JCLHNCQUFzQjtBQUN0QixnQkFBZ0I7QUFDaEI7QUFDQSxzQkFBc0I7O0FBRXRCLGtEQUFrRDtBQUNsRCw0Q0FBNEM7QUFDNUM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsd0JBQXdCO0FBQ3hCOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsMERBQTBELHNCQUFzQjtBQUNoRjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsZ0JBQWdCLDJCQUEyQjtBQUMzQzs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxNQUFNOztBQUVOOztBQUVBO0FBQ0EsS0FBSztBQUNMLElBQUk7QUFDSjtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsT0FBTztBQUNQLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTCxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLCtCQUErQixpQkFBaUI7QUFDaEQ7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx5Q0FBeUM7QUFDekM7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBLGlEQUFpRDtBQUNqRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0EsOERBQThEO0FBQzlELHVFQUF1RTtBQUN2RTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxNQUFNOztBQUVOOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU87O0FBRVA7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBLEtBQUs7O0FBRUw7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx5Q0FBeUM7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxNQUFNOztBQUVOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxxQkFBcUI7QUFDckI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBLG9EQUFvRDtBQUNwRDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQSwrQkFBK0IsYUFBYTtBQUM1Qzs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsT0FBTzs7QUFFUDtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTzs7QUFFUDtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLHdDQUF3QztBQUN4Qzs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQSxvQ0FBb0M7O0FBRXBDO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QixpQkFBaUIsS0FBSyxhQUFhLE1BQU07QUFDekM7QUFDQSxPQUFPLDBCQUEwQjs7QUFFakM7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxxQkFBcUIsS0FBSyxhQUFhLE1BQU0sOENBQThDLEVBQUU7QUFDN0Y7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLE1BQU07O0FBRU47QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxNQUFNOztBQUVOOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUIsa0JBQWtCO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixlQUFlO0FBQ2xDO0FBQ0EsS0FBSztBQUNMOztBQUVBLGtDQUFrQyxrREFBa0Q7O0FBRXBGO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EscUJBQXFCO0FBQ3JCLDJCQUEyQjtBQUMzQiwwQkFBMEI7QUFDMUIsOEJBQThCO0FBQzlCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsbUJBQW1CLHNCQUFzQjtBQUN6QztBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLHNCQUFzQjtBQUNsRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QztBQUN2QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTzs7QUFFUDtBQUNBOztBQUVBO0FBQ0E7O0FBRUEscUJBQXFCLHFCQUFxQjtBQUMxQztBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsaUJBQWlCLHNCQUFzQjtBQUN2QztBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0EsOEJBQThCO0FBQzlCO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLGlCQUFpQixzQkFBc0I7QUFDdkM7QUFDQSxJQUFJOztBQUVKOztBQUVBOztBQUVBO0FBQ0EsOEJBQThCO0FBQzlCOztBQUVBO0FBQ0E7QUFDQSxNQUFNO0FBQ04sS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSxpQkFBaUIsc0JBQXNCO0FBQ3ZDOztBQUVBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxpQkFBaUIsc0JBQXNCO0FBQ3ZDO0FBQ0EsSUFBSTs7QUFFSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQjs7QUFFQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLFNBQVM7QUFDVCxRQUFRO0FBQ1I7QUFDQTtBQUNBLE9BQU87O0FBRVA7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlEO0FBQ2pELE9BQU87QUFDUDtBQUNBO0FBQ0EsaURBQWlEOztBQUVqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFFBQVE7O0FBRVI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxRQUFRO0FBQ1IsT0FBTzs7QUFFUDtBQUNBOztBQUVBO0FBQ0EsS0FBSztBQUNMOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLE1BQU07QUFDTjtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsT0FBTztBQUNQLE1BQU07O0FBRU47QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxPQUFPO0FBQ1A7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCLHNCQUFzQjtBQUN2QyxJQUFJOztBQUVKO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTCxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU07O0FBRU47QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxPQUFPO0FBQ1AsTUFBTTtBQUNOO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBOztBQUVBO0FBQ0EsTUFBTTtBQUNOLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsT0FBTzs7QUFFUDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxRQUFRO0FBQ1IsT0FBTzs7QUFFUDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07O0FBRU47O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBLGlCQUFpQixzQkFBc0I7QUFDdkMsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBOztBQUVBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGtCQUFrQixlQUFlO0FBQ2pDO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0Isc0JBQXNCO0FBQ3hDLEtBQUs7QUFDTDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxxQkFBcUIscUJBQXFCOztBQUUxQztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EscUJBQXFCLG9CQUFvQjtBQUN6QztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07O0FBRU47QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQSxxQkFBcUI7O0FBRXJCLHVCQUF1QjtBQUN2QiwwQkFBMEI7QUFDMUIsZ0NBQWdDOztBQUVoQztBQUNBLHdDQUF3Qzs7QUFFeEMsdUJBQXVCO0FBQ3ZCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsa0NBQWtDLGlFQUFpRTtBQUNuRyxLQUFLO0FBQ0w7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBLG9GQUFvRjs7QUFFcEY7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ04sS0FBSztBQUNMO0FBQ0E7QUFDQSxNQUFNO0FBQ047O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE1BQU07QUFDTjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSOztBQUVBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQztBQUMzQztBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLGFBQWEseURBQXlEO0FBQ3RFOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsYUFBYSx5REFBeUQ7QUFDdEU7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSwrQ0FBK0MsRUFBRTtBQUNqRDtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLDBHQUEwRztBQUMxRztBQUNBLEtBQUs7QUFDTDtBQUNBLGtHQUFrRztBQUNsRztBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLFlBQVk7O0FBRVo7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZ0JBQWdCLHVGQUF1RjtBQUN2Rzs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGFBQWEseUNBQXlDO0FBQ3REOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLElBQUk7QUFDSjtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHdDQUF3Qzs7QUFFeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGFBQWEseUNBQXlDO0FBQ3REOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLHFCQUFxQjtBQUNyQjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGdCQUFnQiwrREFBK0QsRUFBRTtBQUNqRjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZixjQUFjO0FBQ2QsY0FBYztBQUNkLGdCQUFnQjtBQUNoQixlQUFlO0FBQ2YsZ0JBQWdCO0FBQ2hCLGdCQUFnQjtBQUNoQixnQkFBZ0I7QUFDaEI7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0EsaUZBQWlGO0FBQ2pGOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsbUJBQW1CLEVBQUU7O0FBRXJCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTtBQUNKLGtCQUFrQjtBQUNsQjtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBLGtCQUFrQixlQUFlO0FBQ2pDO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGdCQUFnQjs7QUFFaEI7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxPQUFPOztBQUVQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSxtQkFBbUIsYUFBYTtBQUNoQztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHdCQUF3QjtBQUN4Qjs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUksR0FBRyxnQkFBZ0I7O0FBRXZCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxJQUFJLEdBQUcsZ0JBQWdCOztBQUV2QjtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLG1DQUFtQzs7QUFFbkM7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxNQUFNO0FBQ04sS0FBSztBQUNMLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ04sS0FBSztBQUNMLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUEsaUJBQWlCLG9DQUFvQztBQUNyRDtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQSxxQkFBcUI7O0FBRXJCLDhCQUE4QjtBQUM5QjtBQUNBO0FBQ0EsR0FBRyxFQUFFO0FBQ0w7QUFDQTtBQUNBLEdBQUc7QUFDSCxzQkFBc0I7QUFDdEI7QUFDQSxtQkFBbUI7QUFDbkIsd0JBQXdCO0FBQ3hCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRyxFQUFFOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHOztBQUVIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EscUVBQXFFO0FBQ3JFOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EscUJBQXFCOztBQUVyQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQSxxQkFBcUIscUJBQXFCO0FBQzFDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxrQkFBa0Isa0JBQWtCO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxxQkFBcUIsd0JBQXdCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSixXQUFXO0FBQ1g7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHFCQUFxQix3QkFBd0I7QUFDN0M7QUFDQSxjQUFjOztBQUVkOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxxQ0FBcUM7QUFDckMsUUFBUTtBQUNSO0FBQ0E7QUFDQSxTQUFTO0FBQ1Qsb0RBQW9EO0FBQ3BEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLHFDQUFxQzs7QUFFckM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ04sS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSw0QkFBNEI7QUFDNUIsNEJBQTRCO0FBQzVCLHlCQUF5QjtBQUN6QixzQkFBc0I7QUFDdEIscUJBQXFCO0FBQ3JCLDBCQUEwQjtBQUMxQixrQkFBa0I7QUFDbEIsNkJBQTZCO0FBQzdCLDBCQUEwQjtBQUMxQixpQ0FBaUM7QUFDakM7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsSUFBSTtBQUNKLEdBQUcsR0FBRyxnQkFBZ0I7O0FBRXRCO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRyxHQUFHLGdCQUFnQjs7QUFFdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQSxxQkFBcUI7QUFDckI7QUFDQSw0QkFBNEI7QUFDNUIsNEJBQTRCO0FBQzVCLHlCQUF5QjtBQUN6QixzQkFBc0I7QUFDdEIscUJBQXFCO0FBQ3JCLDBCQUEwQjtBQUMxQix5QkFBeUI7QUFDekIsa0JBQWtCO0FBQ2xCLGtCQUFrQjs7QUFFbEI7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsSUFBSTtBQUNKLEdBQUcsR0FBRyxnQkFBZ0I7QUFDdEI7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsd0RBQXdEO0FBQ3hEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEscUJBQXFCOztBQUVyQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHdCQUF3Qjs7QUFFeEI7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTs7QUFFQSxzQkFBc0IsU0FBUztBQUMvQjtBQUNBOztBQUVBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsdUNBQXVDO0FBQ3ZDOztBQUVBLDJDQUEyQztBQUMzQzs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBLHNDQUFzQyxzQkFBc0I7QUFDNUQsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsdUNBQXVDLHNCQUFzQjtBQUM3RCxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsS0FBSztBQUNMLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUEsc0JBQXNCLGFBQWE7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBOztBQUVBLHlCQUF5QixZQUFZO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDhGQUE4RjtBQUM5Rjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTs7QUFFSjtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDJDQUEyQyxzQkFBc0I7QUFDakUsUUFBUTtBQUNSO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLDBDQUEwQyxzQkFBc0I7QUFDaEU7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsMkJBQTJCOztBQUUzQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTs7QUFFQSxzRUFBc0U7QUFDdEU7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLHVCQUF1QjtBQUN2QixzQkFBc0I7QUFDdEI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUixPQUFPO0FBQ1A7O0FBRUE7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxzREFBc0QsZ0JBQWdCOztBQUV0RTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDhEQUE4RCxnQkFBZ0I7O0FBRTlFO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBLHNCQUFzQjs7QUFFdEI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsbURBQW1ELGdCQUFnQjtBQUNuRTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxxREFBcUQsZ0JBQWdCOztBQUVyRTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw2REFBNkQsZ0JBQWdCOztBQUU3RTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUEsc0JBQXNCOztBQUV0QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsbURBQW1ELGdCQUFnQjtBQUNuRTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxnTEFBZ0w7QUFDaEw7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSwrQkFBK0I7QUFDL0I7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxxQkFBcUI7QUFDckIseUJBQXlCO0FBQ3pCLDhCQUE4QjtBQUM5Qix1QkFBdUI7QUFDdkIseUJBQXlCO0FBQ3pCLG9DQUFvQztBQUNwQzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7O0FBRUEsd0JBQXdCOztBQUV4QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFFBQVE7QUFDUjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxNQUFNOztBQUVOO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxNQUFNOztBQUVOO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsTUFBTTtBQUNOOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNOztBQUVOO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQSxxQkFBcUIsaUJBQWlCO0FBQ3RDO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLHlKQUF5SjtBQUN6Sjs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSCx5SkFBeUo7QUFDeko7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EscUJBQXFCO0FBQ3JCLHFCQUFxQjtBQUNyQix1QkFBdUI7QUFDdkI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsK0NBQStDO0FBQy9DO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxPQUFPOztBQUVQO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0Esc0JBQXNCLDJCQUEyQjtBQUNqRDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxrQkFBa0IsbUZBQW1GO0FBQ3JHO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZ0JBQWdCLDZCQUE2QjtBQUM3Qzs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUEsNEJBQTRCLFFBQVE7QUFDcEM7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLENBQUMsRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUMxMHdCRDtBQUNBO0NBQzBDOztDQUNZOztBQUV0RDs7Ozs7Ozs7SUFPcUJBLGE7Ozs7Ozs7Ozs7Ozs7NkJBQ1I7QUFBQSx3QkFDZ0MsS0FBS0MsS0FEckM7QUFBQSxVQUNFQyxFQURGLGVBQ0VBLEVBREY7QUFBQSxVQUNNQyxLQUROLGVBQ01BLEtBRE47QUFBQSxVQUNhQyxRQURiLGVBQ2FBLFFBRGI7QUFBQSxVQUN1QkMsS0FEdkIsZUFDdUJBLEtBRHZCO0FBR0wsMEJBQ0k7QUFBSyxVQUFFLEVBQUVIO0FBQVQsK0JBQ3VCQyxLQUR2Qix1QkFFSTtBQUNJLGFBQUssRUFBRUUsS0FEWDtBQUVJLGdCQUFRO0FBQ0o7Ozs7Ozs7OztBQVNBLDBCQUFBQyxDQUFDO0FBQUEsaUJBQUlGLFFBQVEsQ0FBQztBQUFFQyxpQkFBSyxFQUFFQyxDQUFDLENBQUNDLE1BQUYsQ0FBU0Y7QUFBbEIsV0FBRCxDQUFaO0FBQUE7QUFaVCxRQUZKLENBREo7QUFvQkg7Ozs7RUF4QnNDRywrQzs7O0FBMkIzQ1IsYUFBYSxDQUFDUyxZQUFkLEdBQTZCLEVBQTdCO0FBRUFULGFBQWEsQ0FBQ1UsU0FBZCxHQUEwQjtBQUN0Qjs7O0FBR0FSLElBQUUsRUFBRVMsaURBQVMsQ0FBQ0MsTUFKUTs7QUFNdEI7OztBQUdBVCxPQUFLLEVBQUVRLGlEQUFTLENBQUNDLE1BQVYsQ0FBaUJDLFVBVEY7O0FBV3RCOzs7QUFHQVIsT0FBSyxFQUFFTSxpREFBUyxDQUFDQyxNQWRLOztBQWdCdEI7Ozs7QUFJQVIsVUFBUSxFQUFFTyxpREFBUyxDQUFDRztBQXBCRSxDQUExQixDIiwiZmlsZSI6IjNiOTk1YzctbWFpbi13cHMtaG1yLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gSW1wb3J0c1xudmFyIF9fX0NTU19MT0FERVJfQVBJX0lNUE9SVF9fXyA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jc3MtbG9hZGVyL2Rpc3QvcnVudGltZS9hcGkuanNcIik7XG5leHBvcnRzID0gX19fQ1NTX0xPQURFUl9BUElfSU1QT1JUX19fKGZhbHNlKTtcbi8vIE1vZHVsZVxuZXhwb3J0cy5wdXNoKFttb2R1bGUuaWQsIFwiLyogVGFidWxhdG9yIHY0LjcuMCAoYykgT2xpdmVyIEZvbGtlcmQgKi9cXG4udGFidWxhdG9ye3Bvc2l0aW9uOnJlbGF0aXZlO2JvcmRlcjoxcHggc29saWQgIzk5OTtiYWNrZ3JvdW5kLWNvbG9yOiM4ODg7Zm9udC1zaXplOjE0cHg7dGV4dC1hbGlnbjpsZWZ0O292ZXJmbG93OmhpZGRlbjt0cmFuc2Zvcm06dHJhbnNsYXRleigwKX0udGFidWxhdG9yW3RhYnVsYXRvci1sYXlvdXQ9Zml0RGF0YUZpbGxdIC50YWJ1bGF0b3ItdGFibGVIb2xkZXIgLnRhYnVsYXRvci10YWJsZXttaW4td2lkdGg6MTAwJX0udGFidWxhdG9yW3RhYnVsYXRvci1sYXlvdXQ9Zml0RGF0YVRhYmxlXXtkaXNwbGF5OmlubGluZS1ibG9ja30udGFidWxhdG9yLnRhYnVsYXRvci1ibG9jay1zZWxlY3R7LXdlYmtpdC11c2VyLXNlbGVjdDpub25lOy1tcy11c2VyLXNlbGVjdDpub25lO3VzZXItc2VsZWN0Om5vbmV9LnRhYnVsYXRvciAudGFidWxhdG9yLWhlYWRlcntwb3NpdGlvbjpyZWxhdGl2ZTtib3gtc2l6aW5nOmJvcmRlci1ib3g7d2lkdGg6MTAwJTtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjOTk5O2JhY2tncm91bmQtY29sb3I6I2U2ZTZlNjtjb2xvcjojNTU1O2ZvbnQtd2VpZ2h0OjcwMDt3aGl0ZS1zcGFjZTpub3dyYXA7b3ZlcmZsb3c6aGlkZGVuOy1tb3otdXNlci1zZWxlY3Q6bm9uZTsta2h0bWwtdXNlci1zZWxlY3Q6bm9uZTstd2Via2l0LXVzZXItc2VsZWN0Om5vbmU7LW8tdXNlci1zZWxlY3Q6bm9uZX0udGFidWxhdG9yIC50YWJ1bGF0b3ItaGVhZGVyLnRhYnVsYXRvci1oZWFkZXItaGlkZGVue2Rpc3BsYXk6bm9uZX0udGFidWxhdG9yIC50YWJ1bGF0b3ItaGVhZGVyIC50YWJ1bGF0b3ItY29se2Rpc3BsYXk6aW5saW5lLWJsb2NrO3Bvc2l0aW9uOnJlbGF0aXZlO2JveC1zaXppbmc6Ym9yZGVyLWJveDtib3JkZXItcmlnaHQ6MXB4IHNvbGlkICNhYWE7YmFja2dyb3VuZDojZTZlNmU2O3RleHQtYWxpZ246bGVmdDt2ZXJ0aWNhbC1hbGlnbjpib3R0b207b3ZlcmZsb3c6aGlkZGVufS50YWJ1bGF0b3IgLnRhYnVsYXRvci1oZWFkZXIgLnRhYnVsYXRvci1jb2wudGFidWxhdG9yLW1vdmluZ3twb3NpdGlvbjphYnNvbHV0ZTtib3JkZXI6MXB4IHNvbGlkICM5OTk7YmFja2dyb3VuZDojY2RjZGNkO3BvaW50ZXItZXZlbnRzOm5vbmV9LnRhYnVsYXRvciAudGFidWxhdG9yLWhlYWRlciAudGFidWxhdG9yLWNvbCAudGFidWxhdG9yLWNvbC1jb250ZW50e2JveC1zaXppbmc6Ym9yZGVyLWJveDtwb3NpdGlvbjpyZWxhdGl2ZTtwYWRkaW5nOjRweH0udGFidWxhdG9yIC50YWJ1bGF0b3ItaGVhZGVyIC50YWJ1bGF0b3ItY29sIC50YWJ1bGF0b3ItY29sLWNvbnRlbnQgLnRhYnVsYXRvci1oZWFkZXItbWVudS1idXR0b257cGFkZGluZzowIDhweH0udGFidWxhdG9yIC50YWJ1bGF0b3ItaGVhZGVyIC50YWJ1bGF0b3ItY29sIC50YWJ1bGF0b3ItY29sLWNvbnRlbnQgLnRhYnVsYXRvci1oZWFkZXItbWVudS1idXR0b246aG92ZXJ7Y3Vyc29yOnBvaW50ZXI7b3BhY2l0eTouNn0udGFidWxhdG9yIC50YWJ1bGF0b3ItaGVhZGVyIC50YWJ1bGF0b3ItY29sIC50YWJ1bGF0b3ItY29sLWNvbnRlbnQgLnRhYnVsYXRvci1jb2wtdGl0bGV7Ym94LXNpemluZzpib3JkZXItYm94O3dpZHRoOjEwMCU7d2hpdGUtc3BhY2U6bm93cmFwO292ZXJmbG93OmhpZGRlbjt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzO3ZlcnRpY2FsLWFsaWduOmJvdHRvbX0udGFidWxhdG9yIC50YWJ1bGF0b3ItaGVhZGVyIC50YWJ1bGF0b3ItY29sIC50YWJ1bGF0b3ItY29sLWNvbnRlbnQgLnRhYnVsYXRvci1jb2wtdGl0bGUgLnRhYnVsYXRvci10aXRsZS1lZGl0b3J7Ym94LXNpemluZzpib3JkZXItYm94O3dpZHRoOjEwMCU7Ym9yZGVyOjFweCBzb2xpZCAjOTk5O3BhZGRpbmc6MXB4O2JhY2tncm91bmQ6I2ZmZn0udGFidWxhdG9yIC50YWJ1bGF0b3ItaGVhZGVyIC50YWJ1bGF0b3ItY29sIC50YWJ1bGF0b3ItY29sLWNvbnRlbnQgLnRhYnVsYXRvci1hcnJvd3tkaXNwbGF5OmlubGluZS1ibG9jaztwb3NpdGlvbjphYnNvbHV0ZTt0b3A6OXB4O3JpZ2h0OjhweDt3aWR0aDowO2hlaWdodDowO2JvcmRlci1sZWZ0OjZweCBzb2xpZCB0cmFuc3BhcmVudDtib3JkZXItcmlnaHQ6NnB4IHNvbGlkIHRyYW5zcGFyZW50O2JvcmRlci1ib3R0b206NnB4IHNvbGlkICNiYmJ9LnRhYnVsYXRvciAudGFidWxhdG9yLWhlYWRlciAudGFidWxhdG9yLWNvbC50YWJ1bGF0b3ItY29sLWdyb3VwIC50YWJ1bGF0b3ItY29sLWdyb3VwLWNvbHN7cG9zaXRpb246cmVsYXRpdmU7ZGlzcGxheTotbXMtZmxleGJveDtkaXNwbGF5OmZsZXg7Ym9yZGVyLXRvcDoxcHggc29saWQgI2FhYTtvdmVyZmxvdzpoaWRkZW47bWFyZ2luLXJpZ2h0Oi0xcHh9LnRhYnVsYXRvciAudGFidWxhdG9yLWhlYWRlciAudGFidWxhdG9yLWNvbDpmaXJzdC1jaGlsZCAudGFidWxhdG9yLWNvbC1yZXNpemUtaGFuZGxlLnByZXZ7ZGlzcGxheTpub25lfS50YWJ1bGF0b3IgLnRhYnVsYXRvci1oZWFkZXIgLnRhYnVsYXRvci1jb2wgLnRhYnVsYXRvci1oZWFkZXItZmlsdGVye3Bvc2l0aW9uOnJlbGF0aXZlO2JveC1zaXppbmc6Ym9yZGVyLWJveDttYXJnaW4tdG9wOjJweDt3aWR0aDoxMDAlO3RleHQtYWxpZ246Y2VudGVyfS50YWJ1bGF0b3IgLnRhYnVsYXRvci1oZWFkZXIgLnRhYnVsYXRvci1jb2wgLnRhYnVsYXRvci1oZWFkZXItZmlsdGVyIHRleHRhcmVhe2hlaWdodDphdXRvIWltcG9ydGFudH0udGFidWxhdG9yIC50YWJ1bGF0b3ItaGVhZGVyIC50YWJ1bGF0b3ItY29sIC50YWJ1bGF0b3ItaGVhZGVyLWZpbHRlciBzdmd7bWFyZ2luLXRvcDozcHh9LnRhYnVsYXRvciAudGFidWxhdG9yLWhlYWRlciAudGFidWxhdG9yLWNvbCAudGFidWxhdG9yLWhlYWRlci1maWx0ZXIgaW5wdXQ6Oi1tcy1jbGVhcnt3aWR0aDowO2hlaWdodDowfS50YWJ1bGF0b3IgLnRhYnVsYXRvci1oZWFkZXIgLnRhYnVsYXRvci1jb2wudGFidWxhdG9yLXNvcnRhYmxlIC50YWJ1bGF0b3ItY29sLXRpdGxle3BhZGRpbmctcmlnaHQ6MjVweH0udGFidWxhdG9yIC50YWJ1bGF0b3ItaGVhZGVyIC50YWJ1bGF0b3ItY29sLnRhYnVsYXRvci1zb3J0YWJsZTpob3ZlcntjdXJzb3I6cG9pbnRlcjtiYWNrZ3JvdW5kLWNvbG9yOiNjZGNkY2R9LnRhYnVsYXRvciAudGFidWxhdG9yLWhlYWRlciAudGFidWxhdG9yLWNvbC50YWJ1bGF0b3Itc29ydGFibGVbYXJpYS1zb3J0PW5vbmVdIC50YWJ1bGF0b3ItY29sLWNvbnRlbnQgLnRhYnVsYXRvci1hcnJvd3tib3JkZXItdG9wOm5vbmU7Ym9yZGVyLWJvdHRvbTo2cHggc29saWQgI2JiYn0udGFidWxhdG9yIC50YWJ1bGF0b3ItaGVhZGVyIC50YWJ1bGF0b3ItY29sLnRhYnVsYXRvci1zb3J0YWJsZVthcmlhLXNvcnQ9YXNjXSAudGFidWxhdG9yLWNvbC1jb250ZW50IC50YWJ1bGF0b3ItYXJyb3d7Ym9yZGVyLXRvcDpub25lO2JvcmRlci1ib3R0b206NnB4IHNvbGlkICM2NjZ9LnRhYnVsYXRvciAudGFidWxhdG9yLWhlYWRlciAudGFidWxhdG9yLWNvbC50YWJ1bGF0b3Itc29ydGFibGVbYXJpYS1zb3J0PWRlc2NdIC50YWJ1bGF0b3ItY29sLWNvbnRlbnQgLnRhYnVsYXRvci1hcnJvd3tib3JkZXItdG9wOjZweCBzb2xpZCAjNjY2O2JvcmRlci1ib3R0b206bm9uZX0udGFidWxhdG9yIC50YWJ1bGF0b3ItaGVhZGVyIC50YWJ1bGF0b3ItY29sLnRhYnVsYXRvci1jb2wtdmVydGljYWwgLnRhYnVsYXRvci1jb2wtY29udGVudCAudGFidWxhdG9yLWNvbC10aXRsZXstbXMtd3JpdGluZy1tb2RlOnRiLXJsO3dyaXRpbmctbW9kZTp2ZXJ0aWNhbC1ybDt0ZXh0LW9yaWVudGF0aW9uOm1peGVkO2Rpc3BsYXk6LW1zLWZsZXhib3g7ZGlzcGxheTpmbGV4Oy1tcy1mbGV4LWFsaWduOmNlbnRlcjthbGlnbi1pdGVtczpjZW50ZXI7LW1zLWZsZXgtcGFjazpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlcn0udGFidWxhdG9yIC50YWJ1bGF0b3ItaGVhZGVyIC50YWJ1bGF0b3ItY29sLnRhYnVsYXRvci1jb2wtdmVydGljYWwudGFidWxhdG9yLWNvbC12ZXJ0aWNhbC1mbGlwIC50YWJ1bGF0b3ItY29sLXRpdGxle3RyYW5zZm9ybTpyb3RhdGUoMTgwZGVnKX0udGFidWxhdG9yIC50YWJ1bGF0b3ItaGVhZGVyIC50YWJ1bGF0b3ItY29sLnRhYnVsYXRvci1jb2wtdmVydGljYWwudGFidWxhdG9yLXNvcnRhYmxlIC50YWJ1bGF0b3ItY29sLXRpdGxle3BhZGRpbmctcmlnaHQ6MDtwYWRkaW5nLXRvcDoyMHB4fS50YWJ1bGF0b3IgLnRhYnVsYXRvci1oZWFkZXIgLnRhYnVsYXRvci1jb2wudGFidWxhdG9yLWNvbC12ZXJ0aWNhbC50YWJ1bGF0b3Itc29ydGFibGUudGFidWxhdG9yLWNvbC12ZXJ0aWNhbC1mbGlwIC50YWJ1bGF0b3ItY29sLXRpdGxle3BhZGRpbmctcmlnaHQ6MDtwYWRkaW5nLWJvdHRvbToyMHB4fS50YWJ1bGF0b3IgLnRhYnVsYXRvci1oZWFkZXIgLnRhYnVsYXRvci1jb2wudGFidWxhdG9yLWNvbC12ZXJ0aWNhbC50YWJ1bGF0b3Itc29ydGFibGUgLnRhYnVsYXRvci1hcnJvd3tyaWdodDpjYWxjKDUwJSAtIDZweCl9LnRhYnVsYXRvciAudGFidWxhdG9yLWhlYWRlciAudGFidWxhdG9yLWZyb3plbntkaXNwbGF5OmlubGluZS1ibG9jaztwb3NpdGlvbjphYnNvbHV0ZTt6LWluZGV4OjEwfS50YWJ1bGF0b3IgLnRhYnVsYXRvci1oZWFkZXIgLnRhYnVsYXRvci1mcm96ZW4udGFidWxhdG9yLWZyb3plbi1sZWZ0e2JvcmRlci1yaWdodDoycHggc29saWQgI2FhYX0udGFidWxhdG9yIC50YWJ1bGF0b3ItaGVhZGVyIC50YWJ1bGF0b3ItZnJvemVuLnRhYnVsYXRvci1mcm96ZW4tcmlnaHR7Ym9yZGVyLWxlZnQ6MnB4IHNvbGlkICNhYWF9LnRhYnVsYXRvciAudGFidWxhdG9yLWhlYWRlciAudGFidWxhdG9yLWNhbGNzLWhvbGRlcntib3gtc2l6aW5nOmJvcmRlci1ib3g7bWluLXdpZHRoOjYwMCU7YmFja2dyb3VuZDojZjNmM2YzIWltcG9ydGFudDtib3JkZXItdG9wOjFweCBzb2xpZCAjYWFhO2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNhYWE7b3ZlcmZsb3c6aGlkZGVufS50YWJ1bGF0b3IgLnRhYnVsYXRvci1oZWFkZXIgLnRhYnVsYXRvci1jYWxjcy1ob2xkZXIgLnRhYnVsYXRvci1yb3d7YmFja2dyb3VuZDojZjNmM2YzIWltcG9ydGFudH0udGFidWxhdG9yIC50YWJ1bGF0b3ItaGVhZGVyIC50YWJ1bGF0b3ItY2FsY3MtaG9sZGVyIC50YWJ1bGF0b3Itcm93IC50YWJ1bGF0b3ItY29sLXJlc2l6ZS1oYW5kbGV7ZGlzcGxheTpub25lfS50YWJ1bGF0b3IgLnRhYnVsYXRvci1oZWFkZXIgLnRhYnVsYXRvci1mcm96ZW4tcm93cy1ob2xkZXJ7bWluLXdpZHRoOjYwMCV9LnRhYnVsYXRvciAudGFidWxhdG9yLWhlYWRlciAudGFidWxhdG9yLWZyb3plbi1yb3dzLWhvbGRlcjplbXB0eXtkaXNwbGF5Om5vbmV9LnRhYnVsYXRvciAudGFidWxhdG9yLXRhYmxlSG9sZGVye3Bvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOjEwMCU7d2hpdGUtc3BhY2U6bm93cmFwO292ZXJmbG93OmF1dG87LXdlYmtpdC1vdmVyZmxvdy1zY3JvbGxpbmc6dG91Y2h9LnRhYnVsYXRvciAudGFidWxhdG9yLXRhYmxlSG9sZGVyOmZvY3Vze291dGxpbmU6bm9uZX0udGFidWxhdG9yIC50YWJ1bGF0b3ItdGFibGVIb2xkZXIgLnRhYnVsYXRvci1wbGFjZWhvbGRlcntib3gtc2l6aW5nOmJvcmRlci1ib3g7ZGlzcGxheTotbXMtZmxleGJveDtkaXNwbGF5OmZsZXg7LW1zLWZsZXgtYWxpZ246Y2VudGVyO2FsaWduLWl0ZW1zOmNlbnRlcjt3aWR0aDoxMDAlfS50YWJ1bGF0b3IgLnRhYnVsYXRvci10YWJsZUhvbGRlciAudGFidWxhdG9yLXBsYWNlaG9sZGVyW3RhYnVsYXRvci1yZW5kZXItbW9kZT12aXJ0dWFsXXttaW4taGVpZ2h0OjEwMCU7bWluLXdpZHRoOjEwMCV9LnRhYnVsYXRvciAudGFidWxhdG9yLXRhYmxlSG9sZGVyIC50YWJ1bGF0b3ItcGxhY2Vob2xkZXIgc3BhbntkaXNwbGF5OmlubGluZS1ibG9jazttYXJnaW46MCBhdXRvO3BhZGRpbmc6MTBweDtjb2xvcjojY2NjO2ZvbnQtd2VpZ2h0OjcwMDtmb250LXNpemU6MjBweH0udGFidWxhdG9yIC50YWJ1bGF0b3ItdGFibGVIb2xkZXIgLnRhYnVsYXRvci10YWJsZXtwb3NpdGlvbjpyZWxhdGl2ZTtkaXNwbGF5OmlubGluZS1ibG9jaztiYWNrZ3JvdW5kLWNvbG9yOiNmZmY7d2hpdGUtc3BhY2U6bm93cmFwO292ZXJmbG93OnZpc2libGU7Y29sb3I6IzMzM30udGFidWxhdG9yIC50YWJ1bGF0b3ItdGFibGVIb2xkZXIgLnRhYnVsYXRvci10YWJsZSAudGFidWxhdG9yLXJvdy50YWJ1bGF0b3ItY2FsY3N7Zm9udC13ZWlnaHQ6NzAwO2JhY2tncm91bmQ6I2UyZTJlMiFpbXBvcnRhbnR9LnRhYnVsYXRvciAudGFidWxhdG9yLXRhYmxlSG9sZGVyIC50YWJ1bGF0b3ItdGFibGUgLnRhYnVsYXRvci1yb3cudGFidWxhdG9yLWNhbGNzLnRhYnVsYXRvci1jYWxjcy10b3B7Ym9yZGVyLWJvdHRvbToycHggc29saWQgI2FhYX0udGFidWxhdG9yIC50YWJ1bGF0b3ItdGFibGVIb2xkZXIgLnRhYnVsYXRvci10YWJsZSAudGFidWxhdG9yLXJvdy50YWJ1bGF0b3ItY2FsY3MudGFidWxhdG9yLWNhbGNzLWJvdHRvbXtib3JkZXItdG9wOjJweCBzb2xpZCAjYWFhfS50YWJ1bGF0b3IgLnRhYnVsYXRvci1mb290ZXJ7cGFkZGluZzo1cHggMTBweDtib3JkZXItdG9wOjFweCBzb2xpZCAjOTk5O2JhY2tncm91bmQtY29sb3I6I2U2ZTZlNjt0ZXh0LWFsaWduOnJpZ2h0O2NvbG9yOiM1NTU7Zm9udC13ZWlnaHQ6NzAwO3doaXRlLXNwYWNlOm5vd3JhcDstbXMtdXNlci1zZWxlY3Q6bm9uZTt1c2VyLXNlbGVjdDpub25lOy1tb3otdXNlci1zZWxlY3Q6bm9uZTsta2h0bWwtdXNlci1zZWxlY3Q6bm9uZTstd2Via2l0LXVzZXItc2VsZWN0Om5vbmU7LW8tdXNlci1zZWxlY3Q6bm9uZX0udGFidWxhdG9yIC50YWJ1bGF0b3ItZm9vdGVyIC50YWJ1bGF0b3ItY2FsY3MtaG9sZGVye2JveC1zaXppbmc6Ym9yZGVyLWJveDt3aWR0aDpjYWxjKDEwMCUgKyAyMHB4KTttYXJnaW46LTVweCAtMTBweCA1cHg7dGV4dC1hbGlnbjpsZWZ0O2JhY2tncm91bmQ6I2YzZjNmMyFpbXBvcnRhbnQ7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI2FhYTtib3JkZXItdG9wOjFweCBzb2xpZCAjYWFhO292ZXJmbG93OmhpZGRlbn0udGFidWxhdG9yIC50YWJ1bGF0b3ItZm9vdGVyIC50YWJ1bGF0b3ItY2FsY3MtaG9sZGVyIC50YWJ1bGF0b3Itcm93e2JhY2tncm91bmQ6I2YzZjNmMyFpbXBvcnRhbnR9LnRhYnVsYXRvciAudGFidWxhdG9yLWZvb3RlciAudGFidWxhdG9yLWNhbGNzLWhvbGRlciAudGFidWxhdG9yLXJvdyAudGFidWxhdG9yLWNvbC1yZXNpemUtaGFuZGxle2Rpc3BsYXk6bm9uZX0udGFidWxhdG9yIC50YWJ1bGF0b3ItZm9vdGVyIC50YWJ1bGF0b3ItY2FsY3MtaG9sZGVyOm9ubHktY2hpbGR7bWFyZ2luLWJvdHRvbTotNXB4O2JvcmRlci1ib3R0b206bm9uZX0udGFidWxhdG9yIC50YWJ1bGF0b3ItZm9vdGVyIC50YWJ1bGF0b3ItcGFnaW5hdG9ye2NvbG9yOiM1NTU7Zm9udC1mYW1pbHk6aW5oZXJpdDtmb250LXdlaWdodDppbmhlcml0O2ZvbnQtc2l6ZTppbmhlcml0fS50YWJ1bGF0b3IgLnRhYnVsYXRvci1mb290ZXIgLnRhYnVsYXRvci1wYWdlLXNpemV7ZGlzcGxheTppbmxpbmUtYmxvY2s7bWFyZ2luOjAgNXB4O3BhZGRpbmc6MnB4IDVweDtib3JkZXI6MXB4IHNvbGlkICNhYWE7Ym9yZGVyLXJhZGl1czozcHh9LnRhYnVsYXRvciAudGFidWxhdG9yLWZvb3RlciAudGFidWxhdG9yLXBhZ2Vze21hcmdpbjowIDdweH0udGFidWxhdG9yIC50YWJ1bGF0b3ItZm9vdGVyIC50YWJ1bGF0b3ItcGFnZXtkaXNwbGF5OmlubGluZS1ibG9jazttYXJnaW46MCAycHg7cGFkZGluZzoycHggNXB4O2JvcmRlcjoxcHggc29saWQgI2FhYTtib3JkZXItcmFkaXVzOjNweDtiYWNrZ3JvdW5kOmhzbGEoMCwwJSwxMDAlLC4yKX0udGFidWxhdG9yIC50YWJ1bGF0b3ItZm9vdGVyIC50YWJ1bGF0b3ItcGFnZS5hY3RpdmV7Y29sb3I6I2QwMH0udGFidWxhdG9yIC50YWJ1bGF0b3ItZm9vdGVyIC50YWJ1bGF0b3ItcGFnZTpkaXNhYmxlZHtvcGFjaXR5Oi41fS50YWJ1bGF0b3IgLnRhYnVsYXRvci1mb290ZXIgLnRhYnVsYXRvci1wYWdlOm5vdCguZGlzYWJsZWQpOmhvdmVye2N1cnNvcjpwb2ludGVyO2JhY2tncm91bmQ6cmdiYSgwLDAsMCwuMik7Y29sb3I6I2ZmZn0udGFidWxhdG9yIC50YWJ1bGF0b3ItY29sLXJlc2l6ZS1oYW5kbGV7cG9zaXRpb246YWJzb2x1dGU7cmlnaHQ6MDt0b3A6MDtib3R0b206MDt3aWR0aDo1cHh9LnRhYnVsYXRvciAudGFidWxhdG9yLWNvbC1yZXNpemUtaGFuZGxlLnByZXZ7bGVmdDowO3JpZ2h0OmF1dG99LnRhYnVsYXRvciAudGFidWxhdG9yLWNvbC1yZXNpemUtaGFuZGxlOmhvdmVye2N1cnNvcjpldy1yZXNpemV9LnRhYnVsYXRvciAudGFidWxhdG9yLWxvYWRlcntwb3NpdGlvbjphYnNvbHV0ZTtkaXNwbGF5Oi1tcy1mbGV4Ym94O2Rpc3BsYXk6ZmxleDstbXMtZmxleC1hbGlnbjpjZW50ZXI7YWxpZ24taXRlbXM6Y2VudGVyO3RvcDowO2xlZnQ6MDt6LWluZGV4OjEwMDtoZWlnaHQ6MTAwJTt3aWR0aDoxMDAlO2JhY2tncm91bmQ6cmdiYSgwLDAsMCwuNCk7dGV4dC1hbGlnbjpjZW50ZXJ9LnRhYnVsYXRvciAudGFidWxhdG9yLWxvYWRlciAudGFidWxhdG9yLWxvYWRlci1tc2d7ZGlzcGxheTppbmxpbmUtYmxvY2s7bWFyZ2luOjAgYXV0bztwYWRkaW5nOjEwcHggMjBweDtib3JkZXItcmFkaXVzOjEwcHg7YmFja2dyb3VuZDojZmZmO2ZvbnQtd2VpZ2h0OjcwMDtmb250LXNpemU6MTZweH0udGFidWxhdG9yIC50YWJ1bGF0b3ItbG9hZGVyIC50YWJ1bGF0b3ItbG9hZGVyLW1zZy50YWJ1bGF0b3ItbG9hZGluZ3tib3JkZXI6NHB4IHNvbGlkICMzMzM7Y29sb3I6IzAwMH0udGFidWxhdG9yIC50YWJ1bGF0b3ItbG9hZGVyIC50YWJ1bGF0b3ItbG9hZGVyLW1zZy50YWJ1bGF0b3ItZXJyb3J7Ym9yZGVyOjRweCBzb2xpZCAjZDAwO2NvbG9yOiM1OTAwMDB9LnRhYnVsYXRvci1yb3d7cG9zaXRpb246cmVsYXRpdmU7Ym94LXNpemluZzpib3JkZXItYm94O21pbi1oZWlnaHQ6MjJweDtiYWNrZ3JvdW5kLWNvbG9yOiNmZmZ9LnRhYnVsYXRvci1yb3cudGFidWxhdG9yLXJvdy1ldmVue2JhY2tncm91bmQtY29sb3I6I2VmZWZlZn0udGFidWxhdG9yLXJvdy50YWJ1bGF0b3Itc2VsZWN0YWJsZTpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOiNiYmI7Y3Vyc29yOnBvaW50ZXJ9LnRhYnVsYXRvci1yb3cudGFidWxhdG9yLXNlbGVjdGVke2JhY2tncm91bmQtY29sb3I6IzlhYmNlYX0udGFidWxhdG9yLXJvdy50YWJ1bGF0b3Itc2VsZWN0ZWQ6aG92ZXJ7YmFja2dyb3VuZC1jb2xvcjojNzY5YmNjO2N1cnNvcjpwb2ludGVyfS50YWJ1bGF0b3Itcm93LnRhYnVsYXRvci1yb3ctbW92aW5ne2JvcmRlcjoxcHggc29saWQgIzAwMDtiYWNrZ3JvdW5kOiNmZmZ9LnRhYnVsYXRvci1yb3cudGFidWxhdG9yLW1vdmluZ3twb3NpdGlvbjphYnNvbHV0ZTtib3JkZXItdG9wOjFweCBzb2xpZCAjYWFhO2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNhYWE7cG9pbnRlci1ldmVudHM6bm9uZTt6LWluZGV4OjE1fS50YWJ1bGF0b3Itcm93IC50YWJ1bGF0b3Itcm93LXJlc2l6ZS1oYW5kbGV7cG9zaXRpb246YWJzb2x1dGU7cmlnaHQ6MDtib3R0b206MDtsZWZ0OjA7aGVpZ2h0OjVweH0udGFidWxhdG9yLXJvdyAudGFidWxhdG9yLXJvdy1yZXNpemUtaGFuZGxlLnByZXZ7dG9wOjA7Ym90dG9tOmF1dG99LnRhYnVsYXRvci1yb3cgLnRhYnVsYXRvci1yb3ctcmVzaXplLWhhbmRsZTpob3ZlcntjdXJzb3I6bnMtcmVzaXplfS50YWJ1bGF0b3Itcm93IC50YWJ1bGF0b3ItZnJvemVue2Rpc3BsYXk6aW5saW5lLWJsb2NrO3Bvc2l0aW9uOmFic29sdXRlO2JhY2tncm91bmQtY29sb3I6aW5oZXJpdDt6LWluZGV4OjEwfS50YWJ1bGF0b3Itcm93IC50YWJ1bGF0b3ItZnJvemVuLnRhYnVsYXRvci1mcm96ZW4tbGVmdHtib3JkZXItcmlnaHQ6MnB4IHNvbGlkICNhYWF9LnRhYnVsYXRvci1yb3cgLnRhYnVsYXRvci1mcm96ZW4udGFidWxhdG9yLWZyb3plbi1yaWdodHtib3JkZXItbGVmdDoycHggc29saWQgI2FhYX0udGFidWxhdG9yLXJvdyAudGFidWxhdG9yLXJlc3BvbnNpdmUtY29sbGFwc2V7Ym94LXNpemluZzpib3JkZXItYm94O3BhZGRpbmc6NXB4O2JvcmRlci10b3A6MXB4IHNvbGlkICNhYWE7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI2FhYX0udGFidWxhdG9yLXJvdyAudGFidWxhdG9yLXJlc3BvbnNpdmUtY29sbGFwc2U6ZW1wdHl7ZGlzcGxheTpub25lfS50YWJ1bGF0b3Itcm93IC50YWJ1bGF0b3ItcmVzcG9uc2l2ZS1jb2xsYXBzZSB0YWJsZXtmb250LXNpemU6MTRweH0udGFidWxhdG9yLXJvdyAudGFidWxhdG9yLXJlc3BvbnNpdmUtY29sbGFwc2UgdGFibGUgdHIgdGR7cG9zaXRpb246cmVsYXRpdmV9LnRhYnVsYXRvci1yb3cgLnRhYnVsYXRvci1yZXNwb25zaXZlLWNvbGxhcHNlIHRhYmxlIHRyIHRkOmZpcnN0LW9mLXR5cGV7cGFkZGluZy1yaWdodDoxMHB4fS50YWJ1bGF0b3Itcm93IC50YWJ1bGF0b3ItY2VsbHtkaXNwbGF5OmlubGluZS1ibG9jaztwb3NpdGlvbjpyZWxhdGl2ZTtib3gtc2l6aW5nOmJvcmRlci1ib3g7cGFkZGluZzo0cHg7Ym9yZGVyLXJpZ2h0OjFweCBzb2xpZCAjYWFhO3ZlcnRpY2FsLWFsaWduOm1pZGRsZTt3aGl0ZS1zcGFjZTpub3dyYXA7b3ZlcmZsb3c6aGlkZGVuO3RleHQtb3ZlcmZsb3c6ZWxsaXBzaXN9LnRhYnVsYXRvci1yb3cgLnRhYnVsYXRvci1jZWxsLnRhYnVsYXRvci1lZGl0aW5ne2JvcmRlcjoxcHggc29saWQgIzFkNjhjZDtwYWRkaW5nOjB9LnRhYnVsYXRvci1yb3cgLnRhYnVsYXRvci1jZWxsLnRhYnVsYXRvci1lZGl0aW5nIGlucHV0LC50YWJ1bGF0b3Itcm93IC50YWJ1bGF0b3ItY2VsbC50YWJ1bGF0b3ItZWRpdGluZyBzZWxlY3R7Ym9yZGVyOjFweDtiYWNrZ3JvdW5kOnRyYW5zcGFyZW50fS50YWJ1bGF0b3Itcm93IC50YWJ1bGF0b3ItY2VsbC50YWJ1bGF0b3ItdmFsaWRhdGlvbi1mYWlse2JvcmRlcjoxcHggc29saWQgI2QwMH0udGFidWxhdG9yLXJvdyAudGFidWxhdG9yLWNlbGwudGFidWxhdG9yLXZhbGlkYXRpb24tZmFpbCBpbnB1dCwudGFidWxhdG9yLXJvdyAudGFidWxhdG9yLWNlbGwudGFidWxhdG9yLXZhbGlkYXRpb24tZmFpbCBzZWxlY3R7Ym9yZGVyOjFweDtiYWNrZ3JvdW5kOnRyYW5zcGFyZW50O2NvbG9yOiNkMDB9LnRhYnVsYXRvci1yb3cgLnRhYnVsYXRvci1jZWxsOmZpcnN0LWNoaWxkIC50YWJ1bGF0b3ItY29sLXJlc2l6ZS1oYW5kbGUucHJldntkaXNwbGF5Om5vbmV9LnRhYnVsYXRvci1yb3cgLnRhYnVsYXRvci1jZWxsLnRhYnVsYXRvci1yb3ctaGFuZGxle2Rpc3BsYXk6LW1zLWlubGluZS1mbGV4Ym94O2Rpc3BsYXk6aW5saW5lLWZsZXg7LW1zLWZsZXgtYWxpZ246Y2VudGVyO2FsaWduLWl0ZW1zOmNlbnRlcjstbXMtZmxleC1wYWNrOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOy1tb3otdXNlci1zZWxlY3Q6bm9uZTsta2h0bWwtdXNlci1zZWxlY3Q6bm9uZTstd2Via2l0LXVzZXItc2VsZWN0Om5vbmU7LW8tdXNlci1zZWxlY3Q6bm9uZX0udGFidWxhdG9yLXJvdyAudGFidWxhdG9yLWNlbGwudGFidWxhdG9yLXJvdy1oYW5kbGUgLnRhYnVsYXRvci1yb3ctaGFuZGxlLWJveHt3aWR0aDo4MCV9LnRhYnVsYXRvci1yb3cgLnRhYnVsYXRvci1jZWxsLnRhYnVsYXRvci1yb3ctaGFuZGxlIC50YWJ1bGF0b3Itcm93LWhhbmRsZS1ib3ggLnRhYnVsYXRvci1yb3ctaGFuZGxlLWJhcnt3aWR0aDoxMDAlO2hlaWdodDozcHg7bWFyZ2luLXRvcDoycHg7YmFja2dyb3VuZDojNjY2fS50YWJ1bGF0b3Itcm93IC50YWJ1bGF0b3ItY2VsbCAudGFidWxhdG9yLWRhdGEtdHJlZS1icmFuY2h7ZGlzcGxheTppbmxpbmUtYmxvY2s7dmVydGljYWwtYWxpZ246bWlkZGxlO2hlaWdodDo5cHg7d2lkdGg6N3B4O21hcmdpbi10b3A6LTlweDttYXJnaW4tcmlnaHQ6NXB4O2JvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6MXB4O2JvcmRlci1sZWZ0OjJweCBzb2xpZCAjYWFhO2JvcmRlci1ib3R0b206MnB4IHNvbGlkICNhYWF9LnRhYnVsYXRvci1yb3cgLnRhYnVsYXRvci1jZWxsIC50YWJ1bGF0b3ItZGF0YS10cmVlLWNvbnRyb2x7ZGlzcGxheTotbXMtaW5saW5lLWZsZXhib3g7ZGlzcGxheTppbmxpbmUtZmxleDstbXMtZmxleC1wYWNrOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOy1tcy1mbGV4LWFsaWduOmNlbnRlcjthbGlnbi1pdGVtczpjZW50ZXI7dmVydGljYWwtYWxpZ246bWlkZGxlO2hlaWdodDoxMXB4O3dpZHRoOjExcHg7bWFyZ2luLXJpZ2h0OjVweDtib3JkZXI6MXB4IHNvbGlkICMzMzM7Ym9yZGVyLXJhZGl1czoycHg7YmFja2dyb3VuZDpyZ2JhKDAsMCwwLC4xKTtvdmVyZmxvdzpoaWRkZW59LnRhYnVsYXRvci1yb3cgLnRhYnVsYXRvci1jZWxsIC50YWJ1bGF0b3ItZGF0YS10cmVlLWNvbnRyb2w6aG92ZXJ7Y3Vyc29yOnBvaW50ZXI7YmFja2dyb3VuZDpyZ2JhKDAsMCwwLC4yKX0udGFidWxhdG9yLXJvdyAudGFidWxhdG9yLWNlbGwgLnRhYnVsYXRvci1kYXRhLXRyZWUtY29udHJvbCAudGFidWxhdG9yLWRhdGEtdHJlZS1jb250cm9sLWNvbGxhcHNle2Rpc3BsYXk6aW5saW5lLWJsb2NrO3Bvc2l0aW9uOnJlbGF0aXZlO2hlaWdodDo3cHg7d2lkdGg6MXB4O2JhY2tncm91bmQ6dHJhbnNwYXJlbnR9LnRhYnVsYXRvci1yb3cgLnRhYnVsYXRvci1jZWxsIC50YWJ1bGF0b3ItZGF0YS10cmVlLWNvbnRyb2wgLnRhYnVsYXRvci1kYXRhLXRyZWUtY29udHJvbC1jb2xsYXBzZTphZnRlcntwb3NpdGlvbjphYnNvbHV0ZTtjb250ZW50OlxcXCJcXFwiO2xlZnQ6LTNweDt0b3A6M3B4O2hlaWdodDoxcHg7d2lkdGg6N3B4O2JhY2tncm91bmQ6IzMzM30udGFidWxhdG9yLXJvdyAudGFidWxhdG9yLWNlbGwgLnRhYnVsYXRvci1kYXRhLXRyZWUtY29udHJvbCAudGFidWxhdG9yLWRhdGEtdHJlZS1jb250cm9sLWV4cGFuZHtkaXNwbGF5OmlubGluZS1ibG9jaztwb3NpdGlvbjpyZWxhdGl2ZTtoZWlnaHQ6N3B4O3dpZHRoOjFweDtiYWNrZ3JvdW5kOiMzMzN9LnRhYnVsYXRvci1yb3cgLnRhYnVsYXRvci1jZWxsIC50YWJ1bGF0b3ItZGF0YS10cmVlLWNvbnRyb2wgLnRhYnVsYXRvci1kYXRhLXRyZWUtY29udHJvbC1leHBhbmQ6YWZ0ZXJ7cG9zaXRpb246YWJzb2x1dGU7Y29udGVudDpcXFwiXFxcIjtsZWZ0Oi0zcHg7dG9wOjNweDtoZWlnaHQ6MXB4O3dpZHRoOjdweDtiYWNrZ3JvdW5kOiMzMzN9LnRhYnVsYXRvci1yb3cgLnRhYnVsYXRvci1jZWxsIC50YWJ1bGF0b3ItcmVzcG9uc2l2ZS1jb2xsYXBzZS10b2dnbGV7ZGlzcGxheTotbXMtaW5saW5lLWZsZXhib3g7ZGlzcGxheTppbmxpbmUtZmxleDstbXMtZmxleC1hbGlnbjpjZW50ZXI7YWxpZ24taXRlbXM6Y2VudGVyOy1tcy1mbGV4LXBhY2s6Y2VudGVyO2p1c3RpZnktY29udGVudDpjZW50ZXI7LW1vei11c2VyLXNlbGVjdDpub25lOy1raHRtbC11c2VyLXNlbGVjdDpub25lOy13ZWJraXQtdXNlci1zZWxlY3Q6bm9uZTstby11c2VyLXNlbGVjdDpub25lO2hlaWdodDoxNXB4O3dpZHRoOjE1cHg7Ym9yZGVyLXJhZGl1czoyMHB4O2JhY2tncm91bmQ6IzY2Njtjb2xvcjojZmZmO2ZvbnQtd2VpZ2h0OjcwMDtmb250LXNpemU6MS4xZW19LnRhYnVsYXRvci1yb3cgLnRhYnVsYXRvci1jZWxsIC50YWJ1bGF0b3ItcmVzcG9uc2l2ZS1jb2xsYXBzZS10b2dnbGU6aG92ZXJ7b3BhY2l0eTouN30udGFidWxhdG9yLXJvdyAudGFidWxhdG9yLWNlbGwgLnRhYnVsYXRvci1yZXNwb25zaXZlLWNvbGxhcHNlLXRvZ2dsZS5vcGVuIC50YWJ1bGF0b3ItcmVzcG9uc2l2ZS1jb2xsYXBzZS10b2dnbGUtY2xvc2V7ZGlzcGxheTppbml0aWFsfS50YWJ1bGF0b3Itcm93IC50YWJ1bGF0b3ItY2VsbCAudGFidWxhdG9yLXJlc3BvbnNpdmUtY29sbGFwc2UtdG9nZ2xlLm9wZW4gLnRhYnVsYXRvci1yZXNwb25zaXZlLWNvbGxhcHNlLXRvZ2dsZS1vcGVuLC50YWJ1bGF0b3Itcm93IC50YWJ1bGF0b3ItY2VsbCAudGFidWxhdG9yLXJlc3BvbnNpdmUtY29sbGFwc2UtdG9nZ2xlIC50YWJ1bGF0b3ItcmVzcG9uc2l2ZS1jb2xsYXBzZS10b2dnbGUtY2xvc2V7ZGlzcGxheTpub25lfS50YWJ1bGF0b3Itcm93IC50YWJ1bGF0b3ItY2VsbCAudGFidWxhdG9yLXRyYWZmaWMtbGlnaHR7ZGlzcGxheTppbmxpbmUtYmxvY2s7aGVpZ2h0OjE0cHg7d2lkdGg6MTRweDtib3JkZXItcmFkaXVzOjE0cHh9LnRhYnVsYXRvci1yb3cudGFidWxhdG9yLWdyb3Vwe2JveC1zaXppbmc6Ym9yZGVyLWJveDtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjOTk5O2JvcmRlci1yaWdodDoxcHggc29saWQgI2FhYTtib3JkZXItdG9wOjFweCBzb2xpZCAjOTk5O3BhZGRpbmc6NXB4O3BhZGRpbmctbGVmdDoxMHB4O2JhY2tncm91bmQ6I2NjYztmb250LXdlaWdodDo3MDA7bWluLXdpZHRoOjEwMCV9LnRhYnVsYXRvci1yb3cudGFidWxhdG9yLWdyb3VwOmhvdmVye2N1cnNvcjpwb2ludGVyO2JhY2tncm91bmQtY29sb3I6cmdiYSgwLDAsMCwuMSl9LnRhYnVsYXRvci1yb3cudGFidWxhdG9yLWdyb3VwLnRhYnVsYXRvci1ncm91cC12aXNpYmxlIC50YWJ1bGF0b3ItYXJyb3d7bWFyZ2luLXJpZ2h0OjEwcHg7Ym9yZGVyLWxlZnQ6NnB4IHNvbGlkIHRyYW5zcGFyZW50O2JvcmRlci1yaWdodDo2cHggc29saWQgdHJhbnNwYXJlbnQ7Ym9yZGVyLXRvcDo2cHggc29saWQgIzY2Njtib3JkZXItYm90dG9tOjB9LnRhYnVsYXRvci1yb3cudGFidWxhdG9yLWdyb3VwLnRhYnVsYXRvci1ncm91cC1sZXZlbC0xe3BhZGRpbmctbGVmdDozMHB4fS50YWJ1bGF0b3Itcm93LnRhYnVsYXRvci1ncm91cC50YWJ1bGF0b3ItZ3JvdXAtbGV2ZWwtMntwYWRkaW5nLWxlZnQ6NTBweH0udGFidWxhdG9yLXJvdy50YWJ1bGF0b3ItZ3JvdXAudGFidWxhdG9yLWdyb3VwLWxldmVsLTN7cGFkZGluZy1sZWZ0OjcwcHh9LnRhYnVsYXRvci1yb3cudGFidWxhdG9yLWdyb3VwLnRhYnVsYXRvci1ncm91cC1sZXZlbC00e3BhZGRpbmctbGVmdDo5MHB4fS50YWJ1bGF0b3Itcm93LnRhYnVsYXRvci1ncm91cC50YWJ1bGF0b3ItZ3JvdXAtbGV2ZWwtNXtwYWRkaW5nLWxlZnQ6MTEwcHh9LnRhYnVsYXRvci1yb3cudGFidWxhdG9yLWdyb3VwIC50YWJ1bGF0b3ItZ3JvdXAtdG9nZ2xle2Rpc3BsYXk6aW5saW5lLWJsb2NrfS50YWJ1bGF0b3Itcm93LnRhYnVsYXRvci1ncm91cCAudGFidWxhdG9yLWFycm93e2Rpc3BsYXk6aW5saW5lLWJsb2NrO3dpZHRoOjA7aGVpZ2h0OjA7bWFyZ2luLXJpZ2h0OjE2cHg7Ym9yZGVyLXRvcDo2cHggc29saWQgdHJhbnNwYXJlbnQ7Ym9yZGVyLWJvdHRvbTo2cHggc29saWQgdHJhbnNwYXJlbnQ7Ym9yZGVyLXJpZ2h0OjA7Ym9yZGVyLWxlZnQ6NnB4IHNvbGlkICM2NjY7dmVydGljYWwtYWxpZ246bWlkZGxlfS50YWJ1bGF0b3Itcm93LnRhYnVsYXRvci1ncm91cCBzcGFue21hcmdpbi1sZWZ0OjEwcHg7Y29sb3I6I2QwMH0udGFidWxhdG9yLW1lbnV7cG9zaXRpb246YWJzb2x1dGU7ZGlzcGxheTppbmxpbmUtYmxvY2s7Ym94LXNpemluZzpib3JkZXItYm94O2JhY2tncm91bmQ6I2ZmZjtib3JkZXI6MXB4IHNvbGlkICNhYWE7Ym94LXNoYWRvdzowIDAgNXB4IDAgcmdiYSgwLDAsMCwuMik7Zm9udC1zaXplOjE0cHg7b3ZlcmZsb3cteTphdXRvOy13ZWJraXQtb3ZlcmZsb3ctc2Nyb2xsaW5nOnRvdWNoO3otaW5kZXg6MTAwMDB9LnRhYnVsYXRvci1tZW51IC50YWJ1bGF0b3ItbWVudS1pdGVte3BhZGRpbmc6NXB4IDEwcHg7LXdlYmtpdC11c2VyLXNlbGVjdDpub25lOy1tcy11c2VyLXNlbGVjdDpub25lO3VzZXItc2VsZWN0Om5vbmV9LnRhYnVsYXRvci1tZW51IC50YWJ1bGF0b3ItbWVudS1pdGVtLnRhYnVsYXRvci1tZW51LWl0ZW0tZGlzYWJsZWR7b3BhY2l0eTouNX0udGFidWxhdG9yLW1lbnUgLnRhYnVsYXRvci1tZW51LWl0ZW06bm90KC50YWJ1bGF0b3ItbWVudS1pdGVtLWRpc2FibGVkKTpob3ZlcntjdXJzb3I6cG9pbnRlcjtiYWNrZ3JvdW5kOiNlZmVmZWZ9LnRhYnVsYXRvci1tZW51IC50YWJ1bGF0b3ItbWVudS1zZXBhcmF0b3J7Ym9yZGVyLXRvcDoxcHggc29saWQgI2FhYX0udGFidWxhdG9yLWVkaXQtc2VsZWN0LWxpc3R7cG9zaXRpb246YWJzb2x1dGU7ZGlzcGxheTppbmxpbmUtYmxvY2s7Ym94LXNpemluZzpib3JkZXItYm94O21heC1oZWlnaHQ6MjAwcHg7YmFja2dyb3VuZDojZmZmO2JvcmRlcjoxcHggc29saWQgI2FhYTtmb250LXNpemU6MTRweDtvdmVyZmxvdy15OmF1dG87LXdlYmtpdC1vdmVyZmxvdy1zY3JvbGxpbmc6dG91Y2g7ei1pbmRleDoxMDAwMH0udGFidWxhdG9yLWVkaXQtc2VsZWN0LWxpc3QgLnRhYnVsYXRvci1lZGl0LXNlbGVjdC1saXN0LWl0ZW17cGFkZGluZzo0cHg7Y29sb3I6IzMzM30udGFidWxhdG9yLWVkaXQtc2VsZWN0LWxpc3QgLnRhYnVsYXRvci1lZGl0LXNlbGVjdC1saXN0LWl0ZW0uYWN0aXZle2NvbG9yOiNmZmY7YmFja2dyb3VuZDojMWQ2OGNkfS50YWJ1bGF0b3ItZWRpdC1zZWxlY3QtbGlzdCAudGFidWxhdG9yLWVkaXQtc2VsZWN0LWxpc3QtaXRlbS5hY3RpdmUuZm9jdXNlZHtvdXRsaW5lOjFweCBzb2xpZCBoc2xhKDAsMCUsMTAwJSwuNSl9LnRhYnVsYXRvci1lZGl0LXNlbGVjdC1saXN0IC50YWJ1bGF0b3ItZWRpdC1zZWxlY3QtbGlzdC1pdGVtLmZvY3VzZWR7b3V0bGluZToxcHggc29saWQgIzFkNjhjZH0udGFidWxhdG9yLWVkaXQtc2VsZWN0LWxpc3QgLnRhYnVsYXRvci1lZGl0LXNlbGVjdC1saXN0LWl0ZW06aG92ZXJ7Y3Vyc29yOnBvaW50ZXI7Y29sb3I6I2ZmZjtiYWNrZ3JvdW5kOiMxZDY4Y2R9LnRhYnVsYXRvci1lZGl0LXNlbGVjdC1saXN0IC50YWJ1bGF0b3ItZWRpdC1zZWxlY3QtbGlzdC1ub3RpY2V7cGFkZGluZzo0cHg7Y29sb3I6IzMzMzt0ZXh0LWFsaWduOmNlbnRlcn0udGFidWxhdG9yLWVkaXQtc2VsZWN0LWxpc3QgLnRhYnVsYXRvci1lZGl0LXNlbGVjdC1saXN0LWdyb3Vwe2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNhYWE7cGFkZGluZzo0cHg7cGFkZGluZy10b3A6NnB4O2NvbG9yOiMzMzM7Zm9udC13ZWlnaHQ6NzAwfS50YWJ1bGF0b3ItcHJpbnQtZnVsbHNjcmVlbntwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtib3R0b206MDtsZWZ0OjA7cmlnaHQ6MDt6LWluZGV4OjEwMDAwfWJvZHkudGFidWxhdG9yLXByaW50LWZ1bGxzY3JlZW4taGlkZT46bm90KC50YWJ1bGF0b3ItcHJpbnQtZnVsbHNjcmVlbil7ZGlzcGxheTpub25lIWltcG9ydGFudH0udGFidWxhdG9yLXByaW50LXRhYmxle2JvcmRlci1jb2xsYXBzZTpjb2xsYXBzZX0udGFidWxhdG9yLXByaW50LXRhYmxlIC50YWJ1bGF0b3ItZGF0YS10cmVlLWJyYW5jaHtkaXNwbGF5OmlubGluZS1ibG9jazt2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7aGVpZ2h0OjlweDt3aWR0aDo3cHg7bWFyZ2luLXRvcDotOXB4O21hcmdpbi1yaWdodDo1cHg7Ym9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czoxcHg7Ym9yZGVyLWxlZnQ6MnB4IHNvbGlkICNhYWE7Ym9yZGVyLWJvdHRvbToycHggc29saWQgI2FhYX0udGFidWxhdG9yLXByaW50LXRhYmxlIC50YWJ1bGF0b3ItcHJpbnQtdGFibGUtZ3JvdXB7Ym94LXNpemluZzpib3JkZXItYm94O2JvcmRlci1ib3R0b206MXB4IHNvbGlkICM5OTk7Ym9yZGVyLXJpZ2h0OjFweCBzb2xpZCAjYWFhO2JvcmRlci10b3A6MXB4IHNvbGlkICM5OTk7cGFkZGluZzo1cHg7cGFkZGluZy1sZWZ0OjEwcHg7YmFja2dyb3VuZDojY2NjO2ZvbnQtd2VpZ2h0OjcwMDttaW4td2lkdGg6MTAwJX0udGFidWxhdG9yLXByaW50LXRhYmxlIC50YWJ1bGF0b3ItcHJpbnQtdGFibGUtZ3JvdXA6aG92ZXJ7Y3Vyc29yOnBvaW50ZXI7YmFja2dyb3VuZC1jb2xvcjpyZ2JhKDAsMCwwLC4xKX0udGFidWxhdG9yLXByaW50LXRhYmxlIC50YWJ1bGF0b3ItcHJpbnQtdGFibGUtZ3JvdXAudGFidWxhdG9yLWdyb3VwLXZpc2libGUgLnRhYnVsYXRvci1hcnJvd3ttYXJnaW4tcmlnaHQ6MTBweDtib3JkZXItbGVmdDo2cHggc29saWQgdHJhbnNwYXJlbnQ7Ym9yZGVyLXJpZ2h0OjZweCBzb2xpZCB0cmFuc3BhcmVudDtib3JkZXItdG9wOjZweCBzb2xpZCAjNjY2O2JvcmRlci1ib3R0b206MH0udGFidWxhdG9yLXByaW50LXRhYmxlIC50YWJ1bGF0b3ItcHJpbnQtdGFibGUtZ3JvdXAudGFidWxhdG9yLWdyb3VwLWxldmVsLTEgdGR7cGFkZGluZy1sZWZ0OjMwcHghaW1wb3J0YW50fS50YWJ1bGF0b3ItcHJpbnQtdGFibGUgLnRhYnVsYXRvci1wcmludC10YWJsZS1ncm91cC50YWJ1bGF0b3ItZ3JvdXAtbGV2ZWwtMiB0ZHtwYWRkaW5nLWxlZnQ6NTBweCFpbXBvcnRhbnR9LnRhYnVsYXRvci1wcmludC10YWJsZSAudGFidWxhdG9yLXByaW50LXRhYmxlLWdyb3VwLnRhYnVsYXRvci1ncm91cC1sZXZlbC0zIHRke3BhZGRpbmctbGVmdDo3MHB4IWltcG9ydGFudH0udGFidWxhdG9yLXByaW50LXRhYmxlIC50YWJ1bGF0b3ItcHJpbnQtdGFibGUtZ3JvdXAudGFidWxhdG9yLWdyb3VwLWxldmVsLTQgdGR7cGFkZGluZy1sZWZ0OjkwcHghaW1wb3J0YW50fS50YWJ1bGF0b3ItcHJpbnQtdGFibGUgLnRhYnVsYXRvci1wcmludC10YWJsZS1ncm91cC50YWJ1bGF0b3ItZ3JvdXAtbGV2ZWwtNSB0ZHtwYWRkaW5nLWxlZnQ6MTEwcHghaW1wb3J0YW50fS50YWJ1bGF0b3ItcHJpbnQtdGFibGUgLnRhYnVsYXRvci1wcmludC10YWJsZS1ncm91cCAudGFidWxhdG9yLWdyb3VwLXRvZ2dsZXtkaXNwbGF5OmlubGluZS1ibG9ja30udGFidWxhdG9yLXByaW50LXRhYmxlIC50YWJ1bGF0b3ItcHJpbnQtdGFibGUtZ3JvdXAgLnRhYnVsYXRvci1hcnJvd3tkaXNwbGF5OmlubGluZS1ibG9jazt3aWR0aDowO2hlaWdodDowO21hcmdpbi1yaWdodDoxNnB4O2JvcmRlci10b3A6NnB4IHNvbGlkIHRyYW5zcGFyZW50O2JvcmRlci1ib3R0b206NnB4IHNvbGlkIHRyYW5zcGFyZW50O2JvcmRlci1yaWdodDowO2JvcmRlci1sZWZ0OjZweCBzb2xpZCAjNjY2O3ZlcnRpY2FsLWFsaWduOm1pZGRsZX0udGFidWxhdG9yLXByaW50LXRhYmxlIC50YWJ1bGF0b3ItcHJpbnQtdGFibGUtZ3JvdXAgc3BhbnttYXJnaW4tbGVmdDoxMHB4O2NvbG9yOiNkMDB9LnRhYnVsYXRvci1wcmludC10YWJsZSAudGFidWxhdG9yLWRhdGEtdHJlZS1jb250cm9se2Rpc3BsYXk6LW1zLWlubGluZS1mbGV4Ym94O2Rpc3BsYXk6aW5saW5lLWZsZXg7LW1zLWZsZXgtcGFjazpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlcjstbXMtZmxleC1hbGlnbjpjZW50ZXI7YWxpZ24taXRlbXM6Y2VudGVyO3ZlcnRpY2FsLWFsaWduOm1pZGRsZTtoZWlnaHQ6MTFweDt3aWR0aDoxMXB4O21hcmdpbi1yaWdodDo1cHg7Ym9yZGVyOjFweCBzb2xpZCAjMzMzO2JvcmRlci1yYWRpdXM6MnB4O2JhY2tncm91bmQ6cmdiYSgwLDAsMCwuMSk7b3ZlcmZsb3c6aGlkZGVufS50YWJ1bGF0b3ItcHJpbnQtdGFibGUgLnRhYnVsYXRvci1kYXRhLXRyZWUtY29udHJvbDpob3ZlcntjdXJzb3I6cG9pbnRlcjtiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsLjIpfS50YWJ1bGF0b3ItcHJpbnQtdGFibGUgLnRhYnVsYXRvci1kYXRhLXRyZWUtY29udHJvbCAudGFidWxhdG9yLWRhdGEtdHJlZS1jb250cm9sLWNvbGxhcHNle2Rpc3BsYXk6aW5saW5lLWJsb2NrO3Bvc2l0aW9uOnJlbGF0aXZlO2hlaWdodDo3cHg7d2lkdGg6MXB4O2JhY2tncm91bmQ6dHJhbnNwYXJlbnR9LnRhYnVsYXRvci1wcmludC10YWJsZSAudGFidWxhdG9yLWRhdGEtdHJlZS1jb250cm9sIC50YWJ1bGF0b3ItZGF0YS10cmVlLWNvbnRyb2wtY29sbGFwc2U6YWZ0ZXJ7cG9zaXRpb246YWJzb2x1dGU7Y29udGVudDpcXFwiXFxcIjtsZWZ0Oi0zcHg7dG9wOjNweDtoZWlnaHQ6MXB4O3dpZHRoOjdweDtiYWNrZ3JvdW5kOiMzMzN9LnRhYnVsYXRvci1wcmludC10YWJsZSAudGFidWxhdG9yLWRhdGEtdHJlZS1jb250cm9sIC50YWJ1bGF0b3ItZGF0YS10cmVlLWNvbnRyb2wtZXhwYW5ke2Rpc3BsYXk6aW5saW5lLWJsb2NrO3Bvc2l0aW9uOnJlbGF0aXZlO2hlaWdodDo3cHg7d2lkdGg6MXB4O2JhY2tncm91bmQ6IzMzM30udGFidWxhdG9yLXByaW50LXRhYmxlIC50YWJ1bGF0b3ItZGF0YS10cmVlLWNvbnRyb2wgLnRhYnVsYXRvci1kYXRhLXRyZWUtY29udHJvbC1leHBhbmQ6YWZ0ZXJ7cG9zaXRpb246YWJzb2x1dGU7Y29udGVudDpcXFwiXFxcIjtsZWZ0Oi0zcHg7dG9wOjNweDtoZWlnaHQ6MXB4O3dpZHRoOjdweDtiYWNrZ3JvdW5kOiMzMzN9XFxuXCIsIFwiXCJdKTtcbi8vIEV4cG9ydHNcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0cztcbiIsIlwidXNlIHN0cmljdFwiO1xuXG4vKlxuICBNSVQgTGljZW5zZSBodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlLnBocFxuICBBdXRob3IgVG9iaWFzIEtvcHBlcnMgQHNva3JhXG4qL1xuLy8gY3NzIGJhc2UgY29kZSwgaW5qZWN0ZWQgYnkgdGhlIGNzcy1sb2FkZXJcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBmdW5jLW5hbWVzXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICh1c2VTb3VyY2VNYXApIHtcbiAgdmFyIGxpc3QgPSBbXTsgLy8gcmV0dXJuIHRoZSBsaXN0IG9mIG1vZHVsZXMgYXMgY3NzIHN0cmluZ1xuXG4gIGxpc3QudG9TdHJpbmcgPSBmdW5jdGlvbiB0b1N0cmluZygpIHtcbiAgICByZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIHZhciBjb250ZW50ID0gY3NzV2l0aE1hcHBpbmdUb1N0cmluZyhpdGVtLCB1c2VTb3VyY2VNYXApO1xuXG4gICAgICBpZiAoaXRlbVsyXSkge1xuICAgICAgICByZXR1cm4gXCJAbWVkaWEgXCIuY29uY2F0KGl0ZW1bMl0sIFwiIHtcIikuY29uY2F0KGNvbnRlbnQsIFwifVwiKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGNvbnRlbnQ7XG4gICAgfSkuam9pbignJyk7XG4gIH07IC8vIGltcG9ydCBhIGxpc3Qgb2YgbW9kdWxlcyBpbnRvIHRoZSBsaXN0XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBmdW5jLW5hbWVzXG5cblxuICBsaXN0LmkgPSBmdW5jdGlvbiAobW9kdWxlcywgbWVkaWFRdWVyeSwgZGVkdXBlKSB7XG4gICAgaWYgKHR5cGVvZiBtb2R1bGVzID09PSAnc3RyaW5nJykge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXG4gICAgICBtb2R1bGVzID0gW1tudWxsLCBtb2R1bGVzLCAnJ11dO1xuICAgIH1cblxuICAgIHZhciBhbHJlYWR5SW1wb3J0ZWRNb2R1bGVzID0ge307XG5cbiAgICBpZiAoZGVkdXBlKSB7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHByZWZlci1kZXN0cnVjdHVyaW5nXG4gICAgICAgIHZhciBpZCA9IHRoaXNbaV1bMF07XG5cbiAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICBhbHJlYWR5SW1wb3J0ZWRNb2R1bGVzW2lkXSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgbW9kdWxlcy5sZW5ndGg7IF9pKyspIHtcbiAgICAgIHZhciBpdGVtID0gW10uY29uY2F0KG1vZHVsZXNbX2ldKTtcblxuICAgICAgaWYgKGRlZHVwZSAmJiBhbHJlYWR5SW1wb3J0ZWRNb2R1bGVzW2l0ZW1bMF1dKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb250aW51ZVxuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKG1lZGlhUXVlcnkpIHtcbiAgICAgICAgaWYgKCFpdGVtWzJdKSB7XG4gICAgICAgICAgaXRlbVsyXSA9IG1lZGlhUXVlcnk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaXRlbVsyXSA9IFwiXCIuY29uY2F0KG1lZGlhUXVlcnksIFwiIGFuZCBcIikuY29uY2F0KGl0ZW1bMl0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGxpc3QucHVzaChpdGVtKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIGxpc3Q7XG59O1xuXG5mdW5jdGlvbiBjc3NXaXRoTWFwcGluZ1RvU3RyaW5nKGl0ZW0sIHVzZVNvdXJjZU1hcCkge1xuICB2YXIgY29udGVudCA9IGl0ZW1bMV0gfHwgJyc7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmVmZXItZGVzdHJ1Y3R1cmluZ1xuXG4gIHZhciBjc3NNYXBwaW5nID0gaXRlbVszXTtcblxuICBpZiAoIWNzc01hcHBpbmcpIHtcbiAgICByZXR1cm4gY29udGVudDtcbiAgfVxuXG4gIGlmICh1c2VTb3VyY2VNYXAgJiYgdHlwZW9mIGJ0b2EgPT09ICdmdW5jdGlvbicpIHtcbiAgICB2YXIgc291cmNlTWFwcGluZyA9IHRvQ29tbWVudChjc3NNYXBwaW5nKTtcbiAgICB2YXIgc291cmNlVVJMcyA9IGNzc01hcHBpbmcuc291cmNlcy5tYXAoZnVuY3Rpb24gKHNvdXJjZSkge1xuICAgICAgcmV0dXJuIFwiLyojIHNvdXJjZVVSTD1cIi5jb25jYXQoY3NzTWFwcGluZy5zb3VyY2VSb290IHx8ICcnKS5jb25jYXQoc291cmNlLCBcIiAqL1wiKTtcbiAgICB9KTtcbiAgICByZXR1cm4gW2NvbnRlbnRdLmNvbmNhdChzb3VyY2VVUkxzKS5jb25jYXQoW3NvdXJjZU1hcHBpbmddKS5qb2luKCdcXG4nKTtcbiAgfVxuXG4gIHJldHVybiBbY29udGVudF0uam9pbignXFxuJyk7XG59IC8vIEFkYXB0ZWQgZnJvbSBjb252ZXJ0LXNvdXJjZS1tYXAgKE1JVClcblxuXG5mdW5jdGlvbiB0b0NvbW1lbnQoc291cmNlTWFwKSB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bmRlZlxuICB2YXIgYmFzZTY0ID0gYnRvYSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkoc291cmNlTWFwKSkpKTtcbiAgdmFyIGRhdGEgPSBcInNvdXJjZU1hcHBpbmdVUkw9ZGF0YTphcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTg7YmFzZTY0LFwiLmNvbmNhdChiYXNlNjQpO1xuICByZXR1cm4gXCIvKiMgXCIuY29uY2F0KGRhdGEsIFwiICovXCIpO1xufSIsIi8qXG5cdE1JVCBMaWNlbnNlIGh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvbWl0LWxpY2Vuc2UucGhwXG5cdEF1dGhvciBUb2JpYXMgS29wcGVycyBAc29rcmFcbiovXG5cbnZhciBzdHlsZXNJbkRvbSA9IHt9O1xuXG52YXJcdG1lbW9pemUgPSBmdW5jdGlvbiAoZm4pIHtcblx0dmFyIG1lbW87XG5cblx0cmV0dXJuIGZ1bmN0aW9uICgpIHtcblx0XHRpZiAodHlwZW9mIG1lbW8gPT09IFwidW5kZWZpbmVkXCIpIG1lbW8gPSBmbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuXHRcdHJldHVybiBtZW1vO1xuXHR9O1xufTtcblxudmFyIGlzT2xkSUUgPSBtZW1vaXplKGZ1bmN0aW9uICgpIHtcblx0Ly8gVGVzdCBmb3IgSUUgPD0gOSBhcyBwcm9wb3NlZCBieSBCcm93c2VyaGFja3Ncblx0Ly8gQHNlZSBodHRwOi8vYnJvd3NlcmhhY2tzLmNvbS8jaGFjay1lNzFkODY5MmY2NTMzNDE3M2ZlZTcxNWMyMjJjYjgwNVxuXHQvLyBUZXN0cyBmb3IgZXhpc3RlbmNlIG9mIHN0YW5kYXJkIGdsb2JhbHMgaXMgdG8gYWxsb3cgc3R5bGUtbG9hZGVyXG5cdC8vIHRvIG9wZXJhdGUgY29ycmVjdGx5IGludG8gbm9uLXN0YW5kYXJkIGVudmlyb25tZW50c1xuXHQvLyBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS93ZWJwYWNrLWNvbnRyaWIvc3R5bGUtbG9hZGVyL2lzc3Vlcy8xNzdcblx0cmV0dXJuIHdpbmRvdyAmJiBkb2N1bWVudCAmJiBkb2N1bWVudC5hbGwgJiYgIXdpbmRvdy5hdG9iO1xufSk7XG5cbnZhciBnZXRUYXJnZXQgPSBmdW5jdGlvbiAodGFyZ2V0LCBwYXJlbnQpIHtcbiAgaWYgKHBhcmVudCl7XG4gICAgcmV0dXJuIHBhcmVudC5xdWVyeVNlbGVjdG9yKHRhcmdldCk7XG4gIH1cbiAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGFyZ2V0KTtcbn07XG5cbnZhciBnZXRFbGVtZW50ID0gKGZ1bmN0aW9uIChmbikge1xuXHR2YXIgbWVtbyA9IHt9O1xuXG5cdHJldHVybiBmdW5jdGlvbih0YXJnZXQsIHBhcmVudCkge1xuICAgICAgICAgICAgICAgIC8vIElmIHBhc3NpbmcgZnVuY3Rpb24gaW4gb3B0aW9ucywgdGhlbiB1c2UgaXQgZm9yIHJlc29sdmUgXCJoZWFkXCIgZWxlbWVudC5cbiAgICAgICAgICAgICAgICAvLyBVc2VmdWwgZm9yIFNoYWRvdyBSb290IHN0eWxlIGkuZVxuICAgICAgICAgICAgICAgIC8vIHtcbiAgICAgICAgICAgICAgICAvLyAgIGluc2VydEludG86IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZm9vXCIpLnNoYWRvd1Jvb3QgfVxuICAgICAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHRhcmdldCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG1lbW9bdGFyZ2V0XSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0dmFyIHN0eWxlVGFyZ2V0ID0gZ2V0VGFyZ2V0LmNhbGwodGhpcywgdGFyZ2V0LCBwYXJlbnQpO1xuXHRcdFx0Ly8gU3BlY2lhbCBjYXNlIHRvIHJldHVybiBoZWFkIG9mIGlmcmFtZSBpbnN0ZWFkIG9mIGlmcmFtZSBpdHNlbGZcblx0XHRcdGlmICh3aW5kb3cuSFRNTElGcmFtZUVsZW1lbnQgJiYgc3R5bGVUYXJnZXQgaW5zdGFuY2VvZiB3aW5kb3cuSFRNTElGcmFtZUVsZW1lbnQpIHtcblx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHQvLyBUaGlzIHdpbGwgdGhyb3cgYW4gZXhjZXB0aW9uIGlmIGFjY2VzcyB0byBpZnJhbWUgaXMgYmxvY2tlZFxuXHRcdFx0XHRcdC8vIGR1ZSB0byBjcm9zcy1vcmlnaW4gcmVzdHJpY3Rpb25zXG5cdFx0XHRcdFx0c3R5bGVUYXJnZXQgPSBzdHlsZVRhcmdldC5jb250ZW50RG9jdW1lbnQuaGVhZDtcblx0XHRcdFx0fSBjYXRjaChlKSB7XG5cdFx0XHRcdFx0c3R5bGVUYXJnZXQgPSBudWxsO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRtZW1vW3RhcmdldF0gPSBzdHlsZVRhcmdldDtcblx0XHR9XG5cdFx0cmV0dXJuIG1lbW9bdGFyZ2V0XVxuXHR9O1xufSkoKTtcblxudmFyIHNpbmdsZXRvbiA9IG51bGw7XG52YXJcdHNpbmdsZXRvbkNvdW50ZXIgPSAwO1xudmFyXHRzdHlsZXNJbnNlcnRlZEF0VG9wID0gW107XG5cbnZhclx0Zml4VXJscyA9IHJlcXVpcmUoXCIuL3VybHNcIik7XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24obGlzdCwgb3B0aW9ucykge1xuXHRpZiAodHlwZW9mIERFQlVHICE9PSBcInVuZGVmaW5lZFwiICYmIERFQlVHKSB7XG5cdFx0aWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gXCJvYmplY3RcIikgdGhyb3cgbmV3IEVycm9yKFwiVGhlIHN0eWxlLWxvYWRlciBjYW5ub3QgYmUgdXNlZCBpbiBhIG5vbi1icm93c2VyIGVudmlyb25tZW50XCIpO1xuXHR9XG5cblx0b3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cblx0b3B0aW9ucy5hdHRycyA9IHR5cGVvZiBvcHRpb25zLmF0dHJzID09PSBcIm9iamVjdFwiID8gb3B0aW9ucy5hdHRycyA6IHt9O1xuXG5cdC8vIEZvcmNlIHNpbmdsZS10YWcgc29sdXRpb24gb24gSUU2LTksIHdoaWNoIGhhcyBhIGhhcmQgbGltaXQgb24gdGhlICMgb2YgPHN0eWxlPlxuXHQvLyB0YWdzIGl0IHdpbGwgYWxsb3cgb24gYSBwYWdlXG5cdGlmICghb3B0aW9ucy5zaW5nbGV0b24gJiYgdHlwZW9mIG9wdGlvbnMuc2luZ2xldG9uICE9PSBcImJvb2xlYW5cIikgb3B0aW9ucy5zaW5nbGV0b24gPSBpc09sZElFKCk7XG5cblx0Ly8gQnkgZGVmYXVsdCwgYWRkIDxzdHlsZT4gdGFncyB0byB0aGUgPGhlYWQ+IGVsZW1lbnRcbiAgICAgICAgaWYgKCFvcHRpb25zLmluc2VydEludG8pIG9wdGlvbnMuaW5zZXJ0SW50byA9IFwiaGVhZFwiO1xuXG5cdC8vIEJ5IGRlZmF1bHQsIGFkZCA8c3R5bGU+IHRhZ3MgdG8gdGhlIGJvdHRvbSBvZiB0aGUgdGFyZ2V0XG5cdGlmICghb3B0aW9ucy5pbnNlcnRBdCkgb3B0aW9ucy5pbnNlcnRBdCA9IFwiYm90dG9tXCI7XG5cblx0dmFyIHN0eWxlcyA9IGxpc3RUb1N0eWxlcyhsaXN0LCBvcHRpb25zKTtcblxuXHRhZGRTdHlsZXNUb0RvbShzdHlsZXMsIG9wdGlvbnMpO1xuXG5cdHJldHVybiBmdW5jdGlvbiB1cGRhdGUgKG5ld0xpc3QpIHtcblx0XHR2YXIgbWF5UmVtb3ZlID0gW107XG5cblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHN0eWxlcy5sZW5ndGg7IGkrKykge1xuXHRcdFx0dmFyIGl0ZW0gPSBzdHlsZXNbaV07XG5cdFx0XHR2YXIgZG9tU3R5bGUgPSBzdHlsZXNJbkRvbVtpdGVtLmlkXTtcblxuXHRcdFx0ZG9tU3R5bGUucmVmcy0tO1xuXHRcdFx0bWF5UmVtb3ZlLnB1c2goZG9tU3R5bGUpO1xuXHRcdH1cblxuXHRcdGlmKG5ld0xpc3QpIHtcblx0XHRcdHZhciBuZXdTdHlsZXMgPSBsaXN0VG9TdHlsZXMobmV3TGlzdCwgb3B0aW9ucyk7XG5cdFx0XHRhZGRTdHlsZXNUb0RvbShuZXdTdHlsZXMsIG9wdGlvbnMpO1xuXHRcdH1cblxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgbWF5UmVtb3ZlLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHR2YXIgZG9tU3R5bGUgPSBtYXlSZW1vdmVbaV07XG5cblx0XHRcdGlmKGRvbVN0eWxlLnJlZnMgPT09IDApIHtcblx0XHRcdFx0Zm9yICh2YXIgaiA9IDA7IGogPCBkb21TdHlsZS5wYXJ0cy5sZW5ndGg7IGorKykgZG9tU3R5bGUucGFydHNbal0oKTtcblxuXHRcdFx0XHRkZWxldGUgc3R5bGVzSW5Eb21bZG9tU3R5bGUuaWRdO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcbn07XG5cbmZ1bmN0aW9uIGFkZFN0eWxlc1RvRG9tIChzdHlsZXMsIG9wdGlvbnMpIHtcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCBzdHlsZXMubGVuZ3RoOyBpKyspIHtcblx0XHR2YXIgaXRlbSA9IHN0eWxlc1tpXTtcblx0XHR2YXIgZG9tU3R5bGUgPSBzdHlsZXNJbkRvbVtpdGVtLmlkXTtcblxuXHRcdGlmKGRvbVN0eWxlKSB7XG5cdFx0XHRkb21TdHlsZS5yZWZzKys7XG5cblx0XHRcdGZvcih2YXIgaiA9IDA7IGogPCBkb21TdHlsZS5wYXJ0cy5sZW5ndGg7IGorKykge1xuXHRcdFx0XHRkb21TdHlsZS5wYXJ0c1tqXShpdGVtLnBhcnRzW2pdKTtcblx0XHRcdH1cblxuXHRcdFx0Zm9yKDsgaiA8IGl0ZW0ucGFydHMubGVuZ3RoOyBqKyspIHtcblx0XHRcdFx0ZG9tU3R5bGUucGFydHMucHVzaChhZGRTdHlsZShpdGVtLnBhcnRzW2pdLCBvcHRpb25zKSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHZhciBwYXJ0cyA9IFtdO1xuXG5cdFx0XHRmb3IodmFyIGogPSAwOyBqIDwgaXRlbS5wYXJ0cy5sZW5ndGg7IGorKykge1xuXHRcdFx0XHRwYXJ0cy5wdXNoKGFkZFN0eWxlKGl0ZW0ucGFydHNbal0sIG9wdGlvbnMpKTtcblx0XHRcdH1cblxuXHRcdFx0c3R5bGVzSW5Eb21baXRlbS5pZF0gPSB7aWQ6IGl0ZW0uaWQsIHJlZnM6IDEsIHBhcnRzOiBwYXJ0c307XG5cdFx0fVxuXHR9XG59XG5cbmZ1bmN0aW9uIGxpc3RUb1N0eWxlcyAobGlzdCwgb3B0aW9ucykge1xuXHR2YXIgc3R5bGVzID0gW107XG5cdHZhciBuZXdTdHlsZXMgPSB7fTtcblxuXHRmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcblx0XHR2YXIgaXRlbSA9IGxpc3RbaV07XG5cdFx0dmFyIGlkID0gb3B0aW9ucy5iYXNlID8gaXRlbVswXSArIG9wdGlvbnMuYmFzZSA6IGl0ZW1bMF07XG5cdFx0dmFyIGNzcyA9IGl0ZW1bMV07XG5cdFx0dmFyIG1lZGlhID0gaXRlbVsyXTtcblx0XHR2YXIgc291cmNlTWFwID0gaXRlbVszXTtcblx0XHR2YXIgcGFydCA9IHtjc3M6IGNzcywgbWVkaWE6IG1lZGlhLCBzb3VyY2VNYXA6IHNvdXJjZU1hcH07XG5cblx0XHRpZighbmV3U3R5bGVzW2lkXSkgc3R5bGVzLnB1c2gobmV3U3R5bGVzW2lkXSA9IHtpZDogaWQsIHBhcnRzOiBbcGFydF19KTtcblx0XHRlbHNlIG5ld1N0eWxlc1tpZF0ucGFydHMucHVzaChwYXJ0KTtcblx0fVxuXG5cdHJldHVybiBzdHlsZXM7XG59XG5cbmZ1bmN0aW9uIGluc2VydFN0eWxlRWxlbWVudCAob3B0aW9ucywgc3R5bGUpIHtcblx0dmFyIHRhcmdldCA9IGdldEVsZW1lbnQob3B0aW9ucy5pbnNlcnRJbnRvKVxuXG5cdGlmICghdGFyZ2V0KSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiQ291bGRuJ3QgZmluZCBhIHN0eWxlIHRhcmdldC4gVGhpcyBwcm9iYWJseSBtZWFucyB0aGF0IHRoZSB2YWx1ZSBmb3IgdGhlICdpbnNlcnRJbnRvJyBwYXJhbWV0ZXIgaXMgaW52YWxpZC5cIik7XG5cdH1cblxuXHR2YXIgbGFzdFN0eWxlRWxlbWVudEluc2VydGVkQXRUb3AgPSBzdHlsZXNJbnNlcnRlZEF0VG9wW3N0eWxlc0luc2VydGVkQXRUb3AubGVuZ3RoIC0gMV07XG5cblx0aWYgKG9wdGlvbnMuaW5zZXJ0QXQgPT09IFwidG9wXCIpIHtcblx0XHRpZiAoIWxhc3RTdHlsZUVsZW1lbnRJbnNlcnRlZEF0VG9wKSB7XG5cdFx0XHR0YXJnZXQuaW5zZXJ0QmVmb3JlKHN0eWxlLCB0YXJnZXQuZmlyc3RDaGlsZCk7XG5cdFx0fSBlbHNlIGlmIChsYXN0U3R5bGVFbGVtZW50SW5zZXJ0ZWRBdFRvcC5uZXh0U2libGluZykge1xuXHRcdFx0dGFyZ2V0Lmluc2VydEJlZm9yZShzdHlsZSwgbGFzdFN0eWxlRWxlbWVudEluc2VydGVkQXRUb3AubmV4dFNpYmxpbmcpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0YXJnZXQuYXBwZW5kQ2hpbGQoc3R5bGUpO1xuXHRcdH1cblx0XHRzdHlsZXNJbnNlcnRlZEF0VG9wLnB1c2goc3R5bGUpO1xuXHR9IGVsc2UgaWYgKG9wdGlvbnMuaW5zZXJ0QXQgPT09IFwiYm90dG9tXCIpIHtcblx0XHR0YXJnZXQuYXBwZW5kQ2hpbGQoc3R5bGUpO1xuXHR9IGVsc2UgaWYgKHR5cGVvZiBvcHRpb25zLmluc2VydEF0ID09PSBcIm9iamVjdFwiICYmIG9wdGlvbnMuaW5zZXJ0QXQuYmVmb3JlKSB7XG5cdFx0dmFyIG5leHRTaWJsaW5nID0gZ2V0RWxlbWVudChvcHRpb25zLmluc2VydEF0LmJlZm9yZSwgdGFyZ2V0KTtcblx0XHR0YXJnZXQuaW5zZXJ0QmVmb3JlKHN0eWxlLCBuZXh0U2libGluZyk7XG5cdH0gZWxzZSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiW1N0eWxlIExvYWRlcl1cXG5cXG4gSW52YWxpZCB2YWx1ZSBmb3IgcGFyYW1ldGVyICdpbnNlcnRBdCcgKCdvcHRpb25zLmluc2VydEF0JykgZm91bmQuXFxuIE11c3QgYmUgJ3RvcCcsICdib3R0b20nLCBvciBPYmplY3QuXFxuIChodHRwczovL2dpdGh1Yi5jb20vd2VicGFjay1jb250cmliL3N0eWxlLWxvYWRlciNpbnNlcnRhdClcXG5cIik7XG5cdH1cbn1cblxuZnVuY3Rpb24gcmVtb3ZlU3R5bGVFbGVtZW50IChzdHlsZSkge1xuXHRpZiAoc3R5bGUucGFyZW50Tm9kZSA9PT0gbnVsbCkgcmV0dXJuIGZhbHNlO1xuXHRzdHlsZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHN0eWxlKTtcblxuXHR2YXIgaWR4ID0gc3R5bGVzSW5zZXJ0ZWRBdFRvcC5pbmRleE9mKHN0eWxlKTtcblx0aWYoaWR4ID49IDApIHtcblx0XHRzdHlsZXNJbnNlcnRlZEF0VG9wLnNwbGljZShpZHgsIDEpO1xuXHR9XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVN0eWxlRWxlbWVudCAob3B0aW9ucykge1xuXHR2YXIgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3R5bGVcIik7XG5cblx0aWYob3B0aW9ucy5hdHRycy50eXBlID09PSB1bmRlZmluZWQpIHtcblx0XHRvcHRpb25zLmF0dHJzLnR5cGUgPSBcInRleHQvY3NzXCI7XG5cdH1cblxuXHRpZihvcHRpb25zLmF0dHJzLm5vbmNlID09PSB1bmRlZmluZWQpIHtcblx0XHR2YXIgbm9uY2UgPSBnZXROb25jZSgpO1xuXHRcdGlmIChub25jZSkge1xuXHRcdFx0b3B0aW9ucy5hdHRycy5ub25jZSA9IG5vbmNlO1xuXHRcdH1cblx0fVxuXG5cdGFkZEF0dHJzKHN0eWxlLCBvcHRpb25zLmF0dHJzKTtcblx0aW5zZXJ0U3R5bGVFbGVtZW50KG9wdGlvbnMsIHN0eWxlKTtcblxuXHRyZXR1cm4gc3R5bGU7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUxpbmtFbGVtZW50IChvcHRpb25zKSB7XG5cdHZhciBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxpbmtcIik7XG5cblx0aWYob3B0aW9ucy5hdHRycy50eXBlID09PSB1bmRlZmluZWQpIHtcblx0XHRvcHRpb25zLmF0dHJzLnR5cGUgPSBcInRleHQvY3NzXCI7XG5cdH1cblx0b3B0aW9ucy5hdHRycy5yZWwgPSBcInN0eWxlc2hlZXRcIjtcblxuXHRhZGRBdHRycyhsaW5rLCBvcHRpb25zLmF0dHJzKTtcblx0aW5zZXJ0U3R5bGVFbGVtZW50KG9wdGlvbnMsIGxpbmspO1xuXG5cdHJldHVybiBsaW5rO1xufVxuXG5mdW5jdGlvbiBhZGRBdHRycyAoZWwsIGF0dHJzKSB7XG5cdE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcblx0XHRlbC5zZXRBdHRyaWJ1dGUoa2V5LCBhdHRyc1trZXldKTtcblx0fSk7XG59XG5cbmZ1bmN0aW9uIGdldE5vbmNlKCkge1xuXHRpZiAodHlwZW9mIF9fd2VicGFja19ub25jZV9fID09PSAndW5kZWZpbmVkJykge1xuXHRcdHJldHVybiBudWxsO1xuXHR9XG5cblx0cmV0dXJuIF9fd2VicGFja19ub25jZV9fO1xufVxuXG5mdW5jdGlvbiBhZGRTdHlsZSAob2JqLCBvcHRpb25zKSB7XG5cdHZhciBzdHlsZSwgdXBkYXRlLCByZW1vdmUsIHJlc3VsdDtcblxuXHQvLyBJZiBhIHRyYW5zZm9ybSBmdW5jdGlvbiB3YXMgZGVmaW5lZCwgcnVuIGl0IG9uIHRoZSBjc3Ncblx0aWYgKG9wdGlvbnMudHJhbnNmb3JtICYmIG9iai5jc3MpIHtcblx0ICAgIHJlc3VsdCA9IHR5cGVvZiBvcHRpb25zLnRyYW5zZm9ybSA9PT0gJ2Z1bmN0aW9uJ1xuXHRcdCA/IG9wdGlvbnMudHJhbnNmb3JtKG9iai5jc3MpIFxuXHRcdCA6IG9wdGlvbnMudHJhbnNmb3JtLmRlZmF1bHQob2JqLmNzcyk7XG5cblx0ICAgIGlmIChyZXN1bHQpIHtcblx0ICAgIFx0Ly8gSWYgdHJhbnNmb3JtIHJldHVybnMgYSB2YWx1ZSwgdXNlIHRoYXQgaW5zdGVhZCBvZiB0aGUgb3JpZ2luYWwgY3NzLlxuXHQgICAgXHQvLyBUaGlzIGFsbG93cyBydW5uaW5nIHJ1bnRpbWUgdHJhbnNmb3JtYXRpb25zIG9uIHRoZSBjc3MuXG5cdCAgICBcdG9iai5jc3MgPSByZXN1bHQ7XG5cdCAgICB9IGVsc2Uge1xuXHQgICAgXHQvLyBJZiB0aGUgdHJhbnNmb3JtIGZ1bmN0aW9uIHJldHVybnMgYSBmYWxzeSB2YWx1ZSwgZG9uJ3QgYWRkIHRoaXMgY3NzLlxuXHQgICAgXHQvLyBUaGlzIGFsbG93cyBjb25kaXRpb25hbCBsb2FkaW5nIG9mIGNzc1xuXHQgICAgXHRyZXR1cm4gZnVuY3Rpb24oKSB7XG5cdCAgICBcdFx0Ly8gbm9vcFxuXHQgICAgXHR9O1xuXHQgICAgfVxuXHR9XG5cblx0aWYgKG9wdGlvbnMuc2luZ2xldG9uKSB7XG5cdFx0dmFyIHN0eWxlSW5kZXggPSBzaW5nbGV0b25Db3VudGVyKys7XG5cblx0XHRzdHlsZSA9IHNpbmdsZXRvbiB8fCAoc2luZ2xldG9uID0gY3JlYXRlU3R5bGVFbGVtZW50KG9wdGlvbnMpKTtcblxuXHRcdHVwZGF0ZSA9IGFwcGx5VG9TaW5nbGV0b25UYWcuYmluZChudWxsLCBzdHlsZSwgc3R5bGVJbmRleCwgZmFsc2UpO1xuXHRcdHJlbW92ZSA9IGFwcGx5VG9TaW5nbGV0b25UYWcuYmluZChudWxsLCBzdHlsZSwgc3R5bGVJbmRleCwgdHJ1ZSk7XG5cblx0fSBlbHNlIGlmIChcblx0XHRvYmouc291cmNlTWFwICYmXG5cdFx0dHlwZW9mIFVSTCA9PT0gXCJmdW5jdGlvblwiICYmXG5cdFx0dHlwZW9mIFVSTC5jcmVhdGVPYmplY3RVUkwgPT09IFwiZnVuY3Rpb25cIiAmJlxuXHRcdHR5cGVvZiBVUkwucmV2b2tlT2JqZWN0VVJMID09PSBcImZ1bmN0aW9uXCIgJiZcblx0XHR0eXBlb2YgQmxvYiA9PT0gXCJmdW5jdGlvblwiICYmXG5cdFx0dHlwZW9mIGJ0b2EgPT09IFwiZnVuY3Rpb25cIlxuXHQpIHtcblx0XHRzdHlsZSA9IGNyZWF0ZUxpbmtFbGVtZW50KG9wdGlvbnMpO1xuXHRcdHVwZGF0ZSA9IHVwZGF0ZUxpbmsuYmluZChudWxsLCBzdHlsZSwgb3B0aW9ucyk7XG5cdFx0cmVtb3ZlID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0cmVtb3ZlU3R5bGVFbGVtZW50KHN0eWxlKTtcblxuXHRcdFx0aWYoc3R5bGUuaHJlZikgVVJMLnJldm9rZU9iamVjdFVSTChzdHlsZS5ocmVmKTtcblx0XHR9O1xuXHR9IGVsc2Uge1xuXHRcdHN0eWxlID0gY3JlYXRlU3R5bGVFbGVtZW50KG9wdGlvbnMpO1xuXHRcdHVwZGF0ZSA9IGFwcGx5VG9UYWcuYmluZChudWxsLCBzdHlsZSk7XG5cdFx0cmVtb3ZlID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0cmVtb3ZlU3R5bGVFbGVtZW50KHN0eWxlKTtcblx0XHR9O1xuXHR9XG5cblx0dXBkYXRlKG9iaik7XG5cblx0cmV0dXJuIGZ1bmN0aW9uIHVwZGF0ZVN0eWxlIChuZXdPYmopIHtcblx0XHRpZiAobmV3T2JqKSB7XG5cdFx0XHRpZiAoXG5cdFx0XHRcdG5ld09iai5jc3MgPT09IG9iai5jc3MgJiZcblx0XHRcdFx0bmV3T2JqLm1lZGlhID09PSBvYmoubWVkaWEgJiZcblx0XHRcdFx0bmV3T2JqLnNvdXJjZU1hcCA9PT0gb2JqLnNvdXJjZU1hcFxuXHRcdFx0KSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0dXBkYXRlKG9iaiA9IG5ld09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJlbW92ZSgpO1xuXHRcdH1cblx0fTtcbn1cblxudmFyIHJlcGxhY2VUZXh0ID0gKGZ1bmN0aW9uICgpIHtcblx0dmFyIHRleHRTdG9yZSA9IFtdO1xuXG5cdHJldHVybiBmdW5jdGlvbiAoaW5kZXgsIHJlcGxhY2VtZW50KSB7XG5cdFx0dGV4dFN0b3JlW2luZGV4XSA9IHJlcGxhY2VtZW50O1xuXG5cdFx0cmV0dXJuIHRleHRTdG9yZS5maWx0ZXIoQm9vbGVhbikuam9pbignXFxuJyk7XG5cdH07XG59KSgpO1xuXG5mdW5jdGlvbiBhcHBseVRvU2luZ2xldG9uVGFnIChzdHlsZSwgaW5kZXgsIHJlbW92ZSwgb2JqKSB7XG5cdHZhciBjc3MgPSByZW1vdmUgPyBcIlwiIDogb2JqLmNzcztcblxuXHRpZiAoc3R5bGUuc3R5bGVTaGVldCkge1xuXHRcdHN0eWxlLnN0eWxlU2hlZXQuY3NzVGV4dCA9IHJlcGxhY2VUZXh0KGluZGV4LCBjc3MpO1xuXHR9IGVsc2Uge1xuXHRcdHZhciBjc3NOb2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoY3NzKTtcblx0XHR2YXIgY2hpbGROb2RlcyA9IHN0eWxlLmNoaWxkTm9kZXM7XG5cblx0XHRpZiAoY2hpbGROb2Rlc1tpbmRleF0pIHN0eWxlLnJlbW92ZUNoaWxkKGNoaWxkTm9kZXNbaW5kZXhdKTtcblxuXHRcdGlmIChjaGlsZE5vZGVzLmxlbmd0aCkge1xuXHRcdFx0c3R5bGUuaW5zZXJ0QmVmb3JlKGNzc05vZGUsIGNoaWxkTm9kZXNbaW5kZXhdKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0c3R5bGUuYXBwZW5kQ2hpbGQoY3NzTm9kZSk7XG5cdFx0fVxuXHR9XG59XG5cbmZ1bmN0aW9uIGFwcGx5VG9UYWcgKHN0eWxlLCBvYmopIHtcblx0dmFyIGNzcyA9IG9iai5jc3M7XG5cdHZhciBtZWRpYSA9IG9iai5tZWRpYTtcblxuXHRpZihtZWRpYSkge1xuXHRcdHN0eWxlLnNldEF0dHJpYnV0ZShcIm1lZGlhXCIsIG1lZGlhKVxuXHR9XG5cblx0aWYoc3R5bGUuc3R5bGVTaGVldCkge1xuXHRcdHN0eWxlLnN0eWxlU2hlZXQuY3NzVGV4dCA9IGNzcztcblx0fSBlbHNlIHtcblx0XHR3aGlsZShzdHlsZS5maXJzdENoaWxkKSB7XG5cdFx0XHRzdHlsZS5yZW1vdmVDaGlsZChzdHlsZS5maXJzdENoaWxkKTtcblx0XHR9XG5cblx0XHRzdHlsZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShjc3MpKTtcblx0fVxufVxuXG5mdW5jdGlvbiB1cGRhdGVMaW5rIChsaW5rLCBvcHRpb25zLCBvYmopIHtcblx0dmFyIGNzcyA9IG9iai5jc3M7XG5cdHZhciBzb3VyY2VNYXAgPSBvYmouc291cmNlTWFwO1xuXG5cdC8qXG5cdFx0SWYgY29udmVydFRvQWJzb2x1dGVVcmxzIGlzbid0IGRlZmluZWQsIGJ1dCBzb3VyY2VtYXBzIGFyZSBlbmFibGVkXG5cdFx0YW5kIHRoZXJlIGlzIG5vIHB1YmxpY1BhdGggZGVmaW5lZCB0aGVuIGxldHMgdHVybiBjb252ZXJ0VG9BYnNvbHV0ZVVybHNcblx0XHRvbiBieSBkZWZhdWx0LiAgT3RoZXJ3aXNlIGRlZmF1bHQgdG8gdGhlIGNvbnZlcnRUb0Fic29sdXRlVXJscyBvcHRpb25cblx0XHRkaXJlY3RseVxuXHQqL1xuXHR2YXIgYXV0b0ZpeFVybHMgPSBvcHRpb25zLmNvbnZlcnRUb0Fic29sdXRlVXJscyA9PT0gdW5kZWZpbmVkICYmIHNvdXJjZU1hcDtcblxuXHRpZiAob3B0aW9ucy5jb252ZXJ0VG9BYnNvbHV0ZVVybHMgfHwgYXV0b0ZpeFVybHMpIHtcblx0XHRjc3MgPSBmaXhVcmxzKGNzcyk7XG5cdH1cblxuXHRpZiAoc291cmNlTWFwKSB7XG5cdFx0Ly8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMjY2MDM4NzVcblx0XHRjc3MgKz0gXCJcXG4vKiMgc291cmNlTWFwcGluZ1VSTD1kYXRhOmFwcGxpY2F0aW9uL2pzb247YmFzZTY0LFwiICsgYnRvYSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkoc291cmNlTWFwKSkpKSArIFwiICovXCI7XG5cdH1cblxuXHR2YXIgYmxvYiA9IG5ldyBCbG9iKFtjc3NdLCB7IHR5cGU6IFwidGV4dC9jc3NcIiB9KTtcblxuXHR2YXIgb2xkU3JjID0gbGluay5ocmVmO1xuXG5cdGxpbmsuaHJlZiA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG5cblx0aWYob2xkU3JjKSBVUkwucmV2b2tlT2JqZWN0VVJMKG9sZFNyYyk7XG59XG4iLCJcbi8qKlxuICogV2hlbiBzb3VyY2UgbWFwcyBhcmUgZW5hYmxlZCwgYHN0eWxlLWxvYWRlcmAgdXNlcyBhIGxpbmsgZWxlbWVudCB3aXRoIGEgZGF0YS11cmkgdG9cbiAqIGVtYmVkIHRoZSBjc3Mgb24gdGhlIHBhZ2UuIFRoaXMgYnJlYWtzIGFsbCByZWxhdGl2ZSB1cmxzIGJlY2F1c2Ugbm93IHRoZXkgYXJlIHJlbGF0aXZlIHRvIGFcbiAqIGJ1bmRsZSBpbnN0ZWFkIG9mIHRoZSBjdXJyZW50IHBhZ2UuXG4gKlxuICogT25lIHNvbHV0aW9uIGlzIHRvIG9ubHkgdXNlIGZ1bGwgdXJscywgYnV0IHRoYXQgbWF5IGJlIGltcG9zc2libGUuXG4gKlxuICogSW5zdGVhZCwgdGhpcyBmdW5jdGlvbiBcImZpeGVzXCIgdGhlIHJlbGF0aXZlIHVybHMgdG8gYmUgYWJzb2x1dGUgYWNjb3JkaW5nIHRvIHRoZSBjdXJyZW50IHBhZ2UgbG9jYXRpb24uXG4gKlxuICogQSBydWRpbWVudGFyeSB0ZXN0IHN1aXRlIGlzIGxvY2F0ZWQgYXQgYHRlc3QvZml4VXJscy5qc2AgYW5kIGNhbiBiZSBydW4gdmlhIHRoZSBgbnBtIHRlc3RgIGNvbW1hbmQuXG4gKlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGNzcykge1xuICAvLyBnZXQgY3VycmVudCBsb2NhdGlvblxuICB2YXIgbG9jYXRpb24gPSB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiICYmIHdpbmRvdy5sb2NhdGlvbjtcblxuICBpZiAoIWxvY2F0aW9uKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiZml4VXJscyByZXF1aXJlcyB3aW5kb3cubG9jYXRpb25cIik7XG4gIH1cblxuXHQvLyBibGFuayBvciBudWxsP1xuXHRpZiAoIWNzcyB8fCB0eXBlb2YgY3NzICE9PSBcInN0cmluZ1wiKSB7XG5cdCAgcmV0dXJuIGNzcztcbiAgfVxuXG4gIHZhciBiYXNlVXJsID0gbG9jYXRpb24ucHJvdG9jb2wgKyBcIi8vXCIgKyBsb2NhdGlvbi5ob3N0O1xuICB2YXIgY3VycmVudERpciA9IGJhc2VVcmwgKyBsb2NhdGlvbi5wYXRobmFtZS5yZXBsYWNlKC9cXC9bXlxcL10qJC8sIFwiL1wiKTtcblxuXHQvLyBjb252ZXJ0IGVhY2ggdXJsKC4uLilcblx0Lypcblx0VGhpcyByZWd1bGFyIGV4cHJlc3Npb24gaXMganVzdCBhIHdheSB0byByZWN1cnNpdmVseSBtYXRjaCBicmFja2V0cyB3aXRoaW5cblx0YSBzdHJpbmcuXG5cblx0IC91cmxcXHMqXFwoICA9IE1hdGNoIG9uIHRoZSB3b3JkIFwidXJsXCIgd2l0aCBhbnkgd2hpdGVzcGFjZSBhZnRlciBpdCBhbmQgdGhlbiBhIHBhcmVuc1xuXHQgICAoICA9IFN0YXJ0IGEgY2FwdHVyaW5nIGdyb3VwXG5cdCAgICAgKD86ICA9IFN0YXJ0IGEgbm9uLWNhcHR1cmluZyBncm91cFxuXHQgICAgICAgICBbXikoXSAgPSBNYXRjaCBhbnl0aGluZyB0aGF0IGlzbid0IGEgcGFyZW50aGVzZXNcblx0ICAgICAgICAgfCAgPSBPUlxuXHQgICAgICAgICBcXCggID0gTWF0Y2ggYSBzdGFydCBwYXJlbnRoZXNlc1xuXHQgICAgICAgICAgICAgKD86ICA9IFN0YXJ0IGFub3RoZXIgbm9uLWNhcHR1cmluZyBncm91cHNcblx0ICAgICAgICAgICAgICAgICBbXikoXSsgID0gTWF0Y2ggYW55dGhpbmcgdGhhdCBpc24ndCBhIHBhcmVudGhlc2VzXG5cdCAgICAgICAgICAgICAgICAgfCAgPSBPUlxuXHQgICAgICAgICAgICAgICAgIFxcKCAgPSBNYXRjaCBhIHN0YXJ0IHBhcmVudGhlc2VzXG5cdCAgICAgICAgICAgICAgICAgICAgIFteKShdKiAgPSBNYXRjaCBhbnl0aGluZyB0aGF0IGlzbid0IGEgcGFyZW50aGVzZXNcblx0ICAgICAgICAgICAgICAgICBcXCkgID0gTWF0Y2ggYSBlbmQgcGFyZW50aGVzZXNcblx0ICAgICAgICAgICAgICkgID0gRW5kIEdyb3VwXG4gICAgICAgICAgICAgICpcXCkgPSBNYXRjaCBhbnl0aGluZyBhbmQgdGhlbiBhIGNsb3NlIHBhcmVuc1xuICAgICAgICAgICkgID0gQ2xvc2Ugbm9uLWNhcHR1cmluZyBncm91cFxuICAgICAgICAgICogID0gTWF0Y2ggYW55dGhpbmdcbiAgICAgICApICA9IENsb3NlIGNhcHR1cmluZyBncm91cFxuXHQgXFwpICA9IE1hdGNoIGEgY2xvc2UgcGFyZW5zXG5cblx0IC9naSAgPSBHZXQgYWxsIG1hdGNoZXMsIG5vdCB0aGUgZmlyc3QuICBCZSBjYXNlIGluc2Vuc2l0aXZlLlxuXHQgKi9cblx0dmFyIGZpeGVkQ3NzID0gY3NzLnJlcGxhY2UoL3VybFxccypcXCgoKD86W14pKF18XFwoKD86W14pKF0rfFxcKFteKShdKlxcKSkqXFwpKSopXFwpL2dpLCBmdW5jdGlvbihmdWxsTWF0Y2gsIG9yaWdVcmwpIHtcblx0XHQvLyBzdHJpcCBxdW90ZXMgKGlmIHRoZXkgZXhpc3QpXG5cdFx0dmFyIHVucXVvdGVkT3JpZ1VybCA9IG9yaWdVcmxcblx0XHRcdC50cmltKClcblx0XHRcdC5yZXBsYWNlKC9eXCIoLiopXCIkLywgZnVuY3Rpb24obywgJDEpeyByZXR1cm4gJDE7IH0pXG5cdFx0XHQucmVwbGFjZSgvXicoLiopJyQvLCBmdW5jdGlvbihvLCAkMSl7IHJldHVybiAkMTsgfSk7XG5cblx0XHQvLyBhbHJlYWR5IGEgZnVsbCB1cmw/IG5vIGNoYW5nZVxuXHRcdGlmICgvXigjfGRhdGE6fGh0dHA6XFwvXFwvfGh0dHBzOlxcL1xcL3xmaWxlOlxcL1xcL1xcL3xcXHMqJCkvaS50ZXN0KHVucXVvdGVkT3JpZ1VybCkpIHtcblx0XHQgIHJldHVybiBmdWxsTWF0Y2g7XG5cdFx0fVxuXG5cdFx0Ly8gY29udmVydCB0aGUgdXJsIHRvIGEgZnVsbCB1cmxcblx0XHR2YXIgbmV3VXJsO1xuXG5cdFx0aWYgKHVucXVvdGVkT3JpZ1VybC5pbmRleE9mKFwiLy9cIikgPT09IDApIHtcblx0XHQgIFx0Ly9UT0RPOiBzaG91bGQgd2UgYWRkIHByb3RvY29sP1xuXHRcdFx0bmV3VXJsID0gdW5xdW90ZWRPcmlnVXJsO1xuXHRcdH0gZWxzZSBpZiAodW5xdW90ZWRPcmlnVXJsLmluZGV4T2YoXCIvXCIpID09PSAwKSB7XG5cdFx0XHQvLyBwYXRoIHNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYmFzZSB1cmxcblx0XHRcdG5ld1VybCA9IGJhc2VVcmwgKyB1bnF1b3RlZE9yaWdVcmw7IC8vIGFscmVhZHkgc3RhcnRzIHdpdGggJy8nXG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIHBhdGggc2hvdWxkIGJlIHJlbGF0aXZlIHRvIGN1cnJlbnQgZGlyZWN0b3J5XG5cdFx0XHRuZXdVcmwgPSBjdXJyZW50RGlyICsgdW5xdW90ZWRPcmlnVXJsLnJlcGxhY2UoL15cXC5cXC8vLCBcIlwiKTsgLy8gU3RyaXAgbGVhZGluZyAnLi8nXG5cdFx0fVxuXG5cdFx0Ly8gc2VuZCBiYWNrIHRoZSBmaXhlZCB1cmwoLi4uKVxuXHRcdHJldHVybiBcInVybChcIiArIEpTT04uc3RyaW5naWZ5KG5ld1VybCkgKyBcIilcIjtcblx0fSk7XG5cblx0Ly8gc2VuZCBiYWNrIHRoZSBmaXhlZCBjc3Ncblx0cmV0dXJuIGZpeGVkQ3NzO1xufTtcbiIsIlxudmFyIGNvbnRlbnQgPSByZXF1aXJlKFwiISEuLi8uLi8uLi9jc3MtbG9hZGVyL2Rpc3QvY2pzLmpzIS4vdGFidWxhdG9yLm1pbi5jc3NcIik7XG5cbmlmKHR5cGVvZiBjb250ZW50ID09PSAnc3RyaW5nJykgY29udGVudCA9IFtbbW9kdWxlLmlkLCBjb250ZW50LCAnJ11dO1xuXG52YXIgdHJhbnNmb3JtO1xudmFyIGluc2VydEludG87XG5cblxuXG52YXIgb3B0aW9ucyA9IHtcImluc2VydEF0XCI6XCJ0b3BcIixcImhtclwiOnRydWV9XG5cbm9wdGlvbnMudHJhbnNmb3JtID0gdHJhbnNmb3JtXG5vcHRpb25zLmluc2VydEludG8gPSB1bmRlZmluZWQ7XG5cbnZhciB1cGRhdGUgPSByZXF1aXJlKFwiIS4uLy4uLy4uL3N0eWxlLWxvYWRlci9saWIvYWRkU3R5bGVzLmpzXCIpKGNvbnRlbnQsIG9wdGlvbnMpO1xuXG5pZihjb250ZW50LmxvY2FscykgbW9kdWxlLmV4cG9ydHMgPSBjb250ZW50LmxvY2FscztcblxuaWYobW9kdWxlLmhvdCkge1xuXHRtb2R1bGUuaG90LmFjY2VwdChcIiEhLi4vLi4vLi4vY3NzLWxvYWRlci9kaXN0L2Nqcy5qcyEuL3RhYnVsYXRvci5taW4uY3NzXCIsIGZ1bmN0aW9uKCkge1xuXHRcdHZhciBuZXdDb250ZW50ID0gcmVxdWlyZShcIiEhLi4vLi4vLi4vY3NzLWxvYWRlci9kaXN0L2Nqcy5qcyEuL3RhYnVsYXRvci5taW4uY3NzXCIpO1xuXG5cdFx0aWYodHlwZW9mIG5ld0NvbnRlbnQgPT09ICdzdHJpbmcnKSBuZXdDb250ZW50ID0gW1ttb2R1bGUuaWQsIG5ld0NvbnRlbnQsICcnXV07XG5cblx0XHR2YXIgbG9jYWxzID0gKGZ1bmN0aW9uKGEsIGIpIHtcblx0XHRcdHZhciBrZXksIGlkeCA9IDA7XG5cblx0XHRcdGZvcihrZXkgaW4gYSkge1xuXHRcdFx0XHRpZighYiB8fCBhW2tleV0gIT09IGJba2V5XSkgcmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRpZHgrKztcblx0XHRcdH1cblxuXHRcdFx0Zm9yKGtleSBpbiBiKSBpZHgtLTtcblxuXHRcdFx0cmV0dXJuIGlkeCA9PT0gMDtcblx0XHR9KGNvbnRlbnQubG9jYWxzLCBuZXdDb250ZW50LmxvY2FscykpO1xuXG5cdFx0aWYoIWxvY2FscykgdGhyb3cgbmV3IEVycm9yKCdBYm9ydGluZyBDU1MgSE1SIGR1ZSB0byBjaGFuZ2VkIGNzcy1tb2R1bGVzIGxvY2Fscy4nKTtcblxuXHRcdHVwZGF0ZShuZXdDb250ZW50KTtcblx0fSk7XG5cblx0bW9kdWxlLmhvdC5kaXNwb3NlKGZ1bmN0aW9uKCkgeyB1cGRhdGUoKTsgfSk7XG59IiwidmFyIF90eXBlb2YgPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gXCJzeW1ib2xcIiA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqOyB9O1xuXG4vKiBUYWJ1bGF0b3IgdjQuNy4wIChjKSBPbGl2ZXIgRm9sa2VyZCAqL1xuXG47KGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHtcblx0aWYgKCh0eXBlb2YgZXhwb3J0cyA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoZXhwb3J0cykpID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xuXHR9IGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuXHRcdGRlZmluZShmYWN0b3J5KTtcblx0fSBlbHNlIHtcblx0XHRnbG9iYWwuVGFidWxhdG9yID0gZmFjdG9yeSgpO1xuXHR9XG59KSh0aGlzLCBmdW5jdGlvbiAoKSB7XG5cblx0J3VzZSBzdHJpY3QnO1xuXG5cdC8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5maW5kSW5kZXhcblxuXG5cdGlmICghQXJyYXkucHJvdG90eXBlLmZpbmRJbmRleCkge1xuXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KEFycmF5LnByb3RvdHlwZSwgJ2ZpbmRJbmRleCcsIHtcblxuXHRcdFx0dmFsdWU6IGZ1bmN0aW9uIHZhbHVlKHByZWRpY2F0ZSkge1xuXG5cdFx0XHRcdC8vIDEuIExldCBPIGJlID8gVG9PYmplY3QodGhpcyB2YWx1ZSkuXG5cblxuXHRcdFx0XHRpZiAodGhpcyA9PSBudWxsKSB7XG5cblx0XHRcdFx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKCdcInRoaXNcIiBpcyBudWxsIG9yIG5vdCBkZWZpbmVkJyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR2YXIgbyA9IE9iamVjdCh0aGlzKTtcblxuXHRcdFx0XHQvLyAyLiBMZXQgbGVuIGJlID8gVG9MZW5ndGgoPyBHZXQoTywgXCJsZW5ndGhcIikpLlxuXG5cblx0XHRcdFx0dmFyIGxlbiA9IG8ubGVuZ3RoID4+PiAwO1xuXG5cdFx0XHRcdC8vIDMuIElmIElzQ2FsbGFibGUocHJlZGljYXRlKSBpcyBmYWxzZSwgdGhyb3cgYSBUeXBlRXJyb3IgZXhjZXB0aW9uLlxuXG5cblx0XHRcdFx0aWYgKHR5cGVvZiBwcmVkaWNhdGUgIT09ICdmdW5jdGlvbicpIHtcblxuXHRcdFx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoJ3ByZWRpY2F0ZSBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIDQuIElmIHRoaXNBcmcgd2FzIHN1cHBsaWVkLCBsZXQgVCBiZSB0aGlzQXJnOyBlbHNlIGxldCBUIGJlIHVuZGVmaW5lZC5cblxuXG5cdFx0XHRcdHZhciB0aGlzQXJnID0gYXJndW1lbnRzWzFdO1xuXG5cdFx0XHRcdC8vIDUuIExldCBrIGJlIDAuXG5cblxuXHRcdFx0XHR2YXIgayA9IDA7XG5cblx0XHRcdFx0Ly8gNi4gUmVwZWF0LCB3aGlsZSBrIDwgbGVuXG5cblxuXHRcdFx0XHR3aGlsZSAoayA8IGxlbikge1xuXG5cdFx0XHRcdFx0Ly8gYS4gTGV0IFBrIGJlICEgVG9TdHJpbmcoaykuXG5cblxuXHRcdFx0XHRcdC8vIGIuIExldCBrVmFsdWUgYmUgPyBHZXQoTywgUGspLlxuXG5cblx0XHRcdFx0XHQvLyBjLiBMZXQgdGVzdFJlc3VsdCBiZSBUb0Jvb2xlYW4oPyBDYWxsKHByZWRpY2F0ZSwgVCwgwqsga1ZhbHVlLCBrLCBPIMK7KSkuXG5cblxuXHRcdFx0XHRcdC8vIGQuIElmIHRlc3RSZXN1bHQgaXMgdHJ1ZSwgcmV0dXJuIGsuXG5cblxuXHRcdFx0XHRcdHZhciBrVmFsdWUgPSBvW2tdO1xuXG5cdFx0XHRcdFx0aWYgKHByZWRpY2F0ZS5jYWxsKHRoaXNBcmcsIGtWYWx1ZSwgaywgbykpIHtcblxuXHRcdFx0XHRcdFx0cmV0dXJuIGs7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gZS4gSW5jcmVhc2UgayBieSAxLlxuXG5cblx0XHRcdFx0XHRrKys7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyA3LiBSZXR1cm4gLTEuXG5cblxuXHRcdFx0XHRyZXR1cm4gLTE7XG5cdFx0XHR9XG5cblx0XHR9KTtcblx0fVxuXG5cdC8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5maW5kXG5cblxuXHRpZiAoIUFycmF5LnByb3RvdHlwZS5maW5kKSB7XG5cblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJyYXkucHJvdG90eXBlLCAnZmluZCcsIHtcblxuXHRcdFx0dmFsdWU6IGZ1bmN0aW9uIHZhbHVlKHByZWRpY2F0ZSkge1xuXG5cdFx0XHRcdC8vIDEuIExldCBPIGJlID8gVG9PYmplY3QodGhpcyB2YWx1ZSkuXG5cblxuXHRcdFx0XHRpZiAodGhpcyA9PSBudWxsKSB7XG5cblx0XHRcdFx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKCdcInRoaXNcIiBpcyBudWxsIG9yIG5vdCBkZWZpbmVkJyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR2YXIgbyA9IE9iamVjdCh0aGlzKTtcblxuXHRcdFx0XHQvLyAyLiBMZXQgbGVuIGJlID8gVG9MZW5ndGgoPyBHZXQoTywgXCJsZW5ndGhcIikpLlxuXG5cblx0XHRcdFx0dmFyIGxlbiA9IG8ubGVuZ3RoID4+PiAwO1xuXG5cdFx0XHRcdC8vIDMuIElmIElzQ2FsbGFibGUocHJlZGljYXRlKSBpcyBmYWxzZSwgdGhyb3cgYSBUeXBlRXJyb3IgZXhjZXB0aW9uLlxuXG5cblx0XHRcdFx0aWYgKHR5cGVvZiBwcmVkaWNhdGUgIT09ICdmdW5jdGlvbicpIHtcblxuXHRcdFx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoJ3ByZWRpY2F0ZSBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIDQuIElmIHRoaXNBcmcgd2FzIHN1cHBsaWVkLCBsZXQgVCBiZSB0aGlzQXJnOyBlbHNlIGxldCBUIGJlIHVuZGVmaW5lZC5cblxuXG5cdFx0XHRcdHZhciB0aGlzQXJnID0gYXJndW1lbnRzWzFdO1xuXG5cdFx0XHRcdC8vIDUuIExldCBrIGJlIDAuXG5cblxuXHRcdFx0XHR2YXIgayA9IDA7XG5cblx0XHRcdFx0Ly8gNi4gUmVwZWF0LCB3aGlsZSBrIDwgbGVuXG5cblxuXHRcdFx0XHR3aGlsZSAoayA8IGxlbikge1xuXG5cdFx0XHRcdFx0Ly8gYS4gTGV0IFBrIGJlICEgVG9TdHJpbmcoaykuXG5cblxuXHRcdFx0XHRcdC8vIGIuIExldCBrVmFsdWUgYmUgPyBHZXQoTywgUGspLlxuXG5cblx0XHRcdFx0XHQvLyBjLiBMZXQgdGVzdFJlc3VsdCBiZSBUb0Jvb2xlYW4oPyBDYWxsKHByZWRpY2F0ZSwgVCwgwqsga1ZhbHVlLCBrLCBPIMK7KSkuXG5cblxuXHRcdFx0XHRcdC8vIGQuIElmIHRlc3RSZXN1bHQgaXMgdHJ1ZSwgcmV0dXJuIGtWYWx1ZS5cblxuXG5cdFx0XHRcdFx0dmFyIGtWYWx1ZSA9IG9ba107XG5cblx0XHRcdFx0XHRpZiAocHJlZGljYXRlLmNhbGwodGhpc0FyZywga1ZhbHVlLCBrLCBvKSkge1xuXG5cdFx0XHRcdFx0XHRyZXR1cm4ga1ZhbHVlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIGUuIEluY3JlYXNlIGsgYnkgMS5cblxuXG5cdFx0XHRcdFx0aysrO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gNy4gUmV0dXJuIHVuZGVmaW5lZC5cblxuXG5cdFx0XHRcdHJldHVybiB1bmRlZmluZWQ7XG5cdFx0XHR9XG5cblx0XHR9KTtcblx0fVxuXG5cdC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL1N0cmluZy9pbmNsdWRlcyNQb2x5ZmlsbFxuXG5cblx0aWYgKCFTdHJpbmcucHJvdG90eXBlLmluY2x1ZGVzKSB7XG5cblx0XHRTdHJpbmcucHJvdG90eXBlLmluY2x1ZGVzID0gZnVuY3Rpb24gKHNlYXJjaCwgc3RhcnQpIHtcblxuXHRcdFx0J3VzZSBzdHJpY3QnO1xuXG5cdFx0XHRpZiAoc2VhcmNoIGluc3RhbmNlb2YgUmVnRXhwKSB7XG5cblx0XHRcdFx0dGhyb3cgVHlwZUVycm9yKCdmaXJzdCBhcmd1bWVudCBtdXN0IG5vdCBiZSBhIFJlZ0V4cCcpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc3RhcnQgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRzdGFydCA9IDA7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB0aGlzLmluZGV4T2Yoc2VhcmNoLCBzdGFydCkgIT09IC0xO1xuXHRcdH07XG5cdH1cblxuXHQvLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1hcnJheS5wcm90b3R5cGUuaW5jbHVkZXNcblxuXG5cdGlmICghQXJyYXkucHJvdG90eXBlLmluY2x1ZGVzKSB7XG5cblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJyYXkucHJvdG90eXBlLCAnaW5jbHVkZXMnLCB7XG5cblx0XHRcdHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShzZWFyY2hFbGVtZW50LCBmcm9tSW5kZXgpIHtcblxuXHRcdFx0XHRpZiAodGhpcyA9PSBudWxsKSB7XG5cblx0XHRcdFx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKCdcInRoaXNcIiBpcyBudWxsIG9yIG5vdCBkZWZpbmVkJyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyAxLiBMZXQgTyBiZSA/IFRvT2JqZWN0KHRoaXMgdmFsdWUpLlxuXG5cblx0XHRcdFx0dmFyIG8gPSBPYmplY3QodGhpcyk7XG5cblx0XHRcdFx0Ly8gMi4gTGV0IGxlbiBiZSA/IFRvTGVuZ3RoKD8gR2V0KE8sIFwibGVuZ3RoXCIpKS5cblxuXG5cdFx0XHRcdHZhciBsZW4gPSBvLmxlbmd0aCA+Pj4gMDtcblxuXHRcdFx0XHQvLyAzLiBJZiBsZW4gaXMgMCwgcmV0dXJuIGZhbHNlLlxuXG5cblx0XHRcdFx0aWYgKGxlbiA9PT0gMCkge1xuXG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gNC4gTGV0IG4gYmUgPyBUb0ludGVnZXIoZnJvbUluZGV4KS5cblxuXG5cdFx0XHRcdC8vICAgIChJZiBmcm9tSW5kZXggaXMgdW5kZWZpbmVkLCB0aGlzIHN0ZXAgcHJvZHVjZXMgdGhlIHZhbHVlIDAuKVxuXG5cblx0XHRcdFx0dmFyIG4gPSBmcm9tSW5kZXggfCAwO1xuXG5cdFx0XHRcdC8vIDUuIElmIG4g4omlIDAsIHRoZW5cblxuXG5cdFx0XHRcdC8vICBhLiBMZXQgayBiZSBuLlxuXG5cblx0XHRcdFx0Ly8gNi4gRWxzZSBuIDwgMCxcblxuXG5cdFx0XHRcdC8vICBhLiBMZXQgayBiZSBsZW4gKyBuLlxuXG5cblx0XHRcdFx0Ly8gIGIuIElmIGsgPCAwLCBsZXQgayBiZSAwLlxuXG5cblx0XHRcdFx0dmFyIGsgPSBNYXRoLm1heChuID49IDAgPyBuIDogbGVuIC0gTWF0aC5hYnMobiksIDApO1xuXG5cdFx0XHRcdGZ1bmN0aW9uIHNhbWVWYWx1ZVplcm8oeCwgeSkge1xuXG5cdFx0XHRcdFx0cmV0dXJuIHggPT09IHkgfHwgdHlwZW9mIHggPT09ICdudW1iZXInICYmIHR5cGVvZiB5ID09PSAnbnVtYmVyJyAmJiBpc05hTih4KSAmJiBpc05hTih5KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIDcuIFJlcGVhdCwgd2hpbGUgayA8IGxlblxuXG5cblx0XHRcdFx0d2hpbGUgKGsgPCBsZW4pIHtcblxuXHRcdFx0XHRcdC8vIGEuIExldCBlbGVtZW50SyBiZSB0aGUgcmVzdWx0IG9mID8gR2V0KE8sICEgVG9TdHJpbmcoaykpLlxuXG5cblx0XHRcdFx0XHQvLyBiLiBJZiBTYW1lVmFsdWVaZXJvKHNlYXJjaEVsZW1lbnQsIGVsZW1lbnRLKSBpcyB0cnVlLCByZXR1cm4gdHJ1ZS5cblxuXG5cdFx0XHRcdFx0aWYgKHNhbWVWYWx1ZVplcm8ob1trXSwgc2VhcmNoRWxlbWVudCkpIHtcblxuXHRcdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gYy4gSW5jcmVhc2UgayBieSAxLlxuXG5cblx0XHRcdFx0XHRrKys7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyA4LiBSZXR1cm4gZmFsc2VcblxuXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblxuXHRcdH0pO1xuXHR9XG5cblx0Ly8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvT2JqZWN0L2Fzc2lnbiNQb2x5ZmlsbFxuXG5cblx0aWYgKHR5cGVvZiBPYmplY3QuYXNzaWduICE9PSAnZnVuY3Rpb24nKSB7XG5cblx0XHQvLyBNdXN0IGJlIHdyaXRhYmxlOiB0cnVlLCBlbnVtZXJhYmxlOiBmYWxzZSwgY29uZmlndXJhYmxlOiB0cnVlXG5cblxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShPYmplY3QsIFwiYXNzaWduXCIsIHtcblxuXHRcdFx0dmFsdWU6IGZ1bmN0aW9uIGFzc2lnbih0YXJnZXQsIHZhckFyZ3MpIHtcblx0XHRcdFx0Ly8gLmxlbmd0aCBvZiBmdW5jdGlvbiBpcyAyXG5cblxuXHRcdFx0XHQndXNlIHN0cmljdCc7XG5cblx0XHRcdFx0aWYgKHRhcmdldCA9PT0gbnVsbCB8fCB0YXJnZXQgPT09IHVuZGVmaW5lZCkge1xuXG5cdFx0XHRcdFx0dGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNvbnZlcnQgdW5kZWZpbmVkIG9yIG51bGwgdG8gb2JqZWN0Jyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR2YXIgdG8gPSBPYmplY3QodGFyZ2V0KTtcblxuXHRcdFx0XHRmb3IgKHZhciBpbmRleCA9IDE7IGluZGV4IDwgYXJndW1lbnRzLmxlbmd0aDsgaW5kZXgrKykge1xuXG5cdFx0XHRcdFx0dmFyIG5leHRTb3VyY2UgPSBhcmd1bWVudHNbaW5kZXhdO1xuXG5cdFx0XHRcdFx0aWYgKG5leHRTb3VyY2UgIT09IG51bGwgJiYgbmV4dFNvdXJjZSAhPT0gdW5kZWZpbmVkKSB7XG5cblx0XHRcdFx0XHRcdGZvciAodmFyIG5leHRLZXkgaW4gbmV4dFNvdXJjZSkge1xuXG5cdFx0XHRcdFx0XHRcdC8vIEF2b2lkIGJ1Z3Mgd2hlbiBoYXNPd25Qcm9wZXJ0eSBpcyBzaGFkb3dlZFxuXG5cblx0XHRcdFx0XHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChuZXh0U291cmNlLCBuZXh0S2V5KSkge1xuXG5cdFx0XHRcdFx0XHRcdFx0dG9bbmV4dEtleV0gPSBuZXh0U291cmNlW25leHRLZXldO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHRvO1xuXHRcdFx0fSxcblxuXHRcdFx0d3JpdGFibGU6IHRydWUsXG5cblx0XHRcdGNvbmZpZ3VyYWJsZTogdHJ1ZVxuXG5cdFx0fSk7XG5cdH1cblxuXHR2YXIgQ29sdW1uTWFuYWdlciA9IGZ1bmN0aW9uIENvbHVtbk1hbmFnZXIodGFibGUpIHtcblxuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIHBhcmVudCB0YWJsZVxuXG5cblx0XHR0aGlzLmJsb2NrSG96U2Nyb2xsRXZlbnQgPSBmYWxzZTtcblxuXHRcdHRoaXMuaGVhZGVyc0VsZW1lbnQgPSB0aGlzLmNyZWF0ZUhlYWRlcnNFbGVtZW50KCk7XG5cblx0XHR0aGlzLmVsZW1lbnQgPSB0aGlzLmNyZWF0ZUhlYWRlckVsZW1lbnQoKTsgLy9jb250YWluaW5nIGVsZW1lbnRcblxuXG5cdFx0dGhpcy5yb3dNYW5hZ2VyID0gbnVsbDsgLy9ob2xkIHJvdyBtYW5hZ2VyIG9iamVjdFxuXG5cblx0XHR0aGlzLmNvbHVtbnMgPSBbXTsgLy8gY29sdW1uIGRlZmluaXRpb24gb2JqZWN0XG5cblxuXHRcdHRoaXMuY29sdW1uc0J5SW5kZXggPSBbXTsgLy9jb2x1bW5zIGJ5IGluZGV4XG5cblxuXHRcdHRoaXMuY29sdW1uc0J5RmllbGQgPSB7fTsgLy9jb2x1bW5zIGJ5IGZpZWxkXG5cblxuXHRcdHRoaXMuc2Nyb2xsTGVmdCA9IDA7XG5cblx0XHR0aGlzLmVsZW1lbnQuaW5zZXJ0QmVmb3JlKHRoaXMuaGVhZGVyc0VsZW1lbnQsIHRoaXMuZWxlbWVudC5maXJzdENoaWxkKTtcblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLyBTZXR1cCBGdW5jdGlvbnMgLy8vLy8vLy8vLy8vLy8vLy9cblxuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLmNyZWF0ZUhlYWRlcnNFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItaGVhZGVyc1wiKTtcblxuXHRcdHJldHVybiBlbDtcblx0fTtcblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5jcmVhdGVIZWFkZXJFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItaGVhZGVyXCIpO1xuXG5cdFx0aWYgKCF0aGlzLnRhYmxlLm9wdGlvbnMuaGVhZGVyVmlzaWJsZSkge1xuXG5cdFx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWhlYWRlci1oaWRkZW5cIik7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGVsO1xuXHR9O1xuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHQvL3Njcm9sbCBib2R5IGFsb25nIHdpdGggaGVhZGVyXG5cblxuXHRcdC8vIHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIGZ1bmN0aW9uKGUpe1xuXG5cblx0XHQvLyBcdGlmKCFzZWxmLmJsb2NrSG96U2Nyb2xsRXZlbnQpe1xuXG5cblx0XHQvLyBcdFx0c2VsZi50YWJsZS5yb3dNYW5hZ2VyLnNjcm9sbEhvcml6b250YWwoc2VsZi5lbGVtZW50LnNjcm9sbExlZnQpO1xuXG5cblx0XHQvLyBcdH1cblxuXG5cdFx0Ly8gfSk7XG5cblx0fTtcblxuXHQvL2xpbmsgdG8gcm93IG1hbmFnZXJcblxuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLnNldFJvd01hbmFnZXIgPSBmdW5jdGlvbiAobWFuYWdlcikge1xuXG5cdFx0dGhpcy5yb3dNYW5hZ2VyID0gbWFuYWdlcjtcblx0fTtcblxuXHQvL3JldHVybiBjb250YWluaW5nIGVsZW1lbnRcblxuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLmdldEVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5lbGVtZW50O1xuXHR9O1xuXG5cdC8vcmV0dXJuIGhlYWRlciBjb250YWluaW5nIGVsZW1lbnRcblxuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLmdldEhlYWRlcnNFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuaGVhZGVyc0VsZW1lbnQ7XG5cdH07XG5cblx0Ly8gQ29sdW1uTWFuYWdlci5wcm90b3R5cGUudGVtcFNjcm9sbEJsb2NrID0gZnVuY3Rpb24oKXtcblxuXG5cdC8vIFx0Y2xlYXJUaW1lb3V0KHRoaXMuYmxvY2tIb3pTY3JvbGxFdmVudCk7XG5cblxuXHQvLyBcdHRoaXMuYmxvY2tIb3pTY3JvbGxFdmVudCA9IHNldFRpbWVvdXQoKCkgPT4ge3RoaXMuYmxvY2tIb3pTY3JvbGxFdmVudCA9IGZhbHNlO30sIDUwKTtcblxuXG5cdC8vIH1cblxuXG5cdC8vc2Nyb2xsIGhvcml6b250YWxseSB0byBtYXRjaCB0YWJsZSBib2R5XG5cblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5zY3JvbGxIb3Jpem9udGFsID0gZnVuY3Rpb24gKGxlZnQpIHtcblxuXHRcdHZhciBob3pBZGp1c3QgPSAwLFxuXHRcdCAgICBzY3JvbGxXaWR0aCA9IHRoaXMuZWxlbWVudC5zY3JvbGxXaWR0aCAtIHRoaXMudGFibGUuZWxlbWVudC5jbGllbnRXaWR0aDtcblxuXHRcdC8vIHRoaXMudGVtcFNjcm9sbEJsb2NrKCk7XG5cblxuXHRcdHRoaXMuZWxlbWVudC5zY3JvbGxMZWZ0ID0gbGVmdDtcblxuXHRcdC8vYWRqdXN0IGZvciB2ZXJ0aWNhbCBzY3JvbGxiYXIgbW92aW5nIHRhYmxlIHdoZW4gcHJlc2VudFxuXG5cblx0XHRpZiAobGVmdCA+IHNjcm9sbFdpZHRoKSB7XG5cblx0XHRcdGhvekFkanVzdCA9IGxlZnQgLSBzY3JvbGxXaWR0aDtcblxuXHRcdFx0dGhpcy5lbGVtZW50LnN0eWxlLm1hcmdpbkxlZnQgPSAtaG96QWRqdXN0ICsgXCJweFwiO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHRoaXMuZWxlbWVudC5zdHlsZS5tYXJnaW5MZWZ0ID0gMDtcblx0XHR9XG5cblx0XHQvL2tlZXAgZnJvemVuIGNvbHVtbnMgZml4ZWQgaW4gcG9zaXRpb25cblxuXG5cdFx0Ly90aGlzLl9jYWxjRnJvemVuQ29sdW1uc1Bvcyhob3pBZGp1c3QgKyAzKTtcblxuXG5cdFx0dGhpcy5zY3JvbGxMZWZ0ID0gbGVmdDtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImZyb3plbkNvbHVtbnNcIikpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmZyb3plbkNvbHVtbnMuc2Nyb2xsSG9yaXpvbnRhbCgpO1xuXHRcdH1cblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vIENvbHVtbiBTZXR1cCBGdW5jdGlvbnMgLy8vLy8vLy8vLy8vL1xuXG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUuZ2VuZXJhdGVDb2x1bW5zRnJvbVJvd0RhdGEgPSBmdW5jdGlvbiAoZGF0YSkge1xuXG5cdFx0dmFyIGNvbHMgPSBbXSxcblx0XHQgICAgcm93LFxuXHRcdCAgICBzb3J0ZXI7XG5cblx0XHRpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCkge1xuXG5cdFx0XHRyb3cgPSBkYXRhWzBdO1xuXG5cdFx0XHRmb3IgKHZhciBrZXkgaW4gcm93KSB7XG5cblx0XHRcdFx0dmFyIGNvbCA9IHtcblxuXHRcdFx0XHRcdGZpZWxkOiBrZXksXG5cblx0XHRcdFx0XHR0aXRsZToga2V5XG5cblx0XHRcdFx0fTtcblxuXHRcdFx0XHR2YXIgdmFsdWUgPSByb3dba2V5XTtcblxuXHRcdFx0XHRzd2l0Y2ggKHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YodmFsdWUpKSB7XG5cblx0XHRcdFx0XHRjYXNlIFwidW5kZWZpbmVkXCI6XG5cblx0XHRcdFx0XHRcdHNvcnRlciA9IFwic3RyaW5nXCI7XG5cblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSBcImJvb2xlYW5cIjpcblxuXHRcdFx0XHRcdFx0c29ydGVyID0gXCJib29sZWFuXCI7XG5cblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSBcIm9iamVjdFwiOlxuXG5cdFx0XHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcblxuXHRcdFx0XHRcdFx0XHRzb3J0ZXIgPSBcImFycmF5XCI7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRcdHNvcnRlciA9IFwic3RyaW5nXCI7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0ZGVmYXVsdDpcblxuXHRcdFx0XHRcdFx0aWYgKCFpc05hTih2YWx1ZSkgJiYgdmFsdWUgIT09IFwiXCIpIHtcblxuXHRcdFx0XHRcdFx0XHRzb3J0ZXIgPSBcIm51bWJlclwiO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0XHRpZiAodmFsdWUubWF0Y2goLygoXlswLTldK1thLXpdKyl8KF5bYS16XStbMC05XSspKSskL2kpKSB7XG5cblx0XHRcdFx0XHRcdFx0XHRzb3J0ZXIgPSBcImFscGhhbnVtXCI7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdFx0XHRzb3J0ZXIgPSBcInN0cmluZ1wiO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjb2wuc29ydGVyID0gc29ydGVyO1xuXG5cdFx0XHRcdGNvbHMucHVzaChjb2wpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1ucyA9IGNvbHM7XG5cblx0XHRcdHRoaXMuc2V0Q29sdW1ucyh0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1ucyk7XG5cdFx0fVxuXHR9O1xuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLnNldENvbHVtbnMgPSBmdW5jdGlvbiAoY29scywgcm93KSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHR3aGlsZSAoc2VsZi5oZWFkZXJzRWxlbWVudC5maXJzdENoaWxkKSB7XG5cdFx0XHRzZWxmLmhlYWRlcnNFbGVtZW50LnJlbW92ZUNoaWxkKHNlbGYuaGVhZGVyc0VsZW1lbnQuZmlyc3RDaGlsZCk7XG5cdFx0fXNlbGYuY29sdW1ucyA9IFtdO1xuXG5cdFx0c2VsZi5jb2x1bW5zQnlJbmRleCA9IFtdO1xuXG5cdFx0c2VsZi5jb2x1bW5zQnlGaWVsZCA9IHt9O1xuXG5cdFx0Ly9yZXNldCBmcm96ZW4gY29sdW1uc1xuXG5cblx0XHRpZiAoc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJmcm96ZW5Db2x1bW5zXCIpKSB7XG5cblx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5mcm96ZW5Db2x1bW5zLnJlc2V0KCk7XG5cdFx0fVxuXG5cdFx0Y29scy5mb3JFYWNoKGZ1bmN0aW9uIChkZWYsIGkpIHtcblxuXHRcdFx0c2VsZi5fYWRkQ29sdW1uKGRlZik7XG5cdFx0fSk7XG5cblx0XHRzZWxmLl9yZUluZGV4Q29sdW1ucygpO1xuXG5cdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5yZXNwb25zaXZlTGF5b3V0ICYmIHNlbGYudGFibGUubW9kRXhpc3RzKFwicmVzcG9uc2l2ZUxheW91dFwiLCB0cnVlKSkge1xuXG5cdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMucmVzcG9uc2l2ZUxheW91dC5pbml0aWFsaXplKCk7XG5cdFx0fVxuXG5cdFx0c2VsZi5yZWRyYXcodHJ1ZSk7XG5cdH07XG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUuX2FkZENvbHVtbiA9IGZ1bmN0aW9uIChkZWZpbml0aW9uLCBiZWZvcmUsIG5leHRUb0NvbHVtbikge1xuXG5cdFx0dmFyIGNvbHVtbiA9IG5ldyBDb2x1bW4oZGVmaW5pdGlvbiwgdGhpcyksXG5cdFx0ICAgIGNvbEVsID0gY29sdW1uLmdldEVsZW1lbnQoKSxcblx0XHQgICAgaW5kZXggPSBuZXh0VG9Db2x1bW4gPyB0aGlzLmZpbmRDb2x1bW5JbmRleChuZXh0VG9Db2x1bW4pIDogbmV4dFRvQ29sdW1uO1xuXG5cdFx0aWYgKG5leHRUb0NvbHVtbiAmJiBpbmRleCA+IC0xKSB7XG5cblx0XHRcdHZhciBwYXJlbnRJbmRleCA9IHRoaXMuY29sdW1ucy5pbmRleE9mKG5leHRUb0NvbHVtbi5nZXRUb3BDb2x1bW4oKSk7XG5cblx0XHRcdHZhciBuZXh0RWwgPSBuZXh0VG9Db2x1bW4uZ2V0RWxlbWVudCgpO1xuXG5cdFx0XHRpZiAoYmVmb3JlKSB7XG5cblx0XHRcdFx0dGhpcy5jb2x1bW5zLnNwbGljZShwYXJlbnRJbmRleCwgMCwgY29sdW1uKTtcblxuXHRcdFx0XHRuZXh0RWwucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoY29sRWwsIG5leHRFbCk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdHRoaXMuY29sdW1ucy5zcGxpY2UocGFyZW50SW5kZXggKyAxLCAwLCBjb2x1bW4pO1xuXG5cdFx0XHRcdG5leHRFbC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShjb2xFbCwgbmV4dEVsLm5leHRTaWJsaW5nKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoYmVmb3JlKSB7XG5cblx0XHRcdFx0dGhpcy5jb2x1bW5zLnVuc2hpZnQoY29sdW1uKTtcblxuXHRcdFx0XHR0aGlzLmhlYWRlcnNFbGVtZW50Lmluc2VydEJlZm9yZShjb2x1bW4uZ2V0RWxlbWVudCgpLCB0aGlzLmhlYWRlcnNFbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHR0aGlzLmNvbHVtbnMucHVzaChjb2x1bW4pO1xuXG5cdFx0XHRcdHRoaXMuaGVhZGVyc0VsZW1lbnQuYXBwZW5kQ2hpbGQoY29sdW1uLmdldEVsZW1lbnQoKSk7XG5cdFx0XHR9XG5cblx0XHRcdGNvbHVtbi5jb2x1bW5SZW5kZXJlZCgpO1xuXHRcdH1cblxuXHRcdHJldHVybiBjb2x1bW47XG5cdH07XG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUucmVnaXN0ZXJDb2x1bW5GaWVsZCA9IGZ1bmN0aW9uIChjb2wpIHtcblxuXHRcdGlmIChjb2wuZGVmaW5pdGlvbi5maWVsZCkge1xuXG5cdFx0XHR0aGlzLmNvbHVtbnNCeUZpZWxkW2NvbC5kZWZpbml0aW9uLmZpZWxkXSA9IGNvbDtcblx0XHR9XG5cdH07XG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUucmVnaXN0ZXJDb2x1bW5Qb3NpdGlvbiA9IGZ1bmN0aW9uIChjb2wpIHtcblxuXHRcdHRoaXMuY29sdW1uc0J5SW5kZXgucHVzaChjb2wpO1xuXHR9O1xuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLl9yZUluZGV4Q29sdW1ucyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuY29sdW1uc0J5SW5kZXggPSBbXTtcblxuXHRcdHRoaXMuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0Y29sdW1uLnJlUmVnaXN0ZXJQb3NpdGlvbigpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdC8vZW5zdXJlIGNvbHVtbiBoZWFkZXJzIHRha2UgdXAgdGhlIGNvcnJlY3QgYW1vdW50IG9mIHNwYWNlIGluIGNvbHVtbiBncm91cHNcblxuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLl92ZXJ0aWNhbEFsaWduSGVhZGVycyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgbWluSGVpZ2h0ID0gMDtcblxuXHRcdHNlbGYuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0dmFyIGhlaWdodDtcblxuXHRcdFx0Y29sdW1uLmNsZWFyVmVydGljYWxBbGlnbigpO1xuXG5cdFx0XHRoZWlnaHQgPSBjb2x1bW4uZ2V0SGVpZ2h0KCk7XG5cblx0XHRcdGlmIChoZWlnaHQgPiBtaW5IZWlnaHQpIHtcblxuXHRcdFx0XHRtaW5IZWlnaHQgPSBoZWlnaHQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRzZWxmLmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdGNvbHVtbi52ZXJ0aWNhbEFsaWduKHNlbGYudGFibGUub3B0aW9ucy5jb2x1bW5IZWFkZXJWZXJ0QWxpZ24sIG1pbkhlaWdodCk7XG5cdFx0fSk7XG5cblx0XHRzZWxmLnJvd01hbmFnZXIuYWRqdXN0VGFibGVTaXplKCk7XG5cdH07XG5cblx0Ly8vLy8vLy8vLy8vLy8vLyBDb2x1bW4gRGV0YWlscyAvLy8vLy8vLy8vLy8vLy8vL1xuXG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUuZmluZENvbHVtbiA9IGZ1bmN0aW9uIChzdWJqZWN0KSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRpZiAoKHR5cGVvZiBzdWJqZWN0ID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihzdWJqZWN0KSkgPT0gXCJvYmplY3RcIikge1xuXG5cdFx0XHRpZiAoc3ViamVjdCBpbnN0YW5jZW9mIENvbHVtbikge1xuXG5cdFx0XHRcdC8vc3ViamVjdCBpcyBjb2x1bW4gZWxlbWVudFxuXG5cblx0XHRcdFx0cmV0dXJuIHN1YmplY3Q7XG5cdFx0XHR9IGVsc2UgaWYgKHN1YmplY3QgaW5zdGFuY2VvZiBDb2x1bW5Db21wb25lbnQpIHtcblxuXHRcdFx0XHQvL3N1YmplY3QgaXMgcHVibGljIGNvbHVtbiBjb21wb25lbnRcblxuXG5cdFx0XHRcdHJldHVybiBzdWJqZWN0Ll9nZXRTZWxmKCkgfHwgZmFsc2U7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZiBIVE1MRWxlbWVudCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBzdWJqZWN0IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHtcblxuXHRcdFx0XHQvL3N1YmplY3QgaXMgYSBIVE1MIGVsZW1lbnQgb2YgdGhlIGNvbHVtbiBoZWFkZXJcblxuXG5cdFx0XHRcdHZhciBtYXRjaCA9IHNlbGYuY29sdW1ucy5maW5kKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0XHRcdHJldHVybiBjb2x1bW4uZWxlbWVudCA9PT0gc3ViamVjdDtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0cmV0dXJuIG1hdGNoIHx8IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdC8vc3ViamVjdCBzaG91bGQgYmUgdHJlYXRlZCBhcyB0aGUgZmllbGQgbmFtZSBvZiB0aGUgY29sdW1uXG5cblxuXHRcdFx0cmV0dXJuIHRoaXMuY29sdW1uc0J5RmllbGRbc3ViamVjdF0gfHwgZmFsc2U7XG5cdFx0fVxuXG5cdFx0Ly9jYXRjaCBhbGwgZm9yIGFueSBvdGhlciB0eXBlIG9mIGlucHV0XG5cblxuXHRcdHJldHVybiBmYWxzZTtcblx0fTtcblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5nZXRDb2x1bW5CeUZpZWxkID0gZnVuY3Rpb24gKGZpZWxkKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5jb2x1bW5zQnlGaWVsZFtmaWVsZF07XG5cdH07XG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUuZ2V0Q29sdW1uc0J5RmllbGRSb290ID0gZnVuY3Rpb24gKHJvb3QpIHtcblx0XHR2YXIgX3RoaXMgPSB0aGlzO1xuXG5cdFx0dmFyIG1hdGNoZXMgPSBbXTtcblxuXHRcdE9iamVjdC5rZXlzKHRoaXMuY29sdW1uc0J5RmllbGQpLmZvckVhY2goZnVuY3Rpb24gKGZpZWxkKSB7XG5cblx0XHRcdHZhciBmaWVsZFJvb3QgPSBmaWVsZC5zcGxpdChcIi5cIilbMF07XG5cblx0XHRcdGlmIChmaWVsZFJvb3QgPT09IHJvb3QpIHtcblxuXHRcdFx0XHRtYXRjaGVzLnB1c2goX3RoaXMuY29sdW1uc0J5RmllbGRbZmllbGRdKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiBtYXRjaGVzO1xuXHR9O1xuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLmdldENvbHVtbkJ5SW5kZXggPSBmdW5jdGlvbiAoaW5kZXgpIHtcblxuXHRcdHJldHVybiB0aGlzLmNvbHVtbnNCeUluZGV4W2luZGV4XTtcblx0fTtcblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5nZXRGaXJzdFZpc2liaWxlQ29sdW1uID0gZnVuY3Rpb24gKGluZGV4KSB7XG5cblx0XHR2YXIgaW5kZXggPSB0aGlzLmNvbHVtbnNCeUluZGV4LmZpbmRJbmRleChmdW5jdGlvbiAoY29sKSB7XG5cblx0XHRcdHJldHVybiBjb2wudmlzaWJsZTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBpbmRleCA+IC0xID8gdGhpcy5jb2x1bW5zQnlJbmRleFtpbmRleF0gOiBmYWxzZTtcblx0fTtcblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5nZXRDb2x1bW5zID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuY29sdW1ucztcblx0fTtcblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5maW5kQ29sdW1uSW5kZXggPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5jb2x1bW5zQnlJbmRleC5maW5kSW5kZXgoZnVuY3Rpb24gKGNvbCkge1xuXG5cdFx0XHRyZXR1cm4gY29sdW1uID09PSBjb2w7XG5cdFx0fSk7XG5cdH07XG5cblx0Ly9yZXR1cm4gYWxsIGNvbHVtbnMgdGhhdCBhcmUgbm90IGdyb3Vwc1xuXG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUuZ2V0UmVhbENvbHVtbnMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5jb2x1bW5zQnlJbmRleDtcblx0fTtcblxuXHQvL3RyYXZlcnMgYWNyb3NzIGNvbHVtbnMgYW5kIGNhbGwgYWN0aW9uXG5cblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS50cmF2ZXJzZSA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0c2VsZi5jb2x1bW5zQnlJbmRleC5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4sIGkpIHtcblxuXHRcdFx0Y2FsbGJhY2soY29sdW1uLCBpKTtcblx0XHR9KTtcblx0fTtcblxuXHQvL2dldCBkZWZpbnRpb25zIG9mIGFjdHVhbCBjb2x1bW5zXG5cblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5nZXREZWZpbml0aW9ucyA9IGZ1bmN0aW9uIChhY3RpdmUpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgb3V0cHV0ID0gW107XG5cblx0XHRzZWxmLmNvbHVtbnNCeUluZGV4LmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXG5cdFx0XHRpZiAoIWFjdGl2ZSB8fCBhY3RpdmUgJiYgY29sdW1uLnZpc2libGUpIHtcblxuXHRcdFx0XHRvdXRwdXQucHVzaChjb2x1bW4uZ2V0RGVmaW5pdGlvbigpKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0Ly9nZXQgZnVsbCBuZXN0ZWQgZGVmaW5pdGlvbiB0cmVlXG5cblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5nZXREZWZpbml0aW9uVHJlZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgb3V0cHV0ID0gW107XG5cblx0XHRzZWxmLmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdG91dHB1dC5wdXNoKGNvbHVtbi5nZXREZWZpbml0aW9uKHRydWUpKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUuZ2V0Q29tcG9uZW50cyA9IGZ1bmN0aW9uIChzdHJ1Y3R1cmVkKSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIG91dHB1dCA9IFtdLFxuXHRcdCAgICBjb2x1bW5zID0gc3RydWN0dXJlZCA/IHNlbGYuY29sdW1ucyA6IHNlbGYuY29sdW1uc0J5SW5kZXg7XG5cblx0XHRjb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXG5cdFx0XHRvdXRwdXQucHVzaChjb2x1bW4uZ2V0Q29tcG9uZW50KCkpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fTtcblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciB3aWR0aCA9IDA7XG5cblx0XHR0aGlzLmNvbHVtbnNCeUluZGV4LmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXG5cdFx0XHRpZiAoY29sdW1uLnZpc2libGUpIHtcblxuXHRcdFx0XHR3aWR0aCArPSBjb2x1bW4uZ2V0V2lkdGgoKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiB3aWR0aDtcblx0fTtcblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5tb3ZlQ29sdW1uID0gZnVuY3Rpb24gKGZyb20sIHRvLCBhZnRlcikge1xuXG5cdFx0dGhpcy5tb3ZlQ29sdW1uQWN0dWFsKGZyb20sIHRvLCBhZnRlcik7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXQgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJyZXNwb25zaXZlTGF5b3V0XCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5yZXNwb25zaXZlTGF5b3V0LmluaXRpYWxpemUoKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiKSkge1xuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MucmVjYWxjKHRoaXMudGFibGUucm93TWFuYWdlci5hY3RpdmVSb3dzKTtcblx0XHR9XG5cblx0XHR0by5lbGVtZW50LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGZyb20uZWxlbWVudCwgdG8uZWxlbWVudCk7XG5cblx0XHRpZiAoYWZ0ZXIpIHtcblxuXHRcdFx0dG8uZWxlbWVudC5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0by5lbGVtZW50LCBmcm9tLmVsZW1lbnQpO1xuXHRcdH1cblxuXHRcdHRoaXMuX3ZlcnRpY2FsQWxpZ25IZWFkZXJzKCk7XG5cblx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucmVpbml0aWFsaXplKCk7XG5cdH07XG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUubW92ZUNvbHVtbkFjdHVhbCA9IGZ1bmN0aW9uIChmcm9tLCB0bywgYWZ0ZXIpIHtcblxuXHRcdGlmIChmcm9tLnBhcmVudC5pc0dyb3VwKSB7XG5cblx0XHRcdHRoaXMuX21vdmVDb2x1bW5JbkFycmF5KGZyb20ucGFyZW50LmNvbHVtbnMsIGZyb20sIHRvLCBhZnRlcik7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dGhpcy5fbW92ZUNvbHVtbkluQXJyYXkodGhpcy5jb2x1bW5zLCBmcm9tLCB0bywgYWZ0ZXIpO1xuXHRcdH1cblxuXHRcdHRoaXMuX21vdmVDb2x1bW5JbkFycmF5KHRoaXMuY29sdW1uc0J5SW5kZXgsIGZyb20sIHRvLCBhZnRlciwgdHJ1ZSk7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXQgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJyZXNwb25zaXZlTGF5b3V0XCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5yZXNwb25zaXZlTGF5b3V0LmluaXRpYWxpemUoKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmNvbHVtbk1vdmVkKSB7XG5cblx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5jb2x1bW5Nb3ZlZC5jYWxsKHRoaXMudGFibGUsIGZyb20uZ2V0Q29tcG9uZW50KCksIHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRDb21wb25lbnRzKCkpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJwZXJzaXN0ZW5jZVwiLCB0cnVlKSAmJiB0aGlzLnRhYmxlLm1vZHVsZXMucGVyc2lzdGVuY2UuY29uZmlnLmNvbHVtbnMpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLnNhdmUoXCJjb2x1bW5zXCIpO1xuXHRcdH1cblx0fTtcblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5fbW92ZUNvbHVtbkluQXJyYXkgPSBmdW5jdGlvbiAoY29sdW1ucywgZnJvbSwgdG8sIGFmdGVyLCB1cGRhdGVSb3dzKSB7XG5cblx0XHR2YXIgZnJvbUluZGV4ID0gY29sdW1ucy5pbmRleE9mKGZyb20pLFxuXHRcdCAgICB0b0luZGV4O1xuXG5cdFx0aWYgKGZyb21JbmRleCA+IC0xKSB7XG5cblx0XHRcdGNvbHVtbnMuc3BsaWNlKGZyb21JbmRleCwgMSk7XG5cblx0XHRcdHRvSW5kZXggPSBjb2x1bW5zLmluZGV4T2YodG8pO1xuXG5cdFx0XHRpZiAodG9JbmRleCA+IC0xKSB7XG5cblx0XHRcdFx0aWYgKGFmdGVyKSB7XG5cblx0XHRcdFx0XHR0b0luZGV4ID0gdG9JbmRleCArIDE7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0dG9JbmRleCA9IGZyb21JbmRleDtcblx0XHRcdH1cblxuXHRcdFx0Y29sdW1ucy5zcGxpY2UodG9JbmRleCwgMCwgZnJvbSk7XG5cblx0XHRcdGlmICh1cGRhdGVSb3dzKSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLnJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cblx0XHRcdFx0XHRpZiAocm93LmNlbGxzLmxlbmd0aCkge1xuXG5cdFx0XHRcdFx0XHR2YXIgY2VsbCA9IHJvdy5jZWxscy5zcGxpY2UoZnJvbUluZGV4LCAxKVswXTtcblxuXHRcdFx0XHRcdFx0cm93LmNlbGxzLnNwbGljZSh0b0luZGV4LCAwLCBjZWxsKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5zY3JvbGxUb0NvbHVtbiA9IGZ1bmN0aW9uIChjb2x1bW4sIHBvc2l0aW9uLCBpZlZpc2libGUpIHtcblx0XHR2YXIgX3RoaXMyID0gdGhpcztcblxuXHRcdHZhciBsZWZ0ID0gMCxcblx0XHQgICAgb2Zmc2V0ID0gMCxcblx0XHQgICAgYWRqdXN0ID0gMCxcblx0XHQgICAgY29sRWwgPSBjb2x1bW4uZ2V0RWxlbWVudCgpO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdFx0aWYgKHR5cGVvZiBwb3NpdGlvbiA9PT0gXCJ1bmRlZmluZWRcIikge1xuXG5cdFx0XHRcdHBvc2l0aW9uID0gX3RoaXMyLnRhYmxlLm9wdGlvbnMuc2Nyb2xsVG9Db2x1bW5Qb3NpdGlvbjtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZiBpZlZpc2libGUgPT09IFwidW5kZWZpbmVkXCIpIHtcblxuXHRcdFx0XHRpZlZpc2libGUgPSBfdGhpczIudGFibGUub3B0aW9ucy5zY3JvbGxUb0NvbHVtbklmVmlzaWJsZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGNvbHVtbi52aXNpYmxlKSB7XG5cblx0XHRcdFx0Ly9hbGlnbiB0byBjb3JyZWN0IHBvc2l0aW9uXG5cblxuXHRcdFx0XHRzd2l0Y2ggKHBvc2l0aW9uKSB7XG5cblx0XHRcdFx0XHRjYXNlIFwibWlkZGxlXCI6XG5cblx0XHRcdFx0XHRjYXNlIFwiY2VudGVyXCI6XG5cblx0XHRcdFx0XHRcdGFkanVzdCA9IC1fdGhpczIuZWxlbWVudC5jbGllbnRXaWR0aCAvIDI7XG5cblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSBcInJpZ2h0XCI6XG5cblx0XHRcdFx0XHRcdGFkanVzdCA9IGNvbEVsLmNsaWVudFdpZHRoIC0gX3RoaXMyLmhlYWRlcnNFbGVtZW50LmNsaWVudFdpZHRoO1xuXG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly9jaGVjayBjb2x1bW4gdmlzaWJpbGl0eVxuXG5cblx0XHRcdFx0aWYgKCFpZlZpc2libGUpIHtcblxuXHRcdFx0XHRcdG9mZnNldCA9IGNvbEVsLm9mZnNldExlZnQ7XG5cblx0XHRcdFx0XHRpZiAob2Zmc2V0ID4gMCAmJiBvZmZzZXQgKyBjb2xFbC5vZmZzZXRXaWR0aCA8IF90aGlzMi5lbGVtZW50LmNsaWVudFdpZHRoKSB7XG5cblx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvL2NhbGN1bGF0ZSBzY3JvbGwgcG9zaXRpb25cblxuXG5cdFx0XHRcdGxlZnQgPSBjb2xFbC5vZmZzZXRMZWZ0ICsgX3RoaXMyLmVsZW1lbnQuc2Nyb2xsTGVmdCArIGFkanVzdDtcblxuXHRcdFx0XHRsZWZ0ID0gTWF0aC5tYXgoTWF0aC5taW4obGVmdCwgX3RoaXMyLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxXaWR0aCAtIF90aGlzMi50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQuY2xpZW50V2lkdGgpLCAwKTtcblxuXHRcdFx0XHRfdGhpczIudGFibGUucm93TWFuYWdlci5zY3JvbGxIb3Jpem9udGFsKGxlZnQpO1xuXG5cdFx0XHRcdF90aGlzMi5zY3JvbGxIb3Jpem9udGFsKGxlZnQpO1xuXG5cdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0Y29uc29sZS53YXJuKFwiU2Nyb2xsIEVycm9yIC0gQ29sdW1uIG5vdCB2aXNpYmxlXCIpO1xuXG5cdFx0XHRcdHJlamVjdChcIlNjcm9sbCBFcnJvciAtIENvbHVtbiBub3QgdmlzaWJsZVwiKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8vIENlbGwgTWFuYWdlbWVudCAvLy8vLy8vLy8vLy8vLy8vL1xuXG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUuZ2VuZXJhdGVDZWxscyA9IGZ1bmN0aW9uIChyb3cpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHZhciBjZWxscyA9IFtdO1xuXG5cdFx0c2VsZi5jb2x1bW5zQnlJbmRleC5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0Y2VsbHMucHVzaChjb2x1bW4uZ2VuZXJhdGVDZWxsKHJvdykpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGNlbGxzO1xuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8gQ29sdW1uIE1hbmFnZW1lbnQgLy8vLy8vLy8vLy8vLy8vLy9cblxuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLmdldEZsZXhCYXNlV2lkdGggPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHRvdGFsV2lkdGggPSBzZWxmLnRhYmxlLmVsZW1lbnQuY2xpZW50V2lkdGgsXG5cdFx0ICAgIC8vdGFibGUgZWxlbWVudCB3aWR0aFxuXG5cblx0XHRmaXhlZFdpZHRoID0gMDtcblxuXHRcdC8vYWRqdXN0IGZvciB2ZXJ0aWNhbCBzY3JvbGxiYXIgaWYgcHJlc2VudFxuXG5cblx0XHRpZiAoc2VsZi5yb3dNYW5hZ2VyLmVsZW1lbnQuc2Nyb2xsSGVpZ2h0ID4gc2VsZi5yb3dNYW5hZ2VyLmVsZW1lbnQuY2xpZW50SGVpZ2h0KSB7XG5cblx0XHRcdHRvdGFsV2lkdGggLT0gc2VsZi5yb3dNYW5hZ2VyLmVsZW1lbnQub2Zmc2V0V2lkdGggLSBzZWxmLnJvd01hbmFnZXIuZWxlbWVudC5jbGllbnRXaWR0aDtcblx0XHR9XG5cblx0XHR0aGlzLmNvbHVtbnNCeUluZGV4LmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXG5cdFx0XHR2YXIgd2lkdGgsIG1pbldpZHRoLCBjb2xXaWR0aDtcblxuXHRcdFx0aWYgKGNvbHVtbi52aXNpYmxlKSB7XG5cblx0XHRcdFx0d2lkdGggPSBjb2x1bW4uZGVmaW5pdGlvbi53aWR0aCB8fCAwO1xuXG5cdFx0XHRcdG1pbldpZHRoID0gdHlwZW9mIGNvbHVtbi5taW5XaWR0aCA9PSBcInVuZGVmaW5lZFwiID8gc2VsZi50YWJsZS5vcHRpb25zLmNvbHVtbk1pbldpZHRoIDogcGFyc2VJbnQoY29sdW1uLm1pbldpZHRoKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mIHdpZHRoID09IFwic3RyaW5nXCIpIHtcblxuXHRcdFx0XHRcdGlmICh3aWR0aC5pbmRleE9mKFwiJVwiKSA+IC0xKSB7XG5cblx0XHRcdFx0XHRcdGNvbFdpZHRoID0gdG90YWxXaWR0aCAvIDEwMCAqIHBhcnNlSW50KHdpZHRoKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRjb2xXaWR0aCA9IHBhcnNlSW50KHdpZHRoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRjb2xXaWR0aCA9IHdpZHRoO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Zml4ZWRXaWR0aCArPSBjb2xXaWR0aCA+IG1pbldpZHRoID8gY29sV2lkdGggOiBtaW5XaWR0aDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiBmaXhlZFdpZHRoO1xuXHR9O1xuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLmFkZENvbHVtbiA9IGZ1bmN0aW9uIChkZWZpbml0aW9uLCBiZWZvcmUsIG5leHRUb0NvbHVtbikge1xuXHRcdHZhciBfdGhpczMgPSB0aGlzO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdFx0dmFyIGNvbHVtbiA9IF90aGlzMy5fYWRkQ29sdW1uKGRlZmluaXRpb24sIGJlZm9yZSwgbmV4dFRvQ29sdW1uKTtcblxuXHRcdFx0X3RoaXMzLl9yZUluZGV4Q29sdW1ucygpO1xuXG5cdFx0XHRpZiAoX3RoaXMzLnRhYmxlLm9wdGlvbnMucmVzcG9uc2l2ZUxheW91dCAmJiBfdGhpczMudGFibGUubW9kRXhpc3RzKFwicmVzcG9uc2l2ZUxheW91dFwiLCB0cnVlKSkge1xuXG5cdFx0XHRcdF90aGlzMy50YWJsZS5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQuaW5pdGlhbGl6ZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX3RoaXMzLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpKSB7XG5cblx0XHRcdFx0X3RoaXMzLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MucmVjYWxjKF90aGlzMy50YWJsZS5yb3dNYW5hZ2VyLmFjdGl2ZVJvd3MpO1xuXHRcdFx0fVxuXG5cdFx0XHRfdGhpczMucmVkcmF3KCk7XG5cblx0XHRcdGlmIChfdGhpczMudGFibGUubW9kdWxlcy5sYXlvdXQuZ2V0TW9kZSgpICE9IFwiZml0Q29sdW1uc1wiKSB7XG5cblx0XHRcdFx0Y29sdW1uLnJlaW5pdGlhbGl6ZVdpZHRoKCk7XG5cdFx0XHR9XG5cblx0XHRcdF90aGlzMy5fdmVydGljYWxBbGlnbkhlYWRlcnMoKTtcblxuXHRcdFx0X3RoaXMzLnRhYmxlLnJvd01hbmFnZXIucmVpbml0aWFsaXplKCk7XG5cblx0XHRcdHJlc29sdmUoY29sdW1uKTtcblx0XHR9KTtcblx0fTtcblxuXHQvL3JlbW92ZSBjb2x1bW4gZnJvbSBzeXN0ZW1cblxuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLmRlcmVnaXN0ZXJDb2x1bW4gPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHR2YXIgZmllbGQgPSBjb2x1bW4uZ2V0RmllbGQoKSxcblx0XHQgICAgaW5kZXg7XG5cblx0XHQvL3JlbW92ZSBmcm9tIGZpZWxkIGxpc3RcblxuXG5cdFx0aWYgKGZpZWxkKSB7XG5cblx0XHRcdGRlbGV0ZSB0aGlzLmNvbHVtbnNCeUZpZWxkW2ZpZWxkXTtcblx0XHR9XG5cblx0XHQvL3JlbW92ZSBmcm9tIGluZGV4IGxpc3RcblxuXG5cdFx0aW5kZXggPSB0aGlzLmNvbHVtbnNCeUluZGV4LmluZGV4T2YoY29sdW1uKTtcblxuXHRcdGlmIChpbmRleCA+IC0xKSB7XG5cblx0XHRcdHRoaXMuY29sdW1uc0J5SW5kZXguc3BsaWNlKGluZGV4LCAxKTtcblx0XHR9XG5cblx0XHQvL3JlbW92ZSBmcm9tIGNvbHVtbiBsaXN0XG5cblxuXHRcdGluZGV4ID0gdGhpcy5jb2x1bW5zLmluZGV4T2YoY29sdW1uKTtcblxuXHRcdGlmIChpbmRleCA+IC0xKSB7XG5cblx0XHRcdHRoaXMuY29sdW1ucy5zcGxpY2UoaW5kZXgsIDEpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMucmVzcG9uc2l2ZUxheW91dCAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInJlc3BvbnNpdmVMYXlvdXRcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQuaW5pdGlhbGl6ZSgpO1xuXHRcdH1cblxuXHRcdHRoaXMucmVkcmF3KCk7XG5cdH07XG5cblx0Ly9yZWRyYXcgY29sdW1uc1xuXG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUucmVkcmF3ID0gZnVuY3Rpb24gKGZvcmNlKSB7XG5cblx0XHRpZiAoZm9yY2UpIHtcblxuXHRcdFx0aWYgKFRhYnVsYXRvci5wcm90b3R5cGUuaGVscGVycy5lbFZpc2libGUodGhpcy5lbGVtZW50KSkge1xuXG5cdFx0XHRcdHRoaXMuX3ZlcnRpY2FsQWxpZ25IZWFkZXJzKCk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5yZXNldFNjcm9sbCgpO1xuXG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucmVpbml0aWFsaXplKCk7XG5cdFx0fVxuXG5cdFx0aWYgKFtcImZpdENvbHVtbnNcIiwgXCJmaXREYXRhU3RyZXRjaFwiXS5pbmRleE9mKHRoaXMudGFibGUubW9kdWxlcy5sYXlvdXQuZ2V0TW9kZSgpKSA+IC0xKSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5sYXlvdXQubGF5b3V0KCk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGZvcmNlKSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmxheW91dC5sYXlvdXQoKTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5yZXNwb25zaXZlTGF5b3V0ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwicmVzcG9uc2l2ZUxheW91dFwiLCB0cnVlKSkge1xuXG5cdFx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQudXBkYXRlKCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJmcm96ZW5Db2x1bW5zXCIpKSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5mcm96ZW5Db2x1bW5zLmxheW91dCgpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpKSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5yZWNhbGModGhpcy50YWJsZS5yb3dNYW5hZ2VyLmFjdGl2ZVJvd3MpO1xuXHRcdH1cblxuXHRcdGlmIChmb3JjZSkge1xuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwicGVyc2lzdGVuY2VcIiwgdHJ1ZSkgJiYgdGhpcy50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLmNvbmZpZy5jb2x1bW5zKSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLnNhdmUoXCJjb2x1bW5zXCIpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiKSkge1xuXG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5yZWRyYXcoKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHR0aGlzLnRhYmxlLmZvb3Rlck1hbmFnZXIucmVkcmF3KCk7XG5cdH07XG5cblx0Ly9wdWJsaWMgY29sdW1uIG9iamVjdFxuXG5cdHZhciBDb2x1bW5Db21wb25lbnQgPSBmdW5jdGlvbiBDb2x1bW5Db21wb25lbnQoY29sdW1uKSB7XG5cblx0XHR0aGlzLl9jb2x1bW4gPSBjb2x1bW47XG5cblx0XHR0aGlzLnR5cGUgPSBcIkNvbHVtbkNvbXBvbmVudFwiO1xuXHR9O1xuXG5cdENvbHVtbkNvbXBvbmVudC5wcm90b3R5cGUuZ2V0RWxlbWVudCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9jb2x1bW4uZ2V0RWxlbWVudCgpO1xuXHR9O1xuXG5cdENvbHVtbkNvbXBvbmVudC5wcm90b3R5cGUuZ2V0RGVmaW5pdGlvbiA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9jb2x1bW4uZ2V0RGVmaW5pdGlvbigpO1xuXHR9O1xuXG5cdENvbHVtbkNvbXBvbmVudC5wcm90b3R5cGUuZ2V0RmllbGQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fY29sdW1uLmdldEZpZWxkKCk7XG5cdH07XG5cblx0Q29sdW1uQ29tcG9uZW50LnByb3RvdHlwZS5nZXRDZWxscyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBjZWxscyA9IFtdO1xuXG5cdFx0dGhpcy5fY29sdW1uLmNlbGxzLmZvckVhY2goZnVuY3Rpb24gKGNlbGwpIHtcblxuXHRcdFx0Y2VsbHMucHVzaChjZWxsLmdldENvbXBvbmVudCgpKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBjZWxscztcblx0fTtcblxuXHRDb2x1bW5Db21wb25lbnQucHJvdG90eXBlLmdldFZpc2liaWxpdHkgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRjb25zb2xlLndhcm4oXCJnZXRWaXNpYmlsaXR5IGZ1bmN0aW9uIGlzIGRlcHJlY2F0ZWQsIHlvdSBzaG91bGQgbm93IHVzZSB0aGUgaXNWaXNpYmxlIGZ1bmN0aW9uXCIpO1xuXG5cdFx0cmV0dXJuIHRoaXMuX2NvbHVtbi52aXNpYmxlO1xuXHR9O1xuXG5cdENvbHVtbkNvbXBvbmVudC5wcm90b3R5cGUuaXNWaXNpYmxlID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuX2NvbHVtbi52aXNpYmxlO1xuXHR9O1xuXG5cdENvbHVtbkNvbXBvbmVudC5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLl9jb2x1bW4uaXNHcm91cCkge1xuXG5cdFx0XHR0aGlzLl9jb2x1bW4uY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0XHRjb2x1bW4uc2hvdygpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dGhpcy5fY29sdW1uLnNob3coKTtcblx0XHR9XG5cdH07XG5cblx0Q29sdW1uQ29tcG9uZW50LnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMuX2NvbHVtbi5pc0dyb3VwKSB7XG5cblx0XHRcdHRoaXMuX2NvbHVtbi5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXG5cdFx0XHRcdGNvbHVtbi5oaWRlKCk7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHR0aGlzLl9jb2x1bW4uaGlkZSgpO1xuXHRcdH1cblx0fTtcblxuXHRDb2x1bW5Db21wb25lbnQucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLl9jb2x1bW4udmlzaWJsZSkge1xuXG5cdFx0XHR0aGlzLmhpZGUoKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHR0aGlzLnNob3coKTtcblx0XHR9XG5cdH07XG5cblx0Q29sdW1uQ29tcG9uZW50LnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fY29sdW1uLmRlbGV0ZSgpO1xuXHR9O1xuXG5cdENvbHVtbkNvbXBvbmVudC5wcm90b3R5cGUuZ2V0U3ViQ29sdW1ucyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBvdXRwdXQgPSBbXTtcblxuXHRcdGlmICh0aGlzLl9jb2x1bW4uY29sdW1ucy5sZW5ndGgpIHtcblxuXHRcdFx0dGhpcy5fY29sdW1uLmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdFx0b3V0cHV0LnB1c2goY29sdW1uLmdldENvbXBvbmVudCgpKTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0Q29sdW1uQ29tcG9uZW50LnByb3RvdHlwZS5nZXRQYXJlbnRDb2x1bW4gPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fY29sdW1uLnBhcmVudCBpbnN0YW5jZW9mIENvbHVtbiA/IHRoaXMuX2NvbHVtbi5wYXJlbnQuZ2V0Q29tcG9uZW50KCkgOiBmYWxzZTtcblx0fTtcblxuXHRDb2x1bW5Db21wb25lbnQucHJvdG90eXBlLl9nZXRTZWxmID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuX2NvbHVtbjtcblx0fTtcblxuXHRDb2x1bW5Db21wb25lbnQucHJvdG90eXBlLnNjcm9sbFRvID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuX2NvbHVtbi50YWJsZS5jb2x1bW5NYW5hZ2VyLnNjcm9sbFRvQ29sdW1uKHRoaXMuX2NvbHVtbik7XG5cdH07XG5cblx0Q29sdW1uQ29tcG9uZW50LnByb3RvdHlwZS5nZXRUYWJsZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9jb2x1bW4udGFibGU7XG5cdH07XG5cblx0Q29sdW1uQ29tcG9uZW50LnByb3RvdHlwZS5oZWFkZXJGaWx0ZXJGb2N1cyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLl9jb2x1bW4udGFibGUubW9kRXhpc3RzKFwiZmlsdGVyXCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMuX2NvbHVtbi50YWJsZS5tb2R1bGVzLmZpbHRlci5zZXRIZWFkZXJGaWx0ZXJGb2N1cyh0aGlzLl9jb2x1bW4pO1xuXHRcdH1cblx0fTtcblxuXHRDb2x1bW5Db21wb25lbnQucHJvdG90eXBlLnJlbG9hZEhlYWRlckZpbHRlciA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLl9jb2x1bW4udGFibGUubW9kRXhpc3RzKFwiZmlsdGVyXCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMuX2NvbHVtbi50YWJsZS5tb2R1bGVzLmZpbHRlci5yZWxvYWRIZWFkZXJGaWx0ZXIodGhpcy5fY29sdW1uKTtcblx0XHR9XG5cdH07XG5cblx0Q29sdW1uQ29tcG9uZW50LnByb3RvdHlwZS5nZXRIZWFkZXJGaWx0ZXJWYWx1ZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLl9jb2x1bW4udGFibGUubW9kRXhpc3RzKFwiZmlsdGVyXCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLl9jb2x1bW4udGFibGUubW9kdWxlcy5maWx0ZXIuZ2V0SGVhZGVyRmlsdGVyVmFsdWUodGhpcy5fY29sdW1uKTtcblx0XHR9XG5cdH07XG5cblx0Q29sdW1uQ29tcG9uZW50LnByb3RvdHlwZS5zZXRIZWFkZXJGaWx0ZXJWYWx1ZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuXG5cdFx0aWYgKHRoaXMuX2NvbHVtbi50YWJsZS5tb2RFeGlzdHMoXCJmaWx0ZXJcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0dGhpcy5fY29sdW1uLnRhYmxlLm1vZHVsZXMuZmlsdGVyLnNldEhlYWRlckZpbHRlclZhbHVlKHRoaXMuX2NvbHVtbiwgdmFsdWUpO1xuXHRcdH1cblx0fTtcblxuXHRDb2x1bW5Db21wb25lbnQucHJvdG90eXBlLm1vdmUgPSBmdW5jdGlvbiAodG8sIGFmdGVyKSB7XG5cblx0XHR2YXIgdG9Db2x1bW4gPSB0aGlzLl9jb2x1bW4udGFibGUuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uKHRvKTtcblxuXHRcdGlmICh0b0NvbHVtbikge1xuXG5cdFx0XHR0aGlzLl9jb2x1bW4udGFibGUuY29sdW1uTWFuYWdlci5tb3ZlQ29sdW1uKHRoaXMuX2NvbHVtbiwgdG9Db2x1bW4sIGFmdGVyKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRjb25zb2xlLndhcm4oXCJNb3ZlIEVycm9yIC0gTm8gbWF0Y2hpbmcgY29sdW1uIGZvdW5kOlwiLCB0b0NvbHVtbik7XG5cdFx0fVxuXHR9O1xuXG5cdENvbHVtbkNvbXBvbmVudC5wcm90b3R5cGUuZ2V0TmV4dENvbHVtbiA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBuZXh0Q29sID0gdGhpcy5fY29sdW1uLm5leHRDb2x1bW4oKTtcblxuXHRcdHJldHVybiBuZXh0Q29sID8gbmV4dENvbC5nZXRDb21wb25lbnQoKSA6IGZhbHNlO1xuXHR9O1xuXG5cdENvbHVtbkNvbXBvbmVudC5wcm90b3R5cGUuZ2V0UHJldkNvbHVtbiA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBwcmV2Q29sID0gdGhpcy5fY29sdW1uLnByZXZDb2x1bW4oKTtcblxuXHRcdHJldHVybiBwcmV2Q29sID8gcHJldkNvbC5nZXRDb21wb25lbnQoKSA6IGZhbHNlO1xuXHR9O1xuXG5cdENvbHVtbkNvbXBvbmVudC5wcm90b3R5cGUudXBkYXRlRGVmaW5pdGlvbiA9IGZ1bmN0aW9uICh1cGRhdGVzKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fY29sdW1uLnVwZGF0ZURlZmluaXRpb24odXBkYXRlcyk7XG5cdH07XG5cblx0Q29sdW1uQ29tcG9uZW50LnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9jb2x1bW4uZ2V0V2lkdGgoKTtcblx0fTtcblxuXHRDb2x1bW5Db21wb25lbnQucHJvdG90eXBlLnNldFdpZHRoID0gZnVuY3Rpb24gKHdpZHRoKSB7XG5cblx0XHRpZiAod2lkdGggPT09IHRydWUpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMuX2NvbHVtbi5yZWluaXRpYWxpemVXaWR0aCh0cnVlKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5fY29sdW1uLnNldFdpZHRoKHdpZHRoKTtcblx0XHR9XG5cdH07XG5cblx0Q29sdW1uQ29tcG9uZW50LnByb3RvdHlwZS52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9jb2x1bW4udmFsaWRhdGUoKTtcblx0fTtcblxuXHR2YXIgQ29sdW1uID0gZnVuY3Rpb24gQ29sdW1uKGRlZiwgcGFyZW50KSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHR0aGlzLnRhYmxlID0gcGFyZW50LnRhYmxlO1xuXG5cdFx0dGhpcy5kZWZpbml0aW9uID0gZGVmOyAvL2NvbHVtbiBkZWZpbml0aW9uXG5cblx0XHR0aGlzLnBhcmVudCA9IHBhcmVudDsgLy9ob2xkIHBhcmVudCBvYmplY3RcblxuXHRcdHRoaXMudHlwZSA9IFwiY29sdW1uXCI7IC8vdHlwZSBvZiBlbGVtZW50XG5cblx0XHR0aGlzLmNvbHVtbnMgPSBbXTsgLy9jaGlsZCBjb2x1bW5zXG5cblx0XHR0aGlzLmNlbGxzID0gW107IC8vY2VsbHMgYm91bmQgdG8gdGhpcyBjb2x1bW5cblxuXHRcdHRoaXMuZWxlbWVudCA9IHRoaXMuY3JlYXRlRWxlbWVudCgpOyAvL2NvbHVtbiBoZWFkZXIgZWxlbWVudFxuXG5cdFx0dGhpcy5jb250ZW50RWxlbWVudCA9IGZhbHNlO1xuXG5cdFx0dGhpcy50aXRsZUVsZW1lbnQgPSBmYWxzZTtcblxuXHRcdHRoaXMuZ3JvdXBFbGVtZW50ID0gdGhpcy5jcmVhdGVHcm91cEVsZW1lbnQoKTsgLy9jb2x1bW4gZ3JvdXAgaG9sZGVyIGVsZW1lbnRcblxuXHRcdHRoaXMuaXNHcm91cCA9IGZhbHNlO1xuXG5cdFx0dGhpcy50b29sdGlwID0gZmFsc2U7IC8vaG9sZCBjb2x1bW4gdG9vbHRpcFxuXG5cdFx0dGhpcy5ob3pBbGlnbiA9IFwiXCI7IC8vaG9yaXpvbnRhbCB0ZXh0IGFsaWdubWVudFxuXG5cdFx0dGhpcy52ZXJ0QWxpZ24gPSBcIlwiOyAvL3ZlcnQgdGV4dCBhbGlnbm1lbnRcblxuXG5cdFx0Ly9tdWx0aSBkaW1lbnNpb25hbCBmaWxlZCBoYW5kbGluZ1xuXG5cdFx0dGhpcy5maWVsZCA9IFwiXCI7XG5cblx0XHR0aGlzLmZpZWxkU3RydWN0dXJlID0gXCJcIjtcblxuXHRcdHRoaXMuZ2V0RmllbGRWYWx1ZSA9IFwiXCI7XG5cblx0XHR0aGlzLnNldEZpZWxkVmFsdWUgPSBcIlwiO1xuXG5cdFx0dGhpcy50aXRsZUZvcm1hdHRlclJlbmRlcmVkID0gZmFsc2U7XG5cblx0XHR0aGlzLnNldEZpZWxkKHRoaXMuZGVmaW5pdGlvbi5maWVsZCk7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmludmFsaWRPcHRpb25XYXJuaW5ncykge1xuXG5cdFx0XHR0aGlzLmNoZWNrRGVmaW5pdGlvbigpO1xuXHRcdH1cblxuXHRcdHRoaXMubW9kdWxlcyA9IHt9OyAvL2hvbGQgbW9kdWxlIHZhcmlhYmxlcztcblxuXG5cdFx0dGhpcy5jZWxsRXZlbnRzID0ge1xuXG5cdFx0XHRjZWxsQ2xpY2s6IGZhbHNlLFxuXG5cdFx0XHRjZWxsRGJsQ2xpY2s6IGZhbHNlLFxuXG5cdFx0XHRjZWxsQ29udGV4dDogZmFsc2UsXG5cblx0XHRcdGNlbGxUYXA6IGZhbHNlLFxuXG5cdFx0XHRjZWxsRGJsVGFwOiBmYWxzZSxcblxuXHRcdFx0Y2VsbFRhcEhvbGQ6IGZhbHNlLFxuXG5cdFx0XHRjZWxsTW91c2VFbnRlcjogZmFsc2UsXG5cblx0XHRcdGNlbGxNb3VzZUxlYXZlOiBmYWxzZSxcblxuXHRcdFx0Y2VsbE1vdXNlT3ZlcjogZmFsc2UsXG5cblx0XHRcdGNlbGxNb3VzZU91dDogZmFsc2UsXG5cblx0XHRcdGNlbGxNb3VzZU1vdmU6IGZhbHNlXG5cblx0XHR9O1xuXG5cdFx0dGhpcy53aWR0aCA9IG51bGw7IC8vY29sdW1uIHdpZHRoXG5cblx0XHR0aGlzLndpZHRoU3R5bGVkID0gXCJcIjsgLy9jb2x1bW4gd2lkdGggcHJlc3R5bGVkIHRvIGltcHJvdmUgcmVuZGVyIGVmZmljaWVuY3lcblxuXHRcdHRoaXMubWluV2lkdGggPSBudWxsOyAvL2NvbHVtbiBtaW5pbXVtIHdpZHRoXG5cblx0XHR0aGlzLm1pbldpZHRoU3R5bGVkID0gXCJcIjsgLy9jb2x1bW4gbWluaW11bSBwcmVzdHlsZWQgdG8gaW1wcm92ZSByZW5kZXIgZWZmaWNpZW5jeVxuXG5cdFx0dGhpcy53aWR0aEZpeGVkID0gZmFsc2U7IC8vdXNlciBoYXMgc3BlY2lmaWVkIGEgd2lkdGggZm9yIHRoaXMgY29sdW1uXG5cblxuXHRcdHRoaXMudmlzaWJsZSA9IHRydWU7IC8vZGVmYXVsdCB2aXNpYmxlIHN0YXRlXG5cblxuXHRcdHRoaXMuY29tcG9uZW50ID0gbnVsbDtcblxuXHRcdHRoaXMuX21hcERlcHJpY2F0ZWRGdW5jdGlvbmFsaXR5KCk7XG5cblx0XHQvL2luaXRpYWxpemUgY29sdW1uXG5cblx0XHRpZiAoZGVmLmNvbHVtbnMpIHtcblxuXHRcdFx0dGhpcy5pc0dyb3VwID0gdHJ1ZTtcblxuXHRcdFx0ZGVmLmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoZGVmLCBpKSB7XG5cblx0XHRcdFx0dmFyIG5ld0NvbCA9IG5ldyBDb2x1bW4oZGVmLCBzZWxmKTtcblxuXHRcdFx0XHRzZWxmLmF0dGFjaENvbHVtbihuZXdDb2wpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHNlbGYuY2hlY2tDb2x1bW5WaXNpYmlsaXR5KCk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0cGFyZW50LnJlZ2lzdGVyQ29sdW1uRmllbGQodGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKGRlZi5yb3dIYW5kbGUgJiYgdGhpcy50YWJsZS5vcHRpb25zLm1vdmFibGVSb3dzICE9PSBmYWxzZSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcIm1vdmVSb3dcIikpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLm1vdmVSb3cuc2V0SGFuZGxlKHRydWUpO1xuXHRcdH1cblxuXHRcdHRoaXMuX2J1aWxkSGVhZGVyKCk7XG5cblx0XHR0aGlzLmJpbmRNb2R1bGVDb2x1bW5zKCk7XG5cdH07XG5cblx0Q29sdW1uLnByb3RvdHlwZS5jcmVhdGVFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItY29sXCIpO1xuXG5cdFx0ZWwuc2V0QXR0cmlidXRlKFwicm9sZVwiLCBcImNvbHVtbmhlYWRlclwiKTtcblxuXHRcdGVsLnNldEF0dHJpYnV0ZShcImFyaWEtc29ydFwiLCBcIm5vbmVcIik7XG5cblx0XHRyZXR1cm4gZWw7XG5cdH07XG5cblx0Q29sdW1uLnByb3RvdHlwZS5jcmVhdGVHcm91cEVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG5cdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1jb2wtZ3JvdXAtY29sc1wiKTtcblxuXHRcdHJldHVybiBlbDtcblx0fTtcblxuXHRDb2x1bW4ucHJvdG90eXBlLmNoZWNrRGVmaW5pdGlvbiA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgX3RoaXM0ID0gdGhpcztcblxuXHRcdE9iamVjdC5rZXlzKHRoaXMuZGVmaW5pdGlvbikuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG5cblx0XHRcdGlmIChfdGhpczQuZGVmYXVsdE9wdGlvbkxpc3QuaW5kZXhPZihrZXkpID09PSAtMSkge1xuXG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkludmFsaWQgY29sdW1uIGRlZmluaXRpb24gb3B0aW9uIGluICdcIiArIChfdGhpczQuZmllbGQgfHwgX3RoaXM0LmRlZmluaXRpb24udGl0bGUpICsgXCInIGNvbHVtbjpcIiwga2V5KTtcblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHRDb2x1bW4ucHJvdG90eXBlLnNldEZpZWxkID0gZnVuY3Rpb24gKGZpZWxkKSB7XG5cblx0XHR0aGlzLmZpZWxkID0gZmllbGQ7XG5cblx0XHR0aGlzLmZpZWxkU3RydWN0dXJlID0gZmllbGQgPyB0aGlzLnRhYmxlLm9wdGlvbnMubmVzdGVkRmllbGRTZXBhcmF0b3IgPyBmaWVsZC5zcGxpdCh0aGlzLnRhYmxlLm9wdGlvbnMubmVzdGVkRmllbGRTZXBhcmF0b3IpIDogW2ZpZWxkXSA6IFtdO1xuXG5cdFx0dGhpcy5nZXRGaWVsZFZhbHVlID0gdGhpcy5maWVsZFN0cnVjdHVyZS5sZW5ndGggPiAxID8gdGhpcy5fZ2V0TmVzdGVkRGF0YSA6IHRoaXMuX2dldEZsYXREYXRhO1xuXG5cdFx0dGhpcy5zZXRGaWVsZFZhbHVlID0gdGhpcy5maWVsZFN0cnVjdHVyZS5sZW5ndGggPiAxID8gdGhpcy5fc2V0TmVzdGVkRGF0YSA6IHRoaXMuX3NldEZsYXREYXRhO1xuXHR9O1xuXG5cdC8vcmVnaXN0ZXIgY29sdW1uIHBvc2l0aW9uIHdpdGggY29sdW1uIG1hbmFnZXJcblxuXHRDb2x1bW4ucHJvdG90eXBlLnJlZ2lzdGVyQ29sdW1uUG9zaXRpb24gPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHR0aGlzLnBhcmVudC5yZWdpc3RlckNvbHVtblBvc2l0aW9uKGNvbHVtbik7XG5cdH07XG5cblx0Ly9yZWdpc3RlciBjb2x1bW4gcG9zaXRpb24gd2l0aCBjb2x1bW4gbWFuYWdlclxuXG5cdENvbHVtbi5wcm90b3R5cGUucmVnaXN0ZXJDb2x1bW5GaWVsZCA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdHRoaXMucGFyZW50LnJlZ2lzdGVyQ29sdW1uRmllbGQoY29sdW1uKTtcblx0fTtcblxuXHQvL3RyaWdnZXIgcG9zaXRpb24gcmVnaXN0cmF0aW9uXG5cblx0Q29sdW1uLnByb3RvdHlwZS5yZVJlZ2lzdGVyUG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5pc0dyb3VwKSB7XG5cblx0XHRcdHRoaXMuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0XHRjb2x1bW4ucmVSZWdpc3RlclBvc2l0aW9uKCk7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uUG9zaXRpb24odGhpcyk7XG5cdFx0fVxuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuX21hcERlcHJpY2F0ZWRGdW5jdGlvbmFsaXR5ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHR5cGVvZiB0aGlzLmRlZmluaXRpb24uaGlkZUluSHRtbCAhPT0gXCJ1bmRlZmluZWRcIikge1xuXG5cdFx0XHR0aGlzLmRlZmluaXRpb24uaHRtbE91dHB1dCA9ICF0aGlzLmRlZmluaXRpb24uaGlkZUluSHRtbDtcblxuXHRcdFx0Y29uc29sZS53YXJuKFwiaGlkZUluSHRtbCBjb2x1bW4gZGVmaW5pdGlvbiBwcm9wZXJ0eSBpcyBkZXByZWNhdGVkLCB5b3Ugc2hvdWxkIG5vdyB1c2UgaHRtbE91dHB1dFwiKTtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIHRoaXMuZGVmaW5pdGlvbi5hbGlnbiAhPT0gXCJ1bmRlZmluZWRcIikge1xuXG5cdFx0XHR0aGlzLmRlZmluaXRpb24uaG96QWxpZ24gPSB0aGlzLmRlZmluaXRpb24uYWxpZ247XG5cblx0XHRcdGNvbnNvbGUud2FybihcImFsaWduIGNvbHVtbiBkZWZpbml0aW9uIHByb3BlcnR5IGlzIGRlcHJlY2F0ZWQsIHlvdSBzaG91bGQgbm93IHVzZSBob3pBbGlnblwiKTtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIHRoaXMuZGVmaW5pdGlvbi5kb3dubG9hZFRpdGxlICE9PSBcInVuZGVmaW5lZFwiKSB7XG5cblx0XHRcdHRoaXMuZGVmaW5pdGlvbi50aXRsZURvd25sb2FkID0gdGhpcy5kZWZpbml0aW9uLmRvd25sb2FkVGl0bGU7XG5cblx0XHRcdGNvbnNvbGUud2FybihcImRvd25sb2FkVGl0bGUgZGVmaW5pdGlvbiBwcm9wZXJ0eSBpcyBkZXByZWNhdGVkLCB5b3Ugc2hvdWxkIG5vdyB1c2UgdGl0bGVEb3dubG9hZFwiKTtcblx0XHR9XG5cdH07XG5cblx0Q29sdW1uLnByb3RvdHlwZS5zZXRUb29sdGlwID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBkZWYgPSBzZWxmLmRlZmluaXRpb247XG5cblx0XHQvL3NldCBoZWFkZXIgdG9vbHRpcHNcblxuXHRcdHZhciB0b29sdGlwID0gZGVmLmhlYWRlclRvb2x0aXAgfHwgZGVmLnRvb2x0aXAgPT09IGZhbHNlID8gZGVmLmhlYWRlclRvb2x0aXAgOiBzZWxmLnRhYmxlLm9wdGlvbnMudG9vbHRpcHNIZWFkZXI7XG5cblx0XHRpZiAodG9vbHRpcCkge1xuXG5cdFx0XHRpZiAodG9vbHRpcCA9PT0gdHJ1ZSkge1xuXG5cdFx0XHRcdGlmIChkZWYuZmllbGQpIHtcblxuXHRcdFx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5sb2NhbGl6ZS5iaW5kKFwiY29sdW1uc3xcIiArIGRlZi5maWVsZCwgZnVuY3Rpb24gKHZhbHVlKSB7XG5cblx0XHRcdFx0XHRcdHNlbGYuZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCB2YWx1ZSB8fCBkZWYudGl0bGUpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0c2VsZi5lbGVtZW50LnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIGRlZi50aXRsZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0aWYgKHR5cGVvZiB0b29sdGlwID09IFwiZnVuY3Rpb25cIikge1xuXG5cdFx0XHRcdFx0dG9vbHRpcCA9IHRvb2x0aXAoc2VsZi5nZXRDb21wb25lbnQoKSk7XG5cblx0XHRcdFx0XHRpZiAodG9vbHRpcCA9PT0gZmFsc2UpIHtcblxuXHRcdFx0XHRcdFx0dG9vbHRpcCA9IFwiXCI7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsZi5lbGVtZW50LnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIHRvb2x0aXApO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCBcIlwiKTtcblx0XHR9XG5cdH07XG5cblx0Ly9idWlsZCBoZWFkZXIgZWxlbWVudFxuXG5cdENvbHVtbi5wcm90b3R5cGUuX2J1aWxkSGVhZGVyID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBkZWYgPSBzZWxmLmRlZmluaXRpb247XG5cblx0XHR3aGlsZSAoc2VsZi5lbGVtZW50LmZpcnN0Q2hpbGQpIHtcblx0XHRcdHNlbGYuZWxlbWVudC5yZW1vdmVDaGlsZChzZWxmLmVsZW1lbnQuZmlyc3RDaGlsZCk7XG5cdFx0fWlmIChkZWYuaGVhZGVyVmVydGljYWwpIHtcblxuXHRcdFx0c2VsZi5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItY29sLXZlcnRpY2FsXCIpO1xuXG5cdFx0XHRpZiAoZGVmLmhlYWRlclZlcnRpY2FsID09PSBcImZsaXBcIikge1xuXG5cdFx0XHRcdHNlbGYuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNvbC12ZXJ0aWNhbC1mbGlwXCIpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHNlbGYuY29udGVudEVsZW1lbnQgPSBzZWxmLl9iaW5kRXZlbnRzKCk7XG5cblx0XHRzZWxmLmNvbnRlbnRFbGVtZW50ID0gc2VsZi5fYnVpbGRDb2x1bW5IZWFkZXJDb250ZW50KCk7XG5cblx0XHRzZWxmLmVsZW1lbnQuYXBwZW5kQ2hpbGQoc2VsZi5jb250ZW50RWxlbWVudCk7XG5cblx0XHRpZiAoc2VsZi5pc0dyb3VwKSB7XG5cblx0XHRcdHNlbGYuX2J1aWxkR3JvdXBIZWFkZXIoKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRzZWxmLl9idWlsZENvbHVtbkhlYWRlcigpO1xuXHRcdH1cblxuXHRcdHNlbGYuc2V0VG9vbHRpcCgpO1xuXG5cdFx0Ly9zZXQgcmVzaXphYmxlIGhhbmRsZXNcblxuXHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMucmVzaXphYmxlQ29sdW1ucyAmJiBzZWxmLnRhYmxlLm1vZEV4aXN0cyhcInJlc2l6ZUNvbHVtbnNcIikpIHtcblxuXHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLnJlc2l6ZUNvbHVtbnMuaW5pdGlhbGl6ZUNvbHVtbihcImhlYWRlclwiLCBzZWxmLCBzZWxmLmVsZW1lbnQpO1xuXHRcdH1cblxuXHRcdC8vc2V0IHJlc2l6YWJsZSBoYW5kbGVzXG5cblx0XHRpZiAoZGVmLmhlYWRlckZpbHRlciAmJiBzZWxmLnRhYmxlLm1vZEV4aXN0cyhcImZpbHRlclwiKSAmJiBzZWxmLnRhYmxlLm1vZEV4aXN0cyhcImVkaXRcIikpIHtcblxuXHRcdFx0aWYgKHR5cGVvZiBkZWYuaGVhZGVyRmlsdGVyUGxhY2Vob2xkZXIgIT09IFwidW5kZWZpbmVkXCIgJiYgZGVmLmZpZWxkKSB7XG5cblx0XHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLmxvY2FsaXplLnNldEhlYWRlckZpbHRlckNvbHVtblBsYWNlaG9sZGVyKGRlZi5maWVsZCwgZGVmLmhlYWRlckZpbHRlclBsYWNlaG9sZGVyKTtcblx0XHRcdH1cblxuXHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLmZpbHRlci5pbml0aWFsaXplQ29sdW1uKHNlbGYpO1xuXHRcdH1cblxuXHRcdC8vc2V0IHJlc2l6YWJsZSBoYW5kbGVzXG5cblx0XHRpZiAoc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJmcm96ZW5Db2x1bW5zXCIpKSB7XG5cblx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5mcm96ZW5Db2x1bW5zLmluaXRpYWxpemVDb2x1bW4oc2VsZik7XG5cdFx0fVxuXG5cdFx0Ly9zZXQgbW92YWJsZSBjb2x1bW5cblxuXHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMubW92YWJsZUNvbHVtbnMgJiYgIXNlbGYuaXNHcm91cCAmJiBzZWxmLnRhYmxlLm1vZEV4aXN0cyhcIm1vdmVDb2x1bW5cIikpIHtcblxuXHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLm1vdmVDb2x1bW4uaW5pdGlhbGl6ZUNvbHVtbihzZWxmKTtcblx0XHR9XG5cblx0XHQvL3NldCBjYWxjcyBjb2x1bW5cblxuXHRcdGlmICgoZGVmLnRvcENhbGMgfHwgZGVmLmJvdHRvbUNhbGMpICYmIHNlbGYudGFibGUubW9kRXhpc3RzKFwiY29sdW1uQ2FsY3NcIikpIHtcblxuXHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLmluaXRpYWxpemVDb2x1bW4oc2VsZik7XG5cdFx0fVxuXG5cdFx0Ly9oYW5kbGUgcGVyc2lzdGVuY2VcblxuXHRcdGlmIChzZWxmLnRhYmxlLm1vZEV4aXN0cyhcInBlcnNpc3RlbmNlXCIpICYmIHNlbGYudGFibGUubW9kdWxlcy5wZXJzaXN0ZW5jZS5jb25maWcuY29sdW1ucykge1xuXG5cdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMucGVyc2lzdGVuY2UuaW5pdGlhbGl6ZUNvbHVtbihzZWxmKTtcblx0XHR9XG5cblx0XHQvL3VwZGF0ZSBoZWFkZXIgdG9vbHRpcCBvbiBtb3VzZSBlbnRlclxuXG5cdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWVudGVyXCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdHNlbGYuc2V0VG9vbHRpcCgpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuX2JpbmRFdmVudHMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGRlZiA9IHNlbGYuZGVmaW5pdGlvbixcblx0XHQgICAgZGJsVGFwLFxuXHRcdCAgICB0YXBIb2xkLFxuXHRcdCAgICB0YXA7XG5cblx0XHQvL3NldHVwIGhlYWRlciBjbGljayBldmVudCBiaW5kaW5nc1xuXG5cdFx0aWYgKHR5cGVvZiBkZWYuaGVhZGVyQ2xpY2sgPT0gXCJmdW5jdGlvblwiKSB7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0ZGVmLmhlYWRlckNsaWNrKGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZiBkZWYuaGVhZGVyRGJsQ2xpY2sgPT0gXCJmdW5jdGlvblwiKSB7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZGJsY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0ZGVmLmhlYWRlckRibENsaWNrKGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZiBkZWYuaGVhZGVyQ29udGV4dCA9PSBcImZ1bmN0aW9uXCIpIHtcblxuXHRcdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjb250ZXh0bWVudVwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRkZWYuaGVhZGVyQ29udGV4dChlLCBzZWxmLmdldENvbXBvbmVudCgpKTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8vc2V0dXAgaGVhZGVyIHRhcCBldmVudCBiaW5kaW5nc1xuXG5cdFx0aWYgKHR5cGVvZiBkZWYuaGVhZGVyVGFwID09IFwiZnVuY3Rpb25cIikge1xuXG5cdFx0XHR0YXAgPSBmYWxzZTtcblxuXHRcdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0dGFwID0gdHJ1ZTtcblx0XHRcdH0sIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcblxuXHRcdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdGlmICh0YXApIHtcblxuXHRcdFx0XHRcdGRlZi5oZWFkZXJUYXAoZSwgc2VsZi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR0YXAgPSBmYWxzZTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YgZGVmLmhlYWRlckRibFRhcCA9PSBcImZ1bmN0aW9uXCIpIHtcblxuXHRcdFx0ZGJsVGFwID0gbnVsbDtcblxuXHRcdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdGlmIChkYmxUYXApIHtcblxuXHRcdFx0XHRcdGNsZWFyVGltZW91dChkYmxUYXApO1xuXG5cdFx0XHRcdFx0ZGJsVGFwID0gbnVsbDtcblxuXHRcdFx0XHRcdGRlZi5oZWFkZXJEYmxUYXAoZSwgc2VsZi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRkYmxUYXAgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0XHRcdFx0Y2xlYXJUaW1lb3V0KGRibFRhcCk7XG5cblx0XHRcdFx0XHRcdGRibFRhcCA9IG51bGw7XG5cdFx0XHRcdFx0fSwgMzAwKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZiBkZWYuaGVhZGVyVGFwSG9sZCA9PSBcImZ1bmN0aW9uXCIpIHtcblxuXHRcdFx0dGFwSG9sZCA9IG51bGw7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdGNsZWFyVGltZW91dCh0YXBIb2xkKTtcblxuXHRcdFx0XHR0YXBIb2xkID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHRjbGVhclRpbWVvdXQodGFwSG9sZCk7XG5cblx0XHRcdFx0XHR0YXBIb2xkID0gbnVsbDtcblxuXHRcdFx0XHRcdHRhcCA9IGZhbHNlO1xuXG5cdFx0XHRcdFx0ZGVmLmhlYWRlclRhcEhvbGQoZSwgc2VsZi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHRcdH0sIDEwMDApO1xuXHRcdFx0fSwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuXG5cdFx0XHRzZWxmLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0Y2xlYXJUaW1lb3V0KHRhcEhvbGQpO1xuXG5cdFx0XHRcdHRhcEhvbGQgPSBudWxsO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0Ly9zdG9yZSBjb2x1bW4gY2VsbCBjbGljayBldmVudCBiaW5kaW5nc1xuXG5cdFx0aWYgKHR5cGVvZiBkZWYuY2VsbENsaWNrID09IFwiZnVuY3Rpb25cIikge1xuXG5cdFx0XHRzZWxmLmNlbGxFdmVudHMuY2VsbENsaWNrID0gZGVmLmNlbGxDbGljaztcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIGRlZi5jZWxsRGJsQ2xpY2sgPT0gXCJmdW5jdGlvblwiKSB7XG5cblx0XHRcdHNlbGYuY2VsbEV2ZW50cy5jZWxsRGJsQ2xpY2sgPSBkZWYuY2VsbERibENsaWNrO1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YgZGVmLmNlbGxDb250ZXh0ID09IFwiZnVuY3Rpb25cIikge1xuXG5cdFx0XHRzZWxmLmNlbGxFdmVudHMuY2VsbENvbnRleHQgPSBkZWYuY2VsbENvbnRleHQ7XG5cdFx0fVxuXG5cdFx0Ly9zdG9yZSBjb2x1bW4gbW91c2UgZXZlbnQgYmluZGluZ3NcblxuXHRcdGlmICh0eXBlb2YgZGVmLmNlbGxNb3VzZUVudGVyID09IFwiZnVuY3Rpb25cIikge1xuXG5cdFx0XHRzZWxmLmNlbGxFdmVudHMuY2VsbE1vdXNlRW50ZXIgPSBkZWYuY2VsbE1vdXNlRW50ZXI7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZiBkZWYuY2VsbE1vdXNlTGVhdmUgPT0gXCJmdW5jdGlvblwiKSB7XG5cblx0XHRcdHNlbGYuY2VsbEV2ZW50cy5jZWxsTW91c2VMZWF2ZSA9IGRlZi5jZWxsTW91c2VMZWF2ZTtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIGRlZi5jZWxsTW91c2VPdmVyID09IFwiZnVuY3Rpb25cIikge1xuXG5cdFx0XHRzZWxmLmNlbGxFdmVudHMuY2VsbE1vdXNlT3ZlciA9IGRlZi5jZWxsTW91c2VPdmVyO1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YgZGVmLmNlbGxNb3VzZU91dCA9PSBcImZ1bmN0aW9uXCIpIHtcblxuXHRcdFx0c2VsZi5jZWxsRXZlbnRzLmNlbGxNb3VzZU91dCA9IGRlZi5jZWxsTW91c2VPdXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZiBkZWYuY2VsbE1vdXNlTW92ZSA9PSBcImZ1bmN0aW9uXCIpIHtcblxuXHRcdFx0c2VsZi5jZWxsRXZlbnRzLmNlbGxNb3VzZU1vdmUgPSBkZWYuY2VsbE1vdXNlTW92ZTtcblx0XHR9XG5cblx0XHQvL3NldHVwIGNvbHVtbiBjZWxsIHRhcCBldmVudCBiaW5kaW5nc1xuXG5cdFx0aWYgKHR5cGVvZiBkZWYuY2VsbFRhcCA9PSBcImZ1bmN0aW9uXCIpIHtcblxuXHRcdFx0c2VsZi5jZWxsRXZlbnRzLmNlbGxUYXAgPSBkZWYuY2VsbFRhcDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIGRlZi5jZWxsRGJsVGFwID09IFwiZnVuY3Rpb25cIikge1xuXG5cdFx0XHRzZWxmLmNlbGxFdmVudHMuY2VsbERibFRhcCA9IGRlZi5jZWxsRGJsVGFwO1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YgZGVmLmNlbGxUYXBIb2xkID09IFwiZnVuY3Rpb25cIikge1xuXG5cdFx0XHRzZWxmLmNlbGxFdmVudHMuY2VsbFRhcEhvbGQgPSBkZWYuY2VsbFRhcEhvbGQ7XG5cdFx0fVxuXG5cdFx0Ly9zZXR1cCBjb2x1bW4gY2VsbCBlZGl0IGNhbGxiYWNrc1xuXG5cdFx0aWYgKHR5cGVvZiBkZWYuY2VsbEVkaXRlZCA9PSBcImZ1bmN0aW9uXCIpIHtcblxuXHRcdFx0c2VsZi5jZWxsRXZlbnRzLmNlbGxFZGl0ZWQgPSBkZWYuY2VsbEVkaXRlZDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIGRlZi5jZWxsRWRpdGluZyA9PSBcImZ1bmN0aW9uXCIpIHtcblxuXHRcdFx0c2VsZi5jZWxsRXZlbnRzLmNlbGxFZGl0aW5nID0gZGVmLmNlbGxFZGl0aW5nO1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YgZGVmLmNlbGxFZGl0Q2FuY2VsbGVkID09IFwiZnVuY3Rpb25cIikge1xuXG5cdFx0XHRzZWxmLmNlbGxFdmVudHMuY2VsbEVkaXRDYW5jZWxsZWQgPSBkZWYuY2VsbEVkaXRDYW5jZWxsZWQ7XG5cdFx0fVxuXHR9O1xuXG5cdC8vYnVpbGQgaGVhZGVyIGVsZW1lbnQgZm9yIGhlYWRlclxuXG5cdENvbHVtbi5wcm90b3R5cGUuX2J1aWxkQ29sdW1uSGVhZGVyID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBkZWYgPSBzZWxmLmRlZmluaXRpb24sXG5cdFx0ICAgIHRhYmxlID0gc2VsZi50YWJsZSxcblx0XHQgICAgc29ydGFibGU7XG5cblx0XHQvL3NldCBjb2x1bW4gc29ydGVyXG5cblx0XHRpZiAodGFibGUubW9kRXhpc3RzKFwic29ydFwiKSkge1xuXG5cdFx0XHR0YWJsZS5tb2R1bGVzLnNvcnQuaW5pdGlhbGl6ZUNvbHVtbihzZWxmLCBzZWxmLmNvbnRlbnRFbGVtZW50KTtcblx0XHR9XG5cblx0XHQvL3NldCBjb2x1bW4gaGVhZGVyIGNvbnRleHQgbWVudVxuXG5cdFx0aWYgKChkZWYuaGVhZGVyQ29udGV4dE1lbnUgfHwgZGVmLmhlYWRlck1lbnUpICYmIHRhYmxlLm1vZEV4aXN0cyhcIm1lbnVcIikpIHtcblxuXHRcdFx0dGFibGUubW9kdWxlcy5tZW51LmluaXRpYWxpemVDb2x1bW5IZWFkZXIoc2VsZik7XG5cdFx0fVxuXG5cdFx0Ly9zZXQgY29sdW1uIGZvcm1hdHRlclxuXG5cdFx0aWYgKHRhYmxlLm1vZEV4aXN0cyhcImZvcm1hdFwiKSkge1xuXG5cdFx0XHR0YWJsZS5tb2R1bGVzLmZvcm1hdC5pbml0aWFsaXplQ29sdW1uKHNlbGYpO1xuXHRcdH1cblxuXHRcdC8vc2V0IGNvbHVtbiBlZGl0b3JcblxuXHRcdGlmICh0eXBlb2YgZGVmLmVkaXRvciAhPSBcInVuZGVmaW5lZFwiICYmIHRhYmxlLm1vZEV4aXN0cyhcImVkaXRcIikpIHtcblxuXHRcdFx0dGFibGUubW9kdWxlcy5lZGl0LmluaXRpYWxpemVDb2x1bW4oc2VsZik7XG5cdFx0fVxuXG5cdFx0Ly9zZXQgY29sdW0gdmFsaWRhdG9yXG5cblx0XHRpZiAodHlwZW9mIGRlZi52YWxpZGF0b3IgIT0gXCJ1bmRlZmluZWRcIiAmJiB0YWJsZS5tb2RFeGlzdHMoXCJ2YWxpZGF0ZVwiKSkge1xuXG5cdFx0XHR0YWJsZS5tb2R1bGVzLnZhbGlkYXRlLmluaXRpYWxpemVDb2x1bW4oc2VsZik7XG5cdFx0fVxuXG5cdFx0Ly9zZXQgY29sdW1uIG11dGF0b3JcblxuXHRcdGlmICh0YWJsZS5tb2RFeGlzdHMoXCJtdXRhdG9yXCIpKSB7XG5cblx0XHRcdHRhYmxlLm1vZHVsZXMubXV0YXRvci5pbml0aWFsaXplQ29sdW1uKHNlbGYpO1xuXHRcdH1cblxuXHRcdC8vc2V0IGNvbHVtbiBhY2Nlc3NvclxuXG5cdFx0aWYgKHRhYmxlLm1vZEV4aXN0cyhcImFjY2Vzc29yXCIpKSB7XG5cblx0XHRcdHRhYmxlLm1vZHVsZXMuYWNjZXNzb3IuaW5pdGlhbGl6ZUNvbHVtbihzZWxmKTtcblx0XHR9XG5cblx0XHQvL3NldCByZXNwb3ZpdmVMYXlvdXRcblxuXHRcdGlmIChfdHlwZW9mKHRhYmxlLm9wdGlvbnMucmVzcG9uc2l2ZUxheW91dCkgJiYgdGFibGUubW9kRXhpc3RzKFwicmVzcG9uc2l2ZUxheW91dFwiKSkge1xuXG5cdFx0XHR0YWJsZS5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQuaW5pdGlhbGl6ZUNvbHVtbihzZWxmKTtcblx0XHR9XG5cblx0XHQvL3NldCBjb2x1bW4gdmlzaWJpbGl0eVxuXG5cdFx0aWYgKHR5cGVvZiBkZWYudmlzaWJsZSAhPSBcInVuZGVmaW5lZFwiKSB7XG5cblx0XHRcdGlmIChkZWYudmlzaWJsZSkge1xuXG5cdFx0XHRcdHNlbGYuc2hvdyh0cnVlKTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0c2VsZi5oaWRlKHRydWUpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vYXNpZ24gYWRkaXRpb25hbCBjc3MgY2xhc3NlcyB0byBjb2x1bW4gaGVhZGVyXG5cblx0XHRpZiAoZGVmLmNzc0NsYXNzKSB7XG5cblx0XHRcdHZhciBjbGFzc2VOYW1lcyA9IGRlZi5jc3NDbGFzcy5zcGxpdChcIiBcIik7XG5cblx0XHRcdGNsYXNzZU5hbWVzLmZvckVhY2goZnVuY3Rpb24gKGNsYXNzTmFtZSkge1xuXG5cdFx0XHRcdHNlbGYuZWxlbWVudC5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoZGVmLmZpZWxkKSB7XG5cblx0XHRcdHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJ0YWJ1bGF0b3ItZmllbGRcIiwgZGVmLmZpZWxkKTtcblx0XHR9XG5cblx0XHQvL3NldCBtaW4gd2lkdGggaWYgcHJlc2VudFxuXG5cdFx0c2VsZi5zZXRNaW5XaWR0aCh0eXBlb2YgZGVmLm1pbldpZHRoID09IFwidW5kZWZpbmVkXCIgPyBzZWxmLnRhYmxlLm9wdGlvbnMuY29sdW1uTWluV2lkdGggOiBwYXJzZUludChkZWYubWluV2lkdGgpKTtcblxuXHRcdHNlbGYucmVpbml0aWFsaXplV2lkdGgoKTtcblxuXHRcdC8vc2V0IHRvb2x0aXAgaWYgcHJlc2VudFxuXG5cdFx0c2VsZi50b29sdGlwID0gc2VsZi5kZWZpbml0aW9uLnRvb2x0aXAgfHwgc2VsZi5kZWZpbml0aW9uLnRvb2x0aXAgPT09IGZhbHNlID8gc2VsZi5kZWZpbml0aW9uLnRvb2x0aXAgOiBzZWxmLnRhYmxlLm9wdGlvbnMudG9vbHRpcHM7XG5cblx0XHQvL3NldCBvcml6b250YWwgdGV4dCBhbGlnbm1lbnRcblxuXHRcdHNlbGYuaG96QWxpZ24gPSB0eXBlb2Ygc2VsZi5kZWZpbml0aW9uLmhvekFsaWduID09IFwidW5kZWZpbmVkXCIgPyBzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbEhvekFsaWduIDogc2VsZi5kZWZpbml0aW9uLmhvekFsaWduO1xuXG5cdFx0c2VsZi52ZXJ0QWxpZ24gPSB0eXBlb2Ygc2VsZi5kZWZpbml0aW9uLnZlcnRBbGlnbiA9PSBcInVuZGVmaW5lZFwiID8gc2VsZi50YWJsZS5vcHRpb25zLmNlbGxWZXJ0QWxpZ24gOiBzZWxmLmRlZmluaXRpb24udmVydEFsaWduO1xuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuX2J1aWxkQ29sdW1uSGVhZGVyQ29udGVudCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBkZWYgPSB0aGlzLmRlZmluaXRpb24sXG5cdFx0ICAgIHRhYmxlID0gdGhpcy50YWJsZTtcblxuXHRcdHZhciBjb250ZW50RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cblx0XHRjb250ZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNvbC1jb250ZW50XCIpO1xuXG5cdFx0dGhpcy50aXRsZUVsZW1lbnQgPSB0aGlzLl9idWlsZENvbHVtbkhlYWRlclRpdGxlKCk7XG5cblx0XHRjb250ZW50RWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLnRpdGxlRWxlbWVudCk7XG5cblx0XHRyZXR1cm4gY29udGVudEVsZW1lbnQ7XG5cdH07XG5cblx0Ly9idWlsZCB0aXRsZSBlbGVtZW50IG9mIGNvbHVtblxuXG5cdENvbHVtbi5wcm90b3R5cGUuX2J1aWxkQ29sdW1uSGVhZGVyVGl0bGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGRlZiA9IHNlbGYuZGVmaW5pdGlvbixcblx0XHQgICAgdGFibGUgPSBzZWxmLnRhYmxlLFxuXHRcdCAgICB0aXRsZTtcblxuXHRcdHZhciB0aXRsZUhvbGRlckVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG5cdFx0dGl0bGVIb2xkZXJFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItY29sLXRpdGxlXCIpO1xuXG5cdFx0aWYgKGRlZi5lZGl0YWJsZVRpdGxlKSB7XG5cblx0XHRcdHZhciB0aXRsZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG5cblx0XHRcdHRpdGxlRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXRpdGxlLWVkaXRvclwiKTtcblxuXHRcdFx0dGl0bGVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cblx0XHRcdFx0dGl0bGVFbGVtZW50LmZvY3VzKCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0dGl0bGVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgZnVuY3Rpb24gKCkge1xuXG5cdFx0XHRcdGRlZi50aXRsZSA9IHRpdGxlRWxlbWVudC52YWx1ZTtcblxuXHRcdFx0XHR0YWJsZS5vcHRpb25zLmNvbHVtblRpdGxlQ2hhbmdlZC5jYWxsKHNlbGYudGFibGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHRpdGxlSG9sZGVyRWxlbWVudC5hcHBlbmRDaGlsZCh0aXRsZUVsZW1lbnQpO1xuXG5cdFx0XHRpZiAoZGVmLmZpZWxkKSB7XG5cblx0XHRcdFx0dGFibGUubW9kdWxlcy5sb2NhbGl6ZS5iaW5kKFwiY29sdW1uc3xcIiArIGRlZi5maWVsZCwgZnVuY3Rpb24gKHRleHQpIHtcblxuXHRcdFx0XHRcdHRpdGxlRWxlbWVudC52YWx1ZSA9IHRleHQgfHwgZGVmLnRpdGxlIHx8IFwiJm5ic3A7XCI7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHR0aXRsZUVsZW1lbnQudmFsdWUgPSBkZWYudGl0bGUgfHwgXCImbmJzcDtcIjtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoZGVmLmZpZWxkKSB7XG5cblx0XHRcdFx0dGFibGUubW9kdWxlcy5sb2NhbGl6ZS5iaW5kKFwiY29sdW1uc3xcIiArIGRlZi5maWVsZCwgZnVuY3Rpb24gKHRleHQpIHtcblxuXHRcdFx0XHRcdHNlbGYuX2Zvcm1hdENvbHVtbkhlYWRlclRpdGxlKHRpdGxlSG9sZGVyRWxlbWVudCwgdGV4dCB8fCBkZWYudGl0bGUgfHwgXCImbmJzcDtcIik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRzZWxmLl9mb3JtYXRDb2x1bW5IZWFkZXJUaXRsZSh0aXRsZUhvbGRlckVsZW1lbnQsIGRlZi50aXRsZSB8fCBcIiZuYnNwO1wiKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gdGl0bGVIb2xkZXJFbGVtZW50O1xuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuX2Zvcm1hdENvbHVtbkhlYWRlclRpdGxlID0gZnVuY3Rpb24gKGVsLCB0aXRsZSkge1xuXHRcdHZhciBfdGhpczUgPSB0aGlzO1xuXG5cdFx0dmFyIGZvcm1hdHRlciwgY29udGVudHMsIHBhcmFtcywgbW9ja0NlbGwsIG9uUmVuZGVyZWQ7XG5cblx0XHRpZiAodGhpcy5kZWZpbml0aW9uLnRpdGxlRm9ybWF0dGVyICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiZm9ybWF0XCIpKSB7XG5cblx0XHRcdGZvcm1hdHRlciA9IHRoaXMudGFibGUubW9kdWxlcy5mb3JtYXQuZ2V0Rm9ybWF0dGVyKHRoaXMuZGVmaW5pdGlvbi50aXRsZUZvcm1hdHRlcik7XG5cblx0XHRcdG9uUmVuZGVyZWQgPSBmdW5jdGlvbiBvblJlbmRlcmVkKGNhbGxiYWNrKSB7XG5cblx0XHRcdFx0X3RoaXM1LnRpdGxlRm9ybWF0dGVyUmVuZGVyZWQgPSBjYWxsYmFjaztcblx0XHRcdH07XG5cblx0XHRcdG1vY2tDZWxsID0ge1xuXG5cdFx0XHRcdGdldFZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtcblxuXHRcdFx0XHRcdHJldHVybiB0aXRsZTtcblx0XHRcdFx0fSxcblxuXHRcdFx0XHRnZXRFbGVtZW50OiBmdW5jdGlvbiBnZXRFbGVtZW50KCkge1xuXG5cdFx0XHRcdFx0cmV0dXJuIGVsO1xuXHRcdFx0XHR9XG5cblx0XHRcdH07XG5cblx0XHRcdHBhcmFtcyA9IHRoaXMuZGVmaW5pdGlvbi50aXRsZUZvcm1hdHRlclBhcmFtcyB8fCB7fTtcblxuXHRcdFx0cGFyYW1zID0gdHlwZW9mIHBhcmFtcyA9PT0gXCJmdW5jdGlvblwiID8gcGFyYW1zKCkgOiBwYXJhbXM7XG5cblx0XHRcdGNvbnRlbnRzID0gZm9ybWF0dGVyLmNhbGwodGhpcy50YWJsZS5tb2R1bGVzLmZvcm1hdCwgbW9ja0NlbGwsIHBhcmFtcywgb25SZW5kZXJlZCk7XG5cblx0XHRcdHN3aXRjaCAodHlwZW9mIGNvbnRlbnRzID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihjb250ZW50cykpIHtcblxuXHRcdFx0XHRjYXNlIFwib2JqZWN0XCI6XG5cblx0XHRcdFx0XHRpZiAoY29udGVudHMgaW5zdGFuY2VvZiBOb2RlKSB7XG5cblx0XHRcdFx0XHRcdGVsLmFwcGVuZENoaWxkKGNvbnRlbnRzKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRlbC5pbm5lckhUTUwgPSBcIlwiO1xuXG5cdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJGb3JtYXQgRXJyb3IgLSBUaXRsZSBmb3JtYXR0ZXIgaGFzIHJldHVybmVkIGEgdHlwZSBvZiBvYmplY3QsIHRoZSBvbmx5IHZhbGlkIGZvcm1hdHRlciBvYmplY3QgcmV0dXJuIGlzIGFuIGluc3RhbmNlIG9mIE5vZGUsIHRoZSBmb3JtYXR0ZXIgcmV0dXJuZWQ6XCIsIGNvbnRlbnRzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRjYXNlIFwidW5kZWZpbmVkXCI6XG5cblx0XHRcdFx0Y2FzZSBcIm51bGxcIjpcblxuXHRcdFx0XHRcdGVsLmlubmVySFRNTCA9IFwiXCI7XG5cblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRkZWZhdWx0OlxuXG5cdFx0XHRcdFx0ZWwuaW5uZXJIVE1MID0gY29udGVudHM7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRlbC5pbm5lckhUTUwgPSB0aXRsZTtcblx0XHR9XG5cdH07XG5cblx0Ly9idWlsZCBoZWFkZXIgZWxlbWVudCBmb3IgY29sdW1uIGdyb3VwXG5cblx0Q29sdW1uLnByb3RvdHlwZS5fYnVpbGRHcm91cEhlYWRlciA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgX3RoaXM2ID0gdGhpcztcblxuXHRcdHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNvbC1ncm91cFwiKTtcblxuXHRcdHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwiY29sdW1uZ3JvdXBcIik7XG5cblx0XHR0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKFwiYXJpYS10aXRsZVwiLCB0aGlzLmRlZmluaXRpb24udGl0bGUpO1xuXG5cdFx0Ly9hc2lnbiBhZGRpdGlvbmFsIGNzcyBjbGFzc2VzIHRvIGNvbHVtbiBoZWFkZXJcblxuXHRcdGlmICh0aGlzLmRlZmluaXRpb24uY3NzQ2xhc3MpIHtcblxuXHRcdFx0dmFyIGNsYXNzZU5hbWVzID0gdGhpcy5kZWZpbml0aW9uLmNzc0NsYXNzLnNwbGl0KFwiIFwiKTtcblxuXHRcdFx0Y2xhc3NlTmFtZXMuZm9yRWFjaChmdW5jdGlvbiAoY2xhc3NOYW1lKSB7XG5cblx0XHRcdFx0X3RoaXM2LmVsZW1lbnQuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0Ly9zZXQgY29sdW1uIGhlYWRlciBjb250ZXh0IG1lbnVcblxuXHRcdGlmICgodGhpcy5kZWZpbml0aW9uLmhlYWRlckNvbnRleHRNZW51IHx8IHRoaXMuZGVmaW5pdGlvbi5oZWFkZXJNZW51KSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcIm1lbnVcIikpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLm1lbnUuaW5pdGlhbGl6ZUNvbHVtbkhlYWRlcih0aGlzKTtcblx0XHR9XG5cblx0XHR0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5ncm91cEVsZW1lbnQpO1xuXHR9O1xuXG5cdC8vZmxhdCBmaWVsZCBsb29rdXBcblxuXHRDb2x1bW4ucHJvdG90eXBlLl9nZXRGbGF0RGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cblx0XHRyZXR1cm4gZGF0YVt0aGlzLmZpZWxkXTtcblx0fTtcblxuXHQvL25lc3RlZCBmaWVsZCBsb29rdXBcblxuXHRDb2x1bW4ucHJvdG90eXBlLl9nZXROZXN0ZWREYXRhID0gZnVuY3Rpb24gKGRhdGEpIHtcblxuXHRcdHZhciBkYXRhT2JqID0gZGF0YSxcblx0XHQgICAgc3RydWN0dXJlID0gdGhpcy5maWVsZFN0cnVjdHVyZSxcblx0XHQgICAgbGVuZ3RoID0gc3RydWN0dXJlLmxlbmd0aCxcblx0XHQgICAgb3V0cHV0O1xuXG5cdFx0Zm9yICh2YXIgX2kgPSAwOyBfaSA8IGxlbmd0aDsgX2krKykge1xuXG5cdFx0XHRkYXRhT2JqID0gZGF0YU9ialtzdHJ1Y3R1cmVbX2ldXTtcblxuXHRcdFx0b3V0cHV0ID0gZGF0YU9iajtcblxuXHRcdFx0aWYgKCFkYXRhT2JqKSB7XG5cblx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fTtcblxuXHQvL2ZsYXQgZmllbGQgc2V0XG5cblx0Q29sdW1uLnByb3RvdHlwZS5fc2V0RmxhdERhdGEgPSBmdW5jdGlvbiAoZGF0YSwgdmFsdWUpIHtcblxuXHRcdGlmICh0aGlzLmZpZWxkKSB7XG5cblx0XHRcdGRhdGFbdGhpcy5maWVsZF0gPSB2YWx1ZTtcblx0XHR9XG5cdH07XG5cblx0Ly9uZXN0ZWQgZmllbGQgc2V0XG5cblx0Q29sdW1uLnByb3RvdHlwZS5fc2V0TmVzdGVkRGF0YSA9IGZ1bmN0aW9uIChkYXRhLCB2YWx1ZSkge1xuXG5cdFx0dmFyIGRhdGFPYmogPSBkYXRhLFxuXHRcdCAgICBzdHJ1Y3R1cmUgPSB0aGlzLmZpZWxkU3RydWN0dXJlLFxuXHRcdCAgICBsZW5ndGggPSBzdHJ1Y3R1cmUubGVuZ3RoO1xuXG5cdFx0Zm9yICh2YXIgX2kyID0gMDsgX2kyIDwgbGVuZ3RoOyBfaTIrKykge1xuXG5cdFx0XHRpZiAoX2kyID09IGxlbmd0aCAtIDEpIHtcblxuXHRcdFx0XHRkYXRhT2JqW3N0cnVjdHVyZVtfaTJdXSA9IHZhbHVlO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRpZiAoIWRhdGFPYmpbc3RydWN0dXJlW19pMl1dKSB7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mIHZhbHVlICE9PSBcInVuZGVmaW5lZFwiKSB7XG5cblx0XHRcdFx0XHRcdGRhdGFPYmpbc3RydWN0dXJlW19pMl1dID0ge307XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZGF0YU9iaiA9IGRhdGFPYmpbc3RydWN0dXJlW19pMl1dO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHQvL2F0dGFjaCBjb2x1bW4gdG8gdGhpcyBncm91cFxuXG5cdENvbHVtbi5wcm90b3R5cGUuYXR0YWNoQ29sdW1uID0gZnVuY3Rpb24gKGNvbHVtbikge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0aWYgKHNlbGYuZ3JvdXBFbGVtZW50KSB7XG5cblx0XHRcdHNlbGYuY29sdW1ucy5wdXNoKGNvbHVtbik7XG5cblx0XHRcdHNlbGYuZ3JvdXBFbGVtZW50LmFwcGVuZENoaWxkKGNvbHVtbi5nZXRFbGVtZW50KCkpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcIkNvbHVtbiBXYXJuaW5nIC0gQ29sdW1uIGJlaW5nIGF0dGFjaGVkIHRvIGFub3RoZXIgY29sdW1uIGluc3RlYWQgb2YgY29sdW1uIGdyb3VwXCIpO1xuXHRcdH1cblx0fTtcblxuXHQvL3ZlcnRpY2FsbHkgYWxpZ24gaGVhZGVyIGluIGNvbHVtblxuXG5cdENvbHVtbi5wcm90b3R5cGUudmVydGljYWxBbGlnbiA9IGZ1bmN0aW9uIChhbGlnbm1lbnQsIGhlaWdodCkge1xuXG5cdFx0Ly9jYWxjdWxhdGUgaGVpZ2h0IG9mIGNvbHVtbiBoZWFkZXIgYW5kIGdyb3VwIGhvbGRlciBlbGVtZW50XG5cblx0XHR2YXIgcGFyZW50SGVpZ2h0ID0gdGhpcy5wYXJlbnQuaXNHcm91cCA/IHRoaXMucGFyZW50LmdldEdyb3VwRWxlbWVudCgpLmNsaWVudEhlaWdodCA6IGhlaWdodCB8fCB0aGlzLnBhcmVudC5nZXRIZWFkZXJzRWxlbWVudCgpLmNsaWVudEhlaWdodDtcblxuXHRcdC8vIHZhciBwYXJlbnRIZWlnaHQgPSB0aGlzLnBhcmVudC5pc0dyb3VwID8gdGhpcy5wYXJlbnQuZ2V0R3JvdXBFbGVtZW50KCkuY2xpZW50SGVpZ2h0IDogdGhpcy5wYXJlbnQuZ2V0SGVhZGVyc0VsZW1lbnQoKS5jbGllbnRIZWlnaHQ7XG5cblxuXHRcdHRoaXMuZWxlbWVudC5zdHlsZS5oZWlnaHQgPSBwYXJlbnRIZWlnaHQgKyBcInB4XCI7XG5cblx0XHRpZiAodGhpcy5pc0dyb3VwKSB7XG5cblx0XHRcdHRoaXMuZ3JvdXBFbGVtZW50LnN0eWxlLm1pbkhlaWdodCA9IHBhcmVudEhlaWdodCAtIHRoaXMuY29udGVudEVsZW1lbnQub2Zmc2V0SGVpZ2h0ICsgXCJweFwiO1xuXHRcdH1cblxuXHRcdC8vdmVydGljYWxseSBhbGlnbiBjZWxsIGNvbnRlbnRzXG5cblx0XHRpZiAoIXRoaXMuaXNHcm91cCAmJiBhbGlnbm1lbnQgIT09IFwidG9wXCIpIHtcblxuXHRcdFx0aWYgKGFsaWdubWVudCA9PT0gXCJib3R0b21cIikge1xuXG5cdFx0XHRcdHRoaXMuZWxlbWVudC5zdHlsZS5wYWRkaW5nVG9wID0gdGhpcy5lbGVtZW50LmNsaWVudEhlaWdodCAtIHRoaXMuY29udGVudEVsZW1lbnQub2Zmc2V0SGVpZ2h0ICsgXCJweFwiO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHR0aGlzLmVsZW1lbnQuc3R5bGUucGFkZGluZ1RvcCA9ICh0aGlzLmVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gdGhpcy5jb250ZW50RWxlbWVudC5vZmZzZXRIZWlnaHQpIC8gMiArIFwicHhcIjtcblx0XHRcdH1cblx0XHR9XG5cblx0XHR0aGlzLmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdGNvbHVtbi52ZXJ0aWNhbEFsaWduKGFsaWdubWVudCk7XG5cdFx0fSk7XG5cdH07XG5cblx0Ly9jbGVhciB2ZXJ0aWNhbCBhbGlnbm1lbmV0XG5cblx0Q29sdW1uLnByb3RvdHlwZS5jbGVhclZlcnRpY2FsQWxpZ24gPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLmVsZW1lbnQuc3R5bGUucGFkZGluZ1RvcCA9IFwiXCI7XG5cblx0XHR0aGlzLmVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gXCJcIjtcblxuXHRcdHRoaXMuZWxlbWVudC5zdHlsZS5taW5IZWlnaHQgPSBcIlwiO1xuXG5cdFx0dGhpcy5ncm91cEVsZW1lbnQuc3R5bGUubWluSGVpZ2h0ID0gXCJcIjtcblxuXHRcdHRoaXMuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0Y29sdW1uLmNsZWFyVmVydGljYWxBbGlnbigpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuYmluZE1vZHVsZUNvbHVtbnMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHQvL2NoZWNrIGlmIHJvd251bSBmb3JtYXR0ZXIgaXMgYmVpbmcgdXNlZCBvbiBhIGNvbHVtblxuXG5cdFx0aWYgKHRoaXMuZGVmaW5pdGlvbi5mb3JtYXR0ZXIgPT0gXCJyb3dudW1cIikge1xuXG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucm93TnVtQ29sdW1uID0gdGhpcztcblx0XHR9XG5cdH07XG5cblx0Ly8vLyBSZXRyZWl2ZSBDb2x1bW4gSW5mb3JtYXRpb24gLy8vL1xuXG5cblx0Ly9yZXR1cm4gY29sdW1uIGhlYWRlciBlbGVtZW50XG5cblx0Q29sdW1uLnByb3RvdHlwZS5nZXRFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuZWxlbWVudDtcblx0fTtcblxuXHQvL3JldHVybiBjb2x1bm0gZ3JvdXAgZWxlbWVudFxuXG5cdENvbHVtbi5wcm90b3R5cGUuZ2V0R3JvdXBFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuZ3JvdXBFbGVtZW50O1xuXHR9O1xuXG5cdC8vcmV0dXJuIGZpZWxkIG5hbWVcblxuXHRDb2x1bW4ucHJvdG90eXBlLmdldEZpZWxkID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuZmllbGQ7XG5cdH07XG5cblx0Ly9yZXR1cm4gdGhlIGZpcnN0IGNvbHVtbiBpbiBhIGdyb3VwXG5cblx0Q29sdW1uLnByb3RvdHlwZS5nZXRGaXJzdENvbHVtbiA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICghdGhpcy5pc0dyb3VwKSB7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmICh0aGlzLmNvbHVtbnMubGVuZ3RoKSB7XG5cblx0XHRcdFx0cmV0dXJuIHRoaXMuY29sdW1uc1swXS5nZXRGaXJzdENvbHVtbigpO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdC8vcmV0dXJuIHRoZSBsYXN0IGNvbHVtbiBpbiBhIGdyb3VwXG5cblx0Q29sdW1uLnByb3RvdHlwZS5nZXRMYXN0Q29sdW1uID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKCF0aGlzLmlzR3JvdXApIHtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKHRoaXMuY29sdW1ucy5sZW5ndGgpIHtcblxuXHRcdFx0XHRyZXR1cm4gdGhpcy5jb2x1bW5zW3RoaXMuY29sdW1ucy5sZW5ndGggLSAxXS5nZXRMYXN0Q29sdW1uKCk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Ly9yZXR1cm4gYWxsIGNvbHVtbnMgaW4gYSBncm91cFxuXG5cdENvbHVtbi5wcm90b3R5cGUuZ2V0Q29sdW1ucyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLmNvbHVtbnM7XG5cdH07XG5cblx0Ly9yZXR1cm4gYWxsIGNvbHVtbnMgaW4gYSBncm91cFxuXG5cdENvbHVtbi5wcm90b3R5cGUuZ2V0Q2VsbHMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5jZWxscztcblx0fTtcblxuXHQvL3JldHJlaXZlIHRoZSB0b3AgY29sdW1uIGluIGEgZ3JvdXAgb2YgY29sdW1uc1xuXG5cdENvbHVtbi5wcm90b3R5cGUuZ2V0VG9wQ29sdW1uID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMucGFyZW50LmlzR3JvdXApIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMucGFyZW50LmdldFRvcENvbHVtbigpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblx0fTtcblxuXHQvL3JldHVybiBjb2x1bW4gZGVmaW5pdGlvbiBvYmplY3RcblxuXHRDb2x1bW4ucHJvdG90eXBlLmdldERlZmluaXRpb24gPSBmdW5jdGlvbiAodXBkYXRlQnJhbmNoZXMpIHtcblxuXHRcdHZhciBjb2xEZWZzID0gW107XG5cblx0XHRpZiAodGhpcy5pc0dyb3VwICYmIHVwZGF0ZUJyYW5jaGVzKSB7XG5cblx0XHRcdHRoaXMuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0XHRjb2xEZWZzLnB1c2goY29sdW1uLmdldERlZmluaXRpb24odHJ1ZSkpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMuZGVmaW5pdGlvbi5jb2x1bW5zID0gY29sRGVmcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcy5kZWZpbml0aW9uO1xuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vIEFjdGlvbnMgLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuXG5cdENvbHVtbi5wcm90b3R5cGUuY2hlY2tDb2x1bW5WaXNpYmlsaXR5ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIHZpc2libGUgPSBmYWxzZTtcblxuXHRcdHRoaXMuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0aWYgKGNvbHVtbi52aXNpYmxlKSB7XG5cblx0XHRcdFx0dmlzaWJsZSA9IHRydWU7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRpZiAodmlzaWJsZSkge1xuXG5cdFx0XHR0aGlzLnNob3coKTtcblxuXHRcdFx0dGhpcy5wYXJlbnQudGFibGUub3B0aW9ucy5jb2x1bW5WaXNpYmlsaXR5Q2hhbmdlZC5jYWxsKHRoaXMudGFibGUsIHRoaXMuZ2V0Q29tcG9uZW50KCksIGZhbHNlKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHR0aGlzLmhpZGUoKTtcblx0XHR9XG5cdH07XG5cblx0Ly9zaG93IGNvbHVtblxuXG5cdENvbHVtbi5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uIChzaWxlbnQsIHJlc3BvbnNpdmVUb2dnbGUpIHtcblxuXHRcdGlmICghdGhpcy52aXNpYmxlKSB7XG5cblx0XHRcdHRoaXMudmlzaWJsZSA9IHRydWU7XG5cblx0XHRcdHRoaXMuZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcblxuXHRcdFx0aWYgKHRoaXMucGFyZW50LmlzR3JvdXApIHtcblxuXHRcdFx0XHR0aGlzLnBhcmVudC5jaGVja0NvbHVtblZpc2liaWxpdHkoKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5jZWxscy5mb3JFYWNoKGZ1bmN0aW9uIChjZWxsKSB7XG5cblx0XHRcdFx0Y2VsbC5zaG93KCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKCF0aGlzLmlzR3JvdXAgJiYgdGhpcy53aWR0aCA9PT0gbnVsbCkge1xuXG5cdFx0XHRcdHRoaXMucmVpbml0aWFsaXplV2lkdGgoKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLl92ZXJ0aWNhbEFsaWduSGVhZGVycygpO1xuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwicGVyc2lzdGVuY2VcIiwgdHJ1ZSkgJiYgdGhpcy50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLmNvbmZpZy5jb2x1bW5zKSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLnNhdmUoXCJjb2x1bW5zXCIpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXJlc3BvbnNpdmVUb2dnbGUgJiYgdGhpcy50YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXQgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJyZXNwb25zaXZlTGF5b3V0XCIsIHRydWUpKSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQudXBkYXRlQ29sdW1uVmlzaWJpbGl0eSh0aGlzLCB0aGlzLnZpc2libGUpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXNpbGVudCkge1xuXG5cdFx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5jb2x1bW5WaXNpYmlsaXR5Q2hhbmdlZC5jYWxsKHRoaXMudGFibGUsIHRoaXMuZ2V0Q29tcG9uZW50KCksIHRydWUpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGhpcy5wYXJlbnQuaXNHcm91cCkge1xuXG5cdFx0XHRcdHRoaXMucGFyZW50Lm1hdGNoQ2hpbGRXaWR0aHMoKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Ly9oaWRlIGNvbHVtblxuXG5cdENvbHVtbi5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uIChzaWxlbnQsIHJlc3BvbnNpdmVUb2dnbGUpIHtcblxuXHRcdGlmICh0aGlzLnZpc2libGUpIHtcblxuXHRcdFx0dGhpcy52aXNpYmxlID0gZmFsc2U7XG5cblx0XHRcdHRoaXMuZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cblx0XHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5fdmVydGljYWxBbGlnbkhlYWRlcnMoKTtcblxuXHRcdFx0aWYgKHRoaXMucGFyZW50LmlzR3JvdXApIHtcblxuXHRcdFx0XHR0aGlzLnBhcmVudC5jaGVja0NvbHVtblZpc2liaWxpdHkoKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5jZWxscy5mb3JFYWNoKGZ1bmN0aW9uIChjZWxsKSB7XG5cblx0XHRcdFx0Y2VsbC5oaWRlKCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInBlcnNpc3RlbmNlXCIsIHRydWUpICYmIHRoaXMudGFibGUubW9kdWxlcy5wZXJzaXN0ZW5jZS5jb25maWcuY29sdW1ucykge1xuXG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5wZXJzaXN0ZW5jZS5zYXZlKFwiY29sdW1uc1wiKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFyZXNwb25zaXZlVG9nZ2xlICYmIHRoaXMudGFibGUub3B0aW9ucy5yZXNwb25zaXZlTGF5b3V0ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwicmVzcG9uc2l2ZUxheW91dFwiLCB0cnVlKSkge1xuXG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5yZXNwb25zaXZlTGF5b3V0LnVwZGF0ZUNvbHVtblZpc2liaWxpdHkodGhpcywgdGhpcy52aXNpYmxlKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFzaWxlbnQpIHtcblxuXHRcdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1uVmlzaWJpbGl0eUNoYW5nZWQuY2FsbCh0aGlzLnRhYmxlLCB0aGlzLmdldENvbXBvbmVudCgpLCBmYWxzZSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLnBhcmVudC5pc0dyb3VwKSB7XG5cblx0XHRcdFx0dGhpcy5wYXJlbnQubWF0Y2hDaGlsZFdpZHRocygpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRDb2x1bW4ucHJvdG90eXBlLm1hdGNoQ2hpbGRXaWR0aHMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgY2hpbGRXaWR0aCA9IDA7XG5cblx0XHRpZiAodGhpcy5jb250ZW50RWxlbWVudCAmJiB0aGlzLmNvbHVtbnMubGVuZ3RoKSB7XG5cblx0XHRcdHRoaXMuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0XHRpZiAoY29sdW1uLnZpc2libGUpIHtcblxuXHRcdFx0XHRcdGNoaWxkV2lkdGggKz0gY29sdW1uLmdldFdpZHRoKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLmNvbnRlbnRFbGVtZW50LnN0eWxlLm1heFdpZHRoID0gY2hpbGRXaWR0aCAtIDEgKyBcInB4XCI7XG5cblx0XHRcdGlmICh0aGlzLnBhcmVudC5pc0dyb3VwKSB7XG5cblx0XHRcdFx0dGhpcy5wYXJlbnQubWF0Y2hDaGlsZFdpZHRocygpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRDb2x1bW4ucHJvdG90eXBlLnNldFdpZHRoID0gZnVuY3Rpb24gKHdpZHRoKSB7XG5cblx0XHR0aGlzLndpZHRoRml4ZWQgPSB0cnVlO1xuXG5cdFx0dGhpcy5zZXRXaWR0aEFjdHVhbCh3aWR0aCk7XG5cdH07XG5cblx0Q29sdW1uLnByb3RvdHlwZS5zZXRXaWR0aEFjdHVhbCA9IGZ1bmN0aW9uICh3aWR0aCkge1xuXG5cdFx0aWYgKGlzTmFOKHdpZHRoKSkge1xuXG5cdFx0XHR3aWR0aCA9IE1hdGguZmxvb3IodGhpcy50YWJsZS5lbGVtZW50LmNsaWVudFdpZHRoIC8gMTAwICogcGFyc2VJbnQod2lkdGgpKTtcblx0XHR9XG5cblx0XHR3aWR0aCA9IE1hdGgubWF4KHRoaXMubWluV2lkdGgsIHdpZHRoKTtcblxuXHRcdHRoaXMud2lkdGggPSB3aWR0aDtcblxuXHRcdHRoaXMud2lkdGhTdHlsZWQgPSB3aWR0aCA/IHdpZHRoICsgXCJweFwiIDogXCJcIjtcblxuXHRcdHRoaXMuZWxlbWVudC5zdHlsZS53aWR0aCA9IHRoaXMud2lkdGhTdHlsZWQ7XG5cblx0XHRpZiAoIXRoaXMuaXNHcm91cCkge1xuXG5cdFx0XHR0aGlzLmNlbGxzLmZvckVhY2goZnVuY3Rpb24gKGNlbGwpIHtcblxuXHRcdFx0XHRjZWxsLnNldFdpZHRoKCk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5wYXJlbnQuaXNHcm91cCkge1xuXG5cdFx0XHR0aGlzLnBhcmVudC5tYXRjaENoaWxkV2lkdGhzKCk7XG5cdFx0fVxuXG5cdFx0Ly9zZXQgcmVzaXphYmxlIGhhbmRsZXNcblxuXHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImZyb3plbkNvbHVtbnNcIikpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmZyb3plbkNvbHVtbnMubGF5b3V0KCk7XG5cdFx0fVxuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuY2hlY2tDZWxsSGVpZ2h0cyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciByb3dzID0gW107XG5cblx0XHR0aGlzLmNlbGxzLmZvckVhY2goZnVuY3Rpb24gKGNlbGwpIHtcblxuXHRcdFx0aWYgKGNlbGwucm93LmhlaWdodEluaXRpYWxpemVkKSB7XG5cblx0XHRcdFx0aWYgKGNlbGwucm93LmdldEVsZW1lbnQoKS5vZmZzZXRQYXJlbnQgIT09IG51bGwpIHtcblxuXHRcdFx0XHRcdHJvd3MucHVzaChjZWxsLnJvdyk7XG5cblx0XHRcdFx0XHRjZWxsLnJvdy5jbGVhckNlbGxIZWlnaHQoKTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdGNlbGwucm93LmhlaWdodEluaXRpYWxpemVkID0gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cblx0XHRcdHJvdy5jYWxjSGVpZ2h0KCk7XG5cdFx0fSk7XG5cblx0XHRyb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXG5cdFx0XHRyb3cuc2V0Q2VsbEhlaWdodCgpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuZ2V0V2lkdGggPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgd2lkdGggPSAwO1xuXG5cdFx0aWYgKHRoaXMuaXNHcm91cCkge1xuXG5cdFx0XHR0aGlzLmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdFx0aWYgKGNvbHVtbi52aXNpYmxlKSB7XG5cblx0XHRcdFx0XHR3aWR0aCArPSBjb2x1bW4uZ2V0V2lkdGgoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0d2lkdGggPSB0aGlzLndpZHRoO1xuXHRcdH1cblxuXHRcdHJldHVybiB3aWR0aDtcblx0fTtcblxuXHRDb2x1bW4ucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLmVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuc2V0TWluV2lkdGggPSBmdW5jdGlvbiAobWluV2lkdGgpIHtcblxuXHRcdHRoaXMubWluV2lkdGggPSBtaW5XaWR0aDtcblxuXHRcdHRoaXMubWluV2lkdGhTdHlsZWQgPSBtaW5XaWR0aCA/IG1pbldpZHRoICsgXCJweFwiIDogXCJcIjtcblxuXHRcdHRoaXMuZWxlbWVudC5zdHlsZS5taW5XaWR0aCA9IHRoaXMubWluV2lkdGhTdHlsZWQ7XG5cblx0XHR0aGlzLmNlbGxzLmZvckVhY2goZnVuY3Rpb24gKGNlbGwpIHtcblxuXHRcdFx0Y2VsbC5zZXRNaW5XaWR0aCgpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuZGVsZXRlID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBfdGhpczcgPSB0aGlzO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdFx0aWYgKF90aGlzNy5pc0dyb3VwKSB7XG5cblx0XHRcdFx0X3RoaXM3LmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdFx0XHRjb2x1bW4uZGVsZXRlKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2NhbmNlbCBlZGl0IGlmIGNvbHVtbiBpcyBjdXJyZW50bHkgYmVpbmcgZWRpdGVkXG5cblx0XHRcdGlmIChfdGhpczcudGFibGUubW9kRXhpc3RzKFwiZWRpdFwiKSkge1xuXG5cdFx0XHRcdGlmIChfdGhpczcudGFibGUubW9kdWxlcy5lZGl0LmN1cnJlbnRDZWxsLmNvbHVtbiA9PT0gX3RoaXM3KSB7XG5cblx0XHRcdFx0XHRfdGhpczcudGFibGUubW9kdWxlcy5lZGl0LmNhbmNlbEVkaXQoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHR2YXIgY2VsbENvdW50ID0gX3RoaXM3LmNlbGxzLmxlbmd0aDtcblxuXHRcdFx0Zm9yICh2YXIgX2kzID0gMDsgX2kzIDwgY2VsbENvdW50OyBfaTMrKykge1xuXG5cdFx0XHRcdF90aGlzNy5jZWxsc1swXS5kZWxldGUoKTtcblx0XHRcdH1cblxuXHRcdFx0X3RoaXM3LmVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChfdGhpczcuZWxlbWVudCk7XG5cblx0XHRcdF90aGlzNy50YWJsZS5jb2x1bW5NYW5hZ2VyLmRlcmVnaXN0ZXJDb2x1bW4oX3RoaXM3KTtcblxuXHRcdFx0cmVzb2x2ZSgpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuY29sdW1uUmVuZGVyZWQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy50aXRsZUZvcm1hdHRlclJlbmRlcmVkKSB7XG5cblx0XHRcdHRoaXMudGl0bGVGb3JtYXR0ZXJSZW5kZXJlZCgpO1xuXHRcdH1cblx0fTtcblxuXHRDb2x1bW4ucHJvdG90eXBlLnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGludmFsaWQgPSBbXTtcblxuXHRcdHRoaXMuY2VsbHMuZm9yRWFjaChmdW5jdGlvbiAoY2VsbCkge1xuXG5cdFx0XHRpZiAoIWNlbGwudmFsaWRhdGUoKSkge1xuXG5cdFx0XHRcdGludmFsaWQucHVzaChjZWxsLmdldENvbXBvbmVudCgpKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiBpbnZhbGlkLmxlbmd0aCA/IGludmFsaWQgOiB0cnVlO1xuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8gQ2VsbCBNYW5hZ2VtZW50IC8vLy8vLy8vLy8vLy8vLy8vXG5cblxuXHQvL2dlbmVyYXRlIGNlbGwgZm9yIHRoaXMgY29sdW1uXG5cblx0Q29sdW1uLnByb3RvdHlwZS5nZW5lcmF0ZUNlbGwgPSBmdW5jdGlvbiAocm93KSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHR2YXIgY2VsbCA9IG5ldyBDZWxsKHNlbGYsIHJvdyk7XG5cblx0XHR0aGlzLmNlbGxzLnB1c2goY2VsbCk7XG5cblx0XHRyZXR1cm4gY2VsbDtcblx0fTtcblxuXHRDb2x1bW4ucHJvdG90eXBlLm5leHRDb2x1bW4gPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgaW5kZXggPSB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZmluZENvbHVtbkluZGV4KHRoaXMpO1xuXG5cdFx0cmV0dXJuIGluZGV4ID4gLTEgPyB0aGlzLl9uZXh0VmlzaWJsZUNvbHVtbihpbmRleCArIDEpIDogZmFsc2U7XG5cdH07XG5cblx0Q29sdW1uLnByb3RvdHlwZS5fbmV4dFZpc2libGVDb2x1bW4gPSBmdW5jdGlvbiAoaW5kZXgpIHtcblxuXHRcdHZhciBjb2x1bW4gPSB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0Q29sdW1uQnlJbmRleChpbmRleCk7XG5cblx0XHRyZXR1cm4gIWNvbHVtbiB8fCBjb2x1bW4udmlzaWJsZSA/IGNvbHVtbiA6IHRoaXMuX25leHRWaXNpYmxlQ29sdW1uKGluZGV4ICsgMSk7XG5cdH07XG5cblx0Q29sdW1uLnByb3RvdHlwZS5wcmV2Q29sdW1uID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGluZGV4ID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW5JbmRleCh0aGlzKTtcblxuXHRcdHJldHVybiBpbmRleCA+IC0xID8gdGhpcy5fcHJldlZpc2libGVDb2x1bW4oaW5kZXggLSAxKSA6IGZhbHNlO1xuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuX3ByZXZWaXNpYmxlQ29sdW1uID0gZnVuY3Rpb24gKGluZGV4KSB7XG5cblx0XHR2YXIgY29sdW1uID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldENvbHVtbkJ5SW5kZXgoaW5kZXgpO1xuXG5cdFx0cmV0dXJuICFjb2x1bW4gfHwgY29sdW1uLnZpc2libGUgPyBjb2x1bW4gOiB0aGlzLl9wcmV2VmlzaWJsZUNvbHVtbihpbmRleCAtIDEpO1xuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUucmVpbml0aWFsaXplV2lkdGggPSBmdW5jdGlvbiAoZm9yY2UpIHtcblxuXHRcdHRoaXMud2lkdGhGaXhlZCA9IGZhbHNlO1xuXG5cdFx0Ly9zZXQgd2lkdGggaWYgcHJlc2VudFxuXG5cdFx0aWYgKHR5cGVvZiB0aGlzLmRlZmluaXRpb24ud2lkdGggIT09IFwidW5kZWZpbmVkXCIgJiYgIWZvcmNlKSB7XG5cblx0XHRcdHRoaXMuc2V0V2lkdGgodGhpcy5kZWZpbml0aW9uLndpZHRoKTtcblx0XHR9XG5cblx0XHQvL2hpZGUgaGVhZGVyIGZpbHRlcnMgdG8gcHJldmVudCB0aGVtIGFsdGVyaW5nIGNvbHVtbiB3aWR0aFxuXG5cdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwiZmlsdGVyXCIpKSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5maWx0ZXIuaGlkZUhlYWRlckZpbHRlckVsZW1lbnRzKCk7XG5cdFx0fVxuXG5cdFx0dGhpcy5maXRUb0RhdGEoKTtcblxuXHRcdC8vc2hvdyBoZWFkZXIgZmlsdGVycyBhZ2FpbiBhZnRlciBsYXlvdXQgaXMgY29tcGxldGVcblxuXHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImZpbHRlclwiKSkge1xuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZmlsdGVyLnNob3dIZWFkZXJGaWx0ZXJFbGVtZW50cygpO1xuXHRcdH1cblx0fTtcblxuXHQvL3NldCBjb2x1bW4gd2lkdGggdG8gbWF4aW11bSBjZWxsIHdpZHRoXG5cblx0Q29sdW1uLnByb3RvdHlwZS5maXRUb0RhdGEgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRpZiAoIXRoaXMud2lkdGhGaXhlZCkge1xuXG5cdFx0XHR0aGlzLmVsZW1lbnQuc3R5bGUud2lkdGggPSBcIlwiO1xuXG5cdFx0XHRzZWxmLmNlbGxzLmZvckVhY2goZnVuY3Rpb24gKGNlbGwpIHtcblxuXHRcdFx0XHRjZWxsLmNsZWFyV2lkdGgoKTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHZhciBtYXhXaWR0aCA9IHRoaXMuZWxlbWVudC5vZmZzZXRXaWR0aDtcblxuXHRcdGlmICghc2VsZi53aWR0aCB8fCAhdGhpcy53aWR0aEZpeGVkKSB7XG5cblx0XHRcdHNlbGYuY2VsbHMuZm9yRWFjaChmdW5jdGlvbiAoY2VsbCkge1xuXG5cdFx0XHRcdHZhciB3aWR0aCA9IGNlbGwuZ2V0V2lkdGgoKTtcblxuXHRcdFx0XHRpZiAod2lkdGggPiBtYXhXaWR0aCkge1xuXG5cdFx0XHRcdFx0bWF4V2lkdGggPSB3aWR0aDtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChtYXhXaWR0aCkge1xuXG5cdFx0XHRcdHNlbGYuc2V0V2lkdGhBY3R1YWwobWF4V2lkdGggKyAxKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Q29sdW1uLnByb3RvdHlwZS51cGRhdGVEZWZpbml0aW9uID0gZnVuY3Rpb24gKHVwZGF0ZXMpIHtcblx0XHR2YXIgX3RoaXM4ID0gdGhpcztcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cblx0XHRcdHZhciBkZWZpbml0aW9uO1xuXG5cdFx0XHRpZiAoIV90aGlzOC5pc0dyb3VwKSB7XG5cblx0XHRcdFx0ZGVmaW5pdGlvbiA9IE9iamVjdC5hc3NpZ24oe30sIF90aGlzOC5nZXREZWZpbml0aW9uKCkpO1xuXG5cdFx0XHRcdGRlZmluaXRpb24gPSBPYmplY3QuYXNzaWduKGRlZmluaXRpb24sIHVwZGF0ZXMpO1xuXG5cdFx0XHRcdF90aGlzOC50YWJsZS5jb2x1bW5NYW5hZ2VyLmFkZENvbHVtbihkZWZpbml0aW9uLCBmYWxzZSwgX3RoaXM4KS50aGVuKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0XHRcdGlmIChkZWZpbml0aW9uLmZpZWxkID09IF90aGlzOC5maWVsZCkge1xuXG5cdFx0XHRcdFx0XHRfdGhpczguZmllbGQgPSBmYWxzZTsgLy9jbGVhaXIgZmllbGQgbmFtZSB0byBwcmV2ZW50IGRlbGV0aW9uIG9mIGR1cGxpY2F0ZSBjb2x1bW4gZnJvbSBhcnJheXNcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRfdGhpczguZGVsZXRlKCkudGhlbihmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHRcdHJlc29sdmUoY29sdW1uLmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0XHR9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG5cblx0XHRcdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG5cblx0XHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkNvbHVtbiBVcGRhdGUgRXJyb3IgLSBUaGUgdXBkYXRlRGVmaW50aW9uIGZ1bmN0aW9uIGlzIG9ubHkgYXZhaWxhYmxlIG9uIGNvbHVtbnMsIG5vdCBjb2x1bW4gZ3JvdXBzXCIpO1xuXG5cdFx0XHRcdHJlamVjdChcIkNvbHVtbiBVcGRhdGUgRXJyb3IgLSBUaGUgdXBkYXRlRGVmaW50aW9uIGZ1bmN0aW9uIGlzIG9ubHkgYXZhaWxhYmxlIG9uIGNvbHVtbnMsIG5vdCBjb2x1bW4gZ3JvdXBzXCIpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuZGVsZXRlQ2VsbCA9IGZ1bmN0aW9uIChjZWxsKSB7XG5cblx0XHR2YXIgaW5kZXggPSB0aGlzLmNlbGxzLmluZGV4T2YoY2VsbCk7XG5cblx0XHRpZiAoaW5kZXggPiAtMSkge1xuXG5cdFx0XHR0aGlzLmNlbGxzLnNwbGljZShpbmRleCwgMSk7XG5cdFx0fVxuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuZGVmYXVsdE9wdGlvbkxpc3QgPSBbXCJ0aXRsZVwiLCBcImZpZWxkXCIsIFwiY29sdW1uc1wiLCBcInZpc2libGVcIiwgXCJhbGlnblwiLCBcImhvekFsaWduXCIsIFwidmVydEFsaWduXCIsIFwid2lkdGhcIiwgXCJtaW5XaWR0aFwiLCBcIndpZHRoR3Jvd1wiLCBcIndpZHRoU2hyaW5rXCIsIFwicmVzaXphYmxlXCIsIFwiZnJvemVuXCIsIFwicmVzcG9uc2l2ZVwiLCBcInRvb2x0aXBcIiwgXCJjc3NDbGFzc1wiLCBcInJvd0hhbmRsZVwiLCBcImhpZGVJbkh0bWxcIiwgXCJwcmludFwiLCBcImh0bWxPdXRwdXRcIiwgXCJzb3J0ZXJcIiwgXCJzb3J0ZXJQYXJhbXNcIiwgXCJmb3JtYXR0ZXJcIiwgXCJmb3JtYXR0ZXJQYXJhbXNcIiwgXCJ2YXJpYWJsZUhlaWdodFwiLCBcImVkaXRhYmxlXCIsIFwiZWRpdG9yXCIsIFwiZWRpdG9yUGFyYW1zXCIsIFwidmFsaWRhdG9yXCIsIFwibXV0YXRvclwiLCBcIm11dGF0b3JQYXJhbXNcIiwgXCJtdXRhdG9yRGF0YVwiLCBcIm11dGF0b3JEYXRhUGFyYW1zXCIsIFwibXV0YXRvckVkaXRcIiwgXCJtdXRhdG9yRWRpdFBhcmFtc1wiLCBcIm11dGF0b3JDbGlwYm9hcmRcIiwgXCJtdXRhdG9yQ2xpcGJvYXJkUGFyYW1zXCIsIFwiYWNjZXNzb3JcIiwgXCJhY2Nlc3NvclBhcmFtc1wiLCBcImFjY2Vzc29yRGF0YVwiLCBcImFjY2Vzc29yRGF0YVBhcmFtc1wiLCBcImFjY2Vzc29yRG93bmxvYWRcIiwgXCJhY2Nlc3NvckRvd25sb2FkUGFyYW1zXCIsIFwiYWNjZXNzb3JDbGlwYm9hcmRcIiwgXCJhY2Nlc3NvckNsaXBib2FyZFBhcmFtc1wiLCBcImFjY2Vzc29yUHJpbnRcIiwgXCJhY2Nlc3NvclByaW50UGFyYW1zXCIsIFwiYWNjZXNzb3JIdG1sT3V0cHV0XCIsIFwiYWNjZXNzb3JIdG1sT3V0cHV0UGFyYW1zXCIsIFwiY2xpcGJvYXJkXCIsIFwiZG93bmxvYWRcIiwgXCJkb3dubG9hZFRpdGxlXCIsIFwidG9wQ2FsY1wiLCBcInRvcENhbGNQYXJhbXNcIiwgXCJ0b3BDYWxjRm9ybWF0dGVyXCIsIFwidG9wQ2FsY0Zvcm1hdHRlclBhcmFtc1wiLCBcImJvdHRvbUNhbGNcIiwgXCJib3R0b21DYWxjUGFyYW1zXCIsIFwiYm90dG9tQ2FsY0Zvcm1hdHRlclwiLCBcImJvdHRvbUNhbGNGb3JtYXR0ZXJQYXJhbXNcIiwgXCJjZWxsQ2xpY2tcIiwgXCJjZWxsRGJsQ2xpY2tcIiwgXCJjZWxsQ29udGV4dFwiLCBcImNlbGxUYXBcIiwgXCJjZWxsRGJsVGFwXCIsIFwiY2VsbFRhcEhvbGRcIiwgXCJjZWxsTW91c2VFbnRlclwiLCBcImNlbGxNb3VzZUxlYXZlXCIsIFwiY2VsbE1vdXNlT3ZlclwiLCBcImNlbGxNb3VzZU91dFwiLCBcImNlbGxNb3VzZU1vdmVcIiwgXCJjZWxsRWRpdGluZ1wiLCBcImNlbGxFZGl0ZWRcIiwgXCJjZWxsRWRpdENhbmNlbGxlZFwiLCBcImhlYWRlclNvcnRcIiwgXCJoZWFkZXJTb3J0U3RhcnRpbmdEaXJcIiwgXCJoZWFkZXJTb3J0VHJpc3RhdGVcIiwgXCJoZWFkZXJDbGlja1wiLCBcImhlYWRlckRibENsaWNrXCIsIFwiaGVhZGVyQ29udGV4dFwiLCBcImhlYWRlclRhcFwiLCBcImhlYWRlckRibFRhcFwiLCBcImhlYWRlclRhcEhvbGRcIiwgXCJoZWFkZXJUb29sdGlwXCIsIFwiaGVhZGVyVmVydGljYWxcIiwgXCJlZGl0YWJsZVRpdGxlXCIsIFwidGl0bGVGb3JtYXR0ZXJcIiwgXCJ0aXRsZUZvcm1hdHRlclBhcmFtc1wiLCBcImhlYWRlckZpbHRlclwiLCBcImhlYWRlckZpbHRlclBsYWNlaG9sZGVyXCIsIFwiaGVhZGVyRmlsdGVyUGFyYW1zXCIsIFwiaGVhZGVyRmlsdGVyRW1wdHlDaGVja1wiLCBcImhlYWRlckZpbHRlckZ1bmNcIiwgXCJoZWFkZXJGaWx0ZXJGdW5jUGFyYW1zXCIsIFwiaGVhZGVyRmlsdGVyTGl2ZUZpbHRlclwiLCBcInByaW50XCIsIFwiaGVhZGVyQ29udGV4dE1lbnVcIiwgXCJoZWFkZXJNZW51XCIsIFwiY29udGV4dE1lbnVcIiwgXCJmb3JtYXR0ZXJQcmludFwiLCBcImZvcm1hdHRlclByaW50UGFyYW1zXCIsIFwiZm9ybWF0dGVyQ2xpcGJvYXJkXCIsIFwiZm9ybWF0dGVyQ2xpcGJvYXJkUGFyYW1zXCIsIFwiZm9ybWF0dGVySHRtbE91dHB1dFwiLCBcImZvcm1hdHRlckh0bWxPdXRwdXRQYXJhbXNcIiwgXCJ0aXRsZVByaW50XCIsIFwidGl0bGVDbGlwYm9hcmRcIiwgXCJ0aXRsZUh0bWxPdXRwdXRcIiwgXCJ0aXRsZURvd25sb2FkXCJdO1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8gRXZlbnQgQmluZGluZ3MgLy8vLy8vLy8vLy8vLy8vLy9cblxuXG5cdC8vLy8vLy8vLy8vLy8vLy8gT2JqZWN0IEdlbmVyYXRpb24gLy8vLy8vLy8vLy8vLy8vLy9cblxuXHRDb2x1bW4ucHJvdG90eXBlLmdldENvbXBvbmVudCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICghdGhpcy5jb21wb25lbnQpIHtcblxuXHRcdFx0dGhpcy5jb21wb25lbnQgPSBuZXcgQ29sdW1uQ29tcG9uZW50KHRoaXMpO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzLmNvbXBvbmVudDtcblx0fTtcblxuXHR2YXIgUm93TWFuYWdlciA9IGZ1bmN0aW9uIFJvd01hbmFnZXIodGFibGUpIHtcblxuXHRcdHRoaXMudGFibGUgPSB0YWJsZTtcblxuXHRcdHRoaXMuZWxlbWVudCA9IHRoaXMuY3JlYXRlSG9sZGVyRWxlbWVudCgpOyAvL2NvbnRhaW5pbmcgZWxlbWVudFxuXG5cdFx0dGhpcy50YWJsZUVsZW1lbnQgPSB0aGlzLmNyZWF0ZVRhYmxlRWxlbWVudCgpOyAvL3RhYmxlIGVsZW1lbnRcblxuXHRcdHRoaXMuaGVpZ2h0Rml4ZXIgPSB0aGlzLmNyZWF0ZVRhYmxlRWxlbWVudCgpOyAvL3RhYmxlIGVsZW1lbnRcblxuXHRcdHRoaXMuY29sdW1uTWFuYWdlciA9IG51bGw7IC8vaG9sZCBjb2x1bW4gbWFuYWdlciBvYmplY3RcblxuXHRcdHRoaXMuaGVpZ2h0ID0gMDsgLy9ob2xkIGhlaWdodCBvZiB0YWJsZSBlbGVtZW50XG5cblxuXHRcdHRoaXMuZmlyc3RSZW5kZXIgPSBmYWxzZTsgLy9oYW5kbGUgZmlyc3QgcmVuZGVyXG5cblx0XHR0aGlzLnJlbmRlck1vZGUgPSBcInZpcnR1YWxcIjsgLy9jdXJyZW50IHJlbmRlcmluZyBtb2RlXG5cblx0XHR0aGlzLmZpeGVkSGVpZ2h0ID0gZmFsc2U7IC8vY3VycmVudCByZW5kZXJpbmcgbW9kZVxuXG5cblx0XHR0aGlzLnJvd3MgPSBbXTsgLy9ob2xkIHJvdyBkYXRhIG9iamVjdHNcblxuXHRcdHRoaXMuYWN0aXZlUm93cyA9IFtdOyAvL3Jvd3MgY3VycmVudGx5IGF2YWlsYWJsZSB0byBvbiBkaXNwbGF5IGluIHRoZSB0YWJsZVxuXG5cdFx0dGhpcy5hY3RpdmVSb3dzQ291bnQgPSAwOyAvL2NvdW50IG9mIGFjdGl2ZSByb3dzXG5cblxuXHRcdHRoaXMuZGlzcGxheVJvd3MgPSBbXTsgLy9yb3dzIGN1cnJlbnRseSBvbiBkaXNwbGF5IGluIHRoZSB0YWJsZVxuXG5cdFx0dGhpcy5kaXNwbGF5Um93c0NvdW50ID0gMDsgLy9jb3VudCBvZiBkaXNwbGF5IHJvd3NcblxuXG5cdFx0dGhpcy5zY3JvbGxUb3AgPSAwO1xuXG5cdFx0dGhpcy5zY3JvbGxMZWZ0ID0gMDtcblxuXHRcdHRoaXMudkRvbVJvd0hlaWdodCA9IDIwOyAvL2FwcHJveGltYXRpb24gb2Ygcm93IGhlaWdodHMgZm9yIHBhZGRpbmdcblxuXG5cdFx0dGhpcy52RG9tVG9wID0gMDsgLy9ob2xkIHBvc2l0aW9uIGZvciBmaXJzdCByZW5kZXJlZCByb3cgaW4gdGhlIHZpcnR1YWwgRE9NXG5cblx0XHR0aGlzLnZEb21Cb3R0b20gPSAwOyAvL2hvbGQgcG9zc2l0aW9uIGZvciBsYXN0IHJlbmRlcmVkIHJvdyBpbiB0aGUgdmlydHVhbCBET01cblxuXG5cdFx0dGhpcy52RG9tU2Nyb2xsUG9zVG9wID0gMDsgLy9sYXN0IHNjcm9sbCBwb3NpdGlvbiBvZiB0aGUgdkRvbSB0b3A7XG5cblx0XHR0aGlzLnZEb21TY3JvbGxQb3NCb3R0b20gPSAwOyAvL2xhc3Qgc2Nyb2xsIHBvc2l0aW9uIG9mIHRoZSB2RG9tIGJvdHRvbTtcblxuXG5cdFx0dGhpcy52RG9tVG9wUGFkID0gMDsgLy9ob2xkIHZhbHVlIG9mIHBhZGRpbmcgZm9yIHRvcCBvZiB2aXJ0dWFsIERPTVxuXG5cdFx0dGhpcy52RG9tQm90dG9tUGFkID0gMDsgLy9ob2xkIHZhbHVlIG9mIHBhZGRpbmcgZm9yIGJvdHRvbSBvZiB2aXJ0dWFsIERPTVxuXG5cblx0XHR0aGlzLnZEb21NYXhSZW5kZXJDaGFpbiA9IDkwOyAvL3RoZSBtYXhpbXVtIG51bWJlciBvZiBkb20gZWxlbWVudHMgdGhhdCBjYW4gYmUgcmVuZGVyZWQgaW4gMSBnb1xuXG5cblx0XHR0aGlzLnZEb21XaW5kb3dCdWZmZXIgPSAwOyAvL3dpbmRvdyByb3cgYnVmZmVyIGJlZm9yZSByZW1vdmluZyBlbGVtZW50cywgdG8gc21vb3RoIHNjcm9sbGluZ1xuXG5cblx0XHR0aGlzLnZEb21XaW5kb3dNaW5Ub3RhbFJvd3MgPSAyMDsgLy9taW5pbXVtIG51bWJlciBvZiByb3dzIHRvIGJlIGdlbmVyYXRlZCBpbiB2aXJ0dWFsIGRvbSAocHJldmVudCBidWZmZXJpbmcgaXNzdWVzIG9uIHRhYmxlcyB3aXRoIHRhbGwgcm93cylcblxuXHRcdHRoaXMudkRvbVdpbmRvd01pbk1hcmdpblJvd3MgPSA1OyAvL21pbmltdW0gbnVtYmVyIG9mIHJvd3MgdG8gYmUgZ2VuZXJhdGVkIGluIHZpcnR1YWwgZG9tIG1hcmdpblxuXG5cblx0XHR0aGlzLnZEb21Ub3BOZXdSb3dzID0gW107IC8vcm93cyB0byBub3JtYWxpemUgYWZ0ZXIgYXBwZW5kaW5nIHRvIG9wdGltaXplIHJlbmRlciBzcGVlZFxuXG5cdFx0dGhpcy52RG9tQm90dG9tTmV3Um93cyA9IFtdOyAvL3Jvd3MgdG8gbm9ybWFsaXplIGFmdGVyIGFwcGVuZGluZyB0byBvcHRpbWl6ZSByZW5kZXIgc3BlZWRcblxuXG5cdFx0dGhpcy5yb3dOdW1Db2x1bW4gPSBmYWxzZTsgLy9ob2xkIGNvbHVtbiBjb21wb25lbnQgZm9yIHJvdyBudW1iZXIgY29sdW1uXG5cblxuXHRcdHRoaXMucmVkcmF3QmxvY2sgPSBmYWxzZTsgLy9wcmV2ZW50IHJlZHJhd3MgdG8gYWxsb3cgbXVsdGlwbGUgZGF0YSBtYW5pcHVsYXRpb25zIGJlY29yZSBjb250aW51aW5nXG5cblx0XHR0aGlzLnJlZHJhd0Jsb2NrUmVzdG9yZUNvbmZpZyA9IGZhbHNlOyAvL3N0b3JlIGxhdGVzdCByZWRyYXcgZnVuY3Rpb24gY2FsbHMgZm9yIHdoZW4gcmVkcmF3IGlzIG5lZWRlZFxuXG5cdFx0dGhpcy5yZWRyYXdCbG9ja1JlZGVySW5Qb3NpdGlvbiA9IGZhbHNlOyAvL3N0b3JlIGxhdGVzdCByZWRyYXcgZnVuY3Rpb24gY2FsbHMgZm9yIHdoZW4gcmVkcmF3IGlzIG5lZWRlZFxuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8gU2V0dXAgRnVuY3Rpb25zIC8vLy8vLy8vLy8vLy8vLy8vXG5cblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5jcmVhdGVIb2xkZXJFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItdGFibGVIb2xkZXJcIik7XG5cblx0XHRlbC5zZXRBdHRyaWJ1dGUoXCJ0YWJpbmRleFwiLCAwKTtcblxuXHRcdHJldHVybiBlbDtcblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5jcmVhdGVUYWJsZUVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG5cdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci10YWJsZVwiKTtcblxuXHRcdHJldHVybiBlbDtcblx0fTtcblxuXHQvL3JldHVybiBjb250YWluaW5nIGVsZW1lbnRcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5nZXRFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuZWxlbWVudDtcblx0fTtcblxuXHQvL3JldHVybiB0YWJsZSBlbGVtZW50XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuZ2V0VGFibGVFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMudGFibGVFbGVtZW50O1xuXHR9O1xuXG5cdC8vcmV0dXJuIHBvc2l0aW9uIG9mIHJvdyBpbiB0YWJsZVxuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLmdldFJvd1Bvc2l0aW9uID0gZnVuY3Rpb24gKHJvdywgYWN0aXZlKSB7XG5cblx0XHRpZiAoYWN0aXZlKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLmFjdGl2ZVJvd3MuaW5kZXhPZihyb3cpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiB0aGlzLnJvd3MuaW5kZXhPZihyb3cpO1xuXHRcdH1cblx0fTtcblxuXHQvL2xpbmsgdG8gY29sdW1uIG1hbmFnZXJcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5zZXRDb2x1bW5NYW5hZ2VyID0gZnVuY3Rpb24gKG1hbmFnZXIpIHtcblxuXHRcdHRoaXMuY29sdW1uTWFuYWdlciA9IG1hbmFnZXI7XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHNlbGYuc2V0UmVuZGVyTW9kZSgpO1xuXG5cdFx0Ly9pbml0aWFsaXplIG1hbmFnZXJcblxuXHRcdHNlbGYuZWxlbWVudC5hcHBlbmRDaGlsZChzZWxmLnRhYmxlRWxlbWVudCk7XG5cblx0XHRzZWxmLmZpcnN0UmVuZGVyID0gdHJ1ZTtcblxuXHRcdC8vc2Nyb2xsIGhlYWRlciBhbG9uZyB3aXRoIHRhYmxlIGJvZHlcblxuXHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0dmFyIGxlZnQgPSBzZWxmLmVsZW1lbnQuc2Nyb2xsTGVmdDtcblxuXHRcdFx0Ly9oYW5kbGUgaG9yaXpvbnRhbCBzY3JvbGxpbmdcblxuXHRcdFx0aWYgKHNlbGYuc2Nyb2xsTGVmdCAhPSBsZWZ0KSB7XG5cblx0XHRcdFx0c2VsZi5jb2x1bW5NYW5hZ2VyLnNjcm9sbEhvcml6b250YWwobGVmdCk7XG5cblx0XHRcdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5ncm91cEJ5KSB7XG5cblx0XHRcdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMuZ3JvdXBSb3dzLnNjcm9sbEhlYWRlcnMobGVmdCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiKSkge1xuXG5cdFx0XHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLnNjcm9sbEhvcml6b250YWwobGVmdCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMuc2Nyb2xsSG9yaXpvbnRhbChsZWZ0KTtcblx0XHRcdH1cblxuXHRcdFx0c2VsZi5zY3JvbGxMZWZ0ID0gbGVmdDtcblx0XHR9KTtcblxuXHRcdC8vaGFuZGxlIHZpcnR1YWwgZG9tIHNjcm9sbGluZ1xuXG5cdFx0aWYgKHRoaXMucmVuZGVyTW9kZSA9PT0gXCJ2aXJ0dWFsXCIpIHtcblxuXHRcdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzY3JvbGxcIiwgZnVuY3Rpb24gKCkge1xuXG5cdFx0XHRcdHZhciB0b3AgPSBzZWxmLmVsZW1lbnQuc2Nyb2xsVG9wO1xuXG5cdFx0XHRcdHZhciBkaXIgPSBzZWxmLnNjcm9sbFRvcCA+IHRvcDtcblxuXHRcdFx0XHQvL2hhbmRsZSB2ZXJpY2FsIHNjcm9sbGluZ1xuXG5cdFx0XHRcdGlmIChzZWxmLnNjcm9sbFRvcCAhPSB0b3ApIHtcblxuXHRcdFx0XHRcdHNlbGYuc2Nyb2xsVG9wID0gdG9wO1xuXG5cdFx0XHRcdFx0c2VsZi5zY3JvbGxWZXJ0aWNhbChkaXIpO1xuXG5cdFx0XHRcdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5hamF4UHJvZ3Jlc3NpdmVMb2FkID09IFwic2Nyb2xsXCIpIHtcblxuXHRcdFx0XHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLmFqYXgubmV4dFBhZ2Uoc2VsZi5lbGVtZW50LnNjcm9sbEhlaWdodCAtIHNlbGYuZWxlbWVudC5jbGllbnRIZWlnaHQgLSB0b3ApO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5zY3JvbGxWZXJ0aWNhbCh0b3ApO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0c2VsZi5zY3JvbGxUb3AgPSB0b3A7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8vLy8gUm93IE1hbmlwdWxhdGlvbiAvLy8vLy8vLy8vLy8vLy8vLy9cblxuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLmZpbmRSb3cgPSBmdW5jdGlvbiAoc3ViamVjdCkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0aWYgKCh0eXBlb2Ygc3ViamVjdCA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2Yoc3ViamVjdCkpID09IFwib2JqZWN0XCIpIHtcblxuXHRcdFx0aWYgKHN1YmplY3QgaW5zdGFuY2VvZiBSb3cpIHtcblxuXHRcdFx0XHQvL3N1YmplY3QgaXMgcm93IGVsZW1lbnRcblxuXHRcdFx0XHRyZXR1cm4gc3ViamVjdDtcblx0XHRcdH0gZWxzZSBpZiAoc3ViamVjdCBpbnN0YW5jZW9mIFJvd0NvbXBvbmVudCkge1xuXG5cdFx0XHRcdC8vc3ViamVjdCBpcyBwdWJsaWMgcm93IGNvbXBvbmVudFxuXG5cdFx0XHRcdHJldHVybiBzdWJqZWN0Ll9nZXRTZWxmKCkgfHwgZmFsc2U7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZiBIVE1MRWxlbWVudCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBzdWJqZWN0IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHtcblxuXHRcdFx0XHQvL3N1YmplY3QgaXMgYSBIVE1MIGVsZW1lbnQgb2YgdGhlIHJvd1xuXG5cdFx0XHRcdHZhciBtYXRjaCA9IHNlbGYucm93cy5maW5kKGZ1bmN0aW9uIChyb3cpIHtcblxuXHRcdFx0XHRcdHJldHVybiByb3cuZWxlbWVudCA9PT0gc3ViamVjdDtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0cmV0dXJuIG1hdGNoIHx8IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSBpZiAodHlwZW9mIHN1YmplY3QgPT0gXCJ1bmRlZmluZWRcIiB8fCBzdWJqZWN0ID09PSBudWxsKSB7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHQvL3N1YmplY3Qgc2hvdWxkIGJlIHRyZWF0ZWQgYXMgdGhlIGluZGV4IG9mIHRoZSByb3dcblxuXHRcdFx0dmFyIF9tYXRjaCA9IHNlbGYucm93cy5maW5kKGZ1bmN0aW9uIChyb3cpIHtcblxuXHRcdFx0XHRyZXR1cm4gcm93LmRhdGFbc2VsZi50YWJsZS5vcHRpb25zLmluZGV4XSA9PSBzdWJqZWN0O1xuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBfbWF0Y2ggfHwgZmFsc2U7XG5cdFx0fVxuXG5cdFx0Ly9jYXRjaCBhbGwgZm9yIGFueSBvdGhlciB0eXBlIG9mIGlucHV0XG5cblxuXHRcdHJldHVybiBmYWxzZTtcblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5nZXRSb3dGcm9tRGF0YU9iamVjdCA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cblx0XHR2YXIgbWF0Y2ggPSB0aGlzLnJvd3MuZmluZChmdW5jdGlvbiAocm93KSB7XG5cblx0XHRcdHJldHVybiByb3cuZGF0YSA9PT0gZGF0YTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBtYXRjaCB8fCBmYWxzZTtcblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5nZXRSb3dGcm9tUG9zaXRpb24gPSBmdW5jdGlvbiAocG9zaXRpb24sIGFjdGl2ZSkge1xuXG5cdFx0aWYgKGFjdGl2ZSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5hY3RpdmVSb3dzW3Bvc2l0aW9uXTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5yb3dzW3Bvc2l0aW9uXTtcblx0XHR9XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuc2Nyb2xsVG9Sb3cgPSBmdW5jdGlvbiAocm93LCBwb3NpdGlvbiwgaWZWaXNpYmxlKSB7XG5cdFx0dmFyIF90aGlzOSA9IHRoaXM7XG5cblx0XHR2YXIgcm93SW5kZXggPSB0aGlzLmdldERpc3BsYXlSb3dzKCkuaW5kZXhPZihyb3cpLFxuXHRcdCAgICByb3dFbCA9IHJvdy5nZXRFbGVtZW50KCksXG5cdFx0ICAgIHJvd1RvcCxcblx0XHQgICAgb2Zmc2V0ID0gMDtcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cblx0XHRcdGlmIChyb3dJbmRleCA+IC0xKSB7XG5cblx0XHRcdFx0aWYgKHR5cGVvZiBwb3NpdGlvbiA9PT0gXCJ1bmRlZmluZWRcIikge1xuXG5cdFx0XHRcdFx0cG9zaXRpb24gPSBfdGhpczkudGFibGUub3B0aW9ucy5zY3JvbGxUb1Jvd1Bvc2l0aW9uO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZiBpZlZpc2libGUgPT09IFwidW5kZWZpbmVkXCIpIHtcblxuXHRcdFx0XHRcdGlmVmlzaWJsZSA9IF90aGlzOS50YWJsZS5vcHRpb25zLnNjcm9sbFRvUm93SWZWaXNpYmxlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHBvc2l0aW9uID09PSBcIm5lYXJlc3RcIikge1xuXG5cdFx0XHRcdFx0c3dpdGNoIChfdGhpczkucmVuZGVyTW9kZSkge1xuXG5cdFx0XHRcdFx0XHRjYXNlIFwiY2xhc3NpY1wiOlxuXG5cdFx0XHRcdFx0XHRcdHJvd1RvcCA9IFRhYnVsYXRvci5wcm90b3R5cGUuaGVscGVycy5lbE9mZnNldChyb3dFbCkudG9wO1xuXG5cdFx0XHRcdFx0XHRcdHBvc2l0aW9uID0gTWF0aC5hYnMoX3RoaXM5LmVsZW1lbnQuc2Nyb2xsVG9wIC0gcm93VG9wKSA+IE1hdGguYWJzKF90aGlzOS5lbGVtZW50LnNjcm9sbFRvcCArIF90aGlzOS5lbGVtZW50LmNsaWVudEhlaWdodCAtIHJvd1RvcCkgPyBcImJvdHRvbVwiIDogXCJ0b3BcIjtcblxuXHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0Y2FzZSBcInZpcnR1YWxcIjpcblxuXHRcdFx0XHRcdFx0XHRwb3NpdGlvbiA9IE1hdGguYWJzKF90aGlzOS52RG9tVG9wIC0gcm93SW5kZXgpID4gTWF0aC5hYnMoX3RoaXM5LnZEb21Cb3R0b20gLSByb3dJbmRleCkgPyBcImJvdHRvbVwiIDogXCJ0b3BcIjtcblxuXHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vY2hlY2sgcm93IHZpc2liaWxpdHlcblxuXHRcdFx0XHRpZiAoIWlmVmlzaWJsZSkge1xuXG5cdFx0XHRcdFx0aWYgKFRhYnVsYXRvci5wcm90b3R5cGUuaGVscGVycy5lbFZpc2libGUocm93RWwpKSB7XG5cblx0XHRcdFx0XHRcdG9mZnNldCA9IFRhYnVsYXRvci5wcm90b3R5cGUuaGVscGVycy5lbE9mZnNldChyb3dFbCkudG9wIC0gVGFidWxhdG9yLnByb3RvdHlwZS5oZWxwZXJzLmVsT2Zmc2V0KF90aGlzOS5lbGVtZW50KS50b3A7XG5cblx0XHRcdFx0XHRcdGlmIChvZmZzZXQgPiAwICYmIG9mZnNldCA8IF90aGlzOS5lbGVtZW50LmNsaWVudEhlaWdodCAtIHJvd0VsLm9mZnNldEhlaWdodCkge1xuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvL3Njcm9sbCB0byByb3dcblxuXHRcdFx0XHRzd2l0Y2ggKF90aGlzOS5yZW5kZXJNb2RlKSB7XG5cblx0XHRcdFx0XHRjYXNlIFwiY2xhc3NpY1wiOlxuXG5cdFx0XHRcdFx0XHRfdGhpczkuZWxlbWVudC5zY3JvbGxUb3AgPSBUYWJ1bGF0b3IucHJvdG90eXBlLmhlbHBlcnMuZWxPZmZzZXQocm93RWwpLnRvcCAtIFRhYnVsYXRvci5wcm90b3R5cGUuaGVscGVycy5lbE9mZnNldChfdGhpczkuZWxlbWVudCkudG9wICsgX3RoaXM5LmVsZW1lbnQuc2Nyb2xsVG9wO1xuXG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgXCJ2aXJ0dWFsXCI6XG5cblx0XHRcdFx0XHRcdF90aGlzOS5fdmlydHVhbFJlbmRlckZpbGwocm93SW5kZXgsIHRydWUpO1xuXG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly9hbGlnbiB0byBjb3JyZWN0IHBvc2l0aW9uXG5cblx0XHRcdFx0c3dpdGNoIChwb3NpdGlvbikge1xuXG5cdFx0XHRcdFx0Y2FzZSBcIm1pZGRsZVwiOlxuXG5cdFx0XHRcdFx0Y2FzZSBcImNlbnRlclwiOlxuXG5cdFx0XHRcdFx0XHRpZiAoX3RoaXM5LmVsZW1lbnQuc2Nyb2xsSGVpZ2h0IC0gX3RoaXM5LmVsZW1lbnQuc2Nyb2xsVG9wID09IF90aGlzOS5lbGVtZW50LmNsaWVudEhlaWdodCkge1xuXG5cdFx0XHRcdFx0XHRcdF90aGlzOS5lbGVtZW50LnNjcm9sbFRvcCA9IF90aGlzOS5lbGVtZW50LnNjcm9sbFRvcCArIChyb3dFbC5vZmZzZXRUb3AgLSBfdGhpczkuZWxlbWVudC5zY3JvbGxUb3ApIC0gKF90aGlzOS5lbGVtZW50LnNjcm9sbEhlaWdodCAtIHJvd0VsLm9mZnNldFRvcCkgLyAyO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0XHRfdGhpczkuZWxlbWVudC5zY3JvbGxUb3AgPSBfdGhpczkuZWxlbWVudC5zY3JvbGxUb3AgLSBfdGhpczkuZWxlbWVudC5jbGllbnRIZWlnaHQgLyAyO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgXCJib3R0b21cIjpcblxuXHRcdFx0XHRcdFx0aWYgKF90aGlzOS5lbGVtZW50LnNjcm9sbEhlaWdodCAtIF90aGlzOS5lbGVtZW50LnNjcm9sbFRvcCA9PSBfdGhpczkuZWxlbWVudC5jbGllbnRIZWlnaHQpIHtcblxuXHRcdFx0XHRcdFx0XHRfdGhpczkuZWxlbWVudC5zY3JvbGxUb3AgPSBfdGhpczkuZWxlbWVudC5zY3JvbGxUb3AgLSAoX3RoaXM5LmVsZW1lbnQuc2Nyb2xsSGVpZ2h0IC0gcm93RWwub2Zmc2V0VG9wKSArIHJvd0VsLm9mZnNldEhlaWdodDtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdFx0X3RoaXM5LmVsZW1lbnQuc2Nyb2xsVG9wID0gX3RoaXM5LmVsZW1lbnQuc2Nyb2xsVG9wIC0gX3RoaXM5LmVsZW1lbnQuY2xpZW50SGVpZ2h0ICsgcm93RWwub2Zmc2V0SGVpZ2h0O1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmVzb2x2ZSgpO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJTY3JvbGwgRXJyb3IgLSBSb3cgbm90IHZpc2libGVcIik7XG5cblx0XHRcdFx0cmVqZWN0KFwiU2Nyb2xsIEVycm9yIC0gUm93IG5vdCB2aXNpYmxlXCIpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8vLyBEYXRhIEhhbmRsaW5nIC8vLy8vLy8vLy8vLy8vLy8vL1xuXG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuc2V0RGF0YSA9IGZ1bmN0aW9uIChkYXRhLCByZW5kZXJJblBvc2l0aW9uLCBjb2x1bW5zQ2hhbmdlZCkge1xuXHRcdHZhciBfdGhpczEwID0gdGhpcztcblxuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cblx0XHRcdGlmIChyZW5kZXJJblBvc2l0aW9uICYmIF90aGlzMTAuZ2V0RGlzcGxheVJvd3MoKS5sZW5ndGgpIHtcblxuXHRcdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnBhZ2luYXRpb24pIHtcblxuXHRcdFx0XHRcdHNlbGYuX3NldERhdGFBY3R1YWwoZGF0YSwgdHJ1ZSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRfdGhpczEwLnJlUmVuZGVySW5Qb3NpdGlvbihmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHRcdHNlbGYuX3NldERhdGFBY3R1YWwoZGF0YSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0aWYgKF90aGlzMTAudGFibGUub3B0aW9ucy5hdXRvQ29sdW1ucyAmJiBjb2x1bW5zQ2hhbmdlZCkge1xuXG5cdFx0XHRcdFx0X3RoaXMxMC50YWJsZS5jb2x1bW5NYW5hZ2VyLmdlbmVyYXRlQ29sdW1uc0Zyb21Sb3dEYXRhKGRhdGEpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0X3RoaXMxMC5yZXNldFNjcm9sbCgpO1xuXG5cdFx0XHRcdF90aGlzMTAuX3NldERhdGFBY3R1YWwoZGF0YSk7XG5cdFx0XHR9XG5cblx0XHRcdHJlc29sdmUoKTtcblx0XHR9KTtcblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5fc2V0RGF0YUFjdHVhbCA9IGZ1bmN0aW9uIChkYXRhLCByZW5kZXJJblBvc2l0aW9uKSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRzZWxmLnRhYmxlLm9wdGlvbnMuZGF0YUxvYWRpbmcuY2FsbCh0aGlzLnRhYmxlLCBkYXRhKTtcblxuXHRcdHRoaXMuX3dpcGVFbGVtZW50cygpO1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5oaXN0b3J5ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiaGlzdG9yeVwiKSkge1xuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuaGlzdG9yeS5jbGVhcigpO1xuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGRhdGEpKSB7XG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInNlbGVjdFJvd1wiKSkge1xuXG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5zZWxlY3RSb3cuY2xlYXJTZWxlY3Rpb25EYXRhKCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMucmVhY3RpdmVEYXRhICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwicmVhY3RpdmVEYXRhXCIsIHRydWUpKSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnJlYWN0aXZlRGF0YS53YXRjaERhdGEoZGF0YSk7XG5cdFx0XHR9XG5cblx0XHRcdGRhdGEuZm9yRWFjaChmdW5jdGlvbiAoZGVmLCBpKSB7XG5cblx0XHRcdFx0aWYgKGRlZiAmJiAodHlwZW9mIGRlZiA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoZGVmKSkgPT09IFwib2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHZhciByb3cgPSBuZXcgUm93KGRlZiwgc2VsZik7XG5cblx0XHRcdFx0XHRzZWxmLnJvd3MucHVzaChyb3cpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiRGF0YSBMb2FkaW5nIFdhcm5pbmcgLSBJbnZhbGlkIHJvdyBkYXRhIGRldGVjdGVkIGFuZCBpZ25vcmVkLCBleHBlY3Rpbmcgb2JqZWN0IGJ1dCByZWNlaXZlZDpcIiwgZGVmKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5kYXRhTG9hZGVkLmNhbGwodGhpcy50YWJsZSwgZGF0YSk7XG5cblx0XHRcdHNlbGYucmVmcmVzaEFjdGl2ZURhdGEoZmFsc2UsIGZhbHNlLCByZW5kZXJJblBvc2l0aW9uKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRjb25zb2xlLmVycm9yKFwiRGF0YSBMb2FkaW5nIEVycm9yIC0gVW5hYmxlIHRvIHByb2Nlc3MgZGF0YSBkdWUgdG8gaW52YWxpZCBkYXRhIHR5cGUgXFxuRXhwZWN0aW5nOiBhcnJheSBcXG5SZWNlaXZlZDogXCIsIHR5cGVvZiBkYXRhID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihkYXRhKSwgXCJcXG5EYXRhOiAgICAgXCIsIGRhdGEpO1xuXHRcdH1cblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5fd2lwZUVsZW1lbnRzID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5yb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXG5cdFx0XHRyb3cud2lwZSgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiZ3JvdXBSb3dzXCIpKSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5ncm91cFJvd3Mud2lwZSgpO1xuXHRcdH1cblxuXHRcdHRoaXMucm93cyA9IFtdO1xuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLmRlbGV0ZVJvdyA9IGZ1bmN0aW9uIChyb3csIGJsb2NrUmVkcmF3KSB7XG5cblx0XHR2YXIgYWxsSW5kZXggPSB0aGlzLnJvd3MuaW5kZXhPZihyb3cpLFxuXHRcdCAgICBhY3RpdmVJbmRleCA9IHRoaXMuYWN0aXZlUm93cy5pbmRleE9mKHJvdyk7XG5cblx0XHRpZiAoYWN0aXZlSW5kZXggPiAtMSkge1xuXG5cdFx0XHR0aGlzLmFjdGl2ZVJvd3Muc3BsaWNlKGFjdGl2ZUluZGV4LCAxKTtcblx0XHR9XG5cblx0XHRpZiAoYWxsSW5kZXggPiAtMSkge1xuXG5cdFx0XHR0aGlzLnJvd3Muc3BsaWNlKGFsbEluZGV4LCAxKTtcblx0XHR9XG5cblx0XHR0aGlzLnNldEFjdGl2ZVJvd3ModGhpcy5hY3RpdmVSb3dzKTtcblxuXHRcdHRoaXMuZGlzcGxheVJvd0l0ZXJhdG9yKGZ1bmN0aW9uIChyb3dzKSB7XG5cblx0XHRcdHZhciBkaXNwbGF5SW5kZXggPSByb3dzLmluZGV4T2Yocm93KTtcblxuXHRcdFx0aWYgKGRpc3BsYXlJbmRleCA+IC0xKSB7XG5cblx0XHRcdFx0cm93cy5zcGxpY2UoZGlzcGxheUluZGV4LCAxKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGlmICghYmxvY2tSZWRyYXcpIHtcblxuXHRcdFx0dGhpcy5yZVJlbmRlckluUG9zaXRpb24oKTtcblx0XHR9XG5cblx0XHR0aGlzLnJlZ2VuZXJhdGVSb3dOdW1iZXJzKCk7XG5cblx0XHR0aGlzLnRhYmxlLm9wdGlvbnMucm93RGVsZXRlZC5jYWxsKHRoaXMudGFibGUsIHJvdy5nZXRDb21wb25lbnQoKSk7XG5cblx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuZGF0YUVkaXRlZC5jYWxsKHRoaXMudGFibGUsIHRoaXMuZ2V0RGF0YSgpKTtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImdyb3VwUm93c1wiKSkge1xuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZ3JvdXBSb3dzLnVwZGF0ZUdyb3VwUm93cyh0cnVlKTtcblx0XHR9IGVsc2UgaWYgKHRoaXMudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwicGFnZVwiKSkge1xuXG5cdFx0XHR0aGlzLnJlZnJlc2hBY3RpdmVEYXRhKGZhbHNlLCBmYWxzZSwgdHJ1ZSk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwicGFnZVwiKSkge1xuXG5cdFx0XHRcdHRoaXMucmVmcmVzaEFjdGl2ZURhdGEoXCJwYWdlXCIpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5hZGRSb3cgPSBmdW5jdGlvbiAoZGF0YSwgcG9zLCBpbmRleCwgYmxvY2tSZWRyYXcpIHtcblxuXHRcdHZhciByb3cgPSB0aGlzLmFkZFJvd0FjdHVhbChkYXRhLCBwb3MsIGluZGV4LCBibG9ja1JlZHJhdyk7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmhpc3RvcnkgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJoaXN0b3J5XCIpKSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5oaXN0b3J5LmFjdGlvbihcInJvd0FkZFwiLCByb3csIHsgZGF0YTogZGF0YSwgcG9zOiBwb3MsIGluZGV4OiBpbmRleCB9KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gcm93O1xuXHR9O1xuXG5cdC8vYWRkIG11bHRpcGxlIHJvd3NcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5hZGRSb3dzID0gZnVuY3Rpb24gKGRhdGEsIHBvcywgaW5kZXgpIHtcblx0XHR2YXIgX3RoaXMxMSA9IHRoaXM7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGxlbmd0aCA9IDAsXG5cdFx0ICAgIHJvd3MgPSBbXTtcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cblx0XHRcdHBvcyA9IF90aGlzMTEuZmluZEFkZFJvd1Bvcyhwb3MpO1xuXG5cdFx0XHRpZiAoIUFycmF5LmlzQXJyYXkoZGF0YSkpIHtcblxuXHRcdFx0XHRkYXRhID0gW2RhdGFdO1xuXHRcdFx0fVxuXG5cdFx0XHRsZW5ndGggPSBkYXRhLmxlbmd0aCAtIDE7XG5cblx0XHRcdGlmICh0eXBlb2YgaW5kZXggPT0gXCJ1bmRlZmluZWRcIiAmJiBwb3MgfHwgdHlwZW9mIGluZGV4ICE9PSBcInVuZGVmaW5lZFwiICYmICFwb3MpIHtcblxuXHRcdFx0XHRkYXRhLnJldmVyc2UoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpKSB7XG5cblx0XHRcdFx0dmFyIHJvdyA9IHNlbGYuYWRkUm93KGl0ZW0sIHBvcywgaW5kZXgsIHRydWUpO1xuXG5cdFx0XHRcdHJvd3MucHVzaChyb3cpO1xuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChfdGhpczExLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSAmJiBfdGhpczExLnRhYmxlLm1vZEV4aXN0cyhcImdyb3VwUm93c1wiKSkge1xuXG5cdFx0XHRcdF90aGlzMTEudGFibGUubW9kdWxlcy5ncm91cFJvd3MudXBkYXRlR3JvdXBSb3dzKHRydWUpO1xuXHRcdFx0fSBlbHNlIGlmIChfdGhpczExLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvbiAmJiBfdGhpczExLnRhYmxlLm1vZEV4aXN0cyhcInBhZ2VcIikpIHtcblxuXHRcdFx0XHRfdGhpczExLnJlZnJlc2hBY3RpdmVEYXRhKGZhbHNlLCBmYWxzZSwgdHJ1ZSk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdF90aGlzMTEucmVSZW5kZXJJblBvc2l0aW9uKCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vcmVjYWxjIGNvbHVtbiBjYWxjdWxhdGlvbnMgaWYgcHJlc2VudFxuXG5cdFx0XHRpZiAoX3RoaXMxMS50YWJsZS5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiKSkge1xuXG5cdFx0XHRcdF90aGlzMTEudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5yZWNhbGMoX3RoaXMxMS50YWJsZS5yb3dNYW5hZ2VyLmFjdGl2ZVJvd3MpO1xuXHRcdFx0fVxuXG5cdFx0XHRfdGhpczExLnJlZ2VuZXJhdGVSb3dOdW1iZXJzKCk7XG5cblx0XHRcdHJlc29sdmUocm93cyk7XG5cdFx0fSk7XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuZmluZEFkZFJvd1BvcyA9IGZ1bmN0aW9uIChwb3MpIHtcblxuXHRcdGlmICh0eXBlb2YgcG9zID09PSBcInVuZGVmaW5lZFwiKSB7XG5cblx0XHRcdHBvcyA9IHRoaXMudGFibGUub3B0aW9ucy5hZGRSb3dQb3M7XG5cdFx0fVxuXG5cdFx0aWYgKHBvcyA9PT0gXCJwb3NcIikge1xuXG5cdFx0XHRwb3MgPSB0cnVlO1xuXHRcdH1cblxuXHRcdGlmIChwb3MgPT09IFwiYm90dG9tXCIpIHtcblxuXHRcdFx0cG9zID0gZmFsc2U7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHBvcztcblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5hZGRSb3dBY3R1YWwgPSBmdW5jdGlvbiAoZGF0YSwgcG9zLCBpbmRleCwgYmxvY2tSZWRyYXcpIHtcblxuXHRcdHZhciByb3cgPSBkYXRhIGluc3RhbmNlb2YgUm93ID8gZGF0YSA6IG5ldyBSb3coZGF0YSB8fCB7fSwgdGhpcyksXG5cdFx0ICAgIHRvcCA9IHRoaXMuZmluZEFkZFJvd1Bvcyhwb3MpLFxuXHRcdCAgICBhbGxJbmRleCA9IC0xLFxuXHRcdCAgICBhY3RpdmVJbmRleCxcblx0XHQgICAgZGlzcFJvd3M7XG5cblx0XHRpZiAoIWluZGV4ICYmIHRoaXMudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uICYmIHRoaXMudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uQWRkUm93ID09IFwicGFnZVwiKSB7XG5cblx0XHRcdGRpc3BSb3dzID0gdGhpcy5nZXREaXNwbGF5Um93cygpO1xuXG5cdFx0XHRpZiAodG9wKSB7XG5cblx0XHRcdFx0aWYgKGRpc3BSb3dzLmxlbmd0aCkge1xuXG5cdFx0XHRcdFx0aW5kZXggPSBkaXNwUm93c1swXTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdGlmICh0aGlzLmFjdGl2ZVJvd3MubGVuZ3RoKSB7XG5cblx0XHRcdFx0XHRcdGluZGV4ID0gdGhpcy5hY3RpdmVSb3dzW3RoaXMuYWN0aXZlUm93cy5sZW5ndGggLSAxXTtcblxuXHRcdFx0XHRcdFx0dG9wID0gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGlmIChkaXNwUm93cy5sZW5ndGgpIHtcblxuXHRcdFx0XHRcdGluZGV4ID0gZGlzcFJvd3NbZGlzcFJvd3MubGVuZ3RoIC0gMV07XG5cblx0XHRcdFx0XHR0b3AgPSBkaXNwUm93cy5sZW5ndGggPCB0aGlzLnRhYmxlLm1vZHVsZXMucGFnZS5nZXRQYWdlU2l6ZSgpID8gZmFsc2UgOiB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZiBpbmRleCAhPT0gXCJ1bmRlZmluZWRcIikge1xuXG5cdFx0XHRpbmRleCA9IHRoaXMuZmluZFJvdyhpbmRleCk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiZ3JvdXBSb3dzXCIpKSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5ncm91cFJvd3MuYXNzaWduUm93VG9Hcm91cChyb3cpO1xuXG5cdFx0XHR2YXIgZ3JvdXBSb3dzID0gcm93LmdldEdyb3VwKCkucm93cztcblxuXHRcdFx0aWYgKGdyb3VwUm93cy5sZW5ndGggPiAxKSB7XG5cblx0XHRcdFx0aWYgKCFpbmRleCB8fCBpbmRleCAmJiBncm91cFJvd3MuaW5kZXhPZihpbmRleCkgPT0gLTEpIHtcblxuXHRcdFx0XHRcdGlmICh0b3ApIHtcblxuXHRcdFx0XHRcdFx0aWYgKGdyb3VwUm93c1swXSAhPT0gcm93KSB7XG5cblx0XHRcdFx0XHRcdFx0aW5kZXggPSBncm91cFJvd3NbMF07XG5cblx0XHRcdFx0XHRcdFx0dGhpcy5fbW92ZVJvd0luQXJyYXkocm93LmdldEdyb3VwKCkucm93cywgcm93LCBpbmRleCwgIXRvcCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0aWYgKGdyb3VwUm93c1tncm91cFJvd3MubGVuZ3RoIC0gMV0gIT09IHJvdykge1xuXG5cdFx0XHRcdFx0XHRcdGluZGV4ID0gZ3JvdXBSb3dzW2dyb3VwUm93cy5sZW5ndGggLSAxXTtcblxuXHRcdFx0XHRcdFx0XHR0aGlzLl9tb3ZlUm93SW5BcnJheShyb3cuZ2V0R3JvdXAoKS5yb3dzLCByb3csIGluZGV4LCAhdG9wKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHR0aGlzLl9tb3ZlUm93SW5BcnJheShyb3cuZ2V0R3JvdXAoKS5yb3dzLCByb3csIGluZGV4LCAhdG9wKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChpbmRleCkge1xuXG5cdFx0XHRhbGxJbmRleCA9IHRoaXMucm93cy5pbmRleE9mKGluZGV4KTtcblx0XHR9XG5cblx0XHRpZiAoaW5kZXggJiYgYWxsSW5kZXggPiAtMSkge1xuXG5cdFx0XHRhY3RpdmVJbmRleCA9IHRoaXMuYWN0aXZlUm93cy5pbmRleE9mKGluZGV4KTtcblxuXHRcdFx0dGhpcy5kaXNwbGF5Um93SXRlcmF0b3IoZnVuY3Rpb24gKHJvd3MpIHtcblxuXHRcdFx0XHR2YXIgZGlzcGxheUluZGV4ID0gcm93cy5pbmRleE9mKGluZGV4KTtcblxuXHRcdFx0XHRpZiAoZGlzcGxheUluZGV4ID4gLTEpIHtcblxuXHRcdFx0XHRcdHJvd3Muc3BsaWNlKHRvcCA/IGRpc3BsYXlJbmRleCA6IGRpc3BsYXlJbmRleCArIDEsIDAsIHJvdyk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRpZiAoYWN0aXZlSW5kZXggPiAtMSkge1xuXG5cdFx0XHRcdHRoaXMuYWN0aXZlUm93cy5zcGxpY2UodG9wID8gYWN0aXZlSW5kZXggOiBhY3RpdmVJbmRleCArIDEsIDAsIHJvdyk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMucm93cy5zcGxpY2UodG9wID8gYWxsSW5kZXggOiBhbGxJbmRleCArIDEsIDAsIHJvdyk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKHRvcCkge1xuXG5cdFx0XHRcdHRoaXMuZGlzcGxheVJvd0l0ZXJhdG9yKGZ1bmN0aW9uIChyb3dzKSB7XG5cblx0XHRcdFx0XHRyb3dzLnVuc2hpZnQocm93KTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0dGhpcy5hY3RpdmVSb3dzLnVuc2hpZnQocm93KTtcblxuXHRcdFx0XHR0aGlzLnJvd3MudW5zaGlmdChyb3cpO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHR0aGlzLmRpc3BsYXlSb3dJdGVyYXRvcihmdW5jdGlvbiAocm93cykge1xuXG5cdFx0XHRcdFx0cm93cy5wdXNoKHJvdyk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHRoaXMuYWN0aXZlUm93cy5wdXNoKHJvdyk7XG5cblx0XHRcdFx0dGhpcy5yb3dzLnB1c2gocm93KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHR0aGlzLnNldEFjdGl2ZVJvd3ModGhpcy5hY3RpdmVSb3dzKTtcblxuXHRcdHRoaXMudGFibGUub3B0aW9ucy5yb3dBZGRlZC5jYWxsKHRoaXMudGFibGUsIHJvdy5nZXRDb21wb25lbnQoKSk7XG5cblx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuZGF0YUVkaXRlZC5jYWxsKHRoaXMudGFibGUsIHRoaXMuZ2V0RGF0YSgpKTtcblxuXHRcdGlmICghYmxvY2tSZWRyYXcpIHtcblxuXHRcdFx0dGhpcy5yZVJlbmRlckluUG9zaXRpb24oKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gcm93O1xuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLm1vdmVSb3cgPSBmdW5jdGlvbiAoZnJvbSwgdG8sIGFmdGVyKSB7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmhpc3RvcnkgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJoaXN0b3J5XCIpKSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5oaXN0b3J5LmFjdGlvbihcInJvd01vdmVcIiwgZnJvbSwgeyBwb3NGcm9tOiB0aGlzLmdldFJvd1Bvc2l0aW9uKGZyb20pLCBwb3NUbzogdGhpcy5nZXRSb3dQb3NpdGlvbih0byksIHRvOiB0bywgYWZ0ZXI6IGFmdGVyIH0pO1xuXHRcdH1cblxuXHRcdHRoaXMubW92ZVJvd0FjdHVhbChmcm9tLCB0bywgYWZ0ZXIpO1xuXG5cdFx0dGhpcy5yZWdlbmVyYXRlUm93TnVtYmVycygpO1xuXG5cdFx0dGhpcy50YWJsZS5vcHRpb25zLnJvd01vdmVkLmNhbGwodGhpcy50YWJsZSwgZnJvbS5nZXRDb21wb25lbnQoKSk7XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUubW92ZVJvd0FjdHVhbCA9IGZ1bmN0aW9uIChmcm9tLCB0bywgYWZ0ZXIpIHtcblx0XHR2YXIgX3RoaXMxMiA9IHRoaXM7XG5cblx0XHR0aGlzLl9tb3ZlUm93SW5BcnJheSh0aGlzLnJvd3MsIGZyb20sIHRvLCBhZnRlcik7XG5cblx0XHR0aGlzLl9tb3ZlUm93SW5BcnJheSh0aGlzLmFjdGl2ZVJvd3MsIGZyb20sIHRvLCBhZnRlcik7XG5cblx0XHR0aGlzLmRpc3BsYXlSb3dJdGVyYXRvcihmdW5jdGlvbiAocm93cykge1xuXG5cdFx0XHRfdGhpczEyLl9tb3ZlUm93SW5BcnJheShyb3dzLCBmcm9tLCB0bywgYWZ0ZXIpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiZ3JvdXBSb3dzXCIpKSB7XG5cblx0XHRcdGlmICghYWZ0ZXIgJiYgdG8gaW5zdGFuY2VvZiBHcm91cCkge1xuXG5cdFx0XHRcdHRvID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLnByZXZEaXNwbGF5Um93KGZyb20pIHx8IHRvO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgdG9Hcm91cCA9IHRvLmdldEdyb3VwKCk7XG5cblx0XHRcdHZhciBmcm9tR3JvdXAgPSBmcm9tLmdldEdyb3VwKCk7XG5cblx0XHRcdGlmICh0b0dyb3VwID09PSBmcm9tR3JvdXApIHtcblxuXHRcdFx0XHR0aGlzLl9tb3ZlUm93SW5BcnJheSh0b0dyb3VwLnJvd3MsIGZyb20sIHRvLCBhZnRlcik7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGlmIChmcm9tR3JvdXApIHtcblxuXHRcdFx0XHRcdGZyb21Hcm91cC5yZW1vdmVSb3coZnJvbSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR0b0dyb3VwLmluc2VydFJvdyhmcm9tLCB0bywgYWZ0ZXIpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5fbW92ZVJvd0luQXJyYXkgPSBmdW5jdGlvbiAocm93cywgZnJvbSwgdG8sIGFmdGVyKSB7XG5cblx0XHR2YXIgZnJvbUluZGV4LCB0b0luZGV4LCBzdGFydCwgZW5kO1xuXG5cdFx0aWYgKGZyb20gIT09IHRvKSB7XG5cblx0XHRcdGZyb21JbmRleCA9IHJvd3MuaW5kZXhPZihmcm9tKTtcblxuXHRcdFx0aWYgKGZyb21JbmRleCA+IC0xKSB7XG5cblx0XHRcdFx0cm93cy5zcGxpY2UoZnJvbUluZGV4LCAxKTtcblxuXHRcdFx0XHR0b0luZGV4ID0gcm93cy5pbmRleE9mKHRvKTtcblxuXHRcdFx0XHRpZiAodG9JbmRleCA+IC0xKSB7XG5cblx0XHRcdFx0XHRpZiAoYWZ0ZXIpIHtcblxuXHRcdFx0XHRcdFx0cm93cy5zcGxpY2UodG9JbmRleCArIDEsIDAsIGZyb20pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdHJvd3Muc3BsaWNlKHRvSW5kZXgsIDAsIGZyb20pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdHJvd3Muc3BsaWNlKGZyb21JbmRleCwgMCwgZnJvbSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly9yZXN0eWxlIHJvd3NcblxuXHRcdFx0aWYgKHJvd3MgPT09IHRoaXMuZ2V0RGlzcGxheVJvd3MoKSkge1xuXG5cdFx0XHRcdHN0YXJ0ID0gZnJvbUluZGV4IDwgdG9JbmRleCA/IGZyb21JbmRleCA6IHRvSW5kZXg7XG5cblx0XHRcdFx0ZW5kID0gdG9JbmRleCA+IGZyb21JbmRleCA/IHRvSW5kZXggOiBmcm9tSW5kZXggKyAxO1xuXG5cdFx0XHRcdGZvciAodmFyIF9pNCA9IHN0YXJ0OyBfaTQgPD0gZW5kOyBfaTQrKykge1xuXG5cdFx0XHRcdFx0aWYgKHJvd3NbX2k0XSkge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnN0eWxlUm93KHJvd3NbX2k0XSwgX2k0KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuY2xlYXJEYXRhID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5zZXREYXRhKFtdKTtcblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5nZXRSb3dJbmRleCA9IGZ1bmN0aW9uIChyb3cpIHtcblxuXHRcdHJldHVybiB0aGlzLmZpbmRSb3dJbmRleChyb3csIHRoaXMucm93cyk7XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuZ2V0RGlzcGxheVJvd0luZGV4ID0gZnVuY3Rpb24gKHJvdykge1xuXG5cdFx0dmFyIGluZGV4ID0gdGhpcy5nZXREaXNwbGF5Um93cygpLmluZGV4T2Yocm93KTtcblxuXHRcdHJldHVybiBpbmRleCA+IC0xID8gaW5kZXggOiBmYWxzZTtcblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5uZXh0RGlzcGxheVJvdyA9IGZ1bmN0aW9uIChyb3csIHJvd09ubHkpIHtcblxuXHRcdHZhciBpbmRleCA9IHRoaXMuZ2V0RGlzcGxheVJvd0luZGV4KHJvdyksXG5cdFx0ICAgIG5leHRSb3cgPSBmYWxzZTtcblxuXHRcdGlmIChpbmRleCAhPT0gZmFsc2UgJiYgaW5kZXggPCB0aGlzLmRpc3BsYXlSb3dzQ291bnQgLSAxKSB7XG5cblx0XHRcdG5leHRSb3cgPSB0aGlzLmdldERpc3BsYXlSb3dzKClbaW5kZXggKyAxXTtcblx0XHR9XG5cblx0XHRpZiAobmV4dFJvdyAmJiAoIShuZXh0Um93IGluc3RhbmNlb2YgUm93KSB8fCBuZXh0Um93LnR5cGUgIT0gXCJyb3dcIikpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMubmV4dERpc3BsYXlSb3cobmV4dFJvdywgcm93T25seSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG5leHRSb3c7XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUucHJldkRpc3BsYXlSb3cgPSBmdW5jdGlvbiAocm93LCByb3dPbmx5KSB7XG5cblx0XHR2YXIgaW5kZXggPSB0aGlzLmdldERpc3BsYXlSb3dJbmRleChyb3cpLFxuXHRcdCAgICBwcmV2Um93ID0gZmFsc2U7XG5cblx0XHRpZiAoaW5kZXgpIHtcblxuXHRcdFx0cHJldlJvdyA9IHRoaXMuZ2V0RGlzcGxheVJvd3MoKVtpbmRleCAtIDFdO1xuXHRcdH1cblxuXHRcdGlmIChyb3dPbmx5ICYmIHByZXZSb3cgJiYgKCEocHJldlJvdyBpbnN0YW5jZW9mIFJvdykgfHwgcHJldlJvdy50eXBlICE9IFwicm93XCIpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLnByZXZEaXNwbGF5Um93KHByZXZSb3csIHJvd09ubHkpO1xuXHRcdH1cblxuXHRcdHJldHVybiBwcmV2Um93O1xuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLmZpbmRSb3dJbmRleCA9IGZ1bmN0aW9uIChyb3csIGxpc3QpIHtcblxuXHRcdHZhciByb3dJbmRleDtcblxuXHRcdHJvdyA9IHRoaXMuZmluZFJvdyhyb3cpO1xuXG5cdFx0aWYgKHJvdykge1xuXG5cdFx0XHRyb3dJbmRleCA9IGxpc3QuaW5kZXhPZihyb3cpO1xuXG5cdFx0XHRpZiAocm93SW5kZXggPiAtMSkge1xuXG5cdFx0XHRcdHJldHVybiByb3dJbmRleDtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuZ2V0RGF0YSA9IGZ1bmN0aW9uIChhY3RpdmUsIHRyYW5zZm9ybSkge1xuXG5cdFx0dmFyIG91dHB1dCA9IFtdLFxuXHRcdCAgICByb3dzID0gdGhpcy5nZXRSb3dzKGFjdGl2ZSk7XG5cblx0XHRyb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXG5cdFx0XHRpZiAocm93LnR5cGUgPT0gXCJyb3dcIikge1xuXG5cdFx0XHRcdG91dHB1dC5wdXNoKHJvdy5nZXREYXRhKHRyYW5zZm9ybSB8fCBcImRhdGFcIikpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5nZXRDb21wb25lbnRzID0gZnVuY3Rpb24gKGFjdGl2ZSkge1xuXG5cdFx0dmFyIG91dHB1dCA9IFtdLFxuXHRcdCAgICByb3dzID0gdGhpcy5nZXRSb3dzKGFjdGl2ZSk7XG5cblx0XHRyb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXG5cdFx0XHRvdXRwdXQucHVzaChyb3cuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5nZXREYXRhQ291bnQgPSBmdW5jdGlvbiAoYWN0aXZlKSB7XG5cblx0XHR2YXIgcm93cyA9IHRoaXMuZ2V0Um93cyhhY3RpdmUpO1xuXG5cdFx0cmV0dXJuIHJvd3MubGVuZ3RoO1xuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLl9nZW5SZW1vdGVSZXF1ZXN0ID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBfdGhpczEzID0gdGhpcztcblxuXHRcdHZhciB0YWJsZSA9IHRoaXMudGFibGUsXG5cdFx0ICAgIG9wdGlvbnMgPSB0YWJsZS5vcHRpb25zLFxuXHRcdCAgICBwYXJhbXMgPSB7fTtcblxuXHRcdGlmICh0YWJsZS5tb2RFeGlzdHMoXCJwYWdlXCIpKSB7XG5cblx0XHRcdC8vc2V0IHNvcnQgZGF0YSBpZiBkZWZpbmVkXG5cblx0XHRcdGlmIChvcHRpb25zLmFqYXhTb3J0aW5nKSB7XG5cblx0XHRcdFx0dmFyIHNvcnRlcnMgPSB0aGlzLnRhYmxlLm1vZHVsZXMuc29ydC5nZXRTb3J0KCk7XG5cblx0XHRcdFx0c29ydGVycy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cblx0XHRcdFx0XHRkZWxldGUgaXRlbS5jb2x1bW47XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHBhcmFtc1t0aGlzLnRhYmxlLm1vZHVsZXMucGFnZS5wYWdpbmF0aW9uRGF0YVNlbnROYW1lcy5zb3J0ZXJzXSA9IHNvcnRlcnM7XG5cdFx0XHR9XG5cblx0XHRcdC8vc2V0IGZpbHRlciBkYXRhIGlmIGRlZmluZWRcblxuXHRcdFx0aWYgKG9wdGlvbnMuYWpheEZpbHRlcmluZykge1xuXG5cdFx0XHRcdHZhciBmaWx0ZXJzID0gdGhpcy50YWJsZS5tb2R1bGVzLmZpbHRlci5nZXRGaWx0ZXJzKHRydWUsIHRydWUpO1xuXG5cdFx0XHRcdHBhcmFtc1t0aGlzLnRhYmxlLm1vZHVsZXMucGFnZS5wYWdpbmF0aW9uRGF0YVNlbnROYW1lcy5maWx0ZXJzXSA9IGZpbHRlcnM7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5hamF4LnNldFBhcmFtcyhwYXJhbXMsIHRydWUpO1xuXHRcdH1cblxuXHRcdHRhYmxlLm1vZHVsZXMuYWpheC5zZW5kUmVxdWVzdCgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcblxuXHRcdFx0X3RoaXMxMy5fc2V0RGF0YUFjdHVhbChkYXRhLCB0cnVlKTtcblx0XHR9KS5jYXRjaChmdW5jdGlvbiAoZSkge30pO1xuXHR9O1xuXG5cdC8vY2hvb3NlIHRoZSBwYXRoIHRvIHJlZnJlc2ggZGF0YSBhZnRlciBhIGZpbHRlciB1cGRhdGVcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5maWx0ZXJSZWZyZXNoID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIHRhYmxlID0gdGhpcy50YWJsZSxcblx0XHQgICAgb3B0aW9ucyA9IHRhYmxlLm9wdGlvbnMsXG5cdFx0ICAgIGxlZnQgPSB0aGlzLnNjcm9sbExlZnQ7XG5cblx0XHRpZiAob3B0aW9ucy5hamF4RmlsdGVyaW5nKSB7XG5cblx0XHRcdGlmIChvcHRpb25zLnBhZ2luYXRpb24gPT0gXCJyZW1vdGVcIiAmJiB0YWJsZS5tb2RFeGlzdHMoXCJwYWdlXCIpKSB7XG5cblx0XHRcdFx0dGFibGUubW9kdWxlcy5wYWdlLnJlc2V0KHRydWUpO1xuXG5cdFx0XHRcdHRhYmxlLm1vZHVsZXMucGFnZS5zZXRQYWdlKDEpLnRoZW4oZnVuY3Rpb24gKCkge30pLmNhdGNoKGZ1bmN0aW9uICgpIHt9KTtcblx0XHRcdH0gZWxzZSBpZiAob3B0aW9ucy5hamF4UHJvZ3Jlc3NpdmVMb2FkKSB7XG5cblx0XHRcdFx0dGFibGUubW9kdWxlcy5hamF4LmxvYWREYXRhKCkudGhlbihmdW5jdGlvbiAoKSB7fSkuY2F0Y2goZnVuY3Rpb24gKCkge30pO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHQvL2Fzc3VtZSBkYXRhIGlzIHVybCwgbWFrZSBhamF4IGNhbGwgdG8gdXJsIHRvIGdldCBkYXRhXG5cblx0XHRcdFx0dGhpcy5fZ2VuUmVtb3RlUmVxdWVzdCgpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHRoaXMucmVmcmVzaEFjdGl2ZURhdGEoXCJmaWx0ZXJcIik7XG5cdFx0fVxuXG5cdFx0dGhpcy5zY3JvbGxIb3Jpem9udGFsKGxlZnQpO1xuXHR9O1xuXG5cdC8vY2hvb3NlIHRoZSBwYXRoIHRvIHJlZnJlc2ggZGF0YSBhZnRlciBhIHNvcnRlciB1cGRhdGVcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5zb3J0ZXJSZWZyZXNoID0gZnVuY3Rpb24gKGxvYWRPcmlnbmFsRGF0YSkge1xuXG5cdFx0dmFyIHRhYmxlID0gdGhpcy50YWJsZSxcblx0XHQgICAgb3B0aW9ucyA9IHRoaXMudGFibGUub3B0aW9ucyxcblx0XHQgICAgbGVmdCA9IHRoaXMuc2Nyb2xsTGVmdDtcblxuXHRcdGlmIChvcHRpb25zLmFqYXhTb3J0aW5nKSB7XG5cblx0XHRcdGlmICgob3B0aW9ucy5wYWdpbmF0aW9uID09IFwicmVtb3RlXCIgfHwgb3B0aW9ucy5wcm9ncmVzc2l2ZUxvYWQpICYmIHRhYmxlLm1vZEV4aXN0cyhcInBhZ2VcIikpIHtcblxuXHRcdFx0XHR0YWJsZS5tb2R1bGVzLnBhZ2UucmVzZXQodHJ1ZSk7XG5cblx0XHRcdFx0dGFibGUubW9kdWxlcy5wYWdlLnNldFBhZ2UoMSkudGhlbihmdW5jdGlvbiAoKSB7fSkuY2F0Y2goZnVuY3Rpb24gKCkge30pO1xuXHRcdFx0fSBlbHNlIGlmIChvcHRpb25zLmFqYXhQcm9ncmVzc2l2ZUxvYWQpIHtcblxuXHRcdFx0XHR0YWJsZS5tb2R1bGVzLmFqYXgubG9hZERhdGEoKS50aGVuKGZ1bmN0aW9uICgpIHt9KS5jYXRjaChmdW5jdGlvbiAoKSB7fSk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdC8vYXNzdW1lIGRhdGEgaXMgdXJsLCBtYWtlIGFqYXggY2FsbCB0byB1cmwgdG8gZ2V0IGRhdGFcblxuXHRcdFx0XHR0aGlzLl9nZW5SZW1vdGVSZXF1ZXN0KCk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dGhpcy5yZWZyZXNoQWN0aXZlRGF0YShsb2FkT3JpZ25hbERhdGEgPyBcImZpbHRlclwiIDogXCJzb3J0XCIpO1xuXHRcdH1cblxuXHRcdHRoaXMuc2Nyb2xsSG9yaXpvbnRhbChsZWZ0KTtcblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5zY3JvbGxIb3Jpem9udGFsID0gZnVuY3Rpb24gKGxlZnQpIHtcblxuXHRcdHRoaXMuc2Nyb2xsTGVmdCA9IGxlZnQ7XG5cblx0XHR0aGlzLmVsZW1lbnQuc2Nyb2xsTGVmdCA9IGxlZnQ7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmdyb3VwQnkpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmdyb3VwUm93cy5zY3JvbGxIZWFkZXJzKGxlZnQpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpKSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5zY3JvbGxIb3Jpem9udGFsKGxlZnQpO1xuXHRcdH1cblx0fTtcblxuXHQvL3NldCBhY3RpdmUgZGF0YSBzZXRcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5yZWZyZXNoQWN0aXZlRGF0YSA9IGZ1bmN0aW9uIChzdGFnZSwgc2tpcFN0YWdlLCByZW5kZXJJblBvc2l0aW9uKSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHRhYmxlID0gdGhpcy50YWJsZSxcblx0XHQgICAgY2FzY2FkZU9yZGVyID0gW1wiYWxsXCIsIFwiZmlsdGVyXCIsIFwic29ydFwiLCBcImRpc3BsYXlcIiwgXCJmcmVlemVcIiwgXCJncm91cFwiLCBcInRyZWVcIiwgXCJwYWdlXCJdLFxuXHRcdCAgICBkaXNwbGF5SW5kZXg7XG5cblx0XHRpZiAodGhpcy5yZWRyYXdCbG9jaykge1xuXG5cdFx0XHRpZiAoIXRoaXMucmVkcmF3QmxvY2tSZXN0b3JlQ29uZmlnIHx8IGNhc2NhZGVPcmRlci5pbmRleE9mKHN0YWdlKSA8IGNhc2NhZGVPcmRlci5pbmRleE9mKHRoaXMucmVkcmF3QmxvY2tSZXN0b3JlQ29uZmlnLnN0YWdlKSkge1xuXG5cdFx0XHRcdHRoaXMucmVkcmF3QmxvY2tSZXN0b3JlQ29uZmlnID0ge1xuXG5cdFx0XHRcdFx0c3RhZ2U6IHN0YWdlLFxuXG5cdFx0XHRcdFx0c2tpcFN0YWdlOiBza2lwU3RhZ2UsXG5cblx0XHRcdFx0XHRyZW5kZXJJblBvc2l0aW9uOiByZW5kZXJJblBvc2l0aW9uXG5cblx0XHRcdFx0fTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChzZWxmLnRhYmxlLm1vZEV4aXN0cyhcImVkaXRcIikpIHtcblxuXHRcdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMuZWRpdC5jYW5jZWxFZGl0KCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghc3RhZ2UpIHtcblxuXHRcdFx0XHRzdGFnZSA9IFwiYWxsXCI7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0YWJsZS5vcHRpb25zLnNlbGVjdGFibGUgJiYgIXRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZVBlcnNpc3RlbmNlICYmIHRhYmxlLm1vZEV4aXN0cyhcInNlbGVjdFJvd1wiKSkge1xuXG5cdFx0XHRcdHRhYmxlLm1vZHVsZXMuc2VsZWN0Um93LmRlc2VsZWN0Um93cygpO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2Nhc2NhZGUgdGhyb3VnaCBkYXRhIHJlZnJlc2ggc3RhZ2VzXG5cblx0XHRcdHN3aXRjaCAoc3RhZ2UpIHtcblxuXHRcdFx0XHRjYXNlIFwiYWxsXCI6XG5cblx0XHRcdFx0Y2FzZSBcImZpbHRlclwiOlxuXG5cdFx0XHRcdFx0aWYgKCFza2lwU3RhZ2UpIHtcblxuXHRcdFx0XHRcdFx0aWYgKHRhYmxlLm1vZEV4aXN0cyhcImZpbHRlclwiKSkge1xuXG5cdFx0XHRcdFx0XHRcdHNlbGYuc2V0QWN0aXZlUm93cyh0YWJsZS5tb2R1bGVzLmZpbHRlci5maWx0ZXIoc2VsZi5yb3dzKSk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRcdHNlbGYuc2V0QWN0aXZlUm93cyhzZWxmLnJvd3Muc2xpY2UoMCkpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdHNraXBTdGFnZSA9IGZhbHNlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRjYXNlIFwic29ydFwiOlxuXG5cdFx0XHRcdFx0aWYgKCFza2lwU3RhZ2UpIHtcblxuXHRcdFx0XHRcdFx0aWYgKHRhYmxlLm1vZEV4aXN0cyhcInNvcnRcIikpIHtcblxuXHRcdFx0XHRcdFx0XHR0YWJsZS5tb2R1bGVzLnNvcnQuc29ydCh0aGlzLmFjdGl2ZVJvd3MpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdHNraXBTdGFnZSA9IGZhbHNlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vcmVnZW5lcmF0ZSByb3cgbnVtYmVycyBmb3Igcm93IG51bWJlciBmb3JtYXR0ZXIgaWYgaW4gdXNlXG5cblx0XHRcdFx0XHR0aGlzLnJlZ2VuZXJhdGVSb3dOdW1iZXJzKCk7XG5cblx0XHRcdFx0Ly9nZW5lcmljIHN0YWdlIHRvIGFsbG93IGZvciBwaXBlbGluZSB0cmlnZ2VyIGFmdGVyIHRoZSBkYXRhIG1hbmlwdWxhdGlvbiBzdGFnZVxuXG5cdFx0XHRcdGNhc2UgXCJkaXNwbGF5XCI6XG5cblx0XHRcdFx0XHR0aGlzLnJlc2V0RGlzcGxheVJvd3MoKTtcblxuXHRcdFx0XHRjYXNlIFwiZnJlZXplXCI6XG5cblx0XHRcdFx0XHRpZiAoIXNraXBTdGFnZSkge1xuXG5cdFx0XHRcdFx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJmcm96ZW5Sb3dzXCIpKSB7XG5cblx0XHRcdFx0XHRcdFx0aWYgKHRhYmxlLm1vZHVsZXMuZnJvemVuUm93cy5pc0Zyb3plbigpKSB7XG5cblx0XHRcdFx0XHRcdFx0XHRpZiAoIXRhYmxlLm1vZHVsZXMuZnJvemVuUm93cy5nZXREaXNwbGF5SW5kZXgoKSkge1xuXG5cdFx0XHRcdFx0XHRcdFx0XHR0YWJsZS5tb2R1bGVzLmZyb3plblJvd3Muc2V0RGlzcGxheUluZGV4KHRoaXMuZ2V0TmV4dERpc3BsYXlJbmRleCgpKTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRkaXNwbGF5SW5kZXggPSB0YWJsZS5tb2R1bGVzLmZyb3plblJvd3MuZ2V0RGlzcGxheUluZGV4KCk7XG5cblx0XHRcdFx0XHRcdFx0XHRkaXNwbGF5SW5kZXggPSBzZWxmLnNldERpc3BsYXlSb3dzKHRhYmxlLm1vZHVsZXMuZnJvemVuUm93cy5nZXRSb3dzKHRoaXMuZ2V0RGlzcGxheVJvd3MoZGlzcGxheUluZGV4IC0gMSkpLCBkaXNwbGF5SW5kZXgpO1xuXG5cdFx0XHRcdFx0XHRcdFx0aWYgKGRpc3BsYXlJbmRleCAhPT0gdHJ1ZSkge1xuXG5cdFx0XHRcdFx0XHRcdFx0XHR0YWJsZS5tb2R1bGVzLmZyb3plblJvd3Muc2V0RGlzcGxheUluZGV4KGRpc3BsYXlJbmRleCk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0c2tpcFN0YWdlID0gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdGNhc2UgXCJncm91cFwiOlxuXG5cdFx0XHRcdFx0aWYgKCFza2lwU3RhZ2UpIHtcblxuXHRcdFx0XHRcdFx0aWYgKHRhYmxlLm9wdGlvbnMuZ3JvdXBCeSAmJiB0YWJsZS5tb2RFeGlzdHMoXCJncm91cFJvd3NcIikpIHtcblxuXHRcdFx0XHRcdFx0XHRpZiAoIXRhYmxlLm1vZHVsZXMuZ3JvdXBSb3dzLmdldERpc3BsYXlJbmRleCgpKSB7XG5cblx0XHRcdFx0XHRcdFx0XHR0YWJsZS5tb2R1bGVzLmdyb3VwUm93cy5zZXREaXNwbGF5SW5kZXgodGhpcy5nZXROZXh0RGlzcGxheUluZGV4KCkpO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0ZGlzcGxheUluZGV4ID0gdGFibGUubW9kdWxlcy5ncm91cFJvd3MuZ2V0RGlzcGxheUluZGV4KCk7XG5cblx0XHRcdFx0XHRcdFx0ZGlzcGxheUluZGV4ID0gc2VsZi5zZXREaXNwbGF5Um93cyh0YWJsZS5tb2R1bGVzLmdyb3VwUm93cy5nZXRSb3dzKHRoaXMuZ2V0RGlzcGxheVJvd3MoZGlzcGxheUluZGV4IC0gMSkpLCBkaXNwbGF5SW5kZXgpO1xuXG5cdFx0XHRcdFx0XHRcdGlmIChkaXNwbGF5SW5kZXggIT09IHRydWUpIHtcblxuXHRcdFx0XHRcdFx0XHRcdHRhYmxlLm1vZHVsZXMuZ3JvdXBSb3dzLnNldERpc3BsYXlJbmRleChkaXNwbGF5SW5kZXgpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0c2tpcFN0YWdlID0gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdGNhc2UgXCJ0cmVlXCI6XG5cblx0XHRcdFx0XHRpZiAoIXNraXBTdGFnZSkge1xuXG5cdFx0XHRcdFx0XHRpZiAodGFibGUub3B0aW9ucy5kYXRhVHJlZSAmJiB0YWJsZS5tb2RFeGlzdHMoXCJkYXRhVHJlZVwiKSkge1xuXG5cdFx0XHRcdFx0XHRcdGlmICghdGFibGUubW9kdWxlcy5kYXRhVHJlZS5nZXREaXNwbGF5SW5kZXgoKSkge1xuXG5cdFx0XHRcdFx0XHRcdFx0dGFibGUubW9kdWxlcy5kYXRhVHJlZS5zZXREaXNwbGF5SW5kZXgodGhpcy5nZXROZXh0RGlzcGxheUluZGV4KCkpO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0ZGlzcGxheUluZGV4ID0gdGFibGUubW9kdWxlcy5kYXRhVHJlZS5nZXREaXNwbGF5SW5kZXgoKTtcblxuXHRcdFx0XHRcdFx0XHRkaXNwbGF5SW5kZXggPSBzZWxmLnNldERpc3BsYXlSb3dzKHRhYmxlLm1vZHVsZXMuZGF0YVRyZWUuZ2V0Um93cyh0aGlzLmdldERpc3BsYXlSb3dzKGRpc3BsYXlJbmRleCAtIDEpKSwgZGlzcGxheUluZGV4KTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoZGlzcGxheUluZGV4ICE9PSB0cnVlKSB7XG5cblx0XHRcdFx0XHRcdFx0XHR0YWJsZS5tb2R1bGVzLmRhdGFUcmVlLnNldERpc3BsYXlJbmRleChkaXNwbGF5SW5kZXgpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0c2tpcFN0YWdlID0gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHRhYmxlLm9wdGlvbnMucGFnaW5hdGlvbiAmJiB0YWJsZS5tb2RFeGlzdHMoXCJwYWdlXCIpICYmICFyZW5kZXJJblBvc2l0aW9uKSB7XG5cblx0XHRcdFx0XHRcdGlmICh0YWJsZS5tb2R1bGVzLnBhZ2UuZ2V0TW9kZSgpID09IFwibG9jYWxcIikge1xuXG5cdFx0XHRcdFx0XHRcdHRhYmxlLm1vZHVsZXMucGFnZS5yZXNldCgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRjYXNlIFwicGFnZVwiOlxuXG5cdFx0XHRcdFx0aWYgKCFza2lwU3RhZ2UpIHtcblxuXHRcdFx0XHRcdFx0aWYgKHRhYmxlLm9wdGlvbnMucGFnaW5hdGlvbiAmJiB0YWJsZS5tb2RFeGlzdHMoXCJwYWdlXCIpKSB7XG5cblx0XHRcdFx0XHRcdFx0aWYgKCF0YWJsZS5tb2R1bGVzLnBhZ2UuZ2V0RGlzcGxheUluZGV4KCkpIHtcblxuXHRcdFx0XHRcdFx0XHRcdHRhYmxlLm1vZHVsZXMucGFnZS5zZXREaXNwbGF5SW5kZXgodGhpcy5nZXROZXh0RGlzcGxheUluZGV4KCkpO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0ZGlzcGxheUluZGV4ID0gdGFibGUubW9kdWxlcy5wYWdlLmdldERpc3BsYXlJbmRleCgpO1xuXG5cdFx0XHRcdFx0XHRcdGlmICh0YWJsZS5tb2R1bGVzLnBhZ2UuZ2V0TW9kZSgpID09IFwibG9jYWxcIikge1xuXG5cdFx0XHRcdFx0XHRcdFx0dGFibGUubW9kdWxlcy5wYWdlLnNldE1heFJvd3ModGhpcy5nZXREaXNwbGF5Um93cyhkaXNwbGF5SW5kZXggLSAxKS5sZW5ndGgpO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0ZGlzcGxheUluZGV4ID0gc2VsZi5zZXREaXNwbGF5Um93cyh0YWJsZS5tb2R1bGVzLnBhZ2UuZ2V0Um93cyh0aGlzLmdldERpc3BsYXlSb3dzKGRpc3BsYXlJbmRleCAtIDEpKSwgZGlzcGxheUluZGV4KTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoZGlzcGxheUluZGV4ICE9PSB0cnVlKSB7XG5cblx0XHRcdFx0XHRcdFx0XHR0YWJsZS5tb2R1bGVzLnBhZ2Uuc2V0RGlzcGxheUluZGV4KGRpc3BsYXlJbmRleCk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRza2lwU3RhZ2UgPSBmYWxzZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdH1cblxuXHRcdFx0aWYgKFRhYnVsYXRvci5wcm90b3R5cGUuaGVscGVycy5lbFZpc2libGUoc2VsZi5lbGVtZW50KSkge1xuXG5cdFx0XHRcdGlmIChyZW5kZXJJblBvc2l0aW9uKSB7XG5cblx0XHRcdFx0XHRzZWxmLnJlUmVuZGVySW5Qb3NpdGlvbigpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0c2VsZi5yZW5kZXJUYWJsZSgpO1xuXG5cdFx0XHRcdFx0aWYgKHRhYmxlLm9wdGlvbnMubGF5b3V0Q29sdW1uc09uTmV3RGF0YSkge1xuXG5cdFx0XHRcdFx0XHRzZWxmLnRhYmxlLmNvbHVtbk1hbmFnZXIucmVkcmF3KHRydWUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGFibGUubW9kRXhpc3RzKFwiY29sdW1uQ2FsY3NcIikpIHtcblxuXHRcdFx0XHR0YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLnJlY2FsYyh0aGlzLmFjdGl2ZVJvd3MpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHQvL3JlZ2VuZXJhdGUgcm93IG51bWJlcnMgZm9yIHJvdyBudW1iZXIgZm9ybWF0dGVyIGlmIGluIHVzZVxuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLnJlZ2VuZXJhdGVSb3dOdW1iZXJzID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBfdGhpczE0ID0gdGhpcztcblxuXHRcdGlmICh0aGlzLnJvd051bUNvbHVtbikge1xuXG5cdFx0XHR0aGlzLmFjdGl2ZVJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cblx0XHRcdFx0dmFyIGNlbGwgPSByb3cuZ2V0Q2VsbChfdGhpczE0LnJvd051bUNvbHVtbik7XG5cblx0XHRcdFx0aWYgKGNlbGwpIHtcblxuXHRcdFx0XHRcdGNlbGwuX2dlbmVyYXRlQ29udGVudHMoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLnNldEFjdGl2ZVJvd3MgPSBmdW5jdGlvbiAoYWN0aXZlUm93cykge1xuXG5cdFx0dGhpcy5hY3RpdmVSb3dzID0gYWN0aXZlUm93cztcblxuXHRcdHRoaXMuYWN0aXZlUm93c0NvdW50ID0gdGhpcy5hY3RpdmVSb3dzLmxlbmd0aDtcblx0fTtcblxuXHQvL3Jlc2V0IGRpc3BsYXkgcm93cyBhcnJheVxuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLnJlc2V0RGlzcGxheVJvd3MgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLmRpc3BsYXlSb3dzID0gW107XG5cblx0XHR0aGlzLmRpc3BsYXlSb3dzLnB1c2godGhpcy5hY3RpdmVSb3dzLnNsaWNlKDApKTtcblxuXHRcdHRoaXMuZGlzcGxheVJvd3NDb3VudCA9IHRoaXMuZGlzcGxheVJvd3NbMF0ubGVuZ3RoO1xuXG5cdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwiZnJvemVuUm93c1wiKSkge1xuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZnJvemVuUm93cy5zZXREaXNwbGF5SW5kZXgoMCk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiZ3JvdXBSb3dzXCIpKSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5ncm91cFJvd3Muc2V0RGlzcGxheUluZGV4KDApO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvbiAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInBhZ2VcIikpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnBhZ2Uuc2V0RGlzcGxheUluZGV4KDApO1xuXHRcdH1cblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5nZXROZXh0RGlzcGxheUluZGV4ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuZGlzcGxheVJvd3MubGVuZ3RoO1xuXHR9O1xuXG5cdC8vc2V0IGRpc3BsYXkgcm93IHBpcGVsaW5lIGRhdGFcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5zZXREaXNwbGF5Um93cyA9IGZ1bmN0aW9uIChkaXNwbGF5Um93cywgaW5kZXgpIHtcblxuXHRcdHZhciBvdXRwdXQgPSB0cnVlO1xuXG5cdFx0aWYgKGluZGV4ICYmIHR5cGVvZiB0aGlzLmRpc3BsYXlSb3dzW2luZGV4XSAhPSBcInVuZGVmaW5lZFwiKSB7XG5cblx0XHRcdHRoaXMuZGlzcGxheVJvd3NbaW5kZXhdID0gZGlzcGxheVJvd3M7XG5cblx0XHRcdG91dHB1dCA9IHRydWU7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dGhpcy5kaXNwbGF5Um93cy5wdXNoKGRpc3BsYXlSb3dzKTtcblxuXHRcdFx0b3V0cHV0ID0gaW5kZXggPSB0aGlzLmRpc3BsYXlSb3dzLmxlbmd0aCAtIDE7XG5cdFx0fVxuXG5cdFx0aWYgKGluZGV4ID09IHRoaXMuZGlzcGxheVJvd3MubGVuZ3RoIC0gMSkge1xuXG5cdFx0XHR0aGlzLmRpc3BsYXlSb3dzQ291bnQgPSB0aGlzLmRpc3BsYXlSb3dzW3RoaXMuZGlzcGxheVJvd3MubGVuZ3RoIC0gMV0ubGVuZ3RoO1xuXHRcdH1cblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuZ2V0RGlzcGxheVJvd3MgPSBmdW5jdGlvbiAoaW5kZXgpIHtcblxuXHRcdGlmICh0eXBlb2YgaW5kZXggPT0gXCJ1bmRlZmluZWRcIikge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5kaXNwbGF5Um93cy5sZW5ndGggPyB0aGlzLmRpc3BsYXlSb3dzW3RoaXMuZGlzcGxheVJvd3MubGVuZ3RoIC0gMV0gOiBbXTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5kaXNwbGF5Um93c1tpbmRleF0gfHwgW107XG5cdFx0fVxuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLmdldFZpc2libGVSb3dzID0gZnVuY3Rpb24gKHZpZXdhYmxlKSB7XG5cblx0XHR2YXIgdG9wRWRnZSA9IHRoaXMuZWxlbWVudC5zY3JvbGxUb3AsXG5cdFx0ICAgIGJvdHRvbUVkZ2UgPSB0aGlzLmVsZW1lbnQuY2xpZW50SGVpZ2h0ICsgdG9wRWRnZSxcblx0XHQgICAgdG9wRm91bmQgPSBmYWxzZSxcblx0XHQgICAgdG9wUm93ID0gMCxcblx0XHQgICAgYm90dG9tUm93ID0gMCxcblx0XHQgICAgcm93cyA9IHRoaXMuZ2V0RGlzcGxheVJvd3MoKTtcblxuXHRcdGlmICh2aWV3YWJsZSkge1xuXG5cdFx0XHR0aGlzLmdldERpc3BsYXlSb3dzKCk7XG5cblx0XHRcdGZvciAodmFyIGkgPSB0aGlzLnZEb21Ub3A7IGkgPD0gdGhpcy52RG9tQm90dG9tOyBpKyspIHtcblxuXHRcdFx0XHRpZiAocm93c1tpXSkge1xuXG5cdFx0XHRcdFx0aWYgKCF0b3BGb3VuZCkge1xuXG5cdFx0XHRcdFx0XHRpZiAodG9wRWRnZSAtIHJvd3NbaV0uZ2V0RWxlbWVudCgpLm9mZnNldFRvcCA+PSAwKSB7XG5cblx0XHRcdFx0XHRcdFx0dG9wUm93ID0gaTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdFx0dG9wRm91bmQgPSB0cnVlO1xuXG5cdFx0XHRcdFx0XHRcdGlmIChib3R0b21FZGdlIC0gcm93c1tpXS5nZXRFbGVtZW50KCkub2Zmc2V0VG9wID49IDApIHtcblxuXHRcdFx0XHRcdFx0XHRcdGJvdHRvbVJvdyA9IGk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdGlmIChib3R0b21FZGdlIC0gcm93c1tpXS5nZXRFbGVtZW50KCkub2Zmc2V0VG9wID49IDApIHtcblxuXHRcdFx0XHRcdFx0XHRib3R0b21Sb3cgPSBpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHR0b3BSb3cgPSB0aGlzLnZEb21Ub3A7XG5cblx0XHRcdGJvdHRvbVJvdyA9IHRoaXMudkRvbUJvdHRvbTtcblx0XHR9XG5cblx0XHRyZXR1cm4gcm93cy5zbGljZSh0b3BSb3csIGJvdHRvbVJvdyArIDEpO1xuXHR9O1xuXG5cdC8vcmVwZWF0IGFjdGlvbiBhY2Nyb3NzIGRpc3BsYXkgcm93c1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLmRpc3BsYXlSb3dJdGVyYXRvciA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuXG5cdFx0dGhpcy5kaXNwbGF5Um93cy5mb3JFYWNoKGNhbGxiYWNrKTtcblxuXHRcdHRoaXMuZGlzcGxheVJvd3NDb3VudCA9IHRoaXMuZGlzcGxheVJvd3NbdGhpcy5kaXNwbGF5Um93cy5sZW5ndGggLSAxXS5sZW5ndGg7XG5cdH07XG5cblx0Ly9yZXR1cm4gb25seSBhY3R1YWwgcm93cyAobm90IGdyb3VwIGhlYWRlcnMgZXRjKVxuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLmdldFJvd3MgPSBmdW5jdGlvbiAoYWN0aXZlKSB7XG5cblx0XHR2YXIgcm93cztcblxuXHRcdHN3aXRjaCAoYWN0aXZlKSB7XG5cblx0XHRcdGNhc2UgXCJhY3RpdmVcIjpcblxuXHRcdFx0XHRyb3dzID0gdGhpcy5hY3RpdmVSb3dzO1xuXG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiZGlzcGxheVwiOlxuXG5cdFx0XHRcdHJvd3MgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0RGlzcGxheVJvd3MoKTtcblxuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcInZpc2libGVcIjpcblxuXHRcdFx0XHRyb3dzID0gdGhpcy5nZXRWaXNpYmxlUm93cyh0cnVlKTtcblxuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0ZGVmYXVsdDpcblxuXHRcdFx0XHRyb3dzID0gdGhpcy5yb3dzO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJvd3M7XG5cdH07XG5cblx0Ly8vLy8vLy8vLy8vLy8vLy8gVGFibGUgUmVuZGVyaW5nIC8vLy8vLy8vLy8vLy8vLy8vXG5cblxuXHQvL3RyaWdnZXIgcmVyZW5kZXIgb2YgdGFibGUgaW4gY3VycmVudCBwb3NpdGlvblxuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLnJlUmVuZGVySW5Qb3NpdGlvbiA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuXG5cdFx0aWYgKHRoaXMuZ2V0UmVuZGVyTW9kZSgpID09IFwidmlydHVhbFwiKSB7XG5cblx0XHRcdGlmICh0aGlzLnJlZHJhd0Jsb2NrKSB7XG5cblx0XHRcdFx0aWYgKGNhbGxiYWNrKSB7XG5cblx0XHRcdFx0XHRjYWxsYmFjaygpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0dGhpcy5yZWRyYXdCbG9ja1JlZGVySW5Qb3NpdGlvbiA9IHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0dmFyIHNjcm9sbFRvcCA9IHRoaXMuZWxlbWVudC5zY3JvbGxUb3A7XG5cblx0XHRcdFx0dmFyIHRvcFJvdyA9IGZhbHNlO1xuXG5cdFx0XHRcdHZhciB0b3BPZmZzZXQgPSBmYWxzZTtcblxuXHRcdFx0XHR2YXIgbGVmdCA9IHRoaXMuc2Nyb2xsTGVmdDtcblxuXHRcdFx0XHR2YXIgcm93cyA9IHRoaXMuZ2V0RGlzcGxheVJvd3MoKTtcblxuXHRcdFx0XHRmb3IgKHZhciBpID0gdGhpcy52RG9tVG9wOyBpIDw9IHRoaXMudkRvbUJvdHRvbTsgaSsrKSB7XG5cblx0XHRcdFx0XHRpZiAocm93c1tpXSkge1xuXG5cdFx0XHRcdFx0XHR2YXIgZGlmZiA9IHNjcm9sbFRvcCAtIHJvd3NbaV0uZ2V0RWxlbWVudCgpLm9mZnNldFRvcDtcblxuXHRcdFx0XHRcdFx0aWYgKHRvcE9mZnNldCA9PT0gZmFsc2UgfHwgTWF0aC5hYnMoZGlmZikgPCB0b3BPZmZzZXQpIHtcblxuXHRcdFx0XHRcdFx0XHR0b3BPZmZzZXQgPSBkaWZmO1xuXG5cdFx0XHRcdFx0XHRcdHRvcFJvdyA9IGk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChjYWxsYmFjaykge1xuXG5cdFx0XHRcdFx0Y2FsbGJhY2soKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRoaXMuX3ZpcnR1YWxSZW5kZXJGaWxsKHRvcFJvdyA9PT0gZmFsc2UgPyB0aGlzLmRpc3BsYXlSb3dzQ291bnQgLSAxIDogdG9wUm93LCB0cnVlLCB0b3BPZmZzZXQgfHwgMCk7XG5cblx0XHRcdFx0dGhpcy5zY3JvbGxIb3Jpem9udGFsKGxlZnQpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHRoaXMucmVuZGVyVGFibGUoKTtcblxuXHRcdFx0aWYgKGNhbGxiYWNrKSB7XG5cblx0XHRcdFx0Y2FsbGJhY2soKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuc2V0UmVuZGVyTW9kZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMudmlydHVhbERvbSkge1xuXG5cdFx0XHR0aGlzLnJlbmRlck1vZGUgPSBcInZpcnR1YWxcIjtcblxuXHRcdFx0aWYgKHRoaXMudGFibGUuZWxlbWVudC5jbGllbnRIZWlnaHQgfHwgdGhpcy50YWJsZS5vcHRpb25zLmhlaWdodCkge1xuXG5cdFx0XHRcdHRoaXMuZml4ZWRIZWlnaHQgPSB0cnVlO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHR0aGlzLmZpeGVkSGVpZ2h0ID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dGhpcy5yZW5kZXJNb2RlID0gXCJjbGFzc2ljXCI7XG5cdFx0fVxuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLmdldFJlbmRlck1vZGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5yZW5kZXJNb2RlO1xuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLnJlbmRlclRhYmxlID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy50YWJsZS5vcHRpb25zLnJlbmRlclN0YXJ0ZWQuY2FsbCh0aGlzLnRhYmxlKTtcblxuXHRcdHRoaXMuZWxlbWVudC5zY3JvbGxUb3AgPSAwO1xuXG5cdFx0c3dpdGNoICh0aGlzLnJlbmRlck1vZGUpIHtcblxuXHRcdFx0Y2FzZSBcImNsYXNzaWNcIjpcblxuXHRcdFx0XHR0aGlzLl9zaW1wbGVSZW5kZXIoKTtcblxuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcInZpcnR1YWxcIjpcblxuXHRcdFx0XHR0aGlzLl92aXJ0dWFsUmVuZGVyRmlsbCgpO1xuXG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMuZmlyc3RSZW5kZXIpIHtcblxuXHRcdFx0aWYgKHRoaXMuZGlzcGxheVJvd3NDb3VudCkge1xuXG5cdFx0XHRcdHRoaXMuZmlyc3RSZW5kZXIgPSBmYWxzZTtcblxuXHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMubGF5b3V0LmxheW91dCgpO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHR0aGlzLnJlbmRlckVtcHR5U2Nyb2xsKCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwiZnJvemVuQ29sdW1uc1wiKSkge1xuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZnJvemVuQ29sdW1ucy5sYXlvdXQoKTtcblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuZGlzcGxheVJvd3NDb3VudCkge1xuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnBsYWNlaG9sZGVyKSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLnBsYWNlaG9sZGVyLnNldEF0dHJpYnV0ZShcInRhYnVsYXRvci1yZW5kZXItbW9kZVwiLCB0aGlzLnJlbmRlck1vZGUpO1xuXG5cdFx0XHRcdHRoaXMuZ2V0RWxlbWVudCgpLmFwcGVuZENoaWxkKHRoaXMudGFibGUub3B0aW9ucy5wbGFjZWhvbGRlcik7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLnBsYWNlaG9sZGVyLnN0eWxlLndpZHRoID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldFdpZHRoKCkgKyBcInB4XCI7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0dGhpcy50YWJsZS5vcHRpb25zLnJlbmRlckNvbXBsZXRlLmNhbGwodGhpcy50YWJsZSk7XG5cdH07XG5cblx0Ly9zaW1wbGUgcmVuZGVyIG9uIGhlaWdodGxlc3MgdGFibGVcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5fc2ltcGxlUmVuZGVyID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5fY2xlYXJWaXJ0dWFsRG9tKCk7XG5cblx0XHRpZiAodGhpcy5kaXNwbGF5Um93c0NvdW50KSB7XG5cblx0XHRcdHRoaXMuY2hlY2tDbGFzc2ljTW9kZUdyb3VwSGVhZGVyV2lkdGgoKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHR0aGlzLnJlbmRlckVtcHR5U2Nyb2xsKCk7XG5cdFx0fVxuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLmNoZWNrQ2xhc3NpY01vZGVHcm91cEhlYWRlcldpZHRoID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBlbGVtZW50ID0gdGhpcy50YWJsZUVsZW1lbnQsXG5cdFx0ICAgIG9ubHlHcm91cEhlYWRlcnMgPSB0cnVlO1xuXG5cdFx0c2VsZi5nZXREaXNwbGF5Um93cygpLmZvckVhY2goZnVuY3Rpb24gKHJvdywgaW5kZXgpIHtcblxuXHRcdFx0c2VsZi5zdHlsZVJvdyhyb3csIGluZGV4KTtcblxuXHRcdFx0ZWxlbWVudC5hcHBlbmRDaGlsZChyb3cuZ2V0RWxlbWVudCgpKTtcblxuXHRcdFx0cm93LmluaXRpYWxpemUodHJ1ZSk7XG5cblx0XHRcdGlmIChyb3cudHlwZSAhPT0gXCJncm91cFwiKSB7XG5cblx0XHRcdFx0b25seUdyb3VwSGVhZGVycyA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0aWYgKG9ubHlHcm91cEhlYWRlcnMpIHtcblxuXHRcdFx0ZWxlbWVudC5zdHlsZS5taW5XaWR0aCA9IHNlbGYudGFibGUuY29sdW1uTWFuYWdlci5nZXRXaWR0aCgpICsgXCJweFwiO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGVsZW1lbnQuc3R5bGUubWluV2lkdGggPSBcIlwiO1xuXHRcdH1cblx0fTtcblxuXHQvL3Nob3cgc2Nyb2xsYmFycyBvbiBlbXB0eSB0YWJsZSBkaXZcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5yZW5kZXJFbXB0eVNjcm9sbCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMucGxhY2Vob2xkZXIpIHtcblxuXHRcdFx0dGhpcy50YWJsZUVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHRoaXMudGFibGVFbGVtZW50LnN0eWxlLm1pbldpZHRoID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldFdpZHRoKCkgKyBcInB4XCI7XG5cblx0XHRcdHRoaXMudGFibGVFbGVtZW50LnN0eWxlLm1pbkhlaWdodCA9IFwiMXB4XCI7XG5cblx0XHRcdHRoaXMudGFibGVFbGVtZW50LnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xuXHRcdH1cblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5fY2xlYXJWaXJ0dWFsRG9tID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGVsZW1lbnQgPSB0aGlzLnRhYmxlRWxlbWVudDtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMucGxhY2Vob2xkZXIgJiYgdGhpcy50YWJsZS5vcHRpb25zLnBsYWNlaG9sZGVyLnBhcmVudE5vZGUpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLnBsYWNlaG9sZGVyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy50YWJsZS5vcHRpb25zLnBsYWNlaG9sZGVyKTtcblx0XHR9XG5cblx0XHQvLyBlbGVtZW50LmNoaWxkcmVuLmRldGFjaCgpO1xuXG5cdFx0d2hpbGUgKGVsZW1lbnQuZmlyc3RDaGlsZCkge1xuXHRcdFx0ZWxlbWVudC5yZW1vdmVDaGlsZChlbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHRcdH1lbGVtZW50LnN0eWxlLnBhZGRpbmdUb3AgPSBcIlwiO1xuXG5cdFx0ZWxlbWVudC5zdHlsZS5wYWRkaW5nQm90dG9tID0gXCJcIjtcblxuXHRcdGVsZW1lbnQuc3R5bGUubWluV2lkdGggPSBcIlwiO1xuXG5cdFx0ZWxlbWVudC5zdHlsZS5taW5IZWlnaHQgPSBcIlwiO1xuXG5cdFx0ZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcblxuXHRcdGVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9IFwiXCI7XG5cblx0XHR0aGlzLnNjcm9sbFRvcCA9IDA7XG5cblx0XHR0aGlzLnNjcm9sbExlZnQgPSAwO1xuXG5cdFx0dGhpcy52RG9tVG9wID0gMDtcblxuXHRcdHRoaXMudkRvbUJvdHRvbSA9IDA7XG5cblx0XHR0aGlzLnZEb21Ub3BQYWQgPSAwO1xuXG5cdFx0dGhpcy52RG9tQm90dG9tUGFkID0gMDtcblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5zdHlsZVJvdyA9IGZ1bmN0aW9uIChyb3csIGluZGV4KSB7XG5cblx0XHR2YXIgcm93RWwgPSByb3cuZ2V0RWxlbWVudCgpO1xuXG5cdFx0aWYgKGluZGV4ICUgMikge1xuXG5cdFx0XHRyb3dFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXJvdy1ldmVuXCIpO1xuXG5cdFx0XHRyb3dFbC5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLXJvdy1vZGRcIik7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0cm93RWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1yb3ctb2RkXCIpO1xuXG5cdFx0XHRyb3dFbC5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLXJvdy1ldmVuXCIpO1xuXHRcdH1cblx0fTtcblxuXHQvL2Z1bGwgdmlydHVhbCByZW5kZXJcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5fdmlydHVhbFJlbmRlckZpbGwgPSBmdW5jdGlvbiAocG9zaXRpb24sIGZvcmNlTW92ZSwgb2Zmc2V0KSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGVsZW1lbnQgPSBzZWxmLnRhYmxlRWxlbWVudCxcblx0XHQgICAgaG9sZGVyID0gc2VsZi5lbGVtZW50LFxuXHRcdCAgICB0b3BQYWQgPSAwLFxuXHRcdCAgICByb3dzSGVpZ2h0ID0gMCxcblx0XHQgICAgdG9wUGFkSGVpZ2h0ID0gMCxcblx0XHQgICAgaSA9IDAsXG5cdFx0ICAgIG9ubHlHcm91cEhlYWRlcnMgPSB0cnVlLFxuXHRcdCAgICByb3dzID0gc2VsZi5nZXREaXNwbGF5Um93cygpO1xuXG5cdFx0cG9zaXRpb24gPSBwb3NpdGlvbiB8fCAwO1xuXG5cdFx0b2Zmc2V0ID0gb2Zmc2V0IHx8IDA7XG5cblx0XHRpZiAoIXBvc2l0aW9uKSB7XG5cblx0XHRcdHNlbGYuX2NsZWFyVmlydHVhbERvbSgpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHdoaWxlIChlbGVtZW50LmZpcnN0Q2hpbGQpIHtcblx0XHRcdFx0ZWxlbWVudC5yZW1vdmVDaGlsZChlbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHRcdFx0fSAvL2NoZWNrIGlmIHBvc2l0aW9uIGlzIHRvbyBjbG9zZSB0byBib3R0b20gb2YgdGFibGVcblxuXHRcdFx0dmFyIGhlaWdodE9jY3VwaWVkID0gKHNlbGYuZGlzcGxheVJvd3NDb3VudCAtIHBvc2l0aW9uICsgMSkgKiBzZWxmLnZEb21Sb3dIZWlnaHQ7XG5cblx0XHRcdGlmIChoZWlnaHRPY2N1cGllZCA8IHNlbGYuaGVpZ2h0KSB7XG5cblx0XHRcdFx0cG9zaXRpb24gLT0gTWF0aC5jZWlsKChzZWxmLmhlaWdodCAtIGhlaWdodE9jY3VwaWVkKSAvIHNlbGYudkRvbVJvd0hlaWdodCk7XG5cblx0XHRcdFx0aWYgKHBvc2l0aW9uIDwgMCkge1xuXG5cdFx0XHRcdFx0cG9zaXRpb24gPSAwO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vY2FsY3VsYXRlIGluaXRpYWwgcGFkXG5cblx0XHRcdHRvcFBhZCA9IE1hdGgubWluKE1hdGgubWF4KE1hdGguZmxvb3Ioc2VsZi52RG9tV2luZG93QnVmZmVyIC8gc2VsZi52RG9tUm93SGVpZ2h0KSwgc2VsZi52RG9tV2luZG93TWluTWFyZ2luUm93cyksIHBvc2l0aW9uKTtcblxuXHRcdFx0cG9zaXRpb24gLT0gdG9wUGFkO1xuXHRcdH1cblxuXHRcdGlmIChzZWxmLmRpc3BsYXlSb3dzQ291bnQgJiYgVGFidWxhdG9yLnByb3RvdHlwZS5oZWxwZXJzLmVsVmlzaWJsZShzZWxmLmVsZW1lbnQpKSB7XG5cblx0XHRcdHNlbGYudkRvbVRvcCA9IHBvc2l0aW9uO1xuXG5cdFx0XHRzZWxmLnZEb21Cb3R0b20gPSBwb3NpdGlvbiAtIDE7XG5cblx0XHRcdHdoaWxlICgocm93c0hlaWdodCA8PSBzZWxmLmhlaWdodCArIHNlbGYudkRvbVdpbmRvd0J1ZmZlciB8fCBpIDwgc2VsZi52RG9tV2luZG93TWluVG90YWxSb3dzKSAmJiBzZWxmLnZEb21Cb3R0b20gPCBzZWxmLmRpc3BsYXlSb3dzQ291bnQgLSAxKSB7XG5cblx0XHRcdFx0dmFyIGluZGV4ID0gc2VsZi52RG9tQm90dG9tICsgMSxcblx0XHRcdFx0ICAgIHJvdyA9IHJvd3NbaW5kZXhdLFxuXHRcdFx0XHQgICAgcm93SGVpZ2h0ID0gMDtcblxuXHRcdFx0XHRzZWxmLnN0eWxlUm93KHJvdywgaW5kZXgpO1xuXG5cdFx0XHRcdGVsZW1lbnQuYXBwZW5kQ2hpbGQocm93LmdldEVsZW1lbnQoKSk7XG5cblx0XHRcdFx0aWYgKCFyb3cuaW5pdGlhbGl6ZWQpIHtcblxuXHRcdFx0XHRcdHJvdy5pbml0aWFsaXplKHRydWUpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0aWYgKCFyb3cuaGVpZ2h0SW5pdGlhbGl6ZWQpIHtcblxuXHRcdFx0XHRcdFx0cm93Lm5vcm1hbGl6ZUhlaWdodCh0cnVlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyb3dIZWlnaHQgPSByb3cuZ2V0SGVpZ2h0KCk7XG5cblx0XHRcdFx0aWYgKGkgPCB0b3BQYWQpIHtcblxuXHRcdFx0XHRcdHRvcFBhZEhlaWdodCArPSByb3dIZWlnaHQ7XG5cdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRyb3dzSGVpZ2h0ICs9IHJvd0hlaWdodDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChyb3dIZWlnaHQgPiB0aGlzLnZEb21XaW5kb3dCdWZmZXIpIHtcblxuXHRcdFx0XHRcdHRoaXMudkRvbVdpbmRvd0J1ZmZlciA9IHJvd0hlaWdodCAqIDI7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAocm93LnR5cGUgIT09IFwiZ3JvdXBcIikge1xuXG5cdFx0XHRcdFx0b25seUdyb3VwSGVhZGVycyA9IGZhbHNlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsZi52RG9tQm90dG9tKys7XG5cblx0XHRcdFx0aSsrO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXBvc2l0aW9uKSB7XG5cblx0XHRcdFx0dGhpcy52RG9tVG9wUGFkID0gMDtcblxuXHRcdFx0XHQvL2FkanVzdCByb3doZWlnaHQgdG8gbWF0Y2ggYXZlcmFnZSBvZiByZW5kZXJlZCBlbGVtZW50c1xuXG5cdFx0XHRcdHNlbGYudkRvbVJvd0hlaWdodCA9IE1hdGguZmxvb3IoKHJvd3NIZWlnaHQgKyB0b3BQYWRIZWlnaHQpIC8gaSk7XG5cblx0XHRcdFx0c2VsZi52RG9tQm90dG9tUGFkID0gc2VsZi52RG9tUm93SGVpZ2h0ICogKHNlbGYuZGlzcGxheVJvd3NDb3VudCAtIHNlbGYudkRvbUJvdHRvbSAtIDEpO1xuXG5cdFx0XHRcdHNlbGYudkRvbVNjcm9sbEhlaWdodCA9IHRvcFBhZEhlaWdodCArIHJvd3NIZWlnaHQgKyBzZWxmLnZEb21Cb3R0b21QYWQgLSBzZWxmLmhlaWdodDtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0c2VsZi52RG9tVG9wUGFkID0gIWZvcmNlTW92ZSA/IHNlbGYuc2Nyb2xsVG9wIC0gdG9wUGFkSGVpZ2h0IDogc2VsZi52RG9tUm93SGVpZ2h0ICogdGhpcy52RG9tVG9wICsgb2Zmc2V0O1xuXG5cdFx0XHRcdHNlbGYudkRvbUJvdHRvbVBhZCA9IHNlbGYudkRvbUJvdHRvbSA9PSBzZWxmLmRpc3BsYXlSb3dzQ291bnQgLSAxID8gMCA6IE1hdGgubWF4KHNlbGYudkRvbVNjcm9sbEhlaWdodCAtIHNlbGYudkRvbVRvcFBhZCAtIHJvd3NIZWlnaHQgLSB0b3BQYWRIZWlnaHQsIDApO1xuXHRcdFx0fVxuXG5cdFx0XHRlbGVtZW50LnN0eWxlLnBhZGRpbmdUb3AgPSBzZWxmLnZEb21Ub3BQYWQgKyBcInB4XCI7XG5cblx0XHRcdGVsZW1lbnQuc3R5bGUucGFkZGluZ0JvdHRvbSA9IHNlbGYudkRvbUJvdHRvbVBhZCArIFwicHhcIjtcblxuXHRcdFx0aWYgKGZvcmNlTW92ZSkge1xuXG5cdFx0XHRcdHRoaXMuc2Nyb2xsVG9wID0gc2VsZi52RG9tVG9wUGFkICsgdG9wUGFkSGVpZ2h0ICsgb2Zmc2V0IC0gKHRoaXMuZWxlbWVudC5zY3JvbGxXaWR0aCA+IHRoaXMuZWxlbWVudC5jbGllbnRXaWR0aCA/IHRoaXMuZWxlbWVudC5vZmZzZXRIZWlnaHQgLSB0aGlzLmVsZW1lbnQuY2xpZW50SGVpZ2h0IDogMCk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuc2Nyb2xsVG9wID0gTWF0aC5taW4odGhpcy5zY3JvbGxUb3AsIHRoaXMuZWxlbWVudC5zY3JvbGxIZWlnaHQgLSB0aGlzLmhlaWdodCk7XG5cblx0XHRcdC8vYWRqdXN0IGZvciBob3Jpem9udGFsIHNjcm9sbGJhciBpZiBwcmVzZW50IChhbmQgbm90IGF0IHRvcCBvZiB0YWJsZSlcblxuXHRcdFx0aWYgKHRoaXMuZWxlbWVudC5zY3JvbGxXaWR0aCA+IHRoaXMuZWxlbWVudC5vZmZzZXRXaWR0aCAmJiBmb3JjZU1vdmUpIHtcblxuXHRcdFx0XHR0aGlzLnNjcm9sbFRvcCArPSB0aGlzLmVsZW1lbnQub2Zmc2V0SGVpZ2h0IC0gdGhpcy5lbGVtZW50LmNsaWVudEhlaWdodDtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy52RG9tU2Nyb2xsUG9zVG9wID0gdGhpcy5zY3JvbGxUb3A7XG5cblx0XHRcdHRoaXMudkRvbVNjcm9sbFBvc0JvdHRvbSA9IHRoaXMuc2Nyb2xsVG9wO1xuXG5cdFx0XHRob2xkZXIuc2Nyb2xsVG9wID0gdGhpcy5zY3JvbGxUb3A7XG5cblx0XHRcdGVsZW1lbnQuc3R5bGUubWluV2lkdGggPSBvbmx5R3JvdXBIZWFkZXJzID8gc2VsZi50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldFdpZHRoKCkgKyBcInB4XCIgOiBcIlwiO1xuXG5cdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLmdyb3VwQnkpIHtcblxuXHRcdFx0XHRpZiAoc2VsZi50YWJsZS5tb2R1bGVzLmxheW91dC5nZXRNb2RlKCkgIT0gXCJmaXREYXRhRmlsbFwiICYmIHNlbGYuZGlzcGxheVJvd3NDb3VudCA9PSBzZWxmLnRhYmxlLm1vZHVsZXMuZ3JvdXBSb3dzLmNvdW50R3JvdXBzKCkpIHtcblxuXHRcdFx0XHRcdHNlbGYudGFibGVFbGVtZW50LnN0eWxlLm1pbldpZHRoID0gc2VsZi50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldFdpZHRoKCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHR0aGlzLnJlbmRlckVtcHR5U2Nyb2xsKCk7XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLmZpeGVkSGVpZ2h0KSB7XG5cblx0XHRcdHRoaXMuYWRqdXN0VGFibGVTaXplKCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vaGFuZGxlIHZlcnRpY2FsIHNjcm9sbGluZ1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLnNjcm9sbFZlcnRpY2FsID0gZnVuY3Rpb24gKGRpcikge1xuXG5cdFx0dmFyIHRvcERpZmYgPSB0aGlzLnNjcm9sbFRvcCAtIHRoaXMudkRvbVNjcm9sbFBvc1RvcDtcblxuXHRcdHZhciBib3R0b21EaWZmID0gdGhpcy5zY3JvbGxUb3AgLSB0aGlzLnZEb21TY3JvbGxQb3NCb3R0b207XG5cblx0XHR2YXIgbWFyZ2luID0gdGhpcy52RG9tV2luZG93QnVmZmVyICogMjtcblxuXHRcdGlmICgtdG9wRGlmZiA+IG1hcmdpbiB8fCBib3R0b21EaWZmID4gbWFyZ2luKSB7XG5cblx0XHRcdC8vaWYgYmlnIHNjcm9sbCByZWRyYXcgdGFibGU7XG5cblx0XHRcdHZhciBsZWZ0ID0gdGhpcy5zY3JvbGxMZWZ0O1xuXG5cdFx0XHR0aGlzLl92aXJ0dWFsUmVuZGVyRmlsbChNYXRoLmZsb29yKHRoaXMuZWxlbWVudC5zY3JvbGxUb3AgLyB0aGlzLmVsZW1lbnQuc2Nyb2xsSGVpZ2h0ICogdGhpcy5kaXNwbGF5Um93c0NvdW50KSk7XG5cblx0XHRcdHRoaXMuc2Nyb2xsSG9yaXpvbnRhbChsZWZ0KTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoZGlyKSB7XG5cblx0XHRcdFx0Ly9zY3JvbGxpbmcgdXBcblxuXHRcdFx0XHRpZiAodG9wRGlmZiA8IDApIHtcblxuXHRcdFx0XHRcdHRoaXMuX2FkZFRvcFJvdygtdG9wRGlmZik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoYm90dG9tRGlmZiA8IDApIHtcblxuXHRcdFx0XHRcdC8vaGlkZSBib3R0b20gcm93IGlmIG5lZWRlZFxuXG5cdFx0XHRcdFx0aWYgKHRoaXMudkRvbVNjcm9sbEhlaWdodCAtIHRoaXMuc2Nyb2xsVG9wID4gdGhpcy52RG9tV2luZG93QnVmZmVyKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuX3JlbW92ZUJvdHRvbVJvdygtYm90dG9tRGlmZik7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0dGhpcy52RG9tU2Nyb2xsUG9zQm90dG9tID0gdGhpcy5zY3JvbGxUb3A7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdC8vc2Nyb2xsaW5nIGRvd25cblxuXHRcdFx0XHRpZiAodG9wRGlmZiA+PSAwKSB7XG5cblx0XHRcdFx0XHQvL2hpZGUgdG9wIHJvdyBpZiBuZWVkZWRcblxuXHRcdFx0XHRcdGlmICh0aGlzLnNjcm9sbFRvcCA+IHRoaXMudkRvbVdpbmRvd0J1ZmZlcikge1xuXG5cdFx0XHRcdFx0XHR0aGlzLl9yZW1vdmVUb3BSb3codG9wRGlmZik7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0dGhpcy52RG9tU2Nyb2xsUG9zVG9wID0gdGhpcy5zY3JvbGxUb3A7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGJvdHRvbURpZmYgPj0gMCkge1xuXG5cdFx0XHRcdFx0dGhpcy5fYWRkQm90dG9tUm93KGJvdHRvbURpZmYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLl9hZGRUb3BSb3cgPSBmdW5jdGlvbiAodG9wRGlmZikge1xuXHRcdHZhciBpID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAwO1xuXG5cblx0XHR2YXIgdGFibGUgPSB0aGlzLnRhYmxlRWxlbWVudCxcblx0XHQgICAgcm93cyA9IHRoaXMuZ2V0RGlzcGxheVJvd3MoKTtcblxuXHRcdGlmICh0aGlzLnZEb21Ub3ApIHtcblxuXHRcdFx0dmFyIGluZGV4ID0gdGhpcy52RG9tVG9wIC0gMSxcblx0XHRcdCAgICB0b3BSb3cgPSByb3dzW2luZGV4XSxcblx0XHRcdCAgICB0b3BSb3dIZWlnaHQgPSB0b3BSb3cuZ2V0SGVpZ2h0KCkgfHwgdGhpcy52RG9tUm93SGVpZ2h0O1xuXG5cdFx0XHQvL2hpZGUgdG9wIHJvdyBpZiBuZWVkZWRcblxuXHRcdFx0aWYgKHRvcERpZmYgPj0gdG9wUm93SGVpZ2h0KSB7XG5cblx0XHRcdFx0dGhpcy5zdHlsZVJvdyh0b3BSb3csIGluZGV4KTtcblxuXHRcdFx0XHR0YWJsZS5pbnNlcnRCZWZvcmUodG9wUm93LmdldEVsZW1lbnQoKSwgdGFibGUuZmlyc3RDaGlsZCk7XG5cblx0XHRcdFx0aWYgKCF0b3BSb3cuaW5pdGlhbGl6ZWQgfHwgIXRvcFJvdy5oZWlnaHRJbml0aWFsaXplZCkge1xuXG5cdFx0XHRcdFx0dGhpcy52RG9tVG9wTmV3Um93cy5wdXNoKHRvcFJvdyk7XG5cblx0XHRcdFx0XHRpZiAoIXRvcFJvdy5oZWlnaHRJbml0aWFsaXplZCkge1xuXG5cdFx0XHRcdFx0XHR0b3BSb3cuY2xlYXJDZWxsSGVpZ2h0KCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0dG9wUm93LmluaXRpYWxpemUoKTtcblxuXHRcdFx0XHR0aGlzLnZEb21Ub3BQYWQgLT0gdG9wUm93SGVpZ2h0O1xuXG5cdFx0XHRcdGlmICh0aGlzLnZEb21Ub3BQYWQgPCAwKSB7XG5cblx0XHRcdFx0XHR0aGlzLnZEb21Ub3BQYWQgPSBpbmRleCAqIHRoaXMudkRvbVJvd0hlaWdodDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICghaW5kZXgpIHtcblxuXHRcdFx0XHRcdHRoaXMudkRvbVRvcFBhZCA9IDA7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR0YWJsZS5zdHlsZS5wYWRkaW5nVG9wID0gdGhpcy52RG9tVG9wUGFkICsgXCJweFwiO1xuXG5cdFx0XHRcdHRoaXMudkRvbVNjcm9sbFBvc1RvcCAtPSB0b3BSb3dIZWlnaHQ7XG5cblx0XHRcdFx0dGhpcy52RG9tVG9wLS07XG5cdFx0XHR9XG5cblx0XHRcdHRvcERpZmYgPSAtKHRoaXMuc2Nyb2xsVG9wIC0gdGhpcy52RG9tU2Nyb2xsUG9zVG9wKTtcblxuXHRcdFx0aWYgKHRvcFJvdy5nZXRIZWlnaHQoKSA+IHRoaXMudkRvbVdpbmRvd0J1ZmZlcikge1xuXG5cdFx0XHRcdHRoaXMudkRvbVdpbmRvd0J1ZmZlciA9IHRvcFJvdy5nZXRIZWlnaHQoKSAqIDI7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChpIDwgdGhpcy52RG9tTWF4UmVuZGVyQ2hhaW4gJiYgdGhpcy52RG9tVG9wICYmIHRvcERpZmYgPj0gKHJvd3NbdGhpcy52RG9tVG9wIC0gMV0uZ2V0SGVpZ2h0KCkgfHwgdGhpcy52RG9tUm93SGVpZ2h0KSkge1xuXG5cdFx0XHRcdHRoaXMuX2FkZFRvcFJvdyh0b3BEaWZmLCBpICsgMSk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdHRoaXMuX3F1aWNrTm9ybWFsaXplUm93SGVpZ2h0KHRoaXMudkRvbVRvcE5ld1Jvd3MpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5fcmVtb3ZlVG9wUm93ID0gZnVuY3Rpb24gKHRvcERpZmYpIHtcblxuXHRcdHZhciB0YWJsZSA9IHRoaXMudGFibGVFbGVtZW50LFxuXHRcdCAgICB0b3BSb3cgPSB0aGlzLmdldERpc3BsYXlSb3dzKClbdGhpcy52RG9tVG9wXSxcblx0XHQgICAgdG9wUm93SGVpZ2h0ID0gdG9wUm93LmdldEhlaWdodCgpIHx8IHRoaXMudkRvbVJvd0hlaWdodDtcblxuXHRcdGlmICh0b3BEaWZmID49IHRvcFJvd0hlaWdodCkge1xuXG5cdFx0XHR2YXIgcm93RWwgPSB0b3BSb3cuZ2V0RWxlbWVudCgpO1xuXG5cdFx0XHRyb3dFbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHJvd0VsKTtcblxuXHRcdFx0dGhpcy52RG9tVG9wUGFkICs9IHRvcFJvd0hlaWdodDtcblxuXHRcdFx0dGFibGUuc3R5bGUucGFkZGluZ1RvcCA9IHRoaXMudkRvbVRvcFBhZCArIFwicHhcIjtcblxuXHRcdFx0dGhpcy52RG9tU2Nyb2xsUG9zVG9wICs9IHRoaXMudkRvbVRvcCA/IHRvcFJvd0hlaWdodCA6IHRvcFJvd0hlaWdodCArIHRoaXMudkRvbVdpbmRvd0J1ZmZlcjtcblxuXHRcdFx0dGhpcy52RG9tVG9wKys7XG5cblx0XHRcdHRvcERpZmYgPSB0aGlzLnNjcm9sbFRvcCAtIHRoaXMudkRvbVNjcm9sbFBvc1RvcDtcblxuXHRcdFx0dGhpcy5fcmVtb3ZlVG9wUm93KHRvcERpZmYpO1xuXHRcdH1cblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5fYWRkQm90dG9tUm93ID0gZnVuY3Rpb24gKGJvdHRvbURpZmYpIHtcblx0XHR2YXIgaSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogMDtcblxuXG5cdFx0dmFyIHRhYmxlID0gdGhpcy50YWJsZUVsZW1lbnQsXG5cdFx0ICAgIHJvd3MgPSB0aGlzLmdldERpc3BsYXlSb3dzKCk7XG5cblx0XHRpZiAodGhpcy52RG9tQm90dG9tIDwgdGhpcy5kaXNwbGF5Um93c0NvdW50IC0gMSkge1xuXG5cdFx0XHR2YXIgaW5kZXggPSB0aGlzLnZEb21Cb3R0b20gKyAxLFxuXHRcdFx0ICAgIGJvdHRvbVJvdyA9IHJvd3NbaW5kZXhdLFxuXHRcdFx0ICAgIGJvdHRvbVJvd0hlaWdodCA9IGJvdHRvbVJvdy5nZXRIZWlnaHQoKSB8fCB0aGlzLnZEb21Sb3dIZWlnaHQ7XG5cblx0XHRcdC8vaGlkZSBib3R0b20gcm93IGlmIG5lZWRlZFxuXG5cdFx0XHRpZiAoYm90dG9tRGlmZiA+PSBib3R0b21Sb3dIZWlnaHQpIHtcblxuXHRcdFx0XHR0aGlzLnN0eWxlUm93KGJvdHRvbVJvdywgaW5kZXgpO1xuXG5cdFx0XHRcdHRhYmxlLmFwcGVuZENoaWxkKGJvdHRvbVJvdy5nZXRFbGVtZW50KCkpO1xuXG5cdFx0XHRcdGlmICghYm90dG9tUm93LmluaXRpYWxpemVkIHx8ICFib3R0b21Sb3cuaGVpZ2h0SW5pdGlhbGl6ZWQpIHtcblxuXHRcdFx0XHRcdHRoaXMudkRvbUJvdHRvbU5ld1Jvd3MucHVzaChib3R0b21Sb3cpO1xuXG5cdFx0XHRcdFx0aWYgKCFib3R0b21Sb3cuaGVpZ2h0SW5pdGlhbGl6ZWQpIHtcblxuXHRcdFx0XHRcdFx0Ym90dG9tUm93LmNsZWFyQ2VsbEhlaWdodCgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGJvdHRvbVJvdy5pbml0aWFsaXplKCk7XG5cblx0XHRcdFx0dGhpcy52RG9tQm90dG9tUGFkIC09IGJvdHRvbVJvd0hlaWdodDtcblxuXHRcdFx0XHRpZiAodGhpcy52RG9tQm90dG9tUGFkIDwgMCB8fCBpbmRleCA9PSB0aGlzLmRpc3BsYXlSb3dzQ291bnQgLSAxKSB7XG5cblx0XHRcdFx0XHR0aGlzLnZEb21Cb3R0b21QYWQgPSAwO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGFibGUuc3R5bGUucGFkZGluZ0JvdHRvbSA9IHRoaXMudkRvbUJvdHRvbVBhZCArIFwicHhcIjtcblxuXHRcdFx0XHR0aGlzLnZEb21TY3JvbGxQb3NCb3R0b20gKz0gYm90dG9tUm93SGVpZ2h0O1xuXG5cdFx0XHRcdHRoaXMudkRvbUJvdHRvbSsrO1xuXHRcdFx0fVxuXG5cdFx0XHRib3R0b21EaWZmID0gdGhpcy5zY3JvbGxUb3AgLSB0aGlzLnZEb21TY3JvbGxQb3NCb3R0b207XG5cblx0XHRcdGlmIChib3R0b21Sb3cuZ2V0SGVpZ2h0KCkgPiB0aGlzLnZEb21XaW5kb3dCdWZmZXIpIHtcblxuXHRcdFx0XHR0aGlzLnZEb21XaW5kb3dCdWZmZXIgPSBib3R0b21Sb3cuZ2V0SGVpZ2h0KCkgKiAyO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoaSA8IHRoaXMudkRvbU1heFJlbmRlckNoYWluICYmIHRoaXMudkRvbUJvdHRvbSA8IHRoaXMuZGlzcGxheVJvd3NDb3VudCAtIDEgJiYgYm90dG9tRGlmZiA+PSAocm93c1t0aGlzLnZEb21Cb3R0b20gKyAxXS5nZXRIZWlnaHQoKSB8fCB0aGlzLnZEb21Sb3dIZWlnaHQpKSB7XG5cblx0XHRcdFx0dGhpcy5fYWRkQm90dG9tUm93KGJvdHRvbURpZmYsIGkgKyAxKTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0dGhpcy5fcXVpY2tOb3JtYWxpemVSb3dIZWlnaHQodGhpcy52RG9tQm90dG9tTmV3Um93cyk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLl9yZW1vdmVCb3R0b21Sb3cgPSBmdW5jdGlvbiAoYm90dG9tRGlmZikge1xuXG5cdFx0dmFyIHRhYmxlID0gdGhpcy50YWJsZUVsZW1lbnQsXG5cdFx0ICAgIGJvdHRvbVJvdyA9IHRoaXMuZ2V0RGlzcGxheVJvd3MoKVt0aGlzLnZEb21Cb3R0b21dLFxuXHRcdCAgICBib3R0b21Sb3dIZWlnaHQgPSBib3R0b21Sb3cuZ2V0SGVpZ2h0KCkgfHwgdGhpcy52RG9tUm93SGVpZ2h0O1xuXG5cdFx0aWYgKGJvdHRvbURpZmYgPj0gYm90dG9tUm93SGVpZ2h0KSB7XG5cblx0XHRcdHZhciByb3dFbCA9IGJvdHRvbVJvdy5nZXRFbGVtZW50KCk7XG5cblx0XHRcdGlmIChyb3dFbC5wYXJlbnROb2RlKSB7XG5cblx0XHRcdFx0cm93RWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChyb3dFbCk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudkRvbUJvdHRvbVBhZCArPSBib3R0b21Sb3dIZWlnaHQ7XG5cblx0XHRcdGlmICh0aGlzLnZEb21Cb3R0b21QYWQgPCAwKSB7XG5cblx0XHRcdFx0dGhpcy52RG9tQm90dG9tUGFkID0gMDtcblx0XHRcdH1cblxuXHRcdFx0dGFibGUuc3R5bGUucGFkZGluZ0JvdHRvbSA9IHRoaXMudkRvbUJvdHRvbVBhZCArIFwicHhcIjtcblxuXHRcdFx0dGhpcy52RG9tU2Nyb2xsUG9zQm90dG9tIC09IGJvdHRvbVJvd0hlaWdodDtcblxuXHRcdFx0dGhpcy52RG9tQm90dG9tLS07XG5cblx0XHRcdGJvdHRvbURpZmYgPSAtKHRoaXMuc2Nyb2xsVG9wIC0gdGhpcy52RG9tU2Nyb2xsUG9zQm90dG9tKTtcblxuXHRcdFx0dGhpcy5fcmVtb3ZlQm90dG9tUm93KGJvdHRvbURpZmYpO1xuXHRcdH1cblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5fcXVpY2tOb3JtYWxpemVSb3dIZWlnaHQgPSBmdW5jdGlvbiAocm93cykge1xuXG5cdFx0cm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblxuXHRcdFx0cm93LmNhbGNIZWlnaHQoKTtcblx0XHR9KTtcblxuXHRcdHJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cblx0XHRcdHJvdy5zZXRDZWxsSGVpZ2h0KCk7XG5cdFx0fSk7XG5cblx0XHRyb3dzLmxlbmd0aCA9IDA7XG5cdH07XG5cblx0Ly9ub3JtYWxpemUgaGVpZ2h0IG9mIGFjdGl2ZSByb3dzXG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUubm9ybWFsaXplSGVpZ2h0ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5hY3RpdmVSb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXG5cdFx0XHRyb3cubm9ybWFsaXplSGVpZ2h0KCk7XG5cdFx0fSk7XG5cdH07XG5cblx0Ly9hZGp1c3QgdGhlIGhlaWdodCBvZiB0aGUgdGFibGUgaG9sZGVyIHRvIGZpdCBpbiB0aGUgVGFidWxhdG9yIGVsZW1lbnRcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5hZGp1c3RUYWJsZVNpemUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgaW5pdGlhbEhlaWdodCA9IHRoaXMuZWxlbWVudC5jbGllbnRIZWlnaHQsXG5cdFx0ICAgIG1vZEV4aXN0cztcblxuXHRcdGlmICh0aGlzLnJlbmRlck1vZGUgPT09IFwidmlydHVhbFwiKSB7XG5cblx0XHRcdHZhciBvdGhlckhlaWdodCA9IHRoaXMuY29sdW1uTWFuYWdlci5nZXRFbGVtZW50KCkub2Zmc2V0SGVpZ2h0ICsgKHRoaXMudGFibGUuZm9vdGVyTWFuYWdlciAmJiAhdGhpcy50YWJsZS5mb290ZXJNYW5hZ2VyLmV4dGVybmFsID8gdGhpcy50YWJsZS5mb290ZXJNYW5hZ2VyLmdldEVsZW1lbnQoKS5vZmZzZXRIZWlnaHQgOiAwKTtcblxuXHRcdFx0aWYgKHRoaXMuZml4ZWRIZWlnaHQpIHtcblxuXHRcdFx0XHR0aGlzLmVsZW1lbnQuc3R5bGUubWluSGVpZ2h0ID0gXCJjYWxjKDEwMCUgLSBcIiArIG90aGVySGVpZ2h0ICsgXCJweClcIjtcblxuXHRcdFx0XHR0aGlzLmVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gXCJjYWxjKDEwMCUgLSBcIiArIG90aGVySGVpZ2h0ICsgXCJweClcIjtcblxuXHRcdFx0XHR0aGlzLmVsZW1lbnQuc3R5bGUubWF4SGVpZ2h0ID0gXCJjYWxjKDEwMCUgLSBcIiArIG90aGVySGVpZ2h0ICsgXCJweClcIjtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0dGhpcy5lbGVtZW50LnN0eWxlLmhlaWdodCA9IFwiXCI7XG5cblx0XHRcdFx0dGhpcy5lbGVtZW50LnN0eWxlLmhlaWdodCA9IHRoaXMudGFibGUuZWxlbWVudC5jbGllbnRIZWlnaHQgLSBvdGhlckhlaWdodCArIFwicHhcIjtcblxuXHRcdFx0XHR0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wID0gdGhpcy5zY3JvbGxUb3A7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuaGVpZ2h0ID0gdGhpcy5lbGVtZW50LmNsaWVudEhlaWdodDtcblxuXHRcdFx0dGhpcy52RG9tV2luZG93QnVmZmVyID0gdGhpcy50YWJsZS5vcHRpb25zLnZpcnR1YWxEb21CdWZmZXIgfHwgdGhpcy5oZWlnaHQ7XG5cblx0XHRcdC8vY2hlY2sgaWYgdGhlIHRhYmxlIGhhcyBjaGFuZ2VkIHNpemUgd2hlbiBkZWFsaW5nIHdpdGggdmFyaWFibGUgaGVpZ2h0IHRhYmxlc1xuXG5cdFx0XHRpZiAoIXRoaXMuZml4ZWRIZWlnaHQgJiYgaW5pdGlhbEhlaWdodCAhPSB0aGlzLmVsZW1lbnQuY2xpZW50SGVpZ2h0KSB7XG5cblx0XHRcdFx0bW9kRXhpc3RzID0gdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJyZXNpemVUYWJsZVwiKTtcblxuXHRcdFx0XHRpZiAobW9kRXhpc3RzICYmICF0aGlzLnRhYmxlLm1vZHVsZXMucmVzaXplVGFibGUuYXV0b1Jlc2l6ZSB8fCAhbW9kRXhpc3RzKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlZHJhdygpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdC8vcmVuaXRpYWxpemUgYWxsIHJvd3NcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5yZWluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLnJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cblx0XHRcdHJvdy5yZWluaXRpYWxpemUoKTtcblx0XHR9KTtcblx0fTtcblxuXHQvL3ByZXZlbnQgdGFibGUgZnJvbSBiZWluZyByZWRyYXduXG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuYmxvY2tSZWRyYXcgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLnJlZHJhd0Jsb2NrID0gdHJ1ZTtcblxuXHRcdHRoaXMucmVkcmF3QmxvY2tSZXN0b3JlQ29uZmlnID0gZmFsc2U7XG5cdH07XG5cblx0Ly9yZXN0b3JlIHRhYmxlIHJlZHJhd2luZ1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLnJlc3RvcmVSZWRyYXcgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLnJlZHJhd0Jsb2NrID0gZmFsc2U7XG5cblx0XHRpZiAodGhpcy5yZWRyYXdCbG9ja1Jlc3RvcmVDb25maWcpIHtcblxuXHRcdFx0dGhpcy5yZWZyZXNoQWN0aXZlRGF0YSh0aGlzLnJlZHJhd0Jsb2NrUmVzdG9yZUNvbmZpZy5zdGFnZSwgdGhpcy5yZWRyYXdCbG9ja1Jlc3RvcmVDb25maWcuc2tpcFN0YWdlLCB0aGlzLnJlZHJhd0Jsb2NrUmVzdG9yZUNvbmZpZy5yZW5kZXJJblBvc2l0aW9uKTtcblxuXHRcdFx0dGhpcy5yZWRyYXdCbG9ja1Jlc3RvcmVDb25maWcgPSBmYWxzZTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAodGhpcy5yZWRyYXdCbG9ja1JlZGVySW5Qb3NpdGlvbikge1xuXG5cdFx0XHRcdHRoaXMucmVSZW5kZXJJblBvc2l0aW9uKCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0dGhpcy5yZWRyYXdCbG9ja1JlZGVySW5Qb3NpdGlvbiA9IGZhbHNlO1xuXHR9O1xuXG5cdC8vcmVkcmF3IHRhYmxlXG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUucmVkcmF3ID0gZnVuY3Rpb24gKGZvcmNlKSB7XG5cblx0XHR2YXIgcG9zID0gMCxcblx0XHQgICAgbGVmdCA9IHRoaXMuc2Nyb2xsTGVmdDtcblxuXHRcdHRoaXMuYWRqdXN0VGFibGVTaXplKCk7XG5cblx0XHR0aGlzLnRhYmxlLnRhYmxlV2lkdGggPSB0aGlzLnRhYmxlLmVsZW1lbnQuY2xpZW50V2lkdGg7XG5cblx0XHRpZiAoIWZvcmNlKSB7XG5cblx0XHRcdGlmICh0aGlzLnJlbmRlck1vZGUgPT0gXCJjbGFzc2ljXCIpIHtcblxuXHRcdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmdyb3VwQnkpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVmcmVzaEFjdGl2ZURhdGEoXCJncm91cFwiLCBmYWxzZSwgZmFsc2UpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0dGhpcy5fc2ltcGxlUmVuZGVyKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0dGhpcy5yZVJlbmRlckluUG9zaXRpb24oKTtcblxuXHRcdFx0XHR0aGlzLnNjcm9sbEhvcml6b250YWwobGVmdCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghdGhpcy5kaXNwbGF5Um93c0NvdW50KSB7XG5cblx0XHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5wbGFjZWhvbGRlcikge1xuXG5cdFx0XHRcdFx0dGhpcy5nZXRFbGVtZW50KCkuYXBwZW5kQ2hpbGQodGhpcy50YWJsZS5vcHRpb25zLnBsYWNlaG9sZGVyKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHRoaXMucmVuZGVyVGFibGUoKTtcblx0XHR9XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUucmVzZXRTY3JvbGwgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLmVsZW1lbnQuc2Nyb2xsTGVmdCA9IDA7XG5cblx0XHR0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wID0gMDtcblxuXHRcdGlmICh0aGlzLnRhYmxlLmJyb3dzZXIgPT09IFwiaWVcIikge1xuXG5cdFx0XHR2YXIgZXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudChcIkV2ZW50XCIpO1xuXG5cdFx0XHRldmVudC5pbml0RXZlbnQoXCJzY3JvbGxcIiwgZmFsc2UsIHRydWUpO1xuXG5cdFx0XHR0aGlzLmVsZW1lbnQuZGlzcGF0Y2hFdmVudChldmVudCk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dGhpcy5lbGVtZW50LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdzY3JvbGwnKSk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vcHVibGljIHJvdyBvYmplY3RcblxuXHR2YXIgUm93Q29tcG9uZW50ID0gZnVuY3Rpb24gUm93Q29tcG9uZW50KHJvdykge1xuXG5cdFx0dGhpcy5fcm93ID0gcm93O1xuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUuZ2V0RGF0YSA9IGZ1bmN0aW9uICh0cmFuc2Zvcm0pIHtcblxuXHRcdHJldHVybiB0aGlzLl9yb3cuZ2V0RGF0YSh0cmFuc2Zvcm0pO1xuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUuZ2V0RWxlbWVudCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9yb3cuZ2V0RWxlbWVudCgpO1xuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUuZ2V0Q2VsbHMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgY2VsbHMgPSBbXTtcblxuXHRcdHRoaXMuX3Jvdy5nZXRDZWxscygpLmZvckVhY2goZnVuY3Rpb24gKGNlbGwpIHtcblxuXHRcdFx0Y2VsbHMucHVzaChjZWxsLmdldENvbXBvbmVudCgpKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBjZWxscztcblx0fTtcblxuXHRSb3dDb21wb25lbnQucHJvdG90eXBlLmdldENlbGwgPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHR2YXIgY2VsbCA9IHRoaXMuX3Jvdy5nZXRDZWxsKGNvbHVtbik7XG5cblx0XHRyZXR1cm4gY2VsbCA/IGNlbGwuZ2V0Q29tcG9uZW50KCkgOiBmYWxzZTtcblx0fTtcblxuXHRSb3dDb21wb25lbnQucHJvdG90eXBlLmdldEluZGV4ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuX3Jvdy5nZXREYXRhKFwiZGF0YVwiKVt0aGlzLl9yb3cudGFibGUub3B0aW9ucy5pbmRleF07XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS5nZXRQb3NpdGlvbiA9IGZ1bmN0aW9uIChhY3RpdmUpIHtcblxuXHRcdHJldHVybiB0aGlzLl9yb3cudGFibGUucm93TWFuYWdlci5nZXRSb3dQb3NpdGlvbih0aGlzLl9yb3csIGFjdGl2ZSk7XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fcm93LmRlbGV0ZSgpO1xuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUuc2Nyb2xsVG8gPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fcm93LnRhYmxlLnJvd01hbmFnZXIuc2Nyb2xsVG9Sb3codGhpcy5fcm93KTtcblx0fTtcblxuXHRSb3dDb21wb25lbnQucHJvdG90eXBlLnBhZ2VUbyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLl9yb3cudGFibGUubW9kRXhpc3RzKFwicGFnZVwiLCB0cnVlKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5fcm93LnRhYmxlLm1vZHVsZXMucGFnZS5zZXRQYWdlVG9Sb3codGhpcy5fcm93KTtcblx0XHR9XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS5tb3ZlID0gZnVuY3Rpb24gKHRvLCBhZnRlcikge1xuXG5cdFx0dGhpcy5fcm93Lm1vdmVUb1Jvdyh0bywgYWZ0ZXIpO1xuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKGRhdGEpIHtcblxuXHRcdHJldHVybiB0aGlzLl9yb3cudXBkYXRlRGF0YShkYXRhKTtcblx0fTtcblxuXHRSb3dDb21wb25lbnQucHJvdG90eXBlLm5vcm1hbGl6ZUhlaWdodCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuX3Jvdy5ub3JtYWxpemVIZWlnaHQodHJ1ZSk7XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS5zZWxlY3QgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLl9yb3cudGFibGUubW9kdWxlcy5zZWxlY3RSb3cuc2VsZWN0Um93cyh0aGlzLl9yb3cpO1xuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUuZGVzZWxlY3QgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLl9yb3cudGFibGUubW9kdWxlcy5zZWxlY3RSb3cuZGVzZWxlY3RSb3dzKHRoaXMuX3Jvdyk7XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS50b2dnbGVTZWxlY3QgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLl9yb3cudGFibGUubW9kdWxlcy5zZWxlY3RSb3cudG9nZ2xlUm93KHRoaXMuX3Jvdyk7XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS5pc1NlbGVjdGVkID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuX3Jvdy50YWJsZS5tb2R1bGVzLnNlbGVjdFJvdy5pc1Jvd1NlbGVjdGVkKHRoaXMuX3Jvdyk7XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS5fZ2V0U2VsZiA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9yb3c7XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9yb3cudmFsaWRhdGUoKTtcblx0fTtcblxuXHRSb3dDb21wb25lbnQucHJvdG90eXBlLmZyZWV6ZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLl9yb3cudGFibGUubW9kRXhpc3RzKFwiZnJvemVuUm93c1wiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLl9yb3cudGFibGUubW9kdWxlcy5mcm96ZW5Sb3dzLmZyZWV6ZVJvdyh0aGlzLl9yb3cpO1xuXHRcdH1cblx0fTtcblxuXHRSb3dDb21wb25lbnQucHJvdG90eXBlLnVuZnJlZXplID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMuX3Jvdy50YWJsZS5tb2RFeGlzdHMoXCJmcm96ZW5Sb3dzXCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMuX3Jvdy50YWJsZS5tb2R1bGVzLmZyb3plblJvd3MudW5mcmVlemVSb3codGhpcy5fcm93KTtcblx0XHR9XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS5pc0Zyb3plbiA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLl9yb3cudGFibGUubW9kRXhpc3RzKFwiZnJvemVuUm93c1wiLCB0cnVlKSkge1xuXG5cdFx0XHR2YXIgaW5kZXggPSB0aGlzLl9yb3cudGFibGUubW9kdWxlcy5mcm96ZW5Sb3dzLnJvd3MuaW5kZXhPZih0aGlzLl9yb3cpO1xuXG5cdFx0XHRyZXR1cm4gaW5kZXggPiAtMTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS50cmVlQ29sbGFwc2UgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5fcm93LnRhYmxlLm1vZEV4aXN0cyhcImRhdGFUcmVlXCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMuX3Jvdy50YWJsZS5tb2R1bGVzLmRhdGFUcmVlLmNvbGxhcHNlUm93KHRoaXMuX3Jvdyk7XG5cdFx0fVxuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUudHJlZUV4cGFuZCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLl9yb3cudGFibGUubW9kRXhpc3RzKFwiZGF0YVRyZWVcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0dGhpcy5fcm93LnRhYmxlLm1vZHVsZXMuZGF0YVRyZWUuZXhwYW5kUm93KHRoaXMuX3Jvdyk7XG5cdFx0fVxuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUudHJlZVRvZ2dsZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLl9yb3cudGFibGUubW9kRXhpc3RzKFwiZGF0YVRyZWVcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0dGhpcy5fcm93LnRhYmxlLm1vZHVsZXMuZGF0YVRyZWUudG9nZ2xlUm93KHRoaXMuX3Jvdyk7XG5cdFx0fVxuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUuZ2V0VHJlZVBhcmVudCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLl9yb3cudGFibGUubW9kRXhpc3RzKFwiZGF0YVRyZWVcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMuX3Jvdy50YWJsZS5tb2R1bGVzLmRhdGFUcmVlLmdldFRyZWVQYXJlbnQodGhpcy5fcm93KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS5nZXRUcmVlQ2hpbGRyZW4gPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5fcm93LnRhYmxlLm1vZEV4aXN0cyhcImRhdGFUcmVlXCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLl9yb3cudGFibGUubW9kdWxlcy5kYXRhVHJlZS5nZXRUcmVlQ2hpbGRyZW4odGhpcy5fcm93KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS5hZGRUcmVlQ2hpbGQgPSBmdW5jdGlvbiAoZGF0YSwgcG9zLCBpbmRleCkge1xuXG5cdFx0aWYgKHRoaXMuX3Jvdy50YWJsZS5tb2RFeGlzdHMoXCJkYXRhVHJlZVwiLCB0cnVlKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5fcm93LnRhYmxlLm1vZHVsZXMuZGF0YVRyZWUuYWRkVHJlZUNoaWxkUm93KHRoaXMuX3JvdywgZGF0YSwgcG9zLCBpbmRleCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUucmVmb3JtYXQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fcm93LnJlaW5pdGlhbGl6ZSgpO1xuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUuZ2V0R3JvdXAgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fcm93LmdldEdyb3VwKCkuZ2V0Q29tcG9uZW50KCk7XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS5nZXRUYWJsZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9yb3cudGFibGU7XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS5nZXROZXh0Um93ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIHJvdyA9IHRoaXMuX3Jvdy5uZXh0Um93KCk7XG5cblx0XHRyZXR1cm4gcm93ID8gcm93LmdldENvbXBvbmVudCgpIDogcm93O1xuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUuZ2V0UHJldlJvdyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciByb3cgPSB0aGlzLl9yb3cucHJldlJvdygpO1xuXG5cdFx0cmV0dXJuIHJvdyA/IHJvdy5nZXRDb21wb25lbnQoKSA6IHJvdztcblx0fTtcblxuXHR2YXIgUm93ID0gZnVuY3Rpb24gUm93KGRhdGEsIHBhcmVudCkge1xuXHRcdHZhciB0eXBlID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBcInJvd1wiO1xuXG5cblx0XHR0aGlzLnRhYmxlID0gcGFyZW50LnRhYmxlO1xuXG5cdFx0dGhpcy5wYXJlbnQgPSBwYXJlbnQ7XG5cblx0XHR0aGlzLmRhdGEgPSB7fTtcblxuXHRcdHRoaXMudHlwZSA9IHR5cGU7IC8vdHlwZSBvZiBlbGVtZW50XG5cblx0XHR0aGlzLmVsZW1lbnQgPSB0aGlzLmNyZWF0ZUVsZW1lbnQoKTtcblxuXHRcdHRoaXMubW9kdWxlcyA9IHt9OyAvL2hvbGQgbW9kdWxlIHZhcmlhYmxlcztcblxuXHRcdHRoaXMuY2VsbHMgPSBbXTtcblxuXHRcdHRoaXMuaGVpZ2h0ID0gMDsgLy9ob2xkIGVsZW1lbnQgaGVpZ2h0XG5cblx0XHR0aGlzLmhlaWdodFN0eWxlZCA9IFwiXCI7IC8vaG9sZCBlbGVtZW50IGhlaWdodCBwcmVzdHlsZWQgdG8gaW1wcm92ZSByZW5kZXIgZWZmaWNpZW5jeVxuXG5cdFx0dGhpcy5tYW51YWxIZWlnaHQgPSBmYWxzZTsgLy91c2VyIGhhcyBtYW51YWxseSBzZXQgcm93IGhlaWdodFxuXG5cdFx0dGhpcy5vdXRlckhlaWdodCA9IDA7IC8vaG9sZGUgbGVtZW50cyBvdXRlciBoZWlnaHRcblxuXHRcdHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTsgLy9lbGVtZW50IGhhcyBiZWVuIHJlbmRlcmVkXG5cblx0XHR0aGlzLmhlaWdodEluaXRpYWxpemVkID0gZmFsc2U7IC8vZWxlbWVudCBoYXMgcmVzaXplZCBjZWxscyB0byBmaXRcblxuXG5cdFx0dGhpcy5jb21wb25lbnQgPSBudWxsO1xuXG5cdFx0dGhpcy5zZXREYXRhKGRhdGEpO1xuXG5cdFx0dGhpcy5nZW5lcmF0ZUVsZW1lbnQoKTtcblx0fTtcblxuXHRSb3cucHJvdG90eXBlLmNyZWF0ZUVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG5cdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1yb3dcIik7XG5cblx0XHRlbC5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwicm93XCIpO1xuXG5cdFx0cmV0dXJuIGVsO1xuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUuZ2V0RWxlbWVudCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLmVsZW1lbnQ7XG5cdH07XG5cblx0Um93LnByb3RvdHlwZS5kZXRhY2hFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMuZWxlbWVudCAmJiB0aGlzLmVsZW1lbnQucGFyZW50Tm9kZSkge1xuXG5cdFx0XHR0aGlzLmVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnQpO1xuXHRcdH1cblx0fTtcblxuXHRSb3cucHJvdG90eXBlLmdlbmVyYXRlRWxlbWVudCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgZGJsVGFwLFxuXHRcdCAgICB0YXBIb2xkLFxuXHRcdCAgICB0YXA7XG5cblx0XHQvL3NldCByb3cgc2VsZWN0aW9uIGNoYXJhY3RlcmlzdGljc1xuXG5cdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5zZWxlY3RhYmxlICE9PSBmYWxzZSAmJiBzZWxmLnRhYmxlLm1vZEV4aXN0cyhcInNlbGVjdFJvd1wiKSkge1xuXG5cdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMuc2VsZWN0Um93LmluaXRpYWxpemVSb3codGhpcyk7XG5cdFx0fVxuXG5cdFx0Ly9zZXR1cCBtb3ZhYmxlIHJvd3NcblxuXHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3MgIT09IGZhbHNlICYmIHNlbGYudGFibGUubW9kRXhpc3RzKFwibW92ZVJvd1wiKSkge1xuXG5cdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMubW92ZVJvdy5pbml0aWFsaXplUm93KHRoaXMpO1xuXHRcdH1cblxuXHRcdC8vc2V0dXAgZGF0YSB0cmVlXG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLmRhdGFUcmVlICE9PSBmYWxzZSAmJiBzZWxmLnRhYmxlLm1vZEV4aXN0cyhcImRhdGFUcmVlXCIpKSB7XG5cblx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5kYXRhVHJlZS5pbml0aWFsaXplUm93KHRoaXMpO1xuXHRcdH1cblxuXHRcdC8vc2V0dXAgY29sdW1uIGNvbGFwc2UgY29udGFpbmVyXG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXQgPT09IFwiY29sbGFwc2VcIiAmJiBzZWxmLnRhYmxlLm1vZEV4aXN0cyhcInJlc3BvbnNpdmVMYXlvdXRcIikpIHtcblxuXHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQuaW5pdGlhbGl6ZVJvdyh0aGlzKTtcblx0XHR9XG5cblx0XHQvL3NldCBjb2x1bW4gbWVudVxuXG5cdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5yb3dDb250ZXh0TWVudSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcIm1lbnVcIikpIHtcblxuXHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLm1lbnUuaW5pdGlhbGl6ZVJvdyh0aGlzKTtcblx0XHR9XG5cblx0XHQvL2hhbmRsZSByb3cgY2xpY2sgZXZlbnRzXG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnJvd0NsaWNrKSB7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMucm93Q2xpY2soZSwgc2VsZi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnJvd0RibENsaWNrKSB7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZGJsY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMucm93RGJsQ2xpY2soZSwgc2VsZi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnJvd0NvbnRleHQpIHtcblxuXHRcdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjb250ZXh0bWVudVwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5yb3dDb250ZXh0KGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0Ly9oYW5kbGUgbW91c2UgZXZlbnRzXG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnJvd01vdXNlRW50ZXIpIHtcblxuXHRcdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWVudGVyXCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0c2VsZi50YWJsZS5vcHRpb25zLnJvd01vdXNlRW50ZXIoZSwgc2VsZi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnJvd01vdXNlTGVhdmUpIHtcblxuXHRcdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0c2VsZi50YWJsZS5vcHRpb25zLnJvd01vdXNlTGVhdmUoZSwgc2VsZi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnJvd01vdXNlT3Zlcikge1xuXG5cdFx0XHRzZWxmLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5yb3dNb3VzZU92ZXIoZSwgc2VsZi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnJvd01vdXNlT3V0KSB7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdXRcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMucm93TW91c2VPdXQoZSwgc2VsZi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnJvd01vdXNlTW92ZSkge1xuXG5cdFx0XHRzZWxmLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5yb3dNb3VzZU1vdmUoZSwgc2VsZi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnJvd1RhcCkge1xuXG5cdFx0XHR0YXAgPSBmYWxzZTtcblxuXHRcdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0dGFwID0gdHJ1ZTtcblx0XHRcdH0sIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcblxuXHRcdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdGlmICh0YXApIHtcblxuXHRcdFx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5yb3dUYXAoZSwgc2VsZi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR0YXAgPSBmYWxzZTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMucm93RGJsVGFwKSB7XG5cblx0XHRcdGRibFRhcCA9IG51bGw7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHRpZiAoZGJsVGFwKSB7XG5cblx0XHRcdFx0XHRjbGVhclRpbWVvdXQoZGJsVGFwKTtcblxuXHRcdFx0XHRcdGRibFRhcCA9IG51bGw7XG5cblx0XHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMucm93RGJsVGFwKGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0ZGJsVGFwID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHRcdGNsZWFyVGltZW91dChkYmxUYXApO1xuXG5cdFx0XHRcdFx0XHRkYmxUYXAgPSBudWxsO1xuXHRcdFx0XHRcdH0sIDMwMCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMucm93VGFwSG9sZCkge1xuXG5cdFx0XHR0YXBIb2xkID0gbnVsbDtcblxuXHRcdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0Y2xlYXJUaW1lb3V0KHRhcEhvbGQpO1xuXG5cdFx0XHRcdHRhcEhvbGQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0XHRcdGNsZWFyVGltZW91dCh0YXBIb2xkKTtcblxuXHRcdFx0XHRcdHRhcEhvbGQgPSBudWxsO1xuXG5cdFx0XHRcdFx0dGFwID0gZmFsc2U7XG5cblx0XHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMucm93VGFwSG9sZChlLCBzZWxmLmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0fSwgMTAwMCk7XG5cdFx0XHR9LCB7IHBhc3NpdmU6IHRydWUgfSk7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHRjbGVhclRpbWVvdXQodGFwSG9sZCk7XG5cblx0XHRcdFx0dGFwSG9sZCA9IG51bGw7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH07XG5cblx0Um93LnByb3RvdHlwZS5nZW5lcmF0ZUNlbGxzID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5jZWxscyA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZW5lcmF0ZUNlbGxzKHRoaXMpO1xuXHR9O1xuXG5cdC8vZnVuY3Rpb25zIHRvIHNldHVwIG9uIGZpcnN0IHJlbmRlclxuXG5cdFJvdy5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChmb3JjZSkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0aWYgKCFzZWxmLmluaXRpYWxpemVkIHx8IGZvcmNlKSB7XG5cblx0XHRcdHNlbGYuZGVsZXRlQ2VsbHMoKTtcblxuXHRcdFx0d2hpbGUgKHNlbGYuZWxlbWVudC5maXJzdENoaWxkKSB7XG5cdFx0XHRcdHNlbGYuZWxlbWVudC5yZW1vdmVDaGlsZChzZWxmLmVsZW1lbnQuZmlyc3RDaGlsZCk7XG5cdFx0XHR9IC8vaGFuZGxlIGZyb3plbiBjZWxsc1xuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJmcm96ZW5Db2x1bW5zXCIpKSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmZyb3plbkNvbHVtbnMubGF5b3V0Um93KHRoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmdlbmVyYXRlQ2VsbHMoKTtcblxuXHRcdFx0c2VsZi5jZWxscy5mb3JFYWNoKGZ1bmN0aW9uIChjZWxsKSB7XG5cblx0XHRcdFx0c2VsZi5lbGVtZW50LmFwcGVuZENoaWxkKGNlbGwuZ2V0RWxlbWVudCgpKTtcblxuXHRcdFx0XHRjZWxsLmNlbGxSZW5kZXJlZCgpO1xuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChmb3JjZSkge1xuXG5cdFx0XHRcdHNlbGYubm9ybWFsaXplSGVpZ2h0KCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vc2V0dXAgbW92YWJsZSByb3dzXG5cblx0XHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMuZGF0YVRyZWUgJiYgc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJkYXRhVHJlZVwiKSkge1xuXG5cdFx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5kYXRhVHJlZS5sYXlvdXRSb3codGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdC8vc2V0dXAgY29sdW1uIGNvbGFwc2UgY29udGFpbmVyXG5cblx0XHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMucmVzcG9uc2l2ZUxheW91dCA9PT0gXCJjb2xsYXBzZVwiICYmIHNlbGYudGFibGUubW9kRXhpc3RzKFwicmVzcG9uc2l2ZUxheW91dFwiKSkge1xuXG5cdFx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5yZXNwb25zaXZlTGF5b3V0LmxheW91dFJvdyh0aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5yb3dGb3JtYXR0ZXIpIHtcblxuXHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMucm93Rm9ybWF0dGVyKHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHQvL3NldCByZXNpemFibGUgaGFuZGxlc1xuXG5cdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnJlc2l6YWJsZVJvd3MgJiYgc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJyZXNpemVSb3dzXCIpKSB7XG5cblx0XHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLnJlc2l6ZVJvd3MuaW5pdGlhbGl6ZVJvdyhzZWxmKTtcblx0XHRcdH1cblxuXHRcdFx0c2VsZi5pbml0aWFsaXplZCA9IHRydWU7XG5cdFx0fVxuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUucmVpbml0aWFsaXplSGVpZ2h0ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5oZWlnaHRJbml0aWFsaXplZCA9IGZhbHNlO1xuXG5cdFx0aWYgKHRoaXMuZWxlbWVudC5vZmZzZXRQYXJlbnQgIT09IG51bGwpIHtcblxuXHRcdFx0dGhpcy5ub3JtYWxpemVIZWlnaHQodHJ1ZSk7XG5cdFx0fVxuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUucmVpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5pbml0aWFsaXplZCA9IGZhbHNlO1xuXG5cdFx0dGhpcy5oZWlnaHRJbml0aWFsaXplZCA9IGZhbHNlO1xuXG5cdFx0aWYgKCF0aGlzLm1hbnVhbEhlaWdodCkge1xuXG5cdFx0XHR0aGlzLmhlaWdodCA9IDA7XG5cblx0XHRcdHRoaXMuaGVpZ2h0U3R5bGVkID0gXCJcIjtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5lbGVtZW50Lm9mZnNldFBhcmVudCAhPT0gbnVsbCkge1xuXG5cdFx0XHR0aGlzLmluaXRpYWxpemUodHJ1ZSk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vZ2V0IGhlaWdodHMgd2hlbiBkb2luZyBidWxrIHJvdyBzdHlsZSBjYWxjcyBpbiB2aXJ0dWFsIERPTVxuXG5cdFJvdy5wcm90b3R5cGUuY2FsY0hlaWdodCA9IGZ1bmN0aW9uIChmb3JjZSkge1xuXG5cdFx0dmFyIG1heEhlaWdodCA9IDAsXG5cdFx0ICAgIG1pbkhlaWdodCA9IHRoaXMudGFibGUub3B0aW9ucy5yZXNpemFibGVSb3dzID8gdGhpcy5lbGVtZW50LmNsaWVudEhlaWdodCA6IDA7XG5cblx0XHR0aGlzLmNlbGxzLmZvckVhY2goZnVuY3Rpb24gKGNlbGwpIHtcblxuXHRcdFx0dmFyIGhlaWdodCA9IGNlbGwuZ2V0SGVpZ2h0KCk7XG5cblx0XHRcdGlmIChoZWlnaHQgPiBtYXhIZWlnaHQpIHtcblxuXHRcdFx0XHRtYXhIZWlnaHQgPSBoZWlnaHQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRpZiAoZm9yY2UpIHtcblxuXHRcdFx0dGhpcy5oZWlnaHQgPSBNYXRoLm1heChtYXhIZWlnaHQsIG1pbkhlaWdodCk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dGhpcy5oZWlnaHQgPSB0aGlzLm1hbnVhbEhlaWdodCA/IHRoaXMuaGVpZ2h0IDogTWF0aC5tYXgobWF4SGVpZ2h0LCBtaW5IZWlnaHQpO1xuXHRcdH1cblxuXHRcdHRoaXMuaGVpZ2h0U3R5bGVkID0gdGhpcy5oZWlnaHQgPyB0aGlzLmhlaWdodCArIFwicHhcIiA6IFwiXCI7XG5cblx0XHR0aGlzLm91dGVySGVpZ2h0ID0gdGhpcy5lbGVtZW50Lm9mZnNldEhlaWdodDtcblx0fTtcblxuXHQvL3NldCBvZiBjZWxsc1xuXG5cdFJvdy5wcm90b3R5cGUuc2V0Q2VsbEhlaWdodCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuY2VsbHMuZm9yRWFjaChmdW5jdGlvbiAoY2VsbCkge1xuXG5cdFx0XHRjZWxsLnNldEhlaWdodCgpO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5oZWlnaHRJbml0aWFsaXplZCA9IHRydWU7XG5cdH07XG5cblx0Um93LnByb3RvdHlwZS5jbGVhckNlbGxIZWlnaHQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLmNlbGxzLmZvckVhY2goZnVuY3Rpb24gKGNlbGwpIHtcblxuXHRcdFx0Y2VsbC5jbGVhckhlaWdodCgpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdC8vbm9ybWFsaXplIHRoZSBoZWlnaHQgb2YgZWxlbWVudHMgaW4gdGhlIHJvd1xuXG5cdFJvdy5wcm90b3R5cGUubm9ybWFsaXplSGVpZ2h0ID0gZnVuY3Rpb24gKGZvcmNlKSB7XG5cblx0XHRpZiAoZm9yY2UpIHtcblxuXHRcdFx0dGhpcy5jbGVhckNlbGxIZWlnaHQoKTtcblx0XHR9XG5cblx0XHR0aGlzLmNhbGNIZWlnaHQoZm9yY2UpO1xuXG5cdFx0dGhpcy5zZXRDZWxsSGVpZ2h0KCk7XG5cdH07XG5cblx0Ly8gUm93LnByb3RvdHlwZS5zZXRIZWlnaHQgPSBmdW5jdGlvbihoZWlnaHQpe1xuXG5cdC8vIFx0dGhpcy5oZWlnaHQgPSBoZWlnaHQ7XG5cblxuXHQvLyBcdHRoaXMuc2V0Q2VsbEhlaWdodCgpO1xuXG5cdC8vIH07XG5cblxuXHQvL3NldCBoZWlnaHQgb2Ygcm93c1xuXG5cdFJvdy5wcm90b3R5cGUuc2V0SGVpZ2h0ID0gZnVuY3Rpb24gKGhlaWdodCwgZm9yY2UpIHtcblxuXHRcdGlmICh0aGlzLmhlaWdodCAhPSBoZWlnaHQgfHwgZm9yY2UpIHtcblxuXHRcdFx0dGhpcy5tYW51YWxIZWlnaHQgPSB0cnVlO1xuXG5cdFx0XHR0aGlzLmhlaWdodCA9IGhlaWdodDtcblxuXHRcdFx0dGhpcy5oZWlnaHRTdHlsZWQgPSBoZWlnaHQgPyBoZWlnaHQgKyBcInB4XCIgOiBcIlwiO1xuXG5cdFx0XHR0aGlzLnNldENlbGxIZWlnaHQoKTtcblxuXHRcdFx0Ly8gdGhpcy5vdXRlckhlaWdodCA9IHRoaXMuZWxlbWVudC5vdXRlckhlaWdodCgpO1xuXG5cdFx0XHR0aGlzLm91dGVySGVpZ2h0ID0gdGhpcy5lbGVtZW50Lm9mZnNldEhlaWdodDtcblx0XHR9XG5cdH07XG5cblx0Ly9yZXR1cm4gcm93cyBvdXRlciBoZWlnaHRcblxuXHRSb3cucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLm91dGVySGVpZ2h0O1xuXHR9O1xuXG5cdC8vcmV0dXJuIHJvd3Mgb3V0ZXIgV2lkdGhcblxuXHRSb3cucHJvdG90eXBlLmdldFdpZHRoID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuZWxlbWVudC5vZmZzZXRXaWR0aDtcblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8vIENlbGwgTWFuYWdlbWVudCAvLy8vLy8vLy8vLy8vLy8vL1xuXG5cblx0Um93LnByb3RvdHlwZS5kZWxldGVDZWxsID0gZnVuY3Rpb24gKGNlbGwpIHtcblxuXHRcdHZhciBpbmRleCA9IHRoaXMuY2VsbHMuaW5kZXhPZihjZWxsKTtcblxuXHRcdGlmIChpbmRleCA+IC0xKSB7XG5cblx0XHRcdHRoaXMuY2VsbHMuc3BsaWNlKGluZGV4LCAxKTtcblx0XHR9XG5cdH07XG5cblx0Ly8vLy8vLy8vLy8vLy8vLyBEYXRhIE1hbmFnZW1lbnQgLy8vLy8vLy8vLy8vLy8vLy9cblxuXG5cdFJvdy5wcm90b3R5cGUuc2V0RGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cblx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJtdXRhdG9yXCIpKSB7XG5cblx0XHRcdGRhdGEgPSB0aGlzLnRhYmxlLm1vZHVsZXMubXV0YXRvci50cmFuc2Zvcm1Sb3coZGF0YSwgXCJkYXRhXCIpO1xuXHRcdH1cblxuXHRcdHRoaXMuZGF0YSA9IGRhdGE7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnJlYWN0aXZlRGF0YSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInJlYWN0aXZlRGF0YVwiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMucmVhY3RpdmVEYXRhLndhdGNoUm93KHRoaXMpO1xuXHRcdH1cblx0fTtcblxuXHQvL3VwZGF0ZSB0aGUgcm93cyBkYXRhXG5cblx0Um93LnByb3RvdHlwZS51cGRhdGVEYXRhID0gZnVuY3Rpb24gKHVwZGF0ZWREYXRhKSB7XG5cdFx0dmFyIF90aGlzMTUgPSB0aGlzO1xuXG5cdFx0dmFyIHZpc2libGUgPSBUYWJ1bGF0b3IucHJvdG90eXBlLmhlbHBlcnMuZWxWaXNpYmxlKHRoaXMuZWxlbWVudCksXG5cdFx0ICAgIHRlbXBEYXRhID0ge30sXG5cdFx0ICAgIG5ld1Jvd0RhdGE7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG5cdFx0XHRpZiAodHlwZW9mIHVwZGF0ZWREYXRhID09PSBcInN0cmluZ1wiKSB7XG5cblx0XHRcdFx0dXBkYXRlZERhdGEgPSBKU09OLnBhcnNlKHVwZGF0ZWREYXRhKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF90aGlzMTUudGFibGUub3B0aW9ucy5yZWFjdGl2ZURhdGEgJiYgX3RoaXMxNS50YWJsZS5tb2RFeGlzdHMoXCJyZWFjdGl2ZURhdGFcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0XHRfdGhpczE1LnRhYmxlLm1vZHVsZXMucmVhY3RpdmVEYXRhLmJsb2NrKCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vbXV0YXRlIGluY29tbWluZyBkYXRhIGlmIG5lZWRlZFxuXG5cdFx0XHRpZiAoX3RoaXMxNS50YWJsZS5tb2RFeGlzdHMoXCJtdXRhdG9yXCIpKSB7XG5cblx0XHRcdFx0dGVtcERhdGEgPSBPYmplY3QuYXNzaWduKHRlbXBEYXRhLCBfdGhpczE1LmRhdGEpO1xuXG5cdFx0XHRcdHRlbXBEYXRhID0gT2JqZWN0LmFzc2lnbih0ZW1wRGF0YSwgdXBkYXRlZERhdGEpO1xuXG5cdFx0XHRcdG5ld1Jvd0RhdGEgPSBfdGhpczE1LnRhYmxlLm1vZHVsZXMubXV0YXRvci50cmFuc2Zvcm1Sb3codGVtcERhdGEsIFwiZGF0YVwiLCB1cGRhdGVkRGF0YSk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdG5ld1Jvd0RhdGEgPSB1cGRhdGVkRGF0YTtcblx0XHRcdH1cblxuXHRcdFx0Ly9zZXQgZGF0YVxuXG5cdFx0XHRmb3IgKHZhciBhdHRybmFtZSBpbiBuZXdSb3dEYXRhKSB7XG5cblx0XHRcdFx0X3RoaXMxNS5kYXRhW2F0dHJuYW1lXSA9IG5ld1Jvd0RhdGFbYXR0cm5hbWVdO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX3RoaXMxNS50YWJsZS5vcHRpb25zLnJlYWN0aXZlRGF0YSAmJiBfdGhpczE1LnRhYmxlLm1vZEV4aXN0cyhcInJlYWN0aXZlRGF0YVwiLCB0cnVlKSkge1xuXG5cdFx0XHRcdF90aGlzMTUudGFibGUubW9kdWxlcy5yZWFjdGl2ZURhdGEudW5ibG9jaygpO1xuXHRcdFx0fVxuXG5cdFx0XHQvL3VwZGF0ZSBhZmZlY3RlZCBjZWxscyBvbmx5XG5cblx0XHRcdGZvciAodmFyIGF0dHJuYW1lIGluIHVwZGF0ZWREYXRhKSB7XG5cblx0XHRcdFx0dmFyIGNvbHVtbnMgPSBfdGhpczE1LnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0Q29sdW1uc0J5RmllbGRSb290KGF0dHJuYW1lKTtcblxuXHRcdFx0XHRjb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXG5cdFx0XHRcdFx0dmFyIGNlbGwgPSBfdGhpczE1LmdldENlbGwoY29sdW1uLmdldEZpZWxkKCkpO1xuXG5cdFx0XHRcdFx0aWYgKGNlbGwpIHtcblxuXHRcdFx0XHRcdFx0dmFyIHZhbHVlID0gY29sdW1uLmdldEZpZWxkVmFsdWUobmV3Um93RGF0YSk7XG5cblx0XHRcdFx0XHRcdGlmIChjZWxsLmdldFZhbHVlKCkgIT0gdmFsdWUpIHtcblxuXHRcdFx0XHRcdFx0XHRjZWxsLnNldFZhbHVlUHJvY2Vzc0RhdGEodmFsdWUpO1xuXG5cdFx0XHRcdFx0XHRcdGlmICh2aXNpYmxlKSB7XG5cblx0XHRcdFx0XHRcdFx0XHRjZWxsLmNlbGxSZW5kZXJlZCgpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0Ly9QYXJ0aWFsIHJlaW5pdGlhbGl6YXRpb24gaWYgdmlzaWJsZVxuXG5cdFx0XHRpZiAodmlzaWJsZSkge1xuXG5cdFx0XHRcdF90aGlzMTUubm9ybWFsaXplSGVpZ2h0KHRydWUpO1xuXG5cdFx0XHRcdGlmIChfdGhpczE1LnRhYmxlLm9wdGlvbnMucm93Rm9ybWF0dGVyKSB7XG5cblx0XHRcdFx0XHRfdGhpczE1LnRhYmxlLm9wdGlvbnMucm93Rm9ybWF0dGVyKF90aGlzMTUuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdF90aGlzMTUuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcblxuXHRcdFx0XHRfdGhpczE1LmhlaWdodCA9IDA7XG5cblx0XHRcdFx0X3RoaXMxNS5oZWlnaHRTdHlsZWQgPSBcIlwiO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX3RoaXMxNS50YWJsZS5vcHRpb25zLmRhdGFUcmVlICE9PSBmYWxzZSAmJiBfdGhpczE1LnRhYmxlLm1vZEV4aXN0cyhcImRhdGFUcmVlXCIpICYmIF90aGlzMTUudGFibGUubW9kdWxlcy5kYXRhVHJlZS5yZWRyYXdOZWVkZWQodXBkYXRlZERhdGEpKSB7XG5cblx0XHRcdFx0X3RoaXMxNS50YWJsZS5tb2R1bGVzLmRhdGFUcmVlLmluaXRpYWxpemVSb3coX3RoaXMxNSk7XG5cblx0XHRcdFx0X3RoaXMxNS50YWJsZS5tb2R1bGVzLmRhdGFUcmVlLmxheW91dFJvdyhfdGhpczE1KTtcblxuXHRcdFx0XHRfdGhpczE1LnRhYmxlLnJvd01hbmFnZXIucmVmcmVzaEFjdGl2ZURhdGEoXCJ0cmVlXCIsIGZhbHNlLCB0cnVlKTtcblx0XHRcdH1cblxuXHRcdFx0Ly90aGlzLnJlaW5pdGlhbGl6ZSgpO1xuXG5cblx0XHRcdF90aGlzMTUudGFibGUub3B0aW9ucy5yb3dVcGRhdGVkLmNhbGwoX3RoaXMxNS50YWJsZSwgX3RoaXMxNS5nZXRDb21wb25lbnQoKSk7XG5cblx0XHRcdHJlc29sdmUoKTtcblx0XHR9KTtcblx0fTtcblxuXHRSb3cucHJvdG90eXBlLmdldERhdGEgPSBmdW5jdGlvbiAodHJhbnNmb3JtKSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRpZiAodHJhbnNmb3JtKSB7XG5cblx0XHRcdGlmIChzZWxmLnRhYmxlLm1vZEV4aXN0cyhcImFjY2Vzc29yXCIpKSB7XG5cblx0XHRcdFx0cmV0dXJuIHNlbGYudGFibGUubW9kdWxlcy5hY2Nlc3Nvci50cmFuc2Zvcm1Sb3coc2VsZi5kYXRhLCB0cmFuc2Zvcm0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiB0aGlzLmRhdGE7XG5cdFx0fVxuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUuZ2V0Q2VsbCA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdHZhciBtYXRjaCA9IGZhbHNlO1xuXG5cdFx0Y29sdW1uID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW4oY29sdW1uKTtcblxuXHRcdG1hdGNoID0gdGhpcy5jZWxscy5maW5kKGZ1bmN0aW9uIChjZWxsKSB7XG5cblx0XHRcdHJldHVybiBjZWxsLmNvbHVtbiA9PT0gY29sdW1uO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG1hdGNoO1xuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUuZ2V0Q2VsbEluZGV4ID0gZnVuY3Rpb24gKGZpbmRDZWxsKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5jZWxscy5maW5kSW5kZXgoZnVuY3Rpb24gKGNlbGwpIHtcblxuXHRcdFx0cmV0dXJuIGNlbGwgPT09IGZpbmRDZWxsO1xuXHRcdH0pO1xuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUuZmluZE5leHRFZGl0YWJsZUNlbGwgPSBmdW5jdGlvbiAoaW5kZXgpIHtcblxuXHRcdHZhciBuZXh0Q2VsbCA9IGZhbHNlO1xuXG5cdFx0aWYgKGluZGV4IDwgdGhpcy5jZWxscy5sZW5ndGggLSAxKSB7XG5cblx0XHRcdGZvciAodmFyIGkgPSBpbmRleCArIDE7IGkgPCB0aGlzLmNlbGxzLmxlbmd0aDsgaSsrKSB7XG5cblx0XHRcdFx0dmFyIGNlbGwgPSB0aGlzLmNlbGxzW2ldO1xuXG5cdFx0XHRcdGlmIChjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQgJiYgVGFidWxhdG9yLnByb3RvdHlwZS5oZWxwZXJzLmVsVmlzaWJsZShjZWxsLmdldEVsZW1lbnQoKSkpIHtcblxuXHRcdFx0XHRcdHZhciBhbGxvd0VkaXQgPSB0cnVlO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZiBjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQuY2hlY2sgPT0gXCJmdW5jdGlvblwiKSB7XG5cblx0XHRcdFx0XHRcdGFsbG93RWRpdCA9IGNlbGwuY29sdW1uLm1vZHVsZXMuZWRpdC5jaGVjayhjZWxsLmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoYWxsb3dFZGl0KSB7XG5cblx0XHRcdFx0XHRcdG5leHRDZWxsID0gY2VsbDtcblxuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG5leHRDZWxsO1xuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUuZmluZFByZXZFZGl0YWJsZUNlbGwgPSBmdW5jdGlvbiAoaW5kZXgpIHtcblxuXHRcdHZhciBwcmV2Q2VsbCA9IGZhbHNlO1xuXG5cdFx0aWYgKGluZGV4ID4gMCkge1xuXG5cdFx0XHRmb3IgKHZhciBpID0gaW5kZXggLSAxOyBpID49IDA7IGktLSkge1xuXG5cdFx0XHRcdHZhciBjZWxsID0gdGhpcy5jZWxsc1tpXSxcblx0XHRcdFx0ICAgIGFsbG93RWRpdCA9IHRydWU7XG5cblx0XHRcdFx0aWYgKGNlbGwuY29sdW1uLm1vZHVsZXMuZWRpdCAmJiBUYWJ1bGF0b3IucHJvdG90eXBlLmhlbHBlcnMuZWxWaXNpYmxlKGNlbGwuZ2V0RWxlbWVudCgpKSkge1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZiBjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQuY2hlY2sgPT0gXCJmdW5jdGlvblwiKSB7XG5cblx0XHRcdFx0XHRcdGFsbG93RWRpdCA9IGNlbGwuY29sdW1uLm1vZHVsZXMuZWRpdC5jaGVjayhjZWxsLmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoYWxsb3dFZGl0KSB7XG5cblx0XHRcdFx0XHRcdHByZXZDZWxsID0gY2VsbDtcblxuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHByZXZDZWxsO1xuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUuZ2V0Q2VsbHMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5jZWxscztcblx0fTtcblxuXHRSb3cucHJvdG90eXBlLm5leHRSb3cgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgcm93ID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLm5leHREaXNwbGF5Um93KHRoaXMsIHRydWUpO1xuXG5cdFx0cmV0dXJuIHJvdyB8fCBmYWxzZTtcblx0fTtcblxuXHRSb3cucHJvdG90eXBlLnByZXZSb3cgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgcm93ID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLnByZXZEaXNwbGF5Um93KHRoaXMsIHRydWUpO1xuXG5cdFx0cmV0dXJuIHJvdyB8fCBmYWxzZTtcblx0fTtcblxuXHRSb3cucHJvdG90eXBlLm1vdmVUb1JvdyA9IGZ1bmN0aW9uICh0bywgYmVmb3JlKSB7XG5cblx0XHR2YXIgdG9Sb3cgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZmluZFJvdyh0byk7XG5cblx0XHRpZiAodG9Sb3cpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLm1vdmVSb3dBY3R1YWwodGhpcywgdG9Sb3csICFiZWZvcmUpO1xuXG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucmVmcmVzaEFjdGl2ZURhdGEoXCJkaXNwbGF5XCIsIGZhbHNlLCB0cnVlKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRjb25zb2xlLndhcm4oXCJNb3ZlIEVycm9yIC0gTm8gbWF0Y2hpbmcgcm93IGZvdW5kOlwiLCB0byk7XG5cdFx0fVxuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUudmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgaW52YWxpZCA9IFtdO1xuXG5cdFx0dGhpcy5jZWxscy5mb3JFYWNoKGZ1bmN0aW9uIChjZWxsKSB7XG5cblx0XHRcdGlmICghY2VsbC52YWxpZGF0ZSgpKSB7XG5cblx0XHRcdFx0aW52YWxpZC5wdXNoKGNlbGwuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGludmFsaWQubGVuZ3RoID8gaW52YWxpZCA6IHRydWU7XG5cdH07XG5cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vIEFjdGlvbnMgIC8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5cblx0Um93LnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIF90aGlzMTYgPSB0aGlzO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdFx0dmFyIGluZGV4LCByb3dzO1xuXG5cdFx0XHRpZiAoX3RoaXMxNi50YWJsZS5vcHRpb25zLmhpc3RvcnkgJiYgX3RoaXMxNi50YWJsZS5tb2RFeGlzdHMoXCJoaXN0b3J5XCIpKSB7XG5cblx0XHRcdFx0aWYgKF90aGlzMTYudGFibGUub3B0aW9ucy5ncm91cEJ5ICYmIF90aGlzMTYudGFibGUubW9kRXhpc3RzKFwiZ3JvdXBSb3dzXCIpKSB7XG5cblx0XHRcdFx0XHRyb3dzID0gX3RoaXMxNi5nZXRHcm91cCgpLnJvd3M7XG5cblx0XHRcdFx0XHRpbmRleCA9IHJvd3MuaW5kZXhPZihfdGhpczE2KTtcblxuXHRcdFx0XHRcdGlmIChpbmRleCkge1xuXG5cdFx0XHRcdFx0XHRpbmRleCA9IHJvd3NbaW5kZXggLSAxXTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRpbmRleCA9IF90aGlzMTYudGFibGUucm93TWFuYWdlci5nZXRSb3dJbmRleChfdGhpczE2KTtcblxuXHRcdFx0XHRcdGlmIChpbmRleCkge1xuXG5cdFx0XHRcdFx0XHRpbmRleCA9IF90aGlzMTYudGFibGUucm93TWFuYWdlci5yb3dzW2luZGV4IC0gMV07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0X3RoaXMxNi50YWJsZS5tb2R1bGVzLmhpc3RvcnkuYWN0aW9uKFwicm93RGVsZXRlXCIsIF90aGlzMTYsIHsgZGF0YTogX3RoaXMxNi5nZXREYXRhKCksIHBvczogIWluZGV4LCBpbmRleDogaW5kZXggfSk7XG5cdFx0XHR9XG5cblx0XHRcdF90aGlzMTYuZGVsZXRlQWN0dWFsKCk7XG5cblx0XHRcdHJlc29sdmUoKTtcblx0XHR9KTtcblx0fTtcblxuXHRSb3cucHJvdG90eXBlLmRlbGV0ZUFjdHVhbCA9IGZ1bmN0aW9uIChibG9ja1JlZHJhdykge1xuXG5cdFx0dmFyIGluZGV4ID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldFJvd0luZGV4KHRoaXMpO1xuXG5cdFx0Ly9kZXNlbGVjdCByb3cgaWYgaXQgaXMgc2VsZWN0ZWRcblxuXHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInNlbGVjdFJvd1wiKSkge1xuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuc2VsZWN0Um93Ll9kZXNlbGVjdFJvdyh0aGlzLCB0cnVlKTtcblx0XHR9XG5cblx0XHQvL2NhbmNlbCBlZGl0IGlmIHJvdyBpcyBjdXJyZW50bHkgYmVpbmcgZWRpdGVkXG5cblx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJlZGl0XCIpKSB7XG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbC5yb3cgPT09IHRoaXMpIHtcblxuXHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5jYW5jZWxFZGl0KCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gaWYodGhpcy50YWJsZS5vcHRpb25zLmRhdGFUcmVlICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiZGF0YVRyZWVcIikpe1xuXG5cdFx0Ly8gXHR0aGlzLnRhYmxlLm1vZHVsZXMuZGF0YVRyZWUuY29sbGFwc2VSb3codGhpcywgdHJ1ZSk7XG5cblx0XHQvLyB9XG5cblxuXHRcdC8vcmVtb3ZlIGFueSByZWFjdGl2ZSBkYXRhIHdhdGNoZXJzIGZyb20gcm93IG9iamVjdFxuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5yZWFjdGl2ZURhdGEgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJyZWFjdGl2ZURhdGFcIiwgdHJ1ZSkpIHt9XG5cblx0XHQvLyB0aGlzLnRhYmxlLm1vZHVsZXMucmVhY3RpdmVEYXRhLnVud2F0Y2hSb3codGhpcyk7XG5cblx0XHQvL3JlbW92ZSBmcm9tIGdyb3VwXG5cblx0XHRpZiAodGhpcy5tb2R1bGVzLmdyb3VwKSB7XG5cblx0XHRcdHRoaXMubW9kdWxlcy5ncm91cC5yZW1vdmVSb3codGhpcyk7XG5cdFx0fVxuXG5cdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmRlbGV0ZVJvdyh0aGlzLCBibG9ja1JlZHJhdyk7XG5cblx0XHR0aGlzLmRlbGV0ZUNlbGxzKCk7XG5cblx0XHR0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7XG5cblx0XHR0aGlzLmhlaWdodEluaXRpYWxpemVkID0gZmFsc2U7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmRhdGFUcmVlICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiZGF0YVRyZWVcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmRhdGFUcmVlLnJvd0RlbGV0ZSh0aGlzKTtcblx0XHR9XG5cblx0XHQvL3JlY2FsYyBjb2x1bW4gY2FsY3VsYXRpb25zIGlmIHByZXNlbnRcblxuXHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpKSB7XG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImdyb3VwUm93c1wiKSkge1xuXG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5yZWNhbGNSb3dHcm91cCh0aGlzKTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLnJlY2FsYyh0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWN0aXZlUm93cyk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUuZGVsZXRlQ2VsbHMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgY2VsbENvdW50ID0gdGhpcy5jZWxscy5sZW5ndGg7XG5cblx0XHRmb3IgKHZhciBfaTUgPSAwOyBfaTUgPCBjZWxsQ291bnQ7IF9pNSsrKSB7XG5cblx0XHRcdHRoaXMuY2VsbHNbMF0uZGVsZXRlKCk7XG5cdFx0fVxuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUud2lwZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuZGVsZXRlQ2VsbHMoKTtcblxuXHRcdHdoaWxlICh0aGlzLmVsZW1lbnQuZmlyc3RDaGlsZCkge1xuXHRcdFx0dGhpcy5lbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudC5maXJzdENoaWxkKTtcblx0XHR9dGhpcy5lbGVtZW50ID0gZmFsc2U7XG5cblx0XHR0aGlzLm1vZHVsZXMgPSB7fTtcblxuXHRcdGlmICh0aGlzLmVsZW1lbnQucGFyZW50Tm9kZSkge1xuXG5cdFx0XHR0aGlzLmVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnQpO1xuXHRcdH1cblx0fTtcblxuXHRSb3cucHJvdG90eXBlLmdldEdyb3VwID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMubW9kdWxlcy5ncm91cCB8fCBmYWxzZTtcblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8vIE9iamVjdCBHZW5lcmF0aW9uIC8vLy8vLy8vLy8vLy8vLy8vXG5cblx0Um93LnByb3RvdHlwZS5nZXRDb21wb25lbnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAoIXRoaXMuY29tcG9uZW50KSB7XG5cblx0XHRcdHRoaXMuY29tcG9uZW50ID0gbmV3IFJvd0NvbXBvbmVudCh0aGlzKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcy5jb21wb25lbnQ7XG5cdH07XG5cblx0Ly9wdWJsaWMgcm93IG9iamVjdFxuXG5cdHZhciBDZWxsQ29tcG9uZW50ID0gZnVuY3Rpb24gQ2VsbENvbXBvbmVudChjZWxsKSB7XG5cblx0XHR0aGlzLl9jZWxsID0gY2VsbDtcblx0fTtcblxuXHRDZWxsQ29tcG9uZW50LnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9jZWxsLmdldFZhbHVlKCk7XG5cdH07XG5cblx0Q2VsbENvbXBvbmVudC5wcm90b3R5cGUuZ2V0T2xkVmFsdWUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fY2VsbC5nZXRPbGRWYWx1ZSgpO1xuXHR9O1xuXG5cdENlbGxDb21wb25lbnQucHJvdG90eXBlLmdldEVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fY2VsbC5nZXRFbGVtZW50KCk7XG5cdH07XG5cblx0Q2VsbENvbXBvbmVudC5wcm90b3R5cGUuZ2V0Um93ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuX2NlbGwucm93LmdldENvbXBvbmVudCgpO1xuXHR9O1xuXG5cdENlbGxDb21wb25lbnQucHJvdG90eXBlLmdldERhdGEgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fY2VsbC5yb3cuZ2V0RGF0YSgpO1xuXHR9O1xuXG5cdENlbGxDb21wb25lbnQucHJvdG90eXBlLmdldEZpZWxkID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuX2NlbGwuY29sdW1uLmdldEZpZWxkKCk7XG5cdH07XG5cblx0Q2VsbENvbXBvbmVudC5wcm90b3R5cGUuZ2V0Q29sdW1uID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuX2NlbGwuY29sdW1uLmdldENvbXBvbmVudCgpO1xuXHR9O1xuXG5cdENlbGxDb21wb25lbnQucHJvdG90eXBlLnNldFZhbHVlID0gZnVuY3Rpb24gKHZhbHVlLCBtdXRhdGUpIHtcblxuXHRcdGlmICh0eXBlb2YgbXV0YXRlID09IFwidW5kZWZpbmVkXCIpIHtcblxuXHRcdFx0bXV0YXRlID0gdHJ1ZTtcblx0XHR9XG5cblx0XHR0aGlzLl9jZWxsLnNldFZhbHVlKHZhbHVlLCBtdXRhdGUpO1xuXHR9O1xuXG5cdENlbGxDb21wb25lbnQucHJvdG90eXBlLnJlc3RvcmVPbGRWYWx1ZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuX2NlbGwuc2V0VmFsdWVBY3R1YWwodGhpcy5fY2VsbC5nZXRPbGRWYWx1ZSgpKTtcblx0fTtcblxuXHRDZWxsQ29tcG9uZW50LnByb3RvdHlwZS5lZGl0ID0gZnVuY3Rpb24gKGZvcmNlKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fY2VsbC5lZGl0KGZvcmNlKTtcblx0fTtcblxuXHRDZWxsQ29tcG9uZW50LnByb3RvdHlwZS5jYW5jZWxFZGl0ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5fY2VsbC5jYW5jZWxFZGl0KCk7XG5cdH07XG5cblx0Q2VsbENvbXBvbmVudC5wcm90b3R5cGUuaXNFZGl0ZWQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gISF0aGlzLl9jZWxsLm1vZHVsZXMuZWRpdCAmJiB0aGlzLl9jZWxsLm1vZHVsZXMuZWRpdC5lZGl0ZWQ7XG5cdH07XG5cblx0Q2VsbENvbXBvbmVudC5wcm90b3R5cGUuY2xlYXJFZGl0ZWQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAoc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJlZGl0XCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMuX2NlbGwudGFibGUubW9kdWxlcy5lZGl0LmNsZWFyRWRpdGVkKHRoaXMuX2NlbGwpO1xuXHRcdH1cblx0fTtcblxuXHRDZWxsQ29tcG9uZW50LnByb3RvdHlwZS5pc1ZhbGlkID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuX2NlbGwubW9kdWxlcy52YWxpZGF0ZSA/ICF0aGlzLl9jZWxsLm1vZHVsZXMudmFsaWRhdGUuaW52YWxpZCA6IHRydWU7XG5cdH07XG5cblx0Q2VsbENvbXBvbmVudC5wcm90b3R5cGUudmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fY2VsbC52YWxpZGF0ZSgpO1xuXHR9O1xuXG5cdENlbGxDb21wb25lbnQucHJvdG90eXBlLmNsZWFyVmFsaWRhdGlvbiA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmIChzZWxmLnRhYmxlLm1vZEV4aXN0cyhcInZhbGlkYXRlXCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMuX2NlbGwudGFibGUubW9kdWxlcy52YWxpZGF0ZS5jbGVhclZhbGlkYXRpb24odGhpcy5fY2VsbCk7XG5cdFx0fVxuXHR9O1xuXG5cdENlbGxDb21wb25lbnQucHJvdG90eXBlLm5hdiA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9jZWxsLm5hdigpO1xuXHR9O1xuXG5cdENlbGxDb21wb25lbnQucHJvdG90eXBlLmNoZWNrSGVpZ2h0ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5fY2VsbC5jaGVja0hlaWdodCgpO1xuXHR9O1xuXG5cdENlbGxDb21wb25lbnQucHJvdG90eXBlLmdldFRhYmxlID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuX2NlbGwudGFibGU7XG5cdH07XG5cblx0Q2VsbENvbXBvbmVudC5wcm90b3R5cGUuX2dldFNlbGYgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fY2VsbDtcblx0fTtcblxuXHR2YXIgQ2VsbCA9IGZ1bmN0aW9uIENlbGwoY29sdW1uLCByb3cpIHtcblxuXHRcdHRoaXMudGFibGUgPSBjb2x1bW4udGFibGU7XG5cblx0XHR0aGlzLmNvbHVtbiA9IGNvbHVtbjtcblxuXHRcdHRoaXMucm93ID0gcm93O1xuXG5cdFx0dGhpcy5lbGVtZW50ID0gbnVsbDtcblxuXHRcdHRoaXMudmFsdWUgPSBudWxsO1xuXG5cdFx0dGhpcy5vbGRWYWx1ZSA9IG51bGw7XG5cblx0XHR0aGlzLm1vZHVsZXMgPSB7fTtcblxuXHRcdHRoaXMuaGVpZ2h0ID0gbnVsbDtcblxuXHRcdHRoaXMud2lkdGggPSBudWxsO1xuXG5cdFx0dGhpcy5taW5XaWR0aCA9IG51bGw7XG5cblx0XHR0aGlzLmNvbXBvbmVudCA9IG51bGw7XG5cblx0XHR0aGlzLmJ1aWxkKCk7XG5cdH07XG5cblx0Ly8vLy8vLy8vLy8vLy8vLyBTZXR1cCBGdW5jdGlvbnMgLy8vLy8vLy8vLy8vLy8vLy9cblxuXG5cdC8vZ2VuZXJhdGUgZWxlbWVudFxuXG5cdENlbGwucHJvdG90eXBlLmJ1aWxkID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5nZW5lcmF0ZUVsZW1lbnQoKTtcblxuXHRcdHRoaXMuc2V0V2lkdGgoKTtcblxuXHRcdHRoaXMuX2NvbmZpZ3VyZUNlbGwoKTtcblxuXHRcdHRoaXMuc2V0VmFsdWVBY3R1YWwodGhpcy5jb2x1bW4uZ2V0RmllbGRWYWx1ZSh0aGlzLnJvdy5kYXRhKSk7XG5cdH07XG5cblx0Q2VsbC5wcm90b3R5cGUuZ2VuZXJhdGVFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5lbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cblx0XHR0aGlzLmVsZW1lbnQuY2xhc3NOYW1lID0gXCJ0YWJ1bGF0b3ItY2VsbFwiO1xuXG5cdFx0dGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZShcInJvbGVcIiwgXCJncmlkY2VsbFwiKTtcblxuXHRcdHRoaXMuZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblx0fTtcblxuXHRDZWxsLnByb3RvdHlwZS5fY29uZmlndXJlQ2VsbCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgY2VsbEV2ZW50cyA9IHNlbGYuY29sdW1uLmNlbGxFdmVudHMsXG5cdFx0ICAgIGVsZW1lbnQgPSBzZWxmLmVsZW1lbnQsXG5cdFx0ICAgIGZpZWxkID0gdGhpcy5jb2x1bW4uZ2V0RmllbGQoKSxcblx0XHQgICAgdmVydEFsaWducyA9IHtcblxuXHRcdFx0dG9wOiBcImZsZXgtc3RhcnRcIixcblxuXHRcdFx0Ym90dG9tOiBcImZsZXgtZW5kXCIsXG5cblx0XHRcdG1pZGRsZTogXCJjZW50ZXJcIlxuXG5cdFx0fSxcblx0XHQgICAgaG96QWxpZ25zID0ge1xuXG5cdFx0XHRsZWZ0OiBcImZsZXgtc3RhcnRcIixcblxuXHRcdFx0cmlnaHQ6IFwiZmxleC1lbmRcIixcblxuXHRcdFx0Y2VudGVyOiBcImNlbnRlclwiXG5cblx0XHR9O1xuXG5cdFx0Ly9zZXQgdGV4dCBhbGlnbm1lbnRcblxuXHRcdGVsZW1lbnQuc3R5bGUudGV4dEFsaWduID0gc2VsZi5jb2x1bW4uaG96QWxpZ247XG5cblx0XHRpZiAoc2VsZi5jb2x1bW4udmVydEFsaWduKSB7XG5cblx0XHRcdGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwiaW5saW5lLWZsZXhcIjtcblxuXHRcdFx0ZWxlbWVudC5zdHlsZS5hbGlnbkl0ZW1zID0gdmVydEFsaWduc1tzZWxmLmNvbHVtbi52ZXJ0QWxpZ25dIHx8IFwiXCI7XG5cblx0XHRcdGlmIChzZWxmLmNvbHVtbi5ob3pBbGlnbikge1xuXG5cdFx0XHRcdGVsZW1lbnQuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSBob3pBbGlnbnNbc2VsZi5jb2x1bW4uaG96QWxpZ25dIHx8IFwiXCI7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKGZpZWxkKSB7XG5cblx0XHRcdGVsZW1lbnQuc2V0QXR0cmlidXRlKFwidGFidWxhdG9yLWZpZWxkXCIsIGZpZWxkKTtcblx0XHR9XG5cblx0XHQvL2FkZCBjbGFzcyB0byBjZWxsIGlmIG5lZWRlZFxuXG5cdFx0aWYgKHNlbGYuY29sdW1uLmRlZmluaXRpb24uY3NzQ2xhc3MpIHtcblxuXHRcdFx0dmFyIGNsYXNzTmFtZXMgPSBzZWxmLmNvbHVtbi5kZWZpbml0aW9uLmNzc0NsYXNzLnNwbGl0KFwiIFwiKTtcblxuXHRcdFx0Y2xhc3NOYW1lcy5mb3JFYWNoKGZ1bmN0aW9uIChjbGFzc05hbWUpIHtcblxuXHRcdFx0XHRlbGVtZW50LmNsYXNzTGlzdC5hZGQoY2xhc3NOYW1lKTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8vdXBkYXRlIHRvb2x0aXAgb24gbW91c2UgZW50ZXJcblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMudG9vbHRpcEdlbmVyYXRpb25Nb2RlID09PSBcImhvdmVyXCIpIHtcblxuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VlbnRlclwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdHNlbGYuX2dlbmVyYXRlVG9vbHRpcCgpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0c2VsZi5fYmluZENsaWNrRXZlbnRzKGNlbGxFdmVudHMpO1xuXG5cdFx0c2VsZi5fYmluZFRvdWNoRXZlbnRzKGNlbGxFdmVudHMpO1xuXG5cdFx0c2VsZi5fYmluZE1vdXNlRXZlbnRzKGNlbGxFdmVudHMpO1xuXG5cdFx0aWYgKHNlbGYuY29sdW1uLm1vZHVsZXMuZWRpdCkge1xuXG5cdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMuZWRpdC5iaW5kRWRpdG9yKHNlbGYpO1xuXHRcdH1cblxuXHRcdGlmIChzZWxmLmNvbHVtbi5kZWZpbml0aW9uLnJvd0hhbmRsZSAmJiBzZWxmLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3MgIT09IGZhbHNlICYmIHNlbGYudGFibGUubW9kRXhpc3RzKFwibW92ZVJvd1wiKSkge1xuXG5cdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMubW92ZVJvdy5pbml0aWFsaXplQ2VsbChzZWxmKTtcblx0XHR9XG5cblx0XHQvL2hpZGUgY2VsbCBpZiBub3QgdmlzaWJsZVxuXG5cdFx0aWYgKCFzZWxmLmNvbHVtbi52aXNpYmxlKSB7XG5cblx0XHRcdHNlbGYuaGlkZSgpO1xuXHRcdH1cblx0fTtcblxuXHRDZWxsLnByb3RvdHlwZS5fYmluZENsaWNrRXZlbnRzID0gZnVuY3Rpb24gKGNlbGxFdmVudHMpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgZWxlbWVudCA9IHNlbGYuZWxlbWVudDtcblxuXHRcdC8vc2V0IGV2ZW50IGJpbmRpbmdzXG5cblx0XHRpZiAoY2VsbEV2ZW50cy5jZWxsQ2xpY2sgfHwgc2VsZi50YWJsZS5vcHRpb25zLmNlbGxDbGljaykge1xuXG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdHZhciBjb21wb25lbnQgPSBzZWxmLmdldENvbXBvbmVudCgpO1xuXG5cdFx0XHRcdGlmIChjZWxsRXZlbnRzLmNlbGxDbGljaykge1xuXG5cdFx0XHRcdFx0Y2VsbEV2ZW50cy5jZWxsQ2xpY2suY2FsbChzZWxmLnRhYmxlLCBlLCBjb21wb25lbnQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5jZWxsQ2xpY2spIHtcblxuXHRcdFx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5jZWxsQ2xpY2suY2FsbChzZWxmLnRhYmxlLCBlLCBjb21wb25lbnQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoY2VsbEV2ZW50cy5jZWxsRGJsQ2xpY2sgfHwgdGhpcy50YWJsZS5vcHRpb25zLmNlbGxEYmxDbGljaykge1xuXG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkYmxjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdHZhciBjb21wb25lbnQgPSBzZWxmLmdldENvbXBvbmVudCgpO1xuXG5cdFx0XHRcdGlmIChjZWxsRXZlbnRzLmNlbGxEYmxDbGljaykge1xuXG5cdFx0XHRcdFx0Y2VsbEV2ZW50cy5jZWxsRGJsQ2xpY2suY2FsbChzZWxmLnRhYmxlLCBlLCBjb21wb25lbnQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5jZWxsRGJsQ2xpY2spIHtcblxuXHRcdFx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5jZWxsRGJsQ2xpY2suY2FsbChzZWxmLnRhYmxlLCBlLCBjb21wb25lbnQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkYmxjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdGlmIChzZWxmLnRhYmxlLm1vZEV4aXN0cyhcImVkaXRcIikpIHtcblxuXHRcdFx0XHRcdGlmIChzZWxmLnRhYmxlLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbCA9PT0gc2VsZikge1xuXG5cdFx0XHRcdFx0XHRyZXR1cm47IC8vcHJldmVudCBpbnN0YW50IHNlbGVjdGlvbiBvZiBlZGl0b3IgY29udGVudFxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0aWYgKGRvY3VtZW50LnNlbGVjdGlvbikge1xuXHRcdFx0XHRcdFx0Ly8gSUVcblxuXHRcdFx0XHRcdFx0dmFyIHJhbmdlID0gZG9jdW1lbnQuYm9keS5jcmVhdGVUZXh0UmFuZ2UoKTtcblxuXHRcdFx0XHRcdFx0cmFuZ2UubW92ZVRvRWxlbWVudFRleHQoc2VsZi5lbGVtZW50KTtcblxuXHRcdFx0XHRcdFx0cmFuZ2Uuc2VsZWN0KCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKSB7XG5cblx0XHRcdFx0XHRcdHZhciByYW5nZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XG5cblx0XHRcdFx0XHRcdHJhbmdlLnNlbGVjdE5vZGUoc2VsZi5lbGVtZW50KTtcblxuXHRcdFx0XHRcdFx0d2luZG93LmdldFNlbGVjdGlvbigpLnJlbW92ZUFsbFJhbmdlcygpO1xuXG5cdFx0XHRcdFx0XHR3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuYWRkUmFuZ2UocmFuZ2UpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBjYXRjaCAoZSkge31cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGlmIChjZWxsRXZlbnRzLmNlbGxDb250ZXh0IHx8IHRoaXMudGFibGUub3B0aW9ucy5jZWxsQ29udGV4dCkge1xuXG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjb250ZXh0bWVudVwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdHZhciBjb21wb25lbnQgPSBzZWxmLmdldENvbXBvbmVudCgpO1xuXG5cdFx0XHRcdGlmIChjZWxsRXZlbnRzLmNlbGxDb250ZXh0KSB7XG5cblx0XHRcdFx0XHRjZWxsRXZlbnRzLmNlbGxDb250ZXh0LmNhbGwoc2VsZi50YWJsZSwgZSwgY29tcG9uZW50KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbENvbnRleHQpIHtcblxuXHRcdFx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5jZWxsQ29udGV4dC5jYWxsKHNlbGYudGFibGUsIGUsIGNvbXBvbmVudCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblx0fTtcblxuXHRDZWxsLnByb3RvdHlwZS5fYmluZE1vdXNlRXZlbnRzID0gZnVuY3Rpb24gKGNlbGxFdmVudHMpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgZWxlbWVudCA9IHNlbGYuZWxlbWVudDtcblxuXHRcdGlmIChjZWxsRXZlbnRzLmNlbGxNb3VzZUVudGVyIHx8IHNlbGYudGFibGUub3B0aW9ucy5jZWxsTW91c2VFbnRlcikge1xuXG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWVudGVyXCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0dmFyIGNvbXBvbmVudCA9IHNlbGYuZ2V0Q29tcG9uZW50KCk7XG5cblx0XHRcdFx0aWYgKGNlbGxFdmVudHMuY2VsbE1vdXNlRW50ZXIpIHtcblxuXHRcdFx0XHRcdGNlbGxFdmVudHMuY2VsbE1vdXNlRW50ZXIuY2FsbChzZWxmLnRhYmxlLCBlLCBjb21wb25lbnQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5jZWxsTW91c2VFbnRlcikge1xuXG5cdFx0XHRcdFx0c2VsZi50YWJsZS5vcHRpb25zLmNlbGxNb3VzZUVudGVyLmNhbGwoc2VsZi50YWJsZSwgZSwgY29tcG9uZW50KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKGNlbGxFdmVudHMuY2VsbE1vdXNlTGVhdmUgfHwgc2VsZi50YWJsZS5vcHRpb25zLmNlbGxNb3VzZUxlYXZlKSB7XG5cblx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHR2YXIgY29tcG9uZW50ID0gc2VsZi5nZXRDb21wb25lbnQoKTtcblxuXHRcdFx0XHRpZiAoY2VsbEV2ZW50cy5jZWxsTW91c2VMZWF2ZSkge1xuXG5cdFx0XHRcdFx0Y2VsbEV2ZW50cy5jZWxsTW91c2VMZWF2ZS5jYWxsKHNlbGYudGFibGUsIGUsIGNvbXBvbmVudCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLmNlbGxNb3VzZUxlYXZlKSB7XG5cblx0XHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbE1vdXNlTGVhdmUuY2FsbChzZWxmLnRhYmxlLCBlLCBjb21wb25lbnQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoY2VsbEV2ZW50cy5jZWxsTW91c2VPdmVyIHx8IHNlbGYudGFibGUub3B0aW9ucy5jZWxsTW91c2VPdmVyKSB7XG5cblx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdHZhciBjb21wb25lbnQgPSBzZWxmLmdldENvbXBvbmVudCgpO1xuXG5cdFx0XHRcdGlmIChjZWxsRXZlbnRzLmNlbGxNb3VzZU92ZXIpIHtcblxuXHRcdFx0XHRcdGNlbGxFdmVudHMuY2VsbE1vdXNlT3Zlci5jYWxsKHNlbGYudGFibGUsIGUsIGNvbXBvbmVudCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLmNlbGxNb3VzZU92ZXIpIHtcblxuXHRcdFx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5jZWxsTW91c2VPdmVyLmNhbGwoc2VsZi50YWJsZSwgZSwgY29tcG9uZW50KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKGNlbGxFdmVudHMuY2VsbE1vdXNlT3V0IHx8IHNlbGYudGFibGUub3B0aW9ucy5jZWxsTW91c2VPdXQpIHtcblxuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdXRcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHR2YXIgY29tcG9uZW50ID0gc2VsZi5nZXRDb21wb25lbnQoKTtcblxuXHRcdFx0XHRpZiAoY2VsbEV2ZW50cy5jZWxsTW91c2VPdXQpIHtcblxuXHRcdFx0XHRcdGNlbGxFdmVudHMuY2VsbE1vdXNlT3V0LmNhbGwoc2VsZi50YWJsZSwgZSwgY29tcG9uZW50KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbE1vdXNlT3V0KSB7XG5cblx0XHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbE1vdXNlT3V0LmNhbGwoc2VsZi50YWJsZSwgZSwgY29tcG9uZW50KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKGNlbGxFdmVudHMuY2VsbE1vdXNlTW92ZSB8fCBzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbE1vdXNlTW92ZSkge1xuXG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHR2YXIgY29tcG9uZW50ID0gc2VsZi5nZXRDb21wb25lbnQoKTtcblxuXHRcdFx0XHRpZiAoY2VsbEV2ZW50cy5jZWxsTW91c2VNb3ZlKSB7XG5cblx0XHRcdFx0XHRjZWxsRXZlbnRzLmNlbGxNb3VzZU1vdmUuY2FsbChzZWxmLnRhYmxlLCBlLCBjb21wb25lbnQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5jZWxsTW91c2VNb3ZlKSB7XG5cblx0XHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbE1vdXNlTW92ZS5jYWxsKHNlbGYudGFibGUsIGUsIGNvbXBvbmVudCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblx0fTtcblxuXHRDZWxsLnByb3RvdHlwZS5fYmluZFRvdWNoRXZlbnRzID0gZnVuY3Rpb24gKGNlbGxFdmVudHMpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgZWxlbWVudCA9IHNlbGYuZWxlbWVudCxcblx0XHQgICAgZGJsVGFwLFxuXHRcdCAgICB0YXBIb2xkLFxuXHRcdCAgICB0YXA7XG5cblx0XHRpZiAoY2VsbEV2ZW50cy5jZWxsVGFwIHx8IHRoaXMudGFibGUub3B0aW9ucy5jZWxsVGFwKSB7XG5cblx0XHRcdHRhcCA9IGZhbHNlO1xuXG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0dGFwID0gdHJ1ZTtcblx0XHRcdH0sIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcblxuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHRpZiAodGFwKSB7XG5cblx0XHRcdFx0XHR2YXIgY29tcG9uZW50ID0gc2VsZi5nZXRDb21wb25lbnQoKTtcblxuXHRcdFx0XHRcdGlmIChjZWxsRXZlbnRzLmNlbGxUYXApIHtcblxuXHRcdFx0XHRcdFx0Y2VsbEV2ZW50cy5jZWxsVGFwLmNhbGwoc2VsZi50YWJsZSwgZSwgY29tcG9uZW50KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLmNlbGxUYXApIHtcblxuXHRcdFx0XHRcdFx0c2VsZi50YWJsZS5vcHRpb25zLmNlbGxUYXAuY2FsbChzZWxmLnRhYmxlLCBlLCBjb21wb25lbnQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRhcCA9IGZhbHNlO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKGNlbGxFdmVudHMuY2VsbERibFRhcCB8fCB0aGlzLnRhYmxlLm9wdGlvbnMuY2VsbERibFRhcCkge1xuXG5cdFx0XHRkYmxUYXAgPSBudWxsO1xuXG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdGlmIChkYmxUYXApIHtcblxuXHRcdFx0XHRcdGNsZWFyVGltZW91dChkYmxUYXApO1xuXG5cdFx0XHRcdFx0ZGJsVGFwID0gbnVsbDtcblxuXHRcdFx0XHRcdHZhciBjb21wb25lbnQgPSBzZWxmLmdldENvbXBvbmVudCgpO1xuXG5cdFx0XHRcdFx0aWYgKGNlbGxFdmVudHMuY2VsbERibFRhcCkge1xuXG5cdFx0XHRcdFx0XHRjZWxsRXZlbnRzLmNlbGxEYmxUYXAuY2FsbChzZWxmLnRhYmxlLCBlLCBjb21wb25lbnQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbERibFRhcCkge1xuXG5cdFx0XHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbERibFRhcC5jYWxsKHNlbGYudGFibGUsIGUsIGNvbXBvbmVudCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0ZGJsVGFwID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHRcdGNsZWFyVGltZW91dChkYmxUYXApO1xuXG5cdFx0XHRcdFx0XHRkYmxUYXAgPSBudWxsO1xuXHRcdFx0XHRcdH0sIDMwMCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGlmIChjZWxsRXZlbnRzLmNlbGxUYXBIb2xkIHx8IHRoaXMudGFibGUub3B0aW9ucy5jZWxsVGFwSG9sZCkge1xuXG5cdFx0XHR0YXBIb2xkID0gbnVsbDtcblxuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdGNsZWFyVGltZW91dCh0YXBIb2xkKTtcblxuXHRcdFx0XHR0YXBIb2xkID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHRjbGVhclRpbWVvdXQodGFwSG9sZCk7XG5cblx0XHRcdFx0XHR0YXBIb2xkID0gbnVsbDtcblxuXHRcdFx0XHRcdHRhcCA9IGZhbHNlO1xuXG5cdFx0XHRcdFx0dmFyIGNvbXBvbmVudCA9IHNlbGYuZ2V0Q29tcG9uZW50KCk7XG5cblx0XHRcdFx0XHRpZiAoY2VsbEV2ZW50cy5jZWxsVGFwSG9sZCkge1xuXG5cdFx0XHRcdFx0XHRjZWxsRXZlbnRzLmNlbGxUYXBIb2xkLmNhbGwoc2VsZi50YWJsZSwgZSwgY29tcG9uZW50KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLmNlbGxUYXBIb2xkKSB7XG5cblx0XHRcdFx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5jZWxsVGFwSG9sZC5jYWxsKHNlbGYudGFibGUsIGUsIGNvbXBvbmVudCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9LCAxMDAwKTtcblx0XHRcdH0sIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcblxuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHRjbGVhclRpbWVvdXQodGFwSG9sZCk7XG5cblx0XHRcdFx0dGFwSG9sZCA9IG51bGw7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH07XG5cblx0Ly9nZW5lcmF0ZSBjZWxsIGNvbnRlbnRzXG5cblx0Q2VsbC5wcm90b3R5cGUuX2dlbmVyYXRlQ29udGVudHMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgdmFsO1xuXG5cdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwiZm9ybWF0XCIpKSB7XG5cblx0XHRcdHZhbCA9IHRoaXMudGFibGUubW9kdWxlcy5mb3JtYXQuZm9ybWF0VmFsdWUodGhpcyk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dmFsID0gdGhpcy5lbGVtZW50LmlubmVySFRNTCA9IHRoaXMudmFsdWU7XG5cdFx0fVxuXG5cdFx0c3dpdGNoICh0eXBlb2YgdmFsID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZih2YWwpKSB7XG5cblx0XHRcdGNhc2UgXCJvYmplY3RcIjpcblxuXHRcdFx0XHRpZiAodmFsIGluc3RhbmNlb2YgTm9kZSkge1xuXG5cdFx0XHRcdFx0Ly9jbGVhciBwcmV2aW91cyBjZWxsIGNvbnRlbnRzXG5cblx0XHRcdFx0XHR3aGlsZSAodGhpcy5lbGVtZW50LmZpcnN0Q2hpbGQpIHtcblx0XHRcdFx0XHRcdHRoaXMuZWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnQuZmlyc3RDaGlsZCk7XG5cdFx0XHRcdFx0fXRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZCh2YWwpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0dGhpcy5lbGVtZW50LmlubmVySFRNTCA9IFwiXCI7XG5cblx0XHRcdFx0XHRpZiAodmFsICE9IG51bGwpIHtcblxuXHRcdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiRm9ybWF0IEVycm9yIC0gRm9ybWF0dGVyIGhhcyByZXR1cm5lZCBhIHR5cGUgb2Ygb2JqZWN0LCB0aGUgb25seSB2YWxpZCBmb3JtYXR0ZXIgb2JqZWN0IHJldHVybiBpcyBhbiBpbnN0YW5jZSBvZiBOb2RlLCB0aGUgZm9ybWF0dGVyIHJldHVybmVkOlwiLCB2YWwpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwidW5kZWZpbmVkXCI6XG5cblx0XHRcdGNhc2UgXCJudWxsXCI6XG5cblx0XHRcdFx0dGhpcy5lbGVtZW50LmlubmVySFRNTCA9IFwiXCI7XG5cblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGRlZmF1bHQ6XG5cblx0XHRcdFx0dGhpcy5lbGVtZW50LmlubmVySFRNTCA9IHZhbDtcblxuXHRcdH1cblx0fTtcblxuXHRDZWxsLnByb3RvdHlwZS5jZWxsUmVuZGVyZWQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJmb3JtYXRcIikgJiYgdGhpcy50YWJsZS5tb2R1bGVzLmZvcm1hdC5jZWxsUmVuZGVyZWQpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmZvcm1hdC5jZWxsUmVuZGVyZWQodGhpcyk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vZ2VuZXJhdGUgdG9vbHRpcCB0ZXh0XG5cblx0Q2VsbC5wcm90b3R5cGUuX2dlbmVyYXRlVG9vbHRpcCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciB0b29sdGlwID0gdGhpcy5jb2x1bW4udG9vbHRpcDtcblxuXHRcdGlmICh0b29sdGlwKSB7XG5cblx0XHRcdGlmICh0b29sdGlwID09PSB0cnVlKSB7XG5cblx0XHRcdFx0dG9vbHRpcCA9IHRoaXMudmFsdWU7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZiB0b29sdGlwID09IFwiZnVuY3Rpb25cIikge1xuXG5cdFx0XHRcdHRvb2x0aXAgPSB0b29sdGlwKHRoaXMuZ2V0Q29tcG9uZW50KCkpO1xuXG5cdFx0XHRcdGlmICh0b29sdGlwID09PSBmYWxzZSkge1xuXG5cdFx0XHRcdFx0dG9vbHRpcCA9IFwiXCI7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZiB0b29sdGlwID09PSBcInVuZGVmaW5lZFwiKSB7XG5cblx0XHRcdFx0dG9vbHRpcCA9IFwiXCI7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCB0b29sdGlwKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHR0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKFwidGl0bGVcIiwgXCJcIik7XG5cdFx0fVxuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vIEdldHRlcnMgLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuXHRDZWxsLnByb3RvdHlwZS5nZXRFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuZWxlbWVudDtcblx0fTtcblxuXHRDZWxsLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLnZhbHVlO1xuXHR9O1xuXG5cdENlbGwucHJvdG90eXBlLmdldE9sZFZhbHVlID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMub2xkVmFsdWU7XG5cdH07XG5cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8gQWN0aW9ucyAvLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5cblx0Q2VsbC5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbiAodmFsdWUsIG11dGF0ZSkge1xuXG5cdFx0dmFyIGNoYW5nZWQgPSB0aGlzLnNldFZhbHVlUHJvY2Vzc0RhdGEodmFsdWUsIG11dGF0ZSksXG5cdFx0ICAgIGNvbXBvbmVudDtcblxuXHRcdGlmIChjaGFuZ2VkKSB7XG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuaGlzdG9yeSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImhpc3RvcnlcIikpIHtcblxuXHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuaGlzdG9yeS5hY3Rpb24oXCJjZWxsRWRpdFwiLCB0aGlzLCB7IG9sZFZhbHVlOiB0aGlzLm9sZFZhbHVlLCBuZXdWYWx1ZTogdGhpcy52YWx1ZSB9KTtcblx0XHRcdH1cblxuXHRcdFx0Y29tcG9uZW50ID0gdGhpcy5nZXRDb21wb25lbnQoKTtcblxuXHRcdFx0aWYgKHRoaXMuY29sdW1uLmNlbGxFdmVudHMuY2VsbEVkaXRlZCkge1xuXG5cdFx0XHRcdHRoaXMuY29sdW1uLmNlbGxFdmVudHMuY2VsbEVkaXRlZC5jYWxsKHRoaXMudGFibGUsIGNvbXBvbmVudCk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuY2VsbFJlbmRlcmVkKCk7XG5cblx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5jZWxsRWRpdGVkLmNhbGwodGhpcy50YWJsZSwgY29tcG9uZW50KTtcblxuXHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLmRhdGFFZGl0ZWQuY2FsbCh0aGlzLnRhYmxlLCB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0RGF0YSgpKTtcblx0XHR9XG5cdH07XG5cblx0Q2VsbC5wcm90b3R5cGUuc2V0VmFsdWVQcm9jZXNzRGF0YSA9IGZ1bmN0aW9uICh2YWx1ZSwgbXV0YXRlKSB7XG5cblx0XHR2YXIgY2hhbmdlZCA9IGZhbHNlO1xuXG5cdFx0aWYgKHRoaXMudmFsdWUgIT0gdmFsdWUpIHtcblxuXHRcdFx0Y2hhbmdlZCA9IHRydWU7XG5cblx0XHRcdGlmIChtdXRhdGUpIHtcblxuXHRcdFx0XHRpZiAodGhpcy5jb2x1bW4ubW9kdWxlcy5tdXRhdGUpIHtcblxuXHRcdFx0XHRcdHZhbHVlID0gdGhpcy50YWJsZS5tb2R1bGVzLm11dGF0b3IudHJhbnNmb3JtQ2VsbCh0aGlzLCB2YWx1ZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHR0aGlzLnNldFZhbHVlQWN0dWFsKHZhbHVlKTtcblxuXHRcdGlmIChjaGFuZ2VkICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiY29sdW1uQ2FsY3NcIikpIHtcblxuXHRcdFx0aWYgKHRoaXMuY29sdW1uLmRlZmluaXRpb24udG9wQ2FsYyB8fCB0aGlzLmNvbHVtbi5kZWZpbml0aW9uLmJvdHRvbUNhbGMpIHtcblxuXHRcdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmdyb3VwQnkgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJncm91cFJvd3NcIikpIHtcblxuXHRcdFx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1uQ2FsY3MgPT0gXCJ0YWJsZVwiIHx8IHRoaXMudGFibGUub3B0aW9ucy5jb2x1bW5DYWxjcyA9PSBcImJvdGhcIikge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MucmVjYWxjKHRoaXMudGFibGUucm93TWFuYWdlci5hY3RpdmVSb3dzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmNvbHVtbkNhbGNzICE9IFwidGFibGVcIikge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MucmVjYWxjUm93R3JvdXAodGhpcy5yb3cpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5yZWNhbGModGhpcy50YWJsZS5yb3dNYW5hZ2VyLmFjdGl2ZVJvd3MpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGNoYW5nZWQ7XG5cdH07XG5cblx0Q2VsbC5wcm90b3R5cGUuc2V0VmFsdWVBY3R1YWwgPSBmdW5jdGlvbiAodmFsdWUpIHtcblxuXHRcdHRoaXMub2xkVmFsdWUgPSB0aGlzLnZhbHVlO1xuXG5cdFx0dGhpcy52YWx1ZSA9IHZhbHVlO1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5yZWFjdGl2ZURhdGEgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJyZWFjdGl2ZURhdGFcIikpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnJlYWN0aXZlRGF0YS5ibG9jaygpO1xuXHRcdH1cblxuXHRcdHRoaXMuY29sdW1uLnNldEZpZWxkVmFsdWUodGhpcy5yb3cuZGF0YSwgdmFsdWUpO1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5yZWFjdGl2ZURhdGEgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJyZWFjdGl2ZURhdGFcIikpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnJlYWN0aXZlRGF0YS51bmJsb2NrKCk7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZ2VuZXJhdGVDb250ZW50cygpO1xuXG5cdFx0dGhpcy5fZ2VuZXJhdGVUb29sdGlwKCk7XG5cblx0XHQvL3NldCByZXNpemFibGUgaGFuZGxlc1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5yZXNpemFibGVDb2x1bW5zICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwicmVzaXplQ29sdW1uc1wiKSkge1xuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMucmVzaXplQ29sdW1ucy5pbml0aWFsaXplQ29sdW1uKFwiY2VsbFwiLCB0aGlzLmNvbHVtbiwgdGhpcy5lbGVtZW50KTtcblx0XHR9XG5cblx0XHQvL3NldCBjb2x1bW4gbWVudVxuXG5cdFx0aWYgKHRoaXMuY29sdW1uLmRlZmluaXRpb24uY29udGV4dE1lbnUgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJtZW51XCIpKSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5tZW51LmluaXRpYWxpemVDZWxsKHRoaXMpO1xuXHRcdH1cblxuXHRcdC8vaGFuZGxlIGZyb3plbiBjZWxsc1xuXG5cdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwiZnJvemVuQ29sdW1uc1wiKSkge1xuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZnJvemVuQ29sdW1ucy5sYXlvdXRFbGVtZW50KHRoaXMuZWxlbWVudCwgdGhpcy5jb2x1bW4pO1xuXHRcdH1cblx0fTtcblxuXHRDZWxsLnByb3RvdHlwZS5zZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMud2lkdGggPSB0aGlzLmNvbHVtbi53aWR0aDtcblxuXHRcdHRoaXMuZWxlbWVudC5zdHlsZS53aWR0aCA9IHRoaXMuY29sdW1uLndpZHRoU3R5bGVkO1xuXHR9O1xuXG5cdENlbGwucHJvdG90eXBlLmNsZWFyV2lkdGggPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLndpZHRoID0gXCJcIjtcblxuXHRcdHRoaXMuZWxlbWVudC5zdHlsZS53aWR0aCA9IFwiXCI7XG5cdH07XG5cblx0Q2VsbC5wcm90b3R5cGUuZ2V0V2lkdGggPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy53aWR0aCB8fCB0aGlzLmVsZW1lbnQub2Zmc2V0V2lkdGg7XG5cdH07XG5cblx0Q2VsbC5wcm90b3R5cGUuc2V0TWluV2lkdGggPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLm1pbldpZHRoID0gdGhpcy5jb2x1bW4ubWluV2lkdGg7XG5cblx0XHR0aGlzLmVsZW1lbnQuc3R5bGUubWluV2lkdGggPSB0aGlzLmNvbHVtbi5taW5XaWR0aFN0eWxlZDtcblx0fTtcblxuXHRDZWxsLnByb3RvdHlwZS5jaGVja0hlaWdodCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdC8vIHZhciBoZWlnaHQgPSB0aGlzLmVsZW1lbnQuY3NzKFwiaGVpZ2h0XCIpO1xuXG5cdFx0dGhpcy5yb3cucmVpbml0aWFsaXplSGVpZ2h0KCk7XG5cdH07XG5cblx0Q2VsbC5wcm90b3R5cGUuY2xlYXJIZWlnaHQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLmVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gXCJcIjtcblxuXHRcdHRoaXMuaGVpZ2h0ID0gbnVsbDtcblx0fTtcblxuXHRDZWxsLnByb3RvdHlwZS5zZXRIZWlnaHQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLmhlaWdodCA9IHRoaXMucm93LmhlaWdodDtcblxuXHRcdHRoaXMuZWxlbWVudC5zdHlsZS5oZWlnaHQgPSB0aGlzLnJvdy5oZWlnaHRTdHlsZWQ7XG5cdH07XG5cblx0Q2VsbC5wcm90b3R5cGUuZ2V0SGVpZ2h0ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuaGVpZ2h0IHx8IHRoaXMuZWxlbWVudC5vZmZzZXRIZWlnaHQ7XG5cdH07XG5cblx0Q2VsbC5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcblx0fTtcblxuXHRDZWxsLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5lbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblx0fTtcblxuXHRDZWxsLnByb3RvdHlwZS5lZGl0ID0gZnVuY3Rpb24gKGZvcmNlKSB7XG5cblx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJlZGl0XCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5lZGl0Q2VsbCh0aGlzLCBmb3JjZSk7XG5cdFx0fVxuXHR9O1xuXG5cdENlbGwucHJvdG90eXBlLmNhbmNlbEVkaXQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJlZGl0XCIsIHRydWUpKSB7XG5cblx0XHRcdHZhciBlZGl0aW5nID0gdGhpcy50YWJsZS5tb2R1bGVzLmVkaXQuZ2V0Q3VycmVudENlbGwoKTtcblxuXHRcdFx0aWYgKGVkaXRpbmcgJiYgZWRpdGluZy5fZ2V0U2VsZigpID09PSB0aGlzKSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmVkaXQuY2FuY2VsRWRpdCgpO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJDYW5jZWwgRWRpdG9yIEVycm9yIC0gVGhpcyBjZWxsIGlzIG5vdCBjdXJyZW50bHkgYmVpbmcgZWRpdGVkIFwiKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Q2VsbC5wcm90b3R5cGUudmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5jb2x1bW4ubW9kdWxlcy52YWxpZGF0ZSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInZhbGlkYXRlXCIsIHRydWUpKSB7XG5cblx0XHRcdHZhciB2YWxpZCA9IHRoaXMudGFibGUubW9kdWxlcy52YWxpZGF0ZS52YWxpZGF0ZSh0aGlzLmNvbHVtbi5tb2R1bGVzLnZhbGlkYXRlLCB0aGlzLCB0aGlzLmdldFZhbHVlKCkpO1xuXG5cdFx0XHRyZXR1cm4gdmFsaWQgPT09IHRydWU7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHR9O1xuXG5cdENlbGwucHJvdG90eXBlLmRlbGV0ZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICghdGhpcy50YWJsZS5yb3dNYW5hZ2VyLnJlZHJhd0Jsb2NrKSB7XG5cblx0XHRcdHRoaXMuZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudCk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMubW9kdWxlcy52YWxpZGF0ZSAmJiB0aGlzLm1vZHVsZXMudmFsaWRhdGUuaW52YWxpZCkge1xuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMudmFsaWRhdGUuY2xlYXJWYWxpZGF0aW9uKHRoaXMpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLm1vZHVsZXMuZWRpdCAmJiB0aGlzLm1vZHVsZXMuZWRpdC5lZGl0ZWQpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmVkaXQuY2xlYXJFZGl0ZWQodGhpcyk7XG5cdFx0fVxuXG5cdFx0dGhpcy5lbGVtZW50ID0gZmFsc2U7XG5cblx0XHR0aGlzLmNvbHVtbi5kZWxldGVDZWxsKHRoaXMpO1xuXG5cdFx0dGhpcy5yb3cuZGVsZXRlQ2VsbCh0aGlzKTtcblxuXHRcdHRoaXMuY2FsY3MgPSB7fTtcblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8vIE5hdmlnYXRpb24gLy8vLy8vLy8vLy8vLy8vLy9cblxuXG5cdENlbGwucHJvdG90eXBlLm5hdiA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgbmV4dENlbGwgPSBmYWxzZSxcblx0XHQgICAgaW5kZXggPSB0aGlzLnJvdy5nZXRDZWxsSW5kZXgodGhpcyk7XG5cblx0XHRyZXR1cm4ge1xuXG5cdFx0XHRuZXh0OiBmdW5jdGlvbiBuZXh0KCkge1xuXG5cdFx0XHRcdHZhciBuZXh0Q2VsbCA9IHRoaXMucmlnaHQoKSxcblx0XHRcdFx0ICAgIG5leHRSb3c7XG5cblx0XHRcdFx0aWYgKCFuZXh0Q2VsbCkge1xuXG5cdFx0XHRcdFx0bmV4dFJvdyA9IHNlbGYudGFibGUucm93TWFuYWdlci5uZXh0RGlzcGxheVJvdyhzZWxmLnJvdywgdHJ1ZSk7XG5cblx0XHRcdFx0XHRpZiAobmV4dFJvdykge1xuXG5cdFx0XHRcdFx0XHRuZXh0Q2VsbCA9IG5leHRSb3cuZmluZE5leHRFZGl0YWJsZUNlbGwoLTEpO1xuXG5cdFx0XHRcdFx0XHRpZiAobmV4dENlbGwpIHtcblxuXHRcdFx0XHRcdFx0XHRuZXh0Q2VsbC5lZGl0KCk7XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9LFxuXG5cdFx0XHRwcmV2OiBmdW5jdGlvbiBwcmV2KCkge1xuXG5cdFx0XHRcdHZhciBuZXh0Q2VsbCA9IHRoaXMubGVmdCgpLFxuXHRcdFx0XHQgICAgcHJldlJvdztcblxuXHRcdFx0XHRpZiAoIW5leHRDZWxsKSB7XG5cblx0XHRcdFx0XHRwcmV2Um93ID0gc2VsZi50YWJsZS5yb3dNYW5hZ2VyLnByZXZEaXNwbGF5Um93KHNlbGYucm93LCB0cnVlKTtcblxuXHRcdFx0XHRcdGlmIChwcmV2Um93KSB7XG5cblx0XHRcdFx0XHRcdG5leHRDZWxsID0gcHJldlJvdy5maW5kUHJldkVkaXRhYmxlQ2VsbChwcmV2Um93LmNlbGxzLmxlbmd0aCk7XG5cblx0XHRcdFx0XHRcdGlmIChuZXh0Q2VsbCkge1xuXG5cdFx0XHRcdFx0XHRcdG5leHRDZWxsLmVkaXQoKTtcblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH0sXG5cblx0XHRcdGxlZnQ6IGZ1bmN0aW9uIGxlZnQoKSB7XG5cblx0XHRcdFx0bmV4dENlbGwgPSBzZWxmLnJvdy5maW5kUHJldkVkaXRhYmxlQ2VsbChpbmRleCk7XG5cblx0XHRcdFx0aWYgKG5leHRDZWxsKSB7XG5cblx0XHRcdFx0XHRuZXh0Q2VsbC5lZGl0KCk7XG5cblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fSxcblxuXHRcdFx0cmlnaHQ6IGZ1bmN0aW9uIHJpZ2h0KCkge1xuXG5cdFx0XHRcdG5leHRDZWxsID0gc2VsZi5yb3cuZmluZE5leHRFZGl0YWJsZUNlbGwoaW5kZXgpO1xuXG5cdFx0XHRcdGlmIChuZXh0Q2VsbCkge1xuXG5cdFx0XHRcdFx0bmV4dENlbGwuZWRpdCgpO1xuXG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cblx0XHRcdHVwOiBmdW5jdGlvbiB1cCgpIHtcblxuXHRcdFx0XHR2YXIgbmV4dFJvdyA9IHNlbGYudGFibGUucm93TWFuYWdlci5wcmV2RGlzcGxheVJvdyhzZWxmLnJvdywgdHJ1ZSk7XG5cblx0XHRcdFx0aWYgKG5leHRSb3cpIHtcblxuXHRcdFx0XHRcdG5leHRSb3cuY2VsbHNbaW5kZXhdLmVkaXQoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSxcblxuXHRcdFx0ZG93bjogZnVuY3Rpb24gZG93bigpIHtcblxuXHRcdFx0XHR2YXIgbmV4dFJvdyA9IHNlbGYudGFibGUucm93TWFuYWdlci5uZXh0RGlzcGxheVJvdyhzZWxmLnJvdywgdHJ1ZSk7XG5cblx0XHRcdFx0aWYgKG5leHRSb3cpIHtcblxuXHRcdFx0XHRcdG5leHRSb3cuY2VsbHNbaW5kZXhdLmVkaXQoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0fTtcblx0fTtcblxuXHRDZWxsLnByb3RvdHlwZS5nZXRJbmRleCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMucm93LmdldENlbGxJbmRleCh0aGlzKTtcblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8vIE9iamVjdCBHZW5lcmF0aW9uIC8vLy8vLy8vLy8vLy8vLy8vXG5cblx0Q2VsbC5wcm90b3R5cGUuZ2V0Q29tcG9uZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKCF0aGlzLmNvbXBvbmVudCkge1xuXG5cdFx0XHR0aGlzLmNvbXBvbmVudCA9IG5ldyBDZWxsQ29tcG9uZW50KHRoaXMpO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzLmNvbXBvbmVudDtcblx0fTtcblxuXHR2YXIgRm9vdGVyTWFuYWdlciA9IGZ1bmN0aW9uIEZvb3Rlck1hbmFnZXIodGFibGUpIHtcblxuXHRcdHRoaXMudGFibGUgPSB0YWJsZTtcblxuXHRcdHRoaXMuYWN0aXZlID0gZmFsc2U7XG5cblx0XHR0aGlzLmVsZW1lbnQgPSB0aGlzLmNyZWF0ZUVsZW1lbnQoKTsgLy9jb250YWluaW5nIGVsZW1lbnRcblxuXHRcdHRoaXMuZXh0ZXJuYWwgPSBmYWxzZTtcblxuXHRcdHRoaXMubGlua3MgPSBbXTtcblxuXHRcdHRoaXMuX2luaXRpYWxpemUoKTtcblx0fTtcblxuXHRGb290ZXJNYW5hZ2VyLnByb3RvdHlwZS5jcmVhdGVFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZm9vdGVyXCIpO1xuXG5cdFx0cmV0dXJuIGVsO1xuXHR9O1xuXG5cdEZvb3Rlck1hbmFnZXIucHJvdG90eXBlLl9pbml0aWFsaXplID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuZm9vdGVyRWxlbWVudCkge1xuXG5cdFx0XHRzd2l0Y2ggKF90eXBlb2YodGhpcy50YWJsZS5vcHRpb25zLmZvb3RlckVsZW1lbnQpKSB7XG5cblx0XHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXG5cdFx0XHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5mb290ZXJFbGVtZW50WzBdID09PSBcIjxcIikge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVsZW1lbnQuaW5uZXJIVE1MID0gdGhpcy50YWJsZS5vcHRpb25zLmZvb3RlckVsZW1lbnQ7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5leHRlcm5hbCA9IHRydWU7XG5cblx0XHRcdFx0XHRcdHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy50YWJsZS5vcHRpb25zLmZvb3RlckVsZW1lbnQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGRlZmF1bHQ6XG5cblx0XHRcdFx0XHR0aGlzLmVsZW1lbnQgPSB0aGlzLnRhYmxlLm9wdGlvbnMuZm9vdGVyRWxlbWVudDtcblxuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdEZvb3Rlck1hbmFnZXIucHJvdG90eXBlLmdldEVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5lbGVtZW50O1xuXHR9O1xuXG5cdEZvb3Rlck1hbmFnZXIucHJvdG90eXBlLmFwcGVuZCA9IGZ1bmN0aW9uIChlbGVtZW50LCBwYXJlbnQpIHtcblxuXHRcdHRoaXMuYWN0aXZhdGUocGFyZW50KTtcblxuXHRcdHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZChlbGVtZW50KTtcblxuXHRcdHRoaXMudGFibGUucm93TWFuYWdlci5hZGp1c3RUYWJsZVNpemUoKTtcblx0fTtcblxuXHRGb290ZXJNYW5hZ2VyLnByb3RvdHlwZS5wcmVwZW5kID0gZnVuY3Rpb24gKGVsZW1lbnQsIHBhcmVudCkge1xuXG5cdFx0dGhpcy5hY3RpdmF0ZShwYXJlbnQpO1xuXG5cdFx0dGhpcy5lbGVtZW50Lmluc2VydEJlZm9yZShlbGVtZW50LCB0aGlzLmVsZW1lbnQuZmlyc3RDaGlsZCk7XG5cblx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWRqdXN0VGFibGVTaXplKCk7XG5cdH07XG5cblx0Rm9vdGVyTWFuYWdlci5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcblxuXHRcdGVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbGVtZW50KTtcblxuXHRcdHRoaXMuZGVhY3RpdmF0ZSgpO1xuXHR9O1xuXG5cdEZvb3Rlck1hbmFnZXIucHJvdG90eXBlLmRlYWN0aXZhdGUgPSBmdW5jdGlvbiAoZm9yY2UpIHtcblxuXHRcdGlmICghdGhpcy5lbGVtZW50LmZpcnN0Q2hpbGQgfHwgZm9yY2UpIHtcblxuXHRcdFx0aWYgKCF0aGlzLmV4dGVybmFsKSB7XG5cblx0XHRcdFx0dGhpcy5lbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5lbGVtZW50KTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5hY3RpdmUgPSBmYWxzZTtcblx0XHR9XG5cblx0XHQvLyB0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWRqdXN0VGFibGVTaXplKCk7XG5cdH07XG5cblx0Rm9vdGVyTWFuYWdlci5wcm90b3R5cGUuYWN0aXZhdGUgPSBmdW5jdGlvbiAocGFyZW50KSB7XG5cblx0XHRpZiAoIXRoaXMuYWN0aXZlKSB7XG5cblx0XHRcdHRoaXMuYWN0aXZlID0gdHJ1ZTtcblxuXHRcdFx0aWYgKCF0aGlzLmV4dGVybmFsKSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5lbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuZ2V0RWxlbWVudCgpKTtcblxuXHRcdFx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICcnO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChwYXJlbnQpIHtcblxuXHRcdFx0dGhpcy5saW5rcy5wdXNoKHBhcmVudCk7XG5cdFx0fVxuXHR9O1xuXG5cdEZvb3Rlck1hbmFnZXIucHJvdG90eXBlLnJlZHJhdyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMubGlua3MuZm9yRWFjaChmdW5jdGlvbiAobGluaykge1xuXG5cdFx0XHRsaW5rLmZvb3RlclJlZHJhdygpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdHZhciBUYWJ1bGF0b3IgPSBmdW5jdGlvbiBUYWJ1bGF0b3IoZWxlbWVudCwgb3B0aW9ucykge1xuXG5cdFx0dGhpcy5vcHRpb25zID0ge307XG5cblx0XHR0aGlzLmNvbHVtbk1hbmFnZXIgPSBudWxsOyAvLyBob2xkIENvbHVtbiBNYW5hZ2VyXG5cblx0XHR0aGlzLnJvd01hbmFnZXIgPSBudWxsOyAvL2hvbGQgUm93IE1hbmFnZXJcblxuXHRcdHRoaXMuZm9vdGVyTWFuYWdlciA9IG51bGw7IC8vaG9sZGVyIEZvb3RlciBNYW5hZ2VyXG5cblx0XHR0aGlzLmJyb3dzZXIgPSBcIlwiOyAvL2hvbGQgY3VycmVudCBicm93c2VyIHR5cGVcblxuXHRcdHRoaXMuYnJvd3NlclNsb3cgPSBmYWxzZTsgLy9oYW5kbGUgcmVkdWNlZCBmdW5jdGlvbmFsaXR5IGZvciBzbG93ZXIgYnJvd3NlcnNcblxuXHRcdHRoaXMuYnJvd3Nlck1vYmlsZSA9IGZhbHNlOyAvL2NoZWNrIGlmIHJ1bm5pbmcgb24gbW9ibGUsIHByZXZlbnQgcmVzaXplIGNhbmNlbGxpbmcgZWRpdCBvbiBrZXlib2FyZCBhcHBlYXJlbmNlXG5cblxuXHRcdHRoaXMubW9kdWxlcyA9IHt9OyAvL2hvbGQgYWxsIG1vZHVsZXMgYm91bmQgdG8gdGhpcyB0YWJsZVxuXG5cblx0XHR0aGlzLmluaXRpYWxpemVFbGVtZW50KGVsZW1lbnQpO1xuXG5cdFx0dGhpcy5pbml0aWFsaXplT3B0aW9ucyhvcHRpb25zIHx8IHt9KTtcblxuXHRcdHRoaXMuX2NyZWF0ZSgpO1xuXG5cdFx0VGFidWxhdG9yLnByb3RvdHlwZS5jb21tcy5yZWdpc3Rlcih0aGlzKTsgLy9yZWdpc3RlciB0YWJsZSBmb3IgaW5kZXJkZXZpY2UgY29tbXVuaWNhdGlvblxuXHR9O1xuXG5cdC8vZGVmYXVsdCBzZXR1cCBvcHRpb25zXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5kZWZhdWx0T3B0aW9ucyA9IHtcblxuXHRcdGhlaWdodDogZmFsc2UsIC8vaGVpZ2h0IG9mIHRhYnVsYXRvclxuXG5cdFx0bWluSGVpZ2h0OiBmYWxzZSwgLy9taW5pbXVtIGhlaWdodCBvZiB0YWJ1bGF0b3JcblxuXHRcdG1heEhlaWdodDogZmFsc2UsIC8vbWF4aW11bSBoZWlnaHQgb2YgdGFidWxhdG9yXG5cblxuXHRcdGxheW91dDogXCJmaXREYXRhXCIsIC8vL2xheW91dCB0eXBlIFwiZml0Q29sdW1uc1wiIHwgXCJmaXREYXRhXCJcblxuXHRcdGxheW91dENvbHVtbnNPbk5ld0RhdGE6IGZhbHNlLCAvL3VwZGF0ZSBjb2x1bW4gd2lkdGhzIG9uIHNldERhdGFcblxuXG5cdFx0Y29sdW1uTWluV2lkdGg6IDQwLCAvL21pbmltdW0gZ2xvYmFsIHdpZHRoIGZvciBhIGNvbHVtblxuXG5cdFx0Y29sdW1uSGVhZGVyVmVydEFsaWduOiBcInRvcFwiLCAvL3ZlcnRpY2FsIGFsaWdubWVudCBvZiBjb2x1bW4gaGVhZGVyc1xuXG5cdFx0Y29sdW1uVmVydEFsaWduOiBmYWxzZSwgLy8gREVQUkVDQVRFRCAtIExlZnQgdG8gYWxsb3cgd2FybmluZ1xuXG5cblx0XHRyZXNpemFibGVDb2x1bW5zOiB0cnVlLCAvL3Jlc2l6YWJsZSBjb2x1bW5zXG5cblx0XHRyZXNpemFibGVSb3dzOiBmYWxzZSwgLy9yZXNpemFibGUgcm93c1xuXG5cdFx0YXV0b1Jlc2l6ZTogdHJ1ZSwgLy9hdXRvIHJlc2l6ZSB0YWJsZVxuXG5cblx0XHRjb2x1bW5zOiBbXSwgLy9zdG9yZSBmb3IgY29sdW0gaGVhZGVyIGluZm9cblxuXG5cdFx0Y2VsbEhvekFsaWduOiBcIlwiLCAvL2hvcml6b250YWwgYWxpZ24gY29sdW1uc1xuXG5cdFx0Y2VsbFZlcnRBbGlnbjogXCJcIiwgLy9jZXJ0aWNhbCBhbGlnbiBjb2x1bW5zXG5cblxuXHRcdGRhdGE6IFtdLCAvL2RlZmF1bHQgc3RhcnRpbmcgZGF0YVxuXG5cblx0XHRhdXRvQ29sdW1uczogZmFsc2UsIC8vYnVpbGQgY29sdW1ucyBmcm9tIGRhdGEgcm93IHN0cnVjdHVyZVxuXG5cblx0XHRyZWFjdGl2ZURhdGE6IGZhbHNlLCAvL2VuYWJsZSBkYXRhIHJlYWN0aXZpdHlcblxuXG5cdFx0bmVzdGVkRmllbGRTZXBhcmF0b3I6IFwiLlwiLCAvL3NlcGVyYXRwciBmb3IgbmVzdGVkIGRhdGFcblxuXG5cdFx0dG9vbHRpcHM6IGZhbHNlLCAvL1Rvb2wgdGlwIHZhbHVlXG5cblx0XHR0b29sdGlwc0hlYWRlcjogZmFsc2UsIC8vVG9vbCB0aXAgZm9yIGhlYWRlcnNcblxuXHRcdHRvb2x0aXBHZW5lcmF0aW9uTW9kZTogXCJsb2FkXCIsIC8vd2hlbiB0byBnZW5lcmF0ZSB0b29sdGlwc1xuXG5cblx0XHRpbml0aWFsU29ydDogZmFsc2UsIC8vaW5pdGlhbCBzb3J0aW5nIGNyaXRlcmlhXG5cblx0XHRpbml0aWFsRmlsdGVyOiBmYWxzZSwgLy9pbml0aWFsIGZpbHRlcmluZyBjcml0ZXJpYVxuXG5cdFx0aW5pdGlhbEhlYWRlckZpbHRlcjogZmFsc2UsIC8vaW5pdGlhbCBoZWFkZXIgZmlsdGVyaW5nIGNyaXRlcmlhXG5cblxuXHRcdGNvbHVtbkhlYWRlclNvcnRNdWx0aTogdHJ1ZSwgLy9tdWx0aXBsZSBvciBzaW5nbGUgY29sdW1uIHNvcnRpbmdcblxuXG5cdFx0c29ydE9yZGVyUmV2ZXJzZTogZmFsc2UsIC8vcmV2ZXJzZSBpbnRlcm5hbCBzb3J0IG9yZGVyaW5nXG5cblxuXHRcdGhlYWRlclNvcnQ6IHRydWUsIC8vc2V0IGRlZmF1bHQgZ2xvYmFsIGhlYWRlciBzb3J0XG5cblx0XHRoZWFkZXJTb3J0VHJpc3RhdGU6IGZhbHNlLCAvL3NldCBkZWZhdWx0IHRyaXN0YXRlIGhlYWRlciBzb3J0aW5nXG5cblxuXHRcdGZvb3RlckVsZW1lbnQ6IGZhbHNlLCAvL2hvbGQgZm9vdGVyIGVsZW1lbnRcblxuXG5cdFx0aW5kZXg6IFwiaWRcIiwgLy9maWxlZCBmb3Igcm93IGluZGV4XG5cblxuXHRcdGtleWJpbmRpbmdzOiBbXSwgLy9hcnJheSBmb3Iga2V5YmluZGluZ3NcblxuXG5cdFx0dGFiRW5kTmV3Um93OiBmYWxzZSwgLy9jcmVhdGUgbmV3IHJvdyB3aGVuIHRhYiB0byBlbmQgb2YgdGFibGVcblxuXG5cdFx0aW52YWxpZE9wdGlvbldhcm5pbmdzOiB0cnVlLCAvL2FsbG93IHRvZ2dsaW5nIG9mIGludmFsaWQgb3B0aW9uIHdhcm5pbmdzXG5cblxuXHRcdGNsaXBib2FyZDogZmFsc2UsIC8vZW5hYmxlIGNsaXBib2FyZFxuXG5cdFx0Y2xpcGJvYXJkQ29weVN0eWxlZDogdHJ1ZSwgLy9mb3JtYXR0ZWQgdGFibGUgZGF0YVxuXG5cdFx0Y2xpcGJvYXJkQ29weUNvbmZpZzogZmFsc2UsIC8vY2xpcGJvYXJkIGNvbmZpZ1xuXG5cdFx0Y2xpcGJvYXJkQ29weUZvcm1hdHRlcjogZmFsc2UsIC8vREVQUklDQVRFRCAtIFJFTU9WRSBpbiA1LjBcblxuXHRcdGNsaXBib2FyZENvcHlSb3dSYW5nZTogXCJhY3RpdmVcIiwgLy9yZXN0cmljdCBjbGlwYm9hcmQgdG8gdmlzaWJsZSByb3dzIG9ubHlcblxuXHRcdGNsaXBib2FyZFBhc3RlUGFyc2VyOiBcInRhYmxlXCIsIC8vY29udmVydCBwYXN0ZWQgY2xpcGJvYXJkIGRhdGEgdG8gcm93c1xuXG5cdFx0Y2xpcGJvYXJkUGFzdGVBY3Rpb246IFwiaW5zZXJ0XCIsIC8vaG93IHRvIGluc2VydCBwYXN0ZWQgZGF0YSBpbnRvIHRoZSB0YWJsZVxuXG5cblx0XHRjbGlwYm9hcmRDb3BpZWQ6IGZ1bmN0aW9uIGNsaXBib2FyZENvcGllZCgpIHt9LCAvL2RhdGEgaGFzIGJlZW4gY29waWVkIHRvIHRoZSBjbGlwYm9hcmRcblxuXHRcdGNsaXBib2FyZFBhc3RlZDogZnVuY3Rpb24gY2xpcGJvYXJkUGFzdGVkKCkge30sIC8vZGF0YSBoYXMgYmVlbiBwYXN0ZWQgaW50byB0aGUgdGFibGVcblxuXHRcdGNsaXBib2FyZFBhc3RlRXJyb3I6IGZ1bmN0aW9uIGNsaXBib2FyZFBhc3RlRXJyb3IoKSB7fSwgLy9kYXRhIGhhcyBub3Qgc3VjY2Vzc2Z1bGx5IGJlZW4gcGFzdGVkIGludG8gdGhlIHRhYmxlXG5cblxuXHRcdGRvd25sb2FkRGF0YUZvcm1hdHRlcjogZmFsc2UsIC8vZnVuY3Rpb24gdG8gbWFuaXB1bGF0ZSB0YWJsZSBkYXRhIGJlZm9yZSBpdCBpcyBkb3dubG9hZGVkXG5cblx0XHRkb3dubG9hZFJlYWR5OiBmdW5jdGlvbiBkb3dubG9hZFJlYWR5KGRhdGEsIGJsb2IpIHtcblx0XHRcdHJldHVybiBibG9iO1xuXHRcdH0sIC8vZnVuY3Rpb24gdG8gbWFuaXB1bGF0ZSBkb3dubG9hZCBkYXRhXG5cblx0XHRkb3dubG9hZENvbXBsZXRlOiBmYWxzZSwgLy9mdW5jdGlvbiB0byBtYW5pcHVsYXRlIGRvd25sb2FkIGRhdGFcblxuXHRcdGRvd25sb2FkQ29uZmlnOiB7fSwgLy9kb3dubG9hZCBjb25maWdcblxuXHRcdGRvd25sb2FkUm93UmFuZ2U6IFwiYWN0aXZlXCIsIC8vcmVzdHJpY3QgZG93bmxvYWQgdG8gYWN0aXZlIHJvd3Mgb25seVxuXG5cblx0XHRkYXRhVHJlZTogZmFsc2UsIC8vZW5hYmxlIGRhdGEgdHJlZVxuXG5cdFx0ZGF0YVRyZWVFbGVtZW50Q29sdW1uOiBmYWxzZSxcblxuXHRcdGRhdGFUcmVlQnJhbmNoRWxlbWVudDogdHJ1ZSwgLy9zaG93IGRhdGEgdHJlZSBicmFuY2ggZWxlbWVudFxuXG5cdFx0ZGF0YVRyZWVDaGlsZEluZGVudDogOSwgLy9kYXRhIHRyZWUgY2hpbGQgaW5kZW50IGluIHB4XG5cblx0XHRkYXRhVHJlZUNoaWxkRmllbGQ6IFwiX2NoaWxkcmVuXCIsIC8vZGF0YSB0cmUgY29sdW1uIGZpZWxkIHRvIGxvb2sgZm9yIGNoaWxkIHJvd3NcblxuXHRcdGRhdGFUcmVlQ29sbGFwc2VFbGVtZW50OiBmYWxzZSwgLy9kYXRhIHRyZWUgcm93IGNvbGxhcHNlIGVsZW1lbnRcblxuXHRcdGRhdGFUcmVlRXhwYW5kRWxlbWVudDogZmFsc2UsIC8vZGF0YSB0cmVlIHJvdyBleHBhbmQgZWxlbWVudFxuXG5cdFx0ZGF0YVRyZWVTdGFydEV4cGFuZGVkOiBmYWxzZSxcblxuXHRcdGRhdGFUcmVlUm93RXhwYW5kZWQ6IGZ1bmN0aW9uIGRhdGFUcmVlUm93RXhwYW5kZWQoKSB7fSwgLy9yb3cgaGFzIGJlZW4gZXhwYW5kZWRcblxuXHRcdGRhdGFUcmVlUm93Q29sbGFwc2VkOiBmdW5jdGlvbiBkYXRhVHJlZVJvd0NvbGxhcHNlZCgpIHt9LCAvL3JvdyBoYXMgYmVlbiBjb2xsYXBzZWRcblxuXHRcdGRhdGFUcmVlQ2hpbGRDb2x1bW5DYWxjczogZmFsc2UsIC8vaW5jbHVkZSB2aXNpYmxlIGRhdGEgdHJlZSByb3dzIGluIGNvbHVtbiBjYWxjdWxhdGlvbnNcblxuXHRcdGRhdGFUcmVlU2VsZWN0UHJvcGFnYXRlOiBmYWxzZSwgLy9zZWxlY2N0aW5nIGEgcGFyZW50IHJvdyBzZWxlY3RzIGl0cyBjaGlsZHJlblxuXG5cblx0XHRwcmludEFzSHRtbDogZmFsc2UsIC8vZW5hYmxlIHByaW50IGFzIGh0bWxcblxuXHRcdHByaW50Rm9ybWF0dGVyOiBmYWxzZSwgLy9wcmludGluZyBwYWdlIGZvcm1hdHRlclxuXG5cdFx0cHJpbnRIZWFkZXI6IGZhbHNlLCAvL3BhZ2UgaGVhZGVyIGNvbnRlbnRzXG5cblx0XHRwcmludEZvb3RlcjogZmFsc2UsIC8vcGFnZSBmb290ZXIgY29udGVudHNcblxuXHRcdHByaW50Q29weVN0eWxlOiB0cnVlLCAvL0RFUFJJQ0FURUQgLSBSRU1PVkUgaW4gNS4wXG5cblx0XHRwcmludFN0eWxlZDogdHJ1ZSwgLy9lbmFibGUgcHJpbnQgYXMgaHRtbCBzdHlsaW5nXG5cblx0XHRwcmludFZpc2libGVSb3dzOiB0cnVlLCAvL0RFUFJJQ0FURUQgLSBSRU1PVkUgaW4gNS4wXG5cblx0XHRwcmludFJvd1JhbmdlOiBcInZpc2libGVcIiwgLy9yZXN0cmljdCBwcmludCB0byB2aXNpYmxlIHJvd3Mgb25seVxuXG5cdFx0cHJpbnRDb25maWc6IHt9LCAvL3ByaW50IGNvbmZpZyBvcHRpb25zXG5cblxuXHRcdGFkZFJvd1BvczogXCJib3R0b21cIiwgLy9wb3NpdGlvbiB0byBpbnNlcnQgYmxhbmsgcm93cywgdG9wfGJvdHRvbVxuXG5cblx0XHRzZWxlY3RhYmxlOiBcImhpZ2hsaWdodFwiLCAvL2hpZ2hsaWdodCByb3dzIG9uIGhvdmVyXG5cblx0XHRzZWxlY3RhYmxlUmFuZ2VNb2RlOiBcImRyYWdcIiwgLy9oaWdobGlnaHQgcm93cyBvbiBob3ZlclxuXG5cdFx0c2VsZWN0YWJsZVJvbGxpbmdTZWxlY3Rpb246IHRydWUsIC8vcm9sbCBzZWxlY3Rpb24gb25jZSBtYXhpbXVtIG51bWJlciBvZiBzZWxlY3RhYmxlIHJvd3MgaXMgcmVhY2hlZFxuXG5cdFx0c2VsZWN0YWJsZVBlcnNpc3RlbmNlOiB0cnVlLCAvLyBtYWludGFpbiBzZWxlY3Rpb24gd2hlbiB0YWJsZSB2aWV3IGlzIHVwZGF0ZWRcblxuXHRcdHNlbGVjdGFibGVDaGVjazogZnVuY3Rpb24gc2VsZWN0YWJsZUNoZWNrKGRhdGEsIHJvdykge1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fSwgLy9jaGVjayB3aGVhdGhlciByb3cgaXMgc2VsZWN0YWJsZVxuXG5cblx0XHRoZWFkZXJGaWx0ZXJMaXZlRmlsdGVyRGVsYXk6IDMwMCwgLy9kZWxheSBiZWZvcmUgdXBkYXRpbmcgY29sdW1uIGFmdGVyIHVzZXIgdHlwZXMgaW4gaGVhZGVyIGZpbHRlclxuXG5cdFx0aGVhZGVyRmlsdGVyUGxhY2Vob2xkZXI6IGZhbHNlLCAvL3BsYWNlaG9sZGVyIHRleHQgdG8gZGlzcGxheSBpbiBoZWFkZXIgZmlsdGVyc1xuXG5cblx0XHRoZWFkZXJWaXNpYmxlOiB0cnVlLCAvL2hpZGUgaGVhZGVyXG5cblxuXHRcdGhpc3Rvcnk6IGZhbHNlLCAvL2VuYWJsZSBlZGl0IGhpc3RvcnlcblxuXG5cdFx0bG9jYWxlOiBmYWxzZSwgLy9jdXJyZW50IHN5c3RlbSBsYW5ndWFnZVxuXG5cdFx0bGFuZ3M6IHt9LFxuXG5cdFx0dmlydHVhbERvbTogdHJ1ZSwgLy9lbmFibGUgRE9NIHZpcnR1YWxpemF0aW9uXG5cblx0XHR2aXJ0dWFsRG9tQnVmZmVyOiAwLCAvLyBzZXQgdmlydHVhbCBET00gYnVmZmVyIHNpemVcblxuXG5cdFx0cGVyc2lzdGVudExheW91dDogZmFsc2UsIC8vREVQUklDQVRFRCAtIFJFTU9WRSBpbiA1LjBcblxuXHRcdHBlcnNpc3RlbnRTb3J0OiBmYWxzZSwgLy9ERVBSSUNBVEVEIC0gUkVNT1ZFIGluIDUuMFxuXG5cdFx0cGVyc2lzdGVudEZpbHRlcjogZmFsc2UsIC8vREVQUklDQVRFRCAtIFJFTU9WRSBpbiA1LjBcblxuXHRcdHBlcnNpc3RlbmNlSUQ6IFwiXCIsIC8va2V5IGZvciBwZXJzaXN0ZW50IHN0b3JhZ2VcblxuXHRcdHBlcnNpc3RlbmNlTW9kZTogdHJ1ZSwgLy9tb2RlIGZvciBzdG9yaW5nIHBlcnNpc3RlbmNlIGluZm9ybWF0aW9uXG5cblx0XHRwZXJzaXN0ZW5jZVJlYWRlckZ1bmM6IGZhbHNlLCAvL2Z1bmN0aW9uIGZvciBoYW5kbGluZyBwZXJzaXN0ZW5jZSBkYXRhIHJlYWRpbmdcblxuXHRcdHBlcnNpc3RlbmNlV3JpdGVyRnVuYzogZmFsc2UsIC8vZnVuY3Rpb24gZm9yIGhhbmRsaW5nIHBlcnNpc3RlbmNlIGRhdGEgd3JpdGluZ1xuXG5cblx0XHRwZXJzaXN0ZW5jZTogZmFsc2UsXG5cblx0XHRyZXNwb25zaXZlTGF5b3V0OiBmYWxzZSwgLy9yZXNwb25zaXZlIGxheW91dCBmbGFnc1xuXG5cdFx0cmVzcG9uc2l2ZUxheW91dENvbGxhcHNlU3RhcnRPcGVuOiB0cnVlLCAvL3N0YXJ0IHNob3dpbmcgY29sbGFwc2VkIGRhdGFcblxuXHRcdHJlc3BvbnNpdmVMYXlvdXRDb2xsYXBzZVVzZUZvcm1hdHRlcnM6IHRydWUsIC8vcmVzcG9uc2l2ZSBsYXlvdXQgY29sbGFwc2UgZm9ybWF0dGVyXG5cblx0XHRyZXNwb25zaXZlTGF5b3V0Q29sbGFwc2VGb3JtYXR0ZXI6IGZhbHNlLCAvL3Jlc3BvbnNpdmUgbGF5b3V0IGNvbGxhcHNlIGZvcm1hdHRlclxuXG5cblx0XHRwYWdpbmF0aW9uOiBmYWxzZSwgLy9zZXQgcGFnaW5hdGlvbiB0eXBlXG5cblx0XHRwYWdpbmF0aW9uU2l6ZTogZmFsc2UsIC8vc2V0IG51bWJlciBvZiByb3dzIHRvIGEgcGFnZVxuXG5cdFx0cGFnaW5hdGlvbkluaXRpYWxQYWdlOiAxLCAvL2luaXRhaWwgcGFnZSB0byBzaG93IG9uIGxvYWRcblxuXHRcdHBhZ2luYXRpb25CdXR0b25Db3VudDogNSwgLy8gc2V0IGNvdW50IG9mIHBhZ2UgYnV0dG9uXG5cblx0XHRwYWdpbmF0aW9uU2l6ZVNlbGVjdG9yOiBmYWxzZSwgLy9hZGQgcGFnaW5hdGlvbiBzaXplIHNlbGVjdG9yIGVsZW1lbnRcblxuXHRcdHBhZ2luYXRpb25FbGVtZW50OiBmYWxzZSwgLy9lbGVtZW50IHRvIGhvbGQgcGFnaW5hdGlvbiBudW1iZXJzXG5cblx0XHRwYWdpbmF0aW9uRGF0YVNlbnQ6IHt9LCAvL3BhZ2luYXRpb24gZGF0YSBzZW50IHRvIHRoZSBzZXJ2ZXJcblxuXHRcdHBhZ2luYXRpb25EYXRhUmVjZWl2ZWQ6IHt9LCAvL3BhZ2luYXRpb24gZGF0YSByZWNlaXZlZCBmcm9tIHRoZSBzZXJ2ZXJcblxuXHRcdHBhZ2luYXRpb25BZGRSb3c6IFwicGFnZVwiLCAvL2FkZCByb3dzIG9uIHRhYmxlIG9yIHBhZ2VcblxuXG5cdFx0YWpheFVSTDogZmFsc2UsIC8vdXJsIGZvciBhamF4IGxvYWRpbmdcblxuXHRcdGFqYXhVUkxHZW5lcmF0b3I6IGZhbHNlLFxuXG5cdFx0YWpheFBhcmFtczoge30sIC8vcGFyYW1zIGZvciBhamF4IGxvYWRpbmdcblxuXHRcdGFqYXhDb25maWc6IFwiZ2V0XCIsIC8vYWpheCByZXF1ZXN0IHR5cGVcblxuXHRcdGFqYXhDb250ZW50VHlwZTogXCJmb3JtXCIsIC8vYWpheCByZXF1ZXN0IHR5cGVcblxuXHRcdGFqYXhSZXF1ZXN0RnVuYzogZmFsc2UsIC8vcHJvbWlzZSBmdW5jdGlvblxuXG5cdFx0YWpheExvYWRlcjogdHJ1ZSwgLy9zaG93IGxvYWRlclxuXG5cdFx0YWpheExvYWRlckxvYWRpbmc6IGZhbHNlLCAvL2xvYWRlciBlbGVtZW50XG5cblx0XHRhamF4TG9hZGVyRXJyb3I6IGZhbHNlLCAvL2xvYWRlciBlbGVtZW50XG5cblx0XHRhamF4RmlsdGVyaW5nOiBmYWxzZSxcblxuXHRcdGFqYXhTb3J0aW5nOiBmYWxzZSxcblxuXHRcdGFqYXhQcm9ncmVzc2l2ZUxvYWQ6IGZhbHNlLCAvL3Byb2dyZXNzaXZlIGxvYWRpbmdcblxuXHRcdGFqYXhQcm9ncmVzc2l2ZUxvYWREZWxheTogMCwgLy9kZWxheSBiZXR3ZWVuIHJlcXVlc3RzXG5cblx0XHRhamF4UHJvZ3Jlc3NpdmVMb2FkU2Nyb2xsTWFyZ2luOiAwLCAvL21hcmdpbiBiZWZvcmUgc2Nyb2xsIGJlZ2luc1xuXG5cblx0XHRncm91cEJ5OiBmYWxzZSwgLy9lbmFibGUgdGFibGUgZ3JvdXBpbmcgYW5kIHNldCBmaWVsZCB0byBncm91cCBieVxuXG5cdFx0Z3JvdXBTdGFydE9wZW46IHRydWUsIC8vc3RhcnRpbmcgc3RhdGUgb2YgZ3JvdXBcblxuXHRcdGdyb3VwVmFsdWVzOiBmYWxzZSxcblxuXHRcdGdyb3VwSGVhZGVyOiBmYWxzZSwgLy9oZWFkZXIgZ2VuZXJhdGlvbiBmdW5jdGlvblxuXG5cdFx0Z3JvdXBIZWFkZXJQcmludDogbnVsbCxcblxuXHRcdGdyb3VwSGVhZGVyQ2xpcGJvYXJkOiBudWxsLFxuXG5cdFx0Z3JvdXBIZWFkZXJIdG1sT3V0cHV0OiBudWxsLFxuXG5cdFx0Z3JvdXBIZWFkZXJEb3dubG9hZDogbnVsbCxcblxuXHRcdGh0bWxPdXRwdXRDb25maWc6IGZhbHNlLCAvL2h0bWwgb3V0eXB1IGNvbmZpZ1xuXG5cblx0XHRtb3ZhYmxlQ29sdW1uczogZmFsc2UsIC8vZW5hYmxlIG1vdmFibGUgY29sdW1uc1xuXG5cblx0XHRtb3ZhYmxlUm93czogZmFsc2UsIC8vZW5hYmxlIG1vdmFibGUgcm93c1xuXG5cdFx0bW92YWJsZVJvd3NDb25uZWN0ZWRUYWJsZXM6IGZhbHNlLCAvL3RhYmxlcyBmb3IgbW92YWJsZSByb3dzIHRvIGJlIGNvbm5lY3RlZCB0b1xuXG5cdFx0bW92YWJsZVJvd3NDb25uZWN0ZWRFbGVtZW50czogZmFsc2UsIC8vb3RoZXIgZWxlbWVudHMgZm9yIG1vdmFibGUgcm93cyB0byBiZSBjb25uZWN0ZWQgdG9cblxuXHRcdG1vdmFibGVSb3dzU2VuZGVyOiBmYWxzZSxcblxuXHRcdG1vdmFibGVSb3dzUmVjZWl2ZXI6IFwiaW5zZXJ0XCIsXG5cblx0XHRtb3ZhYmxlUm93c1NlbmRpbmdTdGFydDogZnVuY3Rpb24gbW92YWJsZVJvd3NTZW5kaW5nU3RhcnQoKSB7fSxcblxuXHRcdG1vdmFibGVSb3dzU2VudDogZnVuY3Rpb24gbW92YWJsZVJvd3NTZW50KCkge30sXG5cblx0XHRtb3ZhYmxlUm93c1NlbnRGYWlsZWQ6IGZ1bmN0aW9uIG1vdmFibGVSb3dzU2VudEZhaWxlZCgpIHt9LFxuXG5cdFx0bW92YWJsZVJvd3NTZW5kaW5nU3RvcDogZnVuY3Rpb24gbW92YWJsZVJvd3NTZW5kaW5nU3RvcCgpIHt9LFxuXG5cdFx0bW92YWJsZVJvd3NSZWNlaXZpbmdTdGFydDogZnVuY3Rpb24gbW92YWJsZVJvd3NSZWNlaXZpbmdTdGFydCgpIHt9LFxuXG5cdFx0bW92YWJsZVJvd3NSZWNlaXZlZDogZnVuY3Rpb24gbW92YWJsZVJvd3NSZWNlaXZlZCgpIHt9LFxuXG5cdFx0bW92YWJsZVJvd3NSZWNlaXZlZEZhaWxlZDogZnVuY3Rpb24gbW92YWJsZVJvd3NSZWNlaXZlZEZhaWxlZCgpIHt9LFxuXG5cdFx0bW92YWJsZVJvd3NSZWNlaXZpbmdTdG9wOiBmdW5jdGlvbiBtb3ZhYmxlUm93c1JlY2VpdmluZ1N0b3AoKSB7fSxcblxuXHRcdG1vdmFibGVSb3dzRWxlbWVudERyb3A6IGZ1bmN0aW9uIG1vdmFibGVSb3dzRWxlbWVudERyb3AoKSB7fSxcblxuXHRcdHNjcm9sbFRvUm93UG9zaXRpb246IFwidG9wXCIsXG5cblx0XHRzY3JvbGxUb1Jvd0lmVmlzaWJsZTogdHJ1ZSxcblxuXHRcdHNjcm9sbFRvQ29sdW1uUG9zaXRpb246IFwibGVmdFwiLFxuXG5cdFx0c2Nyb2xsVG9Db2x1bW5JZlZpc2libGU6IHRydWUsXG5cblx0XHRyb3dGb3JtYXR0ZXI6IGZhbHNlLFxuXG5cdFx0cm93Rm9ybWF0dGVyUHJpbnQ6IG51bGwsXG5cblx0XHRyb3dGb3JtYXR0ZXJDbGlwYm9hcmQ6IG51bGwsXG5cblx0XHRyb3dGb3JtYXR0ZXJIdG1sT3V0cHV0OiBudWxsLFxuXG5cdFx0cGxhY2Vob2xkZXI6IGZhbHNlLFxuXG5cdFx0Ly90YWJsZSBidWlsZGluZyBjYWxsYmFja3NcblxuXHRcdHRhYmxlQnVpbGRpbmc6IGZ1bmN0aW9uIHRhYmxlQnVpbGRpbmcoKSB7fSxcblxuXHRcdHRhYmxlQnVpbHQ6IGZ1bmN0aW9uIHRhYmxlQnVpbHQoKSB7fSxcblxuXHRcdC8vcmVuZGVyIGNhbGxiYWNrc1xuXG5cdFx0cmVuZGVyU3RhcnRlZDogZnVuY3Rpb24gcmVuZGVyU3RhcnRlZCgpIHt9LFxuXG5cdFx0cmVuZGVyQ29tcGxldGU6IGZ1bmN0aW9uIHJlbmRlckNvbXBsZXRlKCkge30sXG5cblx0XHQvL3JvdyBjYWxsYmFja3NcblxuXHRcdHJvd0NsaWNrOiBmYWxzZSxcblxuXHRcdHJvd0RibENsaWNrOiBmYWxzZSxcblxuXHRcdHJvd0NvbnRleHQ6IGZhbHNlLFxuXG5cdFx0cm93VGFwOiBmYWxzZSxcblxuXHRcdHJvd0RibFRhcDogZmFsc2UsXG5cblx0XHRyb3dUYXBIb2xkOiBmYWxzZSxcblxuXHRcdHJvd01vdXNlRW50ZXI6IGZhbHNlLFxuXG5cdFx0cm93TW91c2VMZWF2ZTogZmFsc2UsXG5cblx0XHRyb3dNb3VzZU92ZXI6IGZhbHNlLFxuXG5cdFx0cm93TW91c2VPdXQ6IGZhbHNlLFxuXG5cdFx0cm93TW91c2VNb3ZlOiBmYWxzZSxcblxuXHRcdHJvd0NvbnRleHRNZW51OiBmYWxzZSxcblxuXHRcdHJvd0FkZGVkOiBmdW5jdGlvbiByb3dBZGRlZCgpIHt9LFxuXG5cdFx0cm93RGVsZXRlZDogZnVuY3Rpb24gcm93RGVsZXRlZCgpIHt9LFxuXG5cdFx0cm93TW92ZWQ6IGZ1bmN0aW9uIHJvd01vdmVkKCkge30sXG5cblx0XHRyb3dVcGRhdGVkOiBmdW5jdGlvbiByb3dVcGRhdGVkKCkge30sXG5cblx0XHRyb3dTZWxlY3Rpb25DaGFuZ2VkOiBmdW5jdGlvbiByb3dTZWxlY3Rpb25DaGFuZ2VkKCkge30sXG5cblx0XHRyb3dTZWxlY3RlZDogZnVuY3Rpb24gcm93U2VsZWN0ZWQoKSB7fSxcblxuXHRcdHJvd0Rlc2VsZWN0ZWQ6IGZ1bmN0aW9uIHJvd0Rlc2VsZWN0ZWQoKSB7fSxcblxuXHRcdHJvd1Jlc2l6ZWQ6IGZ1bmN0aW9uIHJvd1Jlc2l6ZWQoKSB7fSxcblxuXHRcdC8vY2VsbCBjYWxsYmFja3NcblxuXHRcdC8vcm93IGNhbGxiYWNrc1xuXG5cdFx0Y2VsbENsaWNrOiBmYWxzZSxcblxuXHRcdGNlbGxEYmxDbGljazogZmFsc2UsXG5cblx0XHRjZWxsQ29udGV4dDogZmFsc2UsXG5cblx0XHRjZWxsVGFwOiBmYWxzZSxcblxuXHRcdGNlbGxEYmxUYXA6IGZhbHNlLFxuXG5cdFx0Y2VsbFRhcEhvbGQ6IGZhbHNlLFxuXG5cdFx0Y2VsbE1vdXNlRW50ZXI6IGZhbHNlLFxuXG5cdFx0Y2VsbE1vdXNlTGVhdmU6IGZhbHNlLFxuXG5cdFx0Y2VsbE1vdXNlT3ZlcjogZmFsc2UsXG5cblx0XHRjZWxsTW91c2VPdXQ6IGZhbHNlLFxuXG5cdFx0Y2VsbE1vdXNlTW92ZTogZmFsc2UsXG5cblx0XHRjZWxsRWRpdGluZzogZnVuY3Rpb24gY2VsbEVkaXRpbmcoKSB7fSxcblxuXHRcdGNlbGxFZGl0ZWQ6IGZ1bmN0aW9uIGNlbGxFZGl0ZWQoKSB7fSxcblxuXHRcdGNlbGxFZGl0Q2FuY2VsbGVkOiBmdW5jdGlvbiBjZWxsRWRpdENhbmNlbGxlZCgpIHt9LFxuXG5cdFx0Ly9jb2x1bW4gY2FsbGJhY2tzXG5cblx0XHRjb2x1bW5Nb3ZlZDogZmFsc2UsXG5cblx0XHRjb2x1bW5SZXNpemVkOiBmdW5jdGlvbiBjb2x1bW5SZXNpemVkKCkge30sXG5cblx0XHRjb2x1bW5UaXRsZUNoYW5nZWQ6IGZ1bmN0aW9uIGNvbHVtblRpdGxlQ2hhbmdlZCgpIHt9LFxuXG5cdFx0Y29sdW1uVmlzaWJpbGl0eUNoYW5nZWQ6IGZ1bmN0aW9uIGNvbHVtblZpc2liaWxpdHlDaGFuZ2VkKCkge30sXG5cblx0XHQvL0hUTUwgaXBvcnQgY2FsbGJhY2tzXG5cblx0XHRodG1sSW1wb3J0aW5nOiBmdW5jdGlvbiBodG1sSW1wb3J0aW5nKCkge30sXG5cblx0XHRodG1sSW1wb3J0ZWQ6IGZ1bmN0aW9uIGh0bWxJbXBvcnRlZCgpIHt9LFxuXG5cdFx0Ly9kYXRhIGNhbGxiYWNrc1xuXG5cdFx0ZGF0YUxvYWRpbmc6IGZ1bmN0aW9uIGRhdGFMb2FkaW5nKCkge30sXG5cblx0XHRkYXRhTG9hZGVkOiBmdW5jdGlvbiBkYXRhTG9hZGVkKCkge30sXG5cblx0XHRkYXRhRWRpdGVkOiBmdW5jdGlvbiBkYXRhRWRpdGVkKCkge30sXG5cblx0XHQvL2FqYXggY2FsbGJhY2tzXG5cblx0XHRhamF4UmVxdWVzdGluZzogZnVuY3Rpb24gYWpheFJlcXVlc3RpbmcoKSB7fSxcblxuXHRcdGFqYXhSZXNwb25zZTogZmFsc2UsXG5cblx0XHRhamF4RXJyb3I6IGZ1bmN0aW9uIGFqYXhFcnJvcigpIHt9LFxuXG5cdFx0Ly9maWx0ZXJpbmcgY2FsbGJhY2tzXG5cblx0XHRkYXRhRmlsdGVyaW5nOiBmYWxzZSxcblxuXHRcdGRhdGFGaWx0ZXJlZDogZmFsc2UsXG5cblx0XHQvL3NvcnRpbmcgY2FsbGJhY2tzXG5cblx0XHRkYXRhU29ydGluZzogZnVuY3Rpb24gZGF0YVNvcnRpbmcoKSB7fSxcblxuXHRcdGRhdGFTb3J0ZWQ6IGZ1bmN0aW9uIGRhdGFTb3J0ZWQoKSB7fSxcblxuXHRcdC8vZ3JvdXBpbmcgY2FsbGJhY2tzXG5cblx0XHRncm91cFRvZ2dsZUVsZW1lbnQ6IFwiYXJyb3dcIixcblxuXHRcdGdyb3VwQ2xvc2VkU2hvd0NhbGNzOiBmYWxzZSxcblxuXHRcdGRhdGFHcm91cGluZzogZnVuY3Rpb24gZGF0YUdyb3VwaW5nKCkge30sXG5cblx0XHRkYXRhR3JvdXBlZDogZmFsc2UsXG5cblx0XHRncm91cFZpc2liaWxpdHlDaGFuZ2VkOiBmdW5jdGlvbiBncm91cFZpc2liaWxpdHlDaGFuZ2VkKCkge30sXG5cblx0XHRncm91cENsaWNrOiBmYWxzZSxcblxuXHRcdGdyb3VwRGJsQ2xpY2s6IGZhbHNlLFxuXG5cdFx0Z3JvdXBDb250ZXh0OiBmYWxzZSxcblxuXHRcdGdyb3VwQ29udGV4dE1lbnU6IGZhbHNlLFxuXG5cdFx0Z3JvdXBUYXA6IGZhbHNlLFxuXG5cdFx0Z3JvdXBEYmxUYXA6IGZhbHNlLFxuXG5cdFx0Z3JvdXBUYXBIb2xkOiBmYWxzZSxcblxuXHRcdGNvbHVtbkNhbGNzOiB0cnVlLFxuXG5cdFx0Ly9wYWdpbmF0aW9uIGNhbGxiYWNrc1xuXG5cdFx0cGFnZUxvYWRlZDogZnVuY3Rpb24gcGFnZUxvYWRlZCgpIHt9LFxuXG5cdFx0Ly9sb2NhbGl6YXRpb24gY2FsbGJhY2tzXG5cblx0XHRsb2NhbGl6ZWQ6IGZ1bmN0aW9uIGxvY2FsaXplZCgpIHt9LFxuXG5cdFx0Ly92YWxpZGF0aW9uIGNhbGxiYWNrc1xuXG5cdFx0dmFsaWRhdGlvbk1vZGU6IFwiYmxvY2tpbmdcIixcblxuXHRcdHZhbGlkYXRpb25GYWlsZWQ6IGZ1bmN0aW9uIHZhbGlkYXRpb25GYWlsZWQoKSB7fSxcblxuXHRcdC8vaGlzdG9yeSBjYWxsYmFja3NcblxuXHRcdGhpc3RvcnlVbmRvOiBmdW5jdGlvbiBoaXN0b3J5VW5kbygpIHt9LFxuXG5cdFx0aGlzdG9yeVJlZG86IGZ1bmN0aW9uIGhpc3RvcnlSZWRvKCkge30sXG5cblx0XHQvL3Njcm9sbCBjYWxsYmFja3NcblxuXHRcdHNjcm9sbEhvcml6b250YWw6IGZ1bmN0aW9uIHNjcm9sbEhvcml6b250YWwoKSB7fSxcblxuXHRcdHNjcm9sbFZlcnRpY2FsOiBmdW5jdGlvbiBzY3JvbGxWZXJ0aWNhbCgpIHt9XG5cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmluaXRpYWxpemVPcHRpb25zID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcblxuXHRcdC8vd2FybiB1c2VyIGlmIG9wdGlvbiBpcyBub3QgYXZhaWxhYmxlXG5cblx0XHRpZiAob3B0aW9ucy5pbnZhbGlkT3B0aW9uV2FybmluZ3MgIT09IGZhbHNlKSB7XG5cblx0XHRcdGZvciAodmFyIGtleSBpbiBvcHRpb25zKSB7XG5cblx0XHRcdFx0aWYgKHR5cGVvZiB0aGlzLmRlZmF1bHRPcHRpb25zW2tleV0gPT09IFwidW5kZWZpbmVkXCIpIHtcblxuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkludmFsaWQgdGFibGUgY29uc3RydWN0b3Igb3B0aW9uOlwiLCBrZXkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly9hc3NpZ24gb3B0aW9ucyB0byB0YWJsZVxuXG5cdFx0Zm9yICh2YXIga2V5IGluIHRoaXMuZGVmYXVsdE9wdGlvbnMpIHtcblxuXHRcdFx0aWYgKGtleSBpbiBvcHRpb25zKSB7XG5cblx0XHRcdFx0dGhpcy5vcHRpb25zW2tleV0gPSBvcHRpb25zW2tleV07XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHRoaXMuZGVmYXVsdE9wdGlvbnNba2V5XSkpIHtcblxuXHRcdFx0XHRcdHRoaXMub3B0aW9uc1trZXldID0gW107XG5cdFx0XHRcdH0gZWxzZSBpZiAoX3R5cGVvZih0aGlzLmRlZmF1bHRPcHRpb25zW2tleV0pID09PSBcIm9iamVjdFwiICYmIHRoaXMuZGVmYXVsdE9wdGlvbnNba2V5XSAhPT0gbnVsbCkge1xuXG5cdFx0XHRcdFx0dGhpcy5vcHRpb25zW2tleV0gPSB7fTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdHRoaXMub3B0aW9uc1trZXldID0gdGhpcy5kZWZhdWx0T3B0aW9uc1trZXldO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuaW5pdGlhbGl6ZUVsZW1lbnQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuXG5cdFx0aWYgKHR5cGVvZiBIVE1MRWxlbWVudCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBlbGVtZW50IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHtcblxuXHRcdFx0dGhpcy5lbGVtZW50ID0gZWxlbWVudDtcblxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YgZWxlbWVudCA9PT0gXCJzdHJpbmdcIikge1xuXG5cdFx0XHR0aGlzLmVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGVsZW1lbnQpO1xuXG5cdFx0XHRpZiAodGhpcy5lbGVtZW50KSB7XG5cblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGNvbnNvbGUuZXJyb3IoXCJUYWJ1bGF0b3IgQ3JlYXRpb24gRXJyb3IgLSBubyBlbGVtZW50IGZvdW5kIG1hdGNoaW5nIHNlbGVjdG9yOiBcIiwgZWxlbWVudCk7XG5cblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGNvbnNvbGUuZXJyb3IoXCJUYWJ1bGF0b3IgQ3JlYXRpb24gRXJyb3IgLSBJbnZhbGlkIGVsZW1lbnQgcHJvdmlkZWQ6XCIsIGVsZW1lbnQpO1xuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdC8vY29udmVydCBkZXByaWNhdGVkIGZ1bmN0aW9uYWxpdHkgdG8gbmV3IGZ1bmN0aW9uc1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuX21hcERlcHJpY2F0ZWRGdW5jdGlvbmFsaXR5ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0Ly9tYXAgZGVwcmljYXRlZCBwZXJzaXN0YW5jZSBzZXR1cCBvcHRpb25zXG5cblx0XHRpZiAodGhpcy5vcHRpb25zLnBlcnNpc3RlbnRMYXlvdXQgfHwgdGhpcy5vcHRpb25zLnBlcnNpc3RlbnRTb3J0IHx8IHRoaXMub3B0aW9ucy5wZXJzaXN0ZW50RmlsdGVyKSB7XG5cblx0XHRcdGlmICghdGhpcy5vcHRpb25zLnBlcnNpc3RlbmNlKSB7XG5cblx0XHRcdFx0dGhpcy5vcHRpb25zLnBlcnNpc3RlbmNlID0ge307XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5kb3dubG9hZERhdGFGb3JtYXR0ZXIpIHtcblxuXHRcdFx0Y29uc29sZS53YXJuKFwiREVQUkVDQVRJT04gV0FSTklORyAtIGRvd25sb2FkRGF0YUZvcm1hdHRlciBvcHRpb24gaGFzIGJlZW4gZGVwcmVjYXRlZFwiKTtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIHRoaXMub3B0aW9ucy5jbGlwYm9hcmRDb3B5SGVhZGVyICE9PSBcInVuZGVmaW5lZFwiKSB7XG5cblx0XHRcdHRoaXMub3B0aW9ucy5jb2x1bW5IZWFkZXJzID0gdGhpcy5vcHRpb25zLmNsaXBib2FyZENvcHlIZWFkZXI7XG5cblx0XHRcdGNvbnNvbGUud2FybihcIkRFUFJFQ0FUSU9OIFdBUk5JTkcgLSBjbGlwYm9hcmRDb3B5SGVhZGVyIG9wdGlvbiBoYXMgYmVlbiBkZXByZWNhdGVkLCBwbGVhc2UgdXNlIHRoZSBjb2x1bW5IZWFkZXJzIHByb3BlcnR5IG9uIHRoZSBjbGlwYm9hcmRDb3B5Q29uZmlnIG9wdGlvblwiKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5vcHRpb25zLnByaW50VmlzaWJsZVJvd3MgIT09IHRydWUpIHtcblxuXHRcdFx0Y29uc29sZS53YXJuKFwicHJpbnRWaXNpYmxlUm93cyBvcHRpb24gaXMgZGVwcmVjYXRlZCwgeW91IHNob3VsZCBub3cgdXNlIHRoZSBwcmludFJvd1JhbmdlIG9wdGlvblwiKTtcblxuXHRcdFx0dGhpcy5vcHRpb25zLnBlcnNpc3RlbmNlLnByaW50Um93UmFuZ2UgPSBcImFjdGl2ZVwiO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLm9wdGlvbnMucHJpbnRDb3B5U3R5bGUgIT09IHRydWUpIHtcblxuXHRcdFx0Y29uc29sZS53YXJuKFwicHJpbnRDb3B5U3R5bGUgb3B0aW9uIGlzIGRlcHJlY2F0ZWQsIHlvdSBzaG91bGQgbm93IHVzZSB0aGUgcHJpbnRTdHlsZWQgb3B0aW9uXCIpO1xuXG5cdFx0XHR0aGlzLm9wdGlvbnMucGVyc2lzdGVuY2UucHJpbnRTdHlsZWQgPSB0aGlzLm9wdGlvbnMucHJpbnRDb3B5U3R5bGU7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5wZXJzaXN0ZW50TGF5b3V0KSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcInBlcnNpc3RlbnRMYXlvdXQgb3B0aW9uIGlzIGRlcHJlY2F0ZWQsIHlvdSBzaG91bGQgbm93IHVzZSB0aGUgcGVyc2lzdGVuY2Ugb3B0aW9uXCIpO1xuXG5cdFx0XHRpZiAodGhpcy5vcHRpb25zLnBlcnNpc3RlbmNlICE9PSB0cnVlICYmIHR5cGVvZiB0aGlzLm9wdGlvbnMucGVyc2lzdGVuY2UuY29sdW1ucyA9PT0gXCJ1bmRlZmluZWRcIikge1xuXG5cdFx0XHRcdHRoaXMub3B0aW9ucy5wZXJzaXN0ZW5jZS5jb2x1bW5zID0gdHJ1ZTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodGhpcy5vcHRpb25zLnBlcnNpc3RlbnRTb3J0KSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcInBlcnNpc3RlbnRTb3J0IG9wdGlvbiBpcyBkZXByZWNhdGVkLCB5b3Ugc2hvdWxkIG5vdyB1c2UgdGhlIHBlcnNpc3RlbmNlIG9wdGlvblwiKTtcblxuXHRcdFx0aWYgKHRoaXMub3B0aW9ucy5wZXJzaXN0ZW5jZSAhPT0gdHJ1ZSAmJiB0eXBlb2YgdGhpcy5vcHRpb25zLnBlcnNpc3RlbmNlLnNvcnQgPT09IFwidW5kZWZpbmVkXCIpIHtcblxuXHRcdFx0XHR0aGlzLm9wdGlvbnMucGVyc2lzdGVuY2Uuc29ydCA9IHRydWU7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5wZXJzaXN0ZW50RmlsdGVyKSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcInBlcnNpc3RlbnRGaWx0ZXIgb3B0aW9uIGlzIGRlcHJlY2F0ZWQsIHlvdSBzaG91bGQgbm93IHVzZSB0aGUgcGVyc2lzdGVuY2Ugb3B0aW9uXCIpO1xuXG5cdFx0XHRpZiAodGhpcy5vcHRpb25zLnBlcnNpc3RlbmNlICE9PSB0cnVlICYmIHR5cGVvZiB0aGlzLm9wdGlvbnMucGVyc2lzdGVuY2UuZmlsdGVyID09PSBcInVuZGVmaW5lZFwiKSB7XG5cblx0XHRcdFx0dGhpcy5vcHRpb25zLnBlcnNpc3RlbmNlLmZpbHRlciA9IHRydWU7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5jb2x1bW5WZXJ0QWxpZ24pIHtcblxuXHRcdFx0Y29uc29sZS53YXJuKFwiY29sdW1uVmVydEFsaWduIG9wdGlvbiBpcyBkZXByZWNhdGVkLCB5b3Ugc2hvdWxkIG5vdyB1c2UgdGhlIGNvbHVtbkhlYWRlclZlcnRBbGlnbiBvcHRpb25cIik7XG5cblx0XHRcdHRoaXMub3B0aW9ucy5jb2x1bW5IZWFkZXJWZXJ0QWxpZ24gPSB0aGlzLm9wdGlvbnMuY29sdW1uVmVydEFsaWduO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLl9jbGVhclNlbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWJsb2NrLXNlbGVjdFwiKTtcblxuXHRcdGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKSB7XG5cblx0XHRcdGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkpIHtcblx0XHRcdFx0Ly8gQ2hyb21lXG5cblx0XHRcdFx0d2luZG93LmdldFNlbGVjdGlvbigpLmVtcHR5KCk7XG5cdFx0XHR9IGVsc2UgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMpIHtcblx0XHRcdFx0Ly8gRmlyZWZveFxuXG5cdFx0XHRcdHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMoKTtcblx0XHRcdH1cblx0XHR9IGVsc2UgaWYgKGRvY3VtZW50LnNlbGVjdGlvbikge1xuXHRcdFx0Ly8gSUU/XG5cblx0XHRcdGRvY3VtZW50LnNlbGVjdGlvbi5lbXB0eSgpO1xuXHRcdH1cblxuXHRcdHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLWJsb2NrLXNlbGVjdFwiKTtcblx0fTtcblxuXHQvL2NvbmNyZWF0ZSB0YWJsZVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuX2NyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuX2NsZWFyT2JqZWN0UG9pbnRlcnMoKTtcblxuXHRcdHRoaXMuX21hcERlcHJpY2F0ZWRGdW5jdGlvbmFsaXR5KCk7XG5cblx0XHR0aGlzLmJpbmRNb2R1bGVzKCk7XG5cblx0XHRpZiAodGhpcy5lbGVtZW50LnRhZ05hbWUgPT09IFwiVEFCTEVcIikge1xuXG5cdFx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJodG1sVGFibGVJbXBvcnRcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0XHR0aGlzLm1vZHVsZXMuaHRtbFRhYmxlSW1wb3J0LnBhcnNlVGFibGUoKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHR0aGlzLmNvbHVtbk1hbmFnZXIgPSBuZXcgQ29sdW1uTWFuYWdlcih0aGlzKTtcblxuXHRcdHRoaXMucm93TWFuYWdlciA9IG5ldyBSb3dNYW5hZ2VyKHRoaXMpO1xuXG5cdFx0dGhpcy5mb290ZXJNYW5hZ2VyID0gbmV3IEZvb3Rlck1hbmFnZXIodGhpcyk7XG5cblx0XHR0aGlzLmNvbHVtbk1hbmFnZXIuc2V0Um93TWFuYWdlcih0aGlzLnJvd01hbmFnZXIpO1xuXG5cdFx0dGhpcy5yb3dNYW5hZ2VyLnNldENvbHVtbk1hbmFnZXIodGhpcy5jb2x1bW5NYW5hZ2VyKTtcblxuXHRcdHRoaXMuX2J1aWxkRWxlbWVudCgpO1xuXG5cdFx0dGhpcy5fbG9hZEluaXRpYWxEYXRhKCk7XG5cdH07XG5cblx0Ly9jbGVhciBwb2ludGVycyB0byBvYmplY3RzIGluIGRlZmF1bHQgY29uZmlnIG9iamVjdFxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuX2NsZWFyT2JqZWN0UG9pbnRlcnMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLm9wdGlvbnMuY29sdW1ucyA9IHRoaXMub3B0aW9ucy5jb2x1bW5zLnNsaWNlKDApO1xuXG5cdFx0aWYgKCF0aGlzLm9wdGlvbnMucmVhY3RpdmVEYXRhKSB7XG5cblx0XHRcdHRoaXMub3B0aW9ucy5kYXRhID0gdGhpcy5vcHRpb25zLmRhdGEuc2xpY2UoMCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vYnVpbGQgdGFidWxhdG9yIGVsZW1lbnRcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLl9idWlsZEVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIF90aGlzMTcgPSB0aGlzO1xuXG5cdFx0dmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsXG5cdFx0ICAgIG1vZCA9IHRoaXMubW9kdWxlcyxcblx0XHQgICAgb3B0aW9ucyA9IHRoaXMub3B0aW9ucztcblxuXHRcdG9wdGlvbnMudGFibGVCdWlsZGluZy5jYWxsKHRoaXMpO1xuXG5cdFx0ZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yXCIpO1xuXG5cdFx0ZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwiZ3JpZFwiKTtcblxuXHRcdC8vZW1wdHkgZWxlbWVudFxuXG5cdFx0d2hpbGUgKGVsZW1lbnQuZmlyc3RDaGlsZCkge1xuXHRcdFx0ZWxlbWVudC5yZW1vdmVDaGlsZChlbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHRcdH0gLy9zZXQgdGFibGUgaGVpZ2h0XG5cblx0XHRpZiAob3B0aW9ucy5oZWlnaHQpIHtcblxuXHRcdFx0b3B0aW9ucy5oZWlnaHQgPSBpc05hTihvcHRpb25zLmhlaWdodCkgPyBvcHRpb25zLmhlaWdodCA6IG9wdGlvbnMuaGVpZ2h0ICsgXCJweFwiO1xuXG5cdFx0XHRlbGVtZW50LnN0eWxlLmhlaWdodCA9IG9wdGlvbnMuaGVpZ2h0O1xuXHRcdH1cblxuXHRcdC8vc2V0IHRhYmxlIG1pbiBoZWlnaHRcblxuXHRcdGlmIChvcHRpb25zLm1pbkhlaWdodCAhPT0gZmFsc2UpIHtcblxuXHRcdFx0b3B0aW9ucy5taW5IZWlnaHQgPSBpc05hTihvcHRpb25zLm1pbkhlaWdodCkgPyBvcHRpb25zLm1pbkhlaWdodCA6IG9wdGlvbnMubWluSGVpZ2h0ICsgXCJweFwiO1xuXG5cdFx0XHRlbGVtZW50LnN0eWxlLm1pbkhlaWdodCA9IG9wdGlvbnMubWluSGVpZ2h0O1xuXHRcdH1cblxuXHRcdC8vc2V0IHRhYmxlIG1heEhlaWdodFxuXG5cdFx0aWYgKG9wdGlvbnMubWF4SGVpZ2h0ICE9PSBmYWxzZSkge1xuXG5cdFx0XHRvcHRpb25zLm1heEhlaWdodCA9IGlzTmFOKG9wdGlvbnMubWF4SGVpZ2h0KSA/IG9wdGlvbnMubWF4SGVpZ2h0IDogb3B0aW9ucy5tYXhIZWlnaHQgKyBcInB4XCI7XG5cblx0XHRcdGVsZW1lbnQuc3R5bGUubWF4SGVpZ2h0ID0gb3B0aW9ucy5tYXhIZWlnaHQ7XG5cdFx0fVxuXG5cdFx0dGhpcy5jb2x1bW5NYW5hZ2VyLmluaXRpYWxpemUoKTtcblxuXHRcdHRoaXMucm93TWFuYWdlci5pbml0aWFsaXplKCk7XG5cblx0XHR0aGlzLl9kZXRlY3RCcm93c2VyKCk7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJsYXlvdXRcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0bW9kLmxheW91dC5pbml0aWFsaXplKG9wdGlvbnMubGF5b3V0KTtcblx0XHR9XG5cblx0XHQvL3NldCBsb2NhbGl6YXRpb25cblxuXHRcdGlmIChvcHRpb25zLmhlYWRlckZpbHRlclBsYWNlaG9sZGVyICE9PSBmYWxzZSkge1xuXG5cdFx0XHRtb2QubG9jYWxpemUuc2V0SGVhZGVyRmlsdGVyUGxhY2Vob2xkZXIob3B0aW9ucy5oZWFkZXJGaWx0ZXJQbGFjZWhvbGRlcik7XG5cdFx0fVxuXG5cdFx0Zm9yICh2YXIgbG9jYWxlIGluIG9wdGlvbnMubGFuZ3MpIHtcblxuXHRcdFx0bW9kLmxvY2FsaXplLmluc3RhbGxMYW5nKGxvY2FsZSwgb3B0aW9ucy5sYW5nc1tsb2NhbGVdKTtcblx0XHR9XG5cblx0XHRtb2QubG9jYWxpemUuc2V0TG9jYWxlKG9wdGlvbnMubG9jYWxlKTtcblxuXHRcdC8vY29uZmlndXJlIHBsYWNlaG9sZGVyIGVsZW1lbnRcblxuXHRcdGlmICh0eXBlb2Ygb3B0aW9ucy5wbGFjZWhvbGRlciA9PSBcInN0cmluZ1wiKSB7XG5cblx0XHRcdHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cblx0XHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItcGxhY2Vob2xkZXJcIik7XG5cblx0XHRcdHZhciBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG5cblx0XHRcdHNwYW4uaW5uZXJIVE1MID0gb3B0aW9ucy5wbGFjZWhvbGRlcjtcblxuXHRcdFx0ZWwuYXBwZW5kQ2hpbGQoc3Bhbik7XG5cblx0XHRcdG9wdGlvbnMucGxhY2Vob2xkZXIgPSBlbDtcblx0XHR9XG5cblx0XHQvL2J1aWxkIHRhYmxlIGVsZW1lbnRzXG5cblx0XHRlbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuY29sdW1uTWFuYWdlci5nZXRFbGVtZW50KCkpO1xuXG5cdFx0ZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLnJvd01hbmFnZXIuZ2V0RWxlbWVudCgpKTtcblxuXHRcdGlmIChvcHRpb25zLmZvb3RlckVsZW1lbnQpIHtcblxuXHRcdFx0dGhpcy5mb290ZXJNYW5hZ2VyLmFjdGl2YXRlKCk7XG5cdFx0fVxuXG5cdFx0aWYgKG9wdGlvbnMucGVyc2lzdGVuY2UgJiYgdGhpcy5tb2RFeGlzdHMoXCJwZXJzaXN0ZW5jZVwiLCB0cnVlKSkge1xuXG5cdFx0XHRtb2QucGVyc2lzdGVuY2UuaW5pdGlhbGl6ZSgpO1xuXHRcdH1cblxuXHRcdGlmIChvcHRpb25zLnBlcnNpc3RlbmNlICYmIHRoaXMubW9kRXhpc3RzKFwicGVyc2lzdGVuY2VcIiwgdHJ1ZSkgJiYgbW9kLnBlcnNpc3RlbmNlLmNvbmZpZy5jb2x1bW5zKSB7XG5cblx0XHRcdG9wdGlvbnMuY29sdW1ucyA9IG1vZC5wZXJzaXN0ZW5jZS5sb2FkKFwiY29sdW1uc1wiLCBvcHRpb25zLmNvbHVtbnMpO1xuXHRcdH1cblxuXHRcdGlmIChvcHRpb25zLm1vdmFibGVSb3dzICYmIHRoaXMubW9kRXhpc3RzKFwibW92ZVJvd1wiKSkge1xuXG5cdFx0XHRtb2QubW92ZVJvdy5pbml0aWFsaXplKCk7XG5cdFx0fVxuXG5cdFx0aWYgKG9wdGlvbnMuYXV0b0NvbHVtbnMgJiYgdGhpcy5vcHRpb25zLmRhdGEpIHtcblxuXHRcdFx0dGhpcy5jb2x1bW5NYW5hZ2VyLmdlbmVyYXRlQ29sdW1uc0Zyb21Sb3dEYXRhKHRoaXMub3B0aW9ucy5kYXRhKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiKSkge1xuXG5cdFx0XHRtb2QuY29sdW1uQ2FsY3MuaW5pdGlhbGl6ZSgpO1xuXHRcdH1cblxuXHRcdHRoaXMuY29sdW1uTWFuYWdlci5zZXRDb2x1bW5zKG9wdGlvbnMuY29sdW1ucyk7XG5cblx0XHRpZiAob3B0aW9ucy5kYXRhVHJlZSAmJiB0aGlzLm1vZEV4aXN0cyhcImRhdGFUcmVlXCIsIHRydWUpKSB7XG5cblx0XHRcdG1vZC5kYXRhVHJlZS5pbml0aWFsaXplKCk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiZnJvemVuUm93c1wiKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuZnJvemVuUm93cy5pbml0aWFsaXplKCk7XG5cdFx0fVxuXG5cdFx0aWYgKChvcHRpb25zLnBlcnNpc3RlbmNlICYmIHRoaXMubW9kRXhpc3RzKFwicGVyc2lzdGVuY2VcIiwgdHJ1ZSkgJiYgbW9kLnBlcnNpc3RlbmNlLmNvbmZpZy5zb3J0IHx8IG9wdGlvbnMuaW5pdGlhbFNvcnQpICYmIHRoaXMubW9kRXhpc3RzKFwic29ydFwiLCB0cnVlKSkge1xuXG5cdFx0XHR2YXIgc29ydGVycyA9IFtdO1xuXG5cdFx0XHRpZiAob3B0aW9ucy5wZXJzaXN0ZW5jZSAmJiB0aGlzLm1vZEV4aXN0cyhcInBlcnNpc3RlbmNlXCIsIHRydWUpICYmIG1vZC5wZXJzaXN0ZW5jZS5jb25maWcuc29ydCkge1xuXG5cdFx0XHRcdHNvcnRlcnMgPSBtb2QucGVyc2lzdGVuY2UubG9hZChcInNvcnRcIik7XG5cblx0XHRcdFx0aWYgKHNvcnRlcnMgPT09IGZhbHNlICYmIG9wdGlvbnMuaW5pdGlhbFNvcnQpIHtcblxuXHRcdFx0XHRcdHNvcnRlcnMgPSBvcHRpb25zLmluaXRpYWxTb3J0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9wdGlvbnMuaW5pdGlhbFNvcnQpIHtcblxuXHRcdFx0XHRzb3J0ZXJzID0gb3B0aW9ucy5pbml0aWFsU29ydDtcblx0XHRcdH1cblxuXHRcdFx0bW9kLnNvcnQuc2V0U29ydChzb3J0ZXJzKTtcblx0XHR9XG5cblx0XHRpZiAoKG9wdGlvbnMucGVyc2lzdGVuY2UgJiYgdGhpcy5tb2RFeGlzdHMoXCJwZXJzaXN0ZW5jZVwiLCB0cnVlKSAmJiBtb2QucGVyc2lzdGVuY2UuY29uZmlnLmZpbHRlciB8fCBvcHRpb25zLmluaXRpYWxGaWx0ZXIpICYmIHRoaXMubW9kRXhpc3RzKFwiZmlsdGVyXCIsIHRydWUpKSB7XG5cblx0XHRcdHZhciBmaWx0ZXJzID0gW107XG5cblx0XHRcdGlmIChvcHRpb25zLnBlcnNpc3RlbmNlICYmIHRoaXMubW9kRXhpc3RzKFwicGVyc2lzdGVuY2VcIiwgdHJ1ZSkgJiYgbW9kLnBlcnNpc3RlbmNlLmNvbmZpZy5maWx0ZXIpIHtcblxuXHRcdFx0XHRmaWx0ZXJzID0gbW9kLnBlcnNpc3RlbmNlLmxvYWQoXCJmaWx0ZXJcIik7XG5cblx0XHRcdFx0aWYgKGZpbHRlcnMgPT09IGZhbHNlICYmIG9wdGlvbnMuaW5pdGlhbEZpbHRlcikge1xuXG5cdFx0XHRcdFx0ZmlsdGVycyA9IG9wdGlvbnMuaW5pdGlhbEZpbHRlcjtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvcHRpb25zLmluaXRpYWxGaWx0ZXIpIHtcblxuXHRcdFx0XHRmaWx0ZXJzID0gb3B0aW9ucy5pbml0aWFsRmlsdGVyO1xuXHRcdFx0fVxuXG5cdFx0XHRtb2QuZmlsdGVyLnNldEZpbHRlcihmaWx0ZXJzKTtcblx0XHR9XG5cblx0XHRpZiAob3B0aW9ucy5pbml0aWFsSGVhZGVyRmlsdGVyICYmIHRoaXMubW9kRXhpc3RzKFwiZmlsdGVyXCIsIHRydWUpKSB7XG5cblx0XHRcdG9wdGlvbnMuaW5pdGlhbEhlYWRlckZpbHRlci5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cblx0XHRcdFx0dmFyIGNvbHVtbiA9IF90aGlzMTcuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uKGl0ZW0uZmllbGQpO1xuXG5cdFx0XHRcdGlmIChjb2x1bW4pIHtcblxuXHRcdFx0XHRcdG1vZC5maWx0ZXIuc2V0SGVhZGVyRmlsdGVyVmFsdWUoY29sdW1uLCBpdGVtLnZhbHVlKTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkNvbHVtbiBGaWx0ZXIgRXJyb3IgLSBObyBtYXRjaGluZyBjb2x1bW4gZm91bmQ6XCIsIGl0ZW0uZmllbGQpO1xuXG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJhamF4XCIpKSB7XG5cblx0XHRcdG1vZC5hamF4LmluaXRpYWxpemUoKTtcblx0XHR9XG5cblx0XHRpZiAob3B0aW9ucy5wYWdpbmF0aW9uICYmIHRoaXMubW9kRXhpc3RzKFwicGFnZVwiLCB0cnVlKSkge1xuXG5cdFx0XHRtb2QucGFnZS5pbml0aWFsaXplKCk7XG5cdFx0fVxuXG5cdFx0aWYgKG9wdGlvbnMuZ3JvdXBCeSAmJiB0aGlzLm1vZEV4aXN0cyhcImdyb3VwUm93c1wiLCB0cnVlKSkge1xuXG5cdFx0XHRtb2QuZ3JvdXBSb3dzLmluaXRpYWxpemUoKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJrZXliaW5kaW5nc1wiKSkge1xuXG5cdFx0XHRtb2Qua2V5YmluZGluZ3MuaW5pdGlhbGl6ZSgpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcInNlbGVjdFJvd1wiKSkge1xuXG5cdFx0XHRtb2Quc2VsZWN0Um93LmNsZWFyU2VsZWN0aW9uRGF0YSh0cnVlKTtcblx0XHR9XG5cblx0XHRpZiAob3B0aW9ucy5hdXRvUmVzaXplICYmIHRoaXMubW9kRXhpc3RzKFwicmVzaXplVGFibGVcIikpIHtcblxuXHRcdFx0bW9kLnJlc2l6ZVRhYmxlLmluaXRpYWxpemUoKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJjbGlwYm9hcmRcIikpIHtcblxuXHRcdFx0bW9kLmNsaXBib2FyZC5pbml0aWFsaXplKCk7XG5cdFx0fVxuXG5cdFx0aWYgKG9wdGlvbnMucHJpbnRBc0h0bWwgJiYgdGhpcy5tb2RFeGlzdHMoXCJwcmludFwiKSkge1xuXG5cdFx0XHRtb2QucHJpbnQuaW5pdGlhbGl6ZSgpO1xuXHRcdH1cblxuXHRcdG9wdGlvbnMudGFibGVCdWlsdC5jYWxsKHRoaXMpO1xuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuX2xvYWRJbml0aWFsRGF0YSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdGlmIChzZWxmLm9wdGlvbnMucGFnaW5hdGlvbiAmJiBzZWxmLm1vZEV4aXN0cyhcInBhZ2VcIikpIHtcblxuXHRcdFx0c2VsZi5tb2R1bGVzLnBhZ2UucmVzZXQodHJ1ZSwgdHJ1ZSk7XG5cblx0XHRcdGlmIChzZWxmLm9wdGlvbnMucGFnaW5hdGlvbiA9PSBcImxvY2FsXCIpIHtcblxuXHRcdFx0XHRpZiAoc2VsZi5vcHRpb25zLmRhdGEubGVuZ3RoKSB7XG5cblx0XHRcdFx0XHRzZWxmLnJvd01hbmFnZXIuc2V0RGF0YShzZWxmLm9wdGlvbnMuZGF0YSwgZmFsc2UsIHRydWUpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0aWYgKChzZWxmLm9wdGlvbnMuYWpheFVSTCB8fCBzZWxmLm9wdGlvbnMuYWpheFVSTEdlbmVyYXRvcikgJiYgc2VsZi5tb2RFeGlzdHMoXCJhamF4XCIpKSB7XG5cblx0XHRcdFx0XHRcdHNlbGYubW9kdWxlcy5hamF4LmxvYWREYXRhKGZhbHNlLCB0cnVlKS50aGVuKGZ1bmN0aW9uICgpIHt9KS5jYXRjaChmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHRcdFx0aWYgKHNlbGYub3B0aW9ucy5wYWdpbmF0aW9uSW5pdGlhbFBhZ2UpIHtcblxuXHRcdFx0XHRcdFx0XHRcdHNlbGYubW9kdWxlcy5wYWdlLnNldFBhZ2Uoc2VsZi5vcHRpb25zLnBhZ2luYXRpb25Jbml0aWFsUGFnZSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0c2VsZi5yb3dNYW5hZ2VyLnNldERhdGEoc2VsZi5vcHRpb25zLmRhdGEsIGZhbHNlLCB0cnVlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc2VsZi5vcHRpb25zLnBhZ2luYXRpb25Jbml0aWFsUGFnZSkge1xuXG5cdFx0XHRcdFx0c2VsZi5tb2R1bGVzLnBhZ2Uuc2V0UGFnZShzZWxmLm9wdGlvbnMucGFnaW5hdGlvbkluaXRpYWxQYWdlKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRpZiAoc2VsZi5vcHRpb25zLmFqYXhVUkwpIHtcblxuXHRcdFx0XHRcdHNlbGYubW9kdWxlcy5wYWdlLnNldFBhZ2Uoc2VsZi5vcHRpb25zLnBhZ2luYXRpb25Jbml0aWFsUGFnZSkudGhlbihmdW5jdGlvbiAoKSB7fSkuY2F0Y2goZnVuY3Rpb24gKCkge30pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0c2VsZi5yb3dNYW5hZ2VyLnNldERhdGEoW10sIGZhbHNlLCB0cnVlKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChzZWxmLm9wdGlvbnMuZGF0YS5sZW5ndGgpIHtcblxuXHRcdFx0XHRzZWxmLnJvd01hbmFnZXIuc2V0RGF0YShzZWxmLm9wdGlvbnMuZGF0YSk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGlmICgoc2VsZi5vcHRpb25zLmFqYXhVUkwgfHwgc2VsZi5vcHRpb25zLmFqYXhVUkxHZW5lcmF0b3IpICYmIHNlbGYubW9kRXhpc3RzKFwiYWpheFwiKSkge1xuXG5cdFx0XHRcdFx0c2VsZi5tb2R1bGVzLmFqYXgubG9hZERhdGEoZmFsc2UsIHRydWUpLnRoZW4oZnVuY3Rpb24gKCkge30pLmNhdGNoKGZ1bmN0aW9uICgpIHt9KTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdHNlbGYucm93TWFuYWdlci5zZXREYXRhKHNlbGYub3B0aW9ucy5kYXRhLCBmYWxzZSwgdHJ1ZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Ly9kZWNvbnN0cnVjdG9yXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cblx0XHRUYWJ1bGF0b3IucHJvdG90eXBlLmNvbW1zLmRlcmVnaXN0ZXIodGhpcyk7IC8vZGVyZWdpc3RlciB0YWJsZSBmcm9tIGluZGVyZGV2aWNlIGNvbW11bmljYXRpb25cblxuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5yZWFjdGl2ZURhdGEgJiYgdGhpcy5tb2RFeGlzdHMoXCJyZWFjdGl2ZURhdGFcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0dGhpcy5tb2R1bGVzLnJlYWN0aXZlRGF0YS51bndhdGNoRGF0YSgpO1xuXHRcdH1cblxuXHRcdC8vY2xlYXIgcm93IGRhdGFcblxuXHRcdHRoaXMucm93TWFuYWdlci5yb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXG5cdFx0XHRyb3cud2lwZSgpO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5yb3dNYW5hZ2VyLnJvd3MgPSBbXTtcblxuXHRcdHRoaXMucm93TWFuYWdlci5hY3RpdmVSb3dzID0gW107XG5cblx0XHR0aGlzLnJvd01hbmFnZXIuZGlzcGxheVJvd3MgPSBbXTtcblxuXHRcdC8vY2xlYXIgZXZlbnQgYmluZGluZ3NcblxuXHRcdGlmICh0aGlzLm9wdGlvbnMuYXV0b1Jlc2l6ZSAmJiB0aGlzLm1vZEV4aXN0cyhcInJlc2l6ZVRhYmxlXCIpKSB7XG5cblx0XHRcdHRoaXMubW9kdWxlcy5yZXNpemVUYWJsZS5jbGVhckJpbmRpbmdzKCk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwia2V5YmluZGluZ3NcIikpIHtcblxuXHRcdFx0dGhpcy5tb2R1bGVzLmtleWJpbmRpbmdzLmNsZWFyQmluZGluZ3MoKTtcblx0XHR9XG5cblx0XHQvL2NsZWFyIERPTVxuXG5cdFx0d2hpbGUgKGVsZW1lbnQuZmlyc3RDaGlsZCkge1xuXHRcdFx0ZWxlbWVudC5yZW1vdmVDaGlsZChlbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHRcdH1lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3JcIik7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5fZGV0ZWN0QnJvd3NlciA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciB1YSA9IG5hdmlnYXRvci51c2VyQWdlbnQgfHwgbmF2aWdhdG9yLnZlbmRvciB8fCB3aW5kb3cub3BlcmE7XG5cblx0XHRpZiAodWEuaW5kZXhPZihcIlRyaWRlbnRcIikgPiAtMSkge1xuXG5cdFx0XHR0aGlzLmJyb3dzZXIgPSBcImllXCI7XG5cblx0XHRcdHRoaXMuYnJvd3NlclNsb3cgPSB0cnVlO1xuXHRcdH0gZWxzZSBpZiAodWEuaW5kZXhPZihcIkVkZ2VcIikgPiAtMSkge1xuXG5cdFx0XHR0aGlzLmJyb3dzZXIgPSBcImVkZ2VcIjtcblxuXHRcdFx0dGhpcy5icm93c2VyU2xvdyA9IHRydWU7XG5cdFx0fSBlbHNlIGlmICh1YS5pbmRleE9mKFwiRmlyZWZveFwiKSA+IC0xKSB7XG5cblx0XHRcdHRoaXMuYnJvd3NlciA9IFwiZmlyZWZveFwiO1xuXG5cdFx0XHR0aGlzLmJyb3dzZXJTbG93ID0gZmFsc2U7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dGhpcy5icm93c2VyID0gXCJvdGhlclwiO1xuXG5cdFx0XHR0aGlzLmJyb3dzZXJTbG93ID0gZmFsc2U7XG5cdFx0fVxuXG5cdFx0dGhpcy5icm93c2VyTW9iaWxlID0gLyhhbmRyb2lkfGJiXFxkK3xtZWVnbykuK21vYmlsZXxhdmFudGdvfGJhZGFcXC98YmxhY2tiZXJyeXxibGF6ZXJ8Y29tcGFsfGVsYWluZXxmZW5uZWN8aGlwdG9wfGllbW9iaWxlfGlwKGhvbmV8b2QpfGlyaXN8a2luZGxlfGxnZSB8bWFlbW98bWlkcHxtbXB8bW9iaWxlLitmaXJlZm94fG5ldGZyb250fG9wZXJhIG0ob2J8aW4paXxwYWxtKCBvcyk/fHBob25lfHAoaXhpfHJlKVxcL3xwbHVja2VyfHBvY2tldHxwc3B8c2VyaWVzKDR8NikwfHN5bWJpYW58dHJlb3x1cFxcLihicm93c2VyfGxpbmspfHZvZGFmb25lfHdhcHx3aW5kb3dzIGNlfHhkYXx4aWlub3xhbmRyb2lkfGlwYWR8cGxheWJvb2t8c2lsay9pLnRlc3QodWEpIHx8IC8xMjA3fDYzMTB8NjU5MHwzZ3NvfDR0aHB8NTBbMS02XWl8Nzcwc3w4MDJzfGEgd2F8YWJhY3xhYyhlcnxvb3xzXFwtKXxhaShrb3xybil8YWwoYXZ8Y2F8Y28pfGFtb2l8YW4oZXh8bnl8eXcpfGFwdHV8YXIoY2h8Z28pfGFzKHRlfHVzKXxhdHR3fGF1KGRpfFxcLW18ciB8cyApfGF2YW58YmUoY2t8bGx8bnEpfGJpKGxifHJkKXxibChhY3xheil8YnIoZXx2KXd8YnVtYnxid1xcLShufHUpfGM1NVxcL3xjYXBpfGNjd2F8Y2RtXFwtfGNlbGx8Y2h0bXxjbGRjfGNtZFxcLXxjbyhtcHxuZCl8Y3Jhd3xkYShpdHxsbHxuZyl8ZGJ0ZXxkY1xcLXN8ZGV2aXxkaWNhfGRtb2J8ZG8oY3xwKW98ZHMoMTJ8XFwtZCl8ZWwoNDl8YWkpfGVtKGwyfHVsKXxlcihpY3xrMCl8ZXNsOHxleihbNC03XTB8b3N8d2F8emUpfGZldGN8Zmx5KFxcLXxfKXxnMSB1fGc1NjB8Z2VuZXxnZlxcLTV8Z1xcLW1vfGdvKFxcLnd8b2QpfGdyKGFkfHVuKXxoYWllfGhjaXR8aGRcXC0obXxwfHQpfGhlaVxcLXxoaShwdHx0YSl8aHAoIGl8aXApfGhzXFwtY3xodChjKFxcLXwgfF98YXxnfHB8c3x0KXx0cCl8aHUoYXd8dGMpfGlcXC0oMjB8Z298bWEpfGkyMzB8aWFjKCB8XFwtfFxcLyl8aWJyb3xpZGVhfGlnMDF8aWtvbXxpbTFrfGlubm98aXBhcXxpcmlzfGphKHR8dilhfGpicm98amVtdXxqaWdzfGtkZGl8a2VqaXxrZ3QoIHxcXC8pfGtsb258a3B0IHxrd2NcXC18a3lvKGN8ayl8bGUobm98eGkpfGxnKCBnfFxcLyhrfGx8dSl8NTB8NTR8XFwtW2Etd10pfGxpYnd8bHlueHxtMVxcLXd8bTNnYXxtNTBcXC98bWEodGV8dWl8eG8pfG1jKDAxfDIxfGNhKXxtXFwtY3J8bWUocmN8cmkpfG1pKG84fG9hfHRzKXxtbWVmfG1vKDAxfDAyfGJpfGRlfGRvfHQoXFwtfCB8b3x2KXx6eil8bXQoNTB8cDF8diApfG13YnB8bXl3YXxuMTBbMC0yXXxuMjBbMi0zXXxuMzAoMHwyKXxuNTAoMHwyfDUpfG43KDAoMHwxKXwxMCl8bmUoKGN8bSlcXC18b258dGZ8d2Z8d2d8d3QpfG5vayg2fGkpfG56cGh8bzJpbXxvcCh0aXx3dil8b3Jhbnxvd2cxfHA4MDB8cGFuKGF8ZHx0KXxwZHhnfHBnKDEzfFxcLShbMS04XXxjKSl8cGhpbHxwaXJlfHBsKGF5fHVjKXxwblxcLTJ8cG8oY2t8cnR8c2UpfHByb3h8cHNpb3xwdFxcLWd8cWFcXC1hfHFjKDA3fDEyfDIxfDMyfDYwfFxcLVsyLTddfGlcXC0pfHF0ZWt8cjM4MHxyNjAwfHJha3N8cmltOXxybyh2ZXx6byl8czU1XFwvfHNhKGdlfG1hfG1tfG1zfG55fHZhKXxzYygwMXxoXFwtfG9vfHBcXC0pfHNka1xcL3xzZShjKFxcLXwwfDEpfDQ3fG1jfG5kfHJpKXxzZ2hcXC18c2hhcnxzaWUoXFwtfG0pfHNrXFwtMHxzbCg0NXxpZCl8c20oYWx8YXJ8YjN8aXR8dDUpfHNvKGZ0fG55KXxzcCgwMXxoXFwtfHZcXC18diApfHN5KDAxfG1iKXx0MigxOHw1MCl8dDYoMDB8MTB8MTgpfHRhKGd0fGxrKXx0Y2xcXC18dGRnXFwtfHRlbChpfG0pfHRpbVxcLXx0XFwtbW98dG8ocGx8c2gpfHRzKDcwfG1cXC18bTN8bTUpfHR4XFwtOXx1cChcXC5ifGcxfHNpKXx1dHN0fHY0MDB8djc1MHx2ZXJpfHZpKHJnfHRlKXx2ayg0MHw1WzAtM118XFwtdil8dm00MHx2b2RhfHZ1bGN8dngoNTJ8NTN8NjB8NjF8NzB8ODB8ODF8ODN8ODV8OTgpfHczYyhcXC18ICl8d2ViY3x3aGl0fHdpKGcgfG5jfG53KXx3bWxifHdvbnV8eDcwMHx5YXNcXC18eW91cnx6ZXRvfHp0ZVxcLS9pLnRlc3QodWEuc3Vic3RyKDAsIDQpKTtcblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8vLy8gRGF0YSBIYW5kbGluZyAvLy8vLy8vLy8vLy8vLy8vLy9cblxuXG5cdC8vYmxvY2sgdGFibGUgcmVkcmF3aW5nXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5ibG9ja1JlZHJhdyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLnJvd01hbmFnZXIuYmxvY2tSZWRyYXcoKTtcblx0fTtcblxuXHQvL3Jlc3RvcmUgdGFibGUgcmVkcmF3aW5nXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZXN0b3JlUmVkcmF3ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMucm93TWFuYWdlci5yZXN0b3JlUmVkcmF3KCk7XG5cdH07XG5cblx0Ly9sb2NhbCBkYXRhIGZyb20gbG9jYWwgZmlsZVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuc2V0RGF0YUZyb21Mb2NhbEZpbGUgPSBmdW5jdGlvbiAoZXh0ZW5zaW9ucykge1xuXHRcdHZhciBfdGhpczE4ID0gdGhpcztcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cblx0XHRcdHZhciBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcblxuXHRcdFx0aW5wdXQudHlwZSA9IFwiZmlsZVwiO1xuXG5cdFx0XHRpbnB1dC5hY2NlcHQgPSBleHRlbnNpb25zIHx8IFwiLmpzb24sYXBwbGljYXRpb24vanNvblwiO1xuXG5cdFx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0dmFyIGZpbGUgPSBpbnB1dC5maWxlc1swXSxcblx0XHRcdFx0ICAgIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCksXG5cdFx0XHRcdCAgICBkYXRhO1xuXG5cdFx0XHRcdHJlYWRlci5yZWFkQXNUZXh0KGZpbGUpO1xuXG5cdFx0XHRcdHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdFx0ZGF0YSA9IEpTT04ucGFyc2UocmVhZGVyLnJlc3VsdCk7XG5cdFx0XHRcdFx0fSBjYXRjaCAoZSkge1xuXG5cdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJGaWxlIExvYWQgRXJyb3IgLSBGaWxlIGNvbnRlbnRzIGlzIGludmFsaWQgSlNPTlwiLCBlKTtcblxuXHRcdFx0XHRcdFx0cmVqZWN0KGUpO1xuXG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0X3RoaXMxOC5fc2V0RGF0YShkYXRhKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG5cblx0XHRcdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuXG5cdFx0XHRcdFx0XHRyZXNvbHZlKGVycik7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH07XG5cblx0XHRcdFx0cmVhZGVyLm9uZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiRmlsZSBMb2FkIEVycm9yIC0gVW5hYmxlIHRvIHJlYWQgZmlsZVwiKTtcblxuXHRcdFx0XHRcdHJlamVjdCgpO1xuXHRcdFx0XHR9O1xuXHRcdFx0fSk7XG5cblx0XHRcdGlucHV0LmNsaWNrKCk7XG5cdFx0fSk7XG5cdH07XG5cblx0Ly9sb2FkIGRhdGFcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnNldERhdGEgPSBmdW5jdGlvbiAoZGF0YSwgcGFyYW1zLCBjb25maWcpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImFqYXhcIikpIHtcblxuXHRcdFx0dGhpcy5tb2R1bGVzLmFqYXguYmxvY2tBY3RpdmVSZXF1ZXN0KCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXMuX3NldERhdGEoZGF0YSwgcGFyYW1zLCBjb25maWcsIGZhbHNlLCB0cnVlKTtcblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLl9zZXREYXRhID0gZnVuY3Rpb24gKGRhdGEsIHBhcmFtcywgY29uZmlnLCBpblBvc2l0aW9uLCBjb2x1bW5zQ2hhbmdlZCkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0aWYgKHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiKSB7XG5cblx0XHRcdGlmIChkYXRhLmluZGV4T2YoXCJ7XCIpID09IDAgfHwgZGF0YS5pbmRleE9mKFwiW1wiKSA9PSAwKSB7XG5cblx0XHRcdFx0Ly9kYXRhIGlzIGEganNvbiBlbmNvZGVkIHN0cmluZ1xuXG5cdFx0XHRcdHJldHVybiBzZWxmLnJvd01hbmFnZXIuc2V0RGF0YShKU09OLnBhcnNlKGRhdGEpLCBpblBvc2l0aW9uLCBjb2x1bW5zQ2hhbmdlZCk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGlmIChzZWxmLm1vZEV4aXN0cyhcImFqYXhcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0XHRcdGlmIChwYXJhbXMpIHtcblxuXHRcdFx0XHRcdFx0c2VsZi5tb2R1bGVzLmFqYXguc2V0UGFyYW1zKHBhcmFtcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKGNvbmZpZykge1xuXG5cdFx0XHRcdFx0XHRzZWxmLm1vZHVsZXMuYWpheC5zZXRDb25maWcoY29uZmlnKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRzZWxmLm1vZHVsZXMuYWpheC5zZXRVcmwoZGF0YSk7XG5cblx0XHRcdFx0XHRpZiAoc2VsZi5vcHRpb25zLnBhZ2luYXRpb24gPT0gXCJyZW1vdGVcIiAmJiBzZWxmLm1vZEV4aXN0cyhcInBhZ2VcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0XHRcdFx0c2VsZi5tb2R1bGVzLnBhZ2UucmVzZXQodHJ1ZSwgdHJ1ZSk7XG5cblx0XHRcdFx0XHRcdHJldHVybiBzZWxmLm1vZHVsZXMucGFnZS5zZXRQYWdlKDEpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdC8vYXNzdW1lIGRhdGEgaXMgdXJsLCBtYWtlIGFqYXggY2FsbCB0byB1cmwgdG8gZ2V0IGRhdGFcblxuXHRcdFx0XHRcdFx0cmV0dXJuIHNlbGYubW9kdWxlcy5hamF4LmxvYWREYXRhKGluUG9zaXRpb24sIGNvbHVtbnNDaGFuZ2VkKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoZGF0YSkge1xuXG5cdFx0XHRcdC8vYXN1bWUgZGF0YSBpcyBhbHJlYWR5IGFuIG9iamVjdFxuXG5cdFx0XHRcdHJldHVybiBzZWxmLnJvd01hbmFnZXIuc2V0RGF0YShkYXRhLCBpblBvc2l0aW9uLCBjb2x1bW5zQ2hhbmdlZCk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdC8vbm8gZGF0YSBwcm92aWRlZCwgY2hlY2sgaWYgYWpheFVSTCBpcyBwcmVzZW50O1xuXG5cdFx0XHRcdGlmIChzZWxmLm1vZEV4aXN0cyhcImFqYXhcIikgJiYgKHNlbGYubW9kdWxlcy5hamF4LmdldFVybCB8fCBzZWxmLm9wdGlvbnMuYWpheFVSTEdlbmVyYXRvcikpIHtcblxuXHRcdFx0XHRcdGlmIChzZWxmLm9wdGlvbnMucGFnaW5hdGlvbiA9PSBcInJlbW90ZVwiICYmIHNlbGYubW9kRXhpc3RzKFwicGFnZVwiLCB0cnVlKSkge1xuXG5cdFx0XHRcdFx0XHRzZWxmLm1vZHVsZXMucGFnZS5yZXNldCh0cnVlLCB0cnVlKTtcblxuXHRcdFx0XHRcdFx0cmV0dXJuIHNlbGYubW9kdWxlcy5wYWdlLnNldFBhZ2UoMSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0cmV0dXJuIHNlbGYubW9kdWxlcy5hamF4LmxvYWREYXRhKGluUG9zaXRpb24sIGNvbHVtbnNDaGFuZ2VkKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHQvL2VtcHR5IGRhdGFcblxuXHRcdFx0XHRcdHJldHVybiBzZWxmLnJvd01hbmFnZXIuc2V0RGF0YShbXSwgaW5Qb3NpdGlvbiwgY29sdW1uc0NoYW5nZWQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdC8vY2xlYXIgZGF0YVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuY2xlYXJEYXRhID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiYWpheFwiKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuYWpheC5ibG9ja0FjdGl2ZVJlcXVlc3QoKTtcblx0XHR9XG5cblx0XHR0aGlzLnJvd01hbmFnZXIuY2xlYXJEYXRhKCk7XG5cdH07XG5cblx0Ly9nZXQgdGFibGUgZGF0YSBhcnJheVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZ2V0RGF0YSA9IGZ1bmN0aW9uIChhY3RpdmUpIHtcblxuXHRcdGlmIChhY3RpdmUgPT09IHRydWUpIHtcblxuXHRcdFx0Y29uc29sZS53YXJuKFwicGFzc2luZyBhIGJvb2xlYW4gdG8gdGhlIGdldERhdGEgZnVuY3Rpb24gaXMgZGVwcmVjYXRlZCwgeW91IHNob3VsZCBub3cgcGFzcyB0aGUgc3RyaW5nICdhY3RpdmUnXCIpO1xuXG5cdFx0XHRhY3RpdmUgPSBcImFjdGl2ZVwiO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzLnJvd01hbmFnZXIuZ2V0RGF0YShhY3RpdmUpO1xuXHR9O1xuXG5cdC8vZ2V0IHRhYmxlIGRhdGEgYXJyYXkgY291bnRcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldERhdGFDb3VudCA9IGZ1bmN0aW9uIChhY3RpdmUpIHtcblxuXHRcdGlmIChhY3RpdmUgPT09IHRydWUpIHtcblxuXHRcdFx0Y29uc29sZS53YXJuKFwicGFzc2luZyBhIGJvb2xlYW4gdG8gdGhlIGdldERhdGFDb3VudCBmdW5jdGlvbiBpcyBkZXByZWNhdGVkLCB5b3Ugc2hvdWxkIG5vdyBwYXNzIHRoZSBzdHJpbmcgJ2FjdGl2ZSdcIik7XG5cblx0XHRcdGFjdGl2ZSA9IFwiYWN0aXZlXCI7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXMucm93TWFuYWdlci5nZXREYXRhQ291bnQoYWN0aXZlKTtcblx0fTtcblxuXHQvL3NlYXJjaCBmb3Igc3BlY2lmaWMgcm93IGNvbXBvbmVudHNcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnNlYXJjaFJvd3MgPSBmdW5jdGlvbiAoZmllbGQsIHR5cGUsIHZhbHVlKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJmaWx0ZXJcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMubW9kdWxlcy5maWx0ZXIuc2VhcmNoKFwicm93c1wiLCBmaWVsZCwgdHlwZSwgdmFsdWUpO1xuXHRcdH1cblx0fTtcblxuXHQvL3NlYXJjaCBmb3Igc3BlY2lmaWMgZGF0YVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuc2VhcmNoRGF0YSA9IGZ1bmN0aW9uIChmaWVsZCwgdHlwZSwgdmFsdWUpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImZpbHRlclwiLCB0cnVlKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5tb2R1bGVzLmZpbHRlci5zZWFyY2goXCJkYXRhXCIsIGZpZWxkLCB0eXBlLCB2YWx1ZSk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vZ2V0IHRhYmxlIGh0bWxcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldEh0bWwgPSBmdW5jdGlvbiAodmlzaWJsZSwgc3R5bGUsIGNvbmZpZykge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiZXhwb3J0XCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLm1vZHVsZXMuZXhwb3J0LmdldEh0bWwodmlzaWJsZSwgc3R5bGUsIGNvbmZpZyk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vZ2V0IHByaW50IGh0bWxcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnByaW50ID0gZnVuY3Rpb24gKHZpc2libGUsIHN0eWxlLCBjb25maWcpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcInByaW50XCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLm1vZHVsZXMucHJpbnQucHJpbnRGdWxsc2NyZWVuKHZpc2libGUsIHN0eWxlLCBjb25maWcpO1xuXHRcdH1cblx0fTtcblxuXHQvL3JldHJpZXZlIEFqYXggVVJMXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5nZXRBamF4VXJsID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiYWpheFwiLCB0cnVlKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5tb2R1bGVzLmFqYXguZ2V0VXJsKCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vcmVwbGFjZSBkYXRhLCBrZWVwaW5nIHRhYmxlIGluIHBvc2l0aW9uIHdpdGggc2FtZSBzb3J0XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZXBsYWNlRGF0YSA9IGZ1bmN0aW9uIChkYXRhLCBwYXJhbXMsIGNvbmZpZykge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiYWpheFwiKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuYWpheC5ibG9ja0FjdGl2ZVJlcXVlc3QoKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcy5fc2V0RGF0YShkYXRhLCBwYXJhbXMsIGNvbmZpZywgdHJ1ZSk7XG5cdH07XG5cblx0Ly91cGRhdGUgdGFibGUgZGF0YVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUudXBkYXRlRGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cdFx0dmFyIF90aGlzMTkgPSB0aGlzO1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0dmFyIHJlc3BvbnNlcyA9IDA7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG5cdFx0XHRpZiAoX3RoaXMxOS5tb2RFeGlzdHMoXCJhamF4XCIpKSB7XG5cblx0XHRcdFx0X3RoaXMxOS5tb2R1bGVzLmFqYXguYmxvY2tBY3RpdmVSZXF1ZXN0KCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YgZGF0YSA9PT0gXCJzdHJpbmdcIikge1xuXG5cdFx0XHRcdGRhdGEgPSBKU09OLnBhcnNlKGRhdGEpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoZGF0YSkge1xuXG5cdFx0XHRcdGRhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXG5cdFx0XHRcdFx0dmFyIHJvdyA9IHNlbGYucm93TWFuYWdlci5maW5kUm93KGl0ZW1bc2VsZi5vcHRpb25zLmluZGV4XSk7XG5cblx0XHRcdFx0XHRpZiAocm93KSB7XG5cblx0XHRcdFx0XHRcdHJlc3BvbnNlcysrO1xuXG5cdFx0XHRcdFx0XHRyb3cudXBkYXRlRGF0YShpdGVtKS50aGVuKGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0XHRcdFx0XHRyZXNwb25zZXMtLTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoIXJlc3BvbnNlcykge1xuXG5cdFx0XHRcdFx0XHRcdFx0cmVzb2x2ZSgpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJVcGRhdGUgRXJyb3IgLSBObyBkYXRhIHByb3ZpZGVkXCIpO1xuXG5cdFx0XHRcdHJlamVjdChcIlVwZGF0ZSBFcnJvciAtIE5vIGRhdGEgcHJvdmlkZWRcIik7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5hZGREYXRhID0gZnVuY3Rpb24gKGRhdGEsIHBvcywgaW5kZXgpIHtcblx0XHR2YXIgX3RoaXMyMCA9IHRoaXM7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG5cdFx0XHRpZiAoX3RoaXMyMC5tb2RFeGlzdHMoXCJhamF4XCIpKSB7XG5cblx0XHRcdFx0X3RoaXMyMC5tb2R1bGVzLmFqYXguYmxvY2tBY3RpdmVSZXF1ZXN0KCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YgZGF0YSA9PT0gXCJzdHJpbmdcIikge1xuXG5cdFx0XHRcdGRhdGEgPSBKU09OLnBhcnNlKGRhdGEpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoZGF0YSkge1xuXG5cdFx0XHRcdF90aGlzMjAucm93TWFuYWdlci5hZGRSb3dzKGRhdGEsIHBvcywgaW5kZXgpLnRoZW4oZnVuY3Rpb24gKHJvd3MpIHtcblxuXHRcdFx0XHRcdHZhciBvdXRwdXQgPSBbXTtcblxuXHRcdFx0XHRcdHJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cblx0XHRcdFx0XHRcdG91dHB1dC5wdXNoKHJvdy5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRyZXNvbHZlKG91dHB1dCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJVcGRhdGUgRXJyb3IgLSBObyBkYXRhIHByb3ZpZGVkXCIpO1xuXG5cdFx0XHRcdHJlamVjdChcIlVwZGF0ZSBFcnJvciAtIE5vIGRhdGEgcHJvdmlkZWRcIik7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0Ly91cGRhdGUgdGFibGUgZGF0YVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUudXBkYXRlT3JBZGREYXRhID0gZnVuY3Rpb24gKGRhdGEpIHtcblx0XHR2YXIgX3RoaXMyMSA9IHRoaXM7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHJvd3MgPSBbXSxcblx0XHQgICAgcmVzcG9uc2VzID0gMDtcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cblx0XHRcdGlmIChfdGhpczIxLm1vZEV4aXN0cyhcImFqYXhcIikpIHtcblxuXHRcdFx0XHRfdGhpczIxLm1vZHVsZXMuYWpheC5ibG9ja0FjdGl2ZVJlcXVlc3QoKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiKSB7XG5cblx0XHRcdFx0ZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChkYXRhKSB7XG5cblx0XHRcdFx0ZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cblx0XHRcdFx0XHR2YXIgcm93ID0gc2VsZi5yb3dNYW5hZ2VyLmZpbmRSb3coaXRlbVtzZWxmLm9wdGlvbnMuaW5kZXhdKTtcblxuXHRcdFx0XHRcdHJlc3BvbnNlcysrO1xuXG5cdFx0XHRcdFx0aWYgKHJvdykge1xuXG5cdFx0XHRcdFx0XHRyb3cudXBkYXRlRGF0YShpdGVtKS50aGVuKGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0XHRcdFx0XHRyZXNwb25zZXMtLTtcblxuXHRcdFx0XHRcdFx0XHRyb3dzLnB1c2gocm93LmdldENvbXBvbmVudCgpKTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoIXJlc3BvbnNlcykge1xuXG5cdFx0XHRcdFx0XHRcdFx0cmVzb2x2ZShyb3dzKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0c2VsZi5yb3dNYW5hZ2VyLmFkZFJvd3MoaXRlbSkudGhlbihmdW5jdGlvbiAobmV3Um93cykge1xuXG5cdFx0XHRcdFx0XHRcdHJlc3BvbnNlcy0tO1xuXG5cdFx0XHRcdFx0XHRcdHJvd3MucHVzaChuZXdSb3dzWzBdLmdldENvbXBvbmVudCgpKTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoIXJlc3BvbnNlcykge1xuXG5cdFx0XHRcdFx0XHRcdFx0cmVzb2x2ZShyb3dzKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0Y29uc29sZS53YXJuKFwiVXBkYXRlIEVycm9yIC0gTm8gZGF0YSBwcm92aWRlZFwiKTtcblxuXHRcdFx0XHRyZWplY3QoXCJVcGRhdGUgRXJyb3IgLSBObyBkYXRhIHByb3ZpZGVkXCIpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdC8vZ2V0IHJvdyBvYmplY3RcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldFJvdyA9IGZ1bmN0aW9uIChpbmRleCkge1xuXG5cdFx0dmFyIHJvdyA9IHRoaXMucm93TWFuYWdlci5maW5kUm93KGluZGV4KTtcblxuXHRcdGlmIChyb3cpIHtcblxuXHRcdFx0cmV0dXJuIHJvdy5nZXRDb21wb25lbnQoKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRjb25zb2xlLndhcm4oXCJGaW5kIEVycm9yIC0gTm8gbWF0Y2hpbmcgcm93IGZvdW5kOlwiLCBpbmRleCk7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0Ly9nZXQgcm93IG9iamVjdFxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZ2V0Um93RnJvbVBvc2l0aW9uID0gZnVuY3Rpb24gKHBvc2l0aW9uLCBhY3RpdmUpIHtcblxuXHRcdHZhciByb3cgPSB0aGlzLnJvd01hbmFnZXIuZ2V0Um93RnJvbVBvc2l0aW9uKHBvc2l0aW9uLCBhY3RpdmUpO1xuXG5cdFx0aWYgKHJvdykge1xuXG5cdFx0XHRyZXR1cm4gcm93LmdldENvbXBvbmVudCgpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcIkZpbmQgRXJyb3IgLSBObyBtYXRjaGluZyByb3cgZm91bmQ6XCIsIHBvc2l0aW9uKTtcblxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fTtcblxuXHQvL2RlbGV0ZSByb3cgZnJvbSB0YWJsZVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZGVsZXRlUm93ID0gZnVuY3Rpb24gKGluZGV4KSB7XG5cdFx0dmFyIF90aGlzMjIgPSB0aGlzO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdFx0dmFyIHNlbGYgPSBfdGhpczIyLFxuXHRcdFx0ICAgIGNvdW50ID0gMCxcblx0XHRcdCAgICBzdWNjZXNzQ291bnQgPSAwLFxuXHRcdFx0ICAgIGZvdW5kUm93cyA9IFtdO1xuXG5cdFx0XHRmdW5jdGlvbiBkb25lQ2hlY2soKSB7XG5cblx0XHRcdFx0Y291bnQrKztcblxuXHRcdFx0XHRpZiAoY291bnQgPT0gaW5kZXgubGVuZ3RoKSB7XG5cblx0XHRcdFx0XHRpZiAoc3VjY2Vzc0NvdW50KSB7XG5cblx0XHRcdFx0XHRcdHNlbGYucm93TWFuYWdlci5yZVJlbmRlckluUG9zaXRpb24oKTtcblxuXHRcdFx0XHRcdFx0cmVzb2x2ZSgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIUFycmF5LmlzQXJyYXkoaW5kZXgpKSB7XG5cblx0XHRcdFx0aW5kZXggPSBbaW5kZXhdO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2ZpbmQgbWF0Y2hpbmcgcm93c1xuXG5cdFx0XHRpbmRleC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cblx0XHRcdFx0dmFyIHJvdyA9IF90aGlzMjIucm93TWFuYWdlci5maW5kUm93KGl0ZW0sIHRydWUpO1xuXG5cdFx0XHRcdGlmIChyb3cpIHtcblxuXHRcdFx0XHRcdGZvdW5kUm93cy5wdXNoKHJvdyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJEZWxldGUgRXJyb3IgLSBObyBtYXRjaGluZyByb3cgZm91bmQ6XCIsIGl0ZW0pO1xuXG5cdFx0XHRcdFx0cmVqZWN0KFwiRGVsZXRlIEVycm9yIC0gTm8gbWF0Y2hpbmcgcm93IGZvdW5kXCIpO1xuXG5cdFx0XHRcdFx0ZG9uZUNoZWNrKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHQvL3NvcnQgcm93cyBpbnRvIGNvcnJlY3Qgb3JkZXIgdG8gZW5zdXJlIHNtb290aCBkZWxldGUgZnJvbSB0YWJsZVxuXG5cdFx0XHRmb3VuZFJvd3Muc29ydChmdW5jdGlvbiAoYSwgYikge1xuXG5cdFx0XHRcdHJldHVybiBfdGhpczIyLnJvd01hbmFnZXIucm93cy5pbmRleE9mKGEpID4gX3RoaXMyMi5yb3dNYW5hZ2VyLnJvd3MuaW5kZXhPZihiKSA/IDEgOiAtMTtcblx0XHRcdH0pO1xuXG5cdFx0XHRmb3VuZFJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cblx0XHRcdFx0cm93LmRlbGV0ZSgpLnRoZW4oZnVuY3Rpb24gKCkge1xuXG5cdFx0XHRcdFx0c3VjY2Vzc0NvdW50Kys7XG5cblx0XHRcdFx0XHRkb25lQ2hlY2soKTtcblx0XHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuXG5cdFx0XHRcdFx0ZG9uZUNoZWNrKCk7XG5cblx0XHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9KTtcblx0fTtcblxuXHQvL2FkZCByb3cgdG8gdGFibGVcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmFkZFJvdyA9IGZ1bmN0aW9uIChkYXRhLCBwb3MsIGluZGV4KSB7XG5cdFx0dmFyIF90aGlzMjMgPSB0aGlzO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdFx0aWYgKHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiKSB7XG5cblx0XHRcdFx0ZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG5cdFx0XHR9XG5cblx0XHRcdF90aGlzMjMucm93TWFuYWdlci5hZGRSb3dzKGRhdGEsIHBvcywgaW5kZXgpLnRoZW4oZnVuY3Rpb24gKHJvd3MpIHtcblxuXHRcdFx0XHQvL3JlY2FsYyBjb2x1bW4gY2FsY3VsYXRpb25zIGlmIHByZXNlbnRcblxuXHRcdFx0XHRpZiAoX3RoaXMyMy5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiKSkge1xuXG5cdFx0XHRcdFx0X3RoaXMyMy5tb2R1bGVzLmNvbHVtbkNhbGNzLnJlY2FsYyhfdGhpczIzLnJvd01hbmFnZXIuYWN0aXZlUm93cyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXNvbHZlKHJvd3NbMF0uZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cdFx0fSk7XG5cdH07XG5cblx0Ly91cGRhdGUgYSByb3cgaWYgaXQgZXhpdHN0cyBvdGhlcndpc2UgY3JlYXRlIGl0XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS51cGRhdGVPckFkZFJvdyA9IGZ1bmN0aW9uIChpbmRleCwgZGF0YSkge1xuXHRcdHZhciBfdGhpczI0ID0gdGhpcztcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cblx0XHRcdHZhciByb3cgPSBfdGhpczI0LnJvd01hbmFnZXIuZmluZFJvdyhpbmRleCk7XG5cblx0XHRcdGlmICh0eXBlb2YgZGF0YSA9PT0gXCJzdHJpbmdcIikge1xuXG5cdFx0XHRcdGRhdGEgPSBKU09OLnBhcnNlKGRhdGEpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAocm93KSB7XG5cblx0XHRcdFx0cm93LnVwZGF0ZURhdGEoZGF0YSkudGhlbihmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHQvL3JlY2FsYyBjb2x1bW4gY2FsY3VsYXRpb25zIGlmIHByZXNlbnRcblxuXHRcdFx0XHRcdGlmIChfdGhpczI0Lm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpKSB7XG5cblx0XHRcdFx0XHRcdF90aGlzMjQubW9kdWxlcy5jb2x1bW5DYWxjcy5yZWNhbGMoX3RoaXMyNC5yb3dNYW5hZ2VyLmFjdGl2ZVJvd3MpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJlc29sdmUocm93LmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuXG5cdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRyb3cgPSBfdGhpczI0LnJvd01hbmFnZXIuYWRkUm93cyhkYXRhKS50aGVuKGZ1bmN0aW9uIChyb3dzKSB7XG5cblx0XHRcdFx0XHQvL3JlY2FsYyBjb2x1bW4gY2FsY3VsYXRpb25zIGlmIHByZXNlbnRcblxuXHRcdFx0XHRcdGlmIChfdGhpczI0Lm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpKSB7XG5cblx0XHRcdFx0XHRcdF90aGlzMjQubW9kdWxlcy5jb2x1bW5DYWxjcy5yZWNhbGMoX3RoaXMyNC5yb3dNYW5hZ2VyLmFjdGl2ZVJvd3MpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJlc29sdmUocm93c1swXS5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcblxuXHRcdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHQvL3VwZGF0ZSByb3cgZGF0YVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUudXBkYXRlUm93ID0gZnVuY3Rpb24gKGluZGV4LCBkYXRhKSB7XG5cdFx0dmFyIF90aGlzMjUgPSB0aGlzO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdFx0dmFyIHJvdyA9IF90aGlzMjUucm93TWFuYWdlci5maW5kUm93KGluZGV4KTtcblxuXHRcdFx0aWYgKHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiKSB7XG5cblx0XHRcdFx0ZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChyb3cpIHtcblxuXHRcdFx0XHRyb3cudXBkYXRlRGF0YShkYXRhKS50aGVuKGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0XHRcdHJlc29sdmUocm93LmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuXG5cdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJVcGRhdGUgRXJyb3IgLSBObyBtYXRjaGluZyByb3cgZm91bmQ6XCIsIGluZGV4KTtcblxuXHRcdFx0XHRyZWplY3QoXCJVcGRhdGUgRXJyb3IgLSBObyBtYXRjaGluZyByb3cgZm91bmRcIik7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0Ly9zY3JvbGwgdG8gcm93IGluIERPTVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuc2Nyb2xsVG9Sb3cgPSBmdW5jdGlvbiAoaW5kZXgsIHBvc2l0aW9uLCBpZlZpc2libGUpIHtcblx0XHR2YXIgX3RoaXMyNiA9IHRoaXM7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG5cdFx0XHR2YXIgcm93ID0gX3RoaXMyNi5yb3dNYW5hZ2VyLmZpbmRSb3coaW5kZXgpO1xuXG5cdFx0XHRpZiAocm93KSB7XG5cblx0XHRcdFx0X3RoaXMyNi5yb3dNYW5hZ2VyLnNjcm9sbFRvUm93KHJvdywgcG9zaXRpb24sIGlmVmlzaWJsZSkudGhlbihmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcblxuXHRcdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0Y29uc29sZS53YXJuKFwiU2Nyb2xsIEVycm9yIC0gTm8gbWF0Y2hpbmcgcm93IGZvdW5kOlwiLCBpbmRleCk7XG5cblx0XHRcdFx0cmVqZWN0KFwiU2Nyb2xsIEVycm9yIC0gTm8gbWF0Y2hpbmcgcm93IGZvdW5kXCIpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUubW92ZVJvdyA9IGZ1bmN0aW9uIChmcm9tLCB0bywgYWZ0ZXIpIHtcblxuXHRcdHZhciBmcm9tUm93ID0gdGhpcy5yb3dNYW5hZ2VyLmZpbmRSb3coZnJvbSk7XG5cblx0XHRpZiAoZnJvbVJvdykge1xuXG5cdFx0XHRmcm9tUm93Lm1vdmVUb1Jvdyh0bywgYWZ0ZXIpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcIk1vdmUgRXJyb3IgLSBObyBtYXRjaGluZyByb3cgZm91bmQ6XCIsIGZyb20pO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldFJvd3MgPSBmdW5jdGlvbiAoYWN0aXZlKSB7XG5cblx0XHRpZiAoYWN0aXZlID09PSB0cnVlKSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcInBhc3NpbmcgYSBib29sZWFuIHRvIHRoZSBnZXRSb3dzIGZ1bmN0aW9uIGlzIGRlcHJlY2F0ZWQsIHlvdSBzaG91bGQgbm93IHBhc3MgdGhlIHN0cmluZyAnYWN0aXZlJ1wiKTtcblxuXHRcdFx0YWN0aXZlID0gXCJhY3RpdmVcIjtcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcy5yb3dNYW5hZ2VyLmdldENvbXBvbmVudHMoYWN0aXZlKTtcblx0fTtcblxuXHQvL2dldCBwb3NpdGlvbiBvZiByb3cgaW4gdGFibGVcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldFJvd1Bvc2l0aW9uID0gZnVuY3Rpb24gKGluZGV4LCBhY3RpdmUpIHtcblxuXHRcdHZhciByb3cgPSB0aGlzLnJvd01hbmFnZXIuZmluZFJvdyhpbmRleCk7XG5cblx0XHRpZiAocm93KSB7XG5cblx0XHRcdHJldHVybiB0aGlzLnJvd01hbmFnZXIuZ2V0Um93UG9zaXRpb24ocm93LCBhY3RpdmUpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcIlBvc2l0aW9uIEVycm9yIC0gTm8gbWF0Y2hpbmcgcm93IGZvdW5kOlwiLCBpbmRleCk7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0Ly9jb3B5IHRhYmxlIGRhdGEgdG8gY2xpcGJvYXJkXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5jb3B5VG9DbGlwYm9hcmQgPSBmdW5jdGlvbiAoc2VsZWN0b3IpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImNsaXBib2FyZFwiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuY2xpcGJvYXJkLmNvcHkoc2VsZWN0b3IpO1xuXHRcdH1cblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8gQ29sdW1uIEZ1bmN0aW9ucyAgLy8vLy8vLy8vLy8vLy8vXG5cblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnNldENvbHVtbnMgPSBmdW5jdGlvbiAoZGVmaW5pdGlvbikge1xuXG5cdFx0dGhpcy5jb2x1bW5NYW5hZ2VyLnNldENvbHVtbnMoZGVmaW5pdGlvbik7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5nZXRDb2x1bW5zID0gZnVuY3Rpb24gKHN0cnVjdHVyZWQpIHtcblxuXHRcdHJldHVybiB0aGlzLmNvbHVtbk1hbmFnZXIuZ2V0Q29tcG9uZW50cyhzdHJ1Y3R1cmVkKTtcblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldENvbHVtbiA9IGZ1bmN0aW9uIChmaWVsZCkge1xuXG5cdFx0dmFyIGNvbCA9IHRoaXMuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uKGZpZWxkKTtcblxuXHRcdGlmIChjb2wpIHtcblxuXHRcdFx0cmV0dXJuIGNvbC5nZXRDb21wb25lbnQoKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRjb25zb2xlLndhcm4oXCJGaW5kIEVycm9yIC0gTm8gbWF0Y2hpbmcgY29sdW1uIGZvdW5kOlwiLCBmaWVsZCk7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5nZXRDb2x1bW5EZWZpbml0aW9ucyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLmNvbHVtbk1hbmFnZXIuZ2V0RGVmaW5pdGlvblRyZWUoKTtcblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldENvbHVtbkxheW91dCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcInBlcnNpc3RlbmNlXCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLm1vZHVsZXMucGVyc2lzdGVuY2UucGFyc2VDb2x1bW5zKHRoaXMuY29sdW1uTWFuYWdlci5nZXRDb2x1bW5zKCkpO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnNldENvbHVtbkxheW91dCA9IGZ1bmN0aW9uIChsYXlvdXQpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcInBlcnNpc3RlbmNlXCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMuY29sdW1uTWFuYWdlci5zZXRDb2x1bW5zKHRoaXMubW9kdWxlcy5wZXJzaXN0ZW5jZS5tZXJnZURlZmluaXRpb24odGhpcy5vcHRpb25zLmNvbHVtbnMsIGxheW91dCkpO1xuXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5zaG93Q29sdW1uID0gZnVuY3Rpb24gKGZpZWxkKSB7XG5cblx0XHR2YXIgY29sdW1uID0gdGhpcy5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW4oZmllbGQpO1xuXG5cdFx0aWYgKGNvbHVtbikge1xuXG5cdFx0XHRjb2x1bW4uc2hvdygpO1xuXG5cdFx0XHRpZiAodGhpcy5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXQgJiYgdGhpcy5tb2RFeGlzdHMoXCJyZXNwb25zaXZlTGF5b3V0XCIsIHRydWUpKSB7XG5cblx0XHRcdFx0dGhpcy5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQudXBkYXRlKCk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0Y29uc29sZS53YXJuKFwiQ29sdW1uIFNob3cgRXJyb3IgLSBObyBtYXRjaGluZyBjb2x1bW4gZm91bmQ6XCIsIGZpZWxkKTtcblxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmhpZGVDb2x1bW4gPSBmdW5jdGlvbiAoZmllbGQpIHtcblxuXHRcdHZhciBjb2x1bW4gPSB0aGlzLmNvbHVtbk1hbmFnZXIuZmluZENvbHVtbihmaWVsZCk7XG5cblx0XHRpZiAoY29sdW1uKSB7XG5cblx0XHRcdGNvbHVtbi5oaWRlKCk7XG5cblx0XHRcdGlmICh0aGlzLm9wdGlvbnMucmVzcG9uc2l2ZUxheW91dCAmJiB0aGlzLm1vZEV4aXN0cyhcInJlc3BvbnNpdmVMYXlvdXRcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0XHR0aGlzLm1vZHVsZXMucmVzcG9uc2l2ZUxheW91dC51cGRhdGUoKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRjb25zb2xlLndhcm4oXCJDb2x1bW4gSGlkZSBFcnJvciAtIE5vIG1hdGNoaW5nIGNvbHVtbiBmb3VuZDpcIiwgZmllbGQpO1xuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUudG9nZ2xlQ29sdW1uID0gZnVuY3Rpb24gKGZpZWxkKSB7XG5cblx0XHR2YXIgY29sdW1uID0gdGhpcy5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW4oZmllbGQpO1xuXG5cdFx0aWYgKGNvbHVtbikge1xuXG5cdFx0XHRpZiAoY29sdW1uLnZpc2libGUpIHtcblxuXHRcdFx0XHRjb2x1bW4uaGlkZSgpO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRjb2x1bW4uc2hvdygpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcIkNvbHVtbiBWaXNpYmlsaXR5IFRvZ2dsZSBFcnJvciAtIE5vIG1hdGNoaW5nIGNvbHVtbiBmb3VuZDpcIiwgZmllbGQpO1xuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuYWRkQ29sdW1uID0gZnVuY3Rpb24gKGRlZmluaXRpb24sIGJlZm9yZSwgZmllbGQpIHtcblx0XHR2YXIgX3RoaXMyNyA9IHRoaXM7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG5cdFx0XHR2YXIgY29sdW1uID0gX3RoaXMyNy5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW4oZmllbGQpO1xuXG5cdFx0XHRfdGhpczI3LmNvbHVtbk1hbmFnZXIuYWRkQ29sdW1uKGRlZmluaXRpb24sIGJlZm9yZSwgY29sdW1uKS50aGVuKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0XHRyZXNvbHZlKGNvbHVtbi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHR9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG5cblx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHR9KTtcblx0XHR9KTtcblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmRlbGV0ZUNvbHVtbiA9IGZ1bmN0aW9uIChmaWVsZCkge1xuXHRcdHZhciBfdGhpczI4ID0gdGhpcztcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cblx0XHRcdHZhciBjb2x1bW4gPSBfdGhpczI4LmNvbHVtbk1hbmFnZXIuZmluZENvbHVtbihmaWVsZCk7XG5cblx0XHRcdGlmIChjb2x1bW4pIHtcblxuXHRcdFx0XHRjb2x1bW4uZGVsZXRlKCkudGhlbihmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcblxuXHRcdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0Y29uc29sZS53YXJuKFwiQ29sdW1uIERlbGV0ZSBFcnJvciAtIE5vIG1hdGNoaW5nIGNvbHVtbiBmb3VuZDpcIiwgZmllbGQpO1xuXG5cdFx0XHRcdHJlamVjdCgpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUudXBkYXRlQ29sdW1uRGVmaW5pdGlvbiA9IGZ1bmN0aW9uIChmaWVsZCwgZGVmaW5pdGlvbikge1xuXHRcdHZhciBfdGhpczI5ID0gdGhpcztcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cblx0XHRcdHZhciBjb2x1bW4gPSBfdGhpczI5LmNvbHVtbk1hbmFnZXIuZmluZENvbHVtbihmaWVsZCk7XG5cblx0XHRcdGlmIChjb2x1bW4pIHtcblxuXHRcdFx0XHRjb2x1bW4udXBkYXRlRGVmaW5pdGlvbihkZWZpbml0aW9uKS50aGVuKGZ1bmN0aW9uIChjb2wpIHtcblxuXHRcdFx0XHRcdHJlc29sdmUoY29sKTtcblx0XHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuXG5cdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJDb2x1bW4gVXBkYXRlIEVycm9yIC0gTm8gbWF0Y2hpbmcgY29sdW1uIGZvdW5kOlwiLCBmaWVsZCk7XG5cblx0XHRcdFx0cmVqZWN0KCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5tb3ZlQ29sdW1uID0gZnVuY3Rpb24gKGZyb20sIHRvLCBhZnRlcikge1xuXG5cdFx0dmFyIGZyb21Db2x1bW4gPSB0aGlzLmNvbHVtbk1hbmFnZXIuZmluZENvbHVtbihmcm9tKTtcblxuXHRcdHZhciB0b0NvbHVtbiA9IHRoaXMuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uKHRvKTtcblxuXHRcdGlmIChmcm9tQ29sdW1uKSB7XG5cblx0XHRcdGlmICh0b0NvbHVtbikge1xuXG5cdFx0XHRcdHRoaXMuY29sdW1uTWFuYWdlci5tb3ZlQ29sdW1uKGZyb21Db2x1bW4sIHRvQ29sdW1uLCBhZnRlcik7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGNvbnNvbGUud2FybihcIk1vdmUgRXJyb3IgLSBObyBtYXRjaGluZyBjb2x1bW4gZm91bmQ6XCIsIHRvQ29sdW1uKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRjb25zb2xlLndhcm4oXCJNb3ZlIEVycm9yIC0gTm8gbWF0Y2hpbmcgY29sdW1uIGZvdW5kOlwiLCBmcm9tKTtcblx0XHR9XG5cdH07XG5cblx0Ly9zY3JvbGwgdG8gY29sdW1uIGluIERPTVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuc2Nyb2xsVG9Db2x1bW4gPSBmdW5jdGlvbiAoZmllbGQsIHBvc2l0aW9uLCBpZlZpc2libGUpIHtcblx0XHR2YXIgX3RoaXMzMCA9IHRoaXM7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG5cdFx0XHR2YXIgY29sdW1uID0gX3RoaXMzMC5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW4oZmllbGQpO1xuXG5cdFx0XHRpZiAoY29sdW1uKSB7XG5cblx0XHRcdFx0X3RoaXMzMC5jb2x1bW5NYW5hZ2VyLnNjcm9sbFRvQ29sdW1uKGNvbHVtbiwgcG9zaXRpb24sIGlmVmlzaWJsZSkudGhlbihmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcblxuXHRcdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0Y29uc29sZS53YXJuKFwiU2Nyb2xsIEVycm9yIC0gTm8gbWF0Y2hpbmcgY29sdW1uIGZvdW5kOlwiLCBmaWVsZCk7XG5cblx0XHRcdFx0cmVqZWN0KFwiU2Nyb2xsIEVycm9yIC0gTm8gbWF0Y2hpbmcgY29sdW1uIGZvdW5kXCIpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLyBMb2NhbGl6YXRpb24gRnVuY3Rpb25zICAvLy8vLy8vLy8vLy9cblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnNldExvY2FsZSA9IGZ1bmN0aW9uIChsb2NhbGUpIHtcblxuXHRcdHRoaXMubW9kdWxlcy5sb2NhbGl6ZS5zZXRMb2NhbGUobG9jYWxlKTtcblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldExvY2FsZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLm1vZHVsZXMubG9jYWxpemUuZ2V0TG9jYWxlKCk7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5nZXRMYW5nID0gZnVuY3Rpb24gKGxvY2FsZSkge1xuXG5cdFx0cmV0dXJuIHRoaXMubW9kdWxlcy5sb2NhbGl6ZS5nZXRMYW5nKGxvY2FsZSk7XG5cdH07XG5cblx0Ly8vLy8vLy8vLy8vIEdlbmVyYWwgUHVibGljIEZ1bmN0aW9ucyAvLy8vLy8vLy8vLy9cblxuXG5cdC8vcmVkcmF3IGxpc3Qgd2l0aG91dCB1cGRhdGluZyBkYXRhXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWRyYXcgPSBmdW5jdGlvbiAoZm9yY2UpIHtcblxuXHRcdHRoaXMuY29sdW1uTWFuYWdlci5yZWRyYXcoZm9yY2UpO1xuXG5cdFx0dGhpcy5yb3dNYW5hZ2VyLnJlZHJhdyhmb3JjZSk7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5zZXRIZWlnaHQgPSBmdW5jdGlvbiAoaGVpZ2h0KSB7XG5cblx0XHRpZiAodGhpcy5yb3dNYW5hZ2VyLnJlbmRlck1vZGUgIT09IFwiY2xhc3NpY1wiKSB7XG5cblx0XHRcdHRoaXMub3B0aW9ucy5oZWlnaHQgPSBpc05hTihoZWlnaHQpID8gaGVpZ2h0IDogaGVpZ2h0ICsgXCJweFwiO1xuXG5cdFx0XHR0aGlzLmVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gdGhpcy5vcHRpb25zLmhlaWdodDtcblxuXHRcdFx0dGhpcy5yb3dNYW5hZ2VyLnNldFJlbmRlck1vZGUoKTtcblxuXHRcdFx0dGhpcy5yb3dNYW5hZ2VyLnJlZHJhdygpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcInNldEhlaWdodCBmdW5jdGlvbiBpcyBub3QgYXZhaWxhYmxlIGluIGNsYXNzaWMgcmVuZGVyIG1vZGVcIik7XG5cdFx0fVxuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLyBTb3J0aW5nIC8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cblxuXHQvL3RyaWdnZXIgc29ydFxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuc2V0U29ydCA9IGZ1bmN0aW9uIChzb3J0TGlzdCwgZGlyKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJzb3J0XCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMubW9kdWxlcy5zb3J0LnNldFNvcnQoc29ydExpc3QsIGRpcik7XG5cblx0XHRcdHRoaXMucm93TWFuYWdlci5zb3J0ZXJSZWZyZXNoKCk7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZ2V0U29ydGVycyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcInNvcnRcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMubW9kdWxlcy5zb3J0LmdldFNvcnQoKTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5jbGVhclNvcnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJzb3J0XCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMubW9kdWxlcy5zb3J0LmNsZWFyKCk7XG5cblx0XHRcdHRoaXMucm93TWFuYWdlci5zb3J0ZXJSZWZyZXNoKCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLyBGaWx0ZXJpbmcgLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuXG5cdC8vc2V0IHN0YW5kYXJkIGZpbHRlcnNcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnNldEZpbHRlciA9IGZ1bmN0aW9uIChmaWVsZCwgdHlwZSwgdmFsdWUsIHBhcmFtcykge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiZmlsdGVyXCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMubW9kdWxlcy5maWx0ZXIuc2V0RmlsdGVyKGZpZWxkLCB0eXBlLCB2YWx1ZSwgcGFyYW1zKTtcblxuXHRcdFx0dGhpcy5yb3dNYW5hZ2VyLmZpbHRlclJlZnJlc2goKTtcblx0XHR9XG5cdH07XG5cblx0Ly9hZGQgZmlsdGVyIHRvIGFycmF5XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5hZGRGaWx0ZXIgPSBmdW5jdGlvbiAoZmllbGQsIHR5cGUsIHZhbHVlLCBwYXJhbXMpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImZpbHRlclwiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuZmlsdGVyLmFkZEZpbHRlcihmaWVsZCwgdHlwZSwgdmFsdWUsIHBhcmFtcyk7XG5cblx0XHRcdHRoaXMucm93TWFuYWdlci5maWx0ZXJSZWZyZXNoKCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vZ2V0IGFsbCBmaWx0ZXJzXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5nZXRGaWx0ZXJzID0gZnVuY3Rpb24gKGFsbCkge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiZmlsdGVyXCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLm1vZHVsZXMuZmlsdGVyLmdldEZpbHRlcnMoYWxsKTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5zZXRIZWFkZXJGaWx0ZXJGb2N1cyA9IGZ1bmN0aW9uIChmaWVsZCkge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiZmlsdGVyXCIsIHRydWUpKSB7XG5cblx0XHRcdHZhciBjb2x1bW4gPSB0aGlzLmNvbHVtbk1hbmFnZXIuZmluZENvbHVtbihmaWVsZCk7XG5cblx0XHRcdGlmIChjb2x1bW4pIHtcblxuXHRcdFx0XHR0aGlzLm1vZHVsZXMuZmlsdGVyLnNldEhlYWRlckZpbHRlckZvY3VzKGNvbHVtbik7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkNvbHVtbiBGaWx0ZXIgRm9jdXMgRXJyb3IgLSBObyBtYXRjaGluZyBjb2x1bW4gZm91bmQ6XCIsIGZpZWxkKTtcblxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZ2V0SGVhZGVyRmlsdGVyVmFsdWUgPSBmdW5jdGlvbiAoZmllbGQpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImZpbHRlclwiLCB0cnVlKSkge1xuXG5cdFx0XHR2YXIgY29sdW1uID0gdGhpcy5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW4oZmllbGQpO1xuXG5cdFx0XHRpZiAoY29sdW1uKSB7XG5cblx0XHRcdFx0cmV0dXJuIHRoaXMubW9kdWxlcy5maWx0ZXIuZ2V0SGVhZGVyRmlsdGVyVmFsdWUoY29sdW1uKTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0Y29uc29sZS53YXJuKFwiQ29sdW1uIEZpbHRlciBFcnJvciAtIE5vIG1hdGNoaW5nIGNvbHVtbiBmb3VuZDpcIiwgZmllbGQpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnNldEhlYWRlckZpbHRlclZhbHVlID0gZnVuY3Rpb24gKGZpZWxkLCB2YWx1ZSkge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiZmlsdGVyXCIsIHRydWUpKSB7XG5cblx0XHRcdHZhciBjb2x1bW4gPSB0aGlzLmNvbHVtbk1hbmFnZXIuZmluZENvbHVtbihmaWVsZCk7XG5cblx0XHRcdGlmIChjb2x1bW4pIHtcblxuXHRcdFx0XHR0aGlzLm1vZHVsZXMuZmlsdGVyLnNldEhlYWRlckZpbHRlclZhbHVlKGNvbHVtbiwgdmFsdWUpO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJDb2x1bW4gRmlsdGVyIEVycm9yIC0gTm8gbWF0Y2hpbmcgY29sdW1uIGZvdW5kOlwiLCBmaWVsZCk7XG5cblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldEhlYWRlckZpbHRlcnMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJmaWx0ZXJcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMubW9kdWxlcy5maWx0ZXIuZ2V0SGVhZGVyRmlsdGVycygpO1xuXHRcdH1cblx0fTtcblxuXHQvL3JlbW92ZSBmaWx0ZXIgZnJvbSBhcnJheVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVtb3ZlRmlsdGVyID0gZnVuY3Rpb24gKGZpZWxkLCB0eXBlLCB2YWx1ZSkge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiZmlsdGVyXCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMubW9kdWxlcy5maWx0ZXIucmVtb3ZlRmlsdGVyKGZpZWxkLCB0eXBlLCB2YWx1ZSk7XG5cblx0XHRcdHRoaXMucm93TWFuYWdlci5maWx0ZXJSZWZyZXNoKCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vY2xlYXIgZmlsdGVyc1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuY2xlYXJGaWx0ZXIgPSBmdW5jdGlvbiAoYWxsKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJmaWx0ZXJcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0dGhpcy5tb2R1bGVzLmZpbHRlci5jbGVhckZpbHRlcihhbGwpO1xuXG5cdFx0XHR0aGlzLnJvd01hbmFnZXIuZmlsdGVyUmVmcmVzaCgpO1xuXHRcdH1cblx0fTtcblxuXHQvL2NsZWFyIGhlYWRlciBmaWx0ZXJzXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5jbGVhckhlYWRlckZpbHRlciA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImZpbHRlclwiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuZmlsdGVyLmNsZWFySGVhZGVyRmlsdGVyKCk7XG5cblx0XHRcdHRoaXMucm93TWFuYWdlci5maWx0ZXJSZWZyZXNoKCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLyBzZWxlY3QgLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnNlbGVjdFJvdyA9IGZ1bmN0aW9uIChyb3dzKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJzZWxlY3RSb3dcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0aWYgKHJvd3MgPT09IHRydWUpIHtcblxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJwYXNzaW5nIGEgYm9vbGVhbiB0byB0aGUgc2VsZWN0Um93c2VsZWN0Um93IGZ1bmN0aW9uIGlzIGRlcHJlY2F0ZWQsIHlvdSBzaG91bGQgbm93IHBhc3MgdGhlIHN0cmluZyAnYWN0aXZlJ1wiKTtcblxuXHRcdFx0XHRyb3dzID0gXCJhY3RpdmVcIjtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5tb2R1bGVzLnNlbGVjdFJvdy5zZWxlY3RSb3dzKHJvd3MpO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmRlc2VsZWN0Um93ID0gZnVuY3Rpb24gKHJvd3MpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcInNlbGVjdFJvd1wiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuc2VsZWN0Um93LmRlc2VsZWN0Um93cyhyb3dzKTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS50b2dnbGVTZWxlY3RSb3cgPSBmdW5jdGlvbiAocm93KSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJzZWxlY3RSb3dcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0dGhpcy5tb2R1bGVzLnNlbGVjdFJvdy50b2dnbGVSb3cocm93KTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5nZXRTZWxlY3RlZFJvd3MgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJzZWxlY3RSb3dcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMubW9kdWxlcy5zZWxlY3RSb3cuZ2V0U2VsZWN0ZWRSb3dzKCk7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZ2V0U2VsZWN0ZWREYXRhID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwic2VsZWN0Um93XCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLm1vZHVsZXMuc2VsZWN0Um93LmdldFNlbGVjdGVkRGF0YSgpO1xuXHRcdH1cblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8gdmFsaWRhdGlvbiAgLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldEludmFsaWRDZWxscyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcInZhbGlkYXRlXCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLm1vZHVsZXMudmFsaWRhdGUuZ2V0SW52YWxpZENlbGxzKCk7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuY2xlYXJDZWxsVmFsaWRhdGlvbiA9IGZ1bmN0aW9uIChjZWxscykge1xuXHRcdHZhciBfdGhpczMxID0gdGhpcztcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcInZhbGlkYXRlXCIsIHRydWUpKSB7XG5cblx0XHRcdGlmICghY2VsbHMpIHtcblxuXHRcdFx0XHRjZWxscyA9IHRoaXMubW9kdWxlcy52YWxpZGF0ZS5nZXRJbnZhbGlkQ2VsbHMoKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFBcnJheS5pc0FycmF5KGNlbGxzKSkge1xuXG5cdFx0XHRcdGNlbGxzID0gW2NlbGxzXTtcblx0XHRcdH1cblxuXHRcdFx0Y2VsbHMuZm9yRWFjaChmdW5jdGlvbiAoY2VsbCkge1xuXG5cdFx0XHRcdF90aGlzMzEubW9kdWxlcy52YWxpZGF0ZS5jbGVhclZhbGlkYXRpb24oY2VsbC5fZ2V0U2VsZigpKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnZhbGlkYXRlID0gZnVuY3Rpb24gKGNlbGxzKSB7XG5cblx0XHR2YXIgb3V0cHV0ID0gW107XG5cblx0XHQvL2NsZWFyIHJvdyBkYXRhXG5cblx0XHR0aGlzLnJvd01hbmFnZXIucm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblxuXHRcdFx0dmFyIHZhbGlkID0gcm93LnZhbGlkYXRlKCk7XG5cblx0XHRcdGlmICh2YWxpZCAhPT0gdHJ1ZSkge1xuXG5cdFx0XHRcdG91dHB1dCA9IG91dHB1dC5jb25jYXQodmFsaWQpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG91dHB1dC5sZW5ndGggPyBvdXRwdXQgOiB0cnVlO1xuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLyBQYWdpbmF0aW9uIEZ1bmN0aW9ucyAgLy8vLy8vLy8vLy8vXG5cblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnNldE1heFBhZ2UgPSBmdW5jdGlvbiAobWF4KSB7XG5cblx0XHRpZiAodGhpcy5vcHRpb25zLnBhZ2luYXRpb24gJiYgdGhpcy5tb2RFeGlzdHMoXCJwYWdlXCIpKSB7XG5cblx0XHRcdHRoaXMubW9kdWxlcy5wYWdlLnNldE1heFBhZ2UobWF4KTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuc2V0UGFnZSA9IGZ1bmN0aW9uIChwYWdlKSB7XG5cblx0XHRpZiAodGhpcy5vcHRpb25zLnBhZ2luYXRpb24gJiYgdGhpcy5tb2RFeGlzdHMoXCJwYWdlXCIpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLm1vZHVsZXMucGFnZS5zZXRQYWdlKHBhZ2UpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0XHRcdHJlamVjdCgpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuc2V0UGFnZVRvUm93ID0gZnVuY3Rpb24gKHJvdykge1xuXHRcdHZhciBfdGhpczMyID0gdGhpcztcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cblx0XHRcdGlmIChfdGhpczMyLm9wdGlvbnMucGFnaW5hdGlvbiAmJiBfdGhpczMyLm1vZEV4aXN0cyhcInBhZ2VcIikpIHtcblxuXHRcdFx0XHRyb3cgPSBfdGhpczMyLnJvd01hbmFnZXIuZmluZFJvdyhyb3cpO1xuXG5cdFx0XHRcdGlmIChyb3cpIHtcblxuXHRcdFx0XHRcdF90aGlzMzIubW9kdWxlcy5wYWdlLnNldFBhZ2VUb1Jvdyhyb3cpLnRoZW4oZnVuY3Rpb24gKCkge1xuXG5cdFx0XHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKCkge1xuXG5cdFx0XHRcdFx0XHRyZWplY3QoKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdHJlamVjdCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdHJlamVjdCgpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuc2V0UGFnZVNpemUgPSBmdW5jdGlvbiAoc2l6ZSkge1xuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5wYWdpbmF0aW9uICYmIHRoaXMubW9kRXhpc3RzKFwicGFnZVwiKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMucGFnZS5zZXRQYWdlU2l6ZShzaXplKTtcblxuXHRcdFx0dGhpcy5tb2R1bGVzLnBhZ2Uuc2V0UGFnZSgxKS50aGVuKGZ1bmN0aW9uICgpIHt9KS5jYXRjaChmdW5jdGlvbiAoKSB7fSk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldFBhZ2VTaXplID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5wYWdpbmF0aW9uICYmIHRoaXMubW9kRXhpc3RzKFwicGFnZVwiLCB0cnVlKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5tb2R1bGVzLnBhZ2UuZ2V0UGFnZVNpemUoKTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5wcmV2aW91c1BhZ2UgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5vcHRpb25zLnBhZ2luYXRpb24gJiYgdGhpcy5tb2RFeGlzdHMoXCJwYWdlXCIpKSB7XG5cblx0XHRcdHRoaXMubW9kdWxlcy5wYWdlLnByZXZpb3VzUGFnZSgpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5uZXh0UGFnZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLm9wdGlvbnMucGFnaW5hdGlvbiAmJiB0aGlzLm1vZEV4aXN0cyhcInBhZ2VcIikpIHtcblxuXHRcdFx0dGhpcy5tb2R1bGVzLnBhZ2UubmV4dFBhZ2UoKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZ2V0UGFnZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLm9wdGlvbnMucGFnaW5hdGlvbiAmJiB0aGlzLm1vZEV4aXN0cyhcInBhZ2VcIikpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMubW9kdWxlcy5wYWdlLmdldFBhZ2UoKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZ2V0UGFnZU1heCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLm9wdGlvbnMucGFnaW5hdGlvbiAmJiB0aGlzLm1vZEV4aXN0cyhcInBhZ2VcIikpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMubW9kdWxlcy5wYWdlLmdldFBhZ2VNYXgoKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8vIEdyb3VwaW5nIEZ1bmN0aW9ucyAvLy8vLy8vLy8vLy8vLy9cblxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuc2V0R3JvdXBCeSA9IGZ1bmN0aW9uIChncm91cHMpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImdyb3VwUm93c1wiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLm9wdGlvbnMuZ3JvdXBCeSA9IGdyb3VwcztcblxuXHRcdFx0dGhpcy5tb2R1bGVzLmdyb3VwUm93cy5pbml0aWFsaXplKCk7XG5cblx0XHRcdHRoaXMucm93TWFuYWdlci5yZWZyZXNoQWN0aXZlRGF0YShcImRpc3BsYXlcIik7XG5cblx0XHRcdGlmICh0aGlzLm9wdGlvbnMucGVyc2lzdGVuY2UgJiYgdGhpcy5tb2RFeGlzdHMoXCJwZXJzaXN0ZW5jZVwiLCB0cnVlKSAmJiB0aGlzLm1vZHVsZXMucGVyc2lzdGVuY2UuY29uZmlnLmdyb3VwKSB7XG5cblx0XHRcdFx0dGhpcy5tb2R1bGVzLnBlcnNpc3RlbmNlLnNhdmUoXCJncm91cFwiKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuc2V0R3JvdXBTdGFydE9wZW4gPSBmdW5jdGlvbiAodmFsdWVzKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJncm91cFJvd3NcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0dGhpcy5vcHRpb25zLmdyb3VwU3RhcnRPcGVuID0gdmFsdWVzO1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuZ3JvdXBSb3dzLmluaXRpYWxpemUoKTtcblxuXHRcdFx0aWYgKHRoaXMub3B0aW9ucy5ncm91cEJ5KSB7XG5cblx0XHRcdFx0dGhpcy5yb3dNYW5hZ2VyLnJlZnJlc2hBY3RpdmVEYXRhKFwiZ3JvdXBcIik7XG5cblx0XHRcdFx0aWYgKHRoaXMub3B0aW9ucy5wZXJzaXN0ZW5jZSAmJiB0aGlzLm1vZEV4aXN0cyhcInBlcnNpc3RlbmNlXCIsIHRydWUpICYmIHRoaXMubW9kdWxlcy5wZXJzaXN0ZW5jZS5jb25maWcuZ3JvdXApIHtcblxuXHRcdFx0XHRcdHRoaXMubW9kdWxlcy5wZXJzaXN0ZW5jZS5zYXZlKFwiZ3JvdXBcIik7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0Y29uc29sZS53YXJuKFwiR3JvdXBpbmcgVXBkYXRlIC0gY2FudCByZWZyZXNoIHZpZXcsIG5vIGdyb3VwcyBoYXZlIGJlZW4gc2V0XCIpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5zZXRHcm91cEhlYWRlciA9IGZ1bmN0aW9uICh2YWx1ZXMpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImdyb3VwUm93c1wiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLm9wdGlvbnMuZ3JvdXBIZWFkZXIgPSB2YWx1ZXM7XG5cblx0XHRcdHRoaXMubW9kdWxlcy5ncm91cFJvd3MuaW5pdGlhbGl6ZSgpO1xuXG5cdFx0XHRpZiAodGhpcy5vcHRpb25zLmdyb3VwQnkpIHtcblxuXHRcdFx0XHR0aGlzLnJvd01hbmFnZXIucmVmcmVzaEFjdGl2ZURhdGEoXCJncm91cFwiKTtcblxuXHRcdFx0XHRpZiAodGhpcy5vcHRpb25zLnBlcnNpc3RlbmNlICYmIHRoaXMubW9kRXhpc3RzKFwicGVyc2lzdGVuY2VcIiwgdHJ1ZSkgJiYgdGhpcy5tb2R1bGVzLnBlcnNpc3RlbmNlLmNvbmZpZy5ncm91cCkge1xuXG5cdFx0XHRcdFx0dGhpcy5tb2R1bGVzLnBlcnNpc3RlbmNlLnNhdmUoXCJncm91cFwiKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJHcm91cGluZyBVcGRhdGUgLSBjYW50IHJlZnJlc2ggdmlldywgbm8gZ3JvdXBzIGhhdmUgYmVlbiBzZXRcIik7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldEdyb3VwcyA9IGZ1bmN0aW9uICh2YWx1ZXMpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImdyb3VwUm93c1wiLCB0cnVlKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5tb2R1bGVzLmdyb3VwUm93cy5nZXRHcm91cHModHJ1ZSk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fTtcblxuXHQvLyBnZXQgZ3JvdXBlZCB0YWJsZSBkYXRhIGluIHRoZSBzYW1lIGZvcm1hdCBhcyBnZXREYXRhKClcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldEdyb3VwZWREYXRhID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiZ3JvdXBSb3dzXCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLm9wdGlvbnMuZ3JvdXBCeSA/IHRoaXMubW9kdWxlcy5ncm91cFJvd3MuZ2V0R3JvdXBlZERhdGEoKSA6IHRoaXMuZ2V0RGF0YSgpO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldEVkaXRlZENlbGxzID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiZWRpdFwiLCB0cnVlKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5tb2R1bGVzLmVkaXQuZ2V0RWRpdGVkQ2VsbHMoKTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5jbGVhckNlbGxFZGl0ZWQgPSBmdW5jdGlvbiAoY2VsbHMpIHtcblx0XHR2YXIgX3RoaXMzMyA9IHRoaXM7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJlZGl0XCIsIHRydWUpKSB7XG5cblx0XHRcdGlmICghY2VsbHMpIHtcblxuXHRcdFx0XHRjZWxscyA9IHRoaXMubW9kdWxlcy5lZGl0LmdldEVkaXRlZENlbGxzKCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghQXJyYXkuaXNBcnJheShjZWxscykpIHtcblxuXHRcdFx0XHRjZWxscyA9IFtjZWxsc107XG5cdFx0XHR9XG5cblx0XHRcdGNlbGxzLmZvckVhY2goZnVuY3Rpb24gKGNlbGwpIHtcblxuXHRcdFx0XHRfdGhpczMzLm1vZHVsZXMuZWRpdC5jbGVhckVkaXRlZChjZWxsLl9nZXRTZWxmKCkpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8vIENvbHVtbiBDYWxjdWxhdGlvbiBGdW5jdGlvbnMgLy8vLy8vLy8vLy8vLy8vXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5nZXRDYWxjUmVzdWx0cyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLm1vZHVsZXMuY29sdW1uQ2FsY3MuZ2V0UmVzdWx0cygpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWNhbGMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuY29sdW1uQ2FsY3MucmVjYWxjQWxsKHRoaXMucm93TWFuYWdlci5hY3RpdmVSb3dzKTtcblx0XHR9XG5cdH07XG5cblx0Ly8vLy8vLy8vLy8vLy8vIE5hdmlnYXRpb24gTWFuYWdlbWVudCAvLy8vLy8vLy8vLy8vL1xuXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5uYXZpZ2F0ZVByZXYgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgY2VsbCA9IGZhbHNlO1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiZWRpdFwiLCB0cnVlKSkge1xuXG5cdFx0XHRjZWxsID0gdGhpcy5tb2R1bGVzLmVkaXQuY3VycmVudENlbGw7XG5cblx0XHRcdGlmIChjZWxsKSB7XG5cblx0XHRcdFx0cmV0dXJuIGNlbGwubmF2KCkucHJldigpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBmYWxzZTtcblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLm5hdmlnYXRlTmV4dCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBjZWxsID0gZmFsc2U7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJlZGl0XCIsIHRydWUpKSB7XG5cblx0XHRcdGNlbGwgPSB0aGlzLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbDtcblxuXHRcdFx0aWYgKGNlbGwpIHtcblxuXHRcdFx0XHRyZXR1cm4gY2VsbC5uYXYoKS5uZXh0KCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUubmF2aWdhdGVMZWZ0ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGNlbGwgPSBmYWxzZTtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImVkaXRcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0Y2VsbCA9IHRoaXMubW9kdWxlcy5lZGl0LmN1cnJlbnRDZWxsO1xuXG5cdFx0XHRpZiAoY2VsbCkge1xuXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0XHRyZXR1cm4gY2VsbC5uYXYoKS5sZWZ0KCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUubmF2aWdhdGVSaWdodCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBjZWxsID0gZmFsc2U7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJlZGl0XCIsIHRydWUpKSB7XG5cblx0XHRcdGNlbGwgPSB0aGlzLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbDtcblxuXHRcdFx0aWYgKGNlbGwpIHtcblxuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdFx0cmV0dXJuIGNlbGwubmF2KCkucmlnaHQoKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5uYXZpZ2F0ZVVwID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGNlbGwgPSBmYWxzZTtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImVkaXRcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0Y2VsbCA9IHRoaXMubW9kdWxlcy5lZGl0LmN1cnJlbnRDZWxsO1xuXG5cdFx0XHRpZiAoY2VsbCkge1xuXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0XHRyZXR1cm4gY2VsbC5uYXYoKS51cCgpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBmYWxzZTtcblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLm5hdmlnYXRlRG93biA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBjZWxsID0gZmFsc2U7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJlZGl0XCIsIHRydWUpKSB7XG5cblx0XHRcdGNlbGwgPSB0aGlzLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbDtcblxuXHRcdFx0aWYgKGNlbGwpIHtcblxuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdFx0cmV0dXJuIGNlbGwubmF2KCkuZG93bigpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBmYWxzZTtcblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8gSGlzdG9yeSBNYW5hZ2VtZW50IC8vLy8vLy8vLy8vLy8vXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS51bmRvID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5oaXN0b3J5ICYmIHRoaXMubW9kRXhpc3RzKFwiaGlzdG9yeVwiLCB0cnVlKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5tb2R1bGVzLmhpc3RvcnkudW5kbygpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWRvID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5oaXN0b3J5ICYmIHRoaXMubW9kRXhpc3RzKFwiaGlzdG9yeVwiLCB0cnVlKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5tb2R1bGVzLmhpc3RvcnkucmVkbygpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5nZXRIaXN0b3J5VW5kb1NpemUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5vcHRpb25zLmhpc3RvcnkgJiYgdGhpcy5tb2RFeGlzdHMoXCJoaXN0b3J5XCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLm1vZHVsZXMuaGlzdG9yeS5nZXRIaXN0b3J5VW5kb1NpemUoKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZ2V0SGlzdG9yeVJlZG9TaXplID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5oaXN0b3J5ICYmIHRoaXMubW9kRXhpc3RzKFwiaGlzdG9yeVwiLCB0cnVlKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5tb2R1bGVzLmhpc3RvcnkuZ2V0SGlzdG9yeVJlZG9TaXplKCk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8gRG93bmxvYWQgTWFuYWdlbWVudCAvLy8vLy8vLy8vLy8vL1xuXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5kb3dubG9hZCA9IGZ1bmN0aW9uICh0eXBlLCBmaWxlbmFtZSwgb3B0aW9ucywgYWN0aXZlKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJkb3dubG9hZFwiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuZG93bmxvYWQuZG93bmxvYWQodHlwZSwgZmlsZW5hbWUsIG9wdGlvbnMsIGFjdGl2ZSk7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZG93bmxvYWRUb1RhYiA9IGZ1bmN0aW9uICh0eXBlLCBmaWxlbmFtZSwgb3B0aW9ucywgYWN0aXZlKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJkb3dubG9hZFwiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuZG93bmxvYWQuZG93bmxvYWQodHlwZSwgZmlsZW5hbWUsIG9wdGlvbnMsIGFjdGl2ZSwgdHJ1ZSk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vLy8vLy8vLy8vIEludGVyIFRhYmxlIENvbW11bmljYXRpb25zIC8vLy8vLy8vLy8vXG5cblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnRhYmxlQ29tbXMgPSBmdW5jdGlvbiAodGFibGUsIG1vZHVsZSwgYWN0aW9uLCBkYXRhKSB7XG5cblx0XHR0aGlzLm1vZHVsZXMuY29tbXMucmVjZWl2ZSh0YWJsZSwgbW9kdWxlLCBhY3Rpb24sIGRhdGEpO1xuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vIEV4dGVuc2lvbiBNYW5hZ2VtZW50IC8vLy8vLy8vLy8vLy8vXG5cblxuXHQvL29iamVjdCB0byBob2xkIG1vZHVsZVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUubW9kdWxlQmluZGluZ3MgPSB7fTtcblxuXHQvL2V4dGVuZCBtb2R1bGVcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmV4dGVuZE1vZHVsZSA9IGZ1bmN0aW9uIChuYW1lLCBwcm9wZXJ0eSwgdmFsdWVzKSB7XG5cblx0XHRpZiAoVGFidWxhdG9yLnByb3RvdHlwZS5tb2R1bGVCaW5kaW5nc1tuYW1lXSkge1xuXG5cdFx0XHR2YXIgc291cmNlID0gVGFidWxhdG9yLnByb3RvdHlwZS5tb2R1bGVCaW5kaW5nc1tuYW1lXS5wcm90b3R5cGVbcHJvcGVydHldO1xuXG5cdFx0XHRpZiAoc291cmNlKSB7XG5cblx0XHRcdFx0aWYgKCh0eXBlb2YgdmFsdWVzID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZih2YWx1ZXMpKSA9PSBcIm9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHRmb3IgKHZhciBrZXkgaW4gdmFsdWVzKSB7XG5cblx0XHRcdFx0XHRcdHNvdXJjZVtrZXldID0gdmFsdWVzW2tleV07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiTW9kdWxlIEVycm9yIC0gSW52YWxpZCB2YWx1ZSB0eXBlLCBpdCBtdXN0IGJlIGFuIG9iamVjdFwiKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJNb2R1bGUgRXJyb3IgLSBwcm9wZXJ0eSBkb2VzIG5vdCBleGlzdDpcIiwgcHJvcGVydHkpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcIk1vZHVsZSBFcnJvciAtIG1vZHVsZSBkb2VzIG5vdCBleGlzdDpcIiwgbmFtZSk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vYWRkIG1vZHVsZSB0byB0YWJ1bGF0b3JcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnJlZ2lzdGVyTW9kdWxlID0gZnVuY3Rpb24gKG5hbWUsIG1vZHVsZSkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0VGFidWxhdG9yLnByb3RvdHlwZS5tb2R1bGVCaW5kaW5nc1tuYW1lXSA9IG1vZHVsZTtcblx0fTtcblxuXHQvL2Vuc3VyZSB0aGF0IG1vZHVsZSBhcmUgYm91bmQgdG8gaW5zdGFudGlhdGVkIGZ1bmN0aW9uXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5iaW5kTW9kdWxlcyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMubW9kdWxlcyA9IHt9O1xuXG5cdFx0Zm9yICh2YXIgbmFtZSBpbiBUYWJ1bGF0b3IucHJvdG90eXBlLm1vZHVsZUJpbmRpbmdzKSB7XG5cblx0XHRcdHRoaXMubW9kdWxlc1tuYW1lXSA9IG5ldyBUYWJ1bGF0b3IucHJvdG90eXBlLm1vZHVsZUJpbmRpbmdzW25hbWVdKHRoaXMpO1xuXHRcdH1cblx0fTtcblxuXHQvL0NoZWNrIGZvciBtb2R1bGVcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLm1vZEV4aXN0cyA9IGZ1bmN0aW9uIChwbHVnaW4sIHJlcXVpcmVkKSB7XG5cblx0XHRpZiAodGhpcy5tb2R1bGVzW3BsdWdpbl0pIHtcblxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKHJlcXVpcmVkKSB7XG5cblx0XHRcdFx0Y29uc29sZS5lcnJvcihcIlRhYnVsYXRvciBNb2R1bGUgTm90IEluc3RhbGxlZDogXCIgKyBwbHVnaW4pO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuaGVscGVycyA9IHtcblxuXHRcdGVsVmlzaWJsZTogZnVuY3Rpb24gZWxWaXNpYmxlKGVsKSB7XG5cblx0XHRcdHJldHVybiAhKGVsLm9mZnNldFdpZHRoIDw9IDAgJiYgZWwub2Zmc2V0SGVpZ2h0IDw9IDApO1xuXHRcdH0sXG5cblx0XHRlbE9mZnNldDogZnVuY3Rpb24gZWxPZmZzZXQoZWwpIHtcblxuXHRcdFx0dmFyIGJveCA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG5cdFx0XHRyZXR1cm4ge1xuXG5cdFx0XHRcdHRvcDogYm94LnRvcCArIHdpbmRvdy5wYWdlWU9mZnNldCAtIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRUb3AsXG5cblx0XHRcdFx0bGVmdDogYm94LmxlZnQgKyB3aW5kb3cucGFnZVhPZmZzZXQgLSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50TGVmdFxuXG5cdFx0XHR9O1xuXHRcdH0sXG5cblx0XHRkZWVwQ2xvbmU6IGZ1bmN0aW9uIGRlZXBDbG9uZShvYmopIHtcblxuXHRcdFx0dmFyIGNsb25lID0gQXJyYXkuaXNBcnJheShvYmopID8gW10gOiB7fTtcblxuXHRcdFx0Zm9yICh2YXIgaSBpbiBvYmopIHtcblxuXHRcdFx0XHRpZiAob2JqW2ldICE9IG51bGwgJiYgX3R5cGVvZihvYmpbaV0pID09PSBcIm9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHRpZiAob2JqW2ldIGluc3RhbmNlb2YgRGF0ZSkge1xuXG5cdFx0XHRcdFx0XHRjbG9uZVtpXSA9IG5ldyBEYXRlKG9ialtpXSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0Y2xvbmVbaV0gPSB0aGlzLmRlZXBDbG9uZShvYmpbaV0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdGNsb25lW2ldID0gb2JqW2ldO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBjbG9uZTtcblx0XHR9XG5cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmNvbW1zID0ge1xuXG5cdFx0dGFibGVzOiBbXSxcblxuXHRcdHJlZ2lzdGVyOiBmdW5jdGlvbiByZWdpc3Rlcih0YWJsZSkge1xuXG5cdFx0XHRUYWJ1bGF0b3IucHJvdG90eXBlLmNvbW1zLnRhYmxlcy5wdXNoKHRhYmxlKTtcblx0XHR9LFxuXG5cdFx0ZGVyZWdpc3RlcjogZnVuY3Rpb24gZGVyZWdpc3Rlcih0YWJsZSkge1xuXG5cdFx0XHR2YXIgaW5kZXggPSBUYWJ1bGF0b3IucHJvdG90eXBlLmNvbW1zLnRhYmxlcy5pbmRleE9mKHRhYmxlKTtcblxuXHRcdFx0aWYgKGluZGV4ID4gLTEpIHtcblxuXHRcdFx0XHRUYWJ1bGF0b3IucHJvdG90eXBlLmNvbW1zLnRhYmxlcy5zcGxpY2UoaW5kZXgsIDEpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRsb29rdXBUYWJsZTogZnVuY3Rpb24gbG9va3VwVGFibGUocXVlcnksIHNpbGVudCkge1xuXG5cdFx0XHR2YXIgcmVzdWx0cyA9IFtdLFxuXHRcdFx0ICAgIG1hdGNoZXMsXG5cdFx0XHQgICAgbWF0Y2g7XG5cblx0XHRcdGlmICh0eXBlb2YgcXVlcnkgPT09IFwic3RyaW5nXCIpIHtcblxuXHRcdFx0XHRtYXRjaGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChxdWVyeSk7XG5cblx0XHRcdFx0aWYgKG1hdGNoZXMubGVuZ3RoKSB7XG5cblx0XHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IG1hdGNoZXMubGVuZ3RoOyBpKyspIHtcblxuXHRcdFx0XHRcdFx0bWF0Y2ggPSBUYWJ1bGF0b3IucHJvdG90eXBlLmNvbW1zLm1hdGNoRWxlbWVudChtYXRjaGVzW2ldKTtcblxuXHRcdFx0XHRcdFx0aWYgKG1hdGNoKSB7XG5cblx0XHRcdFx0XHRcdFx0cmVzdWx0cy5wdXNoKG1hdGNoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mIEhUTUxFbGVtZW50ICE9PSBcInVuZGVmaW5lZFwiICYmIHF1ZXJ5IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgfHwgcXVlcnkgaW5zdGFuY2VvZiBUYWJ1bGF0b3IpIHtcblxuXHRcdFx0XHRtYXRjaCA9IFRhYnVsYXRvci5wcm90b3R5cGUuY29tbXMubWF0Y2hFbGVtZW50KHF1ZXJ5KTtcblxuXHRcdFx0XHRpZiAobWF0Y2gpIHtcblxuXHRcdFx0XHRcdHJlc3VsdHMucHVzaChtYXRjaCk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShxdWVyeSkpIHtcblxuXHRcdFx0XHRxdWVyeS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cblx0XHRcdFx0XHRyZXN1bHRzID0gcmVzdWx0cy5jb25jYXQoVGFidWxhdG9yLnByb3RvdHlwZS5jb21tcy5sb29rdXBUYWJsZShpdGVtKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRpZiAoIXNpbGVudCkge1xuXG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiVGFibGUgQ29ubmVjdGlvbiBFcnJvciAtIEludmFsaWQgU2VsZWN0b3JcIiwgcXVlcnkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiByZXN1bHRzO1xuXHRcdH0sXG5cblx0XHRtYXRjaEVsZW1lbnQ6IGZ1bmN0aW9uIG1hdGNoRWxlbWVudChlbGVtZW50KSB7XG5cblx0XHRcdHJldHVybiBUYWJ1bGF0b3IucHJvdG90eXBlLmNvbW1zLnRhYmxlcy5maW5kKGZ1bmN0aW9uICh0YWJsZSkge1xuXG5cdFx0XHRcdHJldHVybiBlbGVtZW50IGluc3RhbmNlb2YgVGFidWxhdG9yID8gdGFibGUgPT09IGVsZW1lbnQgOiB0YWJsZS5lbGVtZW50ID09PSBlbGVtZW50O1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5maW5kVGFibGUgPSBmdW5jdGlvbiAocXVlcnkpIHtcblxuXHRcdHZhciByZXN1bHRzID0gVGFidWxhdG9yLnByb3RvdHlwZS5jb21tcy5sb29rdXBUYWJsZShxdWVyeSwgdHJ1ZSk7XG5cblx0XHRyZXR1cm4gQXJyYXkuaXNBcnJheShyZXN1bHRzKSAmJiAhcmVzdWx0cy5sZW5ndGggPyBmYWxzZSA6IHJlc3VsdHM7XG5cdH07XG5cblx0dmFyIExheW91dCA9IGZ1bmN0aW9uIExheW91dCh0YWJsZSkge1xuXG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlO1xuXG5cdFx0dGhpcy5tb2RlID0gbnVsbDtcblx0fTtcblxuXHQvL2luaXRpYWxpemUgbGF5b3V0IHN5c3RlbVxuXG5cblx0TGF5b3V0LnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKGxheW91dCkge1xuXG5cdFx0aWYgKHRoaXMubW9kZXNbbGF5b3V0XSkge1xuXG5cdFx0XHR0aGlzLm1vZGUgPSBsYXlvdXQ7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0Y29uc29sZS53YXJuKFwiTGF5b3V0IEVycm9yIC0gaW52YWxpZCBtb2RlIHNldCwgZGVmYXVsdGluZyB0byAnZml0RGF0YScgOiBcIiArIGxheW91dCk7XG5cblx0XHRcdHRoaXMubW9kZSA9ICdmaXREYXRhJztcblx0XHR9XG5cblx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuc2V0QXR0cmlidXRlKFwidGFidWxhdG9yLWxheW91dFwiLCB0aGlzLm1vZGUpO1xuXHR9O1xuXG5cdExheW91dC5wcm90b3R5cGUuZ2V0TW9kZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLm1vZGU7XG5cdH07XG5cblx0Ly90cmlnZ2VyIHRhYmxlIGxheW91dFxuXG5cblx0TGF5b3V0LnByb3RvdHlwZS5sYXlvdXQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLm1vZGVzW3RoaXMubW9kZV0uY2FsbCh0aGlzLCB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuY29sdW1uc0J5SW5kZXgpO1xuXHR9O1xuXG5cdC8vbGF5b3V0IHJlbmRlciBmdW5jdGlvbnNcblxuXG5cdExheW91dC5wcm90b3R5cGUubW9kZXMgPSB7XG5cblx0XHQvL3Jlc2l6ZSBjb2x1bW5zIHRvIGZpdCBkYXRhIHRoZXkgY29udGFpblxuXG5cblx0XHRcImZpdERhdGFcIjogZnVuY3Rpb24gZml0RGF0YShjb2x1bW5zKSB7XG5cblx0XHRcdGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdFx0Y29sdW1uLnJlaW5pdGlhbGl6ZVdpZHRoKCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5yZXNwb25zaXZlTGF5b3V0ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwicmVzcG9uc2l2ZUxheW91dFwiLCB0cnVlKSkge1xuXG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5yZXNwb25zaXZlTGF5b3V0LnVwZGF0ZSgpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvL3Jlc2l6ZSBjb2x1bW5zIHRvIGZpdCBkYXRhIHRoZXkgY29udGFpbiBhbmQgc3RyZXRjaCByb3cgdG8gZmlsbCB0YWJsZVxuXG5cblx0XHRcImZpdERhdGFGaWxsXCI6IGZ1bmN0aW9uIGZpdERhdGFGaWxsKGNvbHVtbnMpIHtcblxuXHRcdFx0Y29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0XHRjb2x1bW4ucmVpbml0aWFsaXplV2lkdGgoKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXQgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJyZXNwb25zaXZlTGF5b3V0XCIsIHRydWUpKSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQudXBkYXRlKCk7XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdC8vcmVzaXplIGNvbHVtbnMgdG8gZml0IGRhdGEgdGhleSBjb250YWluXG5cblxuXHRcdFwiZml0RGF0YVRhYmxlXCI6IGZ1bmN0aW9uIGZpdERhdGFUYWJsZShjb2x1bW5zKSB7XG5cblx0XHRcdGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdFx0Y29sdW1uLnJlaW5pdGlhbGl6ZVdpZHRoKCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5yZXNwb25zaXZlTGF5b3V0ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwicmVzcG9uc2l2ZUxheW91dFwiLCB0cnVlKSkge1xuXG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5yZXNwb25zaXZlTGF5b3V0LnVwZGF0ZSgpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvL3Jlc2l6ZSBjb2x1bW5zIHRvIGZpdCBkYXRhIHRoZSBjb250YWluIGFuZCBzdHJldGNoIGxhc3QgY29sdW1uIHRvIGZpbGwgdGFibGVcblxuXG5cdFx0XCJmaXREYXRhU3RyZXRjaFwiOiBmdW5jdGlvbiBmaXREYXRhU3RyZXRjaChjb2x1bW5zKSB7XG5cdFx0XHR2YXIgX3RoaXMzNCA9IHRoaXM7XG5cblx0XHRcdHZhciBjb2xzV2lkdGggPSAwLFxuXHRcdFx0ICAgIHRhYmxlV2lkdGggPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5jbGllbnRXaWR0aCxcblx0XHRcdCAgICBnYXAgPSAwLFxuXHRcdFx0ICAgIGxhc3RDb2wgPSBmYWxzZTtcblxuXHRcdFx0Y29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4sIGkpIHtcblxuXHRcdFx0XHRpZiAoIWNvbHVtbi53aWR0aEZpeGVkKSB7XG5cblx0XHRcdFx0XHRjb2x1bW4ucmVpbml0aWFsaXplV2lkdGgoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChfdGhpczM0LnRhYmxlLm9wdGlvbnMucmVzcG9uc2l2ZUxheW91dCA/IGNvbHVtbi5tb2R1bGVzLnJlc3BvbnNpdmUudmlzaWJsZSA6IGNvbHVtbi52aXNpYmxlKSB7XG5cblx0XHRcdFx0XHRsYXN0Q29sID0gY29sdW1uO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGNvbHVtbi52aXNpYmxlKSB7XG5cblx0XHRcdFx0XHRjb2xzV2lkdGggKz0gY29sdW1uLmdldFdpZHRoKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRpZiAobGFzdENvbCkge1xuXG5cdFx0XHRcdGdhcCA9IHRhYmxlV2lkdGggLSBjb2xzV2lkdGggKyBsYXN0Q29sLmdldFdpZHRoKCk7XG5cblx0XHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5yZXNwb25zaXZlTGF5b3V0ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwicmVzcG9uc2l2ZUxheW91dFwiLCB0cnVlKSkge1xuXG5cdFx0XHRcdFx0bGFzdENvbC5zZXRXaWR0aCgwKTtcblxuXHRcdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5yZXNwb25zaXZlTGF5b3V0LnVwZGF0ZSgpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGdhcCA+IDApIHtcblxuXHRcdFx0XHRcdGxhc3RDb2wuc2V0V2lkdGgoZ2FwKTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdGxhc3RDb2wucmVpbml0aWFsaXplV2lkdGgoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXQgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJyZXNwb25zaXZlTGF5b3V0XCIsIHRydWUpKSB7XG5cblx0XHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMucmVzcG9uc2l2ZUxheW91dC51cGRhdGUoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvL3Jlc2l6ZSBjb2x1bW5zIHRvIGZpdFxuXG5cblx0XHRcImZpdENvbHVtbnNcIjogZnVuY3Rpb24gZml0Q29sdW1ucyhjb2x1bW5zKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0dmFyIHRvdGFsV2lkdGggPSBzZWxmLnRhYmxlLmVsZW1lbnQuY2xpZW50V2lkdGg7IC8vdGFibGUgZWxlbWVudCB3aWR0aFxuXG5cblx0XHRcdHZhciBmaXhlZFdpZHRoID0gMDsgLy90b3RhbCB3aWR0aCBvZiBjb2x1bW5zIHdpdGggYSBkZWZpbmVkIHdpZHRoXG5cblxuXHRcdFx0dmFyIGZsZXhXaWR0aCA9IDA7IC8vdG90YWwgd2lkdGggYXZhaWxhYmxlIHRvIGZsZXhpYmxlIGNvbHVtbnNcblxuXG5cdFx0XHR2YXIgZmxleEdyb3dVbml0cyA9IDA7IC8vdG90YWwgbnVtYmVyIG9mIHdpZHRoR3JvdyBibG9ja3MgYWNjcm9zcyBhbGwgY29sdW1uc1xuXG5cblx0XHRcdHZhciBmbGV4Q29sV2lkdGggPSAwOyAvL2Rlc2lyZWQgd2lkdGggb2YgZmxleGlibGUgY29sdW1uc1xuXG5cblx0XHRcdHZhciBmbGV4Q29sdW1ucyA9IFtdOyAvL2FycmF5IG9mIGZsZXhpYmxlIHdpZHRoIGNvbHVtbnNcblxuXG5cdFx0XHR2YXIgZml4ZWRTaHJpbmtDb2x1bW5zID0gW107IC8vYXJyYXkgb2YgZml4ZWQgd2lkdGggY29sdW1ucyB0aGF0IGNhbiBzaHJpbmtcblxuXG5cdFx0XHR2YXIgZmxleFNocmlua1VuaXRzID0gMDsgLy90b3RhbCBudW1iZXIgb2Ygd2lkdGhTaHJpbmsgYmxvY2tzIGFjY3Jvc3MgYWxsIGNvbHVtbnNcblxuXG5cdFx0XHR2YXIgb3ZlcmZsb3dXaWR0aCA9IDA7IC8vaG9yaXpvbnRhbCBvdmVyZmxvdyB3aWR0aFxuXG5cblx0XHRcdHZhciBnYXBGaWxsID0gMDsgLy9udW1iZXIgb2YgcGl4ZWxzIHRvIGJlIGFkZGVkIHRvIGZpbmFsIGNvbHVtbiB0byBjbG9zZSBhbmQgaGFsZiBwaXhlbCBnYXBzXG5cblxuXHRcdFx0ZnVuY3Rpb24gY2FsY1dpZHRoKHdpZHRoKSB7XG5cblx0XHRcdFx0dmFyIGNvbFdpZHRoO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Ygd2lkdGggPT0gXCJzdHJpbmdcIikge1xuXG5cdFx0XHRcdFx0aWYgKHdpZHRoLmluZGV4T2YoXCIlXCIpID4gLTEpIHtcblxuXHRcdFx0XHRcdFx0Y29sV2lkdGggPSB0b3RhbFdpZHRoIC8gMTAwICogcGFyc2VJbnQod2lkdGgpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdGNvbFdpZHRoID0gcGFyc2VJbnQod2lkdGgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdGNvbFdpZHRoID0gd2lkdGg7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gY29sV2lkdGg7XG5cdFx0XHR9XG5cblx0XHRcdC8vZW5zdXJlIGNvbHVtbnMgcmVzaXplIHRvIHRha2UgdXAgdGhlIGNvcnJlY3QgYW1vdW50IG9mIHNwYWNlXG5cblxuXHRcdFx0ZnVuY3Rpb24gc2NhbGVDb2x1bW5zKGNvbHVtbnMsIGZyZWVTcGFjZSwgY29sV2lkdGgsIHNocmlua0NvbHMpIHtcblxuXHRcdFx0XHR2YXIgb3ZlcnNpemVDb2xzID0gW10sXG5cdFx0XHRcdCAgICBvdmVyc2l6ZVNwYWNlID0gMCxcblx0XHRcdFx0ICAgIHJlbWFpbmluZ1NwYWNlID0gMCxcblx0XHRcdFx0ICAgIG5leHRDb2xXaWR0aCA9IDAsXG5cdFx0XHRcdCAgICBnYXAgPSAwLFxuXHRcdFx0XHQgICAgY2hhbmdlVW5pdHMgPSAwLFxuXHRcdFx0XHQgICAgdW5kZXJzaXplQ29scyA9IFtdO1xuXG5cdFx0XHRcdGZ1bmN0aW9uIGNhbGNHcm93KGNvbCkge1xuXG5cdFx0XHRcdFx0cmV0dXJuIGNvbFdpZHRoICogKGNvbC5jb2x1bW4uZGVmaW5pdGlvbi53aWR0aEdyb3cgfHwgMSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmdW5jdGlvbiBjYWxjU2hyaW5rKGNvbCkge1xuXG5cdFx0XHRcdFx0cmV0dXJuIGNhbGNXaWR0aChjb2wud2lkdGgpIC0gY29sV2lkdGggKiAoY29sLmNvbHVtbi5kZWZpbml0aW9uLndpZHRoU2hyaW5rIHx8IDApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2wsIGkpIHtcblxuXHRcdFx0XHRcdHZhciB3aWR0aCA9IHNocmlua0NvbHMgPyBjYWxjU2hyaW5rKGNvbCkgOiBjYWxjR3Jvdyhjb2wpO1xuXG5cdFx0XHRcdFx0aWYgKGNvbC5jb2x1bW4ubWluV2lkdGggPj0gd2lkdGgpIHtcblxuXHRcdFx0XHRcdFx0b3ZlcnNpemVDb2xzLnB1c2goY29sKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHR1bmRlcnNpemVDb2xzLnB1c2goY29sKTtcblxuXHRcdFx0XHRcdFx0Y2hhbmdlVW5pdHMgKz0gc2hyaW5rQ29scyA/IGNvbC5jb2x1bW4uZGVmaW5pdGlvbi53aWR0aFNocmluayB8fCAxIDogY29sLmNvbHVtbi5kZWZpbml0aW9uLndpZHRoR3JvdyB8fCAxO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0aWYgKG92ZXJzaXplQ29scy5sZW5ndGgpIHtcblxuXHRcdFx0XHRcdG92ZXJzaXplQ29scy5mb3JFYWNoKGZ1bmN0aW9uIChjb2wpIHtcblxuXHRcdFx0XHRcdFx0b3ZlcnNpemVTcGFjZSArPSBzaHJpbmtDb2xzID8gY29sLndpZHRoIC0gY29sLmNvbHVtbi5taW5XaWR0aCA6IGNvbC5jb2x1bW4ubWluV2lkdGg7XG5cblx0XHRcdFx0XHRcdGNvbC53aWR0aCA9IGNvbC5jb2x1bW4ubWluV2lkdGg7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRyZW1haW5pbmdTcGFjZSA9IGZyZWVTcGFjZSAtIG92ZXJzaXplU3BhY2U7XG5cblx0XHRcdFx0XHRuZXh0Q29sV2lkdGggPSBjaGFuZ2VVbml0cyA/IE1hdGguZmxvb3IocmVtYWluaW5nU3BhY2UgLyBjaGFuZ2VVbml0cykgOiByZW1haW5pbmdTcGFjZTtcblxuXHRcdFx0XHRcdGdhcCA9IHJlbWFpbmluZ1NwYWNlIC0gbmV4dENvbFdpZHRoICogY2hhbmdlVW5pdHM7XG5cblx0XHRcdFx0XHRnYXAgKz0gc2NhbGVDb2x1bW5zKHVuZGVyc2l6ZUNvbHMsIHJlbWFpbmluZ1NwYWNlLCBuZXh0Q29sV2lkdGgsIHNocmlua0NvbHMpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0Z2FwID0gY2hhbmdlVW5pdHMgPyBmcmVlU3BhY2UgLSBNYXRoLmZsb29yKGZyZWVTcGFjZSAvIGNoYW5nZVVuaXRzKSAqIGNoYW5nZVVuaXRzIDogZnJlZVNwYWNlO1xuXG5cdFx0XHRcdFx0dW5kZXJzaXplQ29scy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0XHRcdFx0Y29sdW1uLndpZHRoID0gc2hyaW5rQ29scyA/IGNhbGNTaHJpbmsoY29sdW1uKSA6IGNhbGNHcm93KGNvbHVtbik7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gZ2FwO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXQgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJyZXNwb25zaXZlTGF5b3V0XCIsIHRydWUpKSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQudXBkYXRlKCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vYWRqdXN0IGZvciB2ZXJ0aWNhbCBzY3JvbGxiYXIgaWYgcHJlc2VudFxuXG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxIZWlnaHQgPiB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5jbGllbnRIZWlnaHQpIHtcblxuXHRcdFx0XHR0b3RhbFdpZHRoIC09IHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50Lm9mZnNldFdpZHRoIC0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQuY2xpZW50V2lkdGg7XG5cdFx0XHR9XG5cblx0XHRcdGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdFx0dmFyIHdpZHRoLCBtaW5XaWR0aCwgY29sV2lkdGg7XG5cblx0XHRcdFx0aWYgKGNvbHVtbi52aXNpYmxlKSB7XG5cblx0XHRcdFx0XHR3aWR0aCA9IGNvbHVtbi5kZWZpbml0aW9uLndpZHRoO1xuXG5cdFx0XHRcdFx0bWluV2lkdGggPSBwYXJzZUludChjb2x1bW4ubWluV2lkdGgpO1xuXG5cdFx0XHRcdFx0aWYgKHdpZHRoKSB7XG5cblx0XHRcdFx0XHRcdGNvbFdpZHRoID0gY2FsY1dpZHRoKHdpZHRoKTtcblxuXHRcdFx0XHRcdFx0Zml4ZWRXaWR0aCArPSBjb2xXaWR0aCA+IG1pbldpZHRoID8gY29sV2lkdGggOiBtaW5XaWR0aDtcblxuXHRcdFx0XHRcdFx0aWYgKGNvbHVtbi5kZWZpbml0aW9uLndpZHRoU2hyaW5rKSB7XG5cblx0XHRcdFx0XHRcdFx0Zml4ZWRTaHJpbmtDb2x1bW5zLnB1c2goe1xuXG5cdFx0XHRcdFx0XHRcdFx0Y29sdW1uOiBjb2x1bW4sXG5cblx0XHRcdFx0XHRcdFx0XHR3aWR0aDogY29sV2lkdGggPiBtaW5XaWR0aCA/IGNvbFdpZHRoIDogbWluV2lkdGhcblxuXHRcdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0XHRmbGV4U2hyaW5rVW5pdHMgKz0gY29sdW1uLmRlZmluaXRpb24ud2lkdGhTaHJpbms7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0ZmxleENvbHVtbnMucHVzaCh7XG5cblx0XHRcdFx0XHRcdFx0Y29sdW1uOiBjb2x1bW4sXG5cblx0XHRcdFx0XHRcdFx0d2lkdGg6IDBcblxuXHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdGZsZXhHcm93VW5pdHMgKz0gY29sdW1uLmRlZmluaXRpb24ud2lkdGhHcm93IHx8IDE7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0Ly9jYWxjdWxhdGUgYXZhaWxhYmxlIHNwYWNlXG5cblxuXHRcdFx0ZmxleFdpZHRoID0gdG90YWxXaWR0aCAtIGZpeGVkV2lkdGg7XG5cblx0XHRcdC8vY2FsY3VsYXRlIGNvcnJlY3QgY29sdW1uIHNpemVcblxuXG5cdFx0XHRmbGV4Q29sV2lkdGggPSBNYXRoLmZsb29yKGZsZXhXaWR0aCAvIGZsZXhHcm93VW5pdHMpO1xuXG5cdFx0XHQvL2dlbmVyYXRlIGNvbHVtbiB3aWR0aHNcblxuXG5cdFx0XHR2YXIgZ2FwRmlsbCA9IHNjYWxlQ29sdW1ucyhmbGV4Q29sdW1ucywgZmxleFdpZHRoLCBmbGV4Q29sV2lkdGgsIGZhbHNlKTtcblxuXHRcdFx0Ly9pbmNyZWFzZSB3aWR0aCBvZiBsYXN0IGNvbHVtbiB0byBhY2NvdW50IGZvciByb3VuZGluZyBlcnJvcnNcblxuXG5cdFx0XHRpZiAoZmxleENvbHVtbnMubGVuZ3RoICYmIGdhcEZpbGwgPiAwKSB7XG5cblx0XHRcdFx0ZmxleENvbHVtbnNbZmxleENvbHVtbnMubGVuZ3RoIC0gMV0ud2lkdGggKz0gK2dhcEZpbGw7XG5cdFx0XHR9XG5cblx0XHRcdC8vY2FjdWxhdGUgc3BhY2UgZm9yIGNvbHVtbnMgdG8gYmUgc2hydW5rIGludG9cblxuXG5cdFx0XHRmbGV4Q29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2wpIHtcblxuXHRcdFx0XHRmbGV4V2lkdGggLT0gY29sLndpZHRoO1xuXHRcdFx0fSk7XG5cblx0XHRcdG92ZXJmbG93V2lkdGggPSBNYXRoLmFicyhnYXBGaWxsKSArIGZsZXhXaWR0aDtcblxuXHRcdFx0Ly9zaHJpbmsgb3ZlcnNpemUgY29sdW1ucyBpZiB0aGVyZSBpcyBubyBhdmFpbGFibGUgc3BhY2VcblxuXG5cdFx0XHRpZiAob3ZlcmZsb3dXaWR0aCA+IDAgJiYgZmxleFNocmlua1VuaXRzKSB7XG5cblx0XHRcdFx0Z2FwRmlsbCA9IHNjYWxlQ29sdW1ucyhmaXhlZFNocmlua0NvbHVtbnMsIG92ZXJmbG93V2lkdGgsIE1hdGguZmxvb3Iob3ZlcmZsb3dXaWR0aCAvIGZsZXhTaHJpbmtVbml0cyksIHRydWUpO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2RlY3JlYXNlIHdpZHRoIG9mIGxhc3QgY29sdW1uIHRvIGFjY291bnQgZm9yIHJvdW5kaW5nIGVycm9yc1xuXG5cblx0XHRcdGlmIChmaXhlZFNocmlua0NvbHVtbnMubGVuZ3RoKSB7XG5cblx0XHRcdFx0Zml4ZWRTaHJpbmtDb2x1bW5zW2ZpeGVkU2hyaW5rQ29sdW1ucy5sZW5ndGggLSAxXS53aWR0aCAtPSBnYXBGaWxsO1xuXHRcdFx0fVxuXG5cdFx0XHRmbGV4Q29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2wpIHtcblxuXHRcdFx0XHRjb2wuY29sdW1uLnNldFdpZHRoKGNvbC53aWR0aCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0Zml4ZWRTaHJpbmtDb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbCkge1xuXG5cdFx0XHRcdGNvbC5jb2x1bW4uc2V0V2lkdGgoY29sLndpZHRoKTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJsYXlvdXRcIiwgTGF5b3V0KTtcblxuXHR2YXIgTG9jYWxpemUgPSBmdW5jdGlvbiBMb2NhbGl6ZSh0YWJsZSkge1xuXG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlOyAvL2hvbGQgVGFidWxhdG9yIG9iamVjdFxuXG5cdFx0dGhpcy5sb2NhbGUgPSBcImRlZmF1bHRcIjsgLy9jdXJyZW50IGxvY2FsZVxuXG5cdFx0dGhpcy5sYW5nID0gZmFsc2U7IC8vY3VycmVudCBsYW5ndWFnZVxuXG5cdFx0dGhpcy5iaW5kaW5ncyA9IHt9OyAvL3VwZGF0ZSBldmVudHMgdG8gY2FsbCB3aGVuIGxvY2FsZSBpcyBjaGFuZ2VkXG5cdH07XG5cblx0Ly9zZXQgaGVhZGVyIHBsYWNlaG9kZXJcblxuXHRMb2NhbGl6ZS5wcm90b3R5cGUuc2V0SGVhZGVyRmlsdGVyUGxhY2Vob2xkZXIgPSBmdW5jdGlvbiAocGxhY2Vob2xkZXIpIHtcblxuXHRcdHRoaXMubGFuZ3MuZGVmYXVsdC5oZWFkZXJGaWx0ZXJzLmRlZmF1bHQgPSBwbGFjZWhvbGRlcjtcblx0fTtcblxuXHQvL3NldCBoZWFkZXIgZmlsdGVyIHBsYWNlaG9sZGVyIGJ5IGNvbHVtblxuXG5cdExvY2FsaXplLnByb3RvdHlwZS5zZXRIZWFkZXJGaWx0ZXJDb2x1bW5QbGFjZWhvbGRlciA9IGZ1bmN0aW9uIChjb2x1bW4sIHBsYWNlaG9sZGVyKSB7XG5cblx0XHR0aGlzLmxhbmdzLmRlZmF1bHQuaGVhZGVyRmlsdGVycy5jb2x1bW5zW2NvbHVtbl0gPSBwbGFjZWhvbGRlcjtcblxuXHRcdGlmICh0aGlzLmxhbmcgJiYgIXRoaXMubGFuZy5oZWFkZXJGaWx0ZXJzLmNvbHVtbnNbY29sdW1uXSkge1xuXG5cdFx0XHR0aGlzLmxhbmcuaGVhZGVyRmlsdGVycy5jb2x1bW5zW2NvbHVtbl0gPSBwbGFjZWhvbGRlcjtcblx0XHR9XG5cdH07XG5cblx0Ly9zZXR1cCBhIGxhbmcgZGVzY3JpcHRpb24gb2JqZWN0XG5cblx0TG9jYWxpemUucHJvdG90eXBlLmluc3RhbGxMYW5nID0gZnVuY3Rpb24gKGxvY2FsZSwgbGFuZykge1xuXG5cdFx0aWYgKHRoaXMubGFuZ3NbbG9jYWxlXSkge1xuXG5cdFx0XHR0aGlzLl9zZXRMYW5nUHJvcCh0aGlzLmxhbmdzW2xvY2FsZV0sIGxhbmcpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHRoaXMubGFuZ3NbbG9jYWxlXSA9IGxhbmc7XG5cdFx0fVxuXHR9O1xuXG5cdExvY2FsaXplLnByb3RvdHlwZS5fc2V0TGFuZ1Byb3AgPSBmdW5jdGlvbiAobGFuZywgdmFsdWVzKSB7XG5cblx0XHRmb3IgKHZhciBrZXkgaW4gdmFsdWVzKSB7XG5cblx0XHRcdGlmIChsYW5nW2tleV0gJiYgX3R5cGVvZihsYW5nW2tleV0pID09IFwib2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLl9zZXRMYW5nUHJvcChsYW5nW2tleV0sIHZhbHVlc1trZXldKTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0bGFuZ1trZXldID0gdmFsdWVzW2tleV07XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdC8vc2V0IGN1cnJlbnQgbG9jYWxlXG5cblx0TG9jYWxpemUucHJvdG90eXBlLnNldExvY2FsZSA9IGZ1bmN0aW9uIChkZXNpcmVkTG9jYWxlKSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRkZXNpcmVkTG9jYWxlID0gZGVzaXJlZExvY2FsZSB8fCBcImRlZmF1bHRcIjtcblxuXHRcdC8vZmlsbCBpbiBhbnkgbWF0Y2hpbmcgbGFuZ3VnZSB2YWx1ZXNcblxuXHRcdGZ1bmN0aW9uIHRyYXZlcnNlTGFuZyh0cmFucywgcGF0aCkge1xuXG5cdFx0XHRmb3IgKHZhciBwcm9wIGluIHRyYW5zKSB7XG5cblx0XHRcdFx0aWYgKF90eXBlb2YodHJhbnNbcHJvcF0pID09IFwib2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdGlmICghcGF0aFtwcm9wXSkge1xuXG5cdFx0XHRcdFx0XHRwYXRoW3Byb3BdID0ge307XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dHJhdmVyc2VMYW5nKHRyYW5zW3Byb3BdLCBwYXRoW3Byb3BdKTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdHBhdGhbcHJvcF0gPSB0cmFuc1twcm9wXTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vZGV0ZXJtaW5nIGNvcnJlY3QgbG9jYWxlIHRvIGxvYWRcblxuXHRcdGlmIChkZXNpcmVkTG9jYWxlID09PSB0cnVlICYmIG5hdmlnYXRvci5sYW5ndWFnZSkge1xuXG5cdFx0XHQvL2dldCBsb2NhbCBmcm9tIHN5c3RlbVxuXG5cdFx0XHRkZXNpcmVkTG9jYWxlID0gbmF2aWdhdG9yLmxhbmd1YWdlLnRvTG93ZXJDYXNlKCk7XG5cdFx0fVxuXG5cdFx0aWYgKGRlc2lyZWRMb2NhbGUpIHtcblxuXHRcdFx0Ly9pZiBsb2NhbGUgaXMgbm90IHNldCwgY2hlY2sgZm9yIG1hdGNoaW5nIHRvcCBsZXZlbCBsb2NhbGUgZWxzZSB1c2UgZGVmYXVsdFxuXG5cdFx0XHRpZiAoIXNlbGYubGFuZ3NbZGVzaXJlZExvY2FsZV0pIHtcblxuXHRcdFx0XHR2YXIgcHJlZml4ID0gZGVzaXJlZExvY2FsZS5zcGxpdChcIi1cIilbMF07XG5cblx0XHRcdFx0aWYgKHNlbGYubGFuZ3NbcHJlZml4XSkge1xuXG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiTG9jYWxpemF0aW9uIEVycm9yIC0gRXhhY3QgbWF0Y2hpbmcgbG9jYWxlIG5vdCBmb3VuZCwgdXNpbmcgY2xvc2VzdCBtYXRjaDogXCIsIGRlc2lyZWRMb2NhbGUsIHByZWZpeCk7XG5cblx0XHRcdFx0XHRkZXNpcmVkTG9jYWxlID0gcHJlZml4O1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiTG9jYWxpemF0aW9uIEVycm9yIC0gTWF0Y2hpbmcgbG9jYWxlIG5vdCBmb3VuZCwgdXNpbmcgZGVmYXVsdDogXCIsIGRlc2lyZWRMb2NhbGUpO1xuXG5cdFx0XHRcdFx0ZGVzaXJlZExvY2FsZSA9IFwiZGVmYXVsdFwiO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0c2VsZi5sb2NhbGUgPSBkZXNpcmVkTG9jYWxlO1xuXG5cdFx0Ly9sb2FkIGRlZmF1bHQgbGFuZyB0ZW1wbGF0ZVxuXG5cdFx0c2VsZi5sYW5nID0gVGFidWxhdG9yLnByb3RvdHlwZS5oZWxwZXJzLmRlZXBDbG9uZShzZWxmLmxhbmdzLmRlZmF1bHQgfHwge30pO1xuXG5cdFx0aWYgKGRlc2lyZWRMb2NhbGUgIT0gXCJkZWZhdWx0XCIpIHtcblxuXHRcdFx0dHJhdmVyc2VMYW5nKHNlbGYubGFuZ3NbZGVzaXJlZExvY2FsZV0sIHNlbGYubGFuZyk7XG5cdFx0fVxuXG5cdFx0c2VsZi50YWJsZS5vcHRpb25zLmxvY2FsaXplZC5jYWxsKHNlbGYudGFibGUsIHNlbGYubG9jYWxlLCBzZWxmLmxhbmcpO1xuXG5cdFx0c2VsZi5fZXhlY3V0ZUJpbmRpbmdzKCk7XG5cdH07XG5cblx0Ly9nZXQgY3VycmVudCBsb2NhbGVcblxuXHRMb2NhbGl6ZS5wcm90b3R5cGUuZ2V0TG9jYWxlID0gZnVuY3Rpb24gKGxvY2FsZSkge1xuXG5cdFx0cmV0dXJuIHNlbGYubG9jYWxlO1xuXHR9O1xuXG5cdC8vZ2V0IGxhbmcgb2JqZWN0IGZvciBnaXZlbiBsb2NhbCBvciBjdXJyZW50IGlmIG5vbmUgcHJvdmlkZWRcblxuXHRMb2NhbGl6ZS5wcm90b3R5cGUuZ2V0TGFuZyA9IGZ1bmN0aW9uIChsb2NhbGUpIHtcblxuXHRcdHJldHVybiBsb2NhbGUgPyB0aGlzLmxhbmdzW2xvY2FsZV0gOiB0aGlzLmxhbmc7XG5cdH07XG5cblx0Ly9nZXQgdGV4dCBmb3IgY3VycmVudCBsb2NhbGVcblxuXHRMb2NhbGl6ZS5wcm90b3R5cGUuZ2V0VGV4dCA9IGZ1bmN0aW9uIChwYXRoLCB2YWx1ZSkge1xuXG5cdFx0dmFyIHBhdGggPSB2YWx1ZSA/IHBhdGggKyBcInxcIiArIHZhbHVlIDogcGF0aCxcblx0XHQgICAgcGF0aEFycmF5ID0gcGF0aC5zcGxpdChcInxcIiksXG5cdFx0ICAgIHRleHQgPSB0aGlzLl9nZXRMYW5nRWxlbWVudChwYXRoQXJyYXksIHRoaXMubG9jYWxlKTtcblxuXHRcdC8vIGlmKHRleHQgPT09IGZhbHNlKXtcblxuXHRcdC8vIFx0Y29uc29sZS53YXJuKFwiTG9jYWxpemF0aW9uIEVycm9yIC0gTWF0Y2hpbmcgbG9jYWxpemVkIHRleHQgbm90IGZvdW5kIGZvciBnaXZlbiBwYXRoOiBcIiwgcGF0aCk7XG5cblx0XHQvLyB9XG5cblxuXHRcdHJldHVybiB0ZXh0IHx8IFwiXCI7XG5cdH07XG5cblx0Ly90cmF2ZXJzZSBsYW5ncyBvYmplY3QgYW5kIGZpbmQgbG9jYWxpemVkIGNvcHlcblxuXHRMb2NhbGl6ZS5wcm90b3R5cGUuX2dldExhbmdFbGVtZW50ID0gZnVuY3Rpb24gKHBhdGgsIGxvY2FsZSkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0dmFyIHJvb3QgPSBzZWxmLmxhbmc7XG5cblx0XHRwYXRoLmZvckVhY2goZnVuY3Rpb24gKGxldmVsKSB7XG5cblx0XHRcdHZhciByb290UGF0aDtcblxuXHRcdFx0aWYgKHJvb3QpIHtcblxuXHRcdFx0XHRyb290UGF0aCA9IHJvb3RbbGV2ZWxdO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Ygcm9vdFBhdGggIT0gXCJ1bmRlZmluZWRcIikge1xuXG5cdFx0XHRcdFx0cm9vdCA9IHJvb3RQYXRoO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0cm9vdCA9IGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcm9vdDtcblx0fTtcblxuXHQvL3NldCB1cGRhdGUgYmluZGluZ1xuXG5cdExvY2FsaXplLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKHBhdGgsIGNhbGxiYWNrKSB7XG5cblx0XHRpZiAoIXRoaXMuYmluZGluZ3NbcGF0aF0pIHtcblxuXHRcdFx0dGhpcy5iaW5kaW5nc1twYXRoXSA9IFtdO1xuXHRcdH1cblxuXHRcdHRoaXMuYmluZGluZ3NbcGF0aF0ucHVzaChjYWxsYmFjayk7XG5cblx0XHRjYWxsYmFjayh0aGlzLmdldFRleHQocGF0aCksIHRoaXMubGFuZyk7XG5cdH07XG5cblx0Ly9pdHRlcmF0ZSB0aHJvdWdoIGJpbmRpbmdzIGFuZCB0cmlnZ2VyIHVwZGF0ZXNcblxuXHRMb2NhbGl6ZS5wcm90b3R5cGUuX2V4ZWN1dGVCaW5kaW5ncyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHZhciBfbG9vcCA9IGZ1bmN0aW9uIF9sb29wKHBhdGgpIHtcblxuXHRcdFx0c2VsZi5iaW5kaW5nc1twYXRoXS5mb3JFYWNoKGZ1bmN0aW9uIChiaW5kaW5nKSB7XG5cblx0XHRcdFx0YmluZGluZyhzZWxmLmdldFRleHQocGF0aCksIHNlbGYubGFuZyk7XG5cdFx0XHR9KTtcblx0XHR9O1xuXG5cdFx0Zm9yICh2YXIgcGF0aCBpbiBzZWxmLmJpbmRpbmdzKSB7XG5cdFx0XHRfbG9vcChwYXRoKTtcblx0XHR9XG5cdH07XG5cblx0Ly9Mb2NhbGl6ZWQgdGV4dCBsaXN0aW5nc1xuXG5cdExvY2FsaXplLnByb3RvdHlwZS5sYW5ncyA9IHtcblxuXHRcdFwiZGVmYXVsdFwiOiB7IC8vaG9sZCBkZWZhdWx0IGxvY2FsZSB0ZXh0XG5cblx0XHRcdFwiZ3JvdXBzXCI6IHtcblxuXHRcdFx0XHRcIml0ZW1cIjogXCJpdGVtXCIsXG5cblx0XHRcdFx0XCJpdGVtc1wiOiBcIml0ZW1zXCJcblxuXHRcdFx0fSxcblxuXHRcdFx0XCJjb2x1bW5zXCI6IHt9LFxuXG5cdFx0XHRcImFqYXhcIjoge1xuXG5cdFx0XHRcdFwibG9hZGluZ1wiOiBcIkxvYWRpbmdcIixcblxuXHRcdFx0XHRcImVycm9yXCI6IFwiRXJyb3JcIlxuXG5cdFx0XHR9LFxuXG5cdFx0XHRcInBhZ2luYXRpb25cIjoge1xuXG5cdFx0XHRcdFwicGFnZV9zaXplXCI6IFwiUGFnZSBTaXplXCIsXG5cblx0XHRcdFx0XCJwYWdlX3RpdGxlXCI6IFwiU2hvdyBQYWdlXCIsXG5cblx0XHRcdFx0XCJmaXJzdFwiOiBcIkZpcnN0XCIsXG5cblx0XHRcdFx0XCJmaXJzdF90aXRsZVwiOiBcIkZpcnN0IFBhZ2VcIixcblxuXHRcdFx0XHRcImxhc3RcIjogXCJMYXN0XCIsXG5cblx0XHRcdFx0XCJsYXN0X3RpdGxlXCI6IFwiTGFzdCBQYWdlXCIsXG5cblx0XHRcdFx0XCJwcmV2XCI6IFwiUHJldlwiLFxuXG5cdFx0XHRcdFwicHJldl90aXRsZVwiOiBcIlByZXYgUGFnZVwiLFxuXG5cdFx0XHRcdFwibmV4dFwiOiBcIk5leHRcIixcblxuXHRcdFx0XHRcIm5leHRfdGl0bGVcIjogXCJOZXh0IFBhZ2VcIixcblxuXHRcdFx0XHRcImFsbFwiOiBcIkFsbFwiXG5cblx0XHRcdH0sXG5cblx0XHRcdFwiaGVhZGVyRmlsdGVyc1wiOiB7XG5cblx0XHRcdFx0XCJkZWZhdWx0XCI6IFwiZmlsdGVyIGNvbHVtbi4uLlwiLFxuXG5cdFx0XHRcdFwiY29sdW1uc1wiOiB7fVxuXG5cdFx0XHR9XG5cblx0XHR9XG5cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnJlZ2lzdGVyTW9kdWxlKFwibG9jYWxpemVcIiwgTG9jYWxpemUpO1xuXG5cdHZhciBDb21tcyA9IGZ1bmN0aW9uIENvbW1zKHRhYmxlKSB7XG5cblx0XHR0aGlzLnRhYmxlID0gdGFibGU7XG5cdH07XG5cblx0Q29tbXMucHJvdG90eXBlLmdldENvbm5lY3Rpb25zID0gZnVuY3Rpb24gKHNlbGVjdG9ycykge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBjb25uZWN0aW9ucyA9IFtdLFxuXHRcdCAgICBjb25uZWN0aW9uO1xuXG5cdFx0Y29ubmVjdGlvbiA9IFRhYnVsYXRvci5wcm90b3R5cGUuY29tbXMubG9va3VwVGFibGUoc2VsZWN0b3JzKTtcblxuXHRcdGNvbm5lY3Rpb24uZm9yRWFjaChmdW5jdGlvbiAoY29uKSB7XG5cblx0XHRcdGlmIChzZWxmLnRhYmxlICE9PSBjb24pIHtcblxuXHRcdFx0XHRjb25uZWN0aW9ucy5wdXNoKGNvbik7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gY29ubmVjdGlvbnM7XG5cdH07XG5cblx0Q29tbXMucHJvdG90eXBlLnNlbmQgPSBmdW5jdGlvbiAoc2VsZWN0b3JzLCBtb2R1bGUsIGFjdGlvbiwgZGF0YSkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBjb25uZWN0aW9ucyA9IHRoaXMuZ2V0Q29ubmVjdGlvbnMoc2VsZWN0b3JzKTtcblxuXHRcdGNvbm5lY3Rpb25zLmZvckVhY2goZnVuY3Rpb24gKGNvbm5lY3Rpb24pIHtcblxuXHRcdFx0Y29ubmVjdGlvbi50YWJsZUNvbW1zKHNlbGYudGFibGUuZWxlbWVudCwgbW9kdWxlLCBhY3Rpb24sIGRhdGEpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFjb25uZWN0aW9ucy5sZW5ndGggJiYgc2VsZWN0b3JzKSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcIlRhYmxlIENvbm5lY3Rpb24gRXJyb3IgLSBObyB0YWJsZXMgbWF0Y2hpbmcgc2VsZWN0b3IgZm91bmRcIiwgc2VsZWN0b3JzKTtcblx0XHR9XG5cdH07XG5cblx0Q29tbXMucHJvdG90eXBlLnJlY2VpdmUgPSBmdW5jdGlvbiAodGFibGUsIG1vZHVsZSwgYWN0aW9uLCBkYXRhKSB7XG5cblx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMobW9kdWxlKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy50YWJsZS5tb2R1bGVzW21vZHVsZV0uY29tbXNSZWNlaXZlZCh0YWJsZSwgYWN0aW9uLCBkYXRhKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRjb25zb2xlLndhcm4oXCJJbnRlci10YWJsZSBDb21tcyBFcnJvciAtIG5vIHN1Y2ggbW9kdWxlOlwiLCBtb2R1bGUpO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnJlZ2lzdGVyTW9kdWxlKFwiY29tbXNcIiwgQ29tbXMpO1xuXG5cdHZhciBBY2Nlc3NvciA9IGZ1bmN0aW9uIEFjY2Vzc29yKHRhYmxlKSB7XG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlOyAvL2hvbGQgVGFidWxhdG9yIG9iamVjdFxuXHRcdHRoaXMuYWxsb3dlZFR5cGVzID0gW1wiXCIsIFwiZGF0YVwiLCBcImRvd25sb2FkXCIsIFwiY2xpcGJvYXJkXCIsIFwicHJpbnRcIiwgXCJodG1sT3V0cHV0XCJdOyAvL2xpc3Qgb2YgYWNjZXNzb3IgdHlwZXNcblx0fTtcblxuXHQvL2luaXRpYWxpemUgY29sdW1uIGFjY2Vzc29yXG5cdEFjY2Vzc29yLnByb3RvdHlwZS5pbml0aWFsaXplQ29sdW1uID0gZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgbWF0Y2ggPSBmYWxzZSxcblx0XHQgICAgY29uZmlnID0ge307XG5cblx0XHR0aGlzLmFsbG93ZWRUeXBlcy5mb3JFYWNoKGZ1bmN0aW9uICh0eXBlKSB7XG5cdFx0XHR2YXIga2V5ID0gXCJhY2Nlc3NvclwiICsgKHR5cGUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0eXBlLnNsaWNlKDEpKSxcblx0XHRcdCAgICBhY2Nlc3NvcjtcblxuXHRcdFx0aWYgKGNvbHVtbi5kZWZpbml0aW9uW2tleV0pIHtcblx0XHRcdFx0YWNjZXNzb3IgPSBzZWxmLmxvb2t1cEFjY2Vzc29yKGNvbHVtbi5kZWZpbml0aW9uW2tleV0pO1xuXG5cdFx0XHRcdGlmIChhY2Nlc3Nvcikge1xuXHRcdFx0XHRcdG1hdGNoID0gdHJ1ZTtcblxuXHRcdFx0XHRcdGNvbmZpZ1trZXldID0ge1xuXHRcdFx0XHRcdFx0YWNjZXNzb3I6IGFjY2Vzc29yLFxuXHRcdFx0XHRcdFx0cGFyYW1zOiBjb2x1bW4uZGVmaW5pdGlvbltrZXkgKyBcIlBhcmFtc1wiXSB8fCB7fVxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGlmIChtYXRjaCkge1xuXHRcdFx0Y29sdW1uLm1vZHVsZXMuYWNjZXNzb3IgPSBjb25maWc7XG5cdFx0fVxuXHR9O1xuXG5cdEFjY2Vzc29yLnByb3RvdHlwZS5sb29rdXBBY2Nlc3NvciA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdHZhciBhY2Nlc3NvciA9IGZhbHNlO1xuXG5cdFx0Ly9zZXQgY29sdW1uIGFjY2Vzc29yXG5cdFx0c3dpdGNoICh0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKHZhbHVlKSkge1xuXHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHRpZiAodGhpcy5hY2Nlc3NvcnNbdmFsdWVdKSB7XG5cdFx0XHRcdFx0YWNjZXNzb3IgPSB0aGlzLmFjY2Vzc29yc1t2YWx1ZV07XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiQWNjZXNzb3IgRXJyb3IgLSBObyBzdWNoIGFjY2Vzc29yIGZvdW5kLCBpZ25vcmluZzogXCIsIHZhbHVlKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcImZ1bmN0aW9uXCI6XG5cdFx0XHRcdGFjY2Vzc29yID0gdmFsdWU7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblxuXHRcdHJldHVybiBhY2Nlc3Nvcjtcblx0fTtcblxuXHQvL2FwcGx5IGFjY2Vzc29yIHRvIHJvd1xuXHRBY2Nlc3Nvci5wcm90b3R5cGUudHJhbnNmb3JtUm93ID0gZnVuY3Rpb24gKGRhdGFJbiwgdHlwZSkge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAga2V5ID0gXCJhY2Nlc3NvclwiICsgKHR5cGUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0eXBlLnNsaWNlKDEpKTtcblxuXHRcdC8vY2xvbmUgZGF0YSBvYmplY3Qgd2l0aCBkZWVwIGNvcHkgdG8gaXNvbGF0ZSBpbnRlcm5hbCBkYXRhIGZyb20gcmV0dXJuZWQgcmVzdWx0XG5cdFx0dmFyIGRhdGEgPSBUYWJ1bGF0b3IucHJvdG90eXBlLmhlbHBlcnMuZGVlcENsb25lKGRhdGFJbiB8fCB7fSk7XG5cblx0XHRzZWxmLnRhYmxlLmNvbHVtbk1hbmFnZXIudHJhdmVyc2UoZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdFx0dmFyIHZhbHVlLCBhY2Nlc3NvciwgcGFyYW1zLCBjb21wb25lbnQ7XG5cblx0XHRcdGlmIChjb2x1bW4ubW9kdWxlcy5hY2Nlc3Nvcikge1xuXG5cdFx0XHRcdGFjY2Vzc29yID0gY29sdW1uLm1vZHVsZXMuYWNjZXNzb3Jba2V5XSB8fCBjb2x1bW4ubW9kdWxlcy5hY2Nlc3Nvci5hY2Nlc3NvciB8fCBmYWxzZTtcblxuXHRcdFx0XHRpZiAoYWNjZXNzb3IpIHtcblx0XHRcdFx0XHR2YWx1ZSA9IGNvbHVtbi5nZXRGaWVsZFZhbHVlKGRhdGEpO1xuXG5cdFx0XHRcdFx0aWYgKHZhbHVlICE9IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0XHRcdGNvbXBvbmVudCA9IGNvbHVtbi5nZXRDb21wb25lbnQoKTtcblx0XHRcdFx0XHRcdHBhcmFtcyA9IHR5cGVvZiBhY2Nlc3Nvci5wYXJhbXMgPT09IFwiZnVuY3Rpb25cIiA/IGFjY2Vzc29yLnBhcmFtcyh2YWx1ZSwgZGF0YSwgdHlwZSwgY29tcG9uZW50KSA6IGFjY2Vzc29yLnBhcmFtcztcblx0XHRcdFx0XHRcdGNvbHVtbi5zZXRGaWVsZFZhbHVlKGRhdGEsIGFjY2Vzc29yLmFjY2Vzc29yKHZhbHVlLCBkYXRhLCB0eXBlLCBwYXJhbXMsIGNvbXBvbmVudCkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGRhdGE7XG5cdH0sXG5cblx0Ly9kZWZhdWx0IGFjY2Vzc29yc1xuXHRBY2Nlc3Nvci5wcm90b3R5cGUuYWNjZXNzb3JzID0ge307XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcImFjY2Vzc29yXCIsIEFjY2Vzc29yKTtcblx0dmFyIEFqYXggPSBmdW5jdGlvbiBBamF4KHRhYmxlKSB7XG5cblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdFx0dGhpcy5jb25maWcgPSBmYWxzZTsgLy9ob2xkIGNvbmZpZyBvYmplY3QgZm9yIGFqYXggcmVxdWVzdFxuXHRcdHRoaXMudXJsID0gXCJcIjsgLy9yZXF1ZXN0IFVSTFxuXHRcdHRoaXMudXJsR2VuZXJhdG9yID0gZmFsc2U7XG5cdFx0dGhpcy5wYXJhbXMgPSBmYWxzZTsgLy9yZXF1ZXN0IHBhcmFtZXRlcnNcblxuXHRcdHRoaXMubG9hZGVyRWxlbWVudCA9IHRoaXMuY3JlYXRlTG9hZGVyRWxlbWVudCgpOyAvL2xvYWRlciBtZXNzYWdlIGRpdlxuXHRcdHRoaXMubXNnRWxlbWVudCA9IHRoaXMuY3JlYXRlTXNnRWxlbWVudCgpOyAvL21lc3NhZ2UgZWxlbWVudFxuXHRcdHRoaXMubG9hZGluZ0VsZW1lbnQgPSBmYWxzZTtcblx0XHR0aGlzLmVycm9yRWxlbWVudCA9IGZhbHNlO1xuXHRcdHRoaXMubG9hZGVyUHJvbWlzZSA9IGZhbHNlO1xuXG5cdFx0dGhpcy5wcm9ncmVzc2l2ZUxvYWQgPSBmYWxzZTtcblx0XHR0aGlzLmxvYWRpbmcgPSBmYWxzZTtcblxuXHRcdHRoaXMucmVxdWVzdE9yZGVyID0gMDsgLy9wcmV2ZW50IHJlcXVlc3RzIGNvbW1pbmcgb3V0IG9mIHNlcXVlbmNlIGlmIG92ZXJyaWRkZW4gYnkgYW5vdGhlciBsb2FkIHJlcXVlc3Rcblx0fTtcblxuXHQvL2luaXRpYWxpemUgc2V0dXAgb3B0aW9uc1xuXHRBamF4LnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciB0ZW1wbGF0ZTtcblxuXHRcdHRoaXMubG9hZGVyRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLm1zZ0VsZW1lbnQpO1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5hamF4TG9hZGVyTG9hZGluZykge1xuXHRcdFx0aWYgKHR5cGVvZiB0aGlzLnRhYmxlLm9wdGlvbnMuYWpheExvYWRlckxvYWRpbmcgPT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHR0ZW1wbGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RlbXBsYXRlJyk7XG5cdFx0XHRcdHRlbXBsYXRlLmlubmVySFRNTCA9IHRoaXMudGFibGUub3B0aW9ucy5hamF4TG9hZGVyTG9hZGluZy50cmltKCk7XG5cdFx0XHRcdHRoaXMubG9hZGluZ0VsZW1lbnQgPSB0ZW1wbGF0ZS5jb250ZW50LmZpcnN0Q2hpbGQ7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLmxvYWRpbmdFbGVtZW50ID0gdGhpcy50YWJsZS5vcHRpb25zLmFqYXhMb2FkZXJMb2FkaW5nO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHRoaXMubG9hZGVyUHJvbWlzZSA9IHRoaXMudGFibGUub3B0aW9ucy5hamF4UmVxdWVzdEZ1bmMgfHwgdGhpcy5kZWZhdWx0TG9hZGVyUHJvbWlzZTtcblxuXHRcdHRoaXMudXJsR2VuZXJhdG9yID0gdGhpcy50YWJsZS5vcHRpb25zLmFqYXhVUkxHZW5lcmF0b3IgfHwgdGhpcy5kZWZhdWx0VVJMR2VuZXJhdG9yO1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5hamF4TG9hZGVyRXJyb3IpIHtcblx0XHRcdGlmICh0eXBlb2YgdGhpcy50YWJsZS5vcHRpb25zLmFqYXhMb2FkZXJFcnJvciA9PSBcInN0cmluZ1wiKSB7XG5cdFx0XHRcdHRlbXBsYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGVtcGxhdGUnKTtcblx0XHRcdFx0dGVtcGxhdGUuaW5uZXJIVE1MID0gdGhpcy50YWJsZS5vcHRpb25zLmFqYXhMb2FkZXJFcnJvci50cmltKCk7XG5cdFx0XHRcdHRoaXMuZXJyb3JFbGVtZW50ID0gdGVtcGxhdGUuY29udGVudC5maXJzdENoaWxkO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5lcnJvckVsZW1lbnQgPSB0aGlzLnRhYmxlLm9wdGlvbnMuYWpheExvYWRlckVycm9yO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuYWpheFBhcmFtcykge1xuXHRcdFx0dGhpcy5zZXRQYXJhbXModGhpcy50YWJsZS5vcHRpb25zLmFqYXhQYXJhbXMpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuYWpheENvbmZpZykge1xuXHRcdFx0dGhpcy5zZXRDb25maWcodGhpcy50YWJsZS5vcHRpb25zLmFqYXhDb25maWcpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuYWpheFVSTCkge1xuXHRcdFx0dGhpcy5zZXRVcmwodGhpcy50YWJsZS5vcHRpb25zLmFqYXhVUkwpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuYWpheFByb2dyZXNzaXZlTG9hZCkge1xuXHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uKSB7XG5cdFx0XHRcdHRoaXMucHJvZ3Jlc3NpdmVMb2FkID0gZmFsc2U7XG5cdFx0XHRcdGNvbnNvbGUuZXJyb3IoXCJQcm9ncmVzc2l2ZSBMb2FkIEVycm9yIC0gUGFnaW5hdGlvbiBhbmQgcHJvZ3Jlc3NpdmUgbG9hZCBjYW5ub3QgYmUgdXNlZCBhdCB0aGUgc2FtZSB0aW1lXCIpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwicGFnZVwiKSkge1xuXHRcdFx0XHRcdHRoaXMucHJvZ3Jlc3NpdmVMb2FkID0gdGhpcy50YWJsZS5vcHRpb25zLmFqYXhQcm9ncmVzc2l2ZUxvYWQ7XG5cdFx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnBhZ2UuaW5pdGlhbGl6ZVByb2dyZXNzaXZlKHRoaXMucHJvZ3Jlc3NpdmVMb2FkKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLmVycm9yKFwiUGFnaW5hdGlvbiBwbHVnaW4gaXMgcmVxdWlyZWQgZm9yIHByb2dyZXNzaXZlIGFqYXggbG9hZGluZ1wiKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRBamF4LnByb3RvdHlwZS5jcmVhdGVMb2FkZXJFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1sb2FkZXJcIik7XG5cdFx0cmV0dXJuIGVsO1xuXHR9O1xuXG5cdEFqYXgucHJvdG90eXBlLmNyZWF0ZU1zZ0VsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItbG9hZGVyLW1zZ1wiKTtcblx0XHRlbC5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwiYWxlcnRcIik7XG5cblx0XHRyZXR1cm4gZWw7XG5cdH07XG5cblx0Ly9zZXQgYWpheCBwYXJhbXNcblx0QWpheC5wcm90b3R5cGUuc2V0UGFyYW1zID0gZnVuY3Rpb24gKHBhcmFtcywgdXBkYXRlKSB7XG5cdFx0aWYgKHVwZGF0ZSkge1xuXHRcdFx0dGhpcy5wYXJhbXMgPSB0aGlzLnBhcmFtcyB8fCB7fTtcblxuXHRcdFx0Zm9yICh2YXIga2V5IGluIHBhcmFtcykge1xuXHRcdFx0XHR0aGlzLnBhcmFtc1trZXldID0gcGFyYW1zW2tleV07XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMucGFyYW1zID0gcGFyYW1zO1xuXHRcdH1cblx0fTtcblxuXHRBamF4LnByb3RvdHlwZS5nZXRQYXJhbXMgPSBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIHRoaXMucGFyYW1zIHx8IHt9O1xuXHR9O1xuXG5cdC8vbG9hZCBjb25maWcgb2JqZWN0XG5cdEFqYXgucHJvdG90eXBlLnNldENvbmZpZyA9IGZ1bmN0aW9uIChjb25maWcpIHtcblx0XHR0aGlzLl9sb2FkRGVmYXVsdENvbmZpZygpO1xuXG5cdFx0aWYgKHR5cGVvZiBjb25maWcgPT0gXCJzdHJpbmdcIikge1xuXHRcdFx0dGhpcy5jb25maWcubWV0aG9kID0gY29uZmlnO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRmb3IgKHZhciBrZXkgaW4gY29uZmlnKSB7XG5cdFx0XHRcdHRoaXMuY29uZmlnW2tleV0gPSBjb25maWdba2V5XTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Ly9jcmVhdGUgY29uZmlnIG9iamVjdCBmcm9tIGRlZmF1bHRcblx0QWpheC5wcm90b3R5cGUuX2xvYWREZWZhdWx0Q29uZmlnID0gZnVuY3Rpb24gKGZvcmNlKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdGlmICghc2VsZi5jb25maWcgfHwgZm9yY2UpIHtcblxuXHRcdFx0c2VsZi5jb25maWcgPSB7fTtcblxuXHRcdFx0Ly9sb2FkIGJhc2UgY29uZmlnIGZyb20gZGVmYXVsdHNcblx0XHRcdGZvciAodmFyIGtleSBpbiBzZWxmLmRlZmF1bHRDb25maWcpIHtcblx0XHRcdFx0c2VsZi5jb25maWdba2V5XSA9IHNlbGYuZGVmYXVsdENvbmZpZ1trZXldO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHQvL3NldCByZXF1ZXN0IHVybFxuXHRBamF4LnByb3RvdHlwZS5zZXRVcmwgPSBmdW5jdGlvbiAodXJsKSB7XG5cdFx0dGhpcy51cmwgPSB1cmw7XG5cdH07XG5cblx0Ly9nZXQgcmVxdWVzdCB1cmxcblx0QWpheC5wcm90b3R5cGUuZ2V0VXJsID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB0aGlzLnVybDtcblx0fTtcblxuXHQvL2xzdGFuZGFyZCBsb2FkaW5nIGZ1bmN0aW9uXG5cdEFqYXgucHJvdG90eXBlLmxvYWREYXRhID0gZnVuY3Rpb24gKGluUG9zaXRpb24sIGNvbHVtbnNDaGFuZ2VkKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0aWYgKHRoaXMucHJvZ3Jlc3NpdmVMb2FkKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbG9hZERhdGFQcm9ncmVzc2l2ZSgpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbG9hZERhdGFTdGFuZGFyZChpblBvc2l0aW9uLCBjb2x1bW5zQ2hhbmdlZCk7XG5cdFx0fVxuXHR9O1xuXG5cdEFqYXgucHJvdG90eXBlLm5leHRQYWdlID0gZnVuY3Rpb24gKGRpZmYpIHtcblx0XHR2YXIgbWFyZ2luO1xuXG5cdFx0aWYgKCF0aGlzLmxvYWRpbmcpIHtcblxuXHRcdFx0bWFyZ2luID0gdGhpcy50YWJsZS5vcHRpb25zLmFqYXhQcm9ncmVzc2l2ZUxvYWRTY3JvbGxNYXJnaW4gfHwgdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldEVsZW1lbnQoKS5jbGllbnRIZWlnaHQgKiAyO1xuXG5cdFx0XHRpZiAoZGlmZiA8IG1hcmdpbikge1xuXHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMucGFnZS5uZXh0UGFnZSgpLnRoZW4oZnVuY3Rpb24gKCkge30pLmNhdGNoKGZ1bmN0aW9uICgpIHt9KTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0QWpheC5wcm90b3R5cGUuYmxvY2tBY3RpdmVSZXF1ZXN0ID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMucmVxdWVzdE9yZGVyKys7XG5cdH07XG5cblx0QWpheC5wcm90b3R5cGUuX2xvYWREYXRhUHJvZ3Jlc3NpdmUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLnNldERhdGEoW10pO1xuXHRcdHJldHVybiB0aGlzLnRhYmxlLm1vZHVsZXMucGFnZS5zZXRQYWdlKDEpO1xuXHR9O1xuXG5cdEFqYXgucHJvdG90eXBlLl9sb2FkRGF0YVN0YW5kYXJkID0gZnVuY3Rpb24gKGluUG9zaXRpb24sIGNvbHVtbnNDaGFuZ2VkKSB7XG5cdFx0dmFyIF90aGlzMzUgPSB0aGlzO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblx0XHRcdF90aGlzMzUuc2VuZFJlcXVlc3QoaW5Qb3NpdGlvbikudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuXHRcdFx0XHRfdGhpczM1LnRhYmxlLnJvd01hbmFnZXIuc2V0RGF0YShkYXRhLCBpblBvc2l0aW9uLCBjb2x1bW5zQ2hhbmdlZCkudGhlbihmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0cmVzb2x2ZSgpO1xuXHRcdFx0XHR9KS5jYXRjaChmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdHJlamVjdChlKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9KS5jYXRjaChmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRyZWplY3QoZSk7XG5cdFx0XHR9KTtcblx0XHR9KTtcblx0fTtcblxuXHRBamF4LnByb3RvdHlwZS5nZW5lcmF0ZVBhcmFtc0xpc3QgPSBmdW5jdGlvbiAoZGF0YSwgcHJlZml4KSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBvdXRwdXQgPSBbXTtcblxuXHRcdHByZWZpeCA9IHByZWZpeCB8fCBcIlwiO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHtcblx0XHRcdGRhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaSkge1xuXHRcdFx0XHRvdXRwdXQgPSBvdXRwdXQuY29uY2F0KHNlbGYuZ2VuZXJhdGVQYXJhbXNMaXN0KGl0ZW0sIHByZWZpeCA/IHByZWZpeCArIFwiW1wiICsgaSArIFwiXVwiIDogaSkpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICgodHlwZW9mIGRhdGEgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGRhdGEpKSA9PT0gXCJvYmplY3RcIikge1xuXHRcdFx0Zm9yICh2YXIga2V5IGluIGRhdGEpIHtcblx0XHRcdFx0b3V0cHV0ID0gb3V0cHV0LmNvbmNhdChzZWxmLmdlbmVyYXRlUGFyYW1zTGlzdChkYXRhW2tleV0sIHByZWZpeCA/IHByZWZpeCArIFwiW1wiICsga2V5ICsgXCJdXCIgOiBrZXkpKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b3V0cHV0LnB1c2goeyBrZXk6IHByZWZpeCwgdmFsdWU6IGRhdGEgfSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fTtcblxuXHRBamF4LnByb3RvdHlwZS5zZXJpYWxpemVQYXJhbXMgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG5cdFx0dmFyIG91dHB1dCA9IHRoaXMuZ2VuZXJhdGVQYXJhbXNMaXN0KHBhcmFtcyksXG5cdFx0ICAgIGVuY29kZWQgPSBbXTtcblxuXHRcdG91dHB1dC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRlbmNvZGVkLnB1c2goZW5jb2RlVVJJQ29tcG9uZW50KGl0ZW0ua2V5KSArIFwiPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KGl0ZW0udmFsdWUpKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBlbmNvZGVkLmpvaW4oXCImXCIpO1xuXHR9O1xuXG5cdC8vc2VuZCBhamF4IHJlcXVlc3Rcblx0QWpheC5wcm90b3R5cGUuc2VuZFJlcXVlc3QgPSBmdW5jdGlvbiAoc2lsZW50KSB7XG5cdFx0dmFyIF90aGlzMzYgPSB0aGlzO1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICB1cmwgPSBzZWxmLnVybCxcblx0XHQgICAgcmVxdWVzdE5vLFxuXHRcdCAgICBlc2MsXG5cdFx0ICAgIHF1ZXJ5O1xuXG5cdFx0c2VsZi5yZXF1ZXN0T3JkZXIrKztcblx0XHRyZXF1ZXN0Tm8gPSBzZWxmLnJlcXVlc3RPcmRlcjtcblxuXHRcdHNlbGYuX2xvYWREZWZhdWx0Q29uZmlnKCk7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5hamF4UmVxdWVzdGluZy5jYWxsKF90aGlzMzYudGFibGUsIHNlbGYudXJsLCBzZWxmLnBhcmFtcykgIT09IGZhbHNlKSB7XG5cblx0XHRcdFx0c2VsZi5sb2FkaW5nID0gdHJ1ZTtcblxuXHRcdFx0XHRpZiAoIXNpbGVudCkge1xuXHRcdFx0XHRcdHNlbGYuc2hvd0xvYWRlcigpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0X3RoaXMzNi5sb2FkZXJQcm9taXNlKHVybCwgc2VsZi5jb25maWcsIHNlbGYucGFyYW1zKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG5cdFx0XHRcdFx0aWYgKHJlcXVlc3RObyA9PT0gc2VsZi5yZXF1ZXN0T3JkZXIpIHtcblx0XHRcdFx0XHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMuYWpheFJlc3BvbnNlKSB7XG5cdFx0XHRcdFx0XHRcdGRhdGEgPSBzZWxmLnRhYmxlLm9wdGlvbnMuYWpheFJlc3BvbnNlLmNhbGwoc2VsZi50YWJsZSwgc2VsZi51cmwsIHNlbGYucGFyYW1zLCBkYXRhKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cblx0XHRcdFx0XHRcdHNlbGYuaGlkZUxvYWRlcigpO1xuXHRcdFx0XHRcdFx0c2VsZi5sb2FkaW5nID0gZmFsc2U7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkFqYXggUmVzcG9uc2UgQmxvY2tlZCAtIEFuIGFjdGl2ZSBhamF4IHJlcXVlc3Qgd2FzIGJsb2NrZWQgYnkgYW4gYXR0ZW1wdCB0byBjaGFuZ2UgdGFibGUgZGF0YSB3aGlsZSB0aGUgcmVxdWVzdCB3YXMgYmVpbmcgbWFkZVwiKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuXHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoXCJBamF4IExvYWQgRXJyb3I6IFwiLCBlcnJvcik7XG5cdFx0XHRcdFx0c2VsZi50YWJsZS5vcHRpb25zLmFqYXhFcnJvci5jYWxsKHNlbGYudGFibGUsIGVycm9yKTtcblxuXHRcdFx0XHRcdHNlbGYuc2hvd0Vycm9yKCk7XG5cblx0XHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdHNlbGYuaGlkZUxvYWRlcigpO1xuXHRcdFx0XHRcdH0sIDMwMDApO1xuXG5cdFx0XHRcdFx0c2VsZi5sb2FkaW5nID0gZmFsc2U7XG5cblx0XHRcdFx0XHRyZWplY3QoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZWplY3QoKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHRBamF4LnByb3RvdHlwZS5zaG93TG9hZGVyID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBzaG91bGRMb2FkID0gdHlwZW9mIHRoaXMudGFibGUub3B0aW9ucy5hamF4TG9hZGVyID09PSBcImZ1bmN0aW9uXCIgPyB0aGlzLnRhYmxlLm9wdGlvbnMuYWpheExvYWRlcigpIDogdGhpcy50YWJsZS5vcHRpb25zLmFqYXhMb2FkZXI7XG5cblx0XHRpZiAoc2hvdWxkTG9hZCkge1xuXG5cdFx0XHR0aGlzLmhpZGVMb2FkZXIoKTtcblxuXHRcdFx0d2hpbGUgKHRoaXMubXNnRWxlbWVudC5maXJzdENoaWxkKSB7XG5cdFx0XHRcdHRoaXMubXNnRWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLm1zZ0VsZW1lbnQuZmlyc3RDaGlsZCk7XG5cdFx0XHR9dGhpcy5tc2dFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItZXJyb3JcIik7XG5cdFx0XHR0aGlzLm1zZ0VsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1sb2FkaW5nXCIpO1xuXG5cdFx0XHRpZiAodGhpcy5sb2FkaW5nRWxlbWVudCkge1xuXHRcdFx0XHR0aGlzLm1zZ0VsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5sb2FkaW5nRWxlbWVudCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLm1zZ0VsZW1lbnQuaW5uZXJIVE1MID0gdGhpcy50YWJsZS5tb2R1bGVzLmxvY2FsaXplLmdldFRleHQoXCJhamF4fGxvYWRpbmdcIik7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmxvYWRlckVsZW1lbnQpO1xuXHRcdH1cblx0fTtcblxuXHRBamF4LnByb3RvdHlwZS5zaG93RXJyb3IgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy5oaWRlTG9hZGVyKCk7XG5cblx0XHR3aGlsZSAodGhpcy5tc2dFbGVtZW50LmZpcnN0Q2hpbGQpIHtcblx0XHRcdHRoaXMubXNnRWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLm1zZ0VsZW1lbnQuZmlyc3RDaGlsZCk7XG5cdFx0fXRoaXMubXNnRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLWxvYWRpbmdcIik7XG5cdFx0dGhpcy5tc2dFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZXJyb3JcIik7XG5cblx0XHRpZiAodGhpcy5lcnJvckVsZW1lbnQpIHtcblx0XHRcdHRoaXMubXNnRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmVycm9yRWxlbWVudCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMubXNnRWxlbWVudC5pbm5lckhUTUwgPSB0aGlzLnRhYmxlLm1vZHVsZXMubG9jYWxpemUuZ2V0VGV4dChcImFqYXh8ZXJyb3JcIik7XG5cdFx0fVxuXG5cdFx0dGhpcy50YWJsZS5lbGVtZW50LmFwcGVuZENoaWxkKHRoaXMubG9hZGVyRWxlbWVudCk7XG5cdH07XG5cblx0QWpheC5wcm90b3R5cGUuaGlkZUxvYWRlciA9IGZ1bmN0aW9uICgpIHtcblx0XHRpZiAodGhpcy5sb2FkZXJFbGVtZW50LnBhcmVudE5vZGUpIHtcblx0XHRcdHRoaXMubG9hZGVyRWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMubG9hZGVyRWxlbWVudCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vZGVmYXVsdCBhamF4IGNvbmZpZyBvYmplY3Rcblx0QWpheC5wcm90b3R5cGUuZGVmYXVsdENvbmZpZyA9IHtcblx0XHRtZXRob2Q6IFwiR0VUXCJcblx0fTtcblxuXHRBamF4LnByb3RvdHlwZS5kZWZhdWx0VVJMR2VuZXJhdG9yID0gZnVuY3Rpb24gKHVybCwgY29uZmlnLCBwYXJhbXMpIHtcblxuXHRcdGlmICh1cmwpIHtcblx0XHRcdGlmIChwYXJhbXMgJiYgT2JqZWN0LmtleXMocGFyYW1zKS5sZW5ndGgpIHtcblx0XHRcdFx0aWYgKCFjb25maWcubWV0aG9kIHx8IGNvbmZpZy5tZXRob2QudG9Mb3dlckNhc2UoKSA9PSBcImdldFwiKSB7XG5cdFx0XHRcdFx0Y29uZmlnLm1ldGhvZCA9IFwiZ2V0XCI7XG5cblx0XHRcdFx0XHR1cmwgKz0gKHVybC5pbmNsdWRlcyhcIj9cIikgPyBcIiZcIiA6IFwiP1wiKSArIHRoaXMuc2VyaWFsaXplUGFyYW1zKHBhcmFtcyk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gdXJsO1xuXHR9O1xuXG5cdEFqYXgucHJvdG90eXBlLmRlZmF1bHRMb2FkZXJQcm9taXNlID0gZnVuY3Rpb24gKHVybCwgY29uZmlnLCBwYXJhbXMpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGNvbnRlbnRUeXBlO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdFx0Ly9zZXQgdXJsXG5cdFx0XHR1cmwgPSBzZWxmLnVybEdlbmVyYXRvcih1cmwsIGNvbmZpZywgcGFyYW1zKTtcblxuXHRcdFx0Ly9zZXQgYm9keSBjb250ZW50IGlmIG5vdCBHRVQgcmVxdWVzdFxuXHRcdFx0aWYgKGNvbmZpZy5tZXRob2QudG9VcHBlckNhc2UoKSAhPSBcIkdFVFwiKSB7XG5cdFx0XHRcdGNvbnRlbnRUeXBlID0gX3R5cGVvZihzZWxmLnRhYmxlLm9wdGlvbnMuYWpheENvbnRlbnRUeXBlKSA9PT0gXCJvYmplY3RcIiA/IHNlbGYudGFibGUub3B0aW9ucy5hamF4Q29udGVudFR5cGUgOiBzZWxmLmNvbnRlbnRUeXBlRm9ybWF0dGVyc1tzZWxmLnRhYmxlLm9wdGlvbnMuYWpheENvbnRlbnRUeXBlXTtcblx0XHRcdFx0aWYgKGNvbnRlbnRUeXBlKSB7XG5cblx0XHRcdFx0XHRmb3IgKHZhciBrZXkgaW4gY29udGVudFR5cGUuaGVhZGVycykge1xuXHRcdFx0XHRcdFx0aWYgKCFjb25maWcuaGVhZGVycykge1xuXHRcdFx0XHRcdFx0XHRjb25maWcuaGVhZGVycyA9IHt9O1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbmZpZy5oZWFkZXJzW2tleV0gPT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0XHRcdFx0Y29uZmlnLmhlYWRlcnNba2V5XSA9IGNvbnRlbnRUeXBlLmhlYWRlcnNba2V5XTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRjb25maWcuYm9keSA9IGNvbnRlbnRUeXBlLmJvZHkuY2FsbChzZWxmLCB1cmwsIGNvbmZpZywgcGFyYW1zKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJBamF4IEVycm9yIC0gSW52YWxpZCBhamF4Q29udGVudFR5cGUgdmFsdWU6XCIsIHNlbGYudGFibGUub3B0aW9ucy5hamF4Q29udGVudFR5cGUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh1cmwpIHtcblxuXHRcdFx0XHQvL2NvbmZpZ3VyZSBoZWFkZXJzXG5cdFx0XHRcdGlmICh0eXBlb2YgY29uZmlnLmhlYWRlcnMgPT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0XHRjb25maWcuaGVhZGVycyA9IHt9O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZiBjb25maWcuaGVhZGVycy5BY2NlcHQgPT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0XHRjb25maWcuaGVhZGVycy5BY2NlcHQgPSBcImFwcGxpY2F0aW9uL2pzb25cIjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2YgY29uZmlnLmhlYWRlcnNbXCJYLVJlcXVlc3RlZC1XaXRoXCJdID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdFx0Y29uZmlnLmhlYWRlcnNbXCJYLVJlcXVlc3RlZC1XaXRoXCJdID0gXCJYTUxIdHRwUmVxdWVzdFwiO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZiBjb25maWcubW9kZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRcdGNvbmZpZy5tb2RlID0gXCJjb3JzXCI7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoY29uZmlnLm1vZGUgPT0gXCJjb3JzXCIpIHtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YgY29uZmlnLmhlYWRlcnNbXCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW5cIl0gPT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0XHRcdGNvbmZpZy5oZWFkZXJzW1wiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luXCJdID0gd2luZG93LmxvY2F0aW9uLm9yaWdpbjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbmZpZy5jcmVkZW50aWFscyA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRcdFx0Y29uZmlnLmNyZWRlbnRpYWxzID0gJ3NhbWUtb3JpZ2luJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZiBjb25maWcuY3JlZGVudGlhbHMgPT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0XHRcdGNvbmZpZy5jcmVkZW50aWFscyA9ICdpbmNsdWRlJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvL3NlbmQgcmVxdWVzdFxuXHRcdFx0XHRmZXRjaCh1cmwsIGNvbmZpZykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcblx0XHRcdFx0XHRpZiAocmVzcG9uc2Uub2spIHtcblx0XHRcdFx0XHRcdHJlc3BvbnNlLmpzb24oKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG5cdFx0XHRcdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHRcdFx0XHR9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcblx0XHRcdFx0XHRcdFx0cmVqZWN0KGVycm9yKTtcblx0XHRcdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiQWpheCBMb2FkIEVycm9yIC0gSW52YWxpZCBKU09OIHJldHVybmVkXCIsIGVycm9yKTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmVycm9yKFwiQWpheCBMb2FkIEVycm9yIC0gQ29ubmVjdGlvbiBFcnJvcjogXCIgKyByZXNwb25zZS5zdGF0dXMsIHJlc3BvbnNlLnN0YXR1c1RleHQpO1xuXHRcdFx0XHRcdFx0cmVqZWN0KHJlc3BvbnNlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuXHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoXCJBamF4IExvYWQgRXJyb3IgLSBDb25uZWN0aW9uIEVycm9yOiBcIiwgZXJyb3IpO1xuXHRcdFx0XHRcdHJlamVjdChlcnJvcik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiQWpheCBMb2FkIEVycm9yIC0gTm8gVVJMIFNldFwiKTtcblx0XHRcdFx0cmVzb2x2ZShbXSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0QWpheC5wcm90b3R5cGUuY29udGVudFR5cGVGb3JtYXR0ZXJzID0ge1xuXHRcdFwianNvblwiOiB7XG5cdFx0XHRoZWFkZXJzOiB7XG5cdFx0XHRcdCdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcblx0XHRcdH0sXG5cdFx0XHRib2R5OiBmdW5jdGlvbiBib2R5KHVybCwgY29uZmlnLCBwYXJhbXMpIHtcblx0XHRcdFx0cmV0dXJuIEpTT04uc3RyaW5naWZ5KHBhcmFtcyk7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRcImZvcm1cIjoge1xuXHRcdFx0aGVhZGVyczoge30sXG5cdFx0XHRib2R5OiBmdW5jdGlvbiBib2R5KHVybCwgY29uZmlnLCBwYXJhbXMpIHtcblx0XHRcdFx0dmFyIG91dHB1dCA9IHRoaXMuZ2VuZXJhdGVQYXJhbXNMaXN0KHBhcmFtcyksXG5cdFx0XHRcdCAgICBmb3JtID0gbmV3IEZvcm1EYXRhKCk7XG5cblx0XHRcdFx0b3V0cHV0LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdFx0XHRmb3JtLmFwcGVuZChpdGVtLmtleSwgaXRlbS52YWx1ZSk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHJldHVybiBmb3JtO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnJlZ2lzdGVyTW9kdWxlKFwiYWpheFwiLCBBamF4KTtcblxuXHR2YXIgQ29sdW1uQ2FsY3MgPSBmdW5jdGlvbiBDb2x1bW5DYWxjcyh0YWJsZSkge1xuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIFRhYnVsYXRvciBvYmplY3Rcblx0XHR0aGlzLnRvcENhbGNzID0gW107XG5cdFx0dGhpcy5ib3RDYWxjcyA9IFtdO1xuXHRcdHRoaXMuZ2VuQ29sdW1uID0gZmFsc2U7XG5cdFx0dGhpcy50b3BFbGVtZW50ID0gdGhpcy5jcmVhdGVFbGVtZW50KCk7XG5cdFx0dGhpcy5ib3RFbGVtZW50ID0gdGhpcy5jcmVhdGVFbGVtZW50KCk7XG5cdFx0dGhpcy50b3BSb3cgPSBmYWxzZTtcblx0XHR0aGlzLmJvdFJvdyA9IGZhbHNlO1xuXHRcdHRoaXMudG9wSW5pdGlhbGl6ZWQgPSBmYWxzZTtcblx0XHR0aGlzLmJvdEluaXRpYWxpemVkID0gZmFsc2U7XG5cblx0XHR0aGlzLmluaXRpYWxpemUoKTtcblx0fTtcblxuXHRDb2x1bW5DYWxjcy5wcm90b3R5cGUuY3JlYXRlRWxlbWVudCA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItY2FsY3MtaG9sZGVyXCIpO1xuXHRcdHJldHVybiBlbDtcblx0fTtcblxuXHRDb2x1bW5DYWxjcy5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcblx0XHR0aGlzLmdlbkNvbHVtbiA9IG5ldyBDb2x1bW4oeyBmaWVsZDogXCJ2YWx1ZVwiIH0sIHRoaXMpO1xuXHR9O1xuXG5cdC8vZHVtbXkgZnVuY3Rpb25zIHRvIGhhbmRsZSBiZWluZyBtb2NrIGNvbHVtbiBtYW5hZ2VyXG5cdENvbHVtbkNhbGNzLnByb3RvdHlwZS5yZWdpc3RlckNvbHVtbkZpZWxkID0gZnVuY3Rpb24gKCkge307XG5cblx0Ly9pbml0aWFsaXplIGNvbHVtbiBjYWxjc1xuXHRDb2x1bW5DYWxjcy5wcm90b3R5cGUuaW5pdGlhbGl6ZUNvbHVtbiA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHR2YXIgZGVmID0gY29sdW1uLmRlZmluaXRpb247XG5cblx0XHR2YXIgY29uZmlnID0ge1xuXHRcdFx0dG9wQ2FsY1BhcmFtczogZGVmLnRvcENhbGNQYXJhbXMgfHwge30sXG5cdFx0XHRib3RDYWxjUGFyYW1zOiBkZWYuYm90dG9tQ2FsY1BhcmFtcyB8fCB7fVxuXHRcdH07XG5cblx0XHRpZiAoZGVmLnRvcENhbGMpIHtcblxuXHRcdFx0c3dpdGNoIChfdHlwZW9mKGRlZi50b3BDYWxjKSkge1xuXHRcdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdFx0aWYgKHRoaXMuY2FsY3VsYXRpb25zW2RlZi50b3BDYWxjXSkge1xuXHRcdFx0XHRcdFx0Y29uZmlnLnRvcENhbGMgPSB0aGlzLmNhbGN1bGF0aW9uc1tkZWYudG9wQ2FsY107XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkNvbHVtbiBDYWxjIEVycm9yIC0gTm8gc3VjaCBjYWxjdWxhdGlvbiBmb3VuZCwgaWdub3Jpbmc6IFwiLCBkZWYudG9wQ2FsYyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgXCJmdW5jdGlvblwiOlxuXHRcdFx0XHRcdGNvbmZpZy50b3BDYWxjID0gZGVmLnRvcENhbGM7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdH1cblxuXHRcdFx0aWYgKGNvbmZpZy50b3BDYWxjKSB7XG5cdFx0XHRcdGNvbHVtbi5tb2R1bGVzLmNvbHVtbkNhbGNzID0gY29uZmlnO1xuXHRcdFx0XHR0aGlzLnRvcENhbGNzLnB1c2goY29sdW1uKTtcblxuXHRcdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmNvbHVtbkNhbGNzICE9IFwiZ3JvdXBcIikge1xuXHRcdFx0XHRcdHRoaXMuaW5pdGlhbGl6ZVRvcFJvdygpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKGRlZi5ib3R0b21DYWxjKSB7XG5cdFx0XHRzd2l0Y2ggKF90eXBlb2YoZGVmLmJvdHRvbUNhbGMpKSB7XG5cdFx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0XHRpZiAodGhpcy5jYWxjdWxhdGlvbnNbZGVmLmJvdHRvbUNhbGNdKSB7XG5cdFx0XHRcdFx0XHRjb25maWcuYm90Q2FsYyA9IHRoaXMuY2FsY3VsYXRpb25zW2RlZi5ib3R0b21DYWxjXTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiQ29sdW1uIENhbGMgRXJyb3IgLSBObyBzdWNoIGNhbGN1bGF0aW9uIGZvdW5kLCBpZ25vcmluZzogXCIsIGRlZi5ib3R0b21DYWxjKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSBcImZ1bmN0aW9uXCI6XG5cdFx0XHRcdFx0Y29uZmlnLmJvdENhbGMgPSBkZWYuYm90dG9tQ2FsYztcblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoY29uZmlnLmJvdENhbGMpIHtcblx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuY29sdW1uQ2FsY3MgPSBjb25maWc7XG5cdFx0XHRcdHRoaXMuYm90Q2FsY3MucHVzaChjb2x1bW4pO1xuXG5cdFx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1uQ2FsY3MgIT0gXCJncm91cFwiKSB7XG5cdFx0XHRcdFx0dGhpcy5pbml0aWFsaXplQm90dG9tUm93KCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Q29sdW1uQ2FsY3MucHJvdG90eXBlLnJlbW92ZUNhbGNzID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBjaGFuZ2VkID0gZmFsc2U7XG5cblx0XHRpZiAodGhpcy50b3BJbml0aWFsaXplZCkge1xuXHRcdFx0dGhpcy50b3BJbml0aWFsaXplZCA9IGZhbHNlO1xuXHRcdFx0dGhpcy50b3BFbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy50b3BFbGVtZW50KTtcblx0XHRcdGNoYW5nZWQgPSB0cnVlO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLmJvdEluaXRpYWxpemVkKSB7XG5cdFx0XHR0aGlzLmJvdEluaXRpYWxpemVkID0gZmFsc2U7XG5cdFx0XHR0aGlzLnRhYmxlLmZvb3Rlck1hbmFnZXIucmVtb3ZlKHRoaXMuYm90RWxlbWVudCk7XG5cdFx0XHRjaGFuZ2VkID0gdHJ1ZTtcblx0XHR9XG5cblx0XHRpZiAoY2hhbmdlZCkge1xuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmFkanVzdFRhYmxlU2l6ZSgpO1xuXHRcdH1cblx0fTtcblxuXHRDb2x1bW5DYWxjcy5wcm90b3R5cGUuaW5pdGlhbGl6ZVRvcFJvdyA9IGZ1bmN0aW9uICgpIHtcblx0XHRpZiAoIXRoaXMudG9wSW5pdGlhbGl6ZWQpIHtcblx0XHRcdC8vIHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5oZWFkZXJzRWxlbWVudC5hZnRlcih0aGlzLnRvcEVsZW1lbnQpO1xuXHRcdFx0dGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldEVsZW1lbnQoKS5pbnNlcnRCZWZvcmUodGhpcy50b3BFbGVtZW50LCB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuaGVhZGVyc0VsZW1lbnQubmV4dFNpYmxpbmcpO1xuXHRcdFx0dGhpcy50b3BJbml0aWFsaXplZCA9IHRydWU7XG5cdFx0fVxuXHR9O1xuXG5cdENvbHVtbkNhbGNzLnByb3RvdHlwZS5pbml0aWFsaXplQm90dG9tUm93ID0gZnVuY3Rpb24gKCkge1xuXHRcdGlmICghdGhpcy5ib3RJbml0aWFsaXplZCkge1xuXHRcdFx0dGhpcy50YWJsZS5mb290ZXJNYW5hZ2VyLnByZXBlbmQodGhpcy5ib3RFbGVtZW50KTtcblx0XHRcdHRoaXMuYm90SW5pdGlhbGl6ZWQgPSB0cnVlO1xuXHRcdH1cblx0fTtcblxuXHRDb2x1bW5DYWxjcy5wcm90b3R5cGUuc2Nyb2xsSG9yaXpvbnRhbCA9IGZ1bmN0aW9uIChsZWZ0KSB7XG5cdFx0dmFyIGhvekFkanVzdCA9IDAsXG5cdFx0ICAgIHNjcm9sbFdpZHRoID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldEVsZW1lbnQoKS5zY3JvbGxXaWR0aCAtIHRoaXMudGFibGUuZWxlbWVudC5jbGllbnRXaWR0aDtcblxuXHRcdGlmICh0aGlzLmJvdEluaXRpYWxpemVkKSB7XG5cdFx0XHR0aGlzLmJvdFJvdy5nZXRFbGVtZW50KCkuc3R5bGUubWFyZ2luTGVmdCA9IC1sZWZ0ICsgXCJweFwiO1xuXHRcdH1cblx0fTtcblxuXHRDb2x1bW5DYWxjcy5wcm90b3R5cGUucmVjYWxjID0gZnVuY3Rpb24gKHJvd3MpIHtcblx0XHR2YXIgZGF0YSwgcm93O1xuXG5cdFx0aWYgKHRoaXMudG9wSW5pdGlhbGl6ZWQgfHwgdGhpcy5ib3RJbml0aWFsaXplZCkge1xuXHRcdFx0ZGF0YSA9IHRoaXMucm93c1RvRGF0YShyb3dzKTtcblxuXHRcdFx0aWYgKHRoaXMudG9wSW5pdGlhbGl6ZWQpIHtcblx0XHRcdFx0aWYgKHRoaXMudG9wUm93KSB7XG5cdFx0XHRcdFx0dGhpcy50b3BSb3cuZGVsZXRlQ2VsbHMoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJvdyA9IHRoaXMuZ2VuZXJhdGVSb3coXCJ0b3BcIiwgdGhpcy5yb3dzVG9EYXRhKHJvd3MpKTtcblx0XHRcdFx0dGhpcy50b3BSb3cgPSByb3c7XG5cdFx0XHRcdHdoaWxlICh0aGlzLnRvcEVsZW1lbnQuZmlyc3RDaGlsZCkge1xuXHRcdFx0XHRcdHRoaXMudG9wRWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLnRvcEVsZW1lbnQuZmlyc3RDaGlsZCk7XG5cdFx0XHRcdH10aGlzLnRvcEVsZW1lbnQuYXBwZW5kQ2hpbGQocm93LmdldEVsZW1lbnQoKSk7XG5cdFx0XHRcdHJvdy5pbml0aWFsaXplKHRydWUpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGhpcy5ib3RJbml0aWFsaXplZCkge1xuXHRcdFx0XHRpZiAodGhpcy5ib3RSb3cpIHtcblx0XHRcdFx0XHR0aGlzLmJvdFJvdy5kZWxldGVDZWxscygpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cm93ID0gdGhpcy5nZW5lcmF0ZVJvdyhcImJvdHRvbVwiLCB0aGlzLnJvd3NUb0RhdGEocm93cykpO1xuXHRcdFx0XHR0aGlzLmJvdFJvdyA9IHJvdztcblx0XHRcdFx0d2hpbGUgKHRoaXMuYm90RWxlbWVudC5maXJzdENoaWxkKSB7XG5cdFx0XHRcdFx0dGhpcy5ib3RFbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMuYm90RWxlbWVudC5maXJzdENoaWxkKTtcblx0XHRcdFx0fXRoaXMuYm90RWxlbWVudC5hcHBlbmRDaGlsZChyb3cuZ2V0RWxlbWVudCgpKTtcblx0XHRcdFx0cm93LmluaXRpYWxpemUodHJ1ZSk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5hZGp1c3RUYWJsZVNpemUoKTtcblxuXHRcdFx0Ly9zZXQgcmVzaXphYmxlIGhhbmRsZXNcblx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImZyb3plbkNvbHVtbnNcIikpIHtcblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmZyb3plbkNvbHVtbnMubGF5b3V0KCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdENvbHVtbkNhbGNzLnByb3RvdHlwZS5yZWNhbGNSb3dHcm91cCA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR0aGlzLnJlY2FsY0dyb3VwKHRoaXMudGFibGUubW9kdWxlcy5ncm91cFJvd3MuZ2V0Um93R3JvdXAocm93KSk7XG5cdH07XG5cblx0Q29sdW1uQ2FsY3MucHJvdG90eXBlLnJlY2FsY0FsbCA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgX3RoaXMzNyA9IHRoaXM7XG5cblx0XHRpZiAodGhpcy50b3BDYWxjcy5sZW5ndGggfHwgdGhpcy5ib3RDYWxjcy5sZW5ndGgpIHtcblx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1uQ2FsY3MgIT09IFwiZ3JvdXBcIikge1xuXHRcdFx0XHR0aGlzLnJlY2FsYyh0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWN0aXZlUm93cyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSAmJiB0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1uQ2FsY3MgIT09IFwidGFibGVcIikge1xuXG5cdFx0XHRcdHZhciBncm91cHMgPSB0YWJsZS5tb2R1bGVzLmdyb3VwUm93cy5nZXRDaGlsZEdyb3VwcygpO1xuXG5cdFx0XHRcdGdyb3Vwcy5mb3JFYWNoKGZ1bmN0aW9uIChncm91cCkge1xuXHRcdFx0XHRcdF90aGlzMzcucmVjYWxjR3JvdXAoZ3JvdXApO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Q29sdW1uQ2FsY3MucHJvdG90eXBlLnJlY2FsY0dyb3VwID0gZnVuY3Rpb24gKGdyb3VwKSB7XG5cdFx0dmFyIGRhdGEsIHJvd0RhdGE7XG5cblx0XHRpZiAoZ3JvdXApIHtcblx0XHRcdGlmIChncm91cC5jYWxjcykge1xuXHRcdFx0XHRpZiAoZ3JvdXAuY2FsY3MuYm90dG9tKSB7XG5cdFx0XHRcdFx0ZGF0YSA9IHRoaXMucm93c1RvRGF0YShncm91cC5yb3dzKTtcblx0XHRcdFx0XHRyb3dEYXRhID0gdGhpcy5nZW5lcmF0ZVJvd0RhdGEoXCJib3R0b21cIiwgZGF0YSk7XG5cblx0XHRcdFx0XHRncm91cC5jYWxjcy5ib3R0b20udXBkYXRlRGF0YShyb3dEYXRhKTtcblx0XHRcdFx0XHRncm91cC5jYWxjcy5ib3R0b20ucmVpbml0aWFsaXplKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoZ3JvdXAuY2FsY3MudG9wKSB7XG5cdFx0XHRcdFx0ZGF0YSA9IHRoaXMucm93c1RvRGF0YShncm91cC5yb3dzKTtcblx0XHRcdFx0XHRyb3dEYXRhID0gdGhpcy5nZW5lcmF0ZVJvd0RhdGEoXCJ0b3BcIiwgZGF0YSk7XG5cblx0XHRcdFx0XHRncm91cC5jYWxjcy50b3AudXBkYXRlRGF0YShyb3dEYXRhKTtcblx0XHRcdFx0XHRncm91cC5jYWxjcy50b3AucmVpbml0aWFsaXplKCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Ly9nZW5lcmF0ZSB0b3Agc3RhdHMgcm93XG5cdENvbHVtbkNhbGNzLnByb3RvdHlwZS5nZW5lcmF0ZVRvcFJvdyA9IGZ1bmN0aW9uIChyb3dzKSB7XG5cdFx0cmV0dXJuIHRoaXMuZ2VuZXJhdGVSb3coXCJ0b3BcIiwgdGhpcy5yb3dzVG9EYXRhKHJvd3MpKTtcblx0fTtcblx0Ly9nZW5lcmF0ZSBib3R0b20gc3RhdHMgcm93XG5cdENvbHVtbkNhbGNzLnByb3RvdHlwZS5nZW5lcmF0ZUJvdHRvbVJvdyA9IGZ1bmN0aW9uIChyb3dzKSB7XG5cdFx0cmV0dXJuIHRoaXMuZ2VuZXJhdGVSb3coXCJib3R0b21cIiwgdGhpcy5yb3dzVG9EYXRhKHJvd3MpKTtcblx0fTtcblxuXHRDb2x1bW5DYWxjcy5wcm90b3R5cGUucm93c1RvRGF0YSA9IGZ1bmN0aW9uIChyb3dzKSB7XG5cdFx0dmFyIF90aGlzMzggPSB0aGlzO1xuXG5cdFx0dmFyIGRhdGEgPSBbXTtcblxuXHRcdHJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRkYXRhLnB1c2gocm93LmdldERhdGEoKSk7XG5cblx0XHRcdGlmIChfdGhpczM4LnRhYmxlLm9wdGlvbnMuZGF0YVRyZWUgJiYgX3RoaXMzOC50YWJsZS5vcHRpb25zLmRhdGFUcmVlQ2hpbGRDb2x1bW5DYWxjcykge1xuXHRcdFx0XHRpZiAocm93Lm1vZHVsZXMuZGF0YVRyZWUub3Blbikge1xuXHRcdFx0XHRcdHZhciBjaGlsZHJlbiA9IF90aGlzMzgucm93c1RvRGF0YShfdGhpczM4LnRhYmxlLm1vZHVsZXMuZGF0YVRyZWUuZ2V0RmlsdGVyZWRUcmVlQ2hpbGRyZW4ocm93KSk7XG5cdFx0XHRcdFx0ZGF0YSA9IGRhdGEuY29uY2F0KGNoaWxkcmVuKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGRhdGE7XG5cdH07XG5cblx0Ly9nZW5lcmF0ZSBzdGF0cyByb3dcblx0Q29sdW1uQ2FsY3MucHJvdG90eXBlLmdlbmVyYXRlUm93ID0gZnVuY3Rpb24gKHBvcywgZGF0YSkge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgcm93RGF0YSA9IHRoaXMuZ2VuZXJhdGVSb3dEYXRhKHBvcywgZGF0YSksXG5cdFx0ICAgIHJvdztcblxuXHRcdGlmIChzZWxmLnRhYmxlLm1vZEV4aXN0cyhcIm11dGF0b3JcIikpIHtcblx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5tdXRhdG9yLmRpc2FibGUoKTtcblx0XHR9XG5cblx0XHRyb3cgPSBuZXcgUm93KHJvd0RhdGEsIHRoaXMsIFwiY2FsY1wiKTtcblxuXHRcdGlmIChzZWxmLnRhYmxlLm1vZEV4aXN0cyhcIm11dGF0b3JcIikpIHtcblx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5tdXRhdG9yLmVuYWJsZSgpO1xuXHRcdH1cblxuXHRcdHJvdy5nZXRFbGVtZW50KCkuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1jYWxjc1wiLCBcInRhYnVsYXRvci1jYWxjcy1cIiArIHBvcyk7XG5cblx0XHRyb3cuZ2VuZXJhdGVDZWxscyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0dmFyIGNlbGxzID0gW107XG5cblx0XHRcdHNlbGYudGFibGUuY29sdW1uTWFuYWdlci5jb2x1bW5zQnlJbmRleC5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0XHQvL3NldCBmaWVsZCBuYW1lIG9mIG1vY2sgY29sdW1uXG5cdFx0XHRcdHNlbGYuZ2VuQ29sdW1uLnNldEZpZWxkKGNvbHVtbi5nZXRGaWVsZCgpKTtcblx0XHRcdFx0c2VsZi5nZW5Db2x1bW4uaG96QWxpZ24gPSBjb2x1bW4uaG96QWxpZ247XG5cblx0XHRcdFx0aWYgKGNvbHVtbi5kZWZpbml0aW9uW3BvcyArIFwiQ2FsY0Zvcm1hdHRlclwiXSAmJiBzZWxmLnRhYmxlLm1vZEV4aXN0cyhcImZvcm1hdFwiKSkge1xuXG5cdFx0XHRcdFx0c2VsZi5nZW5Db2x1bW4ubW9kdWxlcy5mb3JtYXQgPSB7XG5cdFx0XHRcdFx0XHRmb3JtYXR0ZXI6IHNlbGYudGFibGUubW9kdWxlcy5mb3JtYXQuZ2V0Rm9ybWF0dGVyKGNvbHVtbi5kZWZpbml0aW9uW3BvcyArIFwiQ2FsY0Zvcm1hdHRlclwiXSksXG5cdFx0XHRcdFx0XHRwYXJhbXM6IGNvbHVtbi5kZWZpbml0aW9uW3BvcyArIFwiQ2FsY0Zvcm1hdHRlclBhcmFtc1wiXVxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c2VsZi5nZW5Db2x1bW4ubW9kdWxlcy5mb3JtYXQgPSB7XG5cdFx0XHRcdFx0XHRmb3JtYXR0ZXI6IHNlbGYudGFibGUubW9kdWxlcy5mb3JtYXQuZ2V0Rm9ybWF0dGVyKFwicGxhaW50ZXh0XCIpLFxuXHRcdFx0XHRcdFx0cGFyYW1zOiB7fVxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvL2Vuc3VyZSBjc3MgY2xhc3MgZGVmaW50aW9uIGlzIHJlcGxpY2F0ZWQgdG8gY2FsY3VsYXRpb24gY2VsbFxuXHRcdFx0XHRzZWxmLmdlbkNvbHVtbi5kZWZpbml0aW9uLmNzc0NsYXNzID0gY29sdW1uLmRlZmluaXRpb24uY3NzQ2xhc3M7XG5cblx0XHRcdFx0Ly9nZW5lcmF0ZSBjZWxsIGFuZCBhc3NpZ24gdG8gY29ycmVjdCBjb2x1bW5cblx0XHRcdFx0dmFyIGNlbGwgPSBuZXcgQ2VsbChzZWxmLmdlbkNvbHVtbiwgcm93KTtcblx0XHRcdFx0Y2VsbC5jb2x1bW4gPSBjb2x1bW47XG5cdFx0XHRcdGNlbGwuc2V0V2lkdGgoKTtcblxuXHRcdFx0XHRjb2x1bW4uY2VsbHMucHVzaChjZWxsKTtcblx0XHRcdFx0Y2VsbHMucHVzaChjZWxsKTtcblxuXHRcdFx0XHRpZiAoIWNvbHVtbi52aXNpYmxlKSB7XG5cdFx0XHRcdFx0Y2VsbC5oaWRlKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLmNlbGxzID0gY2VsbHM7XG5cdFx0fTtcblxuXHRcdHJldHVybiByb3c7XG5cdH07XG5cblx0Ly9nZW5lcmF0ZSBzdGF0cyByb3dcblx0Q29sdW1uQ2FsY3MucHJvdG90eXBlLmdlbmVyYXRlUm93RGF0YSA9IGZ1bmN0aW9uIChwb3MsIGRhdGEpIHtcblx0XHR2YXIgcm93RGF0YSA9IHt9LFxuXHRcdCAgICBjYWxjcyA9IHBvcyA9PSBcInRvcFwiID8gdGhpcy50b3BDYWxjcyA6IHRoaXMuYm90Q2FsY3MsXG5cdFx0ICAgIHR5cGUgPSBwb3MgPT0gXCJ0b3BcIiA/IFwidG9wQ2FsY1wiIDogXCJib3RDYWxjXCIsXG5cdFx0ICAgIHBhcmFtcyxcblx0XHQgICAgcGFyYW1LZXk7XG5cblx0XHRjYWxjcy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdHZhciB2YWx1ZXMgPSBbXTtcblxuXHRcdFx0aWYgKGNvbHVtbi5tb2R1bGVzLmNvbHVtbkNhbGNzICYmIGNvbHVtbi5tb2R1bGVzLmNvbHVtbkNhbGNzW3R5cGVdKSB7XG5cdFx0XHRcdGRhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0XHRcdHZhbHVlcy5wdXNoKGNvbHVtbi5nZXRGaWVsZFZhbHVlKGl0ZW0pKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0cGFyYW1LZXkgPSB0eXBlICsgXCJQYXJhbXNcIjtcblx0XHRcdFx0cGFyYW1zID0gdHlwZW9mIGNvbHVtbi5tb2R1bGVzLmNvbHVtbkNhbGNzW3BhcmFtS2V5XSA9PT0gXCJmdW5jdGlvblwiID8gY29sdW1uLm1vZHVsZXMuY29sdW1uQ2FsY3NbcGFyYW1LZXldKHZhbHVlcywgZGF0YSkgOiBjb2x1bW4ubW9kdWxlcy5jb2x1bW5DYWxjc1twYXJhbUtleV07XG5cblx0XHRcdFx0Y29sdW1uLnNldEZpZWxkVmFsdWUocm93RGF0YSwgY29sdW1uLm1vZHVsZXMuY29sdW1uQ2FsY3NbdHlwZV0odmFsdWVzLCBkYXRhLCBwYXJhbXMpKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiByb3dEYXRhO1xuXHR9O1xuXG5cdENvbHVtbkNhbGNzLnByb3RvdHlwZS5oYXNUb3BDYWxjcyA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gISF0aGlzLnRvcENhbGNzLmxlbmd0aDtcblx0fTtcblxuXHRDb2x1bW5DYWxjcy5wcm90b3R5cGUuaGFzQm90dG9tQ2FsY3MgPSBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuICEhdGhpcy5ib3RDYWxjcy5sZW5ndGg7XG5cdH07XG5cblx0Ly9oYW5kbGUgdGFibGUgcmVkcmF3XG5cdENvbHVtbkNhbGNzLnByb3RvdHlwZS5yZWRyYXcgPSBmdW5jdGlvbiAoKSB7XG5cdFx0aWYgKHRoaXMudG9wUm93KSB7XG5cdFx0XHR0aGlzLnRvcFJvdy5ub3JtYWxpemVIZWlnaHQodHJ1ZSk7XG5cdFx0fVxuXHRcdGlmICh0aGlzLmJvdFJvdykge1xuXHRcdFx0dGhpcy5ib3RSb3cubm9ybWFsaXplSGVpZ2h0KHRydWUpO1xuXHRcdH1cblx0fTtcblxuXHQvL3JldHVybiB0aGUgY2FsY3VsYXRlZFxuXHRDb2x1bW5DYWxjcy5wcm90b3R5cGUuZ2V0UmVzdWx0cyA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHJlc3VsdHMgPSB7fSxcblx0XHQgICAgZ3JvdXBzO1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiZ3JvdXBSb3dzXCIpKSB7XG5cdFx0XHRncm91cHMgPSB0aGlzLnRhYmxlLm1vZHVsZXMuZ3JvdXBSb3dzLmdldEdyb3Vwcyh0cnVlKTtcblxuXHRcdFx0Z3JvdXBzLmZvckVhY2goZnVuY3Rpb24gKGdyb3VwKSB7XG5cdFx0XHRcdHJlc3VsdHNbZ3JvdXAuZ2V0S2V5KCldID0gc2VsZi5nZXRHcm91cFJlc3VsdHMoZ3JvdXApO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJlc3VsdHMgPSB7XG5cdFx0XHRcdHRvcDogdGhpcy50b3BSb3cgPyB0aGlzLnRvcFJvdy5nZXREYXRhKCkgOiB7fSxcblx0XHRcdFx0Ym90dG9tOiB0aGlzLmJvdFJvdyA/IHRoaXMuYm90Um93LmdldERhdGEoKSA6IHt9XG5cdFx0XHR9O1xuXHRcdH1cblxuXHRcdHJldHVybiByZXN1bHRzO1xuXHR9O1xuXG5cdC8vZ2V0IHJlc3VsdHMgZnJvbSBhIGdyb3VwXG5cdENvbHVtbkNhbGNzLnByb3RvdHlwZS5nZXRHcm91cFJlc3VsdHMgPSBmdW5jdGlvbiAoZ3JvdXApIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGdyb3VwT2JqID0gZ3JvdXAuX2dldFNlbGYoKSxcblx0XHQgICAgc3ViR3JvdXBzID0gZ3JvdXAuZ2V0U3ViR3JvdXBzKCksXG5cdFx0ICAgIHN1Ykdyb3VwUmVzdWx0cyA9IHt9LFxuXHRcdCAgICByZXN1bHRzID0ge307XG5cblx0XHRzdWJHcm91cHMuZm9yRWFjaChmdW5jdGlvbiAoc3ViZ3JvdXApIHtcblx0XHRcdHN1Ykdyb3VwUmVzdWx0c1tzdWJncm91cC5nZXRLZXkoKV0gPSBzZWxmLmdldEdyb3VwUmVzdWx0cyhzdWJncm91cCk7XG5cdFx0fSk7XG5cblx0XHRyZXN1bHRzID0ge1xuXHRcdFx0dG9wOiBncm91cE9iai5jYWxjcy50b3AgPyBncm91cE9iai5jYWxjcy50b3AuZ2V0RGF0YSgpIDoge30sXG5cdFx0XHRib3R0b206IGdyb3VwT2JqLmNhbGNzLmJvdHRvbSA/IGdyb3VwT2JqLmNhbGNzLmJvdHRvbS5nZXREYXRhKCkgOiB7fSxcblx0XHRcdGdyb3Vwczogc3ViR3JvdXBSZXN1bHRzXG5cdFx0fTtcblxuXHRcdHJldHVybiByZXN1bHRzO1xuXHR9O1xuXG5cdC8vZGVmYXVsdCBjYWxjdWxhdGlvbnNcblx0Q29sdW1uQ2FsY3MucHJvdG90eXBlLmNhbGN1bGF0aW9ucyA9IHtcblx0XHRcImF2Z1wiOiBmdW5jdGlvbiBhdmcodmFsdWVzLCBkYXRhLCBjYWxjUGFyYW1zKSB7XG5cdFx0XHR2YXIgb3V0cHV0ID0gMCxcblx0XHRcdCAgICBwcmVjaXNpb24gPSB0eXBlb2YgY2FsY1BhcmFtcy5wcmVjaXNpb24gIT09IFwidW5kZWZpbmVkXCIgPyBjYWxjUGFyYW1zLnByZWNpc2lvbiA6IDI7XG5cblx0XHRcdGlmICh2YWx1ZXMubGVuZ3RoKSB7XG5cdFx0XHRcdG91dHB1dCA9IHZhbHVlcy5yZWR1Y2UoZnVuY3Rpb24gKHN1bSwgdmFsdWUpIHtcblx0XHRcdFx0XHR2YWx1ZSA9IE51bWJlcih2YWx1ZSk7XG5cdFx0XHRcdFx0cmV0dXJuIHN1bSArIHZhbHVlO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRvdXRwdXQgPSBvdXRwdXQgLyB2YWx1ZXMubGVuZ3RoO1xuXG5cdFx0XHRcdG91dHB1dCA9IHByZWNpc2lvbiAhPT0gZmFsc2UgPyBvdXRwdXQudG9GaXhlZChwcmVjaXNpb24pIDogb3V0cHV0O1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gcGFyc2VGbG9hdChvdXRwdXQpLnRvU3RyaW5nKCk7XG5cdFx0fSxcblx0XHRcIm1heFwiOiBmdW5jdGlvbiBtYXgodmFsdWVzLCBkYXRhLCBjYWxjUGFyYW1zKSB7XG5cdFx0XHR2YXIgb3V0cHV0ID0gbnVsbCxcblx0XHRcdCAgICBwcmVjaXNpb24gPSB0eXBlb2YgY2FsY1BhcmFtcy5wcmVjaXNpb24gIT09IFwidW5kZWZpbmVkXCIgPyBjYWxjUGFyYW1zLnByZWNpc2lvbiA6IGZhbHNlO1xuXG5cdFx0XHR2YWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHtcblxuXHRcdFx0XHR2YWx1ZSA9IE51bWJlcih2YWx1ZSk7XG5cblx0XHRcdFx0aWYgKHZhbHVlID4gb3V0cHV0IHx8IG91dHB1dCA9PT0gbnVsbCkge1xuXHRcdFx0XHRcdG91dHB1dCA9IHZhbHVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIG91dHB1dCAhPT0gbnVsbCA/IHByZWNpc2lvbiAhPT0gZmFsc2UgPyBvdXRwdXQudG9GaXhlZChwcmVjaXNpb24pIDogb3V0cHV0IDogXCJcIjtcblx0XHR9LFxuXHRcdFwibWluXCI6IGZ1bmN0aW9uIG1pbih2YWx1ZXMsIGRhdGEsIGNhbGNQYXJhbXMpIHtcblx0XHRcdHZhciBvdXRwdXQgPSBudWxsLFxuXHRcdFx0ICAgIHByZWNpc2lvbiA9IHR5cGVvZiBjYWxjUGFyYW1zLnByZWNpc2lvbiAhPT0gXCJ1bmRlZmluZWRcIiA/IGNhbGNQYXJhbXMucHJlY2lzaW9uIDogZmFsc2U7XG5cblx0XHRcdHZhbHVlcy5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkge1xuXG5cdFx0XHRcdHZhbHVlID0gTnVtYmVyKHZhbHVlKTtcblxuXHRcdFx0XHRpZiAodmFsdWUgPCBvdXRwdXQgfHwgb3V0cHV0ID09PSBudWxsKSB7XG5cdFx0XHRcdFx0b3V0cHV0ID0gdmFsdWU7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gb3V0cHV0ICE9PSBudWxsID8gcHJlY2lzaW9uICE9PSBmYWxzZSA/IG91dHB1dC50b0ZpeGVkKHByZWNpc2lvbikgOiBvdXRwdXQgOiBcIlwiO1xuXHRcdH0sXG5cdFx0XCJzdW1cIjogZnVuY3Rpb24gc3VtKHZhbHVlcywgZGF0YSwgY2FsY1BhcmFtcykge1xuXHRcdFx0dmFyIG91dHB1dCA9IDAsXG5cdFx0XHQgICAgcHJlY2lzaW9uID0gdHlwZW9mIGNhbGNQYXJhbXMucHJlY2lzaW9uICE9PSBcInVuZGVmaW5lZFwiID8gY2FsY1BhcmFtcy5wcmVjaXNpb24gOiBmYWxzZTtcblxuXHRcdFx0aWYgKHZhbHVlcy5sZW5ndGgpIHtcblx0XHRcdFx0dmFsdWVzLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0XHRcdFx0dmFsdWUgPSBOdW1iZXIodmFsdWUpO1xuXG5cdFx0XHRcdFx0b3V0cHV0ICs9ICFpc05hTih2YWx1ZSkgPyBOdW1iZXIodmFsdWUpIDogMDtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBwcmVjaXNpb24gIT09IGZhbHNlID8gb3V0cHV0LnRvRml4ZWQocHJlY2lzaW9uKSA6IG91dHB1dDtcblx0XHR9LFxuXHRcdFwiY29uY2F0XCI6IGZ1bmN0aW9uIGNvbmNhdCh2YWx1ZXMsIGRhdGEsIGNhbGNQYXJhbXMpIHtcblx0XHRcdHZhciBvdXRwdXQgPSAwO1xuXG5cdFx0XHRpZiAodmFsdWVzLmxlbmd0aCkge1xuXHRcdFx0XHRvdXRwdXQgPSB2YWx1ZXMucmVkdWNlKGZ1bmN0aW9uIChzdW0sIHZhbHVlKSB7XG5cdFx0XHRcdFx0cmV0dXJuIFN0cmluZyhzdW0pICsgU3RyaW5nKHZhbHVlKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBvdXRwdXQ7XG5cdFx0fSxcblx0XHRcImNvdW50XCI6IGZ1bmN0aW9uIGNvdW50KHZhbHVlcywgZGF0YSwgY2FsY1BhcmFtcykge1xuXHRcdFx0dmFyIG91dHB1dCA9IDA7XG5cblx0XHRcdGlmICh2YWx1ZXMubGVuZ3RoKSB7XG5cdFx0XHRcdHZhbHVlcy5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdFx0XHRcdGlmICh2YWx1ZSkge1xuXHRcdFx0XHRcdFx0b3V0cHV0Kys7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG91dHB1dDtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcImNvbHVtbkNhbGNzXCIsIENvbHVtbkNhbGNzKTtcblxuXHR2YXIgQ2xpcGJvYXJkID0gZnVuY3Rpb24gQ2xpcGJvYXJkKHRhYmxlKSB7XG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlO1xuXHRcdHRoaXMubW9kZSA9IHRydWU7XG5cblx0XHR0aGlzLnBhc3RlUGFyc2VyID0gZnVuY3Rpb24gKCkge307XG5cdFx0dGhpcy5wYXN0ZUFjdGlvbiA9IGZ1bmN0aW9uICgpIHt9O1xuXHRcdHRoaXMuY3VzdG9tU2VsZWN0aW9uID0gZmFsc2U7XG5cdFx0dGhpcy5yb3dSYW5nZSA9IGZhbHNlO1xuXHRcdHRoaXMuYmxvY2tlZCA9IHRydWU7IC8vYmxvY2sgY29weSBhY3Rpb25zIG5vdCBvcmlnaW5hdGluZyBmcm9tIHRoaXMgY29tbWFuZFxuXHR9O1xuXG5cdENsaXBib2FyZC5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgX3RoaXMzOSA9IHRoaXM7XG5cblx0XHR0aGlzLm1vZGUgPSB0aGlzLnRhYmxlLm9wdGlvbnMuY2xpcGJvYXJkO1xuXG5cdFx0dGhpcy5yb3dSYW5nZSA9IHRoaXMudGFibGUub3B0aW9ucy5jbGlwYm9hcmRDb3B5Um93UmFuZ2U7XG5cblx0XHRpZiAodGhpcy5tb2RlID09PSB0cnVlIHx8IHRoaXMubW9kZSA9PT0gXCJjb3B5XCIpIHtcblx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY29weVwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHR2YXIgcGxhaW4sIGh0bWwsIGxpc3Q7XG5cblx0XHRcdFx0aWYgKCFfdGhpczM5LmJsb2NrZWQpIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdFx0XHRpZiAoX3RoaXMzOS5jdXN0b21TZWxlY3Rpb24pIHtcblx0XHRcdFx0XHRcdHBsYWluID0gX3RoaXMzOS5jdXN0b21TZWxlY3Rpb247XG5cblx0XHRcdFx0XHRcdGlmIChfdGhpczM5LnRhYmxlLm9wdGlvbnMuY2xpcGJvYXJkQ29weUZvcm1hdHRlcikge1xuXHRcdFx0XHRcdFx0XHRwbGFpbiA9IF90aGlzMzkudGFibGUub3B0aW9ucy5jbGlwYm9hcmRDb3B5Rm9ybWF0dGVyKFwicGxhaW5cIiwgcGxhaW4pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdHZhciBsaXN0ID0gX3RoaXMzOS50YWJsZS5tb2R1bGVzLmV4cG9ydC5nZW5lcmF0ZUV4cG9ydExpc3QoX3RoaXMzOS5yb3dSYW5nZSwgX3RoaXMzOS50YWJsZS5vcHRpb25zLmNsaXBib2FyZENvcHlTdHlsZWQsIF90aGlzMzkudGFibGUub3B0aW9ucy5jbGlwYm9hcmRDb3B5Q29uZmlnLCBcImNsaXBib2FyZFwiKTtcblxuXHRcdFx0XHRcdFx0aHRtbCA9IF90aGlzMzkudGFibGUubW9kdWxlcy5leHBvcnQuZ2VuZXJlYXRlSFRNTFRhYmxlKGxpc3QpO1xuXHRcdFx0XHRcdFx0cGxhaW4gPSBodG1sID8gX3RoaXMzOS5nZW5lcmF0ZVBsYWluQ29udGVudChsaXN0KSA6IFwiXCI7XG5cblx0XHRcdFx0XHRcdGlmIChfdGhpczM5LnRhYmxlLm9wdGlvbnMuY2xpcGJvYXJkQ29weUZvcm1hdHRlcikge1xuXHRcdFx0XHRcdFx0XHRwbGFpbiA9IF90aGlzMzkudGFibGUub3B0aW9ucy5jbGlwYm9hcmRDb3B5Rm9ybWF0dGVyKFwicGxhaW5cIiwgcGxhaW4pO1xuXHRcdFx0XHRcdFx0XHRodG1sID0gX3RoaXMzOS50YWJsZS5vcHRpb25zLmNsaXBib2FyZENvcHlGb3JtYXR0ZXIoXCJodG1sXCIsIGh0bWwpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh3aW5kb3cuY2xpcGJvYXJkRGF0YSAmJiB3aW5kb3cuY2xpcGJvYXJkRGF0YS5zZXREYXRhKSB7XG5cdFx0XHRcdFx0XHR3aW5kb3cuY2xpcGJvYXJkRGF0YS5zZXREYXRhKCdUZXh0JywgcGxhaW4pO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAoZS5jbGlwYm9hcmREYXRhICYmIGUuY2xpcGJvYXJkRGF0YS5zZXREYXRhKSB7XG5cdFx0XHRcdFx0XHRlLmNsaXBib2FyZERhdGEuc2V0RGF0YSgndGV4dC9wbGFpbicsIHBsYWluKTtcblx0XHRcdFx0XHRcdGlmIChodG1sKSB7XG5cdFx0XHRcdFx0XHRcdGUuY2xpcGJvYXJkRGF0YS5zZXREYXRhKCd0ZXh0L2h0bWwnLCBodG1sKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2UgaWYgKGUub3JpZ2luYWxFdmVudCAmJiBlLm9yaWdpbmFsRXZlbnQuY2xpcGJvYXJkRGF0YS5zZXREYXRhKSB7XG5cdFx0XHRcdFx0XHRlLm9yaWdpbmFsRXZlbnQuY2xpcGJvYXJkRGF0YS5zZXREYXRhKCd0ZXh0L3BsYWluJywgcGxhaW4pO1xuXHRcdFx0XHRcdFx0aWYgKGh0bWwpIHtcblx0XHRcdFx0XHRcdFx0ZS5vcmlnaW5hbEV2ZW50LmNsaXBib2FyZERhdGEuc2V0RGF0YSgndGV4dC9odG1sJywgaHRtbCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0X3RoaXMzOS50YWJsZS5vcHRpb25zLmNsaXBib2FyZENvcGllZC5jYWxsKF90aGlzMzkudGFibGUsIHBsYWluLCBodG1sKTtcblxuXHRcdFx0XHRcdF90aGlzMzkucmVzZXQoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMubW9kZSA9PT0gdHJ1ZSB8fCB0aGlzLm1vZGUgPT09IFwicGFzdGVcIikge1xuXHRcdFx0dGhpcy50YWJsZS5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJwYXN0ZVwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRfdGhpczM5LnBhc3RlKGUpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0dGhpcy5zZXRQYXN0ZVBhcnNlcih0aGlzLnRhYmxlLm9wdGlvbnMuY2xpcGJvYXJkUGFzdGVQYXJzZXIpO1xuXHRcdHRoaXMuc2V0UGFzdGVBY3Rpb24odGhpcy50YWJsZS5vcHRpb25zLmNsaXBib2FyZFBhc3RlQWN0aW9uKTtcblx0fTtcblxuXHRDbGlwYm9hcmQucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMuYmxvY2tlZCA9IGZhbHNlO1xuXHRcdHRoaXMub3JpZ2luYWxTZWxlY3Rpb25UZXh0ID0gXCJcIjtcblx0fTtcblxuXHRDbGlwYm9hcmQucHJvdG90eXBlLmdlbmVyYXRlUGxhaW5Db250ZW50ID0gZnVuY3Rpb24gKGxpc3QpIHtcblx0XHR2YXIgb3V0cHV0ID0gW107XG5cblx0XHRsaXN0LmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0dmFyIHJvd0RhdGEgPSBbXTtcblxuXHRcdFx0cm93LmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sKSB7XG5cdFx0XHRcdHZhciB2YWx1ZSA9IFwiXCI7XG5cblx0XHRcdFx0aWYgKGNvbCkge1xuXG5cdFx0XHRcdFx0aWYgKHJvdy50eXBlID09PSBcImdyb3VwXCIpIHtcblx0XHRcdFx0XHRcdGNvbC52YWx1ZSA9IGNvbC5jb21wb25lbnQuZ2V0S2V5KCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0c3dpdGNoIChfdHlwZW9mKGNvbC52YWx1ZSkpIHtcblx0XHRcdFx0XHRcdGNhc2UgXCJvYmplY3RcIjpcblx0XHRcdFx0XHRcdFx0dmFsdWUgPSBKU09OLnN0cmluZ2lmeShjb2wudmFsdWUpO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0Y2FzZSBcInVuZGVmaW5lZFwiOlxuXHRcdFx0XHRcdFx0Y2FzZSBcIm51bGxcIjpcblx0XHRcdFx0XHRcdFx0dmFsdWUgPSBcIlwiO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRcdFx0dmFsdWUgPSBjb2wudmFsdWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cm93RGF0YS5wdXNoKHZhbHVlKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRvdXRwdXQucHVzaChyb3dEYXRhLmpvaW4oXCJcXHRcIikpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG91dHB1dC5qb2luKFwiXFxuXCIpO1xuXHR9O1xuXG5cdENsaXBib2FyZC5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uIChyYW5nZSwgaW50ZXJuYWwpIHtcblx0XHR2YXIgcmFuZ2UsIHNlbCwgdGV4dFJhbmdlO1xuXHRcdHRoaXMuYmxvY2tlZCA9IGZhbHNlO1xuXHRcdHRoaXMuY3VzdG9tU2VsZWN0aW9uID0gZmFsc2U7XG5cblx0XHRpZiAodGhpcy5tb2RlID09PSB0cnVlIHx8IHRoaXMubW9kZSA9PT0gXCJjb3B5XCIpIHtcblxuXHRcdFx0dGhpcy5yb3dSYW5nZSA9IHJhbmdlIHx8IHRoaXMudGFibGUub3B0aW9ucy5jbGlwYm9hcmRDb3B5Um93UmFuZ2U7XG5cblx0XHRcdGlmICh0eXBlb2Ygd2luZG93LmdldFNlbGVjdGlvbiAhPSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZiBkb2N1bWVudC5jcmVhdGVSYW5nZSAhPSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdHJhbmdlID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtcblx0XHRcdFx0cmFuZ2Uuc2VsZWN0Tm9kZUNvbnRlbnRzKHRoaXMudGFibGUuZWxlbWVudCk7XG5cdFx0XHRcdHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTtcblxuXHRcdFx0XHRpZiAoc2VsLnRvU3RyaW5nKCkgJiYgaW50ZXJuYWwpIHtcblx0XHRcdFx0XHR0aGlzLmN1c3RvbVNlbGVjdGlvbiA9IHNlbC50b1N0cmluZygpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsLnJlbW92ZUFsbFJhbmdlcygpO1xuXHRcdFx0XHRzZWwuYWRkUmFuZ2UocmFuZ2UpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YgZG9jdW1lbnQuc2VsZWN0aW9uICE9IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mIGRvY3VtZW50LmJvZHkuY3JlYXRlVGV4dFJhbmdlICE9IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0dGV4dFJhbmdlID0gZG9jdW1lbnQuYm9keS5jcmVhdGVUZXh0UmFuZ2UoKTtcblx0XHRcdFx0dGV4dFJhbmdlLm1vdmVUb0VsZW1lbnRUZXh0KHRoaXMudGFibGUuZWxlbWVudCk7XG5cdFx0XHRcdHRleHRSYW5nZS5zZWxlY3QoKTtcblx0XHRcdH1cblxuXHRcdFx0ZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2NvcHknKTtcblxuXHRcdFx0aWYgKHNlbCkge1xuXHRcdFx0XHRzZWwucmVtb3ZlQWxsUmFuZ2VzKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdC8vUEFTVEUgRVZFTlQgSEFORExJTkdcblxuXHRDbGlwYm9hcmQucHJvdG90eXBlLnNldFBhc3RlQWN0aW9uID0gZnVuY3Rpb24gKGFjdGlvbikge1xuXG5cdFx0c3dpdGNoICh0eXBlb2YgYWN0aW9uID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihhY3Rpb24pKSB7XG5cdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdHRoaXMucGFzdGVBY3Rpb24gPSB0aGlzLnBhc3RlQWN0aW9uc1thY3Rpb25dO1xuXG5cdFx0XHRcdGlmICghdGhpcy5wYXN0ZUFjdGlvbikge1xuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkNsaXBib2FyZCBFcnJvciAtIE5vIHN1Y2ggcGFzdGUgYWN0aW9uIGZvdW5kOlwiLCBhY3Rpb24pO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0dGhpcy5wYXN0ZUFjdGlvbiA9IGFjdGlvbjtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9O1xuXG5cdENsaXBib2FyZC5wcm90b3R5cGUuc2V0UGFzdGVQYXJzZXIgPSBmdW5jdGlvbiAocGFyc2VyKSB7XG5cdFx0c3dpdGNoICh0eXBlb2YgcGFyc2VyID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihwYXJzZXIpKSB7XG5cdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdHRoaXMucGFzdGVQYXJzZXIgPSB0aGlzLnBhc3RlUGFyc2Vyc1twYXJzZXJdO1xuXG5cdFx0XHRcdGlmICghdGhpcy5wYXN0ZVBhcnNlcikge1xuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkNsaXBib2FyZCBFcnJvciAtIE5vIHN1Y2ggcGFzdGUgcGFyc2VyIGZvdW5kOlwiLCBwYXJzZXIpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0dGhpcy5wYXN0ZVBhcnNlciA9IHBhcnNlcjtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9O1xuXG5cdENsaXBib2FyZC5wcm90b3R5cGUucGFzdGUgPSBmdW5jdGlvbiAoZSkge1xuXHRcdHZhciBkYXRhLCByb3dEYXRhLCByb3dzO1xuXG5cdFx0aWYgKHRoaXMuY2hlY2tQYXNlT3JpZ2luKGUpKSB7XG5cblx0XHRcdGRhdGEgPSB0aGlzLmdldFBhc3RlRGF0YShlKTtcblxuXHRcdFx0cm93RGF0YSA9IHRoaXMucGFzdGVQYXJzZXIuY2FsbCh0aGlzLCBkYXRhKTtcblxuXHRcdFx0aWYgKHJvd0RhdGEpIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcIm11dGF0b3JcIikpIHtcblx0XHRcdFx0XHRyb3dEYXRhID0gdGhpcy5tdXRhdGVEYXRhKHJvd0RhdGEpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cm93cyA9IHRoaXMucGFzdGVBY3Rpb24uY2FsbCh0aGlzLCByb3dEYXRhKTtcblx0XHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLmNsaXBib2FyZFBhc3RlZC5jYWxsKHRoaXMudGFibGUsIGRhdGEsIHJvd0RhdGEsIHJvd3MpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLmNsaXBib2FyZFBhc3RlRXJyb3IuY2FsbCh0aGlzLnRhYmxlLCBkYXRhKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Q2xpcGJvYXJkLnByb3RvdHlwZS5tdXRhdGVEYXRhID0gZnVuY3Rpb24gKGRhdGEpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIG91dHB1dCA9IFtdO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHtcblx0XHRcdGRhdGEuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRcdG91dHB1dC5wdXNoKHNlbGYudGFibGUubW9kdWxlcy5tdXRhdG9yLnRyYW5zZm9ybVJvdyhyb3csIFwiY2xpcGJvYXJkXCIpKTtcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRvdXRwdXQgPSBkYXRhO1xuXHRcdH1cblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0Q2xpcGJvYXJkLnByb3RvdHlwZS5jaGVja1Bhc2VPcmlnaW4gPSBmdW5jdGlvbiAoZSkge1xuXHRcdHZhciB2YWxpZCA9IHRydWU7XG5cblx0XHRpZiAoZS50YXJnZXQudGFnTmFtZSAhPSBcIkRJVlwiIHx8IHRoaXMudGFibGUubW9kdWxlcy5lZGl0LmN1cnJlbnRDZWxsKSB7XG5cdFx0XHR2YWxpZCA9IGZhbHNlO1xuXHRcdH1cblxuXHRcdHJldHVybiB2YWxpZDtcblx0fTtcblxuXHRDbGlwYm9hcmQucHJvdG90eXBlLmdldFBhc3RlRGF0YSA9IGZ1bmN0aW9uIChlKSB7XG5cdFx0dmFyIGRhdGE7XG5cblx0XHRpZiAod2luZG93LmNsaXBib2FyZERhdGEgJiYgd2luZG93LmNsaXBib2FyZERhdGEuZ2V0RGF0YSkge1xuXHRcdFx0ZGF0YSA9IHdpbmRvdy5jbGlwYm9hcmREYXRhLmdldERhdGEoJ1RleHQnKTtcblx0XHR9IGVsc2UgaWYgKGUuY2xpcGJvYXJkRGF0YSAmJiBlLmNsaXBib2FyZERhdGEuZ2V0RGF0YSkge1xuXHRcdFx0ZGF0YSA9IGUuY2xpcGJvYXJkRGF0YS5nZXREYXRhKCd0ZXh0L3BsYWluJyk7XG5cdFx0fSBlbHNlIGlmIChlLm9yaWdpbmFsRXZlbnQgJiYgZS5vcmlnaW5hbEV2ZW50LmNsaXBib2FyZERhdGEuZ2V0RGF0YSkge1xuXHRcdFx0ZGF0YSA9IGUub3JpZ2luYWxFdmVudC5jbGlwYm9hcmREYXRhLmdldERhdGEoJ3RleHQvcGxhaW4nKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZGF0YTtcblx0fTtcblxuXHRDbGlwYm9hcmQucHJvdG90eXBlLnBhc3RlUGFyc2VycyA9IHtcblx0XHR0YWJsZTogZnVuY3Rpb24gdGFibGUoY2xpcGJvYXJkKSB7XG5cdFx0XHR2YXIgZGF0YSA9IFtdLFxuXHRcdFx0ICAgIHN1Y2Nlc3MgPSBmYWxzZSxcblx0XHRcdCAgICBoZWFkZXJGaW5kU3VjY2VzcyA9IHRydWUsXG5cdFx0XHQgICAgY29sdW1ucyA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5jb2x1bW5zLFxuXHRcdFx0ICAgIGNvbHVtbk1hcCA9IFtdLFxuXHRcdFx0ICAgIHJvd3MgPSBbXTtcblxuXHRcdFx0Ly9nZXQgZGF0YSBmcm9tIGNsaXBib2FyZCBpbnRvIGFycmF5IG9mIGNvbHVtbnMgYW5kIHJvd3MuXG5cdFx0XHRjbGlwYm9hcmQgPSBjbGlwYm9hcmQuc3BsaXQoXCJcXG5cIik7XG5cblx0XHRcdGNsaXBib2FyZC5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0ZGF0YS5wdXNoKHJvdy5zcGxpdChcIlxcdFwiKSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKGRhdGEubGVuZ3RoICYmICEoZGF0YS5sZW5ndGggPT09IDEgJiYgZGF0YVswXS5sZW5ndGggPCAyKSkge1xuXHRcdFx0XHRzdWNjZXNzID0gdHJ1ZTtcblxuXHRcdFx0XHQvL2NoZWNrIGlmIGhlYWRlcnMgYXJlIHByZXNlbnQgYnkgdGl0bGVcblx0XHRcdFx0ZGF0YVswXS5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdFx0XHRcdHZhciBjb2x1bW4gPSBjb2x1bW5zLmZpbmQoZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlICYmIGNvbHVtbi5kZWZpbml0aW9uLnRpdGxlICYmIHZhbHVlLnRyaW0oKSAmJiBjb2x1bW4uZGVmaW5pdGlvbi50aXRsZS50cmltKCkgPT09IHZhbHVlLnRyaW0oKTtcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdGlmIChjb2x1bW4pIHtcblx0XHRcdFx0XHRcdGNvbHVtbk1hcC5wdXNoKGNvbHVtbik7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGhlYWRlckZpbmRTdWNjZXNzID0gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHQvL2NoZWNrIGlmIGNvbHVtbiBoZWFkZXJzIGFyZSBwcmVzZW50IGJ5IGZpZWxkXG5cdFx0XHRcdGlmICghaGVhZGVyRmluZFN1Y2Nlc3MpIHtcblx0XHRcdFx0XHRoZWFkZXJGaW5kU3VjY2VzcyA9IHRydWU7XG5cdFx0XHRcdFx0Y29sdW1uTWFwID0gW107XG5cblx0XHRcdFx0XHRkYXRhWzBdLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0XHRcdFx0XHR2YXIgY29sdW1uID0gY29sdW1ucy5maW5kKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlICYmIGNvbHVtbi5maWVsZCAmJiB2YWx1ZS50cmltKCkgJiYgY29sdW1uLmZpZWxkLnRyaW0oKSA9PT0gdmFsdWUudHJpbSgpO1xuXHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdGlmIChjb2x1bW4pIHtcblx0XHRcdFx0XHRcdFx0Y29sdW1uTWFwLnB1c2goY29sdW1uKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGhlYWRlckZpbmRTdWNjZXNzID0gZmFsc2U7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRpZiAoIWhlYWRlckZpbmRTdWNjZXNzKSB7XG5cdFx0XHRcdFx0XHRjb2x1bW5NYXAgPSB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuY29sdW1uc0J5SW5kZXg7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly9yZW1vdmUgaGVhZGVyIHJvdyBpZiBmb3VuZFxuXHRcdFx0XHRpZiAoaGVhZGVyRmluZFN1Y2Nlc3MpIHtcblx0XHRcdFx0XHRkYXRhLnNoaWZ0KCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRkYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdFx0XHR2YXIgcm93ID0ge307XG5cblx0XHRcdFx0XHRpdGVtLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlLCBpKSB7XG5cdFx0XHRcdFx0XHRpZiAoY29sdW1uTWFwW2ldKSB7XG5cdFx0XHRcdFx0XHRcdHJvd1tjb2x1bW5NYXBbaV0uZmllbGRdID0gdmFsdWU7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRyb3dzLnB1c2gocm93KTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0cmV0dXJuIHJvd3M7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdENsaXBib2FyZC5wcm90b3R5cGUucGFzdGVBY3Rpb25zID0ge1xuXHRcdHJlcGxhY2U6IGZ1bmN0aW9uIHJlcGxhY2Uocm93cykge1xuXHRcdFx0cmV0dXJuIHRoaXMudGFibGUuc2V0RGF0YShyb3dzKTtcblx0XHR9LFxuXHRcdHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlKHJvd3MpIHtcblx0XHRcdHJldHVybiB0aGlzLnRhYmxlLnVwZGF0ZU9yQWRkRGF0YShyb3dzKTtcblx0XHR9LFxuXHRcdGluc2VydDogZnVuY3Rpb24gaW5zZXJ0KHJvd3MpIHtcblx0XHRcdHJldHVybiB0aGlzLnRhYmxlLmFkZERhdGEocm93cyk7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJjbGlwYm9hcmRcIiwgQ2xpcGJvYXJkKTtcblxuXHR2YXIgRGF0YVRyZWUgPSBmdW5jdGlvbiBEYXRhVHJlZSh0YWJsZSkge1xuXHRcdHRoaXMudGFibGUgPSB0YWJsZTtcblx0XHR0aGlzLmluZGVudCA9IDEwO1xuXHRcdHRoaXMuZmllbGQgPSBcIlwiO1xuXHRcdHRoaXMuY29sbGFwc2VFbCA9IG51bGw7XG5cdFx0dGhpcy5leHBhbmRFbCA9IG51bGw7XG5cdFx0dGhpcy5icmFuY2hFbCA9IG51bGw7XG5cdFx0dGhpcy5lbGVtZW50RmllbGQgPSBmYWxzZTtcblxuXHRcdHRoaXMuc3RhcnRPcGVuID0gZnVuY3Rpb24gKCkge307XG5cblx0XHR0aGlzLmRpc3BsYXlJbmRleCA9IDA7XG5cdH07XG5cblx0RGF0YVRyZWUucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIGR1bW15RWwgPSBudWxsLFxuXHRcdCAgICBmaXJzdENvbCA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRGaXJzdFZpc2liaWxlQ29sdW1uKCksXG5cdFx0ICAgIG9wdGlvbnMgPSB0aGlzLnRhYmxlLm9wdGlvbnM7XG5cblx0XHR0aGlzLmZpZWxkID0gb3B0aW9ucy5kYXRhVHJlZUNoaWxkRmllbGQ7XG5cdFx0dGhpcy5pbmRlbnQgPSBvcHRpb25zLmRhdGFUcmVlQ2hpbGRJbmRlbnQ7XG5cdFx0dGhpcy5lbGVtZW50RmllbGQgPSBvcHRpb25zLmRhdGFUcmVlRWxlbWVudENvbHVtbiB8fCAoZmlyc3RDb2wgPyBmaXJzdENvbC5maWVsZCA6IGZhbHNlKTtcblxuXHRcdGlmIChvcHRpb25zLmRhdGFUcmVlQnJhbmNoRWxlbWVudCkge1xuXG5cdFx0XHRpZiAob3B0aW9ucy5kYXRhVHJlZUJyYW5jaEVsZW1lbnQgPT09IHRydWUpIHtcblx0XHRcdFx0dGhpcy5icmFuY2hFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0XHRcdHRoaXMuYnJhbmNoRWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1kYXRhLXRyZWUtYnJhbmNoXCIpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKHR5cGVvZiBvcHRpb25zLmRhdGFUcmVlQnJhbmNoRWxlbWVudCA9PT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHRcdGR1bW15RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0XHRcdGR1bW15RWwuaW5uZXJIVE1MID0gb3B0aW9ucy5kYXRhVHJlZUJyYW5jaEVsZW1lbnQ7XG5cdFx0XHRcdFx0dGhpcy5icmFuY2hFbCA9IGR1bW15RWwuZmlyc3RDaGlsZDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLmJyYW5jaEVsID0gb3B0aW9ucy5kYXRhVHJlZUJyYW5jaEVsZW1lbnQ7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAob3B0aW9ucy5kYXRhVHJlZUNvbGxhcHNlRWxlbWVudCkge1xuXHRcdFx0aWYgKHR5cGVvZiBvcHRpb25zLmRhdGFUcmVlQ29sbGFwc2VFbGVtZW50ID09PSBcInN0cmluZ1wiKSB7XG5cdFx0XHRcdGR1bW15RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0XHRkdW1teUVsLmlubmVySFRNTCA9IG9wdGlvbnMuZGF0YVRyZWVDb2xsYXBzZUVsZW1lbnQ7XG5cdFx0XHRcdHRoaXMuY29sbGFwc2VFbCA9IGR1bW15RWwuZmlyc3RDaGlsZDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuY29sbGFwc2VFbCA9IG9wdGlvbnMuZGF0YVRyZWVDb2xsYXBzZUVsZW1lbnQ7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuY29sbGFwc2VFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0XHR0aGlzLmNvbGxhcHNlRWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1kYXRhLXRyZWUtY29udHJvbFwiKTtcblx0XHRcdHRoaXMuY29sbGFwc2VFbC50YWJJbmRleCA9IDA7XG5cdFx0XHR0aGlzLmNvbGxhcHNlRWwuaW5uZXJIVE1MID0gXCI8ZGl2IGNsYXNzPSd0YWJ1bGF0b3ItZGF0YS10cmVlLWNvbnRyb2wtY29sbGFwc2UnPjwvZGl2PlwiO1xuXHRcdH1cblxuXHRcdGlmIChvcHRpb25zLmRhdGFUcmVlRXhwYW5kRWxlbWVudCkge1xuXHRcdFx0aWYgKHR5cGVvZiBvcHRpb25zLmRhdGFUcmVlRXhwYW5kRWxlbWVudCA9PT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHRkdW1teUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcdFx0ZHVtbXlFbC5pbm5lckhUTUwgPSBvcHRpb25zLmRhdGFUcmVlRXhwYW5kRWxlbWVudDtcblx0XHRcdFx0dGhpcy5leHBhbmRFbCA9IGR1bW15RWwuZmlyc3RDaGlsZDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuZXhwYW5kRWwgPSBvcHRpb25zLmRhdGFUcmVlRXhwYW5kRWxlbWVudDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5leHBhbmRFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0XHR0aGlzLmV4cGFuZEVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZGF0YS10cmVlLWNvbnRyb2xcIik7XG5cdFx0XHR0aGlzLmV4cGFuZEVsLnRhYkluZGV4ID0gMDtcblx0XHRcdHRoaXMuZXhwYW5kRWwuaW5uZXJIVE1MID0gXCI8ZGl2IGNsYXNzPSd0YWJ1bGF0b3ItZGF0YS10cmVlLWNvbnRyb2wtZXhwYW5kJz48L2Rpdj5cIjtcblx0XHR9XG5cblx0XHRzd2l0Y2ggKF90eXBlb2Yob3B0aW9ucy5kYXRhVHJlZVN0YXJ0RXhwYW5kZWQpKSB7XG5cdFx0XHRjYXNlIFwiYm9vbGVhblwiOlxuXHRcdFx0XHR0aGlzLnN0YXJ0T3BlbiA9IGZ1bmN0aW9uIChyb3csIGluZGV4KSB7XG5cdFx0XHRcdFx0cmV0dXJuIG9wdGlvbnMuZGF0YVRyZWVTdGFydEV4cGFuZGVkO1xuXHRcdFx0XHR9O1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcImZ1bmN0aW9uXCI6XG5cdFx0XHRcdHRoaXMuc3RhcnRPcGVuID0gb3B0aW9ucy5kYXRhVHJlZVN0YXJ0RXhwYW5kZWQ7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHR0aGlzLnN0YXJ0T3BlbiA9IGZ1bmN0aW9uIChyb3csIGluZGV4KSB7XG5cdFx0XHRcdFx0cmV0dXJuIG9wdGlvbnMuZGF0YVRyZWVTdGFydEV4cGFuZGVkW2luZGV4XTtcblx0XHRcdFx0fTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9O1xuXG5cdERhdGFUcmVlLnByb3RvdHlwZS5pbml0aWFsaXplUm93ID0gZnVuY3Rpb24gKHJvdykge1xuXHRcdHZhciBjaGlsZEFycmF5ID0gcm93LmdldERhdGEoKVt0aGlzLmZpZWxkXTtcblx0XHR2YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXkoY2hpbGRBcnJheSk7XG5cblx0XHR2YXIgY2hpbGRyZW4gPSBpc0FycmF5IHx8ICFpc0FycmF5ICYmICh0eXBlb2YgY2hpbGRBcnJheSA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoY2hpbGRBcnJheSkpID09PSBcIm9iamVjdFwiICYmIGNoaWxkQXJyYXkgIT09IG51bGw7XG5cblx0XHRpZiAoIWNoaWxkcmVuICYmIHJvdy5tb2R1bGVzLmRhdGFUcmVlICYmIHJvdy5tb2R1bGVzLmRhdGFUcmVlLmJyYW5jaEVsKSB7XG5cdFx0XHRyb3cubW9kdWxlcy5kYXRhVHJlZS5icmFuY2hFbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHJvdy5tb2R1bGVzLmRhdGFUcmVlLmJyYW5jaEVsKTtcblx0XHR9XG5cblx0XHRpZiAoIWNoaWxkcmVuICYmIHJvdy5tb2R1bGVzLmRhdGFUcmVlICYmIHJvdy5tb2R1bGVzLmRhdGFUcmVlLmNvbnRyb2xFbCkge1xuXHRcdFx0cm93Lm1vZHVsZXMuZGF0YVRyZWUuY29udHJvbEVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocm93Lm1vZHVsZXMuZGF0YVRyZWUuY29udHJvbEVsKTtcblx0XHR9XG5cblx0XHRyb3cubW9kdWxlcy5kYXRhVHJlZSA9IHtcblx0XHRcdGluZGV4OiByb3cubW9kdWxlcy5kYXRhVHJlZSA/IHJvdy5tb2R1bGVzLmRhdGFUcmVlLmluZGV4IDogMCxcblx0XHRcdG9wZW46IGNoaWxkcmVuID8gcm93Lm1vZHVsZXMuZGF0YVRyZWUgPyByb3cubW9kdWxlcy5kYXRhVHJlZS5vcGVuIDogdGhpcy5zdGFydE9wZW4ocm93LmdldENvbXBvbmVudCgpLCAwKSA6IGZhbHNlLFxuXHRcdFx0Y29udHJvbEVsOiByb3cubW9kdWxlcy5kYXRhVHJlZSAmJiBjaGlsZHJlbiA/IHJvdy5tb2R1bGVzLmRhdGFUcmVlLmNvbnRyb2xFbCA6IGZhbHNlLFxuXHRcdFx0YnJhbmNoRWw6IHJvdy5tb2R1bGVzLmRhdGFUcmVlICYmIGNoaWxkcmVuID8gcm93Lm1vZHVsZXMuZGF0YVRyZWUuYnJhbmNoRWwgOiBmYWxzZSxcblx0XHRcdHBhcmVudDogcm93Lm1vZHVsZXMuZGF0YVRyZWUgPyByb3cubW9kdWxlcy5kYXRhVHJlZS5wYXJlbnQgOiBmYWxzZSxcblx0XHRcdGNoaWxkcmVuOiBjaGlsZHJlblxuXHRcdH07XG5cdH07XG5cblx0RGF0YVRyZWUucHJvdG90eXBlLmxheW91dFJvdyA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR2YXIgY2VsbCA9IHRoaXMuZWxlbWVudEZpZWxkID8gcm93LmdldENlbGwodGhpcy5lbGVtZW50RmllbGQpIDogcm93LmdldENlbGxzKClbMF0sXG5cdFx0ICAgIGVsID0gY2VsbC5nZXRFbGVtZW50KCksXG5cdFx0ICAgIGNvbmZpZyA9IHJvdy5tb2R1bGVzLmRhdGFUcmVlO1xuXG5cdFx0aWYgKGNvbmZpZy5icmFuY2hFbCkge1xuXHRcdFx0aWYgKGNvbmZpZy5icmFuY2hFbC5wYXJlbnROb2RlKSB7XG5cdFx0XHRcdGNvbmZpZy5icmFuY2hFbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGNvbmZpZy5icmFuY2hFbCk7XG5cdFx0XHR9XG5cdFx0XHRjb25maWcuYnJhbmNoRWwgPSBmYWxzZTtcblx0XHR9XG5cblx0XHRpZiAoY29uZmlnLmNvbnRyb2xFbCkge1xuXHRcdFx0aWYgKGNvbmZpZy5jb250cm9sRWwucGFyZW50Tm9kZSkge1xuXHRcdFx0XHRjb25maWcuY29udHJvbEVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoY29uZmlnLmNvbnRyb2xFbCk7XG5cdFx0XHR9XG5cdFx0XHRjb25maWcuY29udHJvbEVsID0gZmFsc2U7XG5cdFx0fVxuXG5cdFx0dGhpcy5nZW5lcmF0ZUNvbnRyb2xFbGVtZW50KHJvdywgZWwpO1xuXG5cdFx0cm93LmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci10cmVlLWxldmVsLVwiICsgY29uZmlnLmluZGV4KTtcblxuXHRcdGlmIChjb25maWcuaW5kZXgpIHtcblx0XHRcdGlmICh0aGlzLmJyYW5jaEVsKSB7XG5cdFx0XHRcdGNvbmZpZy5icmFuY2hFbCA9IHRoaXMuYnJhbmNoRWwuY2xvbmVOb2RlKHRydWUpO1xuXHRcdFx0XHRlbC5pbnNlcnRCZWZvcmUoY29uZmlnLmJyYW5jaEVsLCBlbC5maXJzdENoaWxkKTtcblx0XHRcdFx0Y29uZmlnLmJyYW5jaEVsLnN0eWxlLm1hcmdpbkxlZnQgPSAoY29uZmlnLmJyYW5jaEVsLm9mZnNldFdpZHRoICsgY29uZmlnLmJyYW5jaEVsLnN0eWxlLm1hcmdpblJpZ2h0KSAqIChjb25maWcuaW5kZXggLSAxKSArIGNvbmZpZy5pbmRleCAqIHRoaXMuaW5kZW50ICsgXCJweFwiO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZWwuc3R5bGUucGFkZGluZ0xlZnQgPSBwYXJzZUludCh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbCwgbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZSgncGFkZGluZy1sZWZ0JykpICsgY29uZmlnLmluZGV4ICogdGhpcy5pbmRlbnQgKyBcInB4XCI7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdERhdGFUcmVlLnByb3RvdHlwZS5nZW5lcmF0ZUNvbnRyb2xFbGVtZW50ID0gZnVuY3Rpb24gKHJvdywgZWwpIHtcblx0XHR2YXIgX3RoaXM0MCA9IHRoaXM7XG5cblx0XHR2YXIgY29uZmlnID0gcm93Lm1vZHVsZXMuZGF0YVRyZWUsXG5cdFx0ICAgIGVsID0gZWwgfHwgcm93LmdldENlbGxzKClbMF0uZ2V0RWxlbWVudCgpLFxuXHRcdCAgICBvbGRDb250cm9sID0gY29uZmlnLmNvbnRyb2xFbDtcblxuXHRcdGlmIChjb25maWcuY2hpbGRyZW4gIT09IGZhbHNlKSB7XG5cblx0XHRcdGlmIChjb25maWcub3Blbikge1xuXHRcdFx0XHRjb25maWcuY29udHJvbEVsID0gdGhpcy5jb2xsYXBzZUVsLmNsb25lTm9kZSh0cnVlKTtcblx0XHRcdFx0Y29uZmlnLmNvbnRyb2xFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdF90aGlzNDAuY29sbGFwc2VSb3cocm93KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25maWcuY29udHJvbEVsID0gdGhpcy5leHBhbmRFbC5jbG9uZU5vZGUodHJ1ZSk7XG5cdFx0XHRcdGNvbmZpZy5jb250cm9sRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRfdGhpczQwLmV4cGFuZFJvdyhyb3cpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0Y29uZmlnLmNvbnRyb2xFbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKG9sZENvbnRyb2wgJiYgb2xkQ29udHJvbC5wYXJlbnROb2RlID09PSBlbCkge1xuXHRcdFx0XHRvbGRDb250cm9sLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGNvbmZpZy5jb250cm9sRWwsIG9sZENvbnRyb2wpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZWwuaW5zZXJ0QmVmb3JlKGNvbmZpZy5jb250cm9sRWwsIGVsLmZpcnN0Q2hpbGQpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHREYXRhVHJlZS5wcm90b3R5cGUuc2V0RGlzcGxheUluZGV4ID0gZnVuY3Rpb24gKGluZGV4KSB7XG5cdFx0dGhpcy5kaXNwbGF5SW5kZXggPSBpbmRleDtcblx0fTtcblxuXHREYXRhVHJlZS5wcm90b3R5cGUuZ2V0RGlzcGxheUluZGV4ID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB0aGlzLmRpc3BsYXlJbmRleDtcblx0fTtcblxuXHREYXRhVHJlZS5wcm90b3R5cGUuZ2V0Um93cyA9IGZ1bmN0aW9uIChyb3dzKSB7XG5cdFx0dmFyIF90aGlzNDEgPSB0aGlzO1xuXG5cdFx0dmFyIG91dHB1dCA9IFtdO1xuXG5cdFx0cm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3csIGkpIHtcblx0XHRcdHZhciBjb25maWcsIGNoaWxkcmVuO1xuXG5cdFx0XHRvdXRwdXQucHVzaChyb3cpO1xuXG5cdFx0XHRpZiAocm93IGluc3RhbmNlb2YgUm93KSB7XG5cblx0XHRcdFx0Y29uZmlnID0gcm93Lm1vZHVsZXMuZGF0YVRyZWUuY2hpbGRyZW47XG5cblx0XHRcdFx0aWYgKCFjb25maWcuaW5kZXggJiYgY29uZmlnLmNoaWxkcmVuICE9PSBmYWxzZSkge1xuXHRcdFx0XHRcdGNoaWxkcmVuID0gX3RoaXM0MS5nZXRDaGlsZHJlbihyb3cpO1xuXG5cdFx0XHRcdFx0Y2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHtcblx0XHRcdFx0XHRcdG91dHB1dC5wdXNoKGNoaWxkKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fTtcblxuXHREYXRhVHJlZS5wcm90b3R5cGUuZ2V0Q2hpbGRyZW4gPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIF90aGlzNDIgPSB0aGlzO1xuXG5cdFx0dmFyIGNvbmZpZyA9IHJvdy5tb2R1bGVzLmRhdGFUcmVlLFxuXHRcdCAgICBjaGlsZHJlbiA9IFtdLFxuXHRcdCAgICBvdXRwdXQgPSBbXTtcblxuXHRcdGlmIChjb25maWcuY2hpbGRyZW4gIT09IGZhbHNlICYmIGNvbmZpZy5vcGVuKSB7XG5cdFx0XHRpZiAoIUFycmF5LmlzQXJyYXkoY29uZmlnLmNoaWxkcmVuKSkge1xuXHRcdFx0XHRjb25maWcuY2hpbGRyZW4gPSB0aGlzLmdlbmVyYXRlQ2hpbGRyZW4ocm93KTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwiZmlsdGVyXCIpKSB7XG5cdFx0XHRcdGNoaWxkcmVuID0gdGhpcy50YWJsZS5tb2R1bGVzLmZpbHRlci5maWx0ZXIoY29uZmlnLmNoaWxkcmVuKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNoaWxkcmVuID0gY29uZmlnLmNoaWxkcmVuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJzb3J0XCIpKSB7XG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5zb3J0LnNvcnQoY2hpbGRyZW4pO1xuXHRcdFx0fVxuXG5cdFx0XHRjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZCkge1xuXHRcdFx0XHRvdXRwdXQucHVzaChjaGlsZCk7XG5cblx0XHRcdFx0dmFyIHN1YkNoaWxkcmVuID0gX3RoaXM0Mi5nZXRDaGlsZHJlbihjaGlsZCk7XG5cblx0XHRcdFx0c3ViQ2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoc3ViKSB7XG5cdFx0XHRcdFx0b3V0cHV0LnB1c2goc3ViKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9O1xuXG5cdERhdGFUcmVlLnByb3RvdHlwZS5nZW5lcmF0ZUNoaWxkcmVuID0gZnVuY3Rpb24gKHJvdykge1xuXHRcdHZhciBfdGhpczQzID0gdGhpcztcblxuXHRcdHZhciBjaGlsZHJlbiA9IFtdO1xuXG5cdFx0dmFyIGNoaWxkQXJyYXkgPSByb3cuZ2V0RGF0YSgpW3RoaXMuZmllbGRdO1xuXG5cdFx0aWYgKCFBcnJheS5pc0FycmF5KGNoaWxkQXJyYXkpKSB7XG5cdFx0XHRjaGlsZEFycmF5ID0gW2NoaWxkQXJyYXldO1xuXHRcdH1cblxuXHRcdGNoaWxkQXJyYXkuZm9yRWFjaChmdW5jdGlvbiAoY2hpbGREYXRhKSB7XG5cdFx0XHR2YXIgY2hpbGRSb3cgPSBuZXcgUm93KGNoaWxkRGF0YSB8fCB7fSwgX3RoaXM0My50YWJsZS5yb3dNYW5hZ2VyKTtcblx0XHRcdGNoaWxkUm93Lm1vZHVsZXMuZGF0YVRyZWUuaW5kZXggPSByb3cubW9kdWxlcy5kYXRhVHJlZS5pbmRleCArIDE7XG5cdFx0XHRjaGlsZFJvdy5tb2R1bGVzLmRhdGFUcmVlLnBhcmVudCA9IHJvdztcblx0XHRcdGlmIChjaGlsZFJvdy5tb2R1bGVzLmRhdGFUcmVlLmNoaWxkcmVuKSB7XG5cdFx0XHRcdGNoaWxkUm93Lm1vZHVsZXMuZGF0YVRyZWUub3BlbiA9IF90aGlzNDMuc3RhcnRPcGVuKGNoaWxkUm93LmdldENvbXBvbmVudCgpLCBjaGlsZFJvdy5tb2R1bGVzLmRhdGFUcmVlLmluZGV4KTtcblx0XHRcdH1cblx0XHRcdGNoaWxkcmVuLnB1c2goY2hpbGRSb3cpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGNoaWxkcmVuO1xuXHR9O1xuXG5cdERhdGFUcmVlLnByb3RvdHlwZS5leHBhbmRSb3cgPSBmdW5jdGlvbiAocm93LCBzaWxlbnQpIHtcblx0XHR2YXIgY29uZmlnID0gcm93Lm1vZHVsZXMuZGF0YVRyZWU7XG5cblx0XHRpZiAoY29uZmlnLmNoaWxkcmVuICE9PSBmYWxzZSkge1xuXHRcdFx0Y29uZmlnLm9wZW4gPSB0cnVlO1xuXG5cdFx0XHRyb3cucmVpbml0aWFsaXplKCk7XG5cblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5yZWZyZXNoQWN0aXZlRGF0YShcInRyZWVcIiwgZmFsc2UsIHRydWUpO1xuXG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuZGF0YVRyZWVSb3dFeHBhbmRlZChyb3cuZ2V0Q29tcG9uZW50KCksIHJvdy5tb2R1bGVzLmRhdGFUcmVlLmluZGV4KTtcblx0XHR9XG5cdH07XG5cblx0RGF0YVRyZWUucHJvdG90eXBlLmNvbGxhcHNlUm93ID0gZnVuY3Rpb24gKHJvdykge1xuXHRcdHZhciBjb25maWcgPSByb3cubW9kdWxlcy5kYXRhVHJlZTtcblxuXHRcdGlmIChjb25maWcuY2hpbGRyZW4gIT09IGZhbHNlKSB7XG5cdFx0XHRjb25maWcub3BlbiA9IGZhbHNlO1xuXG5cdFx0XHRyb3cucmVpbml0aWFsaXplKCk7XG5cblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5yZWZyZXNoQWN0aXZlRGF0YShcInRyZWVcIiwgZmFsc2UsIHRydWUpO1xuXG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuZGF0YVRyZWVSb3dDb2xsYXBzZWQocm93LmdldENvbXBvbmVudCgpLCByb3cubW9kdWxlcy5kYXRhVHJlZS5pbmRleCk7XG5cdFx0fVxuXHR9O1xuXG5cdERhdGFUcmVlLnByb3RvdHlwZS50b2dnbGVSb3cgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIGNvbmZpZyA9IHJvdy5tb2R1bGVzLmRhdGFUcmVlO1xuXG5cdFx0aWYgKGNvbmZpZy5jaGlsZHJlbiAhPT0gZmFsc2UpIHtcblx0XHRcdGlmIChjb25maWcub3Blbikge1xuXHRcdFx0XHR0aGlzLmNvbGxhcHNlUm93KHJvdyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLmV4cGFuZFJvdyhyb3cpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHREYXRhVHJlZS5wcm90b3R5cGUuZ2V0VHJlZVBhcmVudCA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHRyZXR1cm4gcm93Lm1vZHVsZXMuZGF0YVRyZWUucGFyZW50ID8gcm93Lm1vZHVsZXMuZGF0YVRyZWUucGFyZW50LmdldENvbXBvbmVudCgpIDogZmFsc2U7XG5cdH07XG5cblx0RGF0YVRyZWUucHJvdG90eXBlLmdldEZpbHRlcmVkVHJlZUNoaWxkcmVuID0gZnVuY3Rpb24gKHJvdykge1xuXHRcdHZhciBjb25maWcgPSByb3cubW9kdWxlcy5kYXRhVHJlZSxcblx0XHQgICAgb3V0cHV0ID0gW10sXG5cdFx0ICAgIGNoaWxkcmVuO1xuXG5cdFx0aWYgKGNvbmZpZy5jaGlsZHJlbikge1xuXG5cdFx0XHRpZiAoIUFycmF5LmlzQXJyYXkoY29uZmlnLmNoaWxkcmVuKSkge1xuXHRcdFx0XHRjb25maWcuY2hpbGRyZW4gPSB0aGlzLmdlbmVyYXRlQ2hpbGRyZW4ocm93KTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwiZmlsdGVyXCIpKSB7XG5cdFx0XHRcdGNoaWxkcmVuID0gdGhpcy50YWJsZS5tb2R1bGVzLmZpbHRlci5maWx0ZXIoY29uZmlnLmNoaWxkcmVuKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNoaWxkcmVuID0gY29uZmlnLmNoaWxkcmVuO1xuXHRcdFx0fVxuXG5cdFx0XHRjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZFJvdykge1xuXHRcdFx0XHRpZiAoY2hpbGRSb3cgaW5zdGFuY2VvZiBSb3cpIHtcblx0XHRcdFx0XHRvdXRwdXQucHVzaChjaGlsZFJvdyk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0RGF0YVRyZWUucHJvdG90eXBlLnJvd0RlbGV0ZSA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR2YXIgcGFyZW50ID0gcm93Lm1vZHVsZXMuZGF0YVRyZWUucGFyZW50LFxuXHRcdCAgICBjaGlsZEluZGV4O1xuXG5cdFx0aWYgKHBhcmVudCkge1xuXHRcdFx0Y2hpbGRJbmRleCA9IHRoaXMuZmluZENoaWxkSW5kZXgocm93LCBwYXJlbnQpO1xuXG5cdFx0XHRpZiAoY2hpbGRJbmRleCAhPT0gZmFsc2UpIHtcblx0XHRcdFx0cGFyZW50LmRhdGFbdGhpcy5maWVsZF0uc3BsaWNlKGNoaWxkSW5kZXgsIDEpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXBhcmVudC5kYXRhW3RoaXMuZmllbGRdLmxlbmd0aCkge1xuXHRcdFx0XHRkZWxldGUgcGFyZW50LmRhdGFbdGhpcy5maWVsZF07XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuaW5pdGlhbGl6ZVJvdyhwYXJlbnQpO1xuXHRcdFx0dGhpcy5sYXlvdXRSb3cocGFyZW50KTtcblx0XHR9XG5cblx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucmVmcmVzaEFjdGl2ZURhdGEoXCJ0cmVlXCIsIGZhbHNlLCB0cnVlKTtcblx0fTtcblxuXHREYXRhVHJlZS5wcm90b3R5cGUuYWRkVHJlZUNoaWxkUm93ID0gZnVuY3Rpb24gKHJvdywgZGF0YSwgdG9wLCBpbmRleCkge1xuXHRcdHZhciBjaGlsZEluZGV4ID0gZmFsc2U7XG5cblx0XHRpZiAodHlwZW9mIGRhdGEgPT09IFwic3RyaW5nXCIpIHtcblx0XHRcdGRhdGEgPSBKU09OLnBhcnNlKGRhdGEpO1xuXHRcdH1cblxuXHRcdGlmICghQXJyYXkuaXNBcnJheShyb3cuZGF0YVt0aGlzLmZpZWxkXSkpIHtcblx0XHRcdHJvdy5kYXRhW3RoaXMuZmllbGRdID0gW107XG5cblx0XHRcdHJvdy5tb2R1bGVzLmRhdGFUcmVlLm9wZW4gPSB0aGlzLnN0YXJ0T3Blbihyb3cuZ2V0Q29tcG9uZW50KCksIHJvdy5tb2R1bGVzLmRhdGFUcmVlLmluZGV4KTtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIGluZGV4ICE9PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRjaGlsZEluZGV4ID0gdGhpcy5maW5kQ2hpbGRJbmRleChpbmRleCwgcm93KTtcblxuXHRcdFx0aWYgKGNoaWxkSW5kZXggIT09IGZhbHNlKSB7XG5cdFx0XHRcdHJvdy5kYXRhW3RoaXMuZmllbGRdLnNwbGljZSh0b3AgPyBjaGlsZEluZGV4IDogY2hpbGRJbmRleCArIDEsIDAsIGRhdGEpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChjaGlsZEluZGV4ID09PSBmYWxzZSkge1xuXHRcdFx0aWYgKHRvcCkge1xuXHRcdFx0XHRyb3cuZGF0YVt0aGlzLmZpZWxkXS51bnNoaWZ0KGRhdGEpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cm93LmRhdGFbdGhpcy5maWVsZF0ucHVzaChkYXRhKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHR0aGlzLmluaXRpYWxpemVSb3cocm93KTtcblx0XHR0aGlzLmxheW91dFJvdyhyb3cpO1xuXG5cdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLnJlZnJlc2hBY3RpdmVEYXRhKFwidHJlZVwiLCBmYWxzZSwgdHJ1ZSk7XG5cdH07XG5cblx0RGF0YVRyZWUucHJvdG90eXBlLmZpbmRDaGlsZEluZGV4ID0gZnVuY3Rpb24gKHN1YmplY3QsIHBhcmVudCkge1xuXHRcdHZhciBfdGhpczQ0ID0gdGhpcztcblxuXHRcdHZhciBtYXRjaCA9IGZhbHNlO1xuXG5cdFx0aWYgKCh0eXBlb2Ygc3ViamVjdCA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2Yoc3ViamVjdCkpID09IFwib2JqZWN0XCIpIHtcblxuXHRcdFx0aWYgKHN1YmplY3QgaW5zdGFuY2VvZiBSb3cpIHtcblx0XHRcdFx0Ly9zdWJqZWN0IGlzIHJvdyBlbGVtZW50XG5cdFx0XHRcdG1hdGNoID0gc3ViamVjdC5kYXRhO1xuXHRcdFx0fSBlbHNlIGlmIChzdWJqZWN0IGluc3RhbmNlb2YgUm93Q29tcG9uZW50KSB7XG5cdFx0XHRcdC8vc3ViamVjdCBpcyBwdWJsaWMgcm93IGNvbXBvbmVudFxuXHRcdFx0XHRtYXRjaCA9IHN1YmplY3QuX2dldFNlbGYoKS5kYXRhO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YgSFRNTEVsZW1lbnQgIT09IFwidW5kZWZpbmVkXCIgJiYgc3ViamVjdCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSB7XG5cdFx0XHRcdGlmIChwYXJlbnQubW9kdWxlcy5kYXRhVHJlZSkge1xuXHRcdFx0XHRcdG1hdGNoID0gcGFyZW50Lm1vZHVsZXMuZGF0YVRyZWUuY2hpbGRyZW4uZmluZChmdW5jdGlvbiAoY2hpbGRSb3cpIHtcblx0XHRcdFx0XHRcdHJldHVybiBjaGlsZFJvdyBpbnN0YW5jZW9mIFJvdyA/IGNoaWxkUm93LmVsZW1lbnQgPT09IHN1YmplY3QgOiBmYWxzZTtcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdGlmIChtYXRjaCkge1xuXHRcdFx0XHRcdFx0bWF0Y2ggPSBtYXRjaC5kYXRhO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gZWxzZSBpZiAodHlwZW9mIHN1YmplY3QgPT0gXCJ1bmRlZmluZWRcIiB8fCBzdWJqZWN0ID09PSBudWxsKSB7XG5cdFx0XHRtYXRjaCA9IGZhbHNlO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQvL3N1YmplY3Qgc2hvdWxkIGJlIHRyZWF0ZWQgYXMgdGhlIGluZGV4IG9mIHRoZSByb3dcblx0XHRcdG1hdGNoID0gcGFyZW50LmRhdGFbdGhpcy5maWVsZF0uZmluZChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRcdHJldHVybiByb3cuZGF0YVtfdGhpczQ0LnRhYmxlLm9wdGlvbnMuaW5kZXhdID09IHN1YmplY3Q7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAobWF0Y2gpIHtcblxuXHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocGFyZW50LmRhdGFbdGhpcy5maWVsZF0pKSB7XG5cdFx0XHRcdG1hdGNoID0gcGFyZW50LmRhdGFbdGhpcy5maWVsZF0uaW5kZXhPZihtYXRjaCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChtYXRjaCA9PSAtMSkge1xuXHRcdFx0XHRtYXRjaCA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vY2F0Y2ggYWxsIGZvciBhbnkgb3RoZXIgdHlwZSBvZiBpbnB1dFxuXG5cdFx0cmV0dXJuIG1hdGNoO1xuXHR9O1xuXG5cdERhdGFUcmVlLnByb3RvdHlwZS5nZXRUcmVlQ2hpbGRyZW4gPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIGNvbmZpZyA9IHJvdy5tb2R1bGVzLmRhdGFUcmVlLFxuXHRcdCAgICBvdXRwdXQgPSBbXTtcblxuXHRcdGlmIChjb25maWcuY2hpbGRyZW4pIHtcblxuXHRcdFx0aWYgKCFBcnJheS5pc0FycmF5KGNvbmZpZy5jaGlsZHJlbikpIHtcblx0XHRcdFx0Y29uZmlnLmNoaWxkcmVuID0gdGhpcy5nZW5lcmF0ZUNoaWxkcmVuKHJvdyk7XG5cdFx0XHR9XG5cblx0XHRcdGNvbmZpZy5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZFJvdykge1xuXHRcdFx0XHRpZiAoY2hpbGRSb3cgaW5zdGFuY2VvZiBSb3cpIHtcblx0XHRcdFx0XHRvdXRwdXQucHVzaChjaGlsZFJvdy5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0RGF0YVRyZWUucHJvdG90eXBlLmNoZWNrRm9yUmVzdHlsZSA9IGZ1bmN0aW9uIChjZWxsKSB7XG5cdFx0aWYgKCFjZWxsLnJvdy5jZWxscy5pbmRleE9mKGNlbGwpKSB7XG5cdFx0XHRjZWxsLnJvdy5yZWluaXRpYWxpemUoKTtcblx0XHR9XG5cdH07XG5cblx0RGF0YVRyZWUucHJvdG90eXBlLmdldENoaWxkRmllbGQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIHRoaXMuZmllbGQ7XG5cdH07XG5cblx0RGF0YVRyZWUucHJvdG90eXBlLnJlZHJhd05lZWRlZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cdFx0cmV0dXJuICh0aGlzLmZpZWxkID8gdHlwZW9mIGRhdGFbdGhpcy5maWVsZF0gIT09IFwidW5kZWZpbmVkXCIgOiBmYWxzZSkgfHwgKHRoaXMuZWxlbWVudEZpZWxkID8gdHlwZW9mIGRhdGFbdGhpcy5lbGVtZW50RmllbGRdICE9PSBcInVuZGVmaW5lZFwiIDogZmFsc2UpO1xuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJkYXRhVHJlZVwiLCBEYXRhVHJlZSk7XG5cblx0dmFyIERvd25sb2FkID0gZnVuY3Rpb24gRG93bmxvYWQodGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdH07XG5cblx0Ly90cmlnZ2VyIGZpbGUgZG93bmxvYWRcblx0RG93bmxvYWQucHJvdG90eXBlLmRvd25sb2FkID0gZnVuY3Rpb24gKHR5cGUsIGZpbGVuYW1lLCBvcHRpb25zLCByYW5nZSwgaW50ZXJjZXB0Q2FsbGJhY2spIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGRvd25sb2FkRnVuYyA9IGZhbHNlO1xuXG5cdFx0ZnVuY3Rpb24gYnVpbGRMaW5rKGRhdGEsIG1pbWUpIHtcblx0XHRcdGlmIChpbnRlcmNlcHRDYWxsYmFjaykge1xuXHRcdFx0XHRpZiAoaW50ZXJjZXB0Q2FsbGJhY2sgPT09IHRydWUpIHtcblx0XHRcdFx0XHRzZWxmLnRyaWdnZXJEb3dubG9hZChkYXRhLCBtaW1lLCB0eXBlLCBmaWxlbmFtZSwgdHJ1ZSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aW50ZXJjZXB0Q2FsbGJhY2soZGF0YSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHNlbGYudHJpZ2dlckRvd25sb2FkKGRhdGEsIG1pbWUsIHR5cGUsIGZpbGVuYW1lKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIHR5cGUgPT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRkb3dubG9hZEZ1bmMgPSB0eXBlO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRpZiAoc2VsZi5kb3dubG9hZGVyc1t0eXBlXSkge1xuXHRcdFx0XHRkb3dubG9hZEZ1bmMgPSBzZWxmLmRvd25sb2FkZXJzW3R5cGVdO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiRG93bmxvYWQgRXJyb3IgLSBObyBzdWNoIGRvd25sb2FkIHR5cGUgZm91bmQ6IFwiLCB0eXBlKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoZG93bmxvYWRGdW5jKSB7XG5cdFx0XHR2YXIgbGlzdCA9IHRoaXMuZ2VuZXJhdGVFeHBvcnRMaXN0KHJhbmdlKTtcblxuXHRcdFx0ZG93bmxvYWRGdW5jLmNhbGwodGhpcy50YWJsZSwgbGlzdCwgb3B0aW9ucyB8fCB7fSwgYnVpbGRMaW5rKTtcblx0XHR9XG5cdH07XG5cblx0RG93bmxvYWQucHJvdG90eXBlLmdlbmVyYXRlRXhwb3J0TGlzdCA9IGZ1bmN0aW9uIChyYW5nZSkge1xuXHRcdHZhciBsaXN0ID0gdGhpcy50YWJsZS5tb2R1bGVzLmV4cG9ydC5nZW5lcmF0ZUV4cG9ydExpc3QodGhpcy50YWJsZS5vcHRpb25zLmRvd25sb2FkQ29uZmlnLCBmYWxzZSwgcmFuZ2UgfHwgdGhpcy50YWJsZS5vcHRpb25zLmRvd25sb2FkUm93UmFuZ2UsIFwiZG93bmxvYWRcIik7XG5cblx0XHQvL2Fzc2lnbiBncm91cCBoZWFkZXIgZm9ybWF0dGVyXG5cdFx0dmFyIGdyb3VwSGVhZGVyID0gdGhpcy50YWJsZS5vcHRpb25zLmdyb3VwSGVhZGVyRG93bmxvYWQ7XG5cblx0XHRpZiAoZ3JvdXBIZWFkZXIgJiYgIUFycmF5LmlzQXJyYXkoZ3JvdXBIZWFkZXIpKSB7XG5cdFx0XHRncm91cEhlYWRlciA9IFtncm91cEhlYWRlcl07XG5cdFx0fVxuXG5cdFx0bGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdHZhciBncm91cDtcblxuXHRcdFx0aWYgKHJvdy50eXBlID09PSBcImdyb3VwXCIpIHtcblx0XHRcdFx0Z3JvdXAgPSByb3cuY29sdW1uc1swXTtcblxuXHRcdFx0XHRpZiAoZ3JvdXBIZWFkZXIgJiYgZ3JvdXBIZWFkZXJbcm93LmluZGVudF0pIHtcblx0XHRcdFx0XHRncm91cC52YWx1ZSA9IGdyb3VwSGVhZGVyW3Jvdy5pbmRlbnRdKGdyb3VwLnZhbHVlLCByb3cuY29tcG9uZW50Ll9ncm91cC5nZXRSb3dDb3VudCgpLCByb3cuY29tcG9uZW50Ll9ncm91cC5nZXREYXRhKCksIHJvdy5jb21wb25lbnQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gbGlzdDtcblx0fTtcblxuXHREb3dubG9hZC5wcm90b3R5cGUudHJpZ2dlckRvd25sb2FkID0gZnVuY3Rpb24gKGRhdGEsIG1pbWUsIHR5cGUsIGZpbGVuYW1lLCBuZXdUYWIpIHtcblx0XHR2YXIgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKSxcblx0XHQgICAgYmxvYiA9IG5ldyBCbG9iKFtkYXRhXSwgeyB0eXBlOiBtaW1lIH0pLFxuXHRcdCAgICBmaWxlbmFtZSA9IGZpbGVuYW1lIHx8IFwiVGFidWxhdG9yLlwiICsgKHR5cGVvZiB0eXBlID09PSBcImZ1bmN0aW9uXCIgPyBcInR4dFwiIDogdHlwZSk7XG5cblx0XHRibG9iID0gdGhpcy50YWJsZS5vcHRpb25zLmRvd25sb2FkUmVhZHkuY2FsbCh0aGlzLnRhYmxlLCBkYXRhLCBibG9iKTtcblxuXHRcdGlmIChibG9iKSB7XG5cblx0XHRcdGlmIChuZXdUYWIpIHtcblx0XHRcdFx0d2luZG93Lm9wZW4od2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYikpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKG5hdmlnYXRvci5tc1NhdmVPck9wZW5CbG9iKSB7XG5cdFx0XHRcdFx0bmF2aWdhdG9yLm1zU2F2ZU9yT3BlbkJsb2IoYmxvYiwgZmlsZW5hbWUpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGVsZW1lbnQuc2V0QXR0cmlidXRlKCdocmVmJywgd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYikpO1xuXG5cdFx0XHRcdFx0Ly9zZXQgZmlsZSB0aXRsZVxuXHRcdFx0XHRcdGVsZW1lbnQuc2V0QXR0cmlidXRlKCdkb3dubG9hZCcsIGZpbGVuYW1lKTtcblxuXHRcdFx0XHRcdC8vdHJpZ2dlciBkb3dubG9hZFxuXHRcdFx0XHRcdGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJztcblx0XHRcdFx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuXHRcdFx0XHRcdGVsZW1lbnQuY2xpY2soKTtcblxuXHRcdFx0XHRcdC8vcmVtb3ZlIHRlbXBvcmFyeSBsaW5rIGVsZW1lbnRcblx0XHRcdFx0XHRkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGVsZW1lbnQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuZG93bmxvYWRDb21wbGV0ZSkge1xuXHRcdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuZG93bmxvYWRDb21wbGV0ZSgpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHREb3dubG9hZC5wcm90b3R5cGUuY29tbXNSZWNlaXZlZCA9IGZ1bmN0aW9uICh0YWJsZSwgYWN0aW9uLCBkYXRhKSB7XG5cdFx0c3dpdGNoIChhY3Rpb24pIHtcblx0XHRcdGNhc2UgXCJpbnRlcmNlcHRcIjpcblx0XHRcdFx0dGhpcy5kb3dubG9hZChkYXRhLnR5cGUsIFwiXCIsIGRhdGEub3B0aW9ucywgZGF0YS5hY3RpdmUsIGRhdGEuaW50ZXJjZXB0KTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9O1xuXG5cdC8vZG93bmxvYWRlcnNcblx0RG93bmxvYWQucHJvdG90eXBlLmRvd25sb2FkZXJzID0ge1xuXHRcdGNzdjogZnVuY3Rpb24gY3N2KGxpc3QsIG9wdGlvbnMsIHNldEZpbGVDb250ZW50cykge1xuXHRcdFx0dmFyIGRlbGltaXRlciA9IG9wdGlvbnMgJiYgb3B0aW9ucy5kZWxpbWl0ZXIgPyBvcHRpb25zLmRlbGltaXRlciA6IFwiLFwiLFxuXHRcdFx0ICAgIGZpbGVDb250ZW50cyA9IFtdLFxuXHRcdFx0ICAgIGhlYWRlcnMgPSBbXTtcblxuXHRcdFx0bGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0dmFyIGl0ZW0gPSBbXTtcblxuXHRcdFx0XHRzd2l0Y2ggKHJvdy50eXBlKSB7XG5cdFx0XHRcdFx0Y2FzZSBcImdyb3VwXCI6XG5cdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJEb3dubG9hZCBXYXJuaW5nIC0gQ1NWIGRvd25sb2FkZXIgY2Fubm90IHByb2Nlc3Mgcm93IGdyb3Vwc1wiKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSBcImNhbGNcIjpcblx0XHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkRvd25sb2FkIFdhcm5pbmcgLSBDU1YgZG93bmxvYWRlciBjYW5ub3QgcHJvY2VzcyBjb2x1bW4gY2FsY3VsYXRpb25zXCIpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFwiaGVhZGVyXCI6XG5cdFx0XHRcdFx0XHRyb3cuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2wsIGkpIHtcblx0XHRcdFx0XHRcdFx0aWYgKGNvbCAmJiBjb2wuZGVwdGggPT09IDEpIHtcblx0XHRcdFx0XHRcdFx0XHRoZWFkZXJzW2ldID0gdHlwZW9mIGNvbC52YWx1ZSA9PSBcInVuZGVmaW5lZFwiIHx8IHR5cGVvZiBjb2wudmFsdWUgPT0gXCJudWxsXCIgPyBcIlwiIDogY29sLnZhbHVlO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSBcInJvd1wiOlxuXHRcdFx0XHRcdFx0cm93LmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sKSB7XG5cblx0XHRcdFx0XHRcdFx0aWYgKGNvbCkge1xuXG5cdFx0XHRcdFx0XHRcdFx0c3dpdGNoIChfdHlwZW9mKGNvbC52YWx1ZSkpIHtcblx0XHRcdFx0XHRcdFx0XHRcdGNhc2UgXCJvYmplY3RcIjpcblx0XHRcdFx0XHRcdFx0XHRcdFx0Y29sLnZhbHVlID0gSlNPTi5zdHJpbmdpZnkoY29sLnZhbHVlKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdFx0XHRcdGNhc2UgXCJ1bmRlZmluZWRcIjpcblx0XHRcdFx0XHRcdFx0XHRcdGNhc2UgXCJudWxsXCI6XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGNvbC52YWx1ZSA9IFwiXCI7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdGl0ZW0ucHVzaCgnXCInICsgU3RyaW5nKGNvbC52YWx1ZSkuc3BsaXQoJ1wiJykuam9pbignXCJcIicpICsgJ1wiJyk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRmaWxlQ29udGVudHMucHVzaChpdGVtLmpvaW4oZGVsaW1pdGVyKSk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChoZWFkZXJzLmxlbmd0aCkge1xuXHRcdFx0XHRmaWxlQ29udGVudHMgPSBbaGVhZGVyc10uY29uY2F0KGZpbGVDb250ZW50cyk7XG5cdFx0XHR9XG5cblx0XHRcdGZpbGVDb250ZW50cyA9IGZpbGVDb250ZW50cy5qb2luKFwiXFxuXCIpO1xuXG5cdFx0XHRpZiAob3B0aW9ucy5ib20pIHtcblx0XHRcdFx0ZmlsZUNvbnRlbnRzID0gJ1xcdUZFRkYnICsgZmlsZUNvbnRlbnRzO1xuXHRcdFx0fVxuXG5cdFx0XHRzZXRGaWxlQ29udGVudHMoZmlsZUNvbnRlbnRzLCBcInRleHQvY3N2XCIpO1xuXHRcdH0sXG5cblx0XHRqc29uOiBmdW5jdGlvbiBqc29uKGxpc3QsIG9wdGlvbnMsIHNldEZpbGVDb250ZW50cykge1xuXHRcdFx0dmFyIGZpbGVDb250ZW50cyA9IFtdO1xuXG5cdFx0XHRsaXN0LmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0XHR2YXIgaXRlbSA9IHt9O1xuXG5cdFx0XHRcdHN3aXRjaCAocm93LnR5cGUpIHtcblx0XHRcdFx0XHRjYXNlIFwiaGVhZGVyXCI6XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgXCJncm91cFwiOlxuXHRcdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiRG93bmxvYWQgV2FybmluZyAtIEpTT04gZG93bmxvYWRlciBjYW5ub3QgcHJvY2VzcyByb3cgZ3JvdXBzXCIpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFwiY2FsY1wiOlxuXHRcdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiRG93bmxvYWQgV2FybmluZyAtIEpTT04gZG93bmxvYWRlciBjYW5ub3QgcHJvY2VzcyBjb2x1bW4gY2FsY3VsYXRpb25zXCIpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFwicm93XCI6XG5cdFx0XHRcdFx0XHRyb3cuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2wpIHtcblx0XHRcdFx0XHRcdFx0aWYgKGNvbCkge1xuXHRcdFx0XHRcdFx0XHRcdGl0ZW1bY29sLmNvbXBvbmVudC5nZXRGaWVsZCgpXSA9IGNvbC52YWx1ZTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdGZpbGVDb250ZW50cy5wdXNoKGl0ZW0pO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRmaWxlQ29udGVudHMgPSBKU09OLnN0cmluZ2lmeShmaWxlQ29udGVudHMsIG51bGwsICdcXHQnKTtcblxuXHRcdFx0c2V0RmlsZUNvbnRlbnRzKGZpbGVDb250ZW50cywgXCJhcHBsaWNhdGlvbi9qc29uXCIpO1xuXHRcdH0sXG5cblx0XHRwZGY6IGZ1bmN0aW9uIHBkZihsaXN0LCBvcHRpb25zLCBzZXRGaWxlQ29udGVudHMpIHtcblx0XHRcdHZhciBoZWFkZXIgPSBbXSxcblx0XHRcdCAgICBib2R5ID0gW10sXG5cdFx0XHQgICAgYXV0b1RhYmxlUGFyYW1zID0ge30sXG5cdFx0XHQgICAgcm93R3JvdXBTdHlsZXMgPSBvcHRpb25zLnJvd0dyb3VwU3R5bGVzIHx8IHtcblx0XHRcdFx0Zm9udFN0eWxlOiBcImJvbGRcIixcblx0XHRcdFx0Zm9udFNpemU6IDEyLFxuXHRcdFx0XHRjZWxsUGFkZGluZzogNixcblx0XHRcdFx0ZmlsbENvbG9yOiAyMjBcblx0XHRcdH0sXG5cdFx0XHQgICAgcm93Q2FsY1N0eWxlcyA9IG9wdGlvbnMucm93Q2FsY1N0eWxlcyB8fCB7XG5cdFx0XHRcdGZvbnRTdHlsZTogXCJib2xkXCIsXG5cdFx0XHRcdGZvbnRTaXplOiAxMCxcblx0XHRcdFx0Y2VsbFBhZGRpbmc6IDQsXG5cdFx0XHRcdGZpbGxDb2xvcjogMjMyXG5cdFx0XHR9LFxuXHRcdFx0ICAgIGpzUERGUGFyYW1zID0gb3B0aW9ucy5qc1BERiB8fCB7fSxcblx0XHRcdCAgICB0aXRsZSA9IG9wdGlvbnMgJiYgb3B0aW9ucy50aXRsZSA/IG9wdGlvbnMudGl0bGUgOiBcIlwiO1xuXG5cdFx0XHRpZiAoIWpzUERGUGFyYW1zLm9yaWVudGF0aW9uKSB7XG5cdFx0XHRcdGpzUERGUGFyYW1zLm9yaWVudGF0aW9uID0gb3B0aW9ucy5vcmllbnRhdGlvbiB8fCBcImxhbmRzY2FwZVwiO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIWpzUERGUGFyYW1zLnVuaXQpIHtcblx0XHRcdFx0anNQREZQYXJhbXMudW5pdCA9IFwicHRcIjtcblx0XHRcdH1cblxuXHRcdFx0Ly9wYXJzZSByb3cgbGlzdFxuXHRcdFx0bGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0dmFyIGl0ZW0gPSB7fTtcblxuXHRcdFx0XHRzd2l0Y2ggKHJvdy50eXBlKSB7XG5cdFx0XHRcdFx0Y2FzZSBcImhlYWRlclwiOlxuXHRcdFx0XHRcdFx0aGVhZGVyLnB1c2gocGFyc2VSb3cocm93KSk7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgXCJncm91cFwiOlxuXHRcdFx0XHRcdFx0Ym9keS5wdXNoKHBhcnNlUm93KHJvdywgcm93R3JvdXBTdHlsZXMpKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSBcImNhbGNcIjpcblx0XHRcdFx0XHRcdGJvZHkucHVzaChwYXJzZVJvdyhyb3csIHJvd0NhbGNTdHlsZXMpKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSBcInJvd1wiOlxuXHRcdFx0XHRcdFx0Ym9keS5wdXNoKHBhcnNlUm93KHJvdykpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRmdW5jdGlvbiBwYXJzZVJvdyhyb3csIHN0eWxlcykge1xuXHRcdFx0XHR2YXIgcm93RGF0YSA9IFtdO1xuXG5cdFx0XHRcdHJvdy5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbCkge1xuXHRcdFx0XHRcdHZhciBjZWxsO1xuXG5cdFx0XHRcdFx0aWYgKGNvbCkge1xuXHRcdFx0XHRcdFx0c3dpdGNoIChfdHlwZW9mKGNvbC52YWx1ZSkpIHtcblx0XHRcdFx0XHRcdFx0Y2FzZSBcIm9iamVjdFwiOlxuXHRcdFx0XHRcdFx0XHRcdGNvbC52YWx1ZSA9IEpTT04uc3RyaW5naWZ5KGNvbC52YWx1ZSk7XG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdFx0Y2FzZSBcInVuZGVmaW5lZFwiOlxuXHRcdFx0XHRcdFx0XHRjYXNlIFwibnVsbFwiOlxuXHRcdFx0XHRcdFx0XHRcdGNvbC52YWx1ZSA9IFwiXCI7XG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGNlbGwgPSB7XG5cdFx0XHRcdFx0XHRcdGNvbnRlbnQ6IGNvbC52YWx1ZSxcblx0XHRcdFx0XHRcdFx0Y29sU3BhbjogY29sLndpZHRoLFxuXHRcdFx0XHRcdFx0XHRyb3dTcGFuOiBjb2wuaGVpZ2h0XG5cdFx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0XHRpZiAoc3R5bGVzKSB7XG5cdFx0XHRcdFx0XHRcdGNlbGwuc3R5bGVzID0gc3R5bGVzO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyb3dEYXRhLnB1c2goY2VsbCk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHJvd0RhdGEucHVzaChcIlwiKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHJldHVybiByb3dEYXRhO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2NvbmZpZ3VyZSBQREZcblx0XHRcdHZhciBkb2MgPSBuZXcganNQREYoanNQREZQYXJhbXMpOyAvL3NldCBkb2N1bWVudCB0byBsYW5kc2NhcGUsIGJldHRlciBmb3IgbW9zdCB0YWJsZXNcblxuXHRcdFx0aWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5hdXRvVGFibGUpIHtcblx0XHRcdFx0aWYgKHR5cGVvZiBvcHRpb25zLmF1dG9UYWJsZSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0YXV0b1RhYmxlUGFyYW1zID0gb3B0aW9ucy5hdXRvVGFibGUoZG9jKSB8fCB7fTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRhdXRvVGFibGVQYXJhbXMgPSBvcHRpb25zLmF1dG9UYWJsZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGl0bGUpIHtcblx0XHRcdFx0YXV0b1RhYmxlUGFyYW1zLmFkZFBhZ2VDb250ZW50ID0gZnVuY3Rpb24gKGRhdGEpIHtcblx0XHRcdFx0XHRkb2MudGV4dCh0aXRsZSwgNDAsIDMwKTtcblx0XHRcdFx0fTtcblx0XHRcdH1cblxuXHRcdFx0YXV0b1RhYmxlUGFyYW1zLmhlYWQgPSBoZWFkZXI7XG5cdFx0XHRhdXRvVGFibGVQYXJhbXMuYm9keSA9IGJvZHk7XG5cblx0XHRcdGRvYy5hdXRvVGFibGUoYXV0b1RhYmxlUGFyYW1zKTtcblxuXHRcdFx0aWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5kb2N1bWVudFByb2Nlc3NpbmcpIHtcblx0XHRcdFx0b3B0aW9ucy5kb2N1bWVudFByb2Nlc3NpbmcoZG9jKTtcblx0XHRcdH1cblxuXHRcdFx0c2V0RmlsZUNvbnRlbnRzKGRvYy5vdXRwdXQoXCJhcnJheWJ1ZmZlclwiKSwgXCJhcHBsaWNhdGlvbi9wZGZcIik7XG5cdFx0fSxcblxuXHRcdHhsc3g6IGZ1bmN0aW9uIHhsc3gobGlzdCwgb3B0aW9ucywgc2V0RmlsZUNvbnRlbnRzKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHQgICAgc2hlZXROYW1lID0gb3B0aW9ucy5zaGVldE5hbWUgfHwgXCJTaGVldDFcIixcblx0XHRcdCAgICB3b3JrYm9vayA9IFhMU1gudXRpbHMuYm9va19uZXcoKSxcblx0XHRcdCAgICBvdXRwdXQ7XG5cblx0XHRcdHdvcmtib29rLlNoZWV0TmFtZXMgPSBbXTtcblx0XHRcdHdvcmtib29rLlNoZWV0cyA9IHt9O1xuXG5cdFx0XHRmdW5jdGlvbiBnZW5lcmF0ZVNoZWV0KCkge1xuXHRcdFx0XHR2YXIgcm93cyA9IFtdLFxuXHRcdFx0XHQgICAgbWVyZ2VzID0gW10sXG5cdFx0XHRcdCAgICB3b3Jrc2hlZXQgPSB7fSxcblx0XHRcdFx0ICAgIHJhbmdlID0geyBzOiB7IGM6IDAsIHI6IDAgfSwgZTogeyBjOiBsaXN0WzBdID8gbGlzdFswXS5jb2x1bW5zLnJlZHVjZShmdW5jdGlvbiAoYSwgYikge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gYSArIChiICYmIGIud2lkdGggPyBiLndpZHRoIDogMSk7XG5cdFx0XHRcdFx0XHR9LCAwKSA6IDAsIHI6IGxpc3QubGVuZ3RoIH0gfTtcblxuXHRcdFx0XHQvL3BhcnNlIHJvdyBsaXN0XG5cdFx0XHRcdGxpc3QuZm9yRWFjaChmdW5jdGlvbiAocm93LCBpKSB7XG5cdFx0XHRcdFx0dmFyIHJvd0RhdGEgPSBbXTtcblxuXHRcdFx0XHRcdHJvdy5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbCwgaikge1xuXG5cdFx0XHRcdFx0XHRpZiAoY29sKSB7XG5cdFx0XHRcdFx0XHRcdHJvd0RhdGEucHVzaCghKGNvbC52YWx1ZSBpbnN0YW5jZW9mIERhdGUpICYmIF90eXBlb2YoY29sLnZhbHVlKSA9PT0gXCJvYmplY3RcIiA/IEpTT04uc3RyaW5naWZ5KGNvbC52YWx1ZSkgOiBjb2wudmFsdWUpO1xuXG5cdFx0XHRcdFx0XHRcdGlmIChjb2wud2lkdGggPiAxIHx8IGNvbC5oZWlnaHQgPiAtMSkge1xuXHRcdFx0XHRcdFx0XHRcdG1lcmdlcy5wdXNoKHsgczogeyByOiBpLCBjOiBqIH0sIGU6IHsgcjogaSArIGNvbC5oZWlnaHQgLSAxLCBjOiBqICsgY29sLndpZHRoIC0gMSB9IH0pO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRyb3dEYXRhLnB1c2goXCJcIik7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRyb3dzLnB1c2gocm93RGF0YSk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdC8vY29udmVydCByb3dzIHRvIHdvcmtzaGVldFxuXHRcdFx0XHRYTFNYLnV0aWxzLnNoZWV0X2FkZF9hb2Eod29ya3NoZWV0LCByb3dzKTtcblxuXHRcdFx0XHR3b3Jrc2hlZXRbJyFyZWYnXSA9IFhMU1gudXRpbHMuZW5jb2RlX3JhbmdlKHJhbmdlKTtcblxuXHRcdFx0XHRpZiAobWVyZ2VzLmxlbmd0aCkge1xuXHRcdFx0XHRcdHdvcmtzaGVldFtcIiFtZXJnZXNcIl0gPSBtZXJnZXM7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gd29ya3NoZWV0O1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAob3B0aW9ucy5zaGVldE9ubHkpIHtcblx0XHRcdFx0c2V0RmlsZUNvbnRlbnRzKGdlbmVyYXRlU2hlZXQoKSk7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0aWYgKG9wdGlvbnMuc2hlZXRzKSB7XG5cdFx0XHRcdGZvciAodmFyIHNoZWV0IGluIG9wdGlvbnMuc2hlZXRzKSB7XG5cblx0XHRcdFx0XHRpZiAob3B0aW9ucy5zaGVldHNbc2hlZXRdID09PSB0cnVlKSB7XG5cdFx0XHRcdFx0XHR3b3JrYm9vay5TaGVldE5hbWVzLnB1c2goc2hlZXQpO1xuXHRcdFx0XHRcdFx0d29ya2Jvb2suU2hlZXRzW3NoZWV0XSA9IGdlbmVyYXRlU2hlZXQoKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHR3b3JrYm9vay5TaGVldE5hbWVzLnB1c2goc2hlZXQpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuY29tbXMuc2VuZChvcHRpb25zLnNoZWV0c1tzaGVldF0sIFwiZG93bmxvYWRcIiwgXCJpbnRlcmNlcHRcIiwge1xuXHRcdFx0XHRcdFx0XHR0eXBlOiBcInhsc3hcIixcblx0XHRcdFx0XHRcdFx0b3B0aW9uczogeyBzaGVldE9ubHk6IHRydWUgfSxcblx0XHRcdFx0XHRcdFx0YWN0aXZlOiBzZWxmLmFjdGl2ZSxcblx0XHRcdFx0XHRcdFx0aW50ZXJjZXB0OiBmdW5jdGlvbiBpbnRlcmNlcHQoZGF0YSkge1xuXHRcdFx0XHRcdFx0XHRcdHdvcmtib29rLlNoZWV0c1tzaGVldF0gPSBkYXRhO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHdvcmtib29rLlNoZWV0TmFtZXMucHVzaChzaGVldE5hbWUpO1xuXHRcdFx0XHR3b3JrYm9vay5TaGVldHNbc2hlZXROYW1lXSA9IGdlbmVyYXRlU2hlZXQoKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKG9wdGlvbnMuZG9jdW1lbnRQcm9jZXNzaW5nKSB7XG5cdFx0XHRcdHdvcmtib29rID0gb3B0aW9ucy5kb2N1bWVudFByb2Nlc3Npbmcod29ya2Jvb2spO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2NvbnZlcnQgd29ya2Jvb2sgdG8gYmluYXJ5IGFycmF5XG5cdFx0XHRmdW5jdGlvbiBzMmFiKHMpIHtcblx0XHRcdFx0dmFyIGJ1ZiA9IG5ldyBBcnJheUJ1ZmZlcihzLmxlbmd0aCk7XG5cdFx0XHRcdHZhciB2aWV3ID0gbmV3IFVpbnQ4QXJyYXkoYnVmKTtcblx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgIT0gcy5sZW5ndGg7ICsraSkge1xuXHRcdFx0XHRcdHZpZXdbaV0gPSBzLmNoYXJDb2RlQXQoaSkgJiAweEZGO1xuXHRcdFx0XHR9cmV0dXJuIGJ1Zjtcblx0XHRcdH1cblxuXHRcdFx0b3V0cHV0ID0gWExTWC53cml0ZSh3b3JrYm9vaywgeyBib29rVHlwZTogJ3hsc3gnLCBib29rU1NUOiB0cnVlLCB0eXBlOiAnYmluYXJ5JyB9KTtcblxuXHRcdFx0c2V0RmlsZUNvbnRlbnRzKHMyYWIob3V0cHV0KSwgXCJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW1cIik7XG5cdFx0fSxcblxuXHRcdGh0bWw6IGZ1bmN0aW9uIGh0bWwobGlzdCwgb3B0aW9ucywgc2V0RmlsZUNvbnRlbnRzKSB7XG5cdFx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJleHBvcnRcIiwgdHJ1ZSkpIHtcblx0XHRcdFx0c2V0RmlsZUNvbnRlbnRzKHRoaXMubW9kdWxlcy5leHBvcnQuZ2VuZXJlYXRlSFRNTFRhYmxlKGxpc3QpLCBcInRleHQvaHRtbFwiKTtcblx0XHRcdH1cblx0XHR9XG5cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnJlZ2lzdGVyTW9kdWxlKFwiZG93bmxvYWRcIiwgRG93bmxvYWQpO1xuXG5cdHZhciBFZGl0ID0gZnVuY3Rpb24gRWRpdCh0YWJsZSkge1xuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIFRhYnVsYXRvciBvYmplY3Rcblx0XHR0aGlzLmN1cnJlbnRDZWxsID0gZmFsc2U7IC8vaG9sZCBjdXJyZW50bHkgZWRpdGluZyBjZWxsXG5cdFx0dGhpcy5tb3VzZUNsaWNrID0gZmFsc2U7IC8vaG9sZCBtb3VzZWRvd24gc3RhdGUgdG8gcHJldmVudCBjbGljayBiaW5kaW5nIGJlaW5nIG92ZXJyaWRlbiBieSBlZGl0b3Igb3BlbmluZ1xuXHRcdHRoaXMucmVjdXJzaW9uQmxvY2sgPSBmYWxzZTsgLy9wcmV2ZW50IGZvY3VzIHJlY3Vyc2lvblxuXHRcdHRoaXMuaW52YWxpZEVkaXQgPSBmYWxzZTtcblx0XHR0aGlzLmVkaXRlZENlbGxzID0gW107XG5cdH07XG5cblx0Ly9pbml0aWFsaXplIGNvbHVtbiBlZGl0b3Jcblx0RWRpdC5wcm90b3R5cGUuaW5pdGlhbGl6ZUNvbHVtbiA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGNvbmZpZyA9IHtcblx0XHRcdGVkaXRvcjogZmFsc2UsXG5cdFx0XHRibG9ja2VkOiBmYWxzZSxcblx0XHRcdGNoZWNrOiBjb2x1bW4uZGVmaW5pdGlvbi5lZGl0YWJsZSxcblx0XHRcdHBhcmFtczogY29sdW1uLmRlZmluaXRpb24uZWRpdG9yUGFyYW1zIHx8IHt9XG5cdFx0fTtcblxuXHRcdC8vc2V0IGNvbHVtbiBlZGl0b3Jcblx0XHRzd2l0Y2ggKF90eXBlb2YoY29sdW1uLmRlZmluaXRpb24uZWRpdG9yKSkge1xuXHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXG5cdFx0XHRcdGlmIChjb2x1bW4uZGVmaW5pdGlvbi5lZGl0b3IgPT09IFwidGlja1wiKSB7XG5cdFx0XHRcdFx0Y29sdW1uLmRlZmluaXRpb24uZWRpdG9yID0gXCJ0aWNrQ3Jvc3NcIjtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJERVBSRUNBVElPTiBXQVJOSU5HIC0gdGhlIHRpY2sgZWRpdG9yIGhhcyBiZWVuIGRlcHJlY2F0ZWQsIHBsZWFzZSB1c2UgdGhlIHRpY2tDcm9zcyBlZGl0b3JcIik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc2VsZi5lZGl0b3JzW2NvbHVtbi5kZWZpbml0aW9uLmVkaXRvcl0pIHtcblx0XHRcdFx0XHRjb25maWcuZWRpdG9yID0gc2VsZi5lZGl0b3JzW2NvbHVtbi5kZWZpbml0aW9uLmVkaXRvcl07XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiRWRpdG9yIEVycm9yIC0gTm8gc3VjaCBlZGl0b3IgZm91bmQ6IFwiLCBjb2x1bW4uZGVmaW5pdGlvbi5lZGl0b3IpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0Y29uZmlnLmVkaXRvciA9IGNvbHVtbi5kZWZpbml0aW9uLmVkaXRvcjtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJib29sZWFuXCI6XG5cblx0XHRcdFx0aWYgKGNvbHVtbi5kZWZpbml0aW9uLmVkaXRvciA9PT0gdHJ1ZSkge1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZiBjb2x1bW4uZGVmaW5pdGlvbi5mb3JtYXR0ZXIgIT09IFwiZnVuY3Rpb25cIikge1xuXG5cdFx0XHRcdFx0XHRpZiAoY29sdW1uLmRlZmluaXRpb24uZm9ybWF0dGVyID09PSBcInRpY2tcIikge1xuXHRcdFx0XHRcdFx0XHRjb2x1bW4uZGVmaW5pdGlvbi5mb3JtYXR0ZXIgPSBcInRpY2tDcm9zc1wiO1xuXHRcdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJERVBSRUNBVElPTiBXQVJOSU5HIC0gdGhlIHRpY2sgZWRpdG9yIGhhcyBiZWVuIGRlcHJlY2F0ZWQsIHBsZWFzZSB1c2UgdGhlIHRpY2tDcm9zcyBlZGl0b3JcIik7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmIChzZWxmLmVkaXRvcnNbY29sdW1uLmRlZmluaXRpb24uZm9ybWF0dGVyXSkge1xuXHRcdFx0XHRcdFx0XHRjb25maWcuZWRpdG9yID0gc2VsZi5lZGl0b3JzW2NvbHVtbi5kZWZpbml0aW9uLmZvcm1hdHRlcl07XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRjb25maWcuZWRpdG9yID0gc2VsZi5lZGl0b3JzW1wiaW5wdXRcIl07XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkVkaXRvciBFcnJvciAtIENhbm5vdCBhdXRvIGxvb2t1cCBlZGl0b3IgZm9yIGEgY3VzdG9tIGZvcm1hdHRlcjogXCIsIGNvbHVtbi5kZWZpbml0aW9uLmZvcm1hdHRlcik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblxuXHRcdGlmIChjb25maWcuZWRpdG9yKSB7XG5cdFx0XHRjb2x1bW4ubW9kdWxlcy5lZGl0ID0gY29uZmlnO1xuXHRcdH1cblx0fTtcblxuXHRFZGl0LnByb3RvdHlwZS5nZXRDdXJyZW50Q2VsbCA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5jdXJyZW50Q2VsbCA/IHRoaXMuY3VycmVudENlbGwuZ2V0Q29tcG9uZW50KCkgOiBmYWxzZTtcblx0fTtcblxuXHRFZGl0LnByb3RvdHlwZS5jbGVhckVkaXRvciA9IGZ1bmN0aW9uIChjYW5jZWwpIHtcblx0XHR2YXIgY2VsbCA9IHRoaXMuY3VycmVudENlbGwsXG5cdFx0ICAgIGNlbGxFbDtcblxuXHRcdHRoaXMuaW52YWxpZEVkaXQgPSBmYWxzZTtcblxuXHRcdGlmIChjZWxsKSB7XG5cdFx0XHR0aGlzLmN1cnJlbnRDZWxsID0gZmFsc2U7XG5cblx0XHRcdGNlbGxFbCA9IGNlbGwuZ2V0RWxlbWVudCgpO1xuXG5cdFx0XHRpZiAoY2FuY2VsKSB7XG5cdFx0XHRcdGNlbGwudmFsaWRhdGUoKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNlbGxFbC5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLXZhbGlkYXRpb24tZmFpbFwiKTtcblx0XHRcdH1cblxuXHRcdFx0Y2VsbEVsLmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItZWRpdGluZ1wiKTtcblx0XHRcdHdoaWxlIChjZWxsRWwuZmlyc3RDaGlsZCkge1xuXHRcdFx0XHRjZWxsRWwucmVtb3ZlQ2hpbGQoY2VsbEVsLmZpcnN0Q2hpbGQpO1xuXHRcdFx0fWNlbGwucm93LmdldEVsZW1lbnQoKS5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLXJvdy1lZGl0aW5nXCIpO1xuXHRcdH1cblx0fTtcblxuXHRFZGl0LnByb3RvdHlwZS5jYW5jZWxFZGl0ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMuY3VycmVudENlbGwpIHtcblx0XHRcdHZhciBjZWxsID0gdGhpcy5jdXJyZW50Q2VsbDtcblx0XHRcdHZhciBjb21wb25lbnQgPSB0aGlzLmN1cnJlbnRDZWxsLmdldENvbXBvbmVudCgpO1xuXG5cdFx0XHR0aGlzLmNsZWFyRWRpdG9yKHRydWUpO1xuXHRcdFx0Y2VsbC5zZXRWYWx1ZUFjdHVhbChjZWxsLmdldFZhbHVlKCkpO1xuXHRcdFx0Y2VsbC5jZWxsUmVuZGVyZWQoKTtcblxuXHRcdFx0aWYgKGNlbGwuY29sdW1uLmNlbGxFdmVudHMuY2VsbEVkaXRDYW5jZWxsZWQpIHtcblx0XHRcdFx0Y2VsbC5jb2x1bW4uY2VsbEV2ZW50cy5jZWxsRWRpdENhbmNlbGxlZC5jYWxsKHRoaXMudGFibGUsIGNvbXBvbmVudCk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5jZWxsRWRpdENhbmNlbGxlZC5jYWxsKHRoaXMudGFibGUsIGNvbXBvbmVudCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vcmV0dXJuIGEgZm9ybWF0dGVkIHZhbHVlIGZvciBhIGNlbGxcblx0RWRpdC5wcm90b3R5cGUuYmluZEVkaXRvciA9IGZ1bmN0aW9uIChjZWxsKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBlbGVtZW50ID0gY2VsbC5nZXRFbGVtZW50KCk7XG5cblx0XHRlbGVtZW50LnNldEF0dHJpYnV0ZShcInRhYmluZGV4XCIsIDApO1xuXG5cdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdGlmICghZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoXCJ0YWJ1bGF0b3ItZWRpdGluZ1wiKSkge1xuXHRcdFx0XHRlbGVtZW50LmZvY3VzKHsgcHJldmVudFNjcm9sbDogdHJ1ZSB9KTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0c2VsZi5tb3VzZUNsaWNrID0gdHJ1ZTtcblx0XHR9KTtcblxuXHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImZvY3VzXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRpZiAoIXNlbGYucmVjdXJzaW9uQmxvY2spIHtcblx0XHRcdFx0c2VsZi5lZGl0KGNlbGwsIGUsIGZhbHNlKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHRFZGl0LnByb3RvdHlwZS5mb2N1c0NlbGxOb0V2ZW50ID0gZnVuY3Rpb24gKGNlbGwsIGJsb2NrKSB7XG5cdFx0dGhpcy5yZWN1cnNpb25CbG9jayA9IHRydWU7XG5cdFx0aWYgKCEoYmxvY2sgJiYgdGhpcy50YWJsZS5icm93c2VyID09PSBcImllXCIpKSB7XG5cdFx0XHRjZWxsLmdldEVsZW1lbnQoKS5mb2N1cyh7IHByZXZlbnRTY3JvbGw6IHRydWUgfSk7XG5cdFx0fVxuXHRcdHRoaXMucmVjdXJzaW9uQmxvY2sgPSBmYWxzZTtcblx0fTtcblxuXHRFZGl0LnByb3RvdHlwZS5lZGl0Q2VsbCA9IGZ1bmN0aW9uIChjZWxsLCBmb3JjZUVkaXQpIHtcblx0XHR0aGlzLmZvY3VzQ2VsbE5vRXZlbnQoY2VsbCk7XG5cdFx0dGhpcy5lZGl0KGNlbGwsIGZhbHNlLCBmb3JjZUVkaXQpO1xuXHR9O1xuXG5cdEVkaXQucHJvdG90eXBlLmZvY3VzU2Nyb2xsQWRqdXN0ID0gZnVuY3Rpb24gKGNlbGwpIHtcblx0XHRpZiAodGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldFJlbmRlck1vZGUoKSA9PSBcInZpcnR1YWxcIikge1xuXHRcdFx0dmFyIHRvcEVkZ2UgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxUb3AsXG5cdFx0XHQgICAgYm90dG9tRWRnZSA9IHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LmNsaWVudEhlaWdodCArIHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LnNjcm9sbFRvcCxcblx0XHRcdCAgICByb3dFbCA9IGNlbGwucm93LmdldEVsZW1lbnQoKSxcblx0XHRcdCAgICBvZmZzZXQgPSByb3dFbC5vZmZzZXRUb3A7XG5cblx0XHRcdGlmIChyb3dFbC5vZmZzZXRUb3AgPCB0b3BFZGdlKSB7XG5cdFx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LnNjcm9sbFRvcCAtPSB0b3BFZGdlIC0gcm93RWwub2Zmc2V0VG9wO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKHJvd0VsLm9mZnNldFRvcCArIHJvd0VsLm9mZnNldEhlaWdodCA+IGJvdHRvbUVkZ2UpIHtcblx0XHRcdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxUb3AgKz0gcm93RWwub2Zmc2V0VG9wICsgcm93RWwub2Zmc2V0SGVpZ2h0IC0gYm90dG9tRWRnZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRFZGl0LnByb3RvdHlwZS5lZGl0ID0gZnVuY3Rpb24gKGNlbGwsIGUsIGZvcmNlRWRpdCkge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgYWxsb3dFZGl0ID0gdHJ1ZSxcblx0XHQgICAgcmVuZGVyZWQgPSBmdW5jdGlvbiByZW5kZXJlZCgpIHt9LFxuXHRcdCAgICBlbGVtZW50ID0gY2VsbC5nZXRFbGVtZW50KCksXG5cdFx0ICAgIGNlbGxFZGl0b3IsXG5cdFx0ICAgIGNvbXBvbmVudCxcblx0XHQgICAgcGFyYW1zO1xuXG5cdFx0Ly9wcmV2ZW50IGVkaXRpbmcgaWYgYW5vdGhlciBjZWxsIGlzIHJlZnVzaW5nIHRvIGxlYXZlIGZvY3VzIChlZy4gdmFsaWRhdGlvbiBmYWlsKVxuXHRcdGlmICh0aGlzLmN1cnJlbnRDZWxsKSB7XG5cdFx0XHRpZiAoIXRoaXMuaW52YWxpZEVkaXQpIHtcblx0XHRcdFx0dGhpcy5jYW5jZWxFZGl0KCk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0Ly9oYW5kbGUgc3VjY2Vzc2Z1bGwgdmFsdWUgY2hhbmdlXG5cdFx0ZnVuY3Rpb24gc3VjY2Vzcyh2YWx1ZSkge1xuXHRcdFx0aWYgKHNlbGYuY3VycmVudENlbGwgPT09IGNlbGwpIHtcblx0XHRcdFx0dmFyIHZhbGlkID0gdHJ1ZTtcblxuXHRcdFx0XHRpZiAoY2VsbC5jb2x1bW4ubW9kdWxlcy52YWxpZGF0ZSAmJiBzZWxmLnRhYmxlLm1vZEV4aXN0cyhcInZhbGlkYXRlXCIpICYmIHNlbGYudGFibGUub3B0aW9ucy52YWxpZGF0aW9uTW9kZSAhPSBcIm1hbnVhbFwiKSB7XG5cdFx0XHRcdFx0dmFsaWQgPSBzZWxmLnRhYmxlLm1vZHVsZXMudmFsaWRhdGUudmFsaWRhdGUoY2VsbC5jb2x1bW4ubW9kdWxlcy52YWxpZGF0ZSwgY2VsbCwgdmFsdWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHZhbGlkID09PSB0cnVlIHx8IHNlbGYudGFibGUub3B0aW9ucy52YWxpZGF0aW9uTW9kZSA9PT0gXCJoaWdobGlnaHRcIikge1xuXHRcdFx0XHRcdHNlbGYuY2xlYXJFZGl0b3IoKTtcblx0XHRcdFx0XHRjZWxsLnNldFZhbHVlKHZhbHVlLCB0cnVlKTtcblxuXHRcdFx0XHRcdGlmICghY2VsbC5tb2R1bGVzLmVkaXQpIHtcblx0XHRcdFx0XHRcdGNlbGwubW9kdWxlcy5lZGl0ID0ge307XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Y2VsbC5tb2R1bGVzLmVkaXQuZWRpdGVkID0gdHJ1ZTtcblxuXHRcdFx0XHRcdGlmIChzZWxmLmVkaXRlZENlbGxzLmluZGV4T2YoY2VsbCkgPT0gLTEpIHtcblx0XHRcdFx0XHRcdHNlbGYuZWRpdGVkQ2VsbHMucHVzaChjZWxsKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLmRhdGFUcmVlICYmIHNlbGYudGFibGUubW9kRXhpc3RzKFwiZGF0YVRyZWVcIikpIHtcblx0XHRcdFx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5kYXRhVHJlZS5jaGVja0ZvclJlc3R5bGUoY2VsbCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHZhbGlkICE9PSB0cnVlKSB7XG5cdFx0XHRcdFx0XHRlbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItdmFsaWRhdGlvbi1mYWlsXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHNlbGYuaW52YWxpZEVkaXQgPSB0cnVlO1xuXHRcdFx0XHRcdGVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci12YWxpZGF0aW9uLWZhaWxcIik7XG5cdFx0XHRcdFx0c2VsZi5mb2N1c0NlbGxOb0V2ZW50KGNlbGwsIHRydWUpO1xuXHRcdFx0XHRcdHJlbmRlcmVkKCk7XG5cdFx0XHRcdFx0c2VsZi50YWJsZS5vcHRpb25zLnZhbGlkYXRpb25GYWlsZWQuY2FsbChzZWxmLnRhYmxlLCBjZWxsLmdldENvbXBvbmVudCgpLCB2YWx1ZSwgdmFsaWQpO1xuXG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBjb25zb2xlLndhcm4oXCJFZGl0IFN1Y2Nlc3MgRXJyb3IgLSBjYW5ub3QgY2FsbCBzdWNjZXNzIG9uIGEgY2VsbCB0aGF0IGlzIG5vIGxvbmdlciBiZWluZyBlZGl0ZWRcIik7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly9oYW5kbGUgYWJvcnRlZCBlZGl0XG5cdFx0ZnVuY3Rpb24gY2FuY2VsKCkge1xuXHRcdFx0aWYgKHNlbGYuY3VycmVudENlbGwgPT09IGNlbGwpIHtcblx0XHRcdFx0c2VsZi5jYW5jZWxFZGl0KCk7XG5cblx0XHRcdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5kYXRhVHJlZSAmJiBzZWxmLnRhYmxlLm1vZEV4aXN0cyhcImRhdGFUcmVlXCIpKSB7XG5cdFx0XHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLmRhdGFUcmVlLmNoZWNrRm9yUmVzdHlsZShjZWxsKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gY29uc29sZS53YXJuKFwiRWRpdCBTdWNjZXNzIEVycm9yIC0gY2Fubm90IGNhbGwgY2FuY2VsIG9uIGEgY2VsbCB0aGF0IGlzIG5vIGxvbmdlciBiZWluZyBlZGl0ZWRcIik7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gb25SZW5kZXJlZChjYWxsYmFjaykge1xuXHRcdFx0cmVuZGVyZWQgPSBjYWxsYmFjaztcblx0XHR9XG5cblx0XHRpZiAoIWNlbGwuY29sdW1uLm1vZHVsZXMuZWRpdC5ibG9ja2VkKSB7XG5cdFx0XHRpZiAoZSkge1xuXHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0fVxuXG5cdFx0XHRzd2l0Y2ggKF90eXBlb2YoY2VsbC5jb2x1bW4ubW9kdWxlcy5lZGl0LmNoZWNrKSkge1xuXHRcdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0XHRhbGxvd0VkaXQgPSBjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQuY2hlY2soY2VsbC5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSBcImJvb2xlYW5cIjpcblx0XHRcdFx0XHRhbGxvd0VkaXQgPSBjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQuY2hlY2s7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhbGxvd0VkaXQgfHwgZm9yY2VFZGl0KSB7XG5cblx0XHRcdFx0c2VsZi5jYW5jZWxFZGl0KCk7XG5cblx0XHRcdFx0c2VsZi5jdXJyZW50Q2VsbCA9IGNlbGw7XG5cblx0XHRcdFx0dGhpcy5mb2N1c1Njcm9sbEFkanVzdChjZWxsKTtcblxuXHRcdFx0XHRjb21wb25lbnQgPSBjZWxsLmdldENvbXBvbmVudCgpO1xuXG5cdFx0XHRcdGlmICh0aGlzLm1vdXNlQ2xpY2spIHtcblx0XHRcdFx0XHR0aGlzLm1vdXNlQ2xpY2sgPSBmYWxzZTtcblxuXHRcdFx0XHRcdGlmIChjZWxsLmNvbHVtbi5jZWxsRXZlbnRzLmNlbGxDbGljaykge1xuXHRcdFx0XHRcdFx0Y2VsbC5jb2x1bW4uY2VsbEV2ZW50cy5jZWxsQ2xpY2suY2FsbCh0aGlzLnRhYmxlLCBlLCBjb21wb25lbnQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChjZWxsLmNvbHVtbi5jZWxsRXZlbnRzLmNlbGxFZGl0aW5nKSB7XG5cdFx0XHRcdFx0Y2VsbC5jb2x1bW4uY2VsbEV2ZW50cy5jZWxsRWRpdGluZy5jYWxsKHRoaXMudGFibGUsIGNvbXBvbmVudCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbEVkaXRpbmcuY2FsbCh0aGlzLnRhYmxlLCBjb21wb25lbnQpO1xuXG5cdFx0XHRcdHBhcmFtcyA9IHR5cGVvZiBjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQucGFyYW1zID09PSBcImZ1bmN0aW9uXCIgPyBjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQucGFyYW1zKGNvbXBvbmVudCkgOiBjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQucGFyYW1zO1xuXG5cdFx0XHRcdGNlbGxFZGl0b3IgPSBjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQuZWRpdG9yLmNhbGwoc2VsZiwgY29tcG9uZW50LCBvblJlbmRlcmVkLCBzdWNjZXNzLCBjYW5jZWwsIHBhcmFtcyk7XG5cblx0XHRcdFx0Ly9pZiBlZGl0b3IgcmV0dXJuZWQsIGFkZCB0byBET00sIGlmIGZhbHNlLCBhYm9ydCBlZGl0XG5cdFx0XHRcdGlmIChjZWxsRWRpdG9yICE9PSBmYWxzZSkge1xuXG5cdFx0XHRcdFx0aWYgKGNlbGxFZGl0b3IgaW5zdGFuY2VvZiBOb2RlKSB7XG5cdFx0XHRcdFx0XHRlbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZWRpdGluZ1wiKTtcblx0XHRcdFx0XHRcdGNlbGwucm93LmdldEVsZW1lbnQoKS5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXJvdy1lZGl0aW5nXCIpO1xuXHRcdFx0XHRcdFx0d2hpbGUgKGVsZW1lbnQuZmlyc3RDaGlsZCkge1xuXHRcdFx0XHRcdFx0XHRlbGVtZW50LnJlbW92ZUNoaWxkKGVsZW1lbnQuZmlyc3RDaGlsZCk7XG5cdFx0XHRcdFx0XHR9ZWxlbWVudC5hcHBlbmRDaGlsZChjZWxsRWRpdG9yKTtcblxuXHRcdFx0XHRcdFx0Ly90cmlnZ2VyIG9uUmVuZGVyZWQgQ2FsbGJhY2tcblx0XHRcdFx0XHRcdHJlbmRlcmVkKCk7XG5cblx0XHRcdFx0XHRcdC8vcHJldmVudCBlZGl0aW5nIGZyb20gdHJpZ2dlcmluZyByb3dDbGljayBldmVudFxuXHRcdFx0XHRcdFx0dmFyIGNoaWxkcmVuID0gZWxlbWVudC5jaGlsZHJlbjtcblxuXHRcdFx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdFx0XHRjaGlsZHJlbltpXS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiRWRpdCBFcnJvciAtIEVkaXRvciBzaG91bGQgcmV0dXJuIGFuIGluc3RhbmNlIG9mIE5vZGUsIHRoZSBlZGl0b3IgcmV0dXJuZWQ6XCIsIGNlbGxFZGl0b3IpO1xuXHRcdFx0XHRcdFx0ZWxlbWVudC5ibHVyKCk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGVsZW1lbnQuYmx1cigpO1xuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5tb3VzZUNsaWNrID0gZmFsc2U7XG5cdFx0XHRcdGVsZW1lbnQuYmx1cigpO1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMubW91c2VDbGljayA9IGZhbHNlO1xuXHRcdFx0ZWxlbWVudC5ibHVyKCk7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdEVkaXQucHJvdG90eXBlLm1hc2tJbnB1dCA9IGZ1bmN0aW9uIChlbCwgb3B0aW9ucykge1xuXHRcdHZhciBtYXNrID0gb3B0aW9ucy5tYXNrLFxuXHRcdCAgICBtYXNrTGV0dGVyID0gdHlwZW9mIG9wdGlvbnMubWFza0xldHRlckNoYXIgIT09IFwidW5kZWZpbmVkXCIgPyBvcHRpb25zLm1hc2tMZXR0ZXJDaGFyIDogXCJBXCIsXG5cdFx0ICAgIG1hc2tOdW1iZXIgPSB0eXBlb2Ygb3B0aW9ucy5tYXNrTnVtYmVyQ2hhciAhPT0gXCJ1bmRlZmluZWRcIiA/IG9wdGlvbnMubWFza051bWJlckNoYXIgOiBcIjlcIixcblx0XHQgICAgbWFza1dpbGRjYXJkID0gdHlwZW9mIG9wdGlvbnMubWFza1dpbGRjYXJkQ2hhciAhPT0gXCJ1bmRlZmluZWRcIiA/IG9wdGlvbnMubWFza1dpbGRjYXJkQ2hhciA6IFwiKlwiLFxuXHRcdCAgICBzdWNjZXNzID0gZmFsc2U7XG5cblx0XHRmdW5jdGlvbiBmaWxsU3ltYm9scyhpbmRleCkge1xuXHRcdFx0dmFyIHN5bWJvbCA9IG1hc2tbaW5kZXhdO1xuXHRcdFx0aWYgKHR5cGVvZiBzeW1ib2wgIT09IFwidW5kZWZpbmVkXCIgJiYgc3ltYm9sICE9PSBtYXNrV2lsZGNhcmQgJiYgc3ltYm9sICE9PSBtYXNrTGV0dGVyICYmIHN5bWJvbCAhPT0gbWFza051bWJlcikge1xuXHRcdFx0XHRlbC52YWx1ZSA9IGVsLnZhbHVlICsgXCJcIiArIHN5bWJvbDtcblx0XHRcdFx0ZmlsbFN5bWJvbHMoaW5kZXggKyAxKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRlbC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0dmFyIGluZGV4ID0gZWwudmFsdWUubGVuZ3RoLFxuXHRcdFx0ICAgIGNoYXIgPSBlLmtleTtcblxuXHRcdFx0aWYgKGUua2V5Q29kZSA+IDQ2KSB7XG5cdFx0XHRcdGlmIChpbmRleCA+PSBtYXNrLmxlbmd0aCkge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdHN1Y2Nlc3MgPSBmYWxzZTtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c3dpdGNoIChtYXNrW2luZGV4XSkge1xuXHRcdFx0XHRcdFx0Y2FzZSBtYXNrTGV0dGVyOlxuXHRcdFx0XHRcdFx0XHRpZiAoY2hhci50b1VwcGVyQ2FzZSgpID09IGNoYXIudG9Mb3dlckNhc2UoKSkge1xuXHRcdFx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0XHRcdHN1Y2Nlc3MgPSBmYWxzZTtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdGNhc2UgbWFza051bWJlcjpcblx0XHRcdFx0XHRcdFx0aWYgKGlzTmFOKGNoYXIpKSB7XG5cdFx0XHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHRcdFx0c3VjY2VzcyA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0Y2FzZSBtYXNrV2lsZGNhcmQ6XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdFx0XHRpZiAoY2hhciAhPT0gbWFza1tpbmRleF0pIHtcblx0XHRcdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdFx0XHRzdWNjZXNzID0gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0c3VjY2VzcyA9IHRydWU7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybjtcblx0XHR9KTtcblxuXHRcdGVsLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0aWYgKGUua2V5Q29kZSA+IDQ2KSB7XG5cdFx0XHRcdGlmIChvcHRpb25zLm1hc2tBdXRvRmlsbCkge1xuXHRcdFx0XHRcdGZpbGxTeW1ib2xzKGVsLnZhbHVlLmxlbmd0aCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGlmICghZWwucGxhY2Vob2xkZXIpIHtcblx0XHRcdGVsLnBsYWNlaG9sZGVyID0gbWFzaztcblx0XHR9XG5cblx0XHRpZiAob3B0aW9ucy5tYXNrQXV0b0ZpbGwpIHtcblx0XHRcdGZpbGxTeW1ib2xzKGVsLnZhbHVlLmxlbmd0aCk7XG5cdFx0fVxuXHR9O1xuXG5cdEVkaXQucHJvdG90eXBlLmdldEVkaXRlZENlbGxzID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBvdXRwdXQgPSBbXTtcblxuXHRcdHRoaXMuZWRpdGVkQ2VsbHMuZm9yRWFjaChmdW5jdGlvbiAoY2VsbCkge1xuXHRcdFx0b3V0cHV0LnB1c2goY2VsbC5nZXRDb21wb25lbnQoKSk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9O1xuXG5cdEVkaXQucHJvdG90eXBlLmNsZWFyRWRpdGVkID0gZnVuY3Rpb24gKGNlbGwpIHtcblx0XHR2YXIgZWRpdEluZGV4O1xuXG5cdFx0aWYgKGNlbGwubW9kdWxlcy5lZGl0ICYmIGNlbGwubW9kdWxlcy5lZGl0LmVkaXRlZCkge1xuXHRcdFx0Y2VsbC5tb2R1bGVzLnZhbGlkYXRlLmludmFsaWQgPSBmYWxzZTtcblxuXHRcdFx0ZWRpdEluZGV4ID0gdGhpcy5lZGl0ZWRDZWxscy5pbmRleE9mKGNlbGwpO1xuXG5cdFx0XHRpZiAoZWRpdEluZGV4ID4gLTEpIHtcblx0XHRcdFx0dGhpcy5lZGl0ZWRDZWxscy5zcGxpY2UoZWRpdEluZGV4LCAxKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Ly9kZWZhdWx0IGRhdGEgZWRpdG9yc1xuXHRFZGl0LnByb3RvdHlwZS5lZGl0b3JzID0ge1xuXG5cdFx0Ly9pbnB1dCBlbGVtZW50XG5cdFx0aW5wdXQ6IGZ1bmN0aW9uIGlucHV0KGNlbGwsIG9uUmVuZGVyZWQsIHN1Y2Nlc3MsIGNhbmNlbCwgZWRpdG9yUGFyYW1zKSB7XG5cblx0XHRcdC8vY3JlYXRlIGFuZCBzdHlsZSBpbnB1dFxuXHRcdFx0dmFyIGNlbGxWYWx1ZSA9IGNlbGwuZ2V0VmFsdWUoKSxcblx0XHRcdCAgICBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcblxuXHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBlZGl0b3JQYXJhbXMuc2VhcmNoID8gXCJzZWFyY2hcIiA6IFwidGV4dFwiKTtcblxuXHRcdFx0aW5wdXQuc3R5bGUucGFkZGluZyA9IFwiNHB4XCI7XG5cdFx0XHRpbnB1dC5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuXHRcdFx0aW5wdXQuc3R5bGUuYm94U2l6aW5nID0gXCJib3JkZXItYm94XCI7XG5cblx0XHRcdGlmIChlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMgJiYgX3R5cGVvZihlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMpID09IFwib2JqZWN0XCIpIHtcblx0XHRcdFx0Zm9yICh2YXIga2V5IGluIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcykge1xuXHRcdFx0XHRcdGlmIChrZXkuY2hhckF0KDApID09IFwiK1wiKSB7XG5cdFx0XHRcdFx0XHRrZXkgPSBrZXkuc2xpY2UoMSk7XG5cdFx0XHRcdFx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoa2V5LCBpbnB1dC5nZXRBdHRyaWJ1dGUoa2V5KSArIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlc1tcIitcIiArIGtleV0pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoa2V5LCBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXNba2V5XSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlucHV0LnZhbHVlID0gdHlwZW9mIGNlbGxWYWx1ZSAhPT0gXCJ1bmRlZmluZWRcIiA/IGNlbGxWYWx1ZSA6IFwiXCI7XG5cblx0XHRcdG9uUmVuZGVyZWQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRpbnB1dC5mb2N1cyh7IHByZXZlbnRTY3JvbGw6IHRydWUgfSk7XG5cdFx0XHRcdGlucHV0LnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xuXHRcdFx0fSk7XG5cblx0XHRcdGZ1bmN0aW9uIG9uQ2hhbmdlKGUpIHtcblx0XHRcdFx0aWYgKChjZWxsVmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIGNlbGxWYWx1ZSA9PT0gXCJ1bmRlZmluZWRcIikgJiYgaW5wdXQudmFsdWUgIT09IFwiXCIgfHwgaW5wdXQudmFsdWUgIT09IGNlbGxWYWx1ZSkge1xuXHRcdFx0XHRcdGlmIChzdWNjZXNzKGlucHV0LnZhbHVlKSkge1xuXHRcdFx0XHRcdFx0Y2VsbFZhbHVlID0gaW5wdXQudmFsdWU7IC8vcGVyc2lzdCB2YWx1ZSBpZiBzdWNjZXNzZnVsbHkgdmFsaWRhdGVkIGluY2FzZSBlZGl0b3IgaXMgdXNlZCBhcyBoZWFkZXIgZmlsdGVyXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNhbmNlbCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vc3VibWl0IG5ldyB2YWx1ZSBvbiBibHVyIG9yIGNoYW5nZVxuXHRcdFx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBvbkNoYW5nZSk7XG5cdFx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCBvbkNoYW5nZSk7XG5cblx0XHRcdC8vc3VibWl0IG5ldyB2YWx1ZSBvbiBlbnRlclxuXHRcdFx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0c3dpdGNoIChlLmtleUNvZGUpIHtcblx0XHRcdFx0XHQvLyBjYXNlIDk6XG5cdFx0XHRcdFx0Y2FzZSAxMzpcblx0XHRcdFx0XHRcdG9uQ2hhbmdlKGUpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIDI3OlxuXHRcdFx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChlZGl0b3JQYXJhbXMubWFzaykge1xuXHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5tYXNrSW5wdXQoaW5wdXQsIGVkaXRvclBhcmFtcyk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBpbnB1dDtcblx0XHR9LFxuXG5cdFx0Ly9yZXNpemFibGUgdGV4dCBhcmVhIGVsZW1lbnRcblx0XHR0ZXh0YXJlYTogZnVuY3Rpb24gdGV4dGFyZWEoY2VsbCwgb25SZW5kZXJlZCwgc3VjY2VzcywgY2FuY2VsLCBlZGl0b3JQYXJhbXMpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdCAgICBjZWxsVmFsdWUgPSBjZWxsLmdldFZhbHVlKCksXG5cdFx0XHQgICAgdmVydE5hdiA9IGVkaXRvclBhcmFtcy52ZXJ0aWNhbE5hdmlnYXRpb24gfHwgXCJoeWJyaWRcIixcblx0XHRcdCAgICB2YWx1ZSA9IFN0cmluZyhjZWxsVmFsdWUgIT09IG51bGwgJiYgdHlwZW9mIGNlbGxWYWx1ZSAhPT0gXCJ1bmRlZmluZWRcIiA/IGNlbGxWYWx1ZSA6IFwiXCIpLFxuXHRcdFx0ICAgIGNvdW50ID0gKHZhbHVlLm1hdGNoKC8oPzpcXHJcXG58XFxyfFxcbikvZykgfHwgW10pLmxlbmd0aCArIDEsXG5cdFx0XHQgICAgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGV4dGFyZWFcIiksXG5cdFx0XHQgICAgc2Nyb2xsSGVpZ2h0ID0gMDtcblxuXHRcdFx0Ly9jcmVhdGUgYW5kIHN0eWxlIGlucHV0XG5cdFx0XHRpbnB1dC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuXHRcdFx0aW5wdXQuc3R5bGUucGFkZGluZyA9IFwiMnB4XCI7XG5cdFx0XHRpbnB1dC5zdHlsZS5oZWlnaHQgPSBcIjEwMCVcIjtcblx0XHRcdGlucHV0LnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG5cdFx0XHRpbnB1dC5zdHlsZS5ib3hTaXppbmcgPSBcImJvcmRlci1ib3hcIjtcblx0XHRcdGlucHV0LnN0eWxlLndoaXRlU3BhY2UgPSBcInByZS13cmFwXCI7XG5cdFx0XHRpbnB1dC5zdHlsZS5yZXNpemUgPSBcIm5vbmVcIjtcblxuXHRcdFx0aWYgKGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcyAmJiBfdHlwZW9mKGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcykgPT0gXCJvYmplY3RcIikge1xuXHRcdFx0XHRmb3IgKHZhciBrZXkgaW4gZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzKSB7XG5cdFx0XHRcdFx0aWYgKGtleS5jaGFyQXQoMCkgPT0gXCIrXCIpIHtcblx0XHRcdFx0XHRcdGtleSA9IGtleS5zbGljZSgxKTtcblx0XHRcdFx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShrZXksIGlucHV0LmdldEF0dHJpYnV0ZShrZXkpICsgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzW1wiK1wiICsga2V5XSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShrZXksIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlc1trZXldKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aW5wdXQudmFsdWUgPSB2YWx1ZTtcblxuXHRcdFx0b25SZW5kZXJlZChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdGlucHV0LmZvY3VzKHsgcHJldmVudFNjcm9sbDogdHJ1ZSB9KTtcblx0XHRcdFx0aW5wdXQuc3R5bGUuaGVpZ2h0ID0gXCIxMDAlXCI7XG5cdFx0XHR9KTtcblxuXHRcdFx0ZnVuY3Rpb24gb25DaGFuZ2UoZSkge1xuXG5cdFx0XHRcdGlmICgoY2VsbFZhbHVlID09PSBudWxsIHx8IHR5cGVvZiBjZWxsVmFsdWUgPT09IFwidW5kZWZpbmVkXCIpICYmIGlucHV0LnZhbHVlICE9PSBcIlwiIHx8IGlucHV0LnZhbHVlICE9PSBjZWxsVmFsdWUpIHtcblxuXHRcdFx0XHRcdGlmIChzdWNjZXNzKGlucHV0LnZhbHVlKSkge1xuXHRcdFx0XHRcdFx0Y2VsbFZhbHVlID0gaW5wdXQudmFsdWU7IC8vcGVyc2lzdCB2YWx1ZSBpZiBzdWNjZXNzZnVsbHkgdmFsaWRhdGVkIGluY2FzZSBlZGl0b3IgaXMgdXNlZCBhcyBoZWFkZXIgZmlsdGVyXG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0c2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRjZWxsLmdldFJvdygpLm5vcm1hbGl6ZUhlaWdodCgpO1xuXHRcdFx0XHRcdH0sIDMwMCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly9zdWJtaXQgbmV3IHZhbHVlIG9uIGJsdXIgb3IgY2hhbmdlXG5cdFx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIG9uQ2hhbmdlKTtcblx0XHRcdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJibHVyXCIsIG9uQ2hhbmdlKTtcblxuXHRcdFx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0XHRpbnB1dC5zdHlsZS5oZWlnaHQgPSBcIlwiO1xuXG5cdFx0XHRcdHZhciBoZWlnaHROb3cgPSBpbnB1dC5zY3JvbGxIZWlnaHQ7XG5cblx0XHRcdFx0aW5wdXQuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0Tm93ICsgXCJweFwiO1xuXG5cdFx0XHRcdGlmIChoZWlnaHROb3cgIT0gc2Nyb2xsSGVpZ2h0KSB7XG5cdFx0XHRcdFx0c2Nyb2xsSGVpZ2h0ID0gaGVpZ2h0Tm93O1xuXHRcdFx0XHRcdGNlbGwuZ2V0Um93KCkubm9ybWFsaXplSGVpZ2h0KCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdHN3aXRjaCAoZS5rZXlDb2RlKSB7XG5cdFx0XHRcdFx0Y2FzZSAyNzpcblx0XHRcdFx0XHRcdGNhbmNlbCgpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIDM4OlxuXHRcdFx0XHRcdFx0Ly91cCBhcnJvd1xuXHRcdFx0XHRcdFx0aWYgKHZlcnROYXYgPT0gXCJlZGl0b3JcIiB8fCB2ZXJ0TmF2ID09IFwiaHlicmlkXCIgJiYgaW5wdXQuc2VsZWN0aW9uU3RhcnQpIHtcblx0XHRcdFx0XHRcdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIDQwOlxuXHRcdFx0XHRcdFx0Ly9kb3duIGFycm93XG5cdFx0XHRcdFx0XHRpZiAodmVydE5hdiA9PSBcImVkaXRvclwiIHx8IHZlcnROYXYgPT0gXCJoeWJyaWRcIiAmJiBpbnB1dC5zZWxlY3Rpb25TdGFydCAhPT0gaW5wdXQudmFsdWUubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHRcdGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChlZGl0b3JQYXJhbXMubWFzaykge1xuXHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5tYXNrSW5wdXQoaW5wdXQsIGVkaXRvclBhcmFtcyk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBpbnB1dDtcblx0XHR9LFxuXG5cdFx0Ly9pbnB1dCBlbGVtZW50IHdpdGggdHlwZSBvZiBudW1iZXJcblx0XHRudW1iZXI6IGZ1bmN0aW9uIG51bWJlcihjZWxsLCBvblJlbmRlcmVkLCBzdWNjZXNzLCBjYW5jZWwsIGVkaXRvclBhcmFtcykge1xuXG5cdFx0XHR2YXIgY2VsbFZhbHVlID0gY2VsbC5nZXRWYWx1ZSgpLFxuXHRcdFx0ICAgIHZlcnROYXYgPSBlZGl0b3JQYXJhbXMudmVydGljYWxOYXZpZ2F0aW9uIHx8IFwiZWRpdG9yXCIsXG5cdFx0XHQgICAgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG5cblx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJudW1iZXJcIik7XG5cblx0XHRcdGlmICh0eXBlb2YgZWRpdG9yUGFyYW1zLm1heCAhPSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShcIm1heFwiLCBlZGl0b3JQYXJhbXMubWF4KTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZiBlZGl0b3JQYXJhbXMubWluICE9IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKFwibWluXCIsIGVkaXRvclBhcmFtcy5taW4pO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mIGVkaXRvclBhcmFtcy5zdGVwICE9IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKFwic3RlcFwiLCBlZGl0b3JQYXJhbXMuc3RlcCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vY3JlYXRlIGFuZCBzdHlsZSBpbnB1dFxuXHRcdFx0aW5wdXQuc3R5bGUucGFkZGluZyA9IFwiNHB4XCI7XG5cdFx0XHRpbnB1dC5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuXHRcdFx0aW5wdXQuc3R5bGUuYm94U2l6aW5nID0gXCJib3JkZXItYm94XCI7XG5cblx0XHRcdGlmIChlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMgJiYgX3R5cGVvZihlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMpID09IFwib2JqZWN0XCIpIHtcblx0XHRcdFx0Zm9yICh2YXIga2V5IGluIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcykge1xuXHRcdFx0XHRcdGlmIChrZXkuY2hhckF0KDApID09IFwiK1wiKSB7XG5cdFx0XHRcdFx0XHRrZXkgPSBrZXkuc2xpY2UoMSk7XG5cdFx0XHRcdFx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoa2V5LCBpbnB1dC5nZXRBdHRyaWJ1dGUoa2V5KSArIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlc1tcIitcIiArIGtleV0pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoa2V5LCBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXNba2V5XSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlucHV0LnZhbHVlID0gY2VsbFZhbHVlO1xuXG5cdFx0XHR2YXIgYmx1ckZ1bmMgPSBmdW5jdGlvbiBibHVyRnVuYyhlKSB7XG5cdFx0XHRcdG9uQ2hhbmdlKCk7XG5cdFx0XHR9O1xuXG5cdFx0XHRvblJlbmRlcmVkKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0Ly9zdWJtaXQgbmV3IHZhbHVlIG9uIGJsdXJcblx0XHRcdFx0aW5wdXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgYmx1ckZ1bmMpO1xuXG5cdFx0XHRcdGlucHV0LmZvY3VzKHsgcHJldmVudFNjcm9sbDogdHJ1ZSB9KTtcblx0XHRcdFx0aW5wdXQuc3R5bGUuaGVpZ2h0ID0gXCIxMDAlXCI7XG5cblx0XHRcdFx0Ly9zdWJtaXQgbmV3IHZhbHVlIG9uIGJsdXJcblx0XHRcdFx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgYmx1ckZ1bmMpO1xuXHRcdFx0fSk7XG5cblx0XHRcdGZ1bmN0aW9uIG9uQ2hhbmdlKCkge1xuXHRcdFx0XHR2YXIgdmFsdWUgPSBpbnB1dC52YWx1ZTtcblxuXHRcdFx0XHRpZiAoIWlzTmFOKHZhbHVlKSAmJiB2YWx1ZSAhPT0gXCJcIikge1xuXHRcdFx0XHRcdHZhbHVlID0gTnVtYmVyKHZhbHVlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh2YWx1ZSAhPT0gY2VsbFZhbHVlKSB7XG5cdFx0XHRcdFx0aWYgKHN1Y2Nlc3ModmFsdWUpKSB7XG5cdFx0XHRcdFx0XHRjZWxsVmFsdWUgPSB2YWx1ZTsgLy9wZXJzaXN0IHZhbHVlIGlmIHN1Y2Nlc3NmdWxseSB2YWxpZGF0ZWQgaW5jYXNlIGVkaXRvciBpcyB1c2VkIGFzIGhlYWRlciBmaWx0ZXJcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly9zdWJtaXQgbmV3IHZhbHVlIG9uIGVudGVyXG5cdFx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRzd2l0Y2ggKGUua2V5Q29kZSkge1xuXHRcdFx0XHRcdGNhc2UgMTM6XG5cdFx0XHRcdFx0XHQvLyBjYXNlIDk6XG5cdFx0XHRcdFx0XHRvbkNoYW5nZSgpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIDI3OlxuXHRcdFx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgMzg6IC8vdXAgYXJyb3dcblx0XHRcdFx0XHRjYXNlIDQwOlxuXHRcdFx0XHRcdFx0Ly9kb3duIGFycm93XG5cdFx0XHRcdFx0XHRpZiAodmVydE5hdiA9PSBcImVkaXRvclwiKSB7XG5cdFx0XHRcdFx0XHRcdGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChlZGl0b3JQYXJhbXMubWFzaykge1xuXHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5tYXNrSW5wdXQoaW5wdXQsIGVkaXRvclBhcmFtcyk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBpbnB1dDtcblx0XHR9LFxuXG5cdFx0Ly9pbnB1dCBlbGVtZW50IHdpdGggdHlwZSBvZiBudW1iZXJcblx0XHRyYW5nZTogZnVuY3Rpb24gcmFuZ2UoY2VsbCwgb25SZW5kZXJlZCwgc3VjY2VzcywgY2FuY2VsLCBlZGl0b3JQYXJhbXMpIHtcblxuXHRcdFx0dmFyIGNlbGxWYWx1ZSA9IGNlbGwuZ2V0VmFsdWUoKSxcblx0XHRcdCAgICBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcblxuXHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcInJhbmdlXCIpO1xuXG5cdFx0XHRpZiAodHlwZW9mIGVkaXRvclBhcmFtcy5tYXggIT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoXCJtYXhcIiwgZWRpdG9yUGFyYW1zLm1heCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YgZWRpdG9yUGFyYW1zLm1pbiAhPSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShcIm1pblwiLCBlZGl0b3JQYXJhbXMubWluKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZiBlZGl0b3JQYXJhbXMuc3RlcCAhPSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShcInN0ZXBcIiwgZWRpdG9yUGFyYW1zLnN0ZXApO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2NyZWF0ZSBhbmQgc3R5bGUgaW5wdXRcblx0XHRcdGlucHV0LnN0eWxlLnBhZGRpbmcgPSBcIjRweFwiO1xuXHRcdFx0aW5wdXQuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcblx0XHRcdGlucHV0LnN0eWxlLmJveFNpemluZyA9IFwiYm9yZGVyLWJveFwiO1xuXG5cdFx0XHRpZiAoZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzICYmIF90eXBlb2YoZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzKSA9PSBcIm9iamVjdFwiKSB7XG5cdFx0XHRcdGZvciAodmFyIGtleSBpbiBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMpIHtcblx0XHRcdFx0XHRpZiAoa2V5LmNoYXJBdCgwKSA9PSBcIitcIikge1xuXHRcdFx0XHRcdFx0a2V5ID0ga2V5LnNsaWNlKDEpO1xuXHRcdFx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgaW5wdXQuZ2V0QXR0cmlidXRlKGtleSkgKyBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXNbXCIrXCIgKyBrZXldKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzW2tleV0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpbnB1dC52YWx1ZSA9IGNlbGxWYWx1ZTtcblxuXHRcdFx0b25SZW5kZXJlZChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdGlucHV0LmZvY3VzKHsgcHJldmVudFNjcm9sbDogdHJ1ZSB9KTtcblx0XHRcdFx0aW5wdXQuc3R5bGUuaGVpZ2h0ID0gXCIxMDAlXCI7XG5cdFx0XHR9KTtcblxuXHRcdFx0ZnVuY3Rpb24gb25DaGFuZ2UoKSB7XG5cdFx0XHRcdHZhciB2YWx1ZSA9IGlucHV0LnZhbHVlO1xuXG5cdFx0XHRcdGlmICghaXNOYU4odmFsdWUpICYmIHZhbHVlICE9PSBcIlwiKSB7XG5cdFx0XHRcdFx0dmFsdWUgPSBOdW1iZXIodmFsdWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHZhbHVlICE9IGNlbGxWYWx1ZSkge1xuXHRcdFx0XHRcdGlmIChzdWNjZXNzKHZhbHVlKSkge1xuXHRcdFx0XHRcdFx0Y2VsbFZhbHVlID0gdmFsdWU7IC8vcGVyc2lzdCB2YWx1ZSBpZiBzdWNjZXNzZnVsbHkgdmFsaWRhdGVkIGluY2FzZSBlZGl0b3IgaXMgdXNlZCBhcyBoZWFkZXIgZmlsdGVyXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNhbmNlbCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vc3VibWl0IG5ldyB2YWx1ZSBvbiBibHVyXG5cdFx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRvbkNoYW5nZSgpO1xuXHRcdFx0fSk7XG5cblx0XHRcdC8vc3VibWl0IG5ldyB2YWx1ZSBvbiBlbnRlclxuXHRcdFx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0c3dpdGNoIChlLmtleUNvZGUpIHtcblx0XHRcdFx0XHRjYXNlIDEzOlxuXHRcdFx0XHRcdFx0Ly8gY2FzZSA5OlxuXHRcdFx0XHRcdFx0b25DaGFuZ2UoKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSAyNzpcblx0XHRcdFx0XHRcdGNhbmNlbCgpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gaW5wdXQ7XG5cdFx0fSxcblxuXHRcdC8vc2VsZWN0XG5cdFx0c2VsZWN0OiBmdW5jdGlvbiBzZWxlY3QoY2VsbCwgb25SZW5kZXJlZCwgc3VjY2VzcywgY2FuY2VsLCBlZGl0b3JQYXJhbXMpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdCAgICBjZWxsRWwgPSBjZWxsLmdldEVsZW1lbnQoKSxcblx0XHRcdCAgICBpbml0aWFsVmFsdWUgPSBjZWxsLmdldFZhbHVlKCksXG5cdFx0XHQgICAgdmVydE5hdiA9IGVkaXRvclBhcmFtcy52ZXJ0aWNhbE5hdmlnYXRpb24gfHwgXCJlZGl0b3JcIixcblx0XHRcdCAgICBpbml0aWFsRGlzcGxheVZhbHVlID0gdHlwZW9mIGluaXRpYWxWYWx1ZSAhPT0gXCJ1bmRlZmluZWRcIiB8fCBpbml0aWFsVmFsdWUgPT09IG51bGwgPyBpbml0aWFsVmFsdWUgOiB0eXBlb2YgZWRpdG9yUGFyYW1zLmRlZmF1bHRWYWx1ZSAhPT0gXCJ1bmRlZmluZWRcIiA/IGVkaXRvclBhcmFtcy5kZWZhdWx0VmFsdWUgOiBbXSxcblx0XHRcdCAgICBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKSxcblx0XHRcdCAgICBsaXN0RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLFxuXHRcdFx0ICAgIG11bHRpc2VsZWN0ID0gZWRpdG9yUGFyYW1zLm11bHRpc2VsZWN0LFxuXHRcdFx0ICAgIGRhdGFJdGVtcyA9IFtdLFxuXHRcdFx0ICAgIGN1cnJlbnRJdGVtID0ge30sXG5cdFx0XHQgICAgZGlzcGxheUl0ZW1zID0gW10sXG5cdFx0XHQgICAgY3VycmVudEl0ZW1zID0gW10sXG5cdFx0XHQgICAgYmx1cmFibGUgPSB0cnVlO1xuXG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIGNhbmNlbEl0ZW0pO1xuXG5cdFx0XHRpZiAoQXJyYXkuaXNBcnJheShlZGl0b3JQYXJhbXMpIHx8ICFBcnJheS5pc0FycmF5KGVkaXRvclBhcmFtcykgJiYgKHR5cGVvZiBlZGl0b3JQYXJhbXMgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGVkaXRvclBhcmFtcykpID09PSBcIm9iamVjdFwiICYmICFlZGl0b3JQYXJhbXMudmFsdWVzKSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkRFUFJFQ0FUSU9OIFdBUk5JTkcgLSB2YWx1ZXMgZm9yIHRoZSBzZWxlY3QgZWRpdG9yIG11c3Qgbm93IGJlIHBhc3NlZCBpbnRvIHRoZSB2YWx1ZXMgcHJvcGVydHkgb2YgdGhlIGVkaXRvclBhcmFtcyBvYmplY3QsIG5vdCBhcyB0aGUgZWRpdG9yUGFyYW1zIG9iamVjdFwiKTtcblx0XHRcdFx0ZWRpdG9yUGFyYW1zID0geyB2YWx1ZXM6IGVkaXRvclBhcmFtcyB9O1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBnZXRVbmlxdWVDb2x1bW5WYWx1ZXMoZmllbGQpIHtcblx0XHRcdFx0dmFyIG91dHB1dCA9IHt9LFxuXHRcdFx0XHQgICAgZGF0YSA9IHNlbGYudGFibGUuZ2V0RGF0YSgpLFxuXHRcdFx0XHQgICAgY29sdW1uO1xuXG5cdFx0XHRcdGlmIChmaWVsZCkge1xuXHRcdFx0XHRcdGNvbHVtbiA9IHNlbGYudGFibGUuY29sdW1uTWFuYWdlci5nZXRDb2x1bW5CeUZpZWxkKGZpZWxkKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb2x1bW4gPSBjZWxsLmdldENvbHVtbigpLl9nZXRTZWxmKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoY29sdW1uKSB7XG5cdFx0XHRcdFx0ZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0XHRcdHZhciB2YWwgPSBjb2x1bW4uZ2V0RmllbGRWYWx1ZShyb3cpO1xuXG5cdFx0XHRcdFx0XHRpZiAodmFsICE9PSBudWxsICYmIHR5cGVvZiB2YWwgIT09IFwidW5kZWZpbmVkXCIgJiYgdmFsICE9PSBcIlwiKSB7XG5cdFx0XHRcdFx0XHRcdG91dHB1dFt2YWxdID0gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdGlmIChlZGl0b3JQYXJhbXMuc29ydFZhbHVlc0xpc3QpIHtcblx0XHRcdFx0XHRcdGlmIChlZGl0b3JQYXJhbXMuc29ydFZhbHVlc0xpc3QgPT0gXCJhc2NcIikge1xuXHRcdFx0XHRcdFx0XHRvdXRwdXQgPSBPYmplY3Qua2V5cyhvdXRwdXQpLnNvcnQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdG91dHB1dCA9IE9iamVjdC5rZXlzKG91dHB1dCkuc29ydCgpLnJldmVyc2UoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0b3V0cHV0ID0gT2JqZWN0LmtleXMob3V0cHV0KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwidW5hYmxlIHRvIGZpbmQgbWF0Y2hpbmcgY29sdW1uIHRvIGNyZWF0ZSBzZWxlY3QgbG9va3VwIGxpc3Q6XCIsIGZpZWxkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBvdXRwdXQ7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHBhcnNlSXRlbXMoaW5wdXRWYWx1ZXMsIGN1cmVudFZhbHVlcykge1xuXHRcdFx0XHR2YXIgZGF0YUxpc3QgPSBbXTtcblx0XHRcdFx0dmFyIGRpc3BsYXlMaXN0ID0gW107XG5cblx0XHRcdFx0ZnVuY3Rpb24gcHJvY2Vzc0NvbXBsZXhMaXN0SXRlbShpdGVtKSB7XG5cdFx0XHRcdFx0dmFyIGl0ZW0gPSB7XG5cdFx0XHRcdFx0XHRsYWJlbDogaXRlbS5sYWJlbCxcblx0XHRcdFx0XHRcdHZhbHVlOiBpdGVtLnZhbHVlLFxuXHRcdFx0XHRcdFx0aXRlbVBhcmFtczogaXRlbS5pdGVtUGFyYW1zLFxuXHRcdFx0XHRcdFx0ZWxlbWVudEF0dHJpYnV0ZXM6IGl0ZW0uZWxlbWVudEF0dHJpYnV0ZXMsXG5cdFx0XHRcdFx0XHRlbGVtZW50OiBmYWxzZVxuXHRcdFx0XHRcdH07XG5cblx0XHRcdFx0XHQvLyBpZihpdGVtLnZhbHVlID09PSBjdXJlbnRWYWx1ZSB8fCAoIWlzTmFOKHBhcnNlRmxvYXQoaXRlbS52YWx1ZSkpICYmICFpc05hTihwYXJzZUZsb2F0KGl0ZW0udmFsdWUpKSAmJiBwYXJzZUZsb2F0KGl0ZW0udmFsdWUpID09PSBwYXJzZUZsb2F0KGN1cmVudFZhbHVlKSkpe1xuXHRcdFx0XHRcdC8vIFx0c2V0Q3VycmVudEl0ZW0oaXRlbSk7XG5cdFx0XHRcdFx0Ly8gfVxuXG5cdFx0XHRcdFx0aWYgKGN1cmVudFZhbHVlcy5pbmRleE9mKGl0ZW0udmFsdWUpID4gLTEpIHtcblx0XHRcdFx0XHRcdHNldEl0ZW0oaXRlbSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0ZGF0YUxpc3QucHVzaChpdGVtKTtcblx0XHRcdFx0XHRkaXNwbGF5TGlzdC5wdXNoKGl0ZW0pO1xuXG5cdFx0XHRcdFx0cmV0dXJuIGl0ZW07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mIGlucHV0VmFsdWVzID09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdGlucHV0VmFsdWVzID0gaW5wdXRWYWx1ZXMoY2VsbCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShpbnB1dFZhbHVlcykpIHtcblx0XHRcdFx0XHRpbnB1dFZhbHVlcy5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdFx0XHRcdFx0dmFyIGl0ZW07XG5cblx0XHRcdFx0XHRcdGlmICgodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZih2YWx1ZSkpID09PSBcIm9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHRcdFx0aWYgKHZhbHVlLm9wdGlvbnMpIHtcblx0XHRcdFx0XHRcdFx0XHRpdGVtID0ge1xuXHRcdFx0XHRcdFx0XHRcdFx0bGFiZWw6IHZhbHVlLmxhYmVsLFxuXHRcdFx0XHRcdFx0XHRcdFx0Z3JvdXA6IHRydWUsXG5cdFx0XHRcdFx0XHRcdFx0XHRpdGVtUGFyYW1zOiB2YWx1ZS5pdGVtUGFyYW1zLFxuXHRcdFx0XHRcdFx0XHRcdFx0ZWxlbWVudEF0dHJpYnV0ZXM6IHZhbHVlLmVsZW1lbnRBdHRyaWJ1dGVzLFxuXHRcdFx0XHRcdFx0XHRcdFx0ZWxlbWVudDogZmFsc2Vcblx0XHRcdFx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0XHRcdFx0ZGlzcGxheUxpc3QucHVzaChpdGVtKTtcblxuXHRcdFx0XHRcdFx0XHRcdHZhbHVlLm9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0cHJvY2Vzc0NvbXBsZXhMaXN0SXRlbShpdGVtKTtcblx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRwcm9jZXNzQ29tcGxleExpc3RJdGVtKHZhbHVlKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0XHRpdGVtID0ge1xuXHRcdFx0XHRcdFx0XHRcdGxhYmVsOiB2YWx1ZSxcblx0XHRcdFx0XHRcdFx0XHR2YWx1ZTogdmFsdWUsXG5cdFx0XHRcdFx0XHRcdFx0ZWxlbWVudDogZmFsc2Vcblx0XHRcdFx0XHRcdFx0fTtcblxuXHRcdFx0XHRcdFx0XHQvLyBpZihpdGVtLnZhbHVlID09PSBjdXJlbnRWYWx1ZSB8fCAoIWlzTmFOKHBhcnNlRmxvYXQoaXRlbS52YWx1ZSkpICYmICFpc05hTihwYXJzZUZsb2F0KGl0ZW0udmFsdWUpKSAmJiBwYXJzZUZsb2F0KGl0ZW0udmFsdWUpID09PSBwYXJzZUZsb2F0KGN1cmVudFZhbHVlKSkpe1xuXHRcdFx0XHRcdFx0XHQvLyBcdHNldEN1cnJlbnRJdGVtKGl0ZW0pO1xuXHRcdFx0XHRcdFx0XHQvLyB9XG5cblx0XHRcdFx0XHRcdFx0aWYgKGN1cmVudFZhbHVlcy5pbmRleE9mKGl0ZW0udmFsdWUpID4gLTEpIHtcblx0XHRcdFx0XHRcdFx0XHRzZXRJdGVtKGl0ZW0pO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0ZGF0YUxpc3QucHVzaChpdGVtKTtcblx0XHRcdFx0XHRcdFx0ZGlzcGxheUxpc3QucHVzaChpdGVtKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRmb3IgKHZhciBrZXkgaW4gaW5wdXRWYWx1ZXMpIHtcblx0XHRcdFx0XHRcdHZhciBpdGVtID0ge1xuXHRcdFx0XHRcdFx0XHRsYWJlbDogaW5wdXRWYWx1ZXNba2V5XSxcblx0XHRcdFx0XHRcdFx0dmFsdWU6IGtleSxcblx0XHRcdFx0XHRcdFx0ZWxlbWVudDogZmFsc2Vcblx0XHRcdFx0XHRcdH07XG5cblx0XHRcdFx0XHRcdC8vIGlmKGl0ZW0udmFsdWUgPT09IGN1cmVudFZhbHVlIHx8ICghaXNOYU4ocGFyc2VGbG9hdChpdGVtLnZhbHVlKSkgJiYgIWlzTmFOKHBhcnNlRmxvYXQoaXRlbS52YWx1ZSkpICYmIHBhcnNlRmxvYXQoaXRlbS52YWx1ZSkgPT09IHBhcnNlRmxvYXQoY3VyZW50VmFsdWUpKSl7XG5cdFx0XHRcdFx0XHQvLyBcdHNldEN1cnJlbnRJdGVtKGl0ZW0pO1xuXHRcdFx0XHRcdFx0Ly8gfVxuXG5cdFx0XHRcdFx0XHRpZiAoY3VyZW50VmFsdWVzLmluZGV4T2YoaXRlbS52YWx1ZSkgPiAtMSkge1xuXHRcdFx0XHRcdFx0XHRzZXRJdGVtKGl0ZW0pO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRkYXRhTGlzdC5wdXNoKGl0ZW0pO1xuXHRcdFx0XHRcdFx0ZGlzcGxheUxpc3QucHVzaChpdGVtKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRkYXRhSXRlbXMgPSBkYXRhTGlzdDtcblx0XHRcdFx0ZGlzcGxheUl0ZW1zID0gZGlzcGxheUxpc3Q7XG5cblx0XHRcdFx0ZmlsbExpc3QoKTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gZmlsbExpc3QoKSB7XG5cdFx0XHRcdHdoaWxlIChsaXN0RWwuZmlyc3RDaGlsZCkge1xuXHRcdFx0XHRcdGxpc3RFbC5yZW1vdmVDaGlsZChsaXN0RWwuZmlyc3RDaGlsZCk7XG5cdFx0XHRcdH1kaXNwbGF5SXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXG5cdFx0XHRcdFx0dmFyIGVsID0gaXRlbS5lbGVtZW50O1xuXG5cdFx0XHRcdFx0aWYgKCFlbCkge1xuXHRcdFx0XHRcdFx0ZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0XHRcdFx0aXRlbS5sYWJlbCA9IGVkaXRvclBhcmFtcy5saXN0SXRlbUZvcm1hdHRlciA/IGVkaXRvclBhcmFtcy5saXN0SXRlbUZvcm1hdHRlcihpdGVtLnZhbHVlLCBpdGVtLmxhYmVsLCBjZWxsLCBlbCwgaXRlbS5pdGVtUGFyYW1zKSA6IGl0ZW0ubGFiZWw7XG5cdFx0XHRcdFx0XHRpZiAoaXRlbS5ncm91cCkge1xuXHRcdFx0XHRcdFx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWVkaXQtc2VsZWN0LWxpc3QtZ3JvdXBcIik7XG5cdFx0XHRcdFx0XHRcdGVsLnRhYkluZGV4ID0gMDtcblx0XHRcdFx0XHRcdFx0ZWwuaW5uZXJIVE1MID0gaXRlbS5sYWJlbCA9PT0gXCJcIiA/IFwiJm5ic3A7XCIgOiBpdGVtLmxhYmVsO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1lZGl0LXNlbGVjdC1saXN0LWl0ZW1cIik7XG5cdFx0XHRcdFx0XHRcdGVsLnRhYkluZGV4ID0gMDtcblx0XHRcdFx0XHRcdFx0ZWwuaW5uZXJIVE1MID0gaXRlbS5sYWJlbCA9PT0gXCJcIiA/IFwiJm5ic3A7XCIgOiBpdGVtLmxhYmVsO1xuXG5cdFx0XHRcdFx0XHRcdGVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0Ly8gc2V0Q3VycmVudEl0ZW0oaXRlbSk7XG5cdFx0XHRcdFx0XHRcdFx0Ly8gY2hvb3NlSXRlbSgpO1xuXHRcdFx0XHRcdFx0XHRcdGlmIChtdWx0aXNlbGVjdCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0dG9nZ2xlSXRlbShpdGVtKTtcblx0XHRcdFx0XHRcdFx0XHRcdGlucHV0LmZvY3VzKCk7XG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdGNob29zZUl0ZW0oaXRlbSk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0XHQvLyBpZihpdGVtID09PSBjdXJyZW50SXRlbSl7XG5cdFx0XHRcdFx0XHRcdC8vIFx0ZWwuY2xhc3NMaXN0LmFkZChcImFjdGl2ZVwiKTtcblx0XHRcdFx0XHRcdFx0Ly8gfVxuXG5cdFx0XHRcdFx0XHRcdGlmIChjdXJyZW50SXRlbXMuaW5kZXhPZihpdGVtKSA+IC0xKSB7XG5cdFx0XHRcdFx0XHRcdFx0ZWwuY2xhc3NMaXN0LmFkZChcImFjdGl2ZVwiKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAoaXRlbS5lbGVtZW50QXR0cmlidXRlcyAmJiBfdHlwZW9mKGl0ZW0uZWxlbWVudEF0dHJpYnV0ZXMpID09IFwib2JqZWN0XCIpIHtcblx0XHRcdFx0XHRcdFx0Zm9yICh2YXIga2V5IGluIGl0ZW0uZWxlbWVudEF0dHJpYnV0ZXMpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAoa2V5LmNoYXJBdCgwKSA9PSBcIitcIikge1xuXHRcdFx0XHRcdFx0XHRcdFx0a2V5ID0ga2V5LnNsaWNlKDEpO1xuXHRcdFx0XHRcdFx0XHRcdFx0ZWwuc2V0QXR0cmlidXRlKGtleSwgaW5wdXQuZ2V0QXR0cmlidXRlKGtleSkgKyBpdGVtLmVsZW1lbnRBdHRyaWJ1dGVzW1wiK1wiICsga2V5XSk7XG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdGVsLnNldEF0dHJpYnV0ZShrZXksIGl0ZW0uZWxlbWVudEF0dHJpYnV0ZXNba2V5XSk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRlbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0Ymx1cmFibGUgPSBmYWxzZTtcblxuXHRcdFx0XHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRibHVyYWJsZSA9IHRydWU7XG5cdFx0XHRcdFx0XHRcdH0sIDEwKTtcblx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRpdGVtLmVsZW1lbnQgPSBlbDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRsaXN0RWwuYXBwZW5kQ2hpbGQoZWwpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gc2V0Q3VycmVudEl0ZW0oaXRlbSwgYWN0aXZlKSB7XG5cblx0XHRcdFx0aWYgKCFtdWx0aXNlbGVjdCAmJiBjdXJyZW50SXRlbSAmJiBjdXJyZW50SXRlbS5lbGVtZW50KSB7XG5cdFx0XHRcdFx0Y3VycmVudEl0ZW0uZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiYWN0aXZlXCIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGN1cnJlbnRJdGVtICYmIGN1cnJlbnRJdGVtLmVsZW1lbnQpIHtcblx0XHRcdFx0XHRjdXJyZW50SXRlbS5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJmb2N1c2VkXCIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y3VycmVudEl0ZW0gPSBpdGVtO1xuXG5cdFx0XHRcdGlmIChpdGVtLmVsZW1lbnQpIHtcblx0XHRcdFx0XHRpdGVtLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImZvY3VzZWRcIik7XG5cdFx0XHRcdFx0aWYgKGFjdGl2ZSkge1xuXHRcdFx0XHRcdFx0aXRlbS5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIGZ1bmN0aW9uIGNob29zZUl0ZW0oKXtcblx0XHRcdC8vIFx0aGlkZUxpc3QoKTtcblxuXHRcdFx0Ly8gXHRpZihpbml0aWFsVmFsdWUgIT09IGN1cnJlbnRJdGVtLnZhbHVlKXtcblx0XHRcdC8vIFx0XHRpbml0aWFsVmFsdWUgPSBjdXJyZW50SXRlbS52YWx1ZTtcblx0XHRcdC8vIFx0XHRzdWNjZXNzKGN1cnJlbnRJdGVtLnZhbHVlKTtcblx0XHRcdC8vIFx0fWVsc2V7XG5cdFx0XHQvLyBcdFx0Y2FuY2VsKCk7XG5cdFx0XHQvLyBcdH1cblx0XHRcdC8vIH1cblxuXHRcdFx0ZnVuY3Rpb24gc2V0SXRlbShpdGVtKSB7XG5cdFx0XHRcdHZhciBpbmRleCA9IGN1cnJlbnRJdGVtcy5pbmRleE9mKGl0ZW0pO1xuXG5cdFx0XHRcdGlmIChpbmRleCA9PSAtMSkge1xuXHRcdFx0XHRcdGN1cnJlbnRJdGVtcy5wdXNoKGl0ZW0pO1xuXHRcdFx0XHRcdHNldEN1cnJlbnRJdGVtKGl0ZW0sIHRydWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZmlsbElucHV0KCk7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHVuc2V0SXRlbShpbmRleCkge1xuXHRcdFx0XHR2YXIgaXRlbSA9IGN1cnJlbnRJdGVtc1tpbmRleF07XG5cblx0XHRcdFx0aWYgKGluZGV4ID4gLTEpIHtcblx0XHRcdFx0XHRjdXJyZW50SXRlbXMuc3BsaWNlKGluZGV4LCAxKTtcblx0XHRcdFx0XHRpZiAoaXRlbS5lbGVtZW50KSB7XG5cdFx0XHRcdFx0XHRpdGVtLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImFjdGl2ZVwiKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gdG9nZ2xlSXRlbShpdGVtKSB7XG5cdFx0XHRcdGlmICghaXRlbSkge1xuXHRcdFx0XHRcdGl0ZW0gPSBjdXJyZW50SXRlbTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHZhciBpbmRleCA9IGN1cnJlbnRJdGVtcy5pbmRleE9mKGl0ZW0pO1xuXG5cdFx0XHRcdGlmIChpbmRleCA+IC0xKSB7XG5cdFx0XHRcdFx0dW5zZXRJdGVtKGluZGV4KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRpZiAobXVsdGlzZWxlY3QgIT09IHRydWUgJiYgY3VycmVudEl0ZW1zLmxlbmd0aCA+PSBtdWx0aXNlbGVjdCkge1xuXHRcdFx0XHRcdFx0dW5zZXRJdGVtKDApO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHNldEl0ZW0oaXRlbSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmaWxsSW5wdXQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gY2hvb3NlSXRlbShpdGVtKSB7XG5cdFx0XHRcdGhpZGVMaXN0KCk7XG5cblx0XHRcdFx0aWYgKCFpdGVtKSB7XG5cdFx0XHRcdFx0aXRlbSA9IGN1cnJlbnRJdGVtO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGl0ZW0pIHtcblx0XHRcdFx0XHRzdWNjZXNzKGl0ZW0udmFsdWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGNob29zZUl0ZW1zKCkge1xuXHRcdFx0XHRoaWRlTGlzdCgpO1xuXG5cdFx0XHRcdHZhciBvdXRwdXQgPSBbXTtcblxuXHRcdFx0XHRjdXJyZW50SXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0XHRcdG91dHB1dC5wdXNoKGl0ZW0udmFsdWUpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRzdWNjZXNzKG91dHB1dCk7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGZpbGxJbnB1dCgpIHtcblx0XHRcdFx0dmFyIG91dHB1dCA9IFtdO1xuXG5cdFx0XHRcdGN1cnJlbnRJdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRcdFx0b3V0cHV0LnB1c2goaXRlbS5sYWJlbCk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGlucHV0LnZhbHVlID0gb3V0cHV0LmpvaW4oXCIsIFwiKTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gY2FuY2VsSXRlbSgpIHtcblx0XHRcdFx0aGlkZUxpc3QoKTtcblx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHNob3dMaXN0KCkge1xuXHRcdFx0XHRpZiAoIWxpc3RFbC5wYXJlbnROb2RlKSB7XG5cblx0XHRcdFx0XHRpZiAoZWRpdG9yUGFyYW1zLnZhbHVlcyA9PT0gdHJ1ZSkge1xuXHRcdFx0XHRcdFx0cGFyc2VJdGVtcyhnZXRVbmlxdWVDb2x1bW5WYWx1ZXMoKSwgaW5pdGlhbERpc3BsYXlWYWx1ZSk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YgZWRpdG9yUGFyYW1zLnZhbHVlcyA9PT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHRcdFx0cGFyc2VJdGVtcyhnZXRVbmlxdWVDb2x1bW5WYWx1ZXMoZWRpdG9yUGFyYW1zLnZhbHVlcyksIGluaXRpYWxEaXNwbGF5VmFsdWUpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRwYXJzZUl0ZW1zKGVkaXRvclBhcmFtcy52YWx1ZXMgfHwgW10sIGluaXRpYWxEaXNwbGF5VmFsdWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHZhciBvZmZzZXQgPSBUYWJ1bGF0b3IucHJvdG90eXBlLmhlbHBlcnMuZWxPZmZzZXQoY2VsbEVsKTtcblxuXHRcdFx0XHRcdGxpc3RFbC5zdHlsZS5taW5XaWR0aCA9IGNlbGxFbC5vZmZzZXRXaWR0aCArIFwicHhcIjtcblxuXHRcdFx0XHRcdGxpc3RFbC5zdHlsZS50b3AgPSBvZmZzZXQudG9wICsgY2VsbEVsLm9mZnNldEhlaWdodCArIFwicHhcIjtcblx0XHRcdFx0XHRsaXN0RWwuc3R5bGUubGVmdCA9IG9mZnNldC5sZWZ0ICsgXCJweFwiO1xuXG5cdFx0XHRcdFx0bGlzdEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0XHRcdGJsdXJhYmxlID0gZmFsc2U7XG5cblx0XHRcdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRibHVyYWJsZSA9IHRydWU7XG5cdFx0XHRcdFx0XHR9LCAxMCk7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpc3RFbCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gaGlkZUxpc3QoKSB7XG5cdFx0XHRcdGlmIChsaXN0RWwucGFyZW50Tm9kZSkge1xuXHRcdFx0XHRcdGxpc3RFbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGxpc3RFbCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZW1vdmVTY3JvbGxMaXN0ZW5lcigpO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiByZW1vdmVTY3JvbGxMaXN0ZW5lcigpIHtcblx0XHRcdFx0c2VsZi50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInNjcm9sbFwiLCBjYW5jZWxJdGVtKTtcblx0XHRcdH1cblxuXHRcdFx0Ly9zdHlsZSBpbnB1dFxuXHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcInRleHRcIik7XG5cblx0XHRcdGlucHV0LnN0eWxlLnBhZGRpbmcgPSBcIjRweFwiO1xuXHRcdFx0aW5wdXQuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcblx0XHRcdGlucHV0LnN0eWxlLmJveFNpemluZyA9IFwiYm9yZGVyLWJveFwiO1xuXHRcdFx0aW5wdXQuc3R5bGUuY3Vyc29yID0gXCJkZWZhdWx0XCI7XG5cdFx0XHRpbnB1dC5yZWFkT25seSA9IHRoaXMuY3VycmVudENlbGwgIT0gZmFsc2U7XG5cblx0XHRcdGlmIChlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMgJiYgX3R5cGVvZihlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMpID09IFwib2JqZWN0XCIpIHtcblx0XHRcdFx0Zm9yICh2YXIga2V5IGluIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcykge1xuXHRcdFx0XHRcdGlmIChrZXkuY2hhckF0KDApID09IFwiK1wiKSB7XG5cdFx0XHRcdFx0XHRrZXkgPSBrZXkuc2xpY2UoMSk7XG5cdFx0XHRcdFx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoa2V5LCBpbnB1dC5nZXRBdHRyaWJ1dGUoa2V5KSArIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlc1tcIitcIiArIGtleV0pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoa2V5LCBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXNba2V5XSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlucHV0LnZhbHVlID0gdHlwZW9mIGluaXRpYWxWYWx1ZSAhPT0gXCJ1bmRlZmluZWRcIiB8fCBpbml0aWFsVmFsdWUgPT09IG51bGwgPyBpbml0aWFsVmFsdWUgOiBcIlwiO1xuXG5cdFx0XHQvLyBpZihlZGl0b3JQYXJhbXMudmFsdWVzID09PSB0cnVlKXtcblx0XHRcdC8vIFx0cGFyc2VJdGVtcyhnZXRVbmlxdWVDb2x1bW5WYWx1ZXMoKSwgaW5pdGlhbFZhbHVlKTtcblx0XHRcdC8vIH1lbHNlIGlmKHR5cGVvZiBlZGl0b3JQYXJhbXMudmFsdWVzID09PSBcInN0cmluZ1wiKXtcblx0XHRcdC8vIFx0cGFyc2VJdGVtcyhnZXRVbmlxdWVDb2x1bW5WYWx1ZXMoZWRpdG9yUGFyYW1zLnZhbHVlcyksIGluaXRpYWxWYWx1ZSk7XG5cdFx0XHQvLyB9ZWxzZXtcblx0XHRcdC8vIFx0cGFyc2VJdGVtcyhlZGl0b3JQYXJhbXMudmFsdWVzIHx8IFtdLCBpbml0aWFsVmFsdWUpO1xuXHRcdFx0Ly8gfVxuXG5cdFx0XHQvL2FsbG93IGtleSBiYXNlZCBuYXZpZ2F0aW9uXG5cdFx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHR2YXIgaW5kZXg7XG5cblx0XHRcdFx0c3dpdGNoIChlLmtleUNvZGUpIHtcblx0XHRcdFx0XHRjYXNlIDM4OlxuXHRcdFx0XHRcdFx0Ly91cCBhcnJvd1xuXHRcdFx0XHRcdFx0aW5kZXggPSBkYXRhSXRlbXMuaW5kZXhPZihjdXJyZW50SXRlbSk7XG5cblx0XHRcdFx0XHRcdGlmICh2ZXJ0TmF2ID09IFwiZWRpdG9yXCIgfHwgdmVydE5hdiA9PSBcImh5YnJpZFwiICYmIGluZGV4KSB7XG5cdFx0XHRcdFx0XHRcdGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoaW5kZXggPiAwKSB7XG5cdFx0XHRcdFx0XHRcdFx0c2V0Q3VycmVudEl0ZW0oZGF0YUl0ZW1zW2luZGV4IC0gMV0sICFtdWx0aXNlbGVjdCk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSA0MDpcblx0XHRcdFx0XHRcdC8vZG93biBhcnJvd1xuXHRcdFx0XHRcdFx0aW5kZXggPSBkYXRhSXRlbXMuaW5kZXhPZihjdXJyZW50SXRlbSk7XG5cblx0XHRcdFx0XHRcdGlmICh2ZXJ0TmF2ID09IFwiZWRpdG9yXCIgfHwgdmVydE5hdiA9PSBcImh5YnJpZFwiICYmIGluZGV4IDwgZGF0YUl0ZW1zLmxlbmd0aCAtIDEpIHtcblx0XHRcdFx0XHRcdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdFx0XHRcdGlmIChpbmRleCA8IGRhdGFJdGVtcy5sZW5ndGggLSAxKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKGluZGV4ID09IC0xKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRzZXRDdXJyZW50SXRlbShkYXRhSXRlbXNbMF0sICFtdWx0aXNlbGVjdCk7XG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdHNldEN1cnJlbnRJdGVtKGRhdGFJdGVtc1tpbmRleCArIDFdLCAhbXVsdGlzZWxlY3QpO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIDM3OiAvL2xlZnQgYXJyb3dcblx0XHRcdFx0XHRjYXNlIDM5OlxuXHRcdFx0XHRcdFx0Ly9yaWdodCBhcnJvd1xuXHRcdFx0XHRcdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgMTM6XG5cdFx0XHRcdFx0XHQvL2VudGVyXG5cdFx0XHRcdFx0XHQvLyBjaG9vc2VJdGVtKCk7XG5cblx0XHRcdFx0XHRcdGlmIChtdWx0aXNlbGVjdCkge1xuXHRcdFx0XHRcdFx0XHR0b2dnbGVJdGVtKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRjaG9vc2VJdGVtKCk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSAyNzpcblx0XHRcdFx0XHRcdC8vZXNjYXBlXG5cdFx0XHRcdFx0XHRjYW5jZWxJdGVtKCk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJibHVyXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGlmIChibHVyYWJsZSkge1xuXHRcdFx0XHRcdGlmIChtdWx0aXNlbGVjdCkge1xuXHRcdFx0XHRcdFx0Y2hvb3NlSXRlbXMoKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Y2FuY2VsSXRlbSgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJmb2N1c1wiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRzaG93TGlzdCgpO1xuXHRcdFx0fSk7XG5cblx0XHRcdC8vc3R5bGUgbGlzdCBlbGVtZW50XG5cdFx0XHRsaXN0RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0bGlzdEVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZWRpdC1zZWxlY3QtbGlzdFwiKTtcblxuXHRcdFx0b25SZW5kZXJlZChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdGlucHV0LnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xuXHRcdFx0XHRpbnB1dC5mb2N1cyh7IHByZXZlbnRTY3JvbGw6IHRydWUgfSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIGlucHV0O1xuXHRcdH0sXG5cblx0XHQvL2F1dG9jb21wbGV0ZVxuXHRcdGF1dG9jb21wbGV0ZTogZnVuY3Rpb24gYXV0b2NvbXBsZXRlKGNlbGwsIG9uUmVuZGVyZWQsIHN1Y2Nlc3MsIGNhbmNlbCwgZWRpdG9yUGFyYW1zKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHQgICAgY2VsbEVsID0gY2VsbC5nZXRFbGVtZW50KCksXG5cdFx0XHQgICAgaW5pdGlhbFZhbHVlID0gY2VsbC5nZXRWYWx1ZSgpLFxuXHRcdFx0ICAgIHZlcnROYXYgPSBlZGl0b3JQYXJhbXMudmVydGljYWxOYXZpZ2F0aW9uIHx8IFwiZWRpdG9yXCIsXG5cdFx0XHQgICAgaW5pdGlhbERpc3BsYXlWYWx1ZSA9IHR5cGVvZiBpbml0aWFsVmFsdWUgIT09IFwidW5kZWZpbmVkXCIgfHwgaW5pdGlhbFZhbHVlID09PSBudWxsID8gaW5pdGlhbFZhbHVlIDogdHlwZW9mIGVkaXRvclBhcmFtcy5kZWZhdWx0VmFsdWUgIT09IFwidW5kZWZpbmVkXCIgPyBlZGl0b3JQYXJhbXMuZGVmYXVsdFZhbHVlIDogXCJcIixcblx0XHRcdCAgICBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKSxcblx0XHRcdCAgICBsaXN0RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLFxuXHRcdFx0ICAgIGFsbEl0ZW1zID0gW10sXG5cdFx0XHQgICAgZGlzcGxheUl0ZW1zID0gW10sXG5cdFx0XHQgICAgdmFsdWVzID0gW10sXG5cdFx0XHQgICAgY3VycmVudEl0ZW0gPSBmYWxzZSxcblx0XHRcdCAgICBibHVyYWJsZSA9IHRydWUsXG5cdFx0XHQgICAgdW5pcXVlQ29sdW1uVmFsdWVzID0gZmFsc2U7XG5cblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzY3JvbGxcIiwgY2FuY2VsSXRlbSk7XG5cblx0XHRcdC8vc3R5bGUgaW5wdXRcblx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJzZWFyY2hcIik7XG5cblx0XHRcdGlucHV0LnN0eWxlLnBhZGRpbmcgPSBcIjRweFwiO1xuXHRcdFx0aW5wdXQuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcblx0XHRcdGlucHV0LnN0eWxlLmJveFNpemluZyA9IFwiYm9yZGVyLWJveFwiO1xuXG5cdFx0XHRpZiAoZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzICYmIF90eXBlb2YoZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzKSA9PSBcIm9iamVjdFwiKSB7XG5cdFx0XHRcdGZvciAodmFyIGtleSBpbiBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMpIHtcblx0XHRcdFx0XHRpZiAoa2V5LmNoYXJBdCgwKSA9PSBcIitcIikge1xuXHRcdFx0XHRcdFx0a2V5ID0ga2V5LnNsaWNlKDEpO1xuXHRcdFx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgaW5wdXQuZ2V0QXR0cmlidXRlKGtleSkgKyBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXNbXCIrXCIgKyBrZXldKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzW2tleV0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvL3N0eWxlIGxpc3QgZWxlbWVudFxuXHRcdFx0bGlzdEVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZWRpdC1zZWxlY3QtbGlzdFwiKTtcblxuXHRcdFx0bGlzdEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0Ymx1cmFibGUgPSBmYWxzZTtcblxuXHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRibHVyYWJsZSA9IHRydWU7XG5cdFx0XHRcdH0sIDEwKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRmdW5jdGlvbiBnZW5VbmlxdWVDb2x1bW5WYWx1ZXMoKSB7XG5cdFx0XHRcdGlmIChlZGl0b3JQYXJhbXMudmFsdWVzID09PSB0cnVlKSB7XG5cdFx0XHRcdFx0dW5pcXVlQ29sdW1uVmFsdWVzID0gZ2V0VW5pcXVlQ29sdW1uVmFsdWVzKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mIGVkaXRvclBhcmFtcy52YWx1ZXMgPT09IFwic3RyaW5nXCIpIHtcblx0XHRcdFx0XHR1bmlxdWVDb2x1bW5WYWx1ZXMgPSBnZXRVbmlxdWVDb2x1bW5WYWx1ZXMoZWRpdG9yUGFyYW1zLnZhbHVlcyk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gZ2V0VW5pcXVlQ29sdW1uVmFsdWVzKGZpZWxkKSB7XG5cdFx0XHRcdHZhciBvdXRwdXQgPSB7fSxcblx0XHRcdFx0ICAgIGRhdGEgPSBzZWxmLnRhYmxlLmdldERhdGEoKSxcblx0XHRcdFx0ICAgIGNvbHVtbjtcblxuXHRcdFx0XHRpZiAoZmllbGQpIHtcblx0XHRcdFx0XHRjb2x1bW4gPSBzZWxmLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0Q29sdW1uQnlGaWVsZChmaWVsZCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29sdW1uID0gY2VsbC5nZXRDb2x1bW4oKS5fZ2V0U2VsZigpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGNvbHVtbikge1xuXHRcdFx0XHRcdGRhdGEuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRcdFx0XHR2YXIgdmFsID0gY29sdW1uLmdldEZpZWxkVmFsdWUocm93KTtcblxuXHRcdFx0XHRcdFx0aWYgKHZhbCAhPT0gbnVsbCAmJiB0eXBlb2YgdmFsICE9PSBcInVuZGVmaW5lZFwiICYmIHZhbCAhPT0gXCJcIikge1xuXHRcdFx0XHRcdFx0XHRvdXRwdXRbdmFsXSA9IHRydWU7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRpZiAoZWRpdG9yUGFyYW1zLnNvcnRWYWx1ZXNMaXN0KSB7XG5cdFx0XHRcdFx0XHRpZiAoZWRpdG9yUGFyYW1zLnNvcnRWYWx1ZXNMaXN0ID09IFwiYXNjXCIpIHtcblx0XHRcdFx0XHRcdFx0b3V0cHV0ID0gT2JqZWN0LmtleXMob3V0cHV0KS5zb3J0KCk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRvdXRwdXQgPSBPYmplY3Qua2V5cyhvdXRwdXQpLnNvcnQoKS5yZXZlcnNlKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdG91dHB1dCA9IE9iamVjdC5rZXlzKG91dHB1dCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcInVuYWJsZSB0byBmaW5kIG1hdGNoaW5nIGNvbHVtbiB0byBjcmVhdGUgYXV0b2NvbXBsZXRlIGxvb2t1cCBsaXN0OlwiLCBmaWVsZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gb3V0cHV0O1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBmaWx0ZXJMaXN0KHRlcm0sIGludGlhbExvYWQpIHtcblx0XHRcdFx0dmFyIG1hdGNoZXMgPSBbXSxcblx0XHRcdFx0ICAgIHZhbHVlcyxcblx0XHRcdFx0ICAgIGl0ZW1zLFxuXHRcdFx0XHQgICAgc2VhcmNoRWw7XG5cblx0XHRcdFx0Ly9sb29rdXAgYmFzZSB2YWx1ZXMgbGlzdFxuXHRcdFx0XHRpZiAodW5pcXVlQ29sdW1uVmFsdWVzKSB7XG5cdFx0XHRcdFx0dmFsdWVzID0gdW5pcXVlQ29sdW1uVmFsdWVzO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHZhbHVlcyA9IGVkaXRvclBhcmFtcy52YWx1ZXMgfHwgW107XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoZWRpdG9yUGFyYW1zLnNlYXJjaEZ1bmMpIHtcblx0XHRcdFx0XHRtYXRjaGVzID0gZWRpdG9yUGFyYW1zLnNlYXJjaEZ1bmModGVybSwgdmFsdWVzKTtcblxuXHRcdFx0XHRcdGlmIChtYXRjaGVzIGluc3RhbmNlb2YgUHJvbWlzZSkge1xuXG5cdFx0XHRcdFx0XHRhZGROb3RpY2UodHlwZW9mIGVkaXRvclBhcmFtcy5zZWFyY2hpbmdQbGFjZWhvbGRlciAhPT0gXCJ1bmRlZmluZWRcIiA/IGVkaXRvclBhcmFtcy5zZWFyY2hpbmdQbGFjZWhvbGRlciA6IFwiU2VhcmNoaW5nLi4uXCIpO1xuXG5cdFx0XHRcdFx0XHRtYXRjaGVzLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuXHRcdFx0XHRcdFx0XHRmaWxsTGlzdElmTm90RW1wdHkocGFyc2VJdGVtcyhyZXN1bHQpLCBpbnRpYWxMb2FkKTtcblx0XHRcdFx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0XHRcdFx0Y29uc29sZS5lcnIoXCJlcnJvciBpbiBhdXRvY29tcGxldGUgc2VhcmNoIHByb21pc2U6XCIsIGVycik7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0ZmlsbExpc3RJZk5vdEVtcHR5KHBhcnNlSXRlbXMobWF0Y2hlcyksIGludGlhbExvYWQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRpdGVtcyA9IHBhcnNlSXRlbXModmFsdWVzKTtcblxuXHRcdFx0XHRcdGlmICh0ZXJtID09PSBcIlwiKSB7XG5cdFx0XHRcdFx0XHRpZiAoZWRpdG9yUGFyYW1zLnNob3dMaXN0T25FbXB0eSkge1xuXHRcdFx0XHRcdFx0XHRtYXRjaGVzID0gaXRlbXM7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdFx0XHRcdFx0aWYgKGl0ZW0udmFsdWUgIT09IG51bGwgfHwgdHlwZW9mIGl0ZW0udmFsdWUgIT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAoU3RyaW5nKGl0ZW0udmFsdWUpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihTdHJpbmcodGVybSkudG9Mb3dlckNhc2UoKSkgPiAtMSB8fCBTdHJpbmcoaXRlbS50aXRsZSkudG9Mb3dlckNhc2UoKS5pbmRleE9mKFN0cmluZyh0ZXJtKS50b0xvd2VyQ2FzZSgpKSA+IC0xKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRtYXRjaGVzLnB1c2goaXRlbSk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRmaWxsTGlzdElmTm90RW1wdHkobWF0Y2hlcywgaW50aWFsTG9hZCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gYWRkTm90aWNlKG5vdGljZSkge1xuXHRcdFx0XHR2YXIgc2VhcmNoRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG5cdFx0XHRcdGNsZWFyTGlzdCgpO1xuXG5cdFx0XHRcdGlmIChub3RpY2UgIT09IGZhbHNlKSB7XG5cdFx0XHRcdFx0c2VhcmNoRWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1lZGl0LXNlbGVjdC1saXN0LW5vdGljZVwiKTtcblx0XHRcdFx0XHRzZWFyY2hFbC50YWJJbmRleCA9IDA7XG5cblx0XHRcdFx0XHRpZiAobm90aWNlIGluc3RhbmNlb2YgTm9kZSkge1xuXHRcdFx0XHRcdFx0c2VhcmNoRWwuYXBwZW5kQ2hpbGQobm90aWNlKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0c2VhcmNoRWwuaW5uZXJIVE1MID0gbm90aWNlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGxpc3RFbC5hcHBlbmRDaGlsZChzZWFyY2hFbCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gcGFyc2VJdGVtcyhpbnB1dFZhbHVlcykge1xuXHRcdFx0XHR2YXIgaXRlbUxpc3QgPSBbXTtcblxuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShpbnB1dFZhbHVlcykpIHtcblx0XHRcdFx0XHRpbnB1dFZhbHVlcy5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkge1xuXG5cdFx0XHRcdFx0XHR2YXIgaXRlbSA9IHt9O1xuXG5cdFx0XHRcdFx0XHRpZiAoKHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YodmFsdWUpKSA9PT0gXCJvYmplY3RcIikge1xuXHRcdFx0XHRcdFx0XHRpdGVtLnRpdGxlID0gZWRpdG9yUGFyYW1zLmxpc3RJdGVtRm9ybWF0dGVyID8gZWRpdG9yUGFyYW1zLmxpc3RJdGVtRm9ybWF0dGVyKHZhbHVlLnZhbHVlLCB2YWx1ZS5sYWJlbCkgOiB2YWx1ZS5sYWJlbDtcblx0XHRcdFx0XHRcdFx0aXRlbS52YWx1ZSA9IHZhbHVlLnZhbHVlO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0aXRlbS50aXRsZSA9IGVkaXRvclBhcmFtcy5saXN0SXRlbUZvcm1hdHRlciA/IGVkaXRvclBhcmFtcy5saXN0SXRlbUZvcm1hdHRlcih2YWx1ZSwgdmFsdWUpIDogdmFsdWU7XG5cdFx0XHRcdFx0XHRcdGl0ZW0udmFsdWUgPSB2YWx1ZTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aXRlbUxpc3QucHVzaChpdGVtKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRmb3IgKHZhciBrZXkgaW4gaW5wdXRWYWx1ZXMpIHtcblx0XHRcdFx0XHRcdHZhciBpdGVtID0ge1xuXHRcdFx0XHRcdFx0XHR0aXRsZTogZWRpdG9yUGFyYW1zLmxpc3RJdGVtRm9ybWF0dGVyID8gZWRpdG9yUGFyYW1zLmxpc3RJdGVtRm9ybWF0dGVyKGtleSwgaW5wdXRWYWx1ZXNba2V5XSkgOiBpbnB1dFZhbHVlc1trZXldLFxuXHRcdFx0XHRcdFx0XHR2YWx1ZToga2V5XG5cdFx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0XHRpdGVtTGlzdC5wdXNoKGl0ZW0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBpdGVtTGlzdDtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gY2xlYXJMaXN0KCkge1xuXHRcdFx0XHR3aGlsZSAobGlzdEVsLmZpcnN0Q2hpbGQpIHtcblx0XHRcdFx0XHRsaXN0RWwucmVtb3ZlQ2hpbGQobGlzdEVsLmZpcnN0Q2hpbGQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGZpbGxMaXN0SWZOb3RFbXB0eShpdGVtcywgaW50aWFsTG9hZCkge1xuXHRcdFx0XHRpZiAoaXRlbXMubGVuZ3RoKSB7XG5cdFx0XHRcdFx0ZmlsbExpc3QoaXRlbXMsIGludGlhbExvYWQpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGlmIChlZGl0b3JQYXJhbXMuZW1wdHlQbGFjZWhvbGRlcikge1xuXHRcdFx0XHRcdFx0YWRkTm90aWNlKGVkaXRvclBhcmFtcy5lbXB0eVBsYWNlaG9sZGVyKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gZmlsbExpc3QoaXRlbXMsIGludGlhbExvYWQpIHtcblx0XHRcdFx0dmFyIGN1cnJlbnQgPSBmYWxzZTtcblxuXHRcdFx0XHRjbGVhckxpc3QoKTtcblxuXHRcdFx0XHRkaXNwbGF5SXRlbXMgPSBpdGVtcztcblxuXHRcdFx0XHRkaXNwbGF5SXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0XHRcdHZhciBlbCA9IGl0ZW0uZWxlbWVudDtcblxuXHRcdFx0XHRcdGlmICghZWwpIHtcblx0XHRcdFx0XHRcdGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcdFx0XHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZWRpdC1zZWxlY3QtbGlzdC1pdGVtXCIpO1xuXHRcdFx0XHRcdFx0ZWwudGFiSW5kZXggPSAwO1xuXHRcdFx0XHRcdFx0ZWwuaW5uZXJIVE1MID0gaXRlbS50aXRsZTtcblxuXHRcdFx0XHRcdFx0ZWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0XHRcdHNldEN1cnJlbnRJdGVtKGl0ZW0pO1xuXHRcdFx0XHRcdFx0XHRjaG9vc2VJdGVtKCk7XG5cdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0ZWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdFx0XHRibHVyYWJsZSA9IGZhbHNlO1xuXG5cdFx0XHRcdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdGJsdXJhYmxlID0gdHJ1ZTtcblx0XHRcdFx0XHRcdFx0fSwgMTApO1xuXHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdGl0ZW0uZWxlbWVudCA9IGVsO1xuXG5cdFx0XHRcdFx0XHRpZiAoaW50aWFsTG9hZCAmJiBpdGVtLnZhbHVlID09IGluaXRpYWxWYWx1ZSkge1xuXHRcdFx0XHRcdFx0XHRpbnB1dC52YWx1ZSA9IGl0ZW0udGl0bGU7XG5cdFx0XHRcdFx0XHRcdGl0ZW0uZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpO1xuXHRcdFx0XHRcdFx0XHRjdXJyZW50ID0gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKGl0ZW0gPT09IGN1cnJlbnRJdGVtKSB7XG5cdFx0XHRcdFx0XHRcdGl0ZW0uZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpO1xuXHRcdFx0XHRcdFx0XHRjdXJyZW50ID0gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRsaXN0RWwuYXBwZW5kQ2hpbGQoZWwpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRpZiAoIWN1cnJlbnQpIHtcblx0XHRcdFx0XHRzZXRDdXJyZW50SXRlbShmYWxzZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gY2hvb3NlSXRlbSgpIHtcblx0XHRcdFx0aGlkZUxpc3QoKTtcblxuXHRcdFx0XHRpZiAoY3VycmVudEl0ZW0pIHtcblx0XHRcdFx0XHRpZiAoaW5pdGlhbFZhbHVlICE9PSBjdXJyZW50SXRlbS52YWx1ZSkge1xuXHRcdFx0XHRcdFx0aW5pdGlhbFZhbHVlID0gY3VycmVudEl0ZW0udmFsdWU7XG5cdFx0XHRcdFx0XHRpbnB1dC52YWx1ZSA9IGN1cnJlbnRJdGVtLnRpdGxlO1xuXHRcdFx0XHRcdFx0c3VjY2VzcyhjdXJyZW50SXRlbS52YWx1ZSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGNhbmNlbCgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRpZiAoZWRpdG9yUGFyYW1zLmZyZWV0ZXh0KSB7XG5cdFx0XHRcdFx0XHRpbml0aWFsVmFsdWUgPSBpbnB1dC52YWx1ZTtcblx0XHRcdFx0XHRcdHN1Y2Nlc3MoaW5wdXQudmFsdWUpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRpZiAoZWRpdG9yUGFyYW1zLmFsbG93RW1wdHkgJiYgaW5wdXQudmFsdWUgPT09IFwiXCIpIHtcblx0XHRcdFx0XHRcdFx0aW5pdGlhbFZhbHVlID0gaW5wdXQudmFsdWU7XG5cdFx0XHRcdFx0XHRcdHN1Y2Nlc3MoaW5wdXQudmFsdWUpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHNob3dMaXN0KCkge1xuXHRcdFx0XHRpZiAoIWxpc3RFbC5wYXJlbnROb2RlKSB7XG5cdFx0XHRcdFx0d2hpbGUgKGxpc3RFbC5maXJzdENoaWxkKSB7XG5cdFx0XHRcdFx0XHRsaXN0RWwucmVtb3ZlQ2hpbGQobGlzdEVsLmZpcnN0Q2hpbGQpO1xuXHRcdFx0XHRcdH12YXIgb2Zmc2V0ID0gVGFidWxhdG9yLnByb3RvdHlwZS5oZWxwZXJzLmVsT2Zmc2V0KGNlbGxFbCk7XG5cblx0XHRcdFx0XHRsaXN0RWwuc3R5bGUubWluV2lkdGggPSBjZWxsRWwub2Zmc2V0V2lkdGggKyBcInB4XCI7XG5cblx0XHRcdFx0XHRsaXN0RWwuc3R5bGUudG9wID0gb2Zmc2V0LnRvcCArIGNlbGxFbC5vZmZzZXRIZWlnaHQgKyBcInB4XCI7XG5cdFx0XHRcdFx0bGlzdEVsLnN0eWxlLmxlZnQgPSBvZmZzZXQubGVmdCArIFwicHhcIjtcblx0XHRcdFx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpc3RFbCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gc2V0Q3VycmVudEl0ZW0oaXRlbSwgc2hvd0lucHV0VmFsdWUpIHtcblx0XHRcdFx0aWYgKGN1cnJlbnRJdGVtICYmIGN1cnJlbnRJdGVtLmVsZW1lbnQpIHtcblx0XHRcdFx0XHRjdXJyZW50SXRlbS5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjdXJyZW50SXRlbSA9IGl0ZW07XG5cblx0XHRcdFx0aWYgKGl0ZW0gJiYgaXRlbS5lbGVtZW50KSB7XG5cdFx0XHRcdFx0aXRlbS5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gaGlkZUxpc3QoKSB7XG5cdFx0XHRcdGlmIChsaXN0RWwucGFyZW50Tm9kZSkge1xuXHRcdFx0XHRcdGxpc3RFbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGxpc3RFbCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZW1vdmVTY3JvbGxMaXN0ZW5lcigpO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBjYW5jZWxJdGVtKCkge1xuXHRcdFx0XHRoaWRlTGlzdCgpO1xuXHRcdFx0XHRjYW5jZWwoKTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gcmVtb3ZlU2Nyb2xsTGlzdGVuZXIoKSB7XG5cdFx0XHRcdHNlbGYudGFibGUucm93TWFuYWdlci5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJzY3JvbGxcIiwgY2FuY2VsSXRlbSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vYWxsb3cga2V5IGJhc2VkIG5hdmlnYXRpb25cblx0XHRcdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdHZhciBpbmRleDtcblxuXHRcdFx0XHRzd2l0Y2ggKGUua2V5Q29kZSkge1xuXHRcdFx0XHRcdGNhc2UgMzg6XG5cdFx0XHRcdFx0XHQvL3VwIGFycm93XG5cdFx0XHRcdFx0XHRpbmRleCA9IGRpc3BsYXlJdGVtcy5pbmRleE9mKGN1cnJlbnRJdGVtKTtcblxuXHRcdFx0XHRcdFx0aWYgKHZlcnROYXYgPT0gXCJlZGl0b3JcIiB8fCB2ZXJ0TmF2ID09IFwiaHlicmlkXCIgJiYgaW5kZXgpIHtcblx0XHRcdFx0XHRcdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdFx0XHRcdGlmIChpbmRleCA+IDApIHtcblx0XHRcdFx0XHRcdFx0XHRzZXRDdXJyZW50SXRlbShkaXNwbGF5SXRlbXNbaW5kZXggLSAxXSk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0c2V0Q3VycmVudEl0ZW0oZmFsc2UpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgNDA6XG5cdFx0XHRcdFx0XHQvL2Rvd24gYXJyb3dcblxuXHRcdFx0XHRcdFx0aW5kZXggPSBkaXNwbGF5SXRlbXMuaW5kZXhPZihjdXJyZW50SXRlbSk7XG5cblx0XHRcdFx0XHRcdGlmICh2ZXJ0TmF2ID09IFwiZWRpdG9yXCIgfHwgdmVydE5hdiA9PSBcImh5YnJpZFwiICYmIGluZGV4IDwgZGlzcGxheUl0ZW1zLmxlbmd0aCAtIDEpIHtcblxuXHRcdFx0XHRcdFx0XHRlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdFx0XHRcdFx0aWYgKGluZGV4IDwgZGlzcGxheUl0ZW1zLmxlbmd0aCAtIDEpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAoaW5kZXggPT0gLTEpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHNldEN1cnJlbnRJdGVtKGRpc3BsYXlJdGVtc1swXSk7XG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdHNldEN1cnJlbnRJdGVtKGRpc3BsYXlJdGVtc1tpbmRleCArIDFdKTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSAzNzogLy9sZWZ0IGFycm93XG5cdFx0XHRcdFx0Y2FzZSAzOTpcblx0XHRcdFx0XHRcdC8vcmlnaHQgYXJyb3dcblx0XHRcdFx0XHRcdGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0Ly8gZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIDEzOlxuXHRcdFx0XHRcdFx0Ly9lbnRlclxuXHRcdFx0XHRcdFx0Y2hvb3NlSXRlbSgpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIDI3OlxuXHRcdFx0XHRcdFx0Ly9lc2NhcGVcblx0XHRcdFx0XHRcdGNhbmNlbEl0ZW0oKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSAzNjogLy9ob21lXG5cdFx0XHRcdFx0Y2FzZSAzNTpcblx0XHRcdFx0XHRcdC8vZW5kXG5cdFx0XHRcdFx0XHQvL3ByZXZlbnQgdGFibGUgbmF2aWdhdGlvbiB3aGlsZSB1c2luZyBpbnB1dCBlbGVtZW50XG5cdFx0XHRcdFx0XHRlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHRzd2l0Y2ggKGUua2V5Q29kZSkge1xuXHRcdFx0XHRcdGNhc2UgMzg6IC8vdXAgYXJyb3dcblx0XHRcdFx0XHRjYXNlIDM3OiAvL2xlZnQgYXJyb3dcblx0XHRcdFx0XHRjYXNlIDM5OiAvL3VwIGFycm93XG5cdFx0XHRcdFx0Y2FzZSA0MDogLy9yaWdodCBhcnJvd1xuXHRcdFx0XHRcdGNhc2UgMTM6IC8vZW50ZXJcblx0XHRcdFx0XHRjYXNlIDI3OlxuXHRcdFx0XHRcdFx0Ly9lc2NhcGVcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRcdGZpbHRlckxpc3QoaW5wdXQudmFsdWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcInNlYXJjaFwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRmaWx0ZXJMaXN0KGlucHV0LnZhbHVlKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRpZiAoYmx1cmFibGUpIHtcblx0XHRcdFx0XHRjaG9vc2VJdGVtKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiZm9jdXNcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0dmFyIHZhbHVlID0gaW5pdGlhbERpc3BsYXlWYWx1ZTtcblx0XHRcdFx0Z2VuVW5pcXVlQ29sdW1uVmFsdWVzKCk7XG5cdFx0XHRcdHNob3dMaXN0KCk7XG5cdFx0XHRcdGlucHV0LnZhbHVlID0gdmFsdWU7XG5cdFx0XHRcdGZpbHRlckxpc3QodmFsdWUsIHRydWUpO1xuXHRcdFx0fSk7XG5cblx0XHRcdG9uUmVuZGVyZWQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRpbnB1dC5zdHlsZS5oZWlnaHQgPSBcIjEwMCVcIjtcblx0XHRcdFx0aW5wdXQuZm9jdXMoeyBwcmV2ZW50U2Nyb2xsOiB0cnVlIH0pO1xuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChlZGl0b3JQYXJhbXMubWFzaykge1xuXHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5tYXNrSW5wdXQoaW5wdXQsIGVkaXRvclBhcmFtcyk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBpbnB1dDtcblx0XHR9LFxuXG5cdFx0Ly9zdGFyIHJhdGluZ1xuXHRcdHN0YXI6IGZ1bmN0aW9uIHN0YXIoY2VsbCwgb25SZW5kZXJlZCwgc3VjY2VzcywgY2FuY2VsLCBlZGl0b3JQYXJhbXMpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdCAgICBlbGVtZW50ID0gY2VsbC5nZXRFbGVtZW50KCksXG5cdFx0XHQgICAgdmFsdWUgPSBjZWxsLmdldFZhbHVlKCksXG5cdFx0XHQgICAgbWF4U3RhcnMgPSBlbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic3ZnXCIpLmxlbmd0aCB8fCA1LFxuXHRcdFx0ICAgIHNpemUgPSBlbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic3ZnXCIpWzBdID8gZWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInN2Z1wiKVswXS5nZXRBdHRyaWJ1dGUoXCJ3aWR0aFwiKSA6IDE0LFxuXHRcdFx0ICAgIHN0YXJzID0gW10sXG5cdFx0XHQgICAgc3RhcnNIb2xkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLFxuXHRcdFx0ICAgIHN0YXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgXCJzdmdcIik7XG5cblx0XHRcdC8vY2hhbmdlIHN0YXIgdHlwZVxuXHRcdFx0ZnVuY3Rpb24gc3RhckNoYW5nZSh2YWwpIHtcblx0XHRcdFx0c3RhcnMuZm9yRWFjaChmdW5jdGlvbiAoc3RhciwgaSkge1xuXHRcdFx0XHRcdGlmIChpIDwgdmFsKSB7XG5cdFx0XHRcdFx0XHRpZiAoc2VsZi50YWJsZS5icm93c2VyID09IFwiaWVcIikge1xuXHRcdFx0XHRcdFx0XHRzdGFyLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwidGFidWxhdG9yLXN0YXItYWN0aXZlXCIpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0c3Rhci5jbGFzc0xpc3QucmVwbGFjZShcInRhYnVsYXRvci1zdGFyLWluYWN0aXZlXCIsIFwidGFidWxhdG9yLXN0YXItYWN0aXZlXCIpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRzdGFyLmlubmVySFRNTCA9ICc8cG9seWdvbiBmaWxsPVwiIzQ4OENFOVwiIHN0cm9rZT1cIiMwMTRBQUVcIiBzdHJva2Utd2lkdGg9XCIzNy42MTUyXCIgc3Ryb2tlLWxpbmVjYXA9XCJyb3VuZFwiIHN0cm9rZS1saW5lam9pbj1cInJvdW5kXCIgc3Ryb2tlLW1pdGVybGltaXQ9XCIxMFwiIHBvaW50cz1cIjI1OS4yMTYsMjkuOTQyIDMzMC4yNywxNzMuOTE5IDQ4OS4xNiwxOTcuMDA3IDM3NC4xODUsMzA5LjA4IDQwMS4zMyw0NjcuMzEgMjU5LjIxNiwzOTIuNjEyIDExNy4xMDQsNDY3LjMxIDE0NC4yNSwzMDkuMDggMjkuMjc0LDE5Ny4wMDcgMTg4LjE2NSwxNzMuOTE5IFwiLz4nO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRpZiAoc2VsZi50YWJsZS5icm93c2VyID09IFwiaWVcIikge1xuXHRcdFx0XHRcdFx0XHRzdGFyLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwidGFidWxhdG9yLXN0YXItaW5hY3RpdmVcIik7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRzdGFyLmNsYXNzTGlzdC5yZXBsYWNlKFwidGFidWxhdG9yLXN0YXItYWN0aXZlXCIsIFwidGFidWxhdG9yLXN0YXItaW5hY3RpdmVcIik7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHN0YXIuaW5uZXJIVE1MID0gJzxwb2x5Z29uIGZpbGw9XCIjMDEwMTU1XCIgc3Ryb2tlPVwiIzY4Njg2OFwiIHN0cm9rZS13aWR0aD1cIjM3LjYxNTJcIiBzdHJva2UtbGluZWNhcD1cInJvdW5kXCIgc3Ryb2tlLWxpbmVqb2luPVwicm91bmRcIiBzdHJva2UtbWl0ZXJsaW1pdD1cIjEwXCIgcG9pbnRzPVwiMjU5LjIxNiwyOS45NDIgMzMwLjI3LDE3My45MTkgNDg5LjE2LDE5Ny4wMDcgMzc0LjE4NSwzMDkuMDggNDAxLjMzLDQ2Ny4zMSAyNTkuMjE2LDM5Mi42MTIgMTE3LjEwNCw0NjcuMzEgMTQ0LjI1LDMwOS4wOCAyOS4yNzQsMTk3LjAwNyAxODguMTY1LDE3My45MTkgXCIvPic7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0Ly9idWlsZCBzdGFyc1xuXHRcdFx0ZnVuY3Rpb24gYnVpbGRTdGFyKGkpIHtcblxuXHRcdFx0XHR2YXIgc3RhckhvbGRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuXHRcdFx0XHR2YXIgbmV4dFN0YXIgPSBzdGFyLmNsb25lTm9kZSh0cnVlKTtcblxuXHRcdFx0XHRzdGFycy5wdXNoKG5leHRTdGFyKTtcblxuXHRcdFx0XHRzdGFySG9sZGVyLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWVudGVyXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdHN0YXJDaGFuZ2UoaSk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHN0YXJIb2xkZXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0c3RhckhvbGRlci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0c3VjY2VzcyhpKTtcblx0XHRcdFx0XHRlbGVtZW50LmJsdXIoKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0c3RhckhvbGRlci5hcHBlbmRDaGlsZChuZXh0U3Rhcik7XG5cdFx0XHRcdHN0YXJzSG9sZGVyLmFwcGVuZENoaWxkKHN0YXJIb2xkZXIpO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2hhbmRsZSBrZXlib2FyZCBuYXZpZ2F0aW9uIHZhbHVlIGNoYW5nZVxuXHRcdFx0ZnVuY3Rpb24gY2hhbmdlVmFsdWUodmFsKSB7XG5cdFx0XHRcdHZhbHVlID0gdmFsO1xuXHRcdFx0XHRzdGFyQ2hhbmdlKHZhbCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vc3R5bGUgY2VsbFxuXHRcdFx0ZWxlbWVudC5zdHlsZS53aGl0ZVNwYWNlID0gXCJub3dyYXBcIjtcblx0XHRcdGVsZW1lbnQuc3R5bGUub3ZlcmZsb3cgPSBcImhpZGRlblwiO1xuXHRcdFx0ZWxlbWVudC5zdHlsZS50ZXh0T3ZlcmZsb3cgPSBcImVsbGlwc2lzXCI7XG5cblx0XHRcdC8vc3R5bGUgaG9sZGluZyBlbGVtZW50XG5cdFx0XHRzdGFyc0hvbGRlci5zdHlsZS52ZXJ0aWNhbEFsaWduID0gXCJtaWRkbGVcIjtcblx0XHRcdHN0YXJzSG9sZGVyLnN0eWxlLmRpc3BsYXkgPSBcImlubGluZS1ibG9ja1wiO1xuXHRcdFx0c3RhcnNIb2xkZXIuc3R5bGUucGFkZGluZyA9IFwiNHB4XCI7XG5cblx0XHRcdC8vc3R5bGUgc3RhclxuXHRcdFx0c3Rhci5zZXRBdHRyaWJ1dGUoXCJ3aWR0aFwiLCBzaXplKTtcblx0XHRcdHN0YXIuc2V0QXR0cmlidXRlKFwiaGVpZ2h0XCIsIHNpemUpO1xuXHRcdFx0c3Rhci5zZXRBdHRyaWJ1dGUoXCJ2aWV3Qm94XCIsIFwiMCAwIDUxMiA1MTJcIik7XG5cdFx0XHRzdGFyLnNldEF0dHJpYnV0ZShcInhtbDpzcGFjZVwiLCBcInByZXNlcnZlXCIpO1xuXHRcdFx0c3Rhci5zdHlsZS5wYWRkaW5nID0gXCIwIDFweFwiO1xuXG5cdFx0XHRpZiAoZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzICYmIF90eXBlb2YoZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzKSA9PSBcIm9iamVjdFwiKSB7XG5cdFx0XHRcdGZvciAodmFyIGtleSBpbiBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMpIHtcblx0XHRcdFx0XHRpZiAoa2V5LmNoYXJBdCgwKSA9PSBcIitcIikge1xuXHRcdFx0XHRcdFx0a2V5ID0ga2V5LnNsaWNlKDEpO1xuXHRcdFx0XHRcdFx0c3RhcnNIb2xkZXIuc2V0QXR0cmlidXRlKGtleSwgc3RhcnNIb2xkZXIuZ2V0QXR0cmlidXRlKGtleSkgKyBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXNbXCIrXCIgKyBrZXldKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0c3RhcnNIb2xkZXIuc2V0QXR0cmlidXRlKGtleSwgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzW2tleV0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvL2NyZWF0ZSBjb3JyZWN0IG51bWJlciBvZiBzdGFyc1xuXHRcdFx0Zm9yICh2YXIgaSA9IDE7IGkgPD0gbWF4U3RhcnM7IGkrKykge1xuXHRcdFx0XHRidWlsZFN0YXIoaSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vZW5zdXJlIHZhbHVlIGRvZXMgbm90IGV4Y2VlZCBudW1iZXIgb2Ygc3RhcnNcblx0XHRcdHZhbHVlID0gTWF0aC5taW4ocGFyc2VJbnQodmFsdWUpLCBtYXhTdGFycyk7XG5cblx0XHRcdC8vIHNldCBpbml0aWFsIHN0eWxpbmcgb2Ygc3RhcnNcblx0XHRcdHN0YXJDaGFuZ2UodmFsdWUpO1xuXG5cdFx0XHRzdGFyc0hvbGRlci5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdHN0YXJDaGFuZ2UoMCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0c3RhcnNIb2xkZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdHN1Y2Nlc3MoMCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRjYW5jZWwoKTtcblx0XHRcdH0pO1xuXG5cdFx0XHQvL2FsbG93IGtleSBiYXNlZCBuYXZpZ2F0aW9uXG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdHN3aXRjaCAoZS5rZXlDb2RlKSB7XG5cdFx0XHRcdFx0Y2FzZSAzOTpcblx0XHRcdFx0XHRcdC8vcmlnaHQgYXJyb3dcblx0XHRcdFx0XHRcdGNoYW5nZVZhbHVlKHZhbHVlICsgMSk7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgMzc6XG5cdFx0XHRcdFx0XHQvL2xlZnQgYXJyb3dcblx0XHRcdFx0XHRcdGNoYW5nZVZhbHVlKHZhbHVlIC0gMSk7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgMTM6XG5cdFx0XHRcdFx0XHQvL2VudGVyXG5cdFx0XHRcdFx0XHRzdWNjZXNzKHZhbHVlKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSAyNzpcblx0XHRcdFx0XHRcdC8vZXNjYXBlXG5cdFx0XHRcdFx0XHRjYW5jZWwoKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIHN0YXJzSG9sZGVyO1xuXHRcdH0sXG5cblx0XHQvL2RyYWdnYWJsZSBwcm9ncmVzcyBiYXJcblx0XHRwcm9ncmVzczogZnVuY3Rpb24gcHJvZ3Jlc3MoY2VsbCwgb25SZW5kZXJlZCwgc3VjY2VzcywgY2FuY2VsLCBlZGl0b3JQYXJhbXMpIHtcblx0XHRcdHZhciBlbGVtZW50ID0gY2VsbC5nZXRFbGVtZW50KCksXG5cdFx0XHQgICAgbWF4ID0gdHlwZW9mIGVkaXRvclBhcmFtcy5tYXggPT09IFwidW5kZWZpbmVkXCIgPyBlbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiZGl2XCIpWzBdLmdldEF0dHJpYnV0ZShcIm1heFwiKSB8fCAxMDAgOiBlZGl0b3JQYXJhbXMubWF4LFxuXHRcdFx0ICAgIG1pbiA9IHR5cGVvZiBlZGl0b3JQYXJhbXMubWluID09PSBcInVuZGVmaW5lZFwiID8gZWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImRpdlwiKVswXS5nZXRBdHRyaWJ1dGUoXCJtaW5cIikgfHwgMCA6IGVkaXRvclBhcmFtcy5taW4sXG5cdFx0XHQgICAgcGVyY2VudCA9IChtYXggLSBtaW4pIC8gMTAwLFxuXHRcdFx0ICAgIHZhbHVlID0gY2VsbC5nZXRWYWx1ZSgpIHx8IDAsXG5cdFx0XHQgICAgaGFuZGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSxcblx0XHRcdCAgICBiYXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLFxuXHRcdFx0ICAgIG1vdXNlRHJhZyxcblx0XHRcdCAgICBtb3VzZURyYWdXaWR0aDtcblxuXHRcdFx0Ly9zZXQgbmV3IHZhbHVlXG5cdFx0XHRmdW5jdGlvbiB1cGRhdGVWYWx1ZSgpIHtcblx0XHRcdFx0dmFyIGNhbGNWYWwgPSBwZXJjZW50ICogTWF0aC5yb3VuZChiYXIub2Zmc2V0V2lkdGggLyAoZWxlbWVudC5jbGllbnRXaWR0aCAvIDEwMCkpICsgbWluO1xuXHRcdFx0XHRzdWNjZXNzKGNhbGNWYWwpO1xuXHRcdFx0XHRlbGVtZW50LnNldEF0dHJpYnV0ZShcImFyaWEtdmFsdWVub3dcIiwgY2FsY1ZhbCk7XG5cdFx0XHRcdGVsZW1lbnQuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCB2YWx1ZSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vc3R5bGUgaGFuZGxlXG5cdFx0XHRoYW5kbGUuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG5cdFx0XHRoYW5kbGUuc3R5bGUucmlnaHQgPSBcIjBcIjtcblx0XHRcdGhhbmRsZS5zdHlsZS50b3AgPSBcIjBcIjtcblx0XHRcdGhhbmRsZS5zdHlsZS5ib3R0b20gPSBcIjBcIjtcblx0XHRcdGhhbmRsZS5zdHlsZS53aWR0aCA9IFwiNXB4XCI7XG5cdFx0XHRoYW5kbGUuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wcm9ncmVzcy1oYW5kbGVcIik7XG5cblx0XHRcdC8vc3R5bGUgYmFyXG5cdFx0XHRiYXIuc3R5bGUuZGlzcGxheSA9IFwiaW5saW5lLWJsb2NrXCI7XG5cdFx0XHRiYXIuc3R5bGUucG9zaXRpb24gPSBcInJlbGF0aXZlXCI7XG5cdFx0XHQvLyBiYXIuc3R5bGUudG9wID0gXCI4cHhcIjtcblx0XHRcdC8vIGJhci5zdHlsZS5ib3R0b20gPSBcIjhweFwiO1xuXHRcdFx0Ly8gYmFyLnN0eWxlLmxlZnQgPSBcIjRweFwiO1xuXHRcdFx0Ly8gYmFyLnN0eWxlLm1hcmdpblJpZ2h0ID0gXCI0cHhcIjtcblx0XHRcdGJhci5zdHlsZS5oZWlnaHQgPSBcIjEwMCVcIjtcblx0XHRcdGJhci5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIiM0ODhDRTlcIjtcblx0XHRcdGJhci5zdHlsZS5tYXhXaWR0aCA9IFwiMTAwJVwiO1xuXHRcdFx0YmFyLnN0eWxlLm1pbldpZHRoID0gXCIwJVwiO1xuXG5cdFx0XHRpZiAoZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzICYmIF90eXBlb2YoZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzKSA9PSBcIm9iamVjdFwiKSB7XG5cdFx0XHRcdGZvciAodmFyIGtleSBpbiBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMpIHtcblx0XHRcdFx0XHRpZiAoa2V5LmNoYXJBdCgwKSA9PSBcIitcIikge1xuXHRcdFx0XHRcdFx0a2V5ID0ga2V5LnNsaWNlKDEpO1xuXHRcdFx0XHRcdFx0YmFyLnNldEF0dHJpYnV0ZShrZXksIGJhci5nZXRBdHRyaWJ1dGUoa2V5KSArIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlc1tcIitcIiArIGtleV0pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRiYXIuc2V0QXR0cmlidXRlKGtleSwgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzW2tleV0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvL3N0eWxlIGNlbGxcblx0XHRcdGVsZW1lbnQuc3R5bGUucGFkZGluZyA9IFwiNHB4IDRweFwiO1xuXG5cdFx0XHQvL21ha2Ugc3VyZSB2YWx1ZSBpcyBpbiByYW5nZVxuXHRcdFx0dmFsdWUgPSBNYXRoLm1pbihwYXJzZUZsb2F0KHZhbHVlKSwgbWF4KTtcblx0XHRcdHZhbHVlID0gTWF0aC5tYXgocGFyc2VGbG9hdCh2YWx1ZSksIG1pbik7XG5cblx0XHRcdC8vd29ya291dCBwZXJjZW50YWdlXG5cdFx0XHR2YWx1ZSA9IE1hdGgucm91bmQoKHZhbHVlIC0gbWluKSAvIHBlcmNlbnQpO1xuXHRcdFx0Ly8gYmFyLnN0eWxlLnJpZ2h0ID0gdmFsdWUgKyBcIiVcIjtcblx0XHRcdGJhci5zdHlsZS53aWR0aCA9IHZhbHVlICsgXCIlXCI7XG5cblx0XHRcdGVsZW1lbnQuc2V0QXR0cmlidXRlKFwiYXJpYS12YWx1ZW1pblwiLCBtaW4pO1xuXHRcdFx0ZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJhcmlhLXZhbHVlbWF4XCIsIG1heCk7XG5cblx0XHRcdGJhci5hcHBlbmRDaGlsZChoYW5kbGUpO1xuXG5cdFx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRtb3VzZURyYWcgPSBlLnNjcmVlblg7XG5cdFx0XHRcdG1vdXNlRHJhZ1dpZHRoID0gYmFyLm9mZnNldFdpZHRoO1xuXHRcdFx0fSk7XG5cblx0XHRcdGhhbmRsZS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0aGFuZGxlLnN0eWxlLmN1cnNvciA9IFwiZXctcmVzaXplXCI7XG5cdFx0XHR9KTtcblxuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGlmIChtb3VzZURyYWcpIHtcblx0XHRcdFx0XHRiYXIuc3R5bGUud2lkdGggPSBtb3VzZURyYWdXaWR0aCArIGUuc2NyZWVuWCAtIG1vdXNlRHJhZyArIFwicHhcIjtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0aWYgKG1vdXNlRHJhZykge1xuXHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblxuXHRcdFx0XHRcdG1vdXNlRHJhZyA9IGZhbHNlO1xuXHRcdFx0XHRcdG1vdXNlRHJhZ1dpZHRoID0gZmFsc2U7XG5cblx0XHRcdFx0XHR1cGRhdGVWYWx1ZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0Ly9hbGxvdyBrZXkgYmFzZWQgbmF2aWdhdGlvblxuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRzd2l0Y2ggKGUua2V5Q29kZSkge1xuXHRcdFx0XHRcdGNhc2UgMzk6XG5cdFx0XHRcdFx0XHQvL3JpZ2h0IGFycm93XG5cdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRiYXIuc3R5bGUud2lkdGggPSBiYXIuY2xpZW50V2lkdGggKyBlbGVtZW50LmNsaWVudFdpZHRoIC8gMTAwICsgXCJweFwiO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIDM3OlxuXHRcdFx0XHRcdFx0Ly9sZWZ0IGFycm93XG5cdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRiYXIuc3R5bGUud2lkdGggPSBiYXIuY2xpZW50V2lkdGggLSBlbGVtZW50LmNsaWVudFdpZHRoIC8gMTAwICsgXCJweFwiO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIDk6IC8vdGFiXG5cdFx0XHRcdFx0Y2FzZSAxMzpcblx0XHRcdFx0XHRcdC8vZW50ZXJcblx0XHRcdFx0XHRcdHVwZGF0ZVZhbHVlKCk7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgMjc6XG5cdFx0XHRcdFx0XHQvL2VzY2FwZVxuXHRcdFx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdGNhbmNlbCgpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBiYXI7XG5cdFx0fSxcblxuXHRcdC8vY2hlY2tib3hcblx0XHR0aWNrQ3Jvc3M6IGZ1bmN0aW9uIHRpY2tDcm9zcyhjZWxsLCBvblJlbmRlcmVkLCBzdWNjZXNzLCBjYW5jZWwsIGVkaXRvclBhcmFtcykge1xuXHRcdFx0dmFyIHZhbHVlID0gY2VsbC5nZXRWYWx1ZSgpLFxuXHRcdFx0ICAgIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpLFxuXHRcdFx0ICAgIHRyaXN0YXRlID0gZWRpdG9yUGFyYW1zLnRyaXN0YXRlLFxuXHRcdFx0ICAgIGluZGV0ZXJtVmFsdWUgPSB0eXBlb2YgZWRpdG9yUGFyYW1zLmluZGV0ZXJtaW5hdGVWYWx1ZSA9PT0gXCJ1bmRlZmluZWRcIiA/IG51bGwgOiBlZGl0b3JQYXJhbXMuaW5kZXRlcm1pbmF0ZVZhbHVlLFxuXHRcdFx0ICAgIGluZGV0ZXJtU3RhdGUgPSBmYWxzZTtcblxuXHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcImNoZWNrYm94XCIpO1xuXHRcdFx0aW5wdXQuc3R5bGUubWFyZ2luVG9wID0gXCI1cHhcIjtcblx0XHRcdGlucHV0LnN0eWxlLmJveFNpemluZyA9IFwiYm9yZGVyLWJveFwiO1xuXG5cdFx0XHRpZiAoZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzICYmIF90eXBlb2YoZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzKSA9PSBcIm9iamVjdFwiKSB7XG5cdFx0XHRcdGZvciAodmFyIGtleSBpbiBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMpIHtcblx0XHRcdFx0XHRpZiAoa2V5LmNoYXJBdCgwKSA9PSBcIitcIikge1xuXHRcdFx0XHRcdFx0a2V5ID0ga2V5LnNsaWNlKDEpO1xuXHRcdFx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgaW5wdXQuZ2V0QXR0cmlidXRlKGtleSkgKyBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXNbXCIrXCIgKyBrZXldKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzW2tleV0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpbnB1dC52YWx1ZSA9IHZhbHVlO1xuXG5cdFx0XHRpZiAodHJpc3RhdGUgJiYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIiB8fCB2YWx1ZSA9PT0gaW5kZXRlcm1WYWx1ZSB8fCB2YWx1ZSA9PT0gXCJcIikpIHtcblx0XHRcdFx0aW5kZXRlcm1TdGF0ZSA9IHRydWU7XG5cdFx0XHRcdGlucHV0LmluZGV0ZXJtaW5hdGUgPSB0cnVlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5icm93c2VyICE9IFwiZmlyZWZveFwiKSB7XG5cdFx0XHRcdC8vcHJldmVudCBibHVyIGlzc3VlIG9uIG1hYyBmaXJlZm94XG5cdFx0XHRcdG9uUmVuZGVyZWQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdGlucHV0LmZvY3VzKHsgcHJldmVudFNjcm9sbDogdHJ1ZSB9KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdGlucHV0LmNoZWNrZWQgPSB2YWx1ZSA9PT0gdHJ1ZSB8fCB2YWx1ZSA9PT0gXCJ0cnVlXCIgfHwgdmFsdWUgPT09IFwiVHJ1ZVwiIHx8IHZhbHVlID09PSAxO1xuXG5cdFx0XHRmdW5jdGlvbiBzZXRWYWx1ZShibHVyKSB7XG5cdFx0XHRcdGlmICh0cmlzdGF0ZSkge1xuXHRcdFx0XHRcdGlmICghYmx1cikge1xuXHRcdFx0XHRcdFx0aWYgKGlucHV0LmNoZWNrZWQgJiYgIWluZGV0ZXJtU3RhdGUpIHtcblx0XHRcdFx0XHRcdFx0aW5wdXQuY2hlY2tlZCA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0XHRpbnB1dC5pbmRldGVybWluYXRlID0gdHJ1ZTtcblx0XHRcdFx0XHRcdFx0aW5kZXRlcm1TdGF0ZSA9IHRydWU7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBpbmRldGVybVZhbHVlO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0aW5kZXRlcm1TdGF0ZSA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gaW5wdXQuY2hlY2tlZDtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0aWYgKGluZGV0ZXJtU3RhdGUpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIGluZGV0ZXJtVmFsdWU7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gaW5wdXQuY2hlY2tlZDtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cmV0dXJuIGlucHV0LmNoZWNrZWQ7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly9zdWJtaXQgbmV3IHZhbHVlIG9uIGJsdXJcblx0XHRcdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0c3VjY2VzcyhzZXRWYWx1ZSgpKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRzdWNjZXNzKHNldFZhbHVlKHRydWUpKTtcblx0XHRcdH0pO1xuXG5cdFx0XHQvL3N1Ym1pdCBuZXcgdmFsdWUgb24gZW50ZXJcblx0XHRcdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGlmIChlLmtleUNvZGUgPT0gMTMpIHtcblx0XHRcdFx0XHRzdWNjZXNzKHNldFZhbHVlKCkpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmIChlLmtleUNvZGUgPT0gMjcpIHtcblx0XHRcdFx0XHRjYW5jZWwoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBpbnB1dDtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcImVkaXRcIiwgRWRpdCk7XG5cblx0dmFyIEV4cG9ydFJvdyA9IGZ1bmN0aW9uIEV4cG9ydFJvdyh0eXBlLCBjb2x1bW5zLCBjb21wb25lbnQsIGluZGVudCkge1xuXHRcdHRoaXMudHlwZSA9IHR5cGU7XG5cdFx0dGhpcy5jb2x1bW5zID0gY29sdW1ucztcblx0XHR0aGlzLmNvbXBvbmVudCA9IGNvbXBvbmVudCB8fCBmYWxzZTtcblx0XHR0aGlzLmluZGVudCA9IGluZGVudCB8fCAwO1xuXHR9O1xuXG5cdHZhciBFeHBvcnRDb2x1bW4gPSBmdW5jdGlvbiBFeHBvcnRDb2x1bW4odmFsdWUsIGNvbXBvbmVudCwgd2lkdGgsIGhlaWdodCwgZGVwdGgpIHtcblx0XHR0aGlzLnZhbHVlID0gdmFsdWU7XG5cdFx0dGhpcy5jb21wb25lbnQgPSBjb21wb25lbnQgfHwgZmFsc2U7XG5cdFx0dGhpcy53aWR0aCA9IHdpZHRoO1xuXHRcdHRoaXMuaGVpZ2h0ID0gaGVpZ2h0O1xuXHRcdHRoaXMuZGVwdGggPSBkZXB0aDtcblx0fTtcblxuXHR2YXIgRXhwb3J0ID0gZnVuY3Rpb24gRXhwb3J0KHRhYmxlKSB7XG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlOyAvL2hvbGQgVGFidWxhdG9yIG9iamVjdFxuXHRcdHRoaXMuY29uZmlnID0ge307XG5cdFx0dGhpcy5jbG9uZVRhYmxlU3R5bGUgPSB0cnVlO1xuXHRcdHRoaXMuY29sVmlzUHJvcCA9IFwiXCI7XG5cdH07XG5cblx0RXhwb3J0LnByb3RvdHlwZS5nZW5lcmF0ZUV4cG9ydExpc3QgPSBmdW5jdGlvbiAoY29uZmlnLCBzdHlsZSwgcmFuZ2UsIGNvbFZpc1Byb3ApIHtcblx0XHR0aGlzLmNsb25lVGFibGVTdHlsZSA9IHN0eWxlO1xuXHRcdHRoaXMuY29uZmlnID0gY29uZmlnIHx8IHt9O1xuXHRcdHRoaXMuY29sVmlzUHJvcCA9IGNvbFZpc1Byb3A7XG5cblx0XHR2YXIgaGVhZGVycyA9IHRoaXMuY29uZmlnLmNvbHVtbkhlYWRlcnMgIT09IGZhbHNlID8gdGhpcy5oZWFkZXJzVG9FeHBvcnRSb3dzKHRoaXMuZ2VuZXJhdGVDb2x1bW5Hcm91cEhlYWRlcnMoKSkgOiBbXTtcblx0XHR2YXIgYm9keSA9IHRoaXMuYm9keVRvRXhwb3J0Um93cyh0aGlzLnJvd0xvb2t1cChyYW5nZSkpO1xuXG5cdFx0cmV0dXJuIGhlYWRlcnMuY29uY2F0KGJvZHkpO1xuXHR9O1xuXG5cdEV4cG9ydC5wcm90b3R5cGUuZ2VuZXJlYXRlVGFibGUgPSBmdW5jdGlvbiAoY29uZmlnLCBzdHlsZSwgcmFuZ2UsIGNvbFZpc1Byb3ApIHtcblx0XHR2YXIgbGlzdCA9IHRoaXMuZ2VuZXJhdGVFeHBvcnRMaXN0KGNvbmZpZywgc3R5bGUsIHJhbmdlLCBjb2xWaXNQcm9wKTtcblxuXHRcdHJldHVybiB0aGlzLmdlbmVyZWF0ZVRhYmxlRWxlbWVudChsaXN0KTtcblx0fTtcblxuXHRFeHBvcnQucHJvdG90eXBlLnJvd0xvb2t1cCA9IGZ1bmN0aW9uIChyYW5nZSkge1xuXHRcdHZhciBfdGhpczQ1ID0gdGhpcztcblxuXHRcdHZhciByb3dzID0gW107XG5cblx0XHRpZiAodHlwZW9mIHJhbmdlID09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0cmFuZ2UuY2FsbCh0aGlzLnRhYmxlKS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0cm93ID0gX3RoaXM0NS50YWJsZS5yb3dNYW5hZ2VyLmZpbmRSb3cocm93KTtcblxuXHRcdFx0XHRpZiAocm93KSB7XG5cdFx0XHRcdFx0cm93cy5wdXNoKHJvdyk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRzd2l0Y2ggKHJhbmdlKSB7XG5cdFx0XHRcdGNhc2UgdHJ1ZTpcblx0XHRcdFx0Y2FzZSBcInZpc2libGVcIjpcblx0XHRcdFx0XHRyb3dzID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldFZpc2libGVSb3dzKHRydWUpO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgXCJhbGxcIjpcblx0XHRcdFx0XHRyb3dzID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLnJvd3M7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSBcInNlbGVjdGVkXCI6XG5cdFx0XHRcdFx0cm93cyA9IHRoaXMudGFibGUubW9kdWxlcy5zZWxlY3RSb3cuc2VsZWN0ZWRSb3dzO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgXCJhY3RpdmVcIjpcblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRyb3dzID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldERpc3BsYXlSb3dzKCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIE9iamVjdC5hc3NpZ24oW10sIHJvd3MpO1xuXHR9O1xuXG5cdEV4cG9ydC5wcm90b3R5cGUuZ2VuZXJhdGVDb2x1bW5Hcm91cEhlYWRlcnMgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIF90aGlzNDYgPSB0aGlzO1xuXG5cdFx0dmFyIG91dHB1dCA9IFtdO1xuXG5cdFx0dmFyIGNvbHVtbnMgPSB0aGlzLmNvbmZpZy5jb2x1bW5Hcm91cHMgIT09IGZhbHNlID8gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmNvbHVtbnMgOiB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuY29sdW1uc0J5SW5kZXg7XG5cblx0XHRjb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdFx0dmFyIGNvbERhdGEgPSBfdGhpczQ2LnByb2Nlc3NDb2x1bW5Hcm91cChjb2x1bW4pO1xuXG5cdFx0XHRpZiAoY29sRGF0YSkge1xuXHRcdFx0XHRvdXRwdXQucHVzaChjb2xEYXRhKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0RXhwb3J0LnByb3RvdHlwZS5wcm9jZXNzQ29sdW1uR3JvdXAgPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0dmFyIF90aGlzNDcgPSB0aGlzO1xuXG5cdFx0dmFyIHN1Ykdyb3VwcyA9IGNvbHVtbi5jb2x1bW5zLFxuXHRcdCAgICBtYXhEZXB0aCA9IDAsXG5cdFx0ICAgIHRpdGxlID0gY29sdW1uLmRlZmluaXRpb25bXCJ0aXRsZVwiICsgKHRoaXMuY29sVmlzUHJvcC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRoaXMuY29sVmlzUHJvcC5zbGljZSgxKSldIHx8IGNvbHVtbi5kZWZpbml0aW9uLnRpdGxlO1xuXG5cdFx0dmFyIGdyb3VwRGF0YSA9IHtcblx0XHRcdHRpdGxlOiB0aXRsZSxcblx0XHRcdGNvbHVtbjogY29sdW1uLFxuXHRcdFx0ZGVwdGg6IDFcblx0XHR9O1xuXG5cdFx0aWYgKHN1Ykdyb3Vwcy5sZW5ndGgpIHtcblx0XHRcdGdyb3VwRGF0YS5zdWJHcm91cHMgPSBbXTtcblx0XHRcdGdyb3VwRGF0YS53aWR0aCA9IDA7XG5cblx0XHRcdHN1Ykdyb3Vwcy5mb3JFYWNoKGZ1bmN0aW9uIChzdWJHcm91cCkge1xuXHRcdFx0XHR2YXIgc3ViR3JvdXBEYXRhID0gX3RoaXM0Ny5wcm9jZXNzQ29sdW1uR3JvdXAoc3ViR3JvdXApO1xuXG5cdFx0XHRcdGlmIChzdWJHcm91cERhdGEpIHtcblx0XHRcdFx0XHRncm91cERhdGEud2lkdGggKz0gc3ViR3JvdXBEYXRhLndpZHRoO1xuXHRcdFx0XHRcdGdyb3VwRGF0YS5zdWJHcm91cHMucHVzaChzdWJHcm91cERhdGEpO1xuXG5cdFx0XHRcdFx0aWYgKHN1Ykdyb3VwRGF0YS5kZXB0aCA+IG1heERlcHRoKSB7XG5cdFx0XHRcdFx0XHRtYXhEZXB0aCA9IHN1Ykdyb3VwRGF0YS5kZXB0aDtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRncm91cERhdGEuZGVwdGggKz0gbWF4RGVwdGg7XG5cblx0XHRcdGlmICghZ3JvdXBEYXRhLndpZHRoKSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYgKHRoaXMuY29sdW1uVmlzQ2hlY2soY29sdW1uKSkge1xuXHRcdFx0XHRncm91cERhdGEud2lkdGggPSAxO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBncm91cERhdGE7XG5cdH07XG5cblx0RXhwb3J0LnByb3RvdHlwZS5jb2x1bW5WaXNDaGVjayA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRyZXR1cm4gY29sdW1uLmRlZmluaXRpb25bdGhpcy5jb2xWaXNQcm9wXSAhPT0gZmFsc2UgJiYgKGNvbHVtbi52aXNpYmxlIHx8ICFjb2x1bW4udmlzaWJsZSAmJiBjb2x1bW4uZGVmaW5pdGlvblt0aGlzLmNvbFZpc1Byb3BdKTtcblx0fTtcblxuXHRFeHBvcnQucHJvdG90eXBlLmhlYWRlcnNUb0V4cG9ydFJvd3MgPSBmdW5jdGlvbiAoY29sdW1ucykge1xuXHRcdHZhciBoZWFkZXJzID0gW10sXG5cdFx0ICAgIGhlYWRlckRlcHRoID0gMCxcblx0XHQgICAgZXhwb3J0Um93cyA9IFtdO1xuXG5cdFx0ZnVuY3Rpb24gcGFyc2VDb2x1bW5Hcm91cChjb2x1bW4sIGxldmVsKSB7XG5cblx0XHRcdHZhciBkZXB0aCA9IGhlYWRlckRlcHRoIC0gbGV2ZWw7XG5cblx0XHRcdGlmICh0eXBlb2YgaGVhZGVyc1tsZXZlbF0gPT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0aGVhZGVyc1tsZXZlbF0gPSBbXTtcblx0XHRcdH1cblxuXHRcdFx0Y29sdW1uLmhlaWdodCA9IGNvbHVtbi5zdWJHcm91cHMgPyAxIDogZGVwdGggLSBjb2x1bW4uZGVwdGggKyAxO1xuXG5cdFx0XHRoZWFkZXJzW2xldmVsXS5wdXNoKGNvbHVtbik7XG5cblx0XHRcdGlmIChjb2x1bW4uaGVpZ2h0ID4gMSkge1xuXHRcdFx0XHRmb3IgKHZhciBfaTYgPSAxOyBfaTYgPCBjb2x1bW4uaGVpZ2h0OyBfaTYrKykge1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZiBoZWFkZXJzW2xldmVsICsgX2k2XSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRcdFx0aGVhZGVyc1tsZXZlbCArIF9pNl0gPSBbXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRoZWFkZXJzW2xldmVsICsgX2k2XS5wdXNoKGZhbHNlKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoY29sdW1uLndpZHRoID4gMSkge1xuXHRcdFx0XHRmb3IgKHZhciBfaTcgPSAxOyBfaTcgPCBjb2x1bW4ud2lkdGg7IF9pNysrKSB7XG5cdFx0XHRcdFx0aGVhZGVyc1tsZXZlbF0ucHVzaChmYWxzZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKGNvbHVtbi5zdWJHcm91cHMpIHtcblx0XHRcdFx0Y29sdW1uLnN1Ykdyb3Vwcy5mb3JFYWNoKGZ1bmN0aW9uIChzdWJHcm91cCkge1xuXHRcdFx0XHRcdHBhcnNlQ29sdW1uR3JvdXAoc3ViR3JvdXAsIGxldmVsICsgMSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vY2FsY3VsYXRlIG1heGltdW0gaGVhZGVyIGRlYnRoXG5cdFx0Y29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdGlmIChjb2x1bW4uZGVwdGggPiBoZWFkZXJEZXB0aCkge1xuXHRcdFx0XHRoZWFkZXJEZXB0aCA9IGNvbHVtbi5kZXB0aDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0XHRwYXJzZUNvbHVtbkdyb3VwKGNvbHVtbiwgMCk7XG5cdFx0fSk7XG5cblx0XHRoZWFkZXJzLmZvckVhY2goZnVuY3Rpb24gKGhlYWRlcikge1xuXHRcdFx0dmFyIGNvbHVtbnMgPSBbXTtcblxuXHRcdFx0aGVhZGVyLmZvckVhY2goZnVuY3Rpb24gKGNvbCkge1xuXHRcdFx0XHRpZiAoY29sKSB7XG5cdFx0XHRcdFx0Y29sdW1ucy5wdXNoKG5ldyBFeHBvcnRDb2x1bW4oY29sLnRpdGxlLCBjb2wuY29sdW1uLmdldENvbXBvbmVudCgpLCBjb2wud2lkdGgsIGNvbC5oZWlnaHQsIGNvbC5kZXB0aCkpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvbHVtbnMucHVzaChudWxsKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGV4cG9ydFJvd3MucHVzaChuZXcgRXhwb3J0Um93KFwiaGVhZGVyXCIsIGNvbHVtbnMpKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBleHBvcnRSb3dzO1xuXHR9O1xuXG5cdEV4cG9ydC5wcm90b3R5cGUuYm9keVRvRXhwb3J0Um93cyA9IGZ1bmN0aW9uIChyb3dzKSB7XG5cdFx0dmFyIF90aGlzNDggPSB0aGlzO1xuXG5cdFx0dmFyIGNvbHVtbnMgPSBbXTtcblx0XHR2YXIgZXhwb3J0Um93cyA9IFtdO1xuXG5cdFx0dGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmNvbHVtbnNCeUluZGV4LmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdFx0aWYgKF90aGlzNDguY29sdW1uVmlzQ2hlY2soY29sdW1uKSkge1xuXHRcdFx0XHRjb2x1bW5zLnB1c2goY29sdW1uLmdldENvbXBvbmVudCgpKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGlmICh0aGlzLmNvbmZpZy5jb2x1bW5DYWxjcyAhPT0gZmFsc2UgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiKSkge1xuXHRcdFx0aWYgKHRoaXMudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy50b3BJbml0aWFsaXplZCkge1xuXHRcdFx0XHRyb3dzLnVuc2hpZnQodGhpcy50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLnRvcFJvdyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MuYm90SW5pdGlhbGl6ZWQpIHtcblx0XHRcdFx0cm93cy5wdXNoKHRoaXMudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5ib3RSb3cpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJvd3MgPSByb3dzLmZpbHRlcihmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRzd2l0Y2ggKHJvdy50eXBlKSB7XG5cdFx0XHRcdGNhc2UgXCJncm91cFwiOlxuXHRcdFx0XHRcdHJldHVybiBfdGhpczQ4LmNvbmZpZy5yb3dHcm91cHMgIT09IGZhbHNlO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgXCJjYWxjXCI6XG5cdFx0XHRcdFx0cmV0dXJuIF90aGlzNDguY29uZmlnLmNvbHVtbkNhbGNzICE9PSBmYWxzZTtcblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRjYXNlIFwicm93XCI6XG5cdFx0XHRcdFx0cmV0dXJuICEoX3RoaXM0OC50YWJsZS5vcHRpb25zLmRhdGFUcmVlICYmIF90aGlzNDguY29uZmlnLmRhdGFUcmVlID09PSBmYWxzZSAmJiByb3cubW9kdWxlcy5kYXRhVHJlZS5wYXJlbnQpO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9KTtcblxuXHRcdHJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93LCBpKSB7XG5cdFx0XHR2YXIgcm93RGF0YSA9IHJvdy5nZXREYXRhKF90aGlzNDguY29sVmlzUHJvcCk7XG5cdFx0XHR2YXIgZXhwb3J0Q29scyA9IFtdO1xuXHRcdFx0dmFyIGluZGVudCA9IDA7XG5cblx0XHRcdHN3aXRjaCAocm93LnR5cGUpIHtcblx0XHRcdFx0Y2FzZSBcImdyb3VwXCI6XG5cdFx0XHRcdFx0aW5kZW50ID0gcm93LmxldmVsO1xuXHRcdFx0XHRcdGV4cG9ydENvbHMucHVzaChuZXcgRXhwb3J0Q29sdW1uKHJvdy5rZXksIHJvdy5nZXRDb21wb25lbnQoKSwgY29sdW1ucy5sZW5ndGgsIDEpKTtcblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRjYXNlIFwiY2FsY1wiOlxuXHRcdFx0XHRjYXNlIFwicm93XCI6XG5cdFx0XHRcdFx0Y29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2wpIHtcblx0XHRcdFx0XHRcdGV4cG9ydENvbHMucHVzaChuZXcgRXhwb3J0Q29sdW1uKGNvbC5fY29sdW1uLmdldEZpZWxkVmFsdWUocm93RGF0YSksIGNvbCwgMSwgMSkpO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0aWYgKF90aGlzNDgudGFibGUub3B0aW9ucy5kYXRhVHJlZSAmJiBfdGhpczQ4LmNvbmZpZy5kYXRhVHJlZSAhPT0gZmFsc2UpIHtcblx0XHRcdFx0XHRcdGluZGVudCA9IHJvdy5tb2R1bGVzLmRhdGFUcmVlLmluZGV4O1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRicmVhaztcblx0XHRcdH1cblxuXHRcdFx0ZXhwb3J0Um93cy5wdXNoKG5ldyBFeHBvcnRSb3cocm93LnR5cGUsIGV4cG9ydENvbHMsIHJvdy5nZXRDb21wb25lbnQoKSwgaW5kZW50KSk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gZXhwb3J0Um93cztcblx0fTtcblxuXHRFeHBvcnQucHJvdG90eXBlLmdlbmVyZWF0ZVRhYmxlRWxlbWVudCA9IGZ1bmN0aW9uIChsaXN0KSB7XG5cdFx0dmFyIF90aGlzNDkgPSB0aGlzO1xuXG5cdFx0dmFyIHRhYmxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRhYmxlXCIpLFxuXHRcdCAgICBoZWFkZXJFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0aGVhZFwiKSxcblx0XHQgICAgYm9keUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRib2R5XCIpLFxuXHRcdCAgICBzdHlsZXMgPSB0aGlzLmxvb2t1cFRhYmxlU3R5bGVzKCksXG5cdFx0ICAgIHJvd0Zvcm1hdHRlciA9IHRoaXMudGFibGUub3B0aW9uc1tcInJvd0Zvcm1hdHRlclwiICsgKHRoaXMuY29sVmlzUHJvcC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRoaXMuY29sVmlzUHJvcC5zbGljZSgxKSldLFxuXHRcdCAgICBzZXR1cCA9IHt9O1xuXG5cdFx0c2V0dXAucm93Rm9ybWF0dGVyID0gcm93Rm9ybWF0dGVyICE9PSBudWxsID8gcm93Rm9ybWF0dGVyIDogdGhpcy50YWJsZS5vcHRpb25zLnJvd0Zvcm1hdHRlcjtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuZGF0YVRyZWUgJiYgdGhpcy5jb25maWcuZGF0YVRyZWUgIT09IGZhbHNlICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiY29sdW1uQ2FsY3NcIikpIHtcblx0XHRcdHNldHVwLnRyZWVFbGVtZW50RmllbGQgPSB0aGlzLnRhYmxlLm1vZHVsZXMuZGF0YVRyZWUuZWxlbWVudEZpZWxkO1xuXHRcdH1cblxuXHRcdC8vYXNzaWduIGdyb3VwIGhlYWRlciBmb3JtYXR0ZXJcblx0XHRzZXR1cC5ncm91cEhlYWRlciA9IHRoaXMudGFibGUub3B0aW9uc1tcImdyb3VwSGVhZGVyXCIgKyAodGhpcy5jb2xWaXNQcm9wLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhpcy5jb2xWaXNQcm9wLnNsaWNlKDEpKV07XG5cblx0XHRpZiAoc2V0dXAuZ3JvdXBIZWFkZXIgJiYgIUFycmF5LmlzQXJyYXkoc2V0dXAuZ3JvdXBIZWFkZXIpKSB7XG5cdFx0XHRzZXR1cC5ncm91cEhlYWRlciA9IFtzZXR1cC5ncm91cEhlYWRlcl07XG5cdFx0fVxuXG5cdFx0dGFibGUuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wcmludC10YWJsZVwiKTtcblxuXHRcdHRoaXMubWFwRWxlbWVudFN0eWxlcyh0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0SGVhZGVyc0VsZW1lbnQoKSwgaGVhZGVyRWwsIFtcImJvcmRlci10b3BcIiwgXCJib3JkZXItbGVmdFwiLCBcImJvcmRlci1yaWdodFwiLCBcImJvcmRlci1ib3R0b21cIiwgXCJiYWNrZ3JvdW5kLWNvbG9yXCIsIFwiY29sb3JcIiwgXCJmb250LXdlaWdodFwiLCBcImZvbnQtZmFtaWx5XCIsIFwiZm9udC1zaXplXCJdKTtcblxuXHRcdGlmIChsaXN0Lmxlbmd0aCA+IDEwMDApIHtcblx0XHRcdGNvbnNvbGUud2FybihcIkl0IG1heSB0YWtlIGEgbG9uZyB0aW1lIHRvIHJlbmRlciBhbiBIVE1MIHRhYmxlIHdpdGggbW9yZSB0aGFuIDEwMDAgcm93c1wiKTtcblx0XHR9XG5cblx0XHRsaXN0LmZvckVhY2goZnVuY3Rpb24gKHJvdywgaSkge1xuXHRcdFx0c3dpdGNoIChyb3cudHlwZSkge1xuXHRcdFx0XHRjYXNlIFwiaGVhZGVyXCI6XG5cdFx0XHRcdFx0aGVhZGVyRWwuYXBwZW5kQ2hpbGQoX3RoaXM0OS5nZW5lcmVhdGVIZWFkZXJFbGVtZW50KHJvdywgc2V0dXAsIHN0eWxlcykpO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgXCJncm91cFwiOlxuXHRcdFx0XHRcdGJvZHlFbC5hcHBlbmRDaGlsZChfdGhpczQ5LmdlbmVyZWF0ZUdyb3VwRWxlbWVudChyb3csIHNldHVwLCBzdHlsZXMpKTtcblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRjYXNlIFwiY2FsY1wiOlxuXHRcdFx0XHRcdGJvZHlFbC5hcHBlbmRDaGlsZChfdGhpczQ5LmdlbmVyZWF0ZUNhbGNFbGVtZW50KHJvdywgc2V0dXAsIHN0eWxlcykpO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgXCJyb3dcIjpcblx0XHRcdFx0XHR2YXIgcm93RWwgPSBfdGhpczQ5LmdlbmVyZWF0ZVJvd0VsZW1lbnQocm93LCBzZXR1cCwgc3R5bGVzKTtcblx0XHRcdFx0XHRfdGhpczQ5Lm1hcEVsZW1lbnRTdHlsZXMoaSAlIDIgJiYgc3R5bGVzLmV2ZW5Sb3cgPyBzdHlsZXMuZXZlblJvdyA6IHN0eWxlcy5vZGRSb3csIHJvd0VsLCBbXCJib3JkZXItdG9wXCIsIFwiYm9yZGVyLWxlZnRcIiwgXCJib3JkZXItcmlnaHRcIiwgXCJib3JkZXItYm90dG9tXCIsIFwiY29sb3JcIiwgXCJmb250LXdlaWdodFwiLCBcImZvbnQtZmFtaWx5XCIsIFwiZm9udC1zaXplXCIsIFwiYmFja2dyb3VuZC1jb2xvclwiXSk7XG5cdFx0XHRcdFx0Ym9keUVsLmFwcGVuZENoaWxkKHJvd0VsKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGlmIChoZWFkZXJFbC5pbm5lckhUTUwpIHtcblx0XHRcdHRhYmxlLmFwcGVuZENoaWxkKGhlYWRlckVsKTtcblx0XHR9XG5cblx0XHR0YWJsZS5hcHBlbmRDaGlsZChib2R5RWwpO1xuXG5cdFx0dGhpcy5tYXBFbGVtZW50U3R5bGVzKHRoaXMudGFibGUuZWxlbWVudCwgdGFibGUsIFtcImJvcmRlci10b3BcIiwgXCJib3JkZXItbGVmdFwiLCBcImJvcmRlci1yaWdodFwiLCBcImJvcmRlci1ib3R0b21cIl0pO1xuXHRcdHJldHVybiB0YWJsZTtcblx0fTtcblxuXHRFeHBvcnQucHJvdG90eXBlLmxvb2t1cFRhYmxlU3R5bGVzID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBzdHlsZXMgPSB7fTtcblxuXHRcdC8vbG9va3VwIHJvdyBzdHlsZXNcblx0XHRpZiAodGhpcy5jbG9uZVRhYmxlU3R5bGUgJiYgd2luZG93LmdldENvbXB1dGVkU3R5bGUpIHtcblx0XHRcdHN0eWxlcy5vZGRSb3cgPSB0aGlzLnRhYmxlLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi50YWJ1bGF0b3Itcm93LW9kZDpub3QoLnRhYnVsYXRvci1ncm91cCk6bm90KC50YWJ1bGF0b3ItY2FsY3MpXCIpO1xuXHRcdFx0c3R5bGVzLmV2ZW5Sb3cgPSB0aGlzLnRhYmxlLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi50YWJ1bGF0b3Itcm93LWV2ZW46bm90KC50YWJ1bGF0b3ItZ3JvdXApOm5vdCgudGFidWxhdG9yLWNhbGNzKVwiKTtcblx0XHRcdHN0eWxlcy5jYWxjUm93ID0gdGhpcy50YWJsZS5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGFidWxhdG9yLXJvdy50YWJ1bGF0b3ItY2FsY3NcIik7XG5cdFx0XHRzdHlsZXMuZmlyc3RSb3cgPSB0aGlzLnRhYmxlLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi50YWJ1bGF0b3Itcm93Om5vdCgudGFidWxhdG9yLWdyb3VwKTpub3QoLnRhYnVsYXRvci1jYWxjcylcIik7XG5cdFx0XHRzdHlsZXMuZmlyc3RHcm91cCA9IHRoaXMudGFibGUuZWxlbWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwidGFidWxhdG9yLWdyb3VwXCIpWzBdO1xuXG5cdFx0XHRpZiAoc3R5bGVzLmZpcnN0Um93KSB7XG5cdFx0XHRcdHN0eWxlcy5zdHlsZUNlbGxzID0gc3R5bGVzLmZpcnN0Um93LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJ0YWJ1bGF0b3ItY2VsbFwiKTtcblx0XHRcdFx0c3R5bGVzLmZpcnN0Q2VsbCA9IHN0eWxlcy5zdHlsZUNlbGxzWzBdO1xuXHRcdFx0XHRzdHlsZXMubGFzdENlbGwgPSBzdHlsZXMuc3R5bGVDZWxsc1tzdHlsZXMuc3R5bGVDZWxscy5sZW5ndGggLSAxXTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gc3R5bGVzO1xuXHR9O1xuXG5cdEV4cG9ydC5wcm90b3R5cGUuZ2VuZXJlYXRlSGVhZGVyRWxlbWVudCA9IGZ1bmN0aW9uIChyb3csIHNldHVwLCBzdHlsZXMpIHtcblx0XHR2YXIgX3RoaXM1MCA9IHRoaXM7XG5cblx0XHR2YXIgcm93RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidHJcIik7XG5cblx0XHRyb3cuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdGlmIChjb2x1bW4pIHtcblx0XHRcdFx0dmFyIGNlbGxFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0aFwiKTtcblx0XHRcdFx0dmFyIGNsYXNzTmFtZXMgPSBjb2x1bW4uY29tcG9uZW50Ll9jb2x1bW4uZGVmaW5pdGlvbi5jc3NDbGFzcyA/IGNvbHVtbi5jb21wb25lbnQuX2NvbHVtbi5kZWZpbml0aW9uLmNzc0NsYXNzLnNwbGl0KFwiIFwiKSA6IFtdO1xuXG5cdFx0XHRcdGNlbGxFbC5jb2xTcGFuID0gY29sdW1uLndpZHRoO1xuXHRcdFx0XHRjZWxsRWwucm93U3BhbiA9IGNvbHVtbi5oZWlnaHQ7XG5cblx0XHRcdFx0Y2VsbEVsLmlubmVySFRNTCA9IGNvbHVtbi52YWx1ZTtcblxuXHRcdFx0XHRpZiAoX3RoaXM1MC5jbG9uZVRhYmxlU3R5bGUpIHtcblx0XHRcdFx0XHRjZWxsRWwuc3R5bGUuYm94U2l6aW5nID0gXCJib3JkZXItYm94XCI7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjbGFzc05hbWVzLmZvckVhY2goZnVuY3Rpb24gKGNsYXNzTmFtZSkge1xuXHRcdFx0XHRcdGNlbGxFbC5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdF90aGlzNTAubWFwRWxlbWVudFN0eWxlcyhjb2x1bW4uY29tcG9uZW50LmdldEVsZW1lbnQoKSwgY2VsbEVsLCBbXCJ0ZXh0LWFsaWduXCIsIFwiYm9yZGVyLXRvcFwiLCBcImJvcmRlci1sZWZ0XCIsIFwiYm9yZGVyLXJpZ2h0XCIsIFwiYm9yZGVyLWJvdHRvbVwiLCBcImJhY2tncm91bmQtY29sb3JcIiwgXCJjb2xvclwiLCBcImZvbnQtd2VpZ2h0XCIsIFwiZm9udC1mYW1pbHlcIiwgXCJmb250LXNpemVcIl0pO1xuXHRcdFx0XHRfdGhpczUwLm1hcEVsZW1lbnRTdHlsZXMoY29sdW1uLmNvbXBvbmVudC5fY29sdW1uLmNvbnRlbnRFbGVtZW50LCBjZWxsRWwsIFtcInBhZGRpbmctdG9wXCIsIFwicGFkZGluZy1sZWZ0XCIsIFwicGFkZGluZy1yaWdodFwiLCBcInBhZGRpbmctYm90dG9tXCJdKTtcblxuXHRcdFx0XHRpZiAoY29sdW1uLmNvbXBvbmVudC5fY29sdW1uLnZpc2libGUpIHtcblx0XHRcdFx0XHRfdGhpczUwLm1hcEVsZW1lbnRTdHlsZXMoY29sdW1uLmNvbXBvbmVudC5nZXRFbGVtZW50KCksIGNlbGxFbCwgW1wid2lkdGhcIl0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGlmIChjb2x1bW4uY29tcG9uZW50Ll9jb2x1bW4uZGVmaW5pdGlvbi53aWR0aCkge1xuXHRcdFx0XHRcdFx0Y2VsbEVsLnN0eWxlLndpZHRoID0gY29sdW1uLmNvbXBvbmVudC5fY29sdW1uLmRlZmluaXRpb24ud2lkdGggKyBcInB4XCI7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGNvbHVtbi5jb21wb25lbnQuX2NvbHVtbi5wYXJlbnQpIHtcblx0XHRcdFx0XHRfdGhpczUwLm1hcEVsZW1lbnRTdHlsZXMoY29sdW1uLmNvbXBvbmVudC5fY29sdW1uLnBhcmVudC5ncm91cEVsZW1lbnQsIGNlbGxFbCwgW1wiYm9yZGVyLXRvcFwiXSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyb3dFbC5hcHBlbmRDaGlsZChjZWxsRWwpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJvd0VsO1xuXHR9O1xuXG5cdEV4cG9ydC5wcm90b3R5cGUuZ2VuZXJlYXRlR3JvdXBFbGVtZW50ID0gZnVuY3Rpb24gKHJvdywgc2V0dXAsIHN0eWxlcykge1xuXG5cdFx0dmFyIHJvd0VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRyXCIpLFxuXHRcdCAgICBjZWxsRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGRcIiksXG5cdFx0ICAgIGdyb3VwID0gcm93LmNvbHVtbnNbMF07XG5cblx0XHRyb3dFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXByaW50LXRhYmxlLXJvd1wiKTtcblxuXHRcdGlmIChzZXR1cC5ncm91cEhlYWRlciAmJiBzZXR1cC5ncm91cEhlYWRlcltyb3cuaW5kZW50XSkge1xuXHRcdFx0Z3JvdXAudmFsdWUgPSBzZXR1cC5ncm91cEhlYWRlcltyb3cuaW5kZW50XShncm91cC52YWx1ZSwgcm93LmNvbXBvbmVudC5fZ3JvdXAuZ2V0Um93Q291bnQoKSwgcm93LmNvbXBvbmVudC5fZ3JvdXAuZ2V0RGF0YSgpLCByb3cuY29tcG9uZW50KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYgKHNldHVwLmdyb3VwSGVhZGVyID09PSBmYWxzZSkge1xuXHRcdFx0XHRncm91cC52YWx1ZSA9IGdyb3VwLnZhbHVlO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3JvdXAudmFsdWUgPSByb3cuY29tcG9uZW50Ll9ncm91cC5nZW5lcmF0b3IoZ3JvdXAudmFsdWUsIHJvdy5jb21wb25lbnQuX2dyb3VwLmdldFJvd0NvdW50KCksIHJvdy5jb21wb25lbnQuX2dyb3VwLmdldERhdGEoKSwgcm93LmNvbXBvbmVudCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Y2VsbEVsLmNvbFNwYW4gPSBncm91cC53aWR0aDtcblx0XHRjZWxsRWwuaW5uZXJIVE1MID0gZ3JvdXAudmFsdWU7XG5cblx0XHRyb3dFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXByaW50LXRhYmxlLWdyb3VwXCIpO1xuXHRcdHJvd0VsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZ3JvdXAtbGV2ZWwtXCIgKyByb3cuaW5kZW50KTtcblxuXHRcdGlmIChncm91cC5jb21wb25lbnQuZ2V0VmlzaWJpbGl0eSgpKSB7XG5cdFx0XHRyb3dFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWdyb3VwLXZpc2libGVcIik7XG5cdFx0fVxuXG5cdFx0dGhpcy5tYXBFbGVtZW50U3R5bGVzKHN0eWxlcy5maXJzdEdyb3VwLCByb3dFbCwgW1wiYm9yZGVyLXRvcFwiLCBcImJvcmRlci1sZWZ0XCIsIFwiYm9yZGVyLXJpZ2h0XCIsIFwiYm9yZGVyLWJvdHRvbVwiLCBcImNvbG9yXCIsIFwiZm9udC13ZWlnaHRcIiwgXCJmb250LWZhbWlseVwiLCBcImZvbnQtc2l6ZVwiLCBcImJhY2tncm91bmQtY29sb3JcIl0pO1xuXHRcdHRoaXMubWFwRWxlbWVudFN0eWxlcyhzdHlsZXMuZmlyc3RHcm91cCwgY2VsbEVsLCBbXCJwYWRkaW5nLXRvcFwiLCBcInBhZGRpbmctbGVmdFwiLCBcInBhZGRpbmctcmlnaHRcIiwgXCJwYWRkaW5nLWJvdHRvbVwiXSk7XG5cblx0XHRyb3dFbC5hcHBlbmRDaGlsZChjZWxsRWwpO1xuXG5cdFx0cmV0dXJuIHJvd0VsO1xuXHR9O1xuXG5cdEV4cG9ydC5wcm90b3R5cGUuZ2VuZXJlYXRlQ2FsY0VsZW1lbnQgPSBmdW5jdGlvbiAocm93LCBzZXR1cCwgc3R5bGVzKSB7XG5cdFx0dmFyIHJvd0VsID0gdGhpcy5nZW5lcmVhdGVSb3dFbGVtZW50KHJvdywgc2V0dXAsIHN0eWxlcyk7XG5cblx0XHRyb3dFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXByaW50LXRhYmxlLWNhbGNzXCIpO1xuXHRcdHRoaXMubWFwRWxlbWVudFN0eWxlcyhzdHlsZXMuY2FsY1Jvdywgcm93RWwsIFtcImJvcmRlci10b3BcIiwgXCJib3JkZXItbGVmdFwiLCBcImJvcmRlci1yaWdodFwiLCBcImJvcmRlci1ib3R0b21cIiwgXCJjb2xvclwiLCBcImZvbnQtd2VpZ2h0XCIsIFwiZm9udC1mYW1pbHlcIiwgXCJmb250LXNpemVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yXCJdKTtcblxuXHRcdHJldHVybiByb3dFbDtcblx0fTtcblxuXHRFeHBvcnQucHJvdG90eXBlLmdlbmVyZWF0ZVJvd0VsZW1lbnQgPSBmdW5jdGlvbiAocm93LCBzZXR1cCwgc3R5bGVzKSB7XG5cdFx0dmFyIF90aGlzNTEgPSB0aGlzO1xuXG5cdFx0dmFyIHJvd0VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRyXCIpO1xuXG5cdFx0cm93RWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wcmludC10YWJsZS1yb3dcIik7XG5cblx0XHRyb3cuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2wpIHtcblxuXHRcdFx0aWYgKGNvbCkge1xuXHRcdFx0XHR2YXIgY2VsbEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRkXCIpLFxuXHRcdFx0XHQgICAgY29sdW1uID0gY29sLmNvbXBvbmVudC5fY29sdW1uLFxuXHRcdFx0XHQgICAgdmFsdWUgPSBjb2wudmFsdWU7XG5cblx0XHRcdFx0dmFyIGNlbGxXcmFwcGVyID0ge1xuXHRcdFx0XHRcdG1vZHVsZXM6IHt9LFxuXHRcdFx0XHRcdGdldFZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdGdldEZpZWxkOiBmdW5jdGlvbiBnZXRGaWVsZCgpIHtcblx0XHRcdFx0XHRcdHJldHVybiBjb2x1bW4uZGVmaW5pdGlvbi5maWVsZDtcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdGdldEVsZW1lbnQ6IGZ1bmN0aW9uIGdldEVsZW1lbnQoKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gY2VsbEVsO1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0Z2V0Q29sdW1uOiBmdW5jdGlvbiBnZXRDb2x1bW4oKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gY29sdW1uLmdldENvbXBvbmVudCgpO1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0Z2V0RGF0YTogZnVuY3Rpb24gZ2V0RGF0YSgpIHtcblx0XHRcdFx0XHRcdHJldHVybiByb3dEYXRhO1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0Z2V0Um93OiBmdW5jdGlvbiBnZXRSb3coKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gcm93LmdldENvbXBvbmVudCgpO1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0Z2V0Q29tcG9uZW50OiBmdW5jdGlvbiBnZXRDb21wb25lbnQoKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gY2VsbFdyYXBwZXI7XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRjb2x1bW46IGNvbHVtblxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdHZhciBjbGFzc05hbWVzID0gY29sdW1uLmRlZmluaXRpb24uY3NzQ2xhc3MgPyBjb2x1bW4uZGVmaW5pdGlvbi5jc3NDbGFzcy5zcGxpdChcIiBcIikgOiBbXTtcblxuXHRcdFx0XHRjbGFzc05hbWVzLmZvckVhY2goZnVuY3Rpb24gKGNsYXNzTmFtZSkge1xuXHRcdFx0XHRcdGNlbGxFbC5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGlmIChfdGhpczUxLnRhYmxlLm1vZEV4aXN0cyhcImZvcm1hdFwiKSAmJiBfdGhpczUxLmNvbmZpZy5mb3JtYXRDZWxscyAhPT0gZmFsc2UpIHtcblx0XHRcdFx0XHR2YWx1ZSA9IF90aGlzNTEudGFibGUubW9kdWxlcy5mb3JtYXQuZm9ybWF0RXhwb3J0VmFsdWUoY2VsbFdyYXBwZXIsIF90aGlzNTEuY29sVmlzUHJvcCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c3dpdGNoICh0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKHZhbHVlKSkge1xuXHRcdFx0XHRcdFx0Y2FzZSBcIm9iamVjdFwiOlxuXHRcdFx0XHRcdFx0XHR2YWx1ZSA9IEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdGNhc2UgXCJ1bmRlZmluZWRcIjpcblx0XHRcdFx0XHRcdGNhc2UgXCJudWxsXCI6XG5cdFx0XHRcdFx0XHRcdHZhbHVlID0gXCJcIjtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHRcdHZhbHVlID0gdmFsdWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHZhbHVlIGluc3RhbmNlb2YgTm9kZSkge1xuXHRcdFx0XHRcdGNlbGxFbC5hcHBlbmRDaGlsZCh2YWx1ZSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y2VsbEVsLmlubmVySFRNTCA9IHZhbHVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHN0eWxlcy5maXJzdENlbGwpIHtcblx0XHRcdFx0XHRfdGhpczUxLm1hcEVsZW1lbnRTdHlsZXMoc3R5bGVzLmZpcnN0Q2VsbCwgY2VsbEVsLCBbXCJwYWRkaW5nLXRvcFwiLCBcInBhZGRpbmctbGVmdFwiLCBcInBhZGRpbmctcmlnaHRcIiwgXCJwYWRkaW5nLWJvdHRvbVwiLCBcImJvcmRlci10b3BcIiwgXCJib3JkZXItbGVmdFwiLCBcImJvcmRlci1yaWdodFwiLCBcImJvcmRlci1ib3R0b21cIiwgXCJjb2xvclwiLCBcImZvbnQtd2VpZ2h0XCIsIFwiZm9udC1mYW1pbHlcIiwgXCJmb250LXNpemVcIl0pO1xuXG5cdFx0XHRcdFx0aWYgKGNvbHVtbi5kZWZpbml0aW9uLmFsaWduKSB7XG5cdFx0XHRcdFx0XHRjZWxsRWwuc3R5bGUudGV4dEFsaWduID0gY29sdW1uLmRlZmluaXRpb24uYWxpZ247XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKF90aGlzNTEudGFibGUub3B0aW9ucy5kYXRhVHJlZSAmJiBfdGhpczUxLmNvbmZpZy5kYXRhVHJlZSAhPT0gZmFsc2UpIHtcblx0XHRcdFx0XHRpZiAoc2V0dXAudHJlZUVsZW1lbnRGaWVsZCAmJiBzZXR1cC50cmVlRWxlbWVudEZpZWxkID09IGNvbHVtbi5maWVsZCB8fCAhc2V0dXAudHJlZUVsZW1lbnRGaWVsZCAmJiBpID09IDApIHtcblx0XHRcdFx0XHRcdGlmIChyb3cuY29tcG9uZW50Ll9yb3cubW9kdWxlcy5kYXRhVHJlZS5jb250cm9sRWwpIHtcblx0XHRcdFx0XHRcdFx0Y2VsbEVsLmluc2VydEJlZm9yZShyb3cuY29tcG9uZW50Ll9yb3cubW9kdWxlcy5kYXRhVHJlZS5jb250cm9sRWwuY2xvbmVOb2RlKHRydWUpLCBjZWxsRWwuZmlyc3RDaGlsZCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRpZiAocm93LmNvbXBvbmVudC5fcm93Lm1vZHVsZXMuZGF0YVRyZWUuYnJhbmNoRWwpIHtcblx0XHRcdFx0XHRcdFx0Y2VsbEVsLmluc2VydEJlZm9yZShyb3cuY29tcG9uZW50Ll9yb3cubW9kdWxlcy5kYXRhVHJlZS5icmFuY2hFbC5jbG9uZU5vZGUodHJ1ZSksIGNlbGxFbC5maXJzdENoaWxkKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyb3dFbC5hcHBlbmRDaGlsZChjZWxsRWwpO1xuXG5cdFx0XHRcdGlmIChjZWxsV3JhcHBlci5tb2R1bGVzLmZvcm1hdCAmJiBjZWxsV3JhcHBlci5tb2R1bGVzLmZvcm1hdC5yZW5kZXJlZENhbGxiYWNrKSB7XG5cdFx0XHRcdFx0Y2VsbFdyYXBwZXIubW9kdWxlcy5mb3JtYXQucmVuZGVyZWRDYWxsYmFjaygpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHNldHVwLnJvd0Zvcm1hdHRlciAmJiBfdGhpczUxLmNvbmZpZy5mb3JtYXRDZWxscyAhPT0gZmFsc2UpIHtcblx0XHRcdFx0XHR2YXIgcm93Q29tcG9uZW50ID0gcm93LmdldENvbXBvbmVudCgpO1xuXG5cdFx0XHRcdFx0cm93Q29tcG9uZW50LmdldEVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gcm93RWw7XG5cdFx0XHRcdFx0fTtcblxuXHRcdFx0XHRcdHNldHVwLnJvd0Zvcm1hdHRlcihyb3dDb21wb25lbnQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcm93RWw7XG5cdH07XG5cblx0RXhwb3J0LnByb3RvdHlwZS5nZW5lcmVhdGVIVE1MVGFibGUgPSBmdW5jdGlvbiAobGlzdCkge1xuXHRcdHZhciBob2xkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG5cdFx0aG9sZGVyLmFwcGVuZENoaWxkKHRoaXMuZ2VuZXJlYXRlVGFibGVFbGVtZW50KGxpc3QpKTtcblxuXHRcdHJldHVybiBob2xkZXIuaW5uZXJIVE1MO1xuXHR9O1xuXG5cdEV4cG9ydC5wcm90b3R5cGUuZ2V0SHRtbCA9IGZ1bmN0aW9uICh2aXNpYmxlLCBzdHlsZSwgY29uZmlnLCBjb2xWaXNQcm9wKSB7XG5cdFx0dmFyIGxpc3QgPSB0aGlzLmdlbmVyYXRlRXhwb3J0TGlzdChjb25maWcgfHwgdGhpcy50YWJsZS5vcHRpb25zLmh0bWxPdXRwdXRDb25maWcsIHN0eWxlLCB2aXNpYmxlLCBjb2xWaXNQcm9wIHx8IFwiaHRtbE91dHB1dFwiKTtcblxuXHRcdHJldHVybiB0aGlzLmdlbmVyZWF0ZUhUTUxUYWJsZShsaXN0KTtcblx0fTtcblxuXHRFeHBvcnQucHJvdG90eXBlLm1hcEVsZW1lbnRTdHlsZXMgPSBmdW5jdGlvbiAoZnJvbSwgdG8sIHByb3BzKSB7XG5cdFx0aWYgKHRoaXMuY2xvbmVUYWJsZVN0eWxlICYmIGZyb20gJiYgdG8pIHtcblxuXHRcdFx0dmFyIGxvb2t1cCA9IHtcblx0XHRcdFx0XCJiYWNrZ3JvdW5kLWNvbG9yXCI6IFwiYmFja2dyb3VuZENvbG9yXCIsXG5cdFx0XHRcdFwiY29sb3JcIjogXCJmb250Q29sb3JcIixcblx0XHRcdFx0XCJ3aWR0aFwiOiBcIndpZHRoXCIsXG5cdFx0XHRcdFwiZm9udC13ZWlnaHRcIjogXCJmb250V2VpZ2h0XCIsXG5cdFx0XHRcdFwiZm9udC1mYW1pbHlcIjogXCJmb250RmFtaWx5XCIsXG5cdFx0XHRcdFwiZm9udC1zaXplXCI6IFwiZm9udFNpemVcIixcblx0XHRcdFx0XCJ0ZXh0LWFsaWduXCI6IFwidGV4dEFsaWduXCIsXG5cdFx0XHRcdFwiYm9yZGVyLXRvcFwiOiBcImJvcmRlclRvcFwiLFxuXHRcdFx0XHRcImJvcmRlci1sZWZ0XCI6IFwiYm9yZGVyTGVmdFwiLFxuXHRcdFx0XHRcImJvcmRlci1yaWdodFwiOiBcImJvcmRlclJpZ2h0XCIsXG5cdFx0XHRcdFwiYm9yZGVyLWJvdHRvbVwiOiBcImJvcmRlckJvdHRvbVwiLFxuXHRcdFx0XHRcInBhZGRpbmctdG9wXCI6IFwicGFkZGluZ1RvcFwiLFxuXHRcdFx0XHRcInBhZGRpbmctbGVmdFwiOiBcInBhZGRpbmdMZWZ0XCIsXG5cdFx0XHRcdFwicGFkZGluZy1yaWdodFwiOiBcInBhZGRpbmdSaWdodFwiLFxuXHRcdFx0XHRcInBhZGRpbmctYm90dG9tXCI6IFwicGFkZGluZ0JvdHRvbVwiXG5cdFx0XHR9O1xuXG5cdFx0XHRpZiAod2luZG93LmdldENvbXB1dGVkU3R5bGUpIHtcblx0XHRcdFx0dmFyIGZyb21TdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGZyb20pO1xuXG5cdFx0XHRcdHByb3BzLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHtcblx0XHRcdFx0XHR0by5zdHlsZVtsb29rdXBbcHJvcF1dID0gZnJvbVN0eWxlLmdldFByb3BlcnR5VmFsdWUocHJvcCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnJlZ2lzdGVyTW9kdWxlKFwiZXhwb3J0XCIsIEV4cG9ydCk7XG5cblx0dmFyIEZpbHRlciA9IGZ1bmN0aW9uIEZpbHRlcih0YWJsZSkge1xuXG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlOyAvL2hvbGQgVGFidWxhdG9yIG9iamVjdFxuXG5cdFx0dGhpcy5maWx0ZXJMaXN0ID0gW107IC8vaG9sZCBmaWx0ZXIgbGlzdFxuXHRcdHRoaXMuaGVhZGVyRmlsdGVycyA9IHt9OyAvL2hvbGQgY29sdW1uIGZpbHRlcnNcblx0XHR0aGlzLmhlYWRlckZpbHRlckNvbHVtbnMgPSBbXTsgLy9ob2xkIGNvbHVtbnMgdGhhdCB1c2UgaGVhZGVyIGZpbHRlcnNcblxuXHRcdHRoaXMucHJldkhlYWRlckZpbHRlckNoYW5nZUNoZWNrID0gXCJcIjtcblx0XHR0aGlzLnByZXZIZWFkZXJGaWx0ZXJDaGFuZ2VDaGVjayA9IFwie31cIjtcblxuXHRcdHRoaXMuY2hhbmdlZCA9IGZhbHNlOyAvL2hhcyBmaWx0ZXJpbmcgY2hhbmdlZCBzaW5jZSBsYXN0IHJlbmRlclxuXHR9O1xuXG5cdC8vaW5pdGlhbGl6ZSBjb2x1bW4gaGVhZGVyIGZpbHRlclxuXHRGaWx0ZXIucHJvdG90eXBlLmluaXRpYWxpemVDb2x1bW4gPSBmdW5jdGlvbiAoY29sdW1uLCB2YWx1ZSkge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgZmllbGQgPSBjb2x1bW4uZ2V0RmllbGQoKSxcblx0XHQgICAgcGFyYW1zO1xuXG5cdFx0Ly9oYW5kbGUgc3VjY2Vzc2Z1bGwgdmFsdWUgY2hhbmdlXG5cdFx0ZnVuY3Rpb24gc3VjY2Vzcyh2YWx1ZSkge1xuXHRcdFx0dmFyIGZpbHRlclR5cGUgPSBjb2x1bW4ubW9kdWxlcy5maWx0ZXIudGFnVHlwZSA9PSBcImlucHV0XCIgJiYgY29sdW1uLm1vZHVsZXMuZmlsdGVyLmF0dHJUeXBlID09IFwidGV4dFwiIHx8IGNvbHVtbi5tb2R1bGVzLmZpbHRlci50YWdUeXBlID09IFwidGV4dGFyZWFcIiA/IFwicGFydGlhbFwiIDogXCJtYXRjaFwiLFxuXHRcdFx0ICAgIHR5cGUgPSBcIlwiLFxuXHRcdFx0ICAgIGZpbHRlckNoYW5nZUNoZWNrID0gXCJcIixcblx0XHRcdCAgICBmaWx0ZXJGdW5jO1xuXG5cdFx0XHRpZiAodHlwZW9mIGNvbHVtbi5tb2R1bGVzLmZpbHRlci5wcmV2U3VjY2VzcyA9PT0gXCJ1bmRlZmluZWRcIiB8fCBjb2x1bW4ubW9kdWxlcy5maWx0ZXIucHJldlN1Y2Nlc3MgIT09IHZhbHVlKSB7XG5cblx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuZmlsdGVyLnByZXZTdWNjZXNzID0gdmFsdWU7XG5cblx0XHRcdFx0aWYgKCFjb2x1bW4ubW9kdWxlcy5maWx0ZXIuZW1wdHlGdW5jKHZhbHVlKSkge1xuXHRcdFx0XHRcdGNvbHVtbi5tb2R1bGVzLmZpbHRlci52YWx1ZSA9IHZhbHVlO1xuXG5cdFx0XHRcdFx0c3dpdGNoIChfdHlwZW9mKGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlckZ1bmMpKSB7XG5cdFx0XHRcdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdFx0XHRcdGlmIChzZWxmLmZpbHRlcnNbY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyRnVuY10pIHtcblx0XHRcdFx0XHRcdFx0XHR0eXBlID0gY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyRnVuYztcblx0XHRcdFx0XHRcdFx0XHRmaWx0ZXJGdW5jID0gZnVuY3Rpb24gZmlsdGVyRnVuYyhkYXRhKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHR2YXIgcGFyYW1zID0gY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyRnVuY1BhcmFtcyB8fCB7fTtcblx0XHRcdFx0XHRcdFx0XHRcdHZhciBmaWVsZFZhbCA9IGNvbHVtbi5nZXRGaWVsZFZhbHVlKGRhdGEpO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRwYXJhbXMgPSB0eXBlb2YgcGFyYW1zID09PSBcImZ1bmN0aW9uXCIgPyBwYXJhbXModmFsdWUsIGZpZWxkVmFsLCBkYXRhKSA6IHBhcmFtcztcblxuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHNlbGYuZmlsdGVyc1tjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXJGdW5jXSh2YWx1ZSwgZmllbGRWYWwsIGRhdGEsIHBhcmFtcyk7XG5cdFx0XHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJIZWFkZXIgRmlsdGVyIEVycm9yIC0gTWF0Y2hpbmcgZmlsdGVyIGZ1bmN0aW9uIG5vdCBmb3VuZDogXCIsIGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlckZ1bmMpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0XHRcdFx0ZmlsdGVyRnVuYyA9IGZ1bmN0aW9uIGZpbHRlckZ1bmMoZGF0YSkge1xuXHRcdFx0XHRcdFx0XHRcdHZhciBwYXJhbXMgPSBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXJGdW5jUGFyYW1zIHx8IHt9O1xuXHRcdFx0XHRcdFx0XHRcdHZhciBmaWVsZFZhbCA9IGNvbHVtbi5nZXRGaWVsZFZhbHVlKGRhdGEpO1xuXG5cdFx0XHRcdFx0XHRcdFx0cGFyYW1zID0gdHlwZW9mIHBhcmFtcyA9PT0gXCJmdW5jdGlvblwiID8gcGFyYW1zKHZhbHVlLCBmaWVsZFZhbCwgZGF0YSkgOiBwYXJhbXM7XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyRnVuYyh2YWx1ZSwgZmllbGRWYWwsIGRhdGEsIHBhcmFtcyk7XG5cdFx0XHRcdFx0XHRcdH07XG5cblx0XHRcdFx0XHRcdFx0dHlwZSA9IGZpbHRlckZ1bmM7XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICghZmlsdGVyRnVuYykge1xuXHRcdFx0XHRcdFx0c3dpdGNoIChmaWx0ZXJUeXBlKSB7XG5cdFx0XHRcdFx0XHRcdGNhc2UgXCJwYXJ0aWFsXCI6XG5cdFx0XHRcdFx0XHRcdFx0ZmlsdGVyRnVuYyA9IGZ1bmN0aW9uIGZpbHRlckZ1bmMoZGF0YSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIGNvbFZhbCA9IGNvbHVtbi5nZXRGaWVsZFZhbHVlKGRhdGEpO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbFZhbCAhPT0gJ3VuZGVmaW5lZCcgJiYgY29sVmFsICE9PSBudWxsKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBTdHJpbmcoY29sVmFsKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoU3RyaW5nKHZhbHVlKS50b0xvd2VyQ2FzZSgpKSA+IC0xO1xuXHRcdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XHRcdFx0dHlwZSA9IFwibGlrZVwiO1xuXHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHRcdFx0ZmlsdGVyRnVuYyA9IGZ1bmN0aW9uIGZpbHRlckZ1bmMoZGF0YSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGNvbHVtbi5nZXRGaWVsZFZhbHVlKGRhdGEpID09IHZhbHVlO1xuXHRcdFx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XHRcdFx0dHlwZSA9IFwiPVwiO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHNlbGYuaGVhZGVyRmlsdGVyc1tmaWVsZF0gPSB7IHZhbHVlOiB2YWx1ZSwgZnVuYzogZmlsdGVyRnVuYywgdHlwZTogdHlwZSwgcGFyYW1zOiBwYXJhbXMgfHwge30gfTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRkZWxldGUgc2VsZi5oZWFkZXJGaWx0ZXJzW2ZpZWxkXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGZpbHRlckNoYW5nZUNoZWNrID0gSlNPTi5zdHJpbmdpZnkoc2VsZi5oZWFkZXJGaWx0ZXJzKTtcblxuXHRcdFx0XHRpZiAoc2VsZi5wcmV2SGVhZGVyRmlsdGVyQ2hhbmdlQ2hlY2sgIT09IGZpbHRlckNoYW5nZUNoZWNrKSB7XG5cdFx0XHRcdFx0c2VsZi5wcmV2SGVhZGVyRmlsdGVyQ2hhbmdlQ2hlY2sgPSBmaWx0ZXJDaGFuZ2VDaGVjaztcblxuXHRcdFx0XHRcdHNlbGYuY2hhbmdlZCA9IHRydWU7XG5cdFx0XHRcdFx0c2VsZi50YWJsZS5yb3dNYW5hZ2VyLmZpbHRlclJlZnJlc2goKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cblx0XHRjb2x1bW4ubW9kdWxlcy5maWx0ZXIgPSB7XG5cdFx0XHRzdWNjZXNzOiBzdWNjZXNzLFxuXHRcdFx0YXR0clR5cGU6IGZhbHNlLFxuXHRcdFx0dGFnVHlwZTogZmFsc2UsXG5cdFx0XHRlbXB0eUZ1bmM6IGZhbHNlXG5cdFx0fTtcblxuXHRcdHRoaXMuZ2VuZXJhdGVIZWFkZXJGaWx0ZXJFbGVtZW50KGNvbHVtbik7XG5cdH07XG5cblx0RmlsdGVyLnByb3RvdHlwZS5nZW5lcmF0ZUhlYWRlckZpbHRlckVsZW1lbnQgPSBmdW5jdGlvbiAoY29sdW1uLCBpbml0aWFsVmFsdWUsIHJlaW5pdGlhbGl6ZSkge1xuXHRcdHZhciBfdGhpczUyID0gdGhpcztcblxuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgc3VjY2VzcyA9IGNvbHVtbi5tb2R1bGVzLmZpbHRlci5zdWNjZXNzLFxuXHRcdCAgICBmaWVsZCA9IGNvbHVtbi5nZXRGaWVsZCgpLFxuXHRcdCAgICBmaWx0ZXJFbGVtZW50LFxuXHRcdCAgICBlZGl0b3IsXG5cdFx0ICAgIGVkaXRvckVsZW1lbnQsXG5cdFx0ICAgIGNlbGxXcmFwcGVyLFxuXHRcdCAgICB0eXBpbmdUaW1lcixcblx0XHQgICAgc2VhcmNoVHJpZ2dlcixcblx0XHQgICAgcGFyYW1zO1xuXG5cdFx0Ly9oYW5kbGUgYWJvcnRlZCBlZGl0XG5cdFx0ZnVuY3Rpb24gY2FuY2VsKCkge31cblxuXHRcdGlmIChjb2x1bW4ubW9kdWxlcy5maWx0ZXIuaGVhZGVyRWxlbWVudCAmJiBjb2x1bW4ubW9kdWxlcy5maWx0ZXIuaGVhZGVyRWxlbWVudC5wYXJlbnROb2RlKSB7XG5cdFx0XHRjb2x1bW4uY29udGVudEVsZW1lbnQucmVtb3ZlQ2hpbGQoY29sdW1uLm1vZHVsZXMuZmlsdGVyLmhlYWRlckVsZW1lbnQucGFyZW50Tm9kZSk7XG5cdFx0fVxuXG5cdFx0aWYgKGZpZWxkKSB7XG5cblx0XHRcdC8vc2V0IGVtcHR5IHZhbHVlIGZ1bmN0aW9uXG5cdFx0XHRjb2x1bW4ubW9kdWxlcy5maWx0ZXIuZW1wdHlGdW5jID0gY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyRW1wdHlDaGVjayB8fCBmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRcdFx0cmV0dXJuICF2YWx1ZSAmJiB2YWx1ZSAhPT0gXCIwXCI7XG5cdFx0XHR9O1xuXG5cdFx0XHRmaWx0ZXJFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcdGZpbHRlckVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1oZWFkZXItZmlsdGVyXCIpO1xuXG5cdFx0XHQvL3NldCBjb2x1bW4gZWRpdG9yXG5cdFx0XHRzd2l0Y2ggKF90eXBlb2YoY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyKSkge1xuXHRcdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdFx0aWYgKHNlbGYudGFibGUubW9kdWxlcy5lZGl0LmVkaXRvcnNbY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyXSkge1xuXHRcdFx0XHRcdFx0ZWRpdG9yID0gc2VsZi50YWJsZS5tb2R1bGVzLmVkaXQuZWRpdG9yc1tjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXJdO1xuXG5cdFx0XHRcdFx0XHRpZiAoKGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlciA9PT0gXCJ0aWNrXCIgfHwgY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyID09PSBcInRpY2tDcm9zc1wiKSAmJiAhY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyRW1wdHlDaGVjaykge1xuXHRcdFx0XHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5maWx0ZXIuZW1wdHlGdW5jID0gZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlICE9PSB0cnVlICYmIHZhbHVlICE9PSBmYWxzZTtcblx0XHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiRmlsdGVyIEVycm9yIC0gQ2Fubm90IGJ1aWxkIGhlYWRlciBmaWx0ZXIsIE5vIHN1Y2ggZWRpdG9yIGZvdW5kOiBcIiwgY29sdW1uLmRlZmluaXRpb24uZWRpdG9yKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSBcImZ1bmN0aW9uXCI6XG5cdFx0XHRcdFx0ZWRpdG9yID0gY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgXCJib29sZWFuXCI6XG5cdFx0XHRcdFx0aWYgKGNvbHVtbi5tb2R1bGVzLmVkaXQgJiYgY29sdW1uLm1vZHVsZXMuZWRpdC5lZGl0b3IpIHtcblx0XHRcdFx0XHRcdGVkaXRvciA9IGNvbHVtbi5tb2R1bGVzLmVkaXQuZWRpdG9yO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRpZiAoY29sdW1uLmRlZmluaXRpb24uZm9ybWF0dGVyICYmIHNlbGYudGFibGUubW9kdWxlcy5lZGl0LmVkaXRvcnNbY29sdW1uLmRlZmluaXRpb24uZm9ybWF0dGVyXSkge1xuXHRcdFx0XHRcdFx0XHRlZGl0b3IgPSBzZWxmLnRhYmxlLm1vZHVsZXMuZWRpdC5lZGl0b3JzW2NvbHVtbi5kZWZpbml0aW9uLmZvcm1hdHRlcl07XG5cblx0XHRcdFx0XHRcdFx0aWYgKChjb2x1bW4uZGVmaW5pdGlvbi5mb3JtYXR0ZXIgPT09IFwidGlja1wiIHx8IGNvbHVtbi5kZWZpbml0aW9uLmZvcm1hdHRlciA9PT0gXCJ0aWNrQ3Jvc3NcIikgJiYgIWNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlckVtcHR5Q2hlY2spIHtcblx0XHRcdFx0XHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5maWx0ZXIuZW1wdHlGdW5jID0gZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWUgIT09IHRydWUgJiYgdmFsdWUgIT09IGZhbHNlO1xuXHRcdFx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGVkaXRvciA9IHNlbGYudGFibGUubW9kdWxlcy5lZGl0LmVkaXRvcnNbXCJpbnB1dFwiXTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChlZGl0b3IpIHtcblxuXHRcdFx0XHRjZWxsV3JhcHBlciA9IHtcblx0XHRcdFx0XHRnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUoKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdHlwZW9mIGluaXRpYWxWYWx1ZSAhPT0gXCJ1bmRlZmluZWRcIiA/IGluaXRpYWxWYWx1ZSA6IFwiXCI7XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRnZXRGaWVsZDogZnVuY3Rpb24gZ2V0RmllbGQoKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gY29sdW1uLmRlZmluaXRpb24uZmllbGQ7XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRnZXRFbGVtZW50OiBmdW5jdGlvbiBnZXRFbGVtZW50KCkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGZpbHRlckVsZW1lbnQ7XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRnZXRDb2x1bW46IGZ1bmN0aW9uIGdldENvbHVtbigpIHtcblx0XHRcdFx0XHRcdHJldHVybiBjb2x1bW4uZ2V0Q29tcG9uZW50KCk7XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRnZXRSb3c6IGZ1bmN0aW9uIGdldFJvdygpIHtcblx0XHRcdFx0XHRcdHJldHVybiB7XG5cdFx0XHRcdFx0XHRcdG5vcm1hbGl6ZUhlaWdodDogZnVuY3Rpb24gbm9ybWFsaXplSGVpZ2h0KCkge31cblx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdHBhcmFtcyA9IGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlclBhcmFtcyB8fCB7fTtcblxuXHRcdFx0XHRwYXJhbXMgPSB0eXBlb2YgcGFyYW1zID09PSBcImZ1bmN0aW9uXCIgPyBwYXJhbXMuY2FsbChzZWxmLnRhYmxlKSA6IHBhcmFtcztcblxuXHRcdFx0XHRlZGl0b3JFbGVtZW50ID0gZWRpdG9yLmNhbGwodGhpcy50YWJsZS5tb2R1bGVzLmVkaXQsIGNlbGxXcmFwcGVyLCBmdW5jdGlvbiAoKSB7fSwgc3VjY2VzcywgY2FuY2VsLCBwYXJhbXMpO1xuXG5cdFx0XHRcdGlmICghZWRpdG9yRWxlbWVudCkge1xuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkZpbHRlciBFcnJvciAtIENhbm5vdCBhZGQgZmlsdGVyIHRvIFwiICsgZmllbGQgKyBcIiBjb2x1bW4sIGVkaXRvciByZXR1cm5lZCBhIHZhbHVlIG9mIGZhbHNlXCIpO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICghKGVkaXRvckVsZW1lbnQgaW5zdGFuY2VvZiBOb2RlKSkge1xuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkZpbHRlciBFcnJvciAtIENhbm5vdCBhZGQgZmlsdGVyIHRvIFwiICsgZmllbGQgKyBcIiBjb2x1bW4sIGVkaXRvciBzaG91bGQgcmV0dXJuIGFuIGluc3RhbmNlIG9mIE5vZGUsIHRoZSBlZGl0b3IgcmV0dXJuZWQ6XCIsIGVkaXRvckVsZW1lbnQpO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vc2V0IFBsYWNlaG9sZGVyIFRleHRcblx0XHRcdFx0aWYgKGZpZWxkKSB7XG5cdFx0XHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLmxvY2FsaXplLmJpbmQoXCJoZWFkZXJGaWx0ZXJzfGNvbHVtbnN8XCIgKyBjb2x1bW4uZGVmaW5pdGlvbi5maWVsZCwgZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0XHRcdFx0XHRlZGl0b3JFbGVtZW50LnNldEF0dHJpYnV0ZShcInBsYWNlaG9sZGVyXCIsIHR5cGVvZiB2YWx1ZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB2YWx1ZSA/IHZhbHVlIDogc2VsZi50YWJsZS5tb2R1bGVzLmxvY2FsaXplLmdldFRleHQoXCJoZWFkZXJGaWx0ZXJzfGRlZmF1bHRcIikpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5sb2NhbGl6ZS5iaW5kKFwiaGVhZGVyRmlsdGVyc3xkZWZhdWx0XCIsIGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdFx0XHRcdFx0ZWRpdG9yRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJwbGFjZWhvbGRlclwiLCB0eXBlb2Ygc2VsZi5jb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXJQbGFjZWhvbGRlciAhPT0gXCJ1bmRlZmluZWRcIiAmJiBzZWxmLmNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlclBsYWNlaG9sZGVyID8gc2VsZi5jb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXJQbGFjZWhvbGRlciA6IHZhbHVlKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vZm9jdXMgb24gZWxlbWVudCBvbiBjbGlja1xuXHRcdFx0XHRlZGl0b3JFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0ZWRpdG9yRWxlbWVudC5mb2N1cygpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRlZGl0b3JFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJmb2N1c1wiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdHZhciBsZWZ0ID0gX3RoaXM1Mi50YWJsZS5jb2x1bW5NYW5hZ2VyLmVsZW1lbnQuc2Nyb2xsTGVmdDtcblxuXHRcdFx0XHRcdGlmIChsZWZ0ICE9PSBfdGhpczUyLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxMZWZ0KSB7XG5cdFx0XHRcdFx0XHRfdGhpczUyLnRhYmxlLnJvd01hbmFnZXIuc2Nyb2xsSG9yaXpvbnRhbChsZWZ0KTtcblx0XHRcdFx0XHRcdF90aGlzNTIudGFibGUuY29sdW1uTWFuYWdlci5zY3JvbGxIb3Jpem9udGFsKGxlZnQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0Ly9saXZlIHVwZGF0ZSBmaWx0ZXJzIGFzIHVzZXIgdHlwZXNcblx0XHRcdFx0dHlwaW5nVGltZXIgPSBmYWxzZTtcblxuXHRcdFx0XHRzZWFyY2hUcmlnZ2VyID0gZnVuY3Rpb24gc2VhcmNoVHJpZ2dlcihlKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGluZ1RpbWVyKSB7XG5cdFx0XHRcdFx0XHRjbGVhclRpbWVvdXQodHlwaW5nVGltZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHR5cGluZ1RpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRzdWNjZXNzKGVkaXRvckVsZW1lbnQudmFsdWUpO1xuXHRcdFx0XHRcdH0sIHNlbGYudGFibGUub3B0aW9ucy5oZWFkZXJGaWx0ZXJMaXZlRmlsdGVyRGVsYXkpO1xuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdGNvbHVtbi5tb2R1bGVzLmZpbHRlci5oZWFkZXJFbGVtZW50ID0gZWRpdG9yRWxlbWVudDtcblx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuZmlsdGVyLmF0dHJUeXBlID0gZWRpdG9yRWxlbWVudC5oYXNBdHRyaWJ1dGUoXCJ0eXBlXCIpID8gZWRpdG9yRWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJ0eXBlXCIpLnRvTG93ZXJDYXNlKCkgOiBcIlwiO1xuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5maWx0ZXIudGFnVHlwZSA9IGVkaXRvckVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuXG5cdFx0XHRcdGlmIChjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXJMaXZlRmlsdGVyICE9PSBmYWxzZSkge1xuXG5cdFx0XHRcdFx0aWYgKCEoY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyID09PSAnYXV0b2NvbXBsZXRlJyB8fCBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXIgPT09ICd0aWNrQ3Jvc3MnIHx8IChjb2x1bW4uZGVmaW5pdGlvbi5lZGl0b3IgPT09ICdhdXRvY29tcGxldGUnIHx8IGNvbHVtbi5kZWZpbml0aW9uLmVkaXRvciA9PT0gJ3RpY2tDcm9zcycpICYmIGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlciA9PT0gdHJ1ZSkpIHtcblx0XHRcdFx0XHRcdGVkaXRvckVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIHNlYXJjaFRyaWdnZXIpO1xuXHRcdFx0XHRcdFx0ZWRpdG9yRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic2VhcmNoXCIsIHNlYXJjaFRyaWdnZXIpO1xuXG5cdFx0XHRcdFx0XHQvL3VwZGF0ZSBudW1iZXIgZmlsdGVyZWQgY29sdW1ucyBvbiBjaGFuZ2Vcblx0XHRcdFx0XHRcdGlmIChjb2x1bW4ubW9kdWxlcy5maWx0ZXIuYXR0clR5cGUgPT0gXCJudW1iZXJcIikge1xuXHRcdFx0XHRcdFx0XHRlZGl0b3JFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0XHRcdFx0XHRzdWNjZXNzKGVkaXRvckVsZW1lbnQudmFsdWUpO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0Ly9jaGFuZ2UgdGV4dCBpbnB1dHMgdG8gc2VhcmNoIGlucHV0cyB0byBhbGxvdyBmb3IgY2xlYXJpbmcgb2YgZmllbGRcblx0XHRcdFx0XHRcdGlmIChjb2x1bW4ubW9kdWxlcy5maWx0ZXIuYXR0clR5cGUgPT0gXCJ0ZXh0XCIgJiYgdGhpcy50YWJsZS5icm93c2VyICE9PSBcImllXCIpIHtcblx0XHRcdFx0XHRcdFx0ZWRpdG9yRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwic2VhcmNoXCIpO1xuXHRcdFx0XHRcdFx0XHQvLyBlZGl0b3JFbGVtZW50Lm9mZihcImNoYW5nZSBibHVyXCIpOyAvL3ByZXZlbnQgYmx1ciBmcm9tIHRyaWdnZXJpbmcgZmlsdGVyIGFuZCBwcmV2ZW50aW5nIHNlbGVjdGlvbiBjbGlja1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vcHJldmVudCBpbnB1dCBhbmQgc2VsZWN0IGVsZW1lbnRzIGZyb20gcHJvcGVnYXRpbmcgY2xpY2sgdG8gY29sdW1uIHNvcnRlcnMgZXRjXG5cdFx0XHRcdFx0aWYgKGNvbHVtbi5tb2R1bGVzLmZpbHRlci50YWdUeXBlID09IFwiaW5wdXRcIiB8fCBjb2x1bW4ubW9kdWxlcy5maWx0ZXIudGFnVHlwZSA9PSBcInNlbGVjdFwiIHx8IGNvbHVtbi5tb2R1bGVzLmZpbHRlci50YWdUeXBlID09IFwidGV4dGFyZWFcIikge1xuXHRcdFx0XHRcdFx0ZWRpdG9yRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmaWx0ZXJFbGVtZW50LmFwcGVuZENoaWxkKGVkaXRvckVsZW1lbnQpO1xuXG5cdFx0XHRcdGNvbHVtbi5jb250ZW50RWxlbWVudC5hcHBlbmRDaGlsZChmaWx0ZXJFbGVtZW50KTtcblxuXHRcdFx0XHRpZiAoIXJlaW5pdGlhbGl6ZSkge1xuXHRcdFx0XHRcdHNlbGYuaGVhZGVyRmlsdGVyQ29sdW1ucy5wdXNoKGNvbHVtbik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiRmlsdGVyIEVycm9yIC0gQ2Fubm90IGFkZCBoZWFkZXIgZmlsdGVyLCBjb2x1bW4gaGFzIG5vIGZpZWxkIHNldDpcIiwgY29sdW1uLmRlZmluaXRpb24udGl0bGUpO1xuXHRcdH1cblx0fTtcblxuXHQvL2hpZGUgYWxsIGhlYWRlciBmaWx0ZXIgZWxlbWVudHMgKHVzZWQgdG8gZW5zdXJlIGNvcnJlY3QgY29sdW1uIHdpZHRocyBpbiBcImZpdERhdGFcIiBsYXlvdXQgbW9kZSlcblx0RmlsdGVyLnByb3RvdHlwZS5oaWRlSGVhZGVyRmlsdGVyRWxlbWVudHMgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy5oZWFkZXJGaWx0ZXJDb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdFx0aWYgKGNvbHVtbi5tb2R1bGVzLmZpbHRlciAmJiBjb2x1bW4ubW9kdWxlcy5maWx0ZXIuaGVhZGVyRWxlbWVudCkge1xuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5maWx0ZXIuaGVhZGVyRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdC8vc2hvdyBhbGwgaGVhZGVyIGZpbHRlciBlbGVtZW50cyAodXNlZCB0byBlbnN1cmUgY29ycmVjdCBjb2x1bW4gd2lkdGhzIGluIFwiZml0RGF0YVwiIGxheW91dCBtb2RlKVxuXHRGaWx0ZXIucHJvdG90eXBlLnNob3dIZWFkZXJGaWx0ZXJFbGVtZW50cyA9IGZ1bmN0aW9uICgpIHtcblx0XHR0aGlzLmhlYWRlckZpbHRlckNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0XHRpZiAoY29sdW1uLm1vZHVsZXMuZmlsdGVyICYmIGNvbHVtbi5tb2R1bGVzLmZpbHRlci5oZWFkZXJFbGVtZW50KSB7XG5cdFx0XHRcdGNvbHVtbi5tb2R1bGVzLmZpbHRlci5oZWFkZXJFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnJztcblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHQvL3Byb2dyYW1hdGljYWxseSBzZXQgZm9jdXMgb2YgaGVhZGVyIGZpbHRlclxuXHRGaWx0ZXIucHJvdG90eXBlLnNldEhlYWRlckZpbHRlckZvY3VzID0gZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdGlmIChjb2x1bW4ubW9kdWxlcy5maWx0ZXIgJiYgY29sdW1uLm1vZHVsZXMuZmlsdGVyLmhlYWRlckVsZW1lbnQpIHtcblx0XHRcdGNvbHVtbi5tb2R1bGVzLmZpbHRlci5oZWFkZXJFbGVtZW50LmZvY3VzKCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIkNvbHVtbiBGaWx0ZXIgRm9jdXMgRXJyb3IgLSBObyBoZWFkZXIgZmlsdGVyIHNldCBvbiBjb2x1bW46XCIsIGNvbHVtbi5nZXRGaWVsZCgpKTtcblx0XHR9XG5cdH07XG5cblx0Ly9wcm9ncmFtbWF0aWNhbGx5IGdldCB2YWx1ZSBvZiBoZWFkZXIgZmlsdGVyXG5cdEZpbHRlci5wcm90b3R5cGUuZ2V0SGVhZGVyRmlsdGVyVmFsdWUgPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0aWYgKGNvbHVtbi5tb2R1bGVzLmZpbHRlciAmJiBjb2x1bW4ubW9kdWxlcy5maWx0ZXIuaGVhZGVyRWxlbWVudCkge1xuXHRcdFx0cmV0dXJuIGNvbHVtbi5tb2R1bGVzLmZpbHRlci5oZWFkZXJFbGVtZW50LnZhbHVlO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJDb2x1bW4gRmlsdGVyIEVycm9yIC0gTm8gaGVhZGVyIGZpbHRlciBzZXQgb24gY29sdW1uOlwiLCBjb2x1bW4uZ2V0RmllbGQoKSk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vcHJvZ3JhbWF0aWNhbGx5IHNldCB2YWx1ZSBvZiBoZWFkZXIgZmlsdGVyXG5cdEZpbHRlci5wcm90b3R5cGUuc2V0SGVhZGVyRmlsdGVyVmFsdWUgPSBmdW5jdGlvbiAoY29sdW1uLCB2YWx1ZSkge1xuXHRcdGlmIChjb2x1bW4pIHtcblx0XHRcdGlmIChjb2x1bW4ubW9kdWxlcy5maWx0ZXIgJiYgY29sdW1uLm1vZHVsZXMuZmlsdGVyLmhlYWRlckVsZW1lbnQpIHtcblx0XHRcdFx0dGhpcy5nZW5lcmF0ZUhlYWRlckZpbHRlckVsZW1lbnQoY29sdW1uLCB2YWx1ZSwgdHJ1ZSk7XG5cdFx0XHRcdGNvbHVtbi5tb2R1bGVzLmZpbHRlci5zdWNjZXNzKHZhbHVlKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkNvbHVtbiBGaWx0ZXIgRXJyb3IgLSBObyBoZWFkZXIgZmlsdGVyIHNldCBvbiBjb2x1bW46XCIsIGNvbHVtbi5nZXRGaWVsZCgpKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0RmlsdGVyLnByb3RvdHlwZS5yZWxvYWRIZWFkZXJGaWx0ZXIgPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0aWYgKGNvbHVtbikge1xuXHRcdFx0aWYgKGNvbHVtbi5tb2R1bGVzLmZpbHRlciAmJiBjb2x1bW4ubW9kdWxlcy5maWx0ZXIuaGVhZGVyRWxlbWVudCkge1xuXHRcdFx0XHR0aGlzLmdlbmVyYXRlSGVhZGVyRmlsdGVyRWxlbWVudChjb2x1bW4sIGNvbHVtbi5tb2R1bGVzLmZpbHRlci52YWx1ZSwgdHJ1ZSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJDb2x1bW4gRmlsdGVyIEVycm9yIC0gTm8gaGVhZGVyIGZpbHRlciBzZXQgb24gY29sdW1uOlwiLCBjb2x1bW4uZ2V0RmllbGQoKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdC8vY2hlY2sgaWYgdGhlIGZpbHRlcnMgaGFzIGNoYW5nZWQgc2luY2UgbGFzdCB1c2Vcblx0RmlsdGVyLnByb3RvdHlwZS5oYXNDaGFuZ2VkID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBjaGFuZ2VkID0gdGhpcy5jaGFuZ2VkO1xuXHRcdHRoaXMuY2hhbmdlZCA9IGZhbHNlO1xuXHRcdHJldHVybiBjaGFuZ2VkO1xuXHR9O1xuXG5cdC8vc2V0IHN0YW5kYXJkIGZpbHRlcnNcblx0RmlsdGVyLnByb3RvdHlwZS5zZXRGaWx0ZXIgPSBmdW5jdGlvbiAoZmllbGQsIHR5cGUsIHZhbHVlLCBwYXJhbXMpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRzZWxmLmZpbHRlckxpc3QgPSBbXTtcblxuXHRcdGlmICghQXJyYXkuaXNBcnJheShmaWVsZCkpIHtcblx0XHRcdGZpZWxkID0gW3sgZmllbGQ6IGZpZWxkLCB0eXBlOiB0eXBlLCB2YWx1ZTogdmFsdWUsIHBhcmFtczogcGFyYW1zIH1dO1xuXHRcdH1cblxuXHRcdHNlbGYuYWRkRmlsdGVyKGZpZWxkKTtcblx0fTtcblxuXHQvL2FkZCBmaWx0ZXIgdG8gYXJyYXlcblx0RmlsdGVyLnByb3RvdHlwZS5hZGRGaWx0ZXIgPSBmdW5jdGlvbiAoZmllbGQsIHR5cGUsIHZhbHVlLCBwYXJhbXMpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRpZiAoIUFycmF5LmlzQXJyYXkoZmllbGQpKSB7XG5cdFx0XHRmaWVsZCA9IFt7IGZpZWxkOiBmaWVsZCwgdHlwZTogdHlwZSwgdmFsdWU6IHZhbHVlLCBwYXJhbXM6IHBhcmFtcyB9XTtcblx0XHR9XG5cblx0XHRmaWVsZC5mb3JFYWNoKGZ1bmN0aW9uIChmaWx0ZXIpIHtcblxuXHRcdFx0ZmlsdGVyID0gc2VsZi5maW5kRmlsdGVyKGZpbHRlcik7XG5cblx0XHRcdGlmIChmaWx0ZXIpIHtcblx0XHRcdFx0c2VsZi5maWx0ZXJMaXN0LnB1c2goZmlsdGVyKTtcblxuXHRcdFx0XHRzZWxmLmNoYW5nZWQgPSB0cnVlO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInBlcnNpc3RlbmNlXCIsIHRydWUpICYmIHRoaXMudGFibGUubW9kdWxlcy5wZXJzaXN0ZW5jZS5jb25maWcuZmlsdGVyKSB7XG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMucGVyc2lzdGVuY2Uuc2F2ZShcImZpbHRlclwiKTtcblx0XHR9XG5cdH07XG5cblx0RmlsdGVyLnByb3RvdHlwZS5maW5kRmlsdGVyID0gZnVuY3Rpb24gKGZpbHRlcikge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgY29sdW1uO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoZmlsdGVyKSkge1xuXHRcdFx0cmV0dXJuIHRoaXMuZmluZFN1YkZpbHRlcnMoZmlsdGVyKTtcblx0XHR9XG5cblx0XHR2YXIgZmlsdGVyRnVuYyA9IGZhbHNlO1xuXG5cdFx0aWYgKHR5cGVvZiBmaWx0ZXIuZmllbGQgPT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRmaWx0ZXJGdW5jID0gZnVuY3Rpb24gZmlsdGVyRnVuYyhkYXRhKSB7XG5cdFx0XHRcdHJldHVybiBmaWx0ZXIuZmllbGQoZGF0YSwgZmlsdGVyLnR5cGUgfHwge30pOyAvLyBwYXNzIHBhcmFtcyB0byBjdXN0b20gZmlsdGVyIGZ1bmN0aW9uXG5cdFx0XHR9O1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChzZWxmLmZpbHRlcnNbZmlsdGVyLnR5cGVdKSB7XG5cblx0XHRcdFx0Y29sdW1uID0gc2VsZi50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldENvbHVtbkJ5RmllbGQoZmlsdGVyLmZpZWxkKTtcblxuXHRcdFx0XHRpZiAoY29sdW1uKSB7XG5cdFx0XHRcdFx0ZmlsdGVyRnVuYyA9IGZ1bmN0aW9uIGZpbHRlckZ1bmMoZGF0YSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHNlbGYuZmlsdGVyc1tmaWx0ZXIudHlwZV0oZmlsdGVyLnZhbHVlLCBjb2x1bW4uZ2V0RmllbGRWYWx1ZShkYXRhKSwgZGF0YSwgZmlsdGVyLnBhcmFtcyB8fCB7fSk7XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRmaWx0ZXJGdW5jID0gZnVuY3Rpb24gZmlsdGVyRnVuYyhkYXRhKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gc2VsZi5maWx0ZXJzW2ZpbHRlci50eXBlXShmaWx0ZXIudmFsdWUsIGRhdGFbZmlsdGVyLmZpZWxkXSwgZGF0YSwgZmlsdGVyLnBhcmFtcyB8fCB7fSk7XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiRmlsdGVyIEVycm9yIC0gTm8gc3VjaCBmaWx0ZXIgdHlwZSBmb3VuZCwgaWdub3Jpbmc6IFwiLCBmaWx0ZXIudHlwZSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZmlsdGVyLmZ1bmMgPSBmaWx0ZXJGdW5jO1xuXG5cdFx0cmV0dXJuIGZpbHRlci5mdW5jID8gZmlsdGVyIDogZmFsc2U7XG5cdH07XG5cblx0RmlsdGVyLnByb3RvdHlwZS5maW5kU3ViRmlsdGVycyA9IGZ1bmN0aW9uIChmaWx0ZXJzKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBvdXRwdXQgPSBbXTtcblxuXHRcdGZpbHRlcnMuZm9yRWFjaChmdW5jdGlvbiAoZmlsdGVyKSB7XG5cdFx0XHRmaWx0ZXIgPSBzZWxmLmZpbmRGaWx0ZXIoZmlsdGVyKTtcblxuXHRcdFx0aWYgKGZpbHRlcikge1xuXHRcdFx0XHRvdXRwdXQucHVzaChmaWx0ZXIpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG91dHB1dC5sZW5ndGggPyBvdXRwdXQgOiBmYWxzZTtcblx0fTtcblxuXHQvL2dldCBhbGwgZmlsdGVyc1xuXHRGaWx0ZXIucHJvdG90eXBlLmdldEZpbHRlcnMgPSBmdW5jdGlvbiAoYWxsLCBhamF4KSB7XG5cdFx0dmFyIG91dHB1dCA9IFtdO1xuXG5cdFx0aWYgKGFsbCkge1xuXHRcdFx0b3V0cHV0ID0gdGhpcy5nZXRIZWFkZXJGaWx0ZXJzKCk7XG5cdFx0fVxuXG5cdFx0aWYgKGFqYXgpIHtcblx0XHRcdG91dHB1dC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YgaXRlbS50eXBlID09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdGl0ZW0udHlwZSA9IFwiZnVuY3Rpb25cIjtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0b3V0cHV0ID0gb3V0cHV0LmNvbmNhdCh0aGlzLmZpbHRlcnNUb0FycmF5KHRoaXMuZmlsdGVyTGlzdCwgYWpheCkpO1xuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fTtcblxuXHQvL2ZpbHRlciB0byBPYmplY3Rcblx0RmlsdGVyLnByb3RvdHlwZS5maWx0ZXJzVG9BcnJheSA9IGZ1bmN0aW9uIChmaWx0ZXJMaXN0LCBhamF4KSB7XG5cdFx0dmFyIF90aGlzNTMgPSB0aGlzO1xuXG5cdFx0dmFyIG91dHB1dCA9IFtdO1xuXG5cdFx0ZmlsdGVyTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChmaWx0ZXIpIHtcblx0XHRcdHZhciBpdGVtO1xuXG5cdFx0XHRpZiAoQXJyYXkuaXNBcnJheShmaWx0ZXIpKSB7XG5cdFx0XHRcdG91dHB1dC5wdXNoKF90aGlzNTMuZmlsdGVyc1RvQXJyYXkoZmlsdGVyLCBhamF4KSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpdGVtID0geyBmaWVsZDogZmlsdGVyLmZpZWxkLCB0eXBlOiBmaWx0ZXIudHlwZSwgdmFsdWU6IGZpbHRlci52YWx1ZSB9O1xuXG5cdFx0XHRcdGlmIChhamF4KSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZiBpdGVtLnR5cGUgPT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRpdGVtLnR5cGUgPSBcImZ1bmN0aW9uXCI7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0b3V0cHV0LnB1c2goaXRlbSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9O1xuXG5cdC8vZ2V0IGFsbCBmaWx0ZXJzXG5cdEZpbHRlci5wcm90b3R5cGUuZ2V0SGVhZGVyRmlsdGVycyA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIG91dHB1dCA9IFtdO1xuXG5cdFx0Zm9yICh2YXIga2V5IGluIHRoaXMuaGVhZGVyRmlsdGVycykge1xuXHRcdFx0b3V0cHV0LnB1c2goeyBmaWVsZDoga2V5LCB0eXBlOiB0aGlzLmhlYWRlckZpbHRlcnNba2V5XS50eXBlLCB2YWx1ZTogdGhpcy5oZWFkZXJGaWx0ZXJzW2tleV0udmFsdWUgfSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fTtcblxuXHQvL3JlbW92ZSBmaWx0ZXIgZnJvbSBhcnJheVxuXHRGaWx0ZXIucHJvdG90eXBlLnJlbW92ZUZpbHRlciA9IGZ1bmN0aW9uIChmaWVsZCwgdHlwZSwgdmFsdWUpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRpZiAoIUFycmF5LmlzQXJyYXkoZmllbGQpKSB7XG5cdFx0XHRmaWVsZCA9IFt7IGZpZWxkOiBmaWVsZCwgdHlwZTogdHlwZSwgdmFsdWU6IHZhbHVlIH1dO1xuXHRcdH1cblxuXHRcdGZpZWxkLmZvckVhY2goZnVuY3Rpb24gKGZpbHRlcikge1xuXHRcdFx0dmFyIGluZGV4ID0gLTE7XG5cblx0XHRcdGlmIChfdHlwZW9mKGZpbHRlci5maWVsZCkgPT0gXCJvYmplY3RcIikge1xuXHRcdFx0XHRpbmRleCA9IHNlbGYuZmlsdGVyTGlzdC5maW5kSW5kZXgoZnVuY3Rpb24gKGVsZW1lbnQpIHtcblx0XHRcdFx0XHRyZXR1cm4gZmlsdGVyID09PSBlbGVtZW50O1xuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGluZGV4ID0gc2VsZi5maWx0ZXJMaXN0LmZpbmRJbmRleChmdW5jdGlvbiAoZWxlbWVudCkge1xuXHRcdFx0XHRcdHJldHVybiBmaWx0ZXIuZmllbGQgPT09IGVsZW1lbnQuZmllbGQgJiYgZmlsdGVyLnR5cGUgPT09IGVsZW1lbnQudHlwZSAmJiBmaWx0ZXIudmFsdWUgPT09IGVsZW1lbnQudmFsdWU7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoaW5kZXggPiAtMSkge1xuXHRcdFx0XHRzZWxmLmZpbHRlckxpc3Quc3BsaWNlKGluZGV4LCAxKTtcblx0XHRcdFx0c2VsZi5jaGFuZ2VkID0gdHJ1ZTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkZpbHRlciBFcnJvciAtIE5vIG1hdGNoaW5nIGZpbHRlciB0eXBlIGZvdW5kLCBpZ25vcmluZzogXCIsIGZpbHRlci50eXBlKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJwZXJzaXN0ZW5jZVwiLCB0cnVlKSAmJiB0aGlzLnRhYmxlLm1vZHVsZXMucGVyc2lzdGVuY2UuY29uZmlnLmZpbHRlcikge1xuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLnNhdmUoXCJmaWx0ZXJcIik7XG5cdFx0fVxuXHR9O1xuXG5cdC8vY2xlYXIgZmlsdGVyc1xuXHRGaWx0ZXIucHJvdG90eXBlLmNsZWFyRmlsdGVyID0gZnVuY3Rpb24gKGFsbCkge1xuXHRcdHRoaXMuZmlsdGVyTGlzdCA9IFtdO1xuXG5cdFx0aWYgKGFsbCkge1xuXHRcdFx0dGhpcy5jbGVhckhlYWRlckZpbHRlcigpO1xuXHRcdH1cblxuXHRcdHRoaXMuY2hhbmdlZCA9IHRydWU7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwicGVyc2lzdGVuY2VcIiwgdHJ1ZSkgJiYgdGhpcy50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLmNvbmZpZy5maWx0ZXIpIHtcblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5wZXJzaXN0ZW5jZS5zYXZlKFwiZmlsdGVyXCIpO1xuXHRcdH1cblx0fTtcblxuXHQvL2NsZWFyIGhlYWRlciBmaWx0ZXJzXG5cdEZpbHRlci5wcm90b3R5cGUuY2xlYXJIZWFkZXJGaWx0ZXIgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0dGhpcy5oZWFkZXJGaWx0ZXJzID0ge307XG5cdFx0c2VsZi5wcmV2SGVhZGVyRmlsdGVyQ2hhbmdlQ2hlY2sgPSBcInt9XCI7XG5cblx0XHR0aGlzLmhlYWRlckZpbHRlckNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0XHRjb2x1bW4ubW9kdWxlcy5maWx0ZXIudmFsdWUgPSBudWxsO1xuXHRcdFx0Y29sdW1uLm1vZHVsZXMuZmlsdGVyLnByZXZTdWNjZXNzID0gdW5kZWZpbmVkO1xuXHRcdFx0c2VsZi5yZWxvYWRIZWFkZXJGaWx0ZXIoY29sdW1uKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuY2hhbmdlZCA9IHRydWU7XG5cdH07XG5cblx0Ly9zZWFyY2ggZGF0YSBhbmQgcmV0dXJuIG1hdGNoaW5nIHJvd3Ncblx0RmlsdGVyLnByb3RvdHlwZS5zZWFyY2ggPSBmdW5jdGlvbiAoc2VhcmNoVHlwZSwgZmllbGQsIHR5cGUsIHZhbHVlKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBhY3RpdmVSb3dzID0gW10sXG5cdFx0ICAgIGZpbHRlckxpc3QgPSBbXTtcblxuXHRcdGlmICghQXJyYXkuaXNBcnJheShmaWVsZCkpIHtcblx0XHRcdGZpZWxkID0gW3sgZmllbGQ6IGZpZWxkLCB0eXBlOiB0eXBlLCB2YWx1ZTogdmFsdWUgfV07XG5cdFx0fVxuXG5cdFx0ZmllbGQuZm9yRWFjaChmdW5jdGlvbiAoZmlsdGVyKSB7XG5cdFx0XHRmaWx0ZXIgPSBzZWxmLmZpbmRGaWx0ZXIoZmlsdGVyKTtcblxuXHRcdFx0aWYgKGZpbHRlcikge1xuXHRcdFx0XHRmaWx0ZXJMaXN0LnB1c2goZmlsdGVyKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHRoaXMudGFibGUucm93TWFuYWdlci5yb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0dmFyIG1hdGNoID0gdHJ1ZTtcblxuXHRcdFx0ZmlsdGVyTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChmaWx0ZXIpIHtcblx0XHRcdFx0aWYgKCFzZWxmLmZpbHRlclJlY3Vyc2UoZmlsdGVyLCByb3cuZ2V0RGF0YSgpKSkge1xuXHRcdFx0XHRcdG1hdGNoID0gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRpZiAobWF0Y2gpIHtcblx0XHRcdFx0YWN0aXZlUm93cy5wdXNoKHNlYXJjaFR5cGUgPT09IFwiZGF0YVwiID8gcm93LmdldERhdGEoXCJkYXRhXCIpIDogcm93LmdldENvbXBvbmVudCgpKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiBhY3RpdmVSb3dzO1xuXHR9O1xuXG5cdC8vZmlsdGVyIHJvdyBhcnJheVxuXHRGaWx0ZXIucHJvdG90eXBlLmZpbHRlciA9IGZ1bmN0aW9uIChyb3dMaXN0LCBmaWx0ZXJzKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBhY3RpdmVSb3dzID0gW10sXG5cdFx0ICAgIGFjdGl2ZVJvd0NvbXBvbmVudHMgPSBbXTtcblxuXHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMuZGF0YUZpbHRlcmluZykge1xuXHRcdFx0c2VsZi50YWJsZS5vcHRpb25zLmRhdGFGaWx0ZXJpbmcuY2FsbChzZWxmLnRhYmxlLCBzZWxmLmdldEZpbHRlcnMoKSk7XG5cdFx0fVxuXG5cdFx0aWYgKCFzZWxmLnRhYmxlLm9wdGlvbnMuYWpheEZpbHRlcmluZyAmJiAoc2VsZi5maWx0ZXJMaXN0Lmxlbmd0aCB8fCBPYmplY3Qua2V5cyhzZWxmLmhlYWRlckZpbHRlcnMpLmxlbmd0aCkpIHtcblxuXHRcdFx0cm93TGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0aWYgKHNlbGYuZmlsdGVyUm93KHJvdykpIHtcblx0XHRcdFx0XHRhY3RpdmVSb3dzLnB1c2gocm93KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGFjdGl2ZVJvd3MgPSByb3dMaXN0LnNsaWNlKDApO1xuXHRcdH1cblxuXHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMuZGF0YUZpbHRlcmVkKSB7XG5cblx0XHRcdGFjdGl2ZVJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRcdGFjdGl2ZVJvd0NvbXBvbmVudHMucHVzaChyb3cuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5kYXRhRmlsdGVyZWQuY2FsbChzZWxmLnRhYmxlLCBzZWxmLmdldEZpbHRlcnMoKSwgYWN0aXZlUm93Q29tcG9uZW50cyk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFjdGl2ZVJvd3M7XG5cdH07XG5cblx0Ly9maWx0ZXIgaW5kaXZpZHVhbCByb3dcblx0RmlsdGVyLnByb3RvdHlwZS5maWx0ZXJSb3cgPSBmdW5jdGlvbiAocm93LCBmaWx0ZXJzKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBtYXRjaCA9IHRydWUsXG5cdFx0ICAgIGRhdGEgPSByb3cuZ2V0RGF0YSgpO1xuXG5cdFx0c2VsZi5maWx0ZXJMaXN0LmZvckVhY2goZnVuY3Rpb24gKGZpbHRlcikge1xuXHRcdFx0aWYgKCFzZWxmLmZpbHRlclJlY3Vyc2UoZmlsdGVyLCBkYXRhKSkge1xuXHRcdFx0XHRtYXRjaCA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0Zm9yICh2YXIgZmllbGQgaW4gc2VsZi5oZWFkZXJGaWx0ZXJzKSB7XG5cdFx0XHRpZiAoIXNlbGYuaGVhZGVyRmlsdGVyc1tmaWVsZF0uZnVuYyhkYXRhKSkge1xuXHRcdFx0XHRtYXRjaCA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBtYXRjaDtcblx0fTtcblxuXHRGaWx0ZXIucHJvdG90eXBlLmZpbHRlclJlY3Vyc2UgPSBmdW5jdGlvbiAoZmlsdGVyLCBkYXRhKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBtYXRjaCA9IGZhbHNlO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoZmlsdGVyKSkge1xuXHRcdFx0ZmlsdGVyLmZvckVhY2goZnVuY3Rpb24gKHN1YkZpbHRlcikge1xuXHRcdFx0XHRpZiAoc2VsZi5maWx0ZXJSZWN1cnNlKHN1YkZpbHRlciwgZGF0YSkpIHtcblx0XHRcdFx0XHRtYXRjaCA9IHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRtYXRjaCA9IGZpbHRlci5mdW5jKGRhdGEpO1xuXHRcdH1cblxuXHRcdHJldHVybiBtYXRjaDtcblx0fTtcblxuXHQvL2xpc3Qgb2YgYXZhaWxhYmxlIGZpbHRlcnNcblx0RmlsdGVyLnByb3RvdHlwZS5maWx0ZXJzID0ge1xuXG5cdFx0Ly9lcXVhbCB0b1xuXHRcdFwiPVwiOiBmdW5jdGlvbiBfKGZpbHRlclZhbCwgcm93VmFsLCByb3dEYXRhLCBmaWx0ZXJQYXJhbXMpIHtcblx0XHRcdHJldHVybiByb3dWYWwgPT0gZmlsdGVyVmFsID8gdHJ1ZSA6IGZhbHNlO1xuXHRcdH0sXG5cblx0XHQvL2xlc3MgdGhhblxuXHRcdFwiPFwiOiBmdW5jdGlvbiBfKGZpbHRlclZhbCwgcm93VmFsLCByb3dEYXRhLCBmaWx0ZXJQYXJhbXMpIHtcblx0XHRcdHJldHVybiByb3dWYWwgPCBmaWx0ZXJWYWwgPyB0cnVlIDogZmFsc2U7XG5cdFx0fSxcblxuXHRcdC8vbGVzcyB0aGFuIG9yIGVxdWFsIHRvXG5cdFx0XCI8PVwiOiBmdW5jdGlvbiBfKGZpbHRlclZhbCwgcm93VmFsLCByb3dEYXRhLCBmaWx0ZXJQYXJhbXMpIHtcblx0XHRcdHJldHVybiByb3dWYWwgPD0gZmlsdGVyVmFsID8gdHJ1ZSA6IGZhbHNlO1xuXHRcdH0sXG5cblx0XHQvL2dyZWF0ZXIgdGhhblxuXHRcdFwiPlwiOiBmdW5jdGlvbiBfKGZpbHRlclZhbCwgcm93VmFsLCByb3dEYXRhLCBmaWx0ZXJQYXJhbXMpIHtcblx0XHRcdHJldHVybiByb3dWYWwgPiBmaWx0ZXJWYWwgPyB0cnVlIDogZmFsc2U7XG5cdFx0fSxcblxuXHRcdC8vZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvXG5cdFx0XCI+PVwiOiBmdW5jdGlvbiBfKGZpbHRlclZhbCwgcm93VmFsLCByb3dEYXRhLCBmaWx0ZXJQYXJhbXMpIHtcblx0XHRcdHJldHVybiByb3dWYWwgPj0gZmlsdGVyVmFsID8gdHJ1ZSA6IGZhbHNlO1xuXHRcdH0sXG5cblx0XHQvL25vdCBlcXVhbCB0b1xuXHRcdFwiIT1cIjogZnVuY3Rpb24gXyhmaWx0ZXJWYWwsIHJvd1ZhbCwgcm93RGF0YSwgZmlsdGVyUGFyYW1zKSB7XG5cdFx0XHRyZXR1cm4gcm93VmFsICE9IGZpbHRlclZhbCA/IHRydWUgOiBmYWxzZTtcblx0XHR9LFxuXG5cdFx0XCJyZWdleFwiOiBmdW5jdGlvbiByZWdleChmaWx0ZXJWYWwsIHJvd1ZhbCwgcm93RGF0YSwgZmlsdGVyUGFyYW1zKSB7XG5cblx0XHRcdGlmICh0eXBlb2YgZmlsdGVyVmFsID09IFwic3RyaW5nXCIpIHtcblx0XHRcdFx0ZmlsdGVyVmFsID0gbmV3IFJlZ0V4cChmaWx0ZXJWYWwpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZmlsdGVyVmFsLnRlc3Qocm93VmFsKTtcblx0XHR9LFxuXG5cdFx0Ly9jb250YWlucyB0aGUgc3RyaW5nXG5cdFx0XCJsaWtlXCI6IGZ1bmN0aW9uIGxpa2UoZmlsdGVyVmFsLCByb3dWYWwsIHJvd0RhdGEsIGZpbHRlclBhcmFtcykge1xuXHRcdFx0aWYgKGZpbHRlclZhbCA9PT0gbnVsbCB8fCB0eXBlb2YgZmlsdGVyVmFsID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdHJldHVybiByb3dWYWwgPT09IGZpbHRlclZhbCA/IHRydWUgOiBmYWxzZTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmICh0eXBlb2Ygcm93VmFsICE9PSAndW5kZWZpbmVkJyAmJiByb3dWYWwgIT09IG51bGwpIHtcblx0XHRcdFx0XHRyZXR1cm4gU3RyaW5nKHJvd1ZhbCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKGZpbHRlclZhbC50b0xvd2VyQ2FzZSgpKSA+IC0xO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvL2NvbnRhaW5zIHRoZSBrZXl3b3Jkc1xuXHRcdFwia2V5d29yZHNcIjogZnVuY3Rpb24ga2V5d29yZHMoZmlsdGVyVmFsLCByb3dWYWwsIHJvd0RhdGEsIGZpbHRlclBhcmFtcykge1xuXHRcdFx0dmFyIGtleXdvcmRzID0gZmlsdGVyVmFsLnRvTG93ZXJDYXNlKCkuc3BsaXQodHlwZW9mIGZpbHRlclBhcmFtcy5zZXBhcmF0b3IgPT09IFwidW5kZWZpbmVkXCIgPyBcIiBcIiA6IGZpbHRlclBhcmFtcy5zZXBhcmF0b3IpLFxuXHRcdFx0ICAgIHZhbHVlID0gU3RyaW5nKHJvd1ZhbCA9PT0gbnVsbCB8fCB0eXBlb2Ygcm93VmFsID09PSBcInVuZGVmaW5lZFwiID8gXCJcIiA6IHJvd1ZhbCkudG9Mb3dlckNhc2UoKSxcblx0XHRcdCAgICBtYXRjaGVzID0gW107XG5cblx0XHRcdGtleXdvcmRzLmZvckVhY2goZnVuY3Rpb24gKGtleXdvcmQpIHtcblx0XHRcdFx0aWYgKHZhbHVlLmluY2x1ZGVzKGtleXdvcmQpKSB7XG5cdFx0XHRcdFx0bWF0Y2hlcy5wdXNoKHRydWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIGZpbHRlclBhcmFtcy5tYXRjaEFsbCA/IG1hdGNoZXMubGVuZ3RoID09PSBrZXl3b3Jkcy5sZW5ndGggOiAhIW1hdGNoZXMubGVuZ3RoO1xuXHRcdH0sXG5cblx0XHQvL3N0YXJ0cyB3aXRoIHRoZSBzdHJpbmdcblx0XHRcInN0YXJ0c1wiOiBmdW5jdGlvbiBzdGFydHMoZmlsdGVyVmFsLCByb3dWYWwsIHJvd0RhdGEsIGZpbHRlclBhcmFtcykge1xuXHRcdFx0aWYgKGZpbHRlclZhbCA9PT0gbnVsbCB8fCB0eXBlb2YgZmlsdGVyVmFsID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdHJldHVybiByb3dWYWwgPT09IGZpbHRlclZhbCA/IHRydWUgOiBmYWxzZTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmICh0eXBlb2Ygcm93VmFsICE9PSAndW5kZWZpbmVkJyAmJiByb3dWYWwgIT09IG51bGwpIHtcblx0XHRcdFx0XHRyZXR1cm4gU3RyaW5nKHJvd1ZhbCkudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKGZpbHRlclZhbC50b0xvd2VyQ2FzZSgpKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0Ly9lbmRzIHdpdGggdGhlIHN0cmluZ1xuXHRcdFwiZW5kc1wiOiBmdW5jdGlvbiBlbmRzKGZpbHRlclZhbCwgcm93VmFsLCByb3dEYXRhLCBmaWx0ZXJQYXJhbXMpIHtcblx0XHRcdGlmIChmaWx0ZXJWYWwgPT09IG51bGwgfHwgdHlwZW9mIGZpbHRlclZhbCA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRyZXR1cm4gcm93VmFsID09PSBmaWx0ZXJWYWwgPyB0cnVlIDogZmFsc2U7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAodHlwZW9mIHJvd1ZhbCAhPT0gJ3VuZGVmaW5lZCcgJiYgcm93VmFsICE9PSBudWxsKSB7XG5cdFx0XHRcdFx0cmV0dXJuIFN0cmluZyhyb3dWYWwpLnRvTG93ZXJDYXNlKCkuZW5kc1dpdGgoZmlsdGVyVmFsLnRvTG93ZXJDYXNlKCkpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvL2luIGFycmF5XG5cdFx0XCJpblwiOiBmdW5jdGlvbiBfaW4oZmlsdGVyVmFsLCByb3dWYWwsIHJvd0RhdGEsIGZpbHRlclBhcmFtcykge1xuXHRcdFx0aWYgKEFycmF5LmlzQXJyYXkoZmlsdGVyVmFsKSkge1xuXHRcdFx0XHRyZXR1cm4gZmlsdGVyVmFsLmluZGV4T2Yocm93VmFsKSA+IC0xO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiRmlsdGVyIEVycm9yIC0gZmlsdGVyIHZhbHVlIGlzIG5vdCBhbiBhcnJheTpcIiwgZmlsdGVyVmFsKTtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnJlZ2lzdGVyTW9kdWxlKFwiZmlsdGVyXCIsIEZpbHRlcik7XG5cblx0dmFyIEZvcm1hdCA9IGZ1bmN0aW9uIEZvcm1hdCh0YWJsZSkge1xuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIFRhYnVsYXRvciBvYmplY3Rcblx0fTtcblxuXHQvL2luaXRpYWxpemUgY29sdW1uIGZvcm1hdHRlclxuXHRGb3JtYXQucHJvdG90eXBlLmluaXRpYWxpemVDb2x1bW4gPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0Y29sdW1uLm1vZHVsZXMuZm9ybWF0ID0gdGhpcy5sb29rdXBGb3JtYXR0ZXIoY29sdW1uLCBcIlwiKTtcblxuXHRcdGlmICh0eXBlb2YgY29sdW1uLmRlZmluaXRpb24uZm9ybWF0dGVyUHJpbnQgIT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdGNvbHVtbi5tb2R1bGVzLmZvcm1hdC5wcmludCA9IHRoaXMubG9va3VwRm9ybWF0dGVyKGNvbHVtbiwgXCJQcmludFwiKTtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIGNvbHVtbi5kZWZpbml0aW9uLmZvcm1hdHRlckNsaXBib2FyZCAhPT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0Y29sdW1uLm1vZHVsZXMuZm9ybWF0LmNsaXBib2FyZCA9IHRoaXMubG9va3VwRm9ybWF0dGVyKGNvbHVtbiwgXCJDbGlwYm9hcmRcIik7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZiBjb2x1bW4uZGVmaW5pdGlvbi5mb3JtYXR0ZXJIdG1sT3V0cHV0ICE9PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRjb2x1bW4ubW9kdWxlcy5mb3JtYXQuaHRtbE91dHB1dCA9IHRoaXMubG9va3VwRm9ybWF0dGVyKGNvbHVtbiwgXCJIdG1sT3V0cHV0XCIpO1xuXHRcdH1cblx0fTtcblxuXHRGb3JtYXQucHJvdG90eXBlLmxvb2t1cEZvcm1hdHRlciA9IGZ1bmN0aW9uIChjb2x1bW4sIHR5cGUpIHtcblx0XHR2YXIgY29uZmlnID0geyBwYXJhbXM6IGNvbHVtbi5kZWZpbml0aW9uW1wiZm9ybWF0dGVyXCIgKyB0eXBlICsgXCJQYXJhbXNcIl0gfHwge30gfSxcblx0XHQgICAgZm9ybWF0dGVyID0gY29sdW1uLmRlZmluaXRpb25bXCJmb3JtYXR0ZXJcIiArIHR5cGVdO1xuXG5cdFx0Ly9zZXQgY29sdW1uIGZvcm1hdHRlclxuXHRcdHN3aXRjaCAodHlwZW9mIGZvcm1hdHRlciA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoZm9ybWF0dGVyKSkge1xuXHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXG5cdFx0XHRcdGlmIChmb3JtYXR0ZXIgPT09IFwidGlja1wiKSB7XG5cdFx0XHRcdFx0Zm9ybWF0dGVyID0gXCJ0aWNrQ3Jvc3NcIjtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YgY29uZmlnLnBhcmFtcy5jcm9zc0VsZW1lbnQgPT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRcdFx0Y29uZmlnLnBhcmFtcy5jcm9zc0VsZW1lbnQgPSBmYWxzZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJERVBSRUNBVElPTiBXQVJOSU5HIC0gdGhlIHRpY2sgZm9ybWF0dGVyIGhhcyBiZWVuIGRlcHJlY2F0ZWQsIHBsZWFzZSB1c2UgdGhlIHRpY2tDcm9zcyBmb3JtYXR0ZXIgd2l0aCB0aGUgY3Jvc3NFbGVtZW50IHBhcmFtIHNldCB0byBmYWxzZVwiKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0aGlzLmZvcm1hdHRlcnNbZm9ybWF0dGVyXSkge1xuXHRcdFx0XHRcdGNvbmZpZy5mb3JtYXR0ZXIgPSB0aGlzLmZvcm1hdHRlcnNbZm9ybWF0dGVyXTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJGb3JtYXR0ZXIgRXJyb3IgLSBObyBzdWNoIGZvcm1hdHRlciBmb3VuZDogXCIsIGZvcm1hdHRlcik7XG5cdFx0XHRcdFx0Y29uZmlnLmZvcm1hdHRlciA9IHRoaXMuZm9ybWF0dGVycy5wbGFpbnRleHQ7XG5cdFx0XHRcdH1cblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJmdW5jdGlvblwiOlxuXHRcdFx0XHRjb25maWcuZm9ybWF0dGVyID0gZm9ybWF0dGVyO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0Y29uZmlnLmZvcm1hdHRlciA9IHRoaXMuZm9ybWF0dGVycy5wbGFpbnRleHQ7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblxuXHRcdHJldHVybiBjb25maWc7XG5cdH07XG5cblx0Rm9ybWF0LnByb3RvdHlwZS5jZWxsUmVuZGVyZWQgPSBmdW5jdGlvbiAoY2VsbCkge1xuXHRcdGlmIChjZWxsLm1vZHVsZXMuZm9ybWF0ICYmIGNlbGwubW9kdWxlcy5mb3JtYXQucmVuZGVyZWRDYWxsYmFjaykge1xuXHRcdFx0Y2VsbC5tb2R1bGVzLmZvcm1hdC5yZW5kZXJlZENhbGxiYWNrKCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vcmV0dXJuIGEgZm9ybWF0dGVkIHZhbHVlIGZvciBhIGNlbGxcblx0Rm9ybWF0LnByb3RvdHlwZS5mb3JtYXRWYWx1ZSA9IGZ1bmN0aW9uIChjZWxsKSB7XG5cdFx0dmFyIGNvbXBvbmVudCA9IGNlbGwuZ2V0Q29tcG9uZW50KCksXG5cdFx0ICAgIHBhcmFtcyA9IHR5cGVvZiBjZWxsLmNvbHVtbi5tb2R1bGVzLmZvcm1hdC5wYXJhbXMgPT09IFwiZnVuY3Rpb25cIiA/IGNlbGwuY29sdW1uLm1vZHVsZXMuZm9ybWF0LnBhcmFtcyhjb21wb25lbnQpIDogY2VsbC5jb2x1bW4ubW9kdWxlcy5mb3JtYXQucGFyYW1zO1xuXG5cdFx0ZnVuY3Rpb24gb25SZW5kZXJlZChjYWxsYmFjaykge1xuXHRcdFx0aWYgKCFjZWxsLm1vZHVsZXMuZm9ybWF0KSB7XG5cdFx0XHRcdGNlbGwubW9kdWxlcy5mb3JtYXQgPSB7fTtcblx0XHRcdH1cblxuXHRcdFx0Y2VsbC5tb2R1bGVzLmZvcm1hdC5yZW5kZXJlZENhbGxiYWNrID0gY2FsbGJhY2s7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGNlbGwuY29sdW1uLm1vZHVsZXMuZm9ybWF0LmZvcm1hdHRlci5jYWxsKHRoaXMsIGNvbXBvbmVudCwgcGFyYW1zLCBvblJlbmRlcmVkKTtcblx0fTtcblxuXHRGb3JtYXQucHJvdG90eXBlLmZvcm1hdEV4cG9ydFZhbHVlID0gZnVuY3Rpb24gKGNlbGwsIHR5cGUpIHtcblx0XHR2YXIgZm9ybWF0dGVyID0gY2VsbC5jb2x1bW4ubW9kdWxlcy5mb3JtYXRbdHlwZV0sXG5cdFx0ICAgIHBhcmFtcztcblxuXHRcdGlmIChmb3JtYXR0ZXIpIHtcblx0XHRcdHZhciBvblJlbmRlcmVkID0gZnVuY3Rpb24gb25SZW5kZXJlZChjYWxsYmFjaykge1xuXHRcdFx0XHRpZiAoIWNlbGwubW9kdWxlcy5mb3JtYXQpIHtcblx0XHRcdFx0XHRjZWxsLm1vZHVsZXMuZm9ybWF0ID0ge307XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjZWxsLm1vZHVsZXMuZm9ybWF0LnJlbmRlcmVkQ2FsbGJhY2sgPSBjYWxsYmFjaztcblx0XHRcdH07XG5cblx0XHRcdHBhcmFtcyA9IHR5cGVvZiBmb3JtYXR0ZXIucGFyYW1zID09PSBcImZ1bmN0aW9uXCIgPyBmb3JtYXR0ZXIucGFyYW1zKGNvbXBvbmVudCkgOiBmb3JtYXR0ZXIucGFyYW1zO1xuXG5cdFx0XHRyZXR1cm4gZm9ybWF0dGVyLmZvcm1hdHRlci5jYWxsKHRoaXMsIGNlbGwuZ2V0Q29tcG9uZW50KCksIHBhcmFtcywgb25SZW5kZXJlZCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLmZvcm1hdFZhbHVlKGNlbGwpO1xuXHRcdH1cblx0fTtcblxuXHRGb3JtYXQucHJvdG90eXBlLnNhbml0aXplSFRNTCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdGlmICh2YWx1ZSkge1xuXHRcdFx0dmFyIGVudGl0eU1hcCA9IHtcblx0XHRcdFx0JyYnOiAnJmFtcDsnLFxuXHRcdFx0XHQnPCc6ICcmbHQ7Jyxcblx0XHRcdFx0Jz4nOiAnJmd0OycsXG5cdFx0XHRcdCdcIic6ICcmcXVvdDsnLFxuXHRcdFx0XHRcIidcIjogJyYjMzk7Jyxcblx0XHRcdFx0Jy8nOiAnJiN4MkY7Jyxcblx0XHRcdFx0J2AnOiAnJiN4NjA7Jyxcblx0XHRcdFx0Jz0nOiAnJiN4M0Q7J1xuXHRcdFx0fTtcblxuXHRcdFx0cmV0dXJuIFN0cmluZyh2YWx1ZSkucmVwbGFjZSgvWyY8PlwiJ2A9XFwvXS9nLCBmdW5jdGlvbiAocykge1xuXHRcdFx0XHRyZXR1cm4gZW50aXR5TWFwW3NdO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHR9XG5cdH07XG5cblx0Rm9ybWF0LnByb3RvdHlwZS5lbXB0eVRvU3BhY2UgPSBmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRyZXR1cm4gdmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIHZhbHVlID09PSBcInVuZGVmaW5lZFwiIHx8IHZhbHVlID09PSBcIlwiID8gXCImbmJzcDtcIiA6IHZhbHVlO1xuXHR9O1xuXG5cdC8vZ2V0IGZvcm1hdHRlciBmb3IgY2VsbFxuXHRGb3JtYXQucHJvdG90eXBlLmdldEZvcm1hdHRlciA9IGZ1bmN0aW9uIChmb3JtYXR0ZXIpIHtcblx0XHR2YXIgZm9ybWF0dGVyO1xuXG5cdFx0c3dpdGNoICh0eXBlb2YgZm9ybWF0dGVyID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihmb3JtYXR0ZXIpKSB7XG5cdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdGlmICh0aGlzLmZvcm1hdHRlcnNbZm9ybWF0dGVyXSkge1xuXHRcdFx0XHRcdGZvcm1hdHRlciA9IHRoaXMuZm9ybWF0dGVyc1tmb3JtYXR0ZXJdO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkZvcm1hdHRlciBFcnJvciAtIE5vIHN1Y2ggZm9ybWF0dGVyIGZvdW5kOiBcIiwgZm9ybWF0dGVyKTtcblx0XHRcdFx0XHRmb3JtYXR0ZXIgPSB0aGlzLmZvcm1hdHRlcnMucGxhaW50ZXh0O1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0Zm9ybWF0dGVyID0gZm9ybWF0dGVyO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0Zm9ybWF0dGVyID0gdGhpcy5mb3JtYXR0ZXJzLnBsYWludGV4dDtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGZvcm1hdHRlcjtcblx0fTtcblxuXHQvL2RlZmF1bHQgZGF0YSBmb3JtYXR0ZXJzXG5cdEZvcm1hdC5wcm90b3R5cGUuZm9ybWF0dGVycyA9IHtcblx0XHQvL3BsYWluIHRleHQgdmFsdWVcblx0XHRwbGFpbnRleHQ6IGZ1bmN0aW9uIHBsYWludGV4dChjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0XHRcdHJldHVybiB0aGlzLmVtcHR5VG9TcGFjZSh0aGlzLnNhbml0aXplSFRNTChjZWxsLmdldFZhbHVlKCkpKTtcblx0XHR9LFxuXG5cdFx0Ly9odG1sIHRleHQgdmFsdWVcblx0XHRodG1sOiBmdW5jdGlvbiBodG1sKGNlbGwsIGZvcm1hdHRlclBhcmFtcywgb25SZW5kZXJlZCkge1xuXHRcdFx0cmV0dXJuIGNlbGwuZ2V0VmFsdWUoKTtcblx0XHR9LFxuXG5cdFx0Ly9tdWx0aWxpbmUgdGV4dCBhcmVhXG5cdFx0dGV4dGFyZWE6IGZ1bmN0aW9uIHRleHRhcmVhKGNlbGwsIGZvcm1hdHRlclBhcmFtcywgb25SZW5kZXJlZCkge1xuXHRcdFx0Y2VsbC5nZXRFbGVtZW50KCkuc3R5bGUud2hpdGVTcGFjZSA9IFwicHJlLXdyYXBcIjtcblx0XHRcdHJldHVybiB0aGlzLmVtcHR5VG9TcGFjZSh0aGlzLnNhbml0aXplSFRNTChjZWxsLmdldFZhbHVlKCkpKTtcblx0XHR9LFxuXG5cdFx0Ly9jdXJyZW5jeSBmb3JtYXR0aW5nXG5cdFx0bW9uZXk6IGZ1bmN0aW9uIG1vbmV5KGNlbGwsIGZvcm1hdHRlclBhcmFtcywgb25SZW5kZXJlZCkge1xuXHRcdFx0dmFyIGZsb2F0VmFsID0gcGFyc2VGbG9hdChjZWxsLmdldFZhbHVlKCkpLFxuXHRcdFx0ICAgIG51bWJlcixcblx0XHRcdCAgICBpbnRlZ2VyLFxuXHRcdFx0ICAgIGRlY2ltYWwsXG5cdFx0XHQgICAgcmd4O1xuXG5cdFx0XHR2YXIgZGVjaW1hbFN5bSA9IGZvcm1hdHRlclBhcmFtcy5kZWNpbWFsIHx8IFwiLlwiO1xuXHRcdFx0dmFyIHRob3VzYW5kU3ltID0gZm9ybWF0dGVyUGFyYW1zLnRob3VzYW5kIHx8IFwiLFwiO1xuXHRcdFx0dmFyIHN5bWJvbCA9IGZvcm1hdHRlclBhcmFtcy5zeW1ib2wgfHwgXCJcIjtcblx0XHRcdHZhciBhZnRlciA9ICEhZm9ybWF0dGVyUGFyYW1zLnN5bWJvbEFmdGVyO1xuXHRcdFx0dmFyIHByZWNpc2lvbiA9IHR5cGVvZiBmb3JtYXR0ZXJQYXJhbXMucHJlY2lzaW9uICE9PSBcInVuZGVmaW5lZFwiID8gZm9ybWF0dGVyUGFyYW1zLnByZWNpc2lvbiA6IDI7XG5cblx0XHRcdGlmIChpc05hTihmbG9hdFZhbCkpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZW1wdHlUb1NwYWNlKHRoaXMuc2FuaXRpemVIVE1MKGNlbGwuZ2V0VmFsdWUoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRudW1iZXIgPSBwcmVjaXNpb24gIT09IGZhbHNlID8gZmxvYXRWYWwudG9GaXhlZChwcmVjaXNpb24pIDogZmxvYXRWYWw7XG5cdFx0XHRudW1iZXIgPSBTdHJpbmcobnVtYmVyKS5zcGxpdChcIi5cIik7XG5cblx0XHRcdGludGVnZXIgPSBudW1iZXJbMF07XG5cdFx0XHRkZWNpbWFsID0gbnVtYmVyLmxlbmd0aCA+IDEgPyBkZWNpbWFsU3ltICsgbnVtYmVyWzFdIDogXCJcIjtcblxuXHRcdFx0cmd4ID0gLyhcXGQrKShcXGR7M30pLztcblxuXHRcdFx0d2hpbGUgKHJneC50ZXN0KGludGVnZXIpKSB7XG5cdFx0XHRcdGludGVnZXIgPSBpbnRlZ2VyLnJlcGxhY2Uocmd4LCBcIiQxXCIgKyB0aG91c2FuZFN5bSArIFwiJDJcIik7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBhZnRlciA/IGludGVnZXIgKyBkZWNpbWFsICsgc3ltYm9sIDogc3ltYm9sICsgaW50ZWdlciArIGRlY2ltYWw7XG5cdFx0fSxcblxuXHRcdC8vY2xpY2thYmxlIGFuY2hvciB0YWdcblx0XHRsaW5rOiBmdW5jdGlvbiBsaW5rKGNlbGwsIGZvcm1hdHRlclBhcmFtcywgb25SZW5kZXJlZCkge1xuXHRcdFx0dmFyIHZhbHVlID0gY2VsbC5nZXRWYWx1ZSgpLFxuXHRcdFx0ICAgIHVybFByZWZpeCA9IGZvcm1hdHRlclBhcmFtcy51cmxQcmVmaXggfHwgXCJcIixcblx0XHRcdCAgICBkb3dubG9hZCA9IGZvcm1hdHRlclBhcmFtcy5kb3dubG9hZCxcblx0XHRcdCAgICBsYWJlbCA9IHZhbHVlLFxuXHRcdFx0ICAgIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIiksXG5cdFx0XHQgICAgZGF0YTtcblxuXHRcdFx0aWYgKGZvcm1hdHRlclBhcmFtcy5sYWJlbEZpZWxkKSB7XG5cdFx0XHRcdGRhdGEgPSBjZWxsLmdldERhdGEoKTtcblx0XHRcdFx0bGFiZWwgPSBkYXRhW2Zvcm1hdHRlclBhcmFtcy5sYWJlbEZpZWxkXTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGZvcm1hdHRlclBhcmFtcy5sYWJlbCkge1xuXHRcdFx0XHRzd2l0Y2ggKF90eXBlb2YoZm9ybWF0dGVyUGFyYW1zLmxhYmVsKSkge1xuXHRcdFx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0XHRcdGxhYmVsID0gZm9ybWF0dGVyUGFyYW1zLmxhYmVsO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0XHRcdGxhYmVsID0gZm9ybWF0dGVyUGFyYW1zLmxhYmVsKGNlbGwpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKGxhYmVsKSB7XG5cdFx0XHRcdGlmIChmb3JtYXR0ZXJQYXJhbXMudXJsRmllbGQpIHtcblx0XHRcdFx0XHRkYXRhID0gY2VsbC5nZXREYXRhKCk7XG5cdFx0XHRcdFx0dmFsdWUgPSBkYXRhW2Zvcm1hdHRlclBhcmFtcy51cmxGaWVsZF07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoZm9ybWF0dGVyUGFyYW1zLnVybCkge1xuXHRcdFx0XHRcdHN3aXRjaCAoX3R5cGVvZihmb3JtYXR0ZXJQYXJhbXMudXJsKSkge1xuXHRcdFx0XHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHRcdFx0XHR2YWx1ZSA9IGZvcm1hdHRlclBhcmFtcy51cmw7XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0XHRcdFx0dmFsdWUgPSBmb3JtYXR0ZXJQYXJhbXMudXJsKGNlbGwpO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRlbC5zZXRBdHRyaWJ1dGUoXCJocmVmXCIsIHVybFByZWZpeCArIHZhbHVlKTtcblxuXHRcdFx0XHRpZiAoZm9ybWF0dGVyUGFyYW1zLnRhcmdldCkge1xuXHRcdFx0XHRcdGVsLnNldEF0dHJpYnV0ZShcInRhcmdldFwiLCBmb3JtYXR0ZXJQYXJhbXMudGFyZ2V0KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChmb3JtYXR0ZXJQYXJhbXMuZG93bmxvYWQpIHtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YgZG93bmxvYWQgPT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRkb3dubG9hZCA9IGRvd25sb2FkKGNlbGwpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRkb3dubG9hZCA9IGRvd25sb2FkID09PSB0cnVlID8gXCJcIiA6IGRvd25sb2FkO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGVsLnNldEF0dHJpYnV0ZShcImRvd25sb2FkXCIsIGRvd25sb2FkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGVsLmlubmVySFRNTCA9IHRoaXMuZW1wdHlUb1NwYWNlKHRoaXMuc2FuaXRpemVIVE1MKGxhYmVsKSk7XG5cblx0XHRcdFx0cmV0dXJuIGVsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIFwiJm5ic3A7XCI7XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdC8vaW1hZ2UgZWxlbWVudFxuXHRcdGltYWdlOiBmdW5jdGlvbiBpbWFnZShjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0XHRcdHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XG5cdFx0XHRlbC5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgY2VsbC5nZXRWYWx1ZSgpKTtcblxuXHRcdFx0c3dpdGNoIChfdHlwZW9mKGZvcm1hdHRlclBhcmFtcy5oZWlnaHQpKSB7XG5cdFx0XHRcdGNhc2UgXCJudW1iZXJcIjpcblx0XHRcdFx0XHRlbC5zdHlsZS5oZWlnaHQgPSBmb3JtYXR0ZXJQYXJhbXMuaGVpZ2h0ICsgXCJweFwiO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0XHRlbC5zdHlsZS5oZWlnaHQgPSBmb3JtYXR0ZXJQYXJhbXMuaGVpZ2h0O1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXG5cdFx0XHRzd2l0Y2ggKF90eXBlb2YoZm9ybWF0dGVyUGFyYW1zLndpZHRoKSkge1xuXHRcdFx0XHRjYXNlIFwibnVtYmVyXCI6XG5cdFx0XHRcdFx0ZWwuc3R5bGUud2lkdGggPSBmb3JtYXR0ZXJQYXJhbXMud2lkdGggKyBcInB4XCI7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHRcdGVsLnN0eWxlLndpZHRoID0gZm9ybWF0dGVyUGFyYW1zLndpZHRoO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXG5cdFx0XHRlbC5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdGNlbGwuZ2V0Um93KCkubm9ybWFsaXplSGVpZ2h0KCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIGVsO1xuXHRcdH0sXG5cblx0XHQvL3RpY2sgb3IgY3Jvc3Ncblx0XHR0aWNrQ3Jvc3M6IGZ1bmN0aW9uIHRpY2tDcm9zcyhjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0XHRcdHZhciB2YWx1ZSA9IGNlbGwuZ2V0VmFsdWUoKSxcblx0XHRcdCAgICBlbGVtZW50ID0gY2VsbC5nZXRFbGVtZW50KCksXG5cdFx0XHQgICAgZW1wdHkgPSBmb3JtYXR0ZXJQYXJhbXMuYWxsb3dFbXB0eSxcblx0XHRcdCAgICB0cnV0aHkgPSBmb3JtYXR0ZXJQYXJhbXMuYWxsb3dUcnV0aHksXG5cdFx0XHQgICAgdGljayA9IHR5cGVvZiBmb3JtYXR0ZXJQYXJhbXMudGlja0VsZW1lbnQgIT09IFwidW5kZWZpbmVkXCIgPyBmb3JtYXR0ZXJQYXJhbXMudGlja0VsZW1lbnQgOiAnPHN2ZyBlbmFibGUtYmFja2dyb3VuZD1cIm5ldyAwIDAgMjQgMjRcIiBoZWlnaHQ9XCIxNFwiIHdpZHRoPVwiMTRcIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCIgeG1sOnNwYWNlPVwicHJlc2VydmVcIiA+PHBhdGggZmlsbD1cIiMyREMyMTRcIiBjbGlwLXJ1bGU9XCJldmVub2RkXCIgZD1cIk0yMS42NTIsMy4yMTFjLTAuMjkzLTAuMjk1LTAuNzctMC4yOTUtMS4wNjEsMEw5LjQxLDE0LjM0ICBjLTAuMjkzLDAuMjk3LTAuNzcxLDAuMjk3LTEuMDYyLDBMMy40NDksOS4zNTFDMy4zMDQsOS4yMDMsMy4xMTQsOS4xMywyLjkyMyw5LjEyOUMyLjczLDkuMTI4LDIuNTM0LDkuMjAxLDIuMzg3LDkuMzUxICBsLTIuMTY1LDEuOTQ2QzAuMDc4LDExLjQ0NSwwLDExLjYzLDAsMTEuODIzYzAsMC4xOTQsMC4wNzgsMC4zOTcsMC4yMjMsMC41NDRsNC45NCw1LjE4NGMwLjI5MiwwLjI5NiwwLjc3MSwwLjc3NiwxLjA2MiwxLjA3ICBsMi4xMjQsMi4xNDFjMC4yOTIsMC4yOTMsMC43NjksMC4yOTMsMS4wNjIsMGwxNC4zNjYtMTQuMzRjMC4yOTMtMC4yOTQsMC4yOTMtMC43NzcsMC0xLjA3MUwyMS42NTIsMy4yMTF6XCIgZmlsbC1ydWxlPVwiZXZlbm9kZFwiLz48L3N2Zz4nLFxuXHRcdFx0ICAgIGNyb3NzID0gdHlwZW9mIGZvcm1hdHRlclBhcmFtcy5jcm9zc0VsZW1lbnQgIT09IFwidW5kZWZpbmVkXCIgPyBmb3JtYXR0ZXJQYXJhbXMuY3Jvc3NFbGVtZW50IDogJzxzdmcgZW5hYmxlLWJhY2tncm91bmQ9XCJuZXcgMCAwIDI0IDI0XCIgaGVpZ2h0PVwiMTRcIiB3aWR0aD1cIjE0XCIgIHZpZXdCb3g9XCIwIDAgMjQgMjRcIiB4bWw6c3BhY2U9XCJwcmVzZXJ2ZVwiID48cGF0aCBmaWxsPVwiI0NFMTUxNVwiIGQ9XCJNMjIuMjQ1LDQuMDE1YzAuMzEzLDAuMzEzLDAuMzEzLDAuODI2LDAsMS4xMzlsLTYuMjc2LDYuMjdjLTAuMzEzLDAuMzEyLTAuMzEzLDAuODI2LDAsMS4xNGw2LjI3Myw2LjI3MiAgYzAuMzEzLDAuMzEzLDAuMzEzLDAuODI2LDAsMS4xNGwtMi4yODUsMi4yNzdjLTAuMzE0LDAuMzEyLTAuODI4LDAuMzEyLTEuMTQyLDBsLTYuMjcxLTYuMjcxYy0wLjMxMy0wLjMxMy0wLjgyOC0wLjMxMy0xLjE0MSwwICBsLTYuMjc2LDYuMjY3Yy0wLjMxMywwLjMxMy0wLjgyOCwwLjMxMy0xLjE0MSwwbC0yLjI4Mi0yLjI4Yy0wLjMxMy0wLjMxMy0wLjMxMy0wLjgyNiwwLTEuMTRsNi4yNzgtNi4yNjkgIGMwLjMxMy0wLjMxMiwwLjMxMy0wLjgyNiwwLTEuMTRMMS43MDksNS4xNDdjLTAuMzE0LTAuMzEzLTAuMzE0LTAuODI3LDAtMS4xNGwyLjI4NC0yLjI3OEM0LjMwOCwxLjQxNyw0LjgyMSwxLjQxNyw1LjEzNSwxLjczICBMMTEuNDA1LDhjMC4zMTQsMC4zMTQsMC44MjgsMC4zMTQsMS4xNDEsMC4wMDFsNi4yNzYtNi4yNjdjMC4zMTItMC4zMTIsMC44MjYtMC4zMTIsMS4xNDEsMEwyMi4yNDUsNC4wMTV6XCIvPjwvc3ZnPic7XG5cblx0XHRcdGlmICh0cnV0aHkgJiYgdmFsdWUgfHwgdmFsdWUgPT09IHRydWUgfHwgdmFsdWUgPT09IFwidHJ1ZVwiIHx8IHZhbHVlID09PSBcIlRydWVcIiB8fCB2YWx1ZSA9PT0gMSB8fCB2YWx1ZSA9PT0gXCIxXCIpIHtcblx0XHRcdFx0ZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWNoZWNrZWRcIiwgdHJ1ZSk7XG5cdFx0XHRcdHJldHVybiB0aWNrIHx8IFwiXCI7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAoZW1wdHkgJiYgKHZhbHVlID09PSBcIm51bGxcIiB8fCB2YWx1ZSA9PT0gXCJcIiB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCIpKSB7XG5cdFx0XHRcdFx0ZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWNoZWNrZWRcIiwgXCJtaXhlZFwiKTtcblx0XHRcdFx0XHRyZXR1cm4gXCJcIjtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRlbGVtZW50LnNldEF0dHJpYnV0ZShcImFyaWEtY2hlY2tlZFwiLCBmYWxzZSk7XG5cdFx0XHRcdFx0cmV0dXJuIGNyb3NzIHx8IFwiXCI7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0ZGF0ZXRpbWU6IGZ1bmN0aW9uIGRhdGV0aW1lKGNlbGwsIGZvcm1hdHRlclBhcmFtcywgb25SZW5kZXJlZCkge1xuXHRcdFx0dmFyIGlucHV0Rm9ybWF0ID0gZm9ybWF0dGVyUGFyYW1zLmlucHV0Rm9ybWF0IHx8IFwiWVlZWS1NTS1ERCBoaDptbTpzc1wiO1xuXHRcdFx0dmFyIG91dHB1dEZvcm1hdCA9IGZvcm1hdHRlclBhcmFtcy5vdXRwdXRGb3JtYXQgfHwgXCJERC9NTS9ZWVlZIGhoOm1tOnNzXCI7XG5cdFx0XHR2YXIgaW52YWxpZCA9IHR5cGVvZiBmb3JtYXR0ZXJQYXJhbXMuaW52YWxpZFBsYWNlaG9sZGVyICE9PSBcInVuZGVmaW5lZFwiID8gZm9ybWF0dGVyUGFyYW1zLmludmFsaWRQbGFjZWhvbGRlciA6IFwiXCI7XG5cdFx0XHR2YXIgdmFsdWUgPSBjZWxsLmdldFZhbHVlKCk7XG5cblx0XHRcdHZhciBuZXdEYXRldGltZSA9IG1vbWVudCh2YWx1ZSwgaW5wdXRGb3JtYXQpO1xuXG5cdFx0XHRpZiAobmV3RGF0ZXRpbWUuaXNWYWxpZCgpKSB7XG5cdFx0XHRcdHJldHVybiBmb3JtYXR0ZXJQYXJhbXMudGltZXpvbmUgPyBuZXdEYXRldGltZS50eihmb3JtYXR0ZXJQYXJhbXMudGltZXpvbmUpLmZvcm1hdChvdXRwdXRGb3JtYXQpIDogbmV3RGF0ZXRpbWUuZm9ybWF0KG91dHB1dEZvcm1hdCk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGlmIChpbnZhbGlkID09PSB0cnVlKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZiBpbnZhbGlkID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRyZXR1cm4gaW52YWxpZCh2YWx1ZSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cmV0dXJuIGludmFsaWQ7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0ZGF0ZXRpbWVkaWZmOiBmdW5jdGlvbiBkYXRldGltZShjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0XHRcdHZhciBpbnB1dEZvcm1hdCA9IGZvcm1hdHRlclBhcmFtcy5pbnB1dEZvcm1hdCB8fCBcIllZWVktTU0tREQgaGg6bW06c3NcIjtcblx0XHRcdHZhciBpbnZhbGlkID0gdHlwZW9mIGZvcm1hdHRlclBhcmFtcy5pbnZhbGlkUGxhY2Vob2xkZXIgIT09IFwidW5kZWZpbmVkXCIgPyBmb3JtYXR0ZXJQYXJhbXMuaW52YWxpZFBsYWNlaG9sZGVyIDogXCJcIjtcblx0XHRcdHZhciBzdWZmaXggPSB0eXBlb2YgZm9ybWF0dGVyUGFyYW1zLnN1ZmZpeCAhPT0gXCJ1bmRlZmluZWRcIiA/IGZvcm1hdHRlclBhcmFtcy5zdWZmaXggOiBmYWxzZTtcblx0XHRcdHZhciB1bml0ID0gdHlwZW9mIGZvcm1hdHRlclBhcmFtcy51bml0ICE9PSBcInVuZGVmaW5lZFwiID8gZm9ybWF0dGVyUGFyYW1zLnVuaXQgOiB1bmRlZmluZWQ7XG5cdFx0XHR2YXIgaHVtYW5pemUgPSB0eXBlb2YgZm9ybWF0dGVyUGFyYW1zLmh1bWFuaXplICE9PSBcInVuZGVmaW5lZFwiID8gZm9ybWF0dGVyUGFyYW1zLmh1bWFuaXplIDogZmFsc2U7XG5cdFx0XHR2YXIgZGF0ZSA9IHR5cGVvZiBmb3JtYXR0ZXJQYXJhbXMuZGF0ZSAhPT0gXCJ1bmRlZmluZWRcIiA/IGZvcm1hdHRlclBhcmFtcy5kYXRlIDogbW9tZW50KCk7XG5cdFx0XHR2YXIgdmFsdWUgPSBjZWxsLmdldFZhbHVlKCk7XG5cblx0XHRcdHZhciBuZXdEYXRldGltZSA9IG1vbWVudCh2YWx1ZSwgaW5wdXRGb3JtYXQpO1xuXG5cdFx0XHRpZiAobmV3RGF0ZXRpbWUuaXNWYWxpZCgpKSB7XG5cdFx0XHRcdGlmIChodW1hbml6ZSkge1xuXHRcdFx0XHRcdHJldHVybiBtb21lbnQuZHVyYXRpb24obmV3RGF0ZXRpbWUuZGlmZihkYXRlKSkuaHVtYW5pemUoc3VmZml4KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3RGF0ZXRpbWUuZGlmZihkYXRlLCB1bml0KSArIChzdWZmaXggPyBcIiBcIiArIHN1ZmZpeCA6IFwiXCIpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGlmIChpbnZhbGlkID09PSB0cnVlKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZiBpbnZhbGlkID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRyZXR1cm4gaW52YWxpZCh2YWx1ZSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cmV0dXJuIGludmFsaWQ7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0Ly9zZWxlY3Rcblx0XHRsb29rdXA6IGZ1bmN0aW9uIGxvb2t1cChjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0XHRcdHZhciB2YWx1ZSA9IGNlbGwuZ2V0VmFsdWUoKTtcblxuXHRcdFx0aWYgKHR5cGVvZiBmb3JtYXR0ZXJQYXJhbXNbdmFsdWVdID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybignTWlzc2luZyBkaXNwbGF5IHZhbHVlIGZvciAnICsgdmFsdWUpO1xuXHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBmb3JtYXR0ZXJQYXJhbXNbdmFsdWVdO1xuXHRcdH0sXG5cblx0XHQvL3N0YXIgcmF0aW5nXG5cdFx0c3RhcjogZnVuY3Rpb24gc3RhcihjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0XHRcdHZhciB2YWx1ZSA9IGNlbGwuZ2V0VmFsdWUoKSxcblx0XHRcdCAgICBlbGVtZW50ID0gY2VsbC5nZXRFbGVtZW50KCksXG5cdFx0XHQgICAgbWF4U3RhcnMgPSBmb3JtYXR0ZXJQYXJhbXMgJiYgZm9ybWF0dGVyUGFyYW1zLnN0YXJzID8gZm9ybWF0dGVyUGFyYW1zLnN0YXJzIDogNSxcblx0XHRcdCAgICBzdGFycyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpLFxuXHRcdFx0ICAgIHN0YXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgXCJzdmdcIiksXG5cdFx0XHQgICAgc3RhckFjdGl2ZSA9ICc8cG9seWdvbiBmaWxsPVwiI0ZGRUEwMFwiIHN0cm9rZT1cIiNDMUFCNjBcIiBzdHJva2Utd2lkdGg9XCIzNy42MTUyXCIgc3Ryb2tlLWxpbmVjYXA9XCJyb3VuZFwiIHN0cm9rZS1saW5lam9pbj1cInJvdW5kXCIgc3Ryb2tlLW1pdGVybGltaXQ9XCIxMFwiIHBvaW50cz1cIjI1OS4yMTYsMjkuOTQyIDMzMC4yNywxNzMuOTE5IDQ4OS4xNiwxOTcuMDA3IDM3NC4xODUsMzA5LjA4IDQwMS4zMyw0NjcuMzEgMjU5LjIxNiwzOTIuNjEyIDExNy4xMDQsNDY3LjMxIDE0NC4yNSwzMDkuMDggMjkuMjc0LDE5Ny4wMDcgMTg4LjE2NSwxNzMuOTE5IFwiLz4nLFxuXHRcdFx0ICAgIHN0YXJJbmFjdGl2ZSA9ICc8cG9seWdvbiBmaWxsPVwiI0QyRDJEMlwiIHN0cm9rZT1cIiM2ODY4NjhcIiBzdHJva2Utd2lkdGg9XCIzNy42MTUyXCIgc3Ryb2tlLWxpbmVjYXA9XCJyb3VuZFwiIHN0cm9rZS1saW5lam9pbj1cInJvdW5kXCIgc3Ryb2tlLW1pdGVybGltaXQ9XCIxMFwiIHBvaW50cz1cIjI1OS4yMTYsMjkuOTQyIDMzMC4yNywxNzMuOTE5IDQ4OS4xNiwxOTcuMDA3IDM3NC4xODUsMzA5LjA4IDQwMS4zMyw0NjcuMzEgMjU5LjIxNiwzOTIuNjEyIDExNy4xMDQsNDY3LjMxIDE0NC4yNSwzMDkuMDggMjkuMjc0LDE5Ny4wMDcgMTg4LjE2NSwxNzMuOTE5IFwiLz4nO1xuXG5cdFx0XHQvL3N0eWxlIHN0YXJzIGhvbGRlclxuXHRcdFx0c3RhcnMuc3R5bGUudmVydGljYWxBbGlnbiA9IFwibWlkZGxlXCI7XG5cblx0XHRcdC8vc3R5bGUgc3RhclxuXHRcdFx0c3Rhci5zZXRBdHRyaWJ1dGUoXCJ3aWR0aFwiLCBcIjE0XCIpO1xuXHRcdFx0c3Rhci5zZXRBdHRyaWJ1dGUoXCJoZWlnaHRcIiwgXCIxNFwiKTtcblx0XHRcdHN0YXIuc2V0QXR0cmlidXRlKFwidmlld0JveFwiLCBcIjAgMCA1MTIgNTEyXCIpO1xuXHRcdFx0c3Rhci5zZXRBdHRyaWJ1dGUoXCJ4bWw6c3BhY2VcIiwgXCJwcmVzZXJ2ZVwiKTtcblx0XHRcdHN0YXIuc3R5bGUucGFkZGluZyA9IFwiMCAxcHhcIjtcblxuXHRcdFx0dmFsdWUgPSB2YWx1ZSAmJiAhaXNOYU4odmFsdWUpID8gcGFyc2VJbnQodmFsdWUpIDogMDtcblxuXHRcdFx0dmFsdWUgPSBNYXRoLm1heCgwLCBNYXRoLm1pbih2YWx1ZSwgbWF4U3RhcnMpKTtcblxuXHRcdFx0Zm9yICh2YXIgaSA9IDE7IGkgPD0gbWF4U3RhcnM7IGkrKykge1xuXHRcdFx0XHR2YXIgbmV4dFN0YXIgPSBzdGFyLmNsb25lTm9kZSh0cnVlKTtcblx0XHRcdFx0bmV4dFN0YXIuaW5uZXJIVE1MID0gaSA8PSB2YWx1ZSA/IHN0YXJBY3RpdmUgOiBzdGFySW5hY3RpdmU7XG5cblx0XHRcdFx0c3RhcnMuYXBwZW5kQ2hpbGQobmV4dFN0YXIpO1xuXHRcdFx0fVxuXG5cdFx0XHRlbGVtZW50LnN0eWxlLndoaXRlU3BhY2UgPSBcIm5vd3JhcFwiO1xuXHRcdFx0ZWxlbWVudC5zdHlsZS5vdmVyZmxvdyA9IFwiaGlkZGVuXCI7XG5cdFx0XHRlbGVtZW50LnN0eWxlLnRleHRPdmVyZmxvdyA9IFwiZWxsaXBzaXNcIjtcblxuXHRcdFx0ZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIHZhbHVlKTtcblxuXHRcdFx0cmV0dXJuIHN0YXJzO1xuXHRcdH0sXG5cblx0XHR0cmFmZmljOiBmdW5jdGlvbiB0cmFmZmljKGNlbGwsIGZvcm1hdHRlclBhcmFtcywgb25SZW5kZXJlZCkge1xuXHRcdFx0dmFyIHZhbHVlID0gdGhpcy5zYW5pdGl6ZUhUTUwoY2VsbC5nZXRWYWx1ZSgpKSB8fCAwLFxuXHRcdFx0ICAgIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIiksXG5cdFx0XHQgICAgbWF4ID0gZm9ybWF0dGVyUGFyYW1zICYmIGZvcm1hdHRlclBhcmFtcy5tYXggPyBmb3JtYXR0ZXJQYXJhbXMubWF4IDogMTAwLFxuXHRcdFx0ICAgIG1pbiA9IGZvcm1hdHRlclBhcmFtcyAmJiBmb3JtYXR0ZXJQYXJhbXMubWluID8gZm9ybWF0dGVyUGFyYW1zLm1pbiA6IDAsXG5cdFx0XHQgICAgY29sb3JzID0gZm9ybWF0dGVyUGFyYW1zICYmIHR5cGVvZiBmb3JtYXR0ZXJQYXJhbXMuY29sb3IgIT09IFwidW5kZWZpbmVkXCIgPyBmb3JtYXR0ZXJQYXJhbXMuY29sb3IgOiBbXCJyZWRcIiwgXCJvcmFuZ2VcIiwgXCJncmVlblwiXSxcblx0XHRcdCAgICBjb2xvciA9IFwiIzY2NjY2NlwiLFxuXHRcdFx0ICAgIHBlcmNlbnQsXG5cdFx0XHQgICAgcGVyY2VudFZhbHVlO1xuXG5cdFx0XHRpZiAoaXNOYU4odmFsdWUpIHx8IHR5cGVvZiBjZWxsLmdldFZhbHVlKCkgPT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXRyYWZmaWMtbGlnaHRcIik7XG5cblx0XHRcdC8vbWFrZSBzdXJlIHZhbHVlIGlzIGluIHJhbmdlXG5cdFx0XHRwZXJjZW50VmFsdWUgPSBwYXJzZUZsb2F0KHZhbHVlKSA8PSBtYXggPyBwYXJzZUZsb2F0KHZhbHVlKSA6IG1heDtcblx0XHRcdHBlcmNlbnRWYWx1ZSA9IHBhcnNlRmxvYXQocGVyY2VudFZhbHVlKSA+PSBtaW4gPyBwYXJzZUZsb2F0KHBlcmNlbnRWYWx1ZSkgOiBtaW47XG5cblx0XHRcdC8vd29ya291dCBwZXJjZW50YWdlXG5cdFx0XHRwZXJjZW50ID0gKG1heCAtIG1pbikgLyAxMDA7XG5cdFx0XHRwZXJjZW50VmFsdWUgPSBNYXRoLnJvdW5kKChwZXJjZW50VmFsdWUgLSBtaW4pIC8gcGVyY2VudCk7XG5cblx0XHRcdC8vc2V0IGNvbG9yXG5cdFx0XHRzd2l0Y2ggKHR5cGVvZiBjb2xvcnMgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGNvbG9ycykpIHtcblx0XHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHRcdGNvbG9yID0gY29sb3JzO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0XHRjb2xvciA9IGNvbG9ycyh2YWx1ZSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgXCJvYmplY3RcIjpcblx0XHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShjb2xvcnMpKSB7XG5cdFx0XHRcdFx0XHR2YXIgdW5pdCA9IDEwMCAvIGNvbG9ycy5sZW5ndGg7XG5cdFx0XHRcdFx0XHR2YXIgaW5kZXggPSBNYXRoLmZsb29yKHBlcmNlbnRWYWx1ZSAvIHVuaXQpO1xuXG5cdFx0XHRcdFx0XHRpbmRleCA9IE1hdGgubWluKGluZGV4LCBjb2xvcnMubGVuZ3RoIC0gMSk7XG5cdFx0XHRcdFx0XHRpbmRleCA9IE1hdGgubWF4KGluZGV4LCAwKTtcblx0XHRcdFx0XHRcdGNvbG9yID0gY29sb3JzW2luZGV4XTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZWwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3I7XG5cblx0XHRcdHJldHVybiBlbDtcblx0XHR9LFxuXG5cdFx0Ly9wcm9ncmVzcyBiYXJcblx0XHRwcm9ncmVzczogZnVuY3Rpb24gcHJvZ3Jlc3MoY2VsbCwgZm9ybWF0dGVyUGFyYW1zLCBvblJlbmRlcmVkKSB7XG5cdFx0XHQvL3Byb2dyZXNzIGJhclxuXHRcdFx0dmFyIHZhbHVlID0gdGhpcy5zYW5pdGl6ZUhUTUwoY2VsbC5nZXRWYWx1ZSgpKSB8fCAwLFxuXHRcdFx0ICAgIGVsZW1lbnQgPSBjZWxsLmdldEVsZW1lbnQoKSxcblx0XHRcdCAgICBtYXggPSBmb3JtYXR0ZXJQYXJhbXMgJiYgZm9ybWF0dGVyUGFyYW1zLm1heCA/IGZvcm1hdHRlclBhcmFtcy5tYXggOiAxMDAsXG5cdFx0XHQgICAgbWluID0gZm9ybWF0dGVyUGFyYW1zICYmIGZvcm1hdHRlclBhcmFtcy5taW4gPyBmb3JtYXR0ZXJQYXJhbXMubWluIDogMCxcblx0XHRcdCAgICBsZWdlbmRBbGlnbiA9IGZvcm1hdHRlclBhcmFtcyAmJiBmb3JtYXR0ZXJQYXJhbXMubGVnZW5kQWxpZ24gPyBmb3JtYXR0ZXJQYXJhbXMubGVnZW5kQWxpZ24gOiBcImNlbnRlclwiLFxuXHRcdFx0ICAgIHBlcmNlbnQsXG5cdFx0XHQgICAgcGVyY2VudFZhbHVlLFxuXHRcdFx0ICAgIGNvbG9yLFxuXHRcdFx0ICAgIGxlZ2VuZCxcblx0XHRcdCAgICBsZWdlbmRDb2xvcixcblx0XHRcdCAgICB0b3AsXG5cdFx0XHQgICAgbGVmdCxcblx0XHRcdCAgICByaWdodCxcblx0XHRcdCAgICBib3R0b207XG5cblx0XHRcdC8vbWFrZSBzdXJlIHZhbHVlIGlzIGluIHJhbmdlXG5cdFx0XHRwZXJjZW50VmFsdWUgPSBwYXJzZUZsb2F0KHZhbHVlKSA8PSBtYXggPyBwYXJzZUZsb2F0KHZhbHVlKSA6IG1heDtcblx0XHRcdHBlcmNlbnRWYWx1ZSA9IHBhcnNlRmxvYXQocGVyY2VudFZhbHVlKSA+PSBtaW4gPyBwYXJzZUZsb2F0KHBlcmNlbnRWYWx1ZSkgOiBtaW47XG5cblx0XHRcdC8vd29ya291dCBwZXJjZW50YWdlXG5cdFx0XHRwZXJjZW50ID0gKG1heCAtIG1pbikgLyAxMDA7XG5cdFx0XHRwZXJjZW50VmFsdWUgPSBNYXRoLnJvdW5kKChwZXJjZW50VmFsdWUgLSBtaW4pIC8gcGVyY2VudCk7XG5cblx0XHRcdC8vc2V0IGJhciBjb2xvclxuXHRcdFx0c3dpdGNoIChfdHlwZW9mKGZvcm1hdHRlclBhcmFtcy5jb2xvcikpIHtcblx0XHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHRcdGNvbG9yID0gZm9ybWF0dGVyUGFyYW1zLmNvbG9yO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0XHRjb2xvciA9IGZvcm1hdHRlclBhcmFtcy5jb2xvcih2YWx1ZSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgXCJvYmplY3RcIjpcblx0XHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShmb3JtYXR0ZXJQYXJhbXMuY29sb3IpKSB7XG5cdFx0XHRcdFx0XHR2YXIgdW5pdCA9IDEwMCAvIGZvcm1hdHRlclBhcmFtcy5jb2xvci5sZW5ndGg7XG5cdFx0XHRcdFx0XHR2YXIgaW5kZXggPSBNYXRoLmZsb29yKHBlcmNlbnRWYWx1ZSAvIHVuaXQpO1xuXG5cdFx0XHRcdFx0XHRpbmRleCA9IE1hdGgubWluKGluZGV4LCBmb3JtYXR0ZXJQYXJhbXMuY29sb3IubGVuZ3RoIC0gMSk7XG5cdFx0XHRcdFx0XHRpbmRleCA9IE1hdGgubWF4KGluZGV4LCAwKTtcblx0XHRcdFx0XHRcdGNvbG9yID0gZm9ybWF0dGVyUGFyYW1zLmNvbG9yW2luZGV4XTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRjb2xvciA9IFwiIzJEQzIxNFwiO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2dlbmVyYXRlIGxlZ2VuZFxuXHRcdFx0c3dpdGNoIChfdHlwZW9mKGZvcm1hdHRlclBhcmFtcy5sZWdlbmQpKSB7XG5cdFx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0XHRsZWdlbmQgPSBmb3JtYXR0ZXJQYXJhbXMubGVnZW5kO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0XHRsZWdlbmQgPSBmb3JtYXR0ZXJQYXJhbXMubGVnZW5kKHZhbHVlKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBcImJvb2xlYW5cIjpcblx0XHRcdFx0XHRsZWdlbmQgPSB2YWx1ZTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRsZWdlbmQgPSBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0Ly9zZXQgbGVnZW5kIGNvbG9yXG5cdFx0XHRzd2l0Y2ggKF90eXBlb2YoZm9ybWF0dGVyUGFyYW1zLmxlZ2VuZENvbG9yKSkge1xuXHRcdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdFx0bGVnZW5kQ29sb3IgPSBmb3JtYXR0ZXJQYXJhbXMubGVnZW5kQ29sb3I7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgXCJmdW5jdGlvblwiOlxuXHRcdFx0XHRcdGxlZ2VuZENvbG9yID0gZm9ybWF0dGVyUGFyYW1zLmxlZ2VuZENvbG9yKHZhbHVlKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBcIm9iamVjdFwiOlxuXHRcdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KGZvcm1hdHRlclBhcmFtcy5sZWdlbmRDb2xvcikpIHtcblx0XHRcdFx0XHRcdHZhciB1bml0ID0gMTAwIC8gZm9ybWF0dGVyUGFyYW1zLmxlZ2VuZENvbG9yLmxlbmd0aDtcblx0XHRcdFx0XHRcdHZhciBpbmRleCA9IE1hdGguZmxvb3IocGVyY2VudFZhbHVlIC8gdW5pdCk7XG5cblx0XHRcdFx0XHRcdGluZGV4ID0gTWF0aC5taW4oaW5kZXgsIGZvcm1hdHRlclBhcmFtcy5sZWdlbmRDb2xvci5sZW5ndGggLSAxKTtcblx0XHRcdFx0XHRcdGluZGV4ID0gTWF0aC5tYXgoaW5kZXgsIDApO1xuXHRcdFx0XHRcdFx0bGVnZW5kQ29sb3IgPSBmb3JtYXR0ZXJQYXJhbXMubGVnZW5kQ29sb3JbaW5kZXhdO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRsZWdlbmRDb2xvciA9IFwiIzAwMFwiO1xuXHRcdFx0fVxuXG5cdFx0XHRlbGVtZW50LnN0eWxlLm1pbldpZHRoID0gXCIzMHB4XCI7XG5cdFx0XHRlbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gXCJyZWxhdGl2ZVwiO1xuXG5cdFx0XHRlbGVtZW50LnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgcGVyY2VudFZhbHVlKTtcblxuXHRcdFx0dmFyIGJhckVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcdGJhckVsLnN0eWxlLmRpc3BsYXkgPSBcImlubGluZS1ibG9ja1wiO1xuXHRcdFx0YmFyRWwuc3R5bGUucG9zaXRpb24gPSBcInJlbGF0aXZlXCI7XG5cdFx0XHRiYXJFbC5zdHlsZS53aWR0aCA9IHBlcmNlbnRWYWx1ZSArIFwiJVwiO1xuXHRcdFx0YmFyRWwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3I7XG5cdFx0XHRiYXJFbC5zdHlsZS5oZWlnaHQgPSBcIjEwMCVcIjtcblxuXHRcdFx0YmFyRWwuc2V0QXR0cmlidXRlKCdkYXRhLW1heCcsIG1heCk7XG5cdFx0XHRiYXJFbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtbWluJywgbWluKTtcblxuXHRcdFx0aWYgKGxlZ2VuZCkge1xuXHRcdFx0XHR2YXIgbGVnZW5kRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0XHRsZWdlbmRFbC5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcblx0XHRcdFx0bGVnZW5kRWwuc3R5bGUudG9wID0gXCI0cHhcIjtcblx0XHRcdFx0bGVnZW5kRWwuc3R5bGUubGVmdCA9IDA7XG5cdFx0XHRcdGxlZ2VuZEVsLnN0eWxlLnRleHRBbGlnbiA9IGxlZ2VuZEFsaWduO1xuXHRcdFx0XHRsZWdlbmRFbC5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuXHRcdFx0XHRsZWdlbmRFbC5zdHlsZS5jb2xvciA9IGxlZ2VuZENvbG9yO1xuXHRcdFx0XHRsZWdlbmRFbC5pbm5lckhUTUwgPSBsZWdlbmQ7XG5cdFx0XHR9XG5cblx0XHRcdG9uUmVuZGVyZWQoZnVuY3Rpb24gKCkge1xuXG5cdFx0XHRcdC8vaGFuZGxlIGN1c3RvbSBlbGVtZW50IG5lZWRlZCBpZiBmb3JtYXR0ZXIgaXMgdG8gYmUgaW5jbHVkZWQgaW4gcHJpbnRlZC9kb3dubG9hZGVkIG91dHB1dFxuXHRcdFx0XHRpZiAoIShjZWxsIGluc3RhbmNlb2YgQ2VsbENvbXBvbmVudCkpIHtcblx0XHRcdFx0XHR2YXIgaG9sZGVyRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0XHRcdGhvbGRlckVsLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuXHRcdFx0XHRcdGhvbGRlckVsLnN0eWxlLnRvcCA9IFwiNHB4XCI7XG5cdFx0XHRcdFx0aG9sZGVyRWwuc3R5bGUuYm90dG9tID0gXCI0cHhcIjtcblx0XHRcdFx0XHRob2xkZXJFbC5zdHlsZS5sZWZ0ID0gXCI0cHhcIjtcblx0XHRcdFx0XHRob2xkZXJFbC5zdHlsZS5yaWdodCA9IFwiNHB4XCI7XG5cblx0XHRcdFx0XHRlbGVtZW50LmFwcGVuZENoaWxkKGhvbGRlckVsKTtcblxuXHRcdFx0XHRcdGVsZW1lbnQgPSBob2xkZXJFbDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGVsZW1lbnQuYXBwZW5kQ2hpbGQoYmFyRWwpO1xuXG5cdFx0XHRcdGlmIChsZWdlbmQpIHtcblx0XHRcdFx0XHRlbGVtZW50LmFwcGVuZENoaWxkKGxlZ2VuZEVsKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBcIlwiO1xuXHRcdH0sXG5cblx0XHQvL2JhY2tncm91bmQgY29sb3Jcblx0XHRjb2xvcjogZnVuY3Rpb24gY29sb3IoY2VsbCwgZm9ybWF0dGVyUGFyYW1zLCBvblJlbmRlcmVkKSB7XG5cdFx0XHRjZWxsLmdldEVsZW1lbnQoKS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSB0aGlzLnNhbml0aXplSFRNTChjZWxsLmdldFZhbHVlKCkpO1xuXHRcdFx0cmV0dXJuIFwiXCI7XG5cdFx0fSxcblxuXHRcdC8vdGljayBpY29uXG5cdFx0YnV0dG9uVGljazogZnVuY3Rpb24gYnV0dG9uVGljayhjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0XHRcdHJldHVybiAnPHN2ZyBlbmFibGUtYmFja2dyb3VuZD1cIm5ldyAwIDAgMjQgMjRcIiBoZWlnaHQ9XCIxNFwiIHdpZHRoPVwiMTRcIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCIgeG1sOnNwYWNlPVwicHJlc2VydmVcIiA+PHBhdGggZmlsbD1cIiMyREMyMTRcIiBjbGlwLXJ1bGU9XCJldmVub2RkXCIgZD1cIk0yMS42NTIsMy4yMTFjLTAuMjkzLTAuMjk1LTAuNzctMC4yOTUtMS4wNjEsMEw5LjQxLDE0LjM0ICBjLTAuMjkzLDAuMjk3LTAuNzcxLDAuMjk3LTEuMDYyLDBMMy40NDksOS4zNTFDMy4zMDQsOS4yMDMsMy4xMTQsOS4xMywyLjkyMyw5LjEyOUMyLjczLDkuMTI4LDIuNTM0LDkuMjAxLDIuMzg3LDkuMzUxICBsLTIuMTY1LDEuOTQ2QzAuMDc4LDExLjQ0NSwwLDExLjYzLDAsMTEuODIzYzAsMC4xOTQsMC4wNzgsMC4zOTcsMC4yMjMsMC41NDRsNC45NCw1LjE4NGMwLjI5MiwwLjI5NiwwLjc3MSwwLjc3NiwxLjA2MiwxLjA3ICBsMi4xMjQsMi4xNDFjMC4yOTIsMC4yOTMsMC43NjksMC4yOTMsMS4wNjIsMGwxNC4zNjYtMTQuMzRjMC4yOTMtMC4yOTQsMC4yOTMtMC43NzcsMC0xLjA3MUwyMS42NTIsMy4yMTF6XCIgZmlsbC1ydWxlPVwiZXZlbm9kZFwiLz48L3N2Zz4nO1xuXHRcdH0sXG5cblx0XHQvL2Nyb3NzIGljb25cblx0XHRidXR0b25Dcm9zczogZnVuY3Rpb24gYnV0dG9uQ3Jvc3MoY2VsbCwgZm9ybWF0dGVyUGFyYW1zLCBvblJlbmRlcmVkKSB7XG5cdFx0XHRyZXR1cm4gJzxzdmcgZW5hYmxlLWJhY2tncm91bmQ9XCJuZXcgMCAwIDI0IDI0XCIgaGVpZ2h0PVwiMTRcIiB3aWR0aD1cIjE0XCIgdmlld0JveD1cIjAgMCAyNCAyNFwiIHhtbDpzcGFjZT1cInByZXNlcnZlXCIgPjxwYXRoIGZpbGw9XCIjQ0UxNTE1XCIgZD1cIk0yMi4yNDUsNC4wMTVjMC4zMTMsMC4zMTMsMC4zMTMsMC44MjYsMCwxLjEzOWwtNi4yNzYsNi4yN2MtMC4zMTMsMC4zMTItMC4zMTMsMC44MjYsMCwxLjE0bDYuMjczLDYuMjcyICBjMC4zMTMsMC4zMTMsMC4zMTMsMC44MjYsMCwxLjE0bC0yLjI4NSwyLjI3N2MtMC4zMTQsMC4zMTItMC44MjgsMC4zMTItMS4xNDIsMGwtNi4yNzEtNi4yNzFjLTAuMzEzLTAuMzEzLTAuODI4LTAuMzEzLTEuMTQxLDAgIGwtNi4yNzYsNi4yNjdjLTAuMzEzLDAuMzEzLTAuODI4LDAuMzEzLTEuMTQxLDBsLTIuMjgyLTIuMjhjLTAuMzEzLTAuMzEzLTAuMzEzLTAuODI2LDAtMS4xNGw2LjI3OC02LjI2OSAgYzAuMzEzLTAuMzEyLDAuMzEzLTAuODI2LDAtMS4xNEwxLjcwOSw1LjE0N2MtMC4zMTQtMC4zMTMtMC4zMTQtMC44MjcsMC0xLjE0bDIuMjg0LTIuMjc4QzQuMzA4LDEuNDE3LDQuODIxLDEuNDE3LDUuMTM1LDEuNzMgIEwxMS40MDUsOGMwLjMxNCwwLjMxNCwwLjgyOCwwLjMxNCwxLjE0MSwwLjAwMWw2LjI3Ni02LjI2N2MwLjMxMi0wLjMxMiwwLjgyNi0wLjMxMiwxLjE0MSwwTDIyLjI0NSw0LjAxNXpcIi8+PC9zdmc+Jztcblx0XHR9LFxuXG5cdFx0Ly9jdXJyZW50IHJvdyBudW1iZXJcblx0XHRyb3dudW06IGZ1bmN0aW9uIHJvd251bShjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0XHRcdHJldHVybiB0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWN0aXZlUm93cy5pbmRleE9mKGNlbGwuZ2V0Um93KCkuX2dldFNlbGYoKSkgKyAxO1xuXHRcdH0sXG5cblx0XHQvL3JvdyBoYW5kbGVcblx0XHRoYW5kbGU6IGZ1bmN0aW9uIGhhbmRsZShjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0XHRcdGNlbGwuZ2V0RWxlbWVudCgpLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itcm93LWhhbmRsZVwiKTtcblx0XHRcdHJldHVybiBcIjxkaXYgY2xhc3M9J3RhYnVsYXRvci1yb3ctaGFuZGxlLWJveCc+PGRpdiBjbGFzcz0ndGFidWxhdG9yLXJvdy1oYW5kbGUtYmFyJz48L2Rpdj48ZGl2IGNsYXNzPSd0YWJ1bGF0b3Itcm93LWhhbmRsZS1iYXInPjwvZGl2PjxkaXYgY2xhc3M9J3RhYnVsYXRvci1yb3ctaGFuZGxlLWJhcic+PC9kaXY+PC9kaXY+XCI7XG5cdFx0fSxcblxuXHRcdHJlc3BvbnNpdmVDb2xsYXBzZTogZnVuY3Rpb24gcmVzcG9uc2l2ZUNvbGxhcHNlKGNlbGwsIGZvcm1hdHRlclBhcmFtcywgb25SZW5kZXJlZCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0ICAgIG9wZW4gPSBmYWxzZSxcblx0XHRcdCAgICBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiksXG5cdFx0XHQgICAgY29uZmlnID0gY2VsbC5nZXRSb3coKS5fcm93Lm1vZHVsZXMucmVzcG9uc2l2ZUxheW91dDtcblxuXHRcdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1yZXNwb25zaXZlLWNvbGxhcHNlLXRvZ2dsZVwiKTtcblx0XHRcdGVsLmlubmVySFRNTCA9IFwiPHNwYW4gY2xhc3M9J3RhYnVsYXRvci1yZXNwb25zaXZlLWNvbGxhcHNlLXRvZ2dsZS1vcGVuJz4rPC9zcGFuPjxzcGFuIGNsYXNzPSd0YWJ1bGF0b3ItcmVzcG9uc2l2ZS1jb2xsYXBzZS10b2dnbGUtY2xvc2UnPi08L3NwYW4+XCI7XG5cblx0XHRcdGNlbGwuZ2V0RWxlbWVudCgpLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itcm93LWhhbmRsZVwiKTtcblxuXHRcdFx0ZnVuY3Rpb24gdG9nZ2xlTGlzdChpc09wZW4pIHtcblx0XHRcdFx0dmFyIGNvbGxhcHNlRWwgPSBjb25maWcuZWxlbWVudDtcblxuXHRcdFx0XHRjb25maWcub3BlbiA9IGlzT3BlbjtcblxuXHRcdFx0XHRpZiAoY29sbGFwc2VFbCkge1xuXG5cdFx0XHRcdFx0aWYgKGNvbmZpZy5vcGVuKSB7XG5cdFx0XHRcdFx0XHRlbC5jbGFzc0xpc3QuYWRkKFwib3BlblwiKTtcblx0XHRcdFx0XHRcdGNvbGxhcHNlRWwuc3R5bGUuZGlzcGxheSA9ICcnO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRlbC5jbGFzc0xpc3QucmVtb3ZlKFwib3BlblwiKTtcblx0XHRcdFx0XHRcdGNvbGxhcHNlRWwuc3R5bGUuZGlzcGxheSA9ICdub25lJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdHRvZ2dsZUxpc3QoIWNvbmZpZy5vcGVuKTtcblx0XHRcdH0pO1xuXG5cdFx0XHR0b2dnbGVMaXN0KGNvbmZpZy5vcGVuKTtcblxuXHRcdFx0cmV0dXJuIGVsO1xuXHRcdH0sXG5cblx0XHRyb3dTZWxlY3Rpb246IGZ1bmN0aW9uIHJvd1NlbGVjdGlvbihjZWxsKSB7XG5cdFx0XHR2YXIgX3RoaXM1NCA9IHRoaXM7XG5cblx0XHRcdHZhciBjaGVja2JveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcblxuXHRcdFx0Y2hlY2tib3gudHlwZSA9ICdjaGVja2JveCc7XG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInNlbGVjdFJvd1wiLCB0cnVlKSkge1xuXG5cdFx0XHRcdGNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGlmICh0eXBlb2YgY2VsbC5nZXRSb3cgPT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHZhciByb3cgPSBjZWxsLmdldFJvdygpO1xuXG5cdFx0XHRcdFx0Y2hlY2tib3guYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdFx0cm93LnRvZ2dsZVNlbGVjdCgpO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0Y2hlY2tib3guY2hlY2tlZCA9IHJvdy5pc1NlbGVjdGVkKCk7XG5cdFx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnNlbGVjdFJvdy5yZWdpc3RlclJvd1NlbGVjdENoZWNrYm94KHJvdywgY2hlY2tib3gpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0XHRcdGlmIChfdGhpczU0LnRhYmxlLm1vZHVsZXMuc2VsZWN0Um93LnNlbGVjdGVkUm93cy5sZW5ndGgpIHtcblx0XHRcdFx0XHRcdFx0X3RoaXM1NC50YWJsZS5kZXNlbGVjdFJvdygpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0X3RoaXM1NC50YWJsZS5zZWxlY3RSb3coKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5zZWxlY3RSb3cucmVnaXN0ZXJIZWFkZXJTZWxlY3RDaGVja2JveChjaGVja2JveCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHJldHVybiBjaGVja2JveDtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcImZvcm1hdFwiLCBGb3JtYXQpO1xuXG5cdHZhciBGcm96ZW5Db2x1bW5zID0gZnVuY3Rpb24gRnJvemVuQ29sdW1ucyh0YWJsZSkge1xuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIFRhYnVsYXRvciBvYmplY3Rcblx0XHR0aGlzLmxlZnRDb2x1bW5zID0gW107XG5cdFx0dGhpcy5yaWdodENvbHVtbnMgPSBbXTtcblx0XHR0aGlzLmxlZnRNYXJnaW4gPSAwO1xuXHRcdHRoaXMucmlnaHRNYXJnaW4gPSAwO1xuXHRcdHRoaXMucmlnaHRQYWRkaW5nID0gMDtcblx0XHR0aGlzLmluaXRpYWxpemF0aW9uTW9kZSA9IFwibGVmdFwiO1xuXHRcdHRoaXMuYWN0aXZlID0gZmFsc2U7XG5cdFx0dGhpcy5zY3JvbGxFbmRUaW1lciA9IGZhbHNlO1xuXHR9O1xuXG5cdC8vcmVzZXQgaW5pdGlhbCBzdGF0ZVxuXHRGcm96ZW5Db2x1bW5zLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHtcblx0XHR0aGlzLmluaXRpYWxpemF0aW9uTW9kZSA9IFwibGVmdFwiO1xuXHRcdHRoaXMubGVmdENvbHVtbnMgPSBbXTtcblx0XHR0aGlzLnJpZ2h0Q29sdW1ucyA9IFtdO1xuXHRcdHRoaXMubGVmdE1hcmdpbiA9IDA7XG5cdFx0dGhpcy5yaWdodE1hcmdpbiA9IDA7XG5cdFx0dGhpcy5yaWdodE1hcmdpbiA9IDA7XG5cdFx0dGhpcy5hY3RpdmUgPSBmYWxzZTtcblxuXHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5oZWFkZXJzRWxlbWVudC5zdHlsZS5tYXJnaW5MZWZ0ID0gMDtcblx0XHR0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZWxlbWVudC5zdHlsZS5wYWRkaW5nUmlnaHQgPSAwO1xuXHR9O1xuXG5cdC8vaW5pdGlhbGl6ZSBzcGVjaWZpYyBjb2x1bW5cblx0RnJvemVuQ29sdW1ucy5wcm90b3R5cGUuaW5pdGlhbGl6ZUNvbHVtbiA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHR2YXIgY29uZmlnID0geyBtYXJnaW46IDAsIGVkZ2U6IGZhbHNlIH07XG5cblx0XHRpZiAoIWNvbHVtbi5pc0dyb3VwKSB7XG5cblx0XHRcdGlmICh0aGlzLmZyb3plbkNoZWNrKGNvbHVtbikpIHtcblxuXHRcdFx0XHRjb25maWcucG9zaXRpb24gPSB0aGlzLmluaXRpYWxpemF0aW9uTW9kZTtcblxuXHRcdFx0XHRpZiAodGhpcy5pbml0aWFsaXphdGlvbk1vZGUgPT0gXCJsZWZ0XCIpIHtcblx0XHRcdFx0XHR0aGlzLmxlZnRDb2x1bW5zLnB1c2goY29sdW1uKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLnJpZ2h0Q29sdW1ucy51bnNoaWZ0KGNvbHVtbik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR0aGlzLmFjdGl2ZSA9IHRydWU7XG5cblx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuZnJvemVuID0gY29uZmlnO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5pbml0aWFsaXphdGlvbk1vZGUgPSBcInJpZ2h0XCI7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdEZyb3plbkNvbHVtbnMucHJvdG90eXBlLmZyb3plbkNoZWNrID0gZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdHZhciBmcm96ZW4gPSBmYWxzZTtcblxuXHRcdGlmIChjb2x1bW4ucGFyZW50LmlzR3JvdXAgJiYgY29sdW1uLmRlZmluaXRpb24uZnJvemVuKSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJGcm96ZW4gQ29sdW1uIEVycm9yIC0gUGFyZW50IGNvbHVtbiBncm91cCBtdXN0IGJlIGZyb3plbiwgbm90IGluZGl2aWR1YWwgY29sdW1ucyBvciBzdWIgY29sdW1uIGdyb3Vwc1wiKTtcblx0XHR9XG5cblx0XHRpZiAoY29sdW1uLnBhcmVudC5pc0dyb3VwKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5mcm96ZW5DaGVjayhjb2x1bW4ucGFyZW50KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIGNvbHVtbi5kZWZpbml0aW9uLmZyb3plbjtcblx0XHR9XG5cblx0XHRyZXR1cm4gZnJvemVuO1xuXHR9O1xuXG5cdC8vcXVpY2sgbGF5b3V0IHRvIHNtb290aCBob3Jpem9udGFsIHNjcm9sbGluZ1xuXHRGcm96ZW5Db2x1bW5zLnByb3RvdHlwZS5zY3JvbGxIb3Jpem9udGFsID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBfdGhpczU1ID0gdGhpcztcblxuXHRcdHZhciByb3dzO1xuXG5cdFx0aWYgKHRoaXMuYWN0aXZlKSB7XG5cdFx0XHRjbGVhclRpbWVvdXQodGhpcy5zY3JvbGxFbmRUaW1lcik7XG5cblx0XHRcdC8vbGF5b3V0IGFsbCByb3dzIGFmdGVyIHNjcm9sbCBpcyBjb21wbGV0ZVxuXHRcdFx0dGhpcy5zY3JvbGxFbmRUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRfdGhpczU1LmxheW91dCgpO1xuXHRcdFx0fSwgMTAwKTtcblxuXHRcdFx0cm93cyA9IHRoaXMudGFibGUucm93TWFuYWdlci5nZXRWaXNpYmxlUm93cygpO1xuXG5cdFx0XHR0aGlzLmNhbGNNYXJnaW5zKCk7XG5cblx0XHRcdHRoaXMubGF5b3V0Q29sdW1uUG9zaXRpb24oKTtcblxuXHRcdFx0dGhpcy5sYXlvdXRDYWxjUm93cygpO1xuXG5cdFx0XHRyb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0XHRpZiAocm93LnR5cGUgPT09IFwicm93XCIpIHtcblx0XHRcdFx0XHRfdGhpczU1LmxheW91dFJvdyhyb3cpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLnRhYmxlRWxlbWVudC5zdHlsZS5tYXJnaW5SaWdodCA9IHRoaXMucmlnaHRNYXJnaW47XG5cdFx0fVxuXHR9O1xuXG5cdC8vY2FsY3VsYXRlIG1hcmdpbnMgZm9yIHJvd3Ncblx0RnJvemVuQ29sdW1ucy5wcm90b3R5cGUuY2FsY01hcmdpbnMgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy5sZWZ0TWFyZ2luID0gdGhpcy5fY2FsY1NwYWNlKHRoaXMubGVmdENvbHVtbnMsIHRoaXMubGVmdENvbHVtbnMubGVuZ3RoKSArIFwicHhcIjtcblx0XHR0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuaGVhZGVyc0VsZW1lbnQuc3R5bGUubWFyZ2luTGVmdCA9IHRoaXMubGVmdE1hcmdpbjtcblxuXHRcdHRoaXMucmlnaHRNYXJnaW4gPSB0aGlzLl9jYWxjU3BhY2UodGhpcy5yaWdodENvbHVtbnMsIHRoaXMucmlnaHRDb2x1bW5zLmxlbmd0aCkgKyBcInB4XCI7XG5cdFx0dGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmVsZW1lbnQuc3R5bGUucGFkZGluZ1JpZ2h0ID0gdGhpcy5yaWdodE1hcmdpbjtcblxuXHRcdC8vY2FsY3VsYXRlIHJpZ2h0IGZyb3plbiBjb2x1bW5zXG5cdFx0dGhpcy5yaWdodFBhZGRpbmcgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5jbGllbnRXaWR0aCArIHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5zY3JvbGxMZWZ0O1xuXHR9O1xuXG5cdC8vbGF5b3V0IGNhbGN1bGF0aW9uIHJvd3Ncblx0RnJvemVuQ29sdW1ucy5wcm90b3R5cGUubGF5b3V0Q2FsY1Jvd3MgPSBmdW5jdGlvbiAoKSB7XG5cdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwiY29sdW1uQ2FsY3NcIikpIHtcblx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MudG9wSW5pdGlhbGl6ZWQgJiYgdGhpcy50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLnRvcFJvdykge1xuXHRcdFx0XHR0aGlzLmxheW91dFJvdyh0aGlzLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MudG9wUm93KTtcblx0XHRcdH1cblx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MuYm90SW5pdGlhbGl6ZWQgJiYgdGhpcy50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLmJvdFJvdykge1xuXHRcdFx0XHR0aGlzLmxheW91dFJvdyh0aGlzLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MuYm90Um93KTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Ly9jYWxjdWxhdGUgY29sdW1uIHBvc2l0aW9ucyBhbmQgbGF5b3V0IGhlYWRlcnNcblx0RnJvemVuQ29sdW1ucy5wcm90b3R5cGUubGF5b3V0Q29sdW1uUG9zaXRpb24gPSBmdW5jdGlvbiAoYWxsQ2VsbHMpIHtcblx0XHR2YXIgX3RoaXM1NiA9IHRoaXM7XG5cblx0XHR2YXIgbGVmdFBhcmVudHMgPSBbXTtcblxuXHRcdHRoaXMubGVmdENvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uLCBpKSB7XG5cdFx0XHRjb2x1bW4ubW9kdWxlcy5mcm96ZW4ubWFyZ2luID0gX3RoaXM1Ni5fY2FsY1NwYWNlKF90aGlzNTYubGVmdENvbHVtbnMsIGkpICsgX3RoaXM1Ni50YWJsZS5jb2x1bW5NYW5hZ2VyLnNjcm9sbExlZnQgKyBcInB4XCI7XG5cblx0XHRcdGlmIChpID09IF90aGlzNTYubGVmdENvbHVtbnMubGVuZ3RoIC0gMSkge1xuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5mcm96ZW4uZWRnZSA9IHRydWU7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5mcm96ZW4uZWRnZSA9IGZhbHNlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoY29sdW1uLnBhcmVudC5pc0dyb3VwKSB7XG5cdFx0XHRcdHZhciBwYXJlbnRFbCA9IF90aGlzNTYuZ2V0Q29sR3JvdXBQYXJlbnRFbGVtZW50KGNvbHVtbik7XG5cdFx0XHRcdGlmICghbGVmdFBhcmVudHMuaW5jbHVkZXMocGFyZW50RWwpKSB7XG5cdFx0XHRcdFx0X3RoaXM1Ni5sYXlvdXRFbGVtZW50KHBhcmVudEVsLCBjb2x1bW4pO1xuXHRcdFx0XHRcdGxlZnRQYXJlbnRzLnB1c2gocGFyZW50RWwpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGNvbHVtbi5tb2R1bGVzLmZyb3plbi5lZGdlKSB7XG5cdFx0XHRcdFx0cGFyZW50RWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1mcm96ZW4tXCIgKyBjb2x1bW4ubW9kdWxlcy5mcm96ZW4ucG9zaXRpb24pO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfdGhpczU2LmxheW91dEVsZW1lbnQoY29sdW1uLmdldEVsZW1lbnQoKSwgY29sdW1uKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFsbENlbGxzKSB7XG5cdFx0XHRcdGNvbHVtbi5jZWxscy5mb3JFYWNoKGZ1bmN0aW9uIChjZWxsKSB7XG5cdFx0XHRcdFx0X3RoaXM1Ni5sYXlvdXRFbGVtZW50KGNlbGwuZ2V0RWxlbWVudCgpLCBjb2x1bW4pO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHRoaXMucmlnaHRDb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbiwgaSkge1xuXHRcdFx0Y29sdW1uLm1vZHVsZXMuZnJvemVuLm1hcmdpbiA9IF90aGlzNTYucmlnaHRQYWRkaW5nIC0gX3RoaXM1Ni5fY2FsY1NwYWNlKF90aGlzNTYucmlnaHRDb2x1bW5zLCBpICsgMSkgKyBcInB4XCI7XG5cblx0XHRcdGlmIChpID09IF90aGlzNTYucmlnaHRDb2x1bW5zLmxlbmd0aCAtIDEpIHtcblx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuZnJvemVuLmVkZ2UgPSB0cnVlO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuZnJvemVuLmVkZ2UgPSBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGNvbHVtbi5wYXJlbnQuaXNHcm91cCkge1xuXHRcdFx0XHRfdGhpczU2LmxheW91dEVsZW1lbnQoX3RoaXM1Ni5nZXRDb2xHcm91cFBhcmVudEVsZW1lbnQoY29sdW1uKSwgY29sdW1uKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF90aGlzNTYubGF5b3V0RWxlbWVudChjb2x1bW4uZ2V0RWxlbWVudCgpLCBjb2x1bW4pO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYWxsQ2VsbHMpIHtcblx0XHRcdFx0Y29sdW1uLmNlbGxzLmZvckVhY2goZnVuY3Rpb24gKGNlbGwpIHtcblx0XHRcdFx0XHRfdGhpczU2LmxheW91dEVsZW1lbnQoY2VsbC5nZXRFbGVtZW50KCksIGNvbHVtbik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdEZyb3plbkNvbHVtbnMucHJvdG90eXBlLmdldENvbEdyb3VwUGFyZW50RWxlbWVudCA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRyZXR1cm4gY29sdW1uLnBhcmVudC5pc0dyb3VwID8gdGhpcy5nZXRDb2xHcm91cFBhcmVudEVsZW1lbnQoY29sdW1uLnBhcmVudCkgOiBjb2x1bW4uZ2V0RWxlbWVudCgpO1xuXHR9O1xuXG5cdC8vbGF5b3V0IGNvbHVtbnMgYXBwcm9wcm9wcmlhdGx5XG5cdEZyb3plbkNvbHVtbnMucHJvdG90eXBlLmxheW91dCA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHJpZ2h0TWFyZ2luID0gMDtcblxuXHRcdGlmIChzZWxmLmFjdGl2ZSkge1xuXG5cdFx0XHQvL2NhbGN1bGF0ZSByb3cgcGFkZGluZ1xuXHRcdFx0dGhpcy5jYWxjTWFyZ2lucygpO1xuXG5cdFx0XHQvLyBzZWxmLnRhYmxlLnJvd01hbmFnZXIuYWN0aXZlUm93cy5mb3JFYWNoKGZ1bmN0aW9uKHJvdyl7XG5cdFx0XHQvLyBcdHNlbGYubGF5b3V0Um93KHJvdyk7XG5cdFx0XHQvLyB9KTtcblxuXHRcdFx0Ly8gaWYoc2VsZi50YWJsZS5vcHRpb25zLmRhdGFUcmVlKXtcblx0XHRcdHNlbGYudGFibGUucm93TWFuYWdlci5nZXREaXNwbGF5Um93cygpLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0XHRpZiAocm93LnR5cGUgPT09IFwicm93XCIpIHtcblx0XHRcdFx0XHRzZWxmLmxheW91dFJvdyhyb3cpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdC8vIH1cblxuXHRcdFx0dGhpcy5sYXlvdXRDYWxjUm93cygpO1xuXG5cdFx0XHQvL2NhbGN1bGF0ZSBsZWZ0IGNvbHVtbnNcblx0XHRcdHRoaXMubGF5b3V0Q29sdW1uUG9zaXRpb24odHJ1ZSk7XG5cblx0XHRcdC8vIGlmKHRhYmxlSG9sZGVyLnNjcm9sbEhlaWdodCA+IHRhYmxlSG9sZGVyLmNsaWVudEhlaWdodCl7XG5cdFx0XHQvLyBcdHJpZ2h0TWFyZ2luIC09IHRhYmxlSG9sZGVyLm9mZnNldFdpZHRoIC0gdGFibGVIb2xkZXIuY2xpZW50V2lkdGg7XG5cdFx0XHQvLyB9XG5cblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci50YWJsZUVsZW1lbnQuc3R5bGUubWFyZ2luUmlnaHQgPSB0aGlzLnJpZ2h0TWFyZ2luO1xuXHRcdH1cblx0fTtcblxuXHRGcm96ZW5Db2x1bW5zLnByb3RvdHlwZS5sYXlvdXRSb3cgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIF90aGlzNTcgPSB0aGlzO1xuXG5cdFx0dmFyIHJvd0VsID0gcm93LmdldEVsZW1lbnQoKTtcblxuXHRcdHJvd0VsLnN0eWxlLnBhZGRpbmdMZWZ0ID0gdGhpcy5sZWZ0TWFyZ2luO1xuXHRcdC8vIHJvd0VsLnN0eWxlLnBhZGRpbmdSaWdodCA9IHRoaXMucmlnaHRNYXJnaW4gKyBcInB4XCI7XG5cblx0XHR0aGlzLmxlZnRDb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdFx0dmFyIGNlbGwgPSByb3cuZ2V0Q2VsbChjb2x1bW4pO1xuXG5cdFx0XHRpZiAoY2VsbCkge1xuXHRcdFx0XHRfdGhpczU3LmxheW91dEVsZW1lbnQoY2VsbC5nZXRFbGVtZW50KCksIGNvbHVtbik7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHR0aGlzLnJpZ2h0Q29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdHZhciBjZWxsID0gcm93LmdldENlbGwoY29sdW1uKTtcblxuXHRcdFx0aWYgKGNlbGwpIHtcblx0XHRcdFx0X3RoaXM1Ny5sYXlvdXRFbGVtZW50KGNlbGwuZ2V0RWxlbWVudCgpLCBjb2x1bW4pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdEZyb3plbkNvbHVtbnMucHJvdG90eXBlLmxheW91dEVsZW1lbnQgPSBmdW5jdGlvbiAoZWxlbWVudCwgY29sdW1uKSB7XG5cblx0XHRpZiAoY29sdW1uLm1vZHVsZXMuZnJvemVuKSB7XG5cdFx0XHRlbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuXHRcdFx0ZWxlbWVudC5zdHlsZS5sZWZ0ID0gY29sdW1uLm1vZHVsZXMuZnJvemVuLm1hcmdpbjtcblxuXHRcdFx0ZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWZyb3plblwiKTtcblxuXHRcdFx0aWYgKGNvbHVtbi5tb2R1bGVzLmZyb3plbi5lZGdlKSB7XG5cdFx0XHRcdGVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1mcm96ZW4tXCIgKyBjb2x1bW4ubW9kdWxlcy5mcm96ZW4ucG9zaXRpb24pO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRGcm96ZW5Db2x1bW5zLnByb3RvdHlwZS5fY2FsY1NwYWNlID0gZnVuY3Rpb24gKGNvbHVtbnMsIGluZGV4KSB7XG5cdFx0dmFyIHdpZHRoID0gMDtcblxuXHRcdGZvciAodmFyIF9pOCA9IDA7IF9pOCA8IGluZGV4OyBfaTgrKykge1xuXHRcdFx0aWYgKGNvbHVtbnNbX2k4XS52aXNpYmxlKSB7XG5cdFx0XHRcdHdpZHRoICs9IGNvbHVtbnNbX2k4XS5nZXRXaWR0aCgpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiB3aWR0aDtcblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnJlZ2lzdGVyTW9kdWxlKFwiZnJvemVuQ29sdW1uc1wiLCBGcm96ZW5Db2x1bW5zKTtcblx0dmFyIEZyb3plblJvd3MgPSBmdW5jdGlvbiBGcm96ZW5Sb3dzKHRhYmxlKSB7XG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlOyAvL2hvbGQgVGFidWxhdG9yIG9iamVjdFxuXHRcdHRoaXMudG9wRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0dGhpcy5yb3dzID0gW107XG5cdFx0dGhpcy5kaXNwbGF5SW5kZXggPSAwOyAvL2luZGV4IGluIGRpc3BsYXkgcGlwZWxpbmVcblx0fTtcblxuXHRGcm96ZW5Sb3dzLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMucm93cyA9IFtdO1xuXG5cdFx0dGhpcy50b3BFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZnJvemVuLXJvd3MtaG9sZGVyXCIpO1xuXG5cdFx0Ly8gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmVsZW1lbnQuYXBwZW5kKHRoaXMudG9wRWxlbWVudCk7XG5cdFx0dGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldEVsZW1lbnQoKS5pbnNlcnRCZWZvcmUodGhpcy50b3BFbGVtZW50LCB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuaGVhZGVyc0VsZW1lbnQubmV4dFNpYmxpbmcpO1xuXHR9O1xuXG5cdEZyb3plblJvd3MucHJvdG90eXBlLnNldERpc3BsYXlJbmRleCA9IGZ1bmN0aW9uIChpbmRleCkge1xuXHRcdHRoaXMuZGlzcGxheUluZGV4ID0gaW5kZXg7XG5cdH07XG5cblx0RnJvemVuUm93cy5wcm90b3R5cGUuZ2V0RGlzcGxheUluZGV4ID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB0aGlzLmRpc3BsYXlJbmRleDtcblx0fTtcblxuXHRGcm96ZW5Sb3dzLnByb3RvdHlwZS5pc0Zyb3plbiA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gISF0aGlzLnJvd3MubGVuZ3RoO1xuXHR9O1xuXG5cdC8vZmlsdGVyIGZyb3plbiByb3dzIG91dCBvZiBkaXNwbGF5IGRhdGFcblx0RnJvemVuUm93cy5wcm90b3R5cGUuZ2V0Um93cyA9IGZ1bmN0aW9uIChyb3dzKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBmcm96ZW4gPSBbXSxcblx0XHQgICAgb3V0cHV0ID0gcm93cy5zbGljZSgwKTtcblxuXHRcdHRoaXMucm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdHZhciBpbmRleCA9IG91dHB1dC5pbmRleE9mKHJvdyk7XG5cblx0XHRcdGlmIChpbmRleCA+IC0xKSB7XG5cdFx0XHRcdG91dHB1dC5zcGxpY2UoaW5kZXgsIDEpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fTtcblxuXHRGcm96ZW5Sb3dzLnByb3RvdHlwZS5mcmVlemVSb3cgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0aWYgKCFyb3cubW9kdWxlcy5mcm96ZW4pIHtcblx0XHRcdHJvdy5tb2R1bGVzLmZyb3plbiA9IHRydWU7XG5cdFx0XHR0aGlzLnRvcEVsZW1lbnQuYXBwZW5kQ2hpbGQocm93LmdldEVsZW1lbnQoKSk7XG5cdFx0XHRyb3cuaW5pdGlhbGl6ZSgpO1xuXHRcdFx0cm93Lm5vcm1hbGl6ZUhlaWdodCgpO1xuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmFkanVzdFRhYmxlU2l6ZSgpO1xuXG5cdFx0XHR0aGlzLnJvd3MucHVzaChyb3cpO1xuXG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucmVmcmVzaEFjdGl2ZURhdGEoXCJkaXNwbGF5XCIpO1xuXG5cdFx0XHR0aGlzLnN0eWxlUm93cygpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJGcmVlemUgRXJyb3IgLSBSb3cgaXMgYWxyZWFkeSBmcm96ZW5cIik7XG5cdFx0fVxuXHR9O1xuXG5cdEZyb3plblJvd3MucHJvdG90eXBlLnVuZnJlZXplUm93ID0gZnVuY3Rpb24gKHJvdykge1xuXHRcdHZhciBpbmRleCA9IHRoaXMucm93cy5pbmRleE9mKHJvdyk7XG5cblx0XHRpZiAocm93Lm1vZHVsZXMuZnJvemVuKSB7XG5cblx0XHRcdHJvdy5tb2R1bGVzLmZyb3plbiA9IGZhbHNlO1xuXG5cdFx0XHR2YXIgcm93RWwgPSByb3cuZ2V0RWxlbWVudCgpO1xuXHRcdFx0cm93RWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChyb3dFbCk7XG5cblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5hZGp1c3RUYWJsZVNpemUoKTtcblxuXHRcdFx0dGhpcy5yb3dzLnNwbGljZShpbmRleCwgMSk7XG5cblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5yZWZyZXNoQWN0aXZlRGF0YShcImRpc3BsYXlcIik7XG5cblx0XHRcdGlmICh0aGlzLnJvd3MubGVuZ3RoKSB7XG5cdFx0XHRcdHRoaXMuc3R5bGVSb3dzKCk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIkZyZWV6ZSBFcnJvciAtIFJvdyBpcyBhbHJlYWR5IHVuZnJvemVuXCIpO1xuXHRcdH1cblx0fTtcblxuXHRGcm96ZW5Sb3dzLnByb3RvdHlwZS5zdHlsZVJvd3MgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0dGhpcy5yb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdywgaSkge1xuXHRcdFx0c2VsZi50YWJsZS5yb3dNYW5hZ2VyLnN0eWxlUm93KHJvdywgaSk7XG5cdFx0fSk7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcImZyb3plblJvd3NcIiwgRnJvemVuUm93cyk7XG5cblx0Ly9wdWJsaWMgZ3JvdXAgb2JqZWN0XG5cdHZhciBHcm91cENvbXBvbmVudCA9IGZ1bmN0aW9uIEdyb3VwQ29tcG9uZW50KGdyb3VwKSB7XG5cdFx0dGhpcy5fZ3JvdXAgPSBncm91cDtcblx0XHR0aGlzLnR5cGUgPSBcIkdyb3VwQ29tcG9uZW50XCI7XG5cdH07XG5cblx0R3JvdXBDb21wb25lbnQucHJvdG90eXBlLmdldEtleSA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5fZ3JvdXAua2V5O1xuXHR9O1xuXG5cdEdyb3VwQ29tcG9uZW50LnByb3RvdHlwZS5nZXRGaWVsZCA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5fZ3JvdXAuZmllbGQ7XG5cdH07XG5cblx0R3JvdXBDb21wb25lbnQucHJvdG90eXBlLmdldEVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX2dyb3VwLmVsZW1lbnQ7XG5cdH07XG5cblx0R3JvdXBDb21wb25lbnQucHJvdG90eXBlLmdldFJvd3MgPSBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX2dyb3VwLmdldFJvd3ModHJ1ZSk7XG5cdH07XG5cblx0R3JvdXBDb21wb25lbnQucHJvdG90eXBlLmdldFN1Ykdyb3VwcyA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5fZ3JvdXAuZ2V0U3ViR3JvdXBzKHRydWUpO1xuXHR9O1xuXG5cdEdyb3VwQ29tcG9uZW50LnByb3RvdHlwZS5nZXRQYXJlbnRHcm91cCA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5fZ3JvdXAucGFyZW50ID8gdGhpcy5fZ3JvdXAucGFyZW50LmdldENvbXBvbmVudCgpIDogZmFsc2U7XG5cdH07XG5cblx0R3JvdXBDb21wb25lbnQucHJvdG90eXBlLmdldFZpc2liaWxpdHkgPSBmdW5jdGlvbiAoKSB7XG5cdFx0Y29uc29sZS53YXJuKFwiZ2V0VmlzaWJpbGl0eSBmdW5jdGlvbiBpcyBkZXByZWNhdGVkLCB5b3Ugc2hvdWxkIG5vdyB1c2UgdGhlIGlzVmlzaWJsZSBmdW5jdGlvblwiKTtcblx0XHRyZXR1cm4gdGhpcy5fZ3JvdXAudmlzaWJsZTtcblx0fTtcblxuXHRHcm91cENvbXBvbmVudC5wcm90b3R5cGUuaXNWaXNpYmxlID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB0aGlzLl9ncm91cC52aXNpYmxlO1xuXHR9O1xuXG5cdEdyb3VwQ29tcG9uZW50LnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMuX2dyb3VwLnNob3coKTtcblx0fTtcblxuXHRHcm91cENvbXBvbmVudC5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHtcblx0XHR0aGlzLl9ncm91cC5oaWRlKCk7XG5cdH07XG5cblx0R3JvdXBDb21wb25lbnQucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uICgpIHtcblx0XHR0aGlzLl9ncm91cC50b2dnbGVWaXNpYmlsaXR5KCk7XG5cdH07XG5cblx0R3JvdXBDb21wb25lbnQucHJvdG90eXBlLl9nZXRTZWxmID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB0aGlzLl9ncm91cDtcblx0fTtcblxuXHRHcm91cENvbXBvbmVudC5wcm90b3R5cGUuZ2V0VGFibGUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX2dyb3VwLmdyb3VwTWFuYWdlci50YWJsZTtcblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vIEdyb3VwIEZ1bmN0aW9ucyAvLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5cdHZhciBHcm91cCA9IGZ1bmN0aW9uIEdyb3VwKGdyb3VwTWFuYWdlciwgcGFyZW50LCBsZXZlbCwga2V5LCBmaWVsZCwgZ2VuZXJhdG9yLCBvbGRHcm91cCkge1xuXG5cdFx0dGhpcy5ncm91cE1hbmFnZXIgPSBncm91cE1hbmFnZXI7XG5cdFx0dGhpcy5wYXJlbnQgPSBwYXJlbnQ7XG5cdFx0dGhpcy5rZXkgPSBrZXk7XG5cdFx0dGhpcy5sZXZlbCA9IGxldmVsO1xuXHRcdHRoaXMuZmllbGQgPSBmaWVsZDtcblx0XHR0aGlzLmhhc1N1Ykdyb3VwcyA9IGxldmVsIDwgZ3JvdXBNYW5hZ2VyLmdyb3VwSURMb29rdXBzLmxlbmd0aCAtIDE7XG5cdFx0dGhpcy5hZGRSb3cgPSB0aGlzLmhhc1N1Ykdyb3VwcyA/IHRoaXMuX2FkZFJvd1RvR3JvdXAgOiB0aGlzLl9hZGRSb3c7XG5cdFx0dGhpcy50eXBlID0gXCJncm91cFwiOyAvL3R5cGUgb2YgZWxlbWVudFxuXHRcdHRoaXMub2xkID0gb2xkR3JvdXA7XG5cdFx0dGhpcy5yb3dzID0gW107XG5cdFx0dGhpcy5ncm91cHMgPSBbXTtcblx0XHR0aGlzLmdyb3VwTGlzdCA9IFtdO1xuXHRcdHRoaXMuZ2VuZXJhdG9yID0gZ2VuZXJhdG9yO1xuXHRcdHRoaXMuZWxlbWVudENvbnRlbnRzID0gZmFsc2U7XG5cdFx0dGhpcy5oZWlnaHQgPSAwO1xuXHRcdHRoaXMub3V0ZXJIZWlnaHQgPSAwO1xuXHRcdHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcblx0XHR0aGlzLmNhbGNzID0ge307XG5cdFx0dGhpcy5pbml0aWFsaXplZCA9IGZhbHNlO1xuXHRcdHRoaXMubW9kdWxlcyA9IHt9O1xuXHRcdHRoaXMuYXJyb3dFbGVtZW50ID0gZmFsc2U7XG5cblx0XHR0aGlzLnZpc2libGUgPSBvbGRHcm91cCA/IG9sZEdyb3VwLnZpc2libGUgOiB0eXBlb2YgZ3JvdXBNYW5hZ2VyLnN0YXJ0T3BlbltsZXZlbF0gIT09IFwidW5kZWZpbmVkXCIgPyBncm91cE1hbmFnZXIuc3RhcnRPcGVuW2xldmVsXSA6IGdyb3VwTWFuYWdlci5zdGFydE9wZW5bMF07XG5cblx0XHR0aGlzLmNvbXBvbmVudCA9IG51bGw7XG5cblx0XHR0aGlzLmNyZWF0ZUVsZW1lbnRzKCk7XG5cdFx0dGhpcy5hZGRCaW5kaW5ncygpO1xuXG5cdFx0dGhpcy5jcmVhdGVWYWx1ZUdyb3VwcygpO1xuXHR9O1xuXG5cdEdyb3VwLnByb3RvdHlwZS53aXBlID0gZnVuY3Rpb24gKCkge1xuXHRcdGlmICh0aGlzLmdyb3VwTGlzdC5sZW5ndGgpIHtcblx0XHRcdHRoaXMuZ3JvdXBMaXN0LmZvckVhY2goZnVuY3Rpb24gKGdyb3VwKSB7XG5cdFx0XHRcdGdyb3VwLndpcGUoKTtcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLmVsZW1lbnQgPSBmYWxzZTtcblx0XHRcdHRoaXMuYXJyb3dFbGVtZW50ID0gZmFsc2U7XG5cdFx0XHR0aGlzLmVsZW1lbnRDb250ZW50cyA9IGZhbHNlO1xuXHRcdH1cblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUuY3JlYXRlRWxlbWVudHMgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIGFycm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRhcnJvdy5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWFycm93XCIpO1xuXG5cdFx0dGhpcy5lbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHR0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1yb3dcIik7XG5cdFx0dGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZ3JvdXBcIik7XG5cdFx0dGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZ3JvdXAtbGV2ZWwtXCIgKyB0aGlzLmxldmVsKTtcblx0XHR0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKFwicm9sZVwiLCBcInJvd2dyb3VwXCIpO1xuXG5cdFx0dGhpcy5hcnJvd0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdHRoaXMuYXJyb3dFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZ3JvdXAtdG9nZ2xlXCIpO1xuXHRcdHRoaXMuYXJyb3dFbGVtZW50LmFwcGVuZENoaWxkKGFycm93KTtcblxuXHRcdC8vc2V0dXAgbW92YWJsZSByb3dzXG5cdFx0aWYgKHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3MgIT09IGZhbHNlICYmIHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZEV4aXN0cyhcIm1vdmVSb3dcIikpIHtcblx0XHRcdHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZHVsZXMubW92ZVJvdy5pbml0aWFsaXplR3JvdXBIZWFkZXIodGhpcyk7XG5cdFx0fVxuXHR9O1xuXG5cdEdyb3VwLnByb3RvdHlwZS5jcmVhdGVWYWx1ZUdyb3VwcyA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgX3RoaXM1OCA9IHRoaXM7XG5cblx0XHR2YXIgbGV2ZWwgPSB0aGlzLmxldmVsICsgMTtcblx0XHRpZiAodGhpcy5ncm91cE1hbmFnZXIuYWxsb3dlZFZhbHVlcyAmJiB0aGlzLmdyb3VwTWFuYWdlci5hbGxvd2VkVmFsdWVzW2xldmVsXSkge1xuXHRcdFx0dGhpcy5ncm91cE1hbmFnZXIuYWxsb3dlZFZhbHVlc1tsZXZlbF0uZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRcdFx0X3RoaXM1OC5fY3JlYXRlR3JvdXAodmFsdWUsIGxldmVsKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUuYWRkQmluZGluZ3MgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBkYmxUYXAsXG5cdFx0ICAgIHRhcEhvbGQsXG5cdFx0ICAgIHRhcCxcblx0XHQgICAgdG9nZ2xlRWxlbWVudDtcblxuXHRcdC8vaGFuZGxlIGdyb3VwIGNsaWNrIGV2ZW50c1xuXHRcdGlmIChzZWxmLmdyb3VwTWFuYWdlci50YWJsZS5vcHRpb25zLmdyb3VwQ2xpY2spIHtcblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0c2VsZi5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5ncm91cENsaWNrLmNhbGwoc2VsZi5ncm91cE1hbmFnZXIudGFibGUsIGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHNlbGYuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMuZ3JvdXBEYmxDbGljaykge1xuXHRcdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkYmxjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRzZWxmLmdyb3VwTWFuYWdlci50YWJsZS5vcHRpb25zLmdyb3VwRGJsQ2xpY2suY2FsbChzZWxmLmdyb3VwTWFuYWdlci50YWJsZSwgZSwgc2VsZi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoc2VsZi5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5ncm91cENvbnRleHQpIHtcblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY29udGV4dG1lbnVcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0c2VsZi5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5ncm91cENvbnRleHQuY2FsbChzZWxmLmdyb3VwTWFuYWdlci50YWJsZSwgZSwgc2VsZi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoc2VsZi5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5ncm91cENvbnRleHRNZW51ICYmIHNlbGYuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZEV4aXN0cyhcIm1lbnVcIikpIHtcblx0XHRcdHNlbGYuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZHVsZXMubWVudS5pbml0aWFsaXplR3JvdXAuY2FsbChzZWxmLmdyb3VwTWFuYWdlci50YWJsZS5tb2R1bGVzLm1lbnUsIHNlbGYpO1xuXHRcdH1cblxuXHRcdGlmIChzZWxmLmdyb3VwTWFuYWdlci50YWJsZS5vcHRpb25zLmdyb3VwVGFwKSB7XG5cblx0XHRcdHRhcCA9IGZhbHNlO1xuXG5cdFx0XHRzZWxmLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0dGFwID0gdHJ1ZTtcblx0XHRcdH0sIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcblxuXHRcdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRpZiAodGFwKSB7XG5cdFx0XHRcdFx0c2VsZi5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5ncm91cFRhcChlLCBzZWxmLmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRhcCA9IGZhbHNlO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHNlbGYuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMuZ3JvdXBEYmxUYXApIHtcblxuXHRcdFx0ZGJsVGFwID0gbnVsbDtcblxuXHRcdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdGlmIChkYmxUYXApIHtcblx0XHRcdFx0XHRjbGVhclRpbWVvdXQoZGJsVGFwKTtcblx0XHRcdFx0XHRkYmxUYXAgPSBudWxsO1xuXG5cdFx0XHRcdFx0c2VsZi5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5ncm91cERibFRhcChlLCBzZWxmLmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdGRibFRhcCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0Y2xlYXJUaW1lb3V0KGRibFRhcCk7XG5cdFx0XHRcdFx0XHRkYmxUYXAgPSBudWxsO1xuXHRcdFx0XHRcdH0sIDMwMCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGlmIChzZWxmLmdyb3VwTWFuYWdlci50YWJsZS5vcHRpb25zLmdyb3VwVGFwSG9sZCkge1xuXG5cdFx0XHR0YXBIb2xkID0gbnVsbDtcblxuXHRcdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGNsZWFyVGltZW91dCh0YXBIb2xkKTtcblxuXHRcdFx0XHR0YXBIb2xkID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0Y2xlYXJUaW1lb3V0KHRhcEhvbGQpO1xuXHRcdFx0XHRcdHRhcEhvbGQgPSBudWxsO1xuXHRcdFx0XHRcdHRhcCA9IGZhbHNlO1xuXHRcdFx0XHRcdHNlbGYuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMuZ3JvdXBUYXBIb2xkKGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0XHR9LCAxMDAwKTtcblx0XHRcdH0sIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcblxuXHRcdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRjbGVhclRpbWVvdXQodGFwSG9sZCk7XG5cdFx0XHRcdHRhcEhvbGQgPSBudWxsO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHNlbGYuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMuZ3JvdXBUb2dnbGVFbGVtZW50KSB7XG5cdFx0XHR0b2dnbGVFbGVtZW50ID0gc2VsZi5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5ncm91cFRvZ2dsZUVsZW1lbnQgPT0gXCJhcnJvd1wiID8gc2VsZi5hcnJvd0VsZW1lbnQgOiBzZWxmLmVsZW1lbnQ7XG5cblx0XHRcdHRvZ2dsZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdHNlbGYudG9nZ2xlVmlzaWJpbGl0eSgpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9O1xuXG5cdEdyb3VwLnByb3RvdHlwZS5fY3JlYXRlR3JvdXAgPSBmdW5jdGlvbiAoZ3JvdXBJRCwgbGV2ZWwpIHtcblx0XHR2YXIgZ3JvdXBLZXkgPSBsZXZlbCArIFwiX1wiICsgZ3JvdXBJRDtcblx0XHR2YXIgZ3JvdXAgPSBuZXcgR3JvdXAodGhpcy5ncm91cE1hbmFnZXIsIHRoaXMsIGxldmVsLCBncm91cElELCB0aGlzLmdyb3VwTWFuYWdlci5ncm91cElETG9va3Vwc1tsZXZlbF0uZmllbGQsIHRoaXMuZ3JvdXBNYW5hZ2VyLmhlYWRlckdlbmVyYXRvcltsZXZlbF0gfHwgdGhpcy5ncm91cE1hbmFnZXIuaGVhZGVyR2VuZXJhdG9yWzBdLCB0aGlzLm9sZCA/IHRoaXMub2xkLmdyb3Vwc1tncm91cEtleV0gOiBmYWxzZSk7XG5cblx0XHR0aGlzLmdyb3Vwc1tncm91cEtleV0gPSBncm91cDtcblx0XHR0aGlzLmdyb3VwTGlzdC5wdXNoKGdyb3VwKTtcblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUuX2FkZFJvd1RvR3JvdXAgPSBmdW5jdGlvbiAocm93KSB7XG5cblx0XHR2YXIgbGV2ZWwgPSB0aGlzLmxldmVsICsgMTtcblxuXHRcdGlmICh0aGlzLmhhc1N1Ykdyb3Vwcykge1xuXHRcdFx0dmFyIGdyb3VwSUQgPSB0aGlzLmdyb3VwTWFuYWdlci5ncm91cElETG9va3Vwc1tsZXZlbF0uZnVuYyhyb3cuZ2V0RGF0YSgpKSxcblx0XHRcdCAgICBncm91cEtleSA9IGxldmVsICsgXCJfXCIgKyBncm91cElEO1xuXG5cdFx0XHRpZiAodGhpcy5ncm91cE1hbmFnZXIuYWxsb3dlZFZhbHVlcyAmJiB0aGlzLmdyb3VwTWFuYWdlci5hbGxvd2VkVmFsdWVzW2xldmVsXSkge1xuXHRcdFx0XHRpZiAodGhpcy5ncm91cHNbZ3JvdXBLZXldKSB7XG5cdFx0XHRcdFx0dGhpcy5ncm91cHNbZ3JvdXBLZXldLmFkZFJvdyhyb3cpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAoIXRoaXMuZ3JvdXBzW2dyb3VwS2V5XSkge1xuXHRcdFx0XHRcdHRoaXMuX2NyZWF0ZUdyb3VwKGdyb3VwSUQsIGxldmVsKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRoaXMuZ3JvdXBzW2dyb3VwS2V5XS5hZGRSb3cocm93KTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0R3JvdXAucHJvdG90eXBlLl9hZGRSb3cgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dGhpcy5yb3dzLnB1c2gocm93KTtcblx0XHRyb3cubW9kdWxlcy5ncm91cCA9IHRoaXM7XG5cdH07XG5cblx0R3JvdXAucHJvdG90eXBlLmluc2VydFJvdyA9IGZ1bmN0aW9uIChyb3csIHRvLCBhZnRlcikge1xuXHRcdHZhciBkYXRhID0gdGhpcy5jb25mb3JtUm93RGF0YSh7fSk7XG5cblx0XHRyb3cudXBkYXRlRGF0YShkYXRhKTtcblxuXHRcdHZhciB0b0luZGV4ID0gdGhpcy5yb3dzLmluZGV4T2YodG8pO1xuXG5cdFx0aWYgKHRvSW5kZXggPiAtMSkge1xuXHRcdFx0aWYgKGFmdGVyKSB7XG5cdFx0XHRcdHRoaXMucm93cy5zcGxpY2UodG9JbmRleCArIDEsIDAsIHJvdyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLnJvd3Muc3BsaWNlKHRvSW5kZXgsIDAsIHJvdyk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlmIChhZnRlcikge1xuXHRcdFx0XHR0aGlzLnJvd3MucHVzaChyb3cpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5yb3dzLnVuc2hpZnQocm93KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyb3cubW9kdWxlcy5ncm91cCA9IHRoaXM7XG5cblx0XHR0aGlzLmdlbmVyYXRlR3JvdXBIZWFkZXJDb250ZW50cygpO1xuXG5cdFx0aWYgKHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpICYmIHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMuY29sdW1uQ2FsY3MgIT0gXCJ0YWJsZVwiKSB7XG5cdFx0XHR0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLnJlY2FsY0dyb3VwKHRoaXMpO1xuXHRcdH1cblxuXHRcdHRoaXMuZ3JvdXBNYW5hZ2VyLnVwZGF0ZUdyb3VwUm93cyh0cnVlKTtcblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUuc2Nyb2xsSGVhZGVyID0gZnVuY3Rpb24gKGxlZnQpIHtcblx0XHR0aGlzLmFycm93RWxlbWVudC5zdHlsZS5tYXJnaW5MZWZ0ID0gbGVmdDtcblxuXHRcdHRoaXMuZ3JvdXBMaXN0LmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XG5cdFx0XHRjaGlsZC5zY3JvbGxIZWFkZXIobGVmdCk7XG5cdFx0fSk7XG5cdH07XG5cblx0R3JvdXAucHJvdG90eXBlLmdldFJvd0luZGV4ID0gZnVuY3Rpb24gKHJvdykge307XG5cblx0Ly91cGRhdGUgcm93IGRhdGEgdG8gbWF0Y2ggZ3JvdXBpbmcgY29udHJhaW50c1xuXHRHcm91cC5wcm90b3R5cGUuY29uZm9ybVJvd0RhdGEgPSBmdW5jdGlvbiAoZGF0YSkge1xuXHRcdGlmICh0aGlzLmZpZWxkKSB7XG5cdFx0XHRkYXRhW3RoaXMuZmllbGRdID0gdGhpcy5rZXk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIkRhdGEgQ29uZm9ybWluZyBFcnJvciAtIENhbm5vdCBjb25mb3JtIHJvdyBkYXRhIHRvIG1hdGNoIG5ldyBncm91cCBhcyBncm91cEJ5IGlzIGEgZnVuY3Rpb25cIik7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMucGFyZW50KSB7XG5cdFx0XHRkYXRhID0gdGhpcy5wYXJlbnQuY29uZm9ybVJvd0RhdGEoZGF0YSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGRhdGE7XG5cdH07XG5cblx0R3JvdXAucHJvdG90eXBlLnJlbW92ZVJvdyA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR2YXIgaW5kZXggPSB0aGlzLnJvd3MuaW5kZXhPZihyb3cpO1xuXHRcdHZhciBlbCA9IHJvdy5nZXRFbGVtZW50KCk7XG5cblx0XHRpZiAoaW5kZXggPiAtMSkge1xuXHRcdFx0dGhpcy5yb3dzLnNwbGljZShpbmRleCwgMSk7XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5vcHRpb25zLmdyb3VwVmFsdWVzICYmICF0aGlzLnJvd3MubGVuZ3RoKSB7XG5cdFx0XHRpZiAodGhpcy5wYXJlbnQpIHtcblx0XHRcdFx0dGhpcy5wYXJlbnQucmVtb3ZlR3JvdXAodGhpcyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLmdyb3VwTWFuYWdlci5yZW1vdmVHcm91cCh0aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5ncm91cE1hbmFnZXIudXBkYXRlR3JvdXBSb3dzKHRydWUpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChlbC5wYXJlbnROb2RlKSB7XG5cdFx0XHRcdGVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWwpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmdlbmVyYXRlR3JvdXBIZWFkZXJDb250ZW50cygpO1xuXG5cdFx0XHRpZiAodGhpcy5ncm91cE1hbmFnZXIudGFibGUubW9kRXhpc3RzKFwiY29sdW1uQ2FsY3NcIikgJiYgdGhpcy5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5jb2x1bW5DYWxjcyAhPSBcInRhYmxlXCIpIHtcblx0XHRcdFx0dGhpcy5ncm91cE1hbmFnZXIudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5yZWNhbGNHcm91cCh0aGlzKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0R3JvdXAucHJvdG90eXBlLnJlbW92ZUdyb3VwID0gZnVuY3Rpb24gKGdyb3VwKSB7XG5cdFx0dmFyIGdyb3VwS2V5ID0gZ3JvdXAubGV2ZWwgKyBcIl9cIiArIGdyb3VwLmtleSxcblx0XHQgICAgaW5kZXg7XG5cblx0XHRpZiAodGhpcy5ncm91cHNbZ3JvdXBLZXldKSB7XG5cdFx0XHRkZWxldGUgdGhpcy5ncm91cHNbZ3JvdXBLZXldO1xuXG5cdFx0XHRpbmRleCA9IHRoaXMuZ3JvdXBMaXN0LmluZGV4T2YoZ3JvdXApO1xuXG5cdFx0XHRpZiAoaW5kZXggPiAtMSkge1xuXHRcdFx0XHR0aGlzLmdyb3VwTGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXRoaXMuZ3JvdXBMaXN0Lmxlbmd0aCkge1xuXHRcdFx0XHRpZiAodGhpcy5wYXJlbnQpIHtcblx0XHRcdFx0XHR0aGlzLnBhcmVudC5yZW1vdmVHcm91cCh0aGlzKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLmdyb3VwTWFuYWdlci5yZW1vdmVHcm91cCh0aGlzKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUuZ2V0SGVhZGVyc0FuZFJvd3MgPSBmdW5jdGlvbiAobm9DYWxjKSB7XG5cdFx0dmFyIG91dHB1dCA9IFtdO1xuXG5cdFx0b3V0cHV0LnB1c2godGhpcyk7XG5cblx0XHR0aGlzLl92aXNTZXQoKTtcblxuXHRcdGlmICh0aGlzLnZpc2libGUpIHtcblx0XHRcdGlmICh0aGlzLmdyb3VwTGlzdC5sZW5ndGgpIHtcblx0XHRcdFx0dGhpcy5ncm91cExpc3QuZm9yRWFjaChmdW5jdGlvbiAoZ3JvdXApIHtcblx0XHRcdFx0XHRvdXRwdXQgPSBvdXRwdXQuY29uY2F0KGdyb3VwLmdldEhlYWRlcnNBbmRSb3dzKG5vQ2FsYykpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmICghbm9DYWxjICYmIHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMuY29sdW1uQ2FsY3MgIT0gXCJ0YWJsZVwiICYmIHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpICYmIHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MuaGFzVG9wQ2FsY3MoKSkge1xuXHRcdFx0XHRcdGlmICh0aGlzLmNhbGNzLnRvcCkge1xuXHRcdFx0XHRcdFx0dGhpcy5jYWxjcy50b3AuZGV0YWNoRWxlbWVudCgpO1xuXHRcdFx0XHRcdFx0dGhpcy5jYWxjcy50b3AuZGVsZXRlQ2VsbHMoKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHR0aGlzLmNhbGNzLnRvcCA9IHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MuZ2VuZXJhdGVUb3BSb3codGhpcy5yb3dzKTtcblx0XHRcdFx0XHRvdXRwdXQucHVzaCh0aGlzLmNhbGNzLnRvcCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRvdXRwdXQgPSBvdXRwdXQuY29uY2F0KHRoaXMucm93cyk7XG5cblx0XHRcdFx0aWYgKCFub0NhbGMgJiYgdGhpcy5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5jb2x1bW5DYWxjcyAhPSBcInRhYmxlXCIgJiYgdGhpcy5ncm91cE1hbmFnZXIudGFibGUubW9kRXhpc3RzKFwiY29sdW1uQ2FsY3NcIikgJiYgdGhpcy5ncm91cE1hbmFnZXIudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5oYXNCb3R0b21DYWxjcygpKSB7XG5cdFx0XHRcdFx0aWYgKHRoaXMuY2FsY3MuYm90dG9tKSB7XG5cdFx0XHRcdFx0XHR0aGlzLmNhbGNzLmJvdHRvbS5kZXRhY2hFbGVtZW50KCk7XG5cdFx0XHRcdFx0XHR0aGlzLmNhbGNzLmJvdHRvbS5kZWxldGVDZWxscygpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHRoaXMuY2FsY3MuYm90dG9tID0gdGhpcy5ncm91cE1hbmFnZXIudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5nZW5lcmF0ZUJvdHRvbVJvdyh0aGlzLnJvd3MpO1xuXHRcdFx0XHRcdG91dHB1dC5wdXNoKHRoaXMuY2FsY3MuYm90dG9tKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRpZiAoIXRoaXMuZ3JvdXBMaXN0Lmxlbmd0aCAmJiB0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5vcHRpb25zLmNvbHVtbkNhbGNzICE9IFwidGFibGVcIikge1xuXG5cdFx0XHRcdGlmICh0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiKSkge1xuXG5cdFx0XHRcdFx0aWYgKCFub0NhbGMgJiYgdGhpcy5ncm91cE1hbmFnZXIudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5oYXNUb3BDYWxjcygpKSB7XG5cdFx0XHRcdFx0XHRpZiAodGhpcy5jYWxjcy50b3ApIHtcblx0XHRcdFx0XHRcdFx0dGhpcy5jYWxjcy50b3AuZGV0YWNoRWxlbWVudCgpO1xuXHRcdFx0XHRcdFx0XHR0aGlzLmNhbGNzLnRvcC5kZWxldGVDZWxscygpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAodGhpcy5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5ncm91cENsb3NlZFNob3dDYWxjcykge1xuXHRcdFx0XHRcdFx0XHR0aGlzLmNhbGNzLnRvcCA9IHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MuZ2VuZXJhdGVUb3BSb3codGhpcy5yb3dzKTtcblx0XHRcdFx0XHRcdFx0b3V0cHV0LnB1c2godGhpcy5jYWxjcy50b3ApO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICghbm9DYWxjICYmIHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MuaGFzQm90dG9tQ2FsY3MoKSkge1xuXHRcdFx0XHRcdFx0aWYgKHRoaXMuY2FsY3MuYm90dG9tKSB7XG5cdFx0XHRcdFx0XHRcdHRoaXMuY2FsY3MuYm90dG9tLmRldGFjaEVsZW1lbnQoKTtcblx0XHRcdFx0XHRcdFx0dGhpcy5jYWxjcy5ib3R0b20uZGVsZXRlQ2VsbHMoKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMuZ3JvdXBDbG9zZWRTaG93Q2FsY3MpIHtcblx0XHRcdFx0XHRcdFx0dGhpcy5jYWxjcy5ib3R0b20gPSB0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLmdlbmVyYXRlQm90dG9tUm93KHRoaXMucm93cyk7XG5cdFx0XHRcdFx0XHRcdG91dHB1dC5wdXNoKHRoaXMuY2FsY3MuYm90dG9tKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9O1xuXG5cdEdyb3VwLnByb3RvdHlwZS5nZXREYXRhID0gZnVuY3Rpb24gKHZpc2libGUsIHRyYW5zZm9ybSkge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgb3V0cHV0ID0gW107XG5cblx0XHR0aGlzLl92aXNTZXQoKTtcblxuXHRcdGlmICghdmlzaWJsZSB8fCB2aXNpYmxlICYmIHRoaXMudmlzaWJsZSkge1xuXHRcdFx0dGhpcy5yb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0XHRvdXRwdXQucHVzaChyb3cuZ2V0RGF0YSh0cmFuc2Zvcm0gfHwgXCJkYXRhXCIpKTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0Ly8gR3JvdXAucHJvdG90eXBlLmdldFJvd3MgPSBmdW5jdGlvbigpe1xuXHQvLyBcdHRoaXMuX3Zpc1NldCgpO1xuXG5cdC8vIFx0cmV0dXJuIHRoaXMudmlzaWJsZSA/IHRoaXMucm93cyA6IFtdO1xuXHQvLyB9O1xuXG5cdEdyb3VwLnByb3RvdHlwZS5nZXRSb3dDb3VudCA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgY291bnQgPSAwO1xuXG5cdFx0aWYgKHRoaXMuZ3JvdXBMaXN0Lmxlbmd0aCkge1xuXHRcdFx0dGhpcy5ncm91cExpc3QuZm9yRWFjaChmdW5jdGlvbiAoZ3JvdXApIHtcblx0XHRcdFx0Y291bnQgKz0gZ3JvdXAuZ2V0Um93Q291bnQoKTtcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjb3VudCA9IHRoaXMucm93cy5sZW5ndGg7XG5cdFx0fVxuXHRcdHJldHVybiBjb3VudDtcblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUudG9nZ2xlVmlzaWJpbGl0eSA9IGZ1bmN0aW9uICgpIHtcblx0XHRpZiAodGhpcy52aXNpYmxlKSB7XG5cdFx0XHR0aGlzLmhpZGUoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5zaG93KCk7XG5cdFx0fVxuXHR9O1xuXG5cdEdyb3VwLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMudmlzaWJsZSA9IGZhbHNlO1xuXG5cdFx0aWYgKHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLnJvd01hbmFnZXIuZ2V0UmVuZGVyTW9kZSgpID09IFwiY2xhc3NpY1wiICYmICF0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5vcHRpb25zLnBhZ2luYXRpb24pIHtcblxuXHRcdFx0dGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItZ3JvdXAtdmlzaWJsZVwiKTtcblxuXHRcdFx0aWYgKHRoaXMuZ3JvdXBMaXN0Lmxlbmd0aCkge1xuXHRcdFx0XHR0aGlzLmdyb3VwTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChncm91cCkge1xuXG5cdFx0XHRcdFx0dmFyIHJvd3MgPSBncm91cC5nZXRIZWFkZXJzQW5kUm93cygpO1xuXG5cdFx0XHRcdFx0cm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0XHRcdHJvdy5kZXRhY2hFbGVtZW50KCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5yb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0XHRcdHZhciByb3dFbCA9IHJvdy5nZXRFbGVtZW50KCk7XG5cdFx0XHRcdFx0cm93RWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChyb3dFbCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5yb3dNYW5hZ2VyLnNldERpc3BsYXlSb3dzKHRoaXMuZ3JvdXBNYW5hZ2VyLnVwZGF0ZUdyb3VwUm93cygpLCB0aGlzLmdyb3VwTWFuYWdlci5nZXREaXNwbGF5SW5kZXgoKSk7XG5cblx0XHRcdHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLnJvd01hbmFnZXIuY2hlY2tDbGFzc2ljTW9kZUdyb3VwSGVhZGVyV2lkdGgoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5ncm91cE1hbmFnZXIudXBkYXRlR3JvdXBSb3dzKHRydWUpO1xuXHRcdH1cblxuXHRcdHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMuZ3JvdXBWaXNpYmlsaXR5Q2hhbmdlZC5jYWxsKHRoaXMudGFibGUsIHRoaXMuZ2V0Q29tcG9uZW50KCksIGZhbHNlKTtcblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRzZWxmLnZpc2libGUgPSB0cnVlO1xuXG5cdFx0aWYgKHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLnJvd01hbmFnZXIuZ2V0UmVuZGVyTW9kZSgpID09IFwiY2xhc3NpY1wiICYmICF0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5vcHRpb25zLnBhZ2luYXRpb24pIHtcblxuXHRcdFx0dGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZ3JvdXAtdmlzaWJsZVwiKTtcblxuXHRcdFx0dmFyIHByZXYgPSBzZWxmLmdldEVsZW1lbnQoKTtcblxuXHRcdFx0aWYgKHRoaXMuZ3JvdXBMaXN0Lmxlbmd0aCkge1xuXHRcdFx0XHR0aGlzLmdyb3VwTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChncm91cCkge1xuXHRcdFx0XHRcdHZhciByb3dzID0gZ3JvdXAuZ2V0SGVhZGVyc0FuZFJvd3MoKTtcblxuXHRcdFx0XHRcdHJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRcdFx0XHR2YXIgcm93RWwgPSByb3cuZ2V0RWxlbWVudCgpO1xuXHRcdFx0XHRcdFx0cHJldi5wYXJlbnROb2RlLmluc2VydEJlZm9yZShyb3dFbCwgcHJldi5uZXh0U2libGluZyk7XG5cdFx0XHRcdFx0XHRyb3cuaW5pdGlhbGl6ZSgpO1xuXHRcdFx0XHRcdFx0cHJldiA9IHJvd0VsO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHNlbGYucm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0XHR2YXIgcm93RWwgPSByb3cuZ2V0RWxlbWVudCgpO1xuXHRcdFx0XHRcdHByZXYucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUocm93RWwsIHByZXYubmV4dFNpYmxpbmcpO1xuXHRcdFx0XHRcdHJvdy5pbml0aWFsaXplKCk7XG5cdFx0XHRcdFx0cHJldiA9IHJvd0VsO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5ncm91cE1hbmFnZXIudGFibGUucm93TWFuYWdlci5zZXREaXNwbGF5Um93cyh0aGlzLmdyb3VwTWFuYWdlci51cGRhdGVHcm91cFJvd3MoKSwgdGhpcy5ncm91cE1hbmFnZXIuZ2V0RGlzcGxheUluZGV4KCkpO1xuXG5cdFx0XHR0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5yb3dNYW5hZ2VyLmNoZWNrQ2xhc3NpY01vZGVHcm91cEhlYWRlcldpZHRoKCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuZ3JvdXBNYW5hZ2VyLnVwZGF0ZUdyb3VwUm93cyh0cnVlKTtcblx0XHR9XG5cblx0XHR0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5vcHRpb25zLmdyb3VwVmlzaWJpbGl0eUNoYW5nZWQuY2FsbCh0aGlzLnRhYmxlLCB0aGlzLmdldENvbXBvbmVudCgpLCB0cnVlKTtcblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUuX3Zpc1NldCA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgZGF0YSA9IFtdO1xuXG5cdFx0aWYgKHR5cGVvZiB0aGlzLnZpc2libGUgPT0gXCJmdW5jdGlvblwiKSB7XG5cblx0XHRcdHRoaXMucm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0ZGF0YS5wdXNoKHJvdy5nZXREYXRhKCkpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMudmlzaWJsZSA9IHRoaXMudmlzaWJsZSh0aGlzLmtleSwgdGhpcy5nZXRSb3dDb3VudCgpLCBkYXRhLCB0aGlzLmdldENvbXBvbmVudCgpKTtcblx0XHR9XG5cdH07XG5cblx0R3JvdXAucHJvdG90eXBlLmdldFJvd0dyb3VwID0gZnVuY3Rpb24gKHJvdykge1xuXHRcdHZhciBtYXRjaCA9IGZhbHNlO1xuXHRcdGlmICh0aGlzLmdyb3VwTGlzdC5sZW5ndGgpIHtcblx0XHRcdHRoaXMuZ3JvdXBMaXN0LmZvckVhY2goZnVuY3Rpb24gKGdyb3VwKSB7XG5cdFx0XHRcdHZhciByZXN1bHQgPSBncm91cC5nZXRSb3dHcm91cChyb3cpO1xuXG5cdFx0XHRcdGlmIChyZXN1bHQpIHtcblx0XHRcdFx0XHRtYXRjaCA9IHJlc3VsdDtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlmICh0aGlzLnJvd3MuZmluZChmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0XHRyZXR1cm4gaXRlbSA9PT0gcm93O1xuXHRcdFx0fSkpIHtcblx0XHRcdFx0bWF0Y2ggPSB0aGlzO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBtYXRjaDtcblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUuZ2V0U3ViR3JvdXBzID0gZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuXHRcdHZhciBvdXRwdXQgPSBbXTtcblxuXHRcdHRoaXMuZ3JvdXBMaXN0LmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XG5cdFx0XHRvdXRwdXQucHVzaChjb21wb25lbnQgPyBjaGlsZC5nZXRDb21wb25lbnQoKSA6IGNoaWxkKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0R3JvdXAucHJvdG90eXBlLmdldFJvd3MgPSBmdW5jdGlvbiAoY29tcG9tZW50KSB7XG5cdFx0dmFyIG91dHB1dCA9IFtdO1xuXG5cdFx0dGhpcy5yb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0b3V0cHV0LnB1c2goY29tcG9tZW50ID8gcm93LmdldENvbXBvbmVudCgpIDogcm93KTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0R3JvdXAucHJvdG90eXBlLmdlbmVyYXRlR3JvdXBIZWFkZXJDb250ZW50cyA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgZGF0YSA9IFtdO1xuXG5cdFx0dGhpcy5yb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0ZGF0YS5wdXNoKHJvdy5nZXREYXRhKCkpO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5lbGVtZW50Q29udGVudHMgPSB0aGlzLmdlbmVyYXRvcih0aGlzLmtleSwgdGhpcy5nZXRSb3dDb3VudCgpLCBkYXRhLCB0aGlzLmdldENvbXBvbmVudCgpKTtcblxuXHRcdHdoaWxlICh0aGlzLmVsZW1lbnQuZmlyc3RDaGlsZCkge1xuXHRcdFx0dGhpcy5lbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudC5maXJzdENoaWxkKTtcblx0XHR9aWYgKHR5cGVvZiB0aGlzLmVsZW1lbnRDb250ZW50cyA9PT0gXCJzdHJpbmdcIikge1xuXHRcdFx0dGhpcy5lbGVtZW50LmlubmVySFRNTCA9IHRoaXMuZWxlbWVudENvbnRlbnRzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5lbGVtZW50Q29udGVudHMpO1xuXHRcdH1cblxuXHRcdHRoaXMuZWxlbWVudC5pbnNlcnRCZWZvcmUodGhpcy5hcnJvd0VsZW1lbnQsIHRoaXMuZWxlbWVudC5maXJzdENoaWxkKTtcblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLyBTdGFuZGFyZCBSb3cgRnVuY3Rpb25zIC8vLy8vLy8vLy8vLy8vXG5cblx0R3JvdXAucHJvdG90eXBlLmdldEVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy5hZGRCaW5kaW5nc2QgPSBmYWxzZTtcblxuXHRcdHRoaXMuX3Zpc1NldCgpO1xuXG5cdFx0aWYgKHRoaXMudmlzaWJsZSkge1xuXHRcdFx0dGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZ3JvdXAtdmlzaWJsZVwiKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItZ3JvdXAtdmlzaWJsZVwiKTtcblx0XHR9XG5cblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZWxlbWVudC5jaGlsZE5vZGVzLmxlbmd0aDsgKytpKSB7XG5cdFx0XHR0aGlzLmVsZW1lbnQuY2hpbGROb2Rlc1tpXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudC5jaGlsZE5vZGVzW2ldKTtcblx0XHR9XG5cblx0XHR0aGlzLmdlbmVyYXRlR3JvdXBIZWFkZXJDb250ZW50cygpO1xuXG5cdFx0Ly8gdGhpcy5hZGRCaW5kaW5ncygpO1xuXG5cdFx0cmV0dXJuIHRoaXMuZWxlbWVudDtcblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUuZGV0YWNoRWxlbWVudCA9IGZ1bmN0aW9uICgpIHtcblx0XHRpZiAodGhpcy5lbGVtZW50ICYmIHRoaXMuZWxlbWVudC5wYXJlbnROb2RlKSB7XG5cdFx0XHR0aGlzLmVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnQpO1xuXHRcdH1cblx0fTtcblxuXHQvL25vcm1hbGl6ZSB0aGUgaGVpZ2h0IG9mIGVsZW1lbnRzIGluIHRoZSByb3dcblx0R3JvdXAucHJvdG90eXBlLm5vcm1hbGl6ZUhlaWdodCA9IGZ1bmN0aW9uICgpIHtcblx0XHR0aGlzLnNldEhlaWdodCh0aGlzLmVsZW1lbnQuY2xpZW50SGVpZ2h0KTtcblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChmb3JjZSkge1xuXHRcdGlmICghdGhpcy5pbml0aWFsaXplZCB8fCBmb3JjZSkge1xuXHRcdFx0dGhpcy5ub3JtYWxpemVIZWlnaHQoKTtcblx0XHRcdHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuXHRcdH1cblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUucmVpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcblx0XHR0aGlzLmhlaWdodCA9IDA7XG5cblx0XHRpZiAoVGFidWxhdG9yLnByb3RvdHlwZS5oZWxwZXJzLmVsVmlzaWJsZSh0aGlzLmVsZW1lbnQpKSB7XG5cdFx0XHR0aGlzLmluaXRpYWxpemUodHJ1ZSk7XG5cdFx0fVxuXHR9O1xuXG5cdEdyb3VwLnByb3RvdHlwZS5zZXRIZWlnaHQgPSBmdW5jdGlvbiAoaGVpZ2h0KSB7XG5cdFx0aWYgKHRoaXMuaGVpZ2h0ICE9IGhlaWdodCkge1xuXHRcdFx0dGhpcy5oZWlnaHQgPSBoZWlnaHQ7XG5cdFx0XHR0aGlzLm91dGVySGVpZ2h0ID0gdGhpcy5lbGVtZW50Lm9mZnNldEhlaWdodDtcblx0XHR9XG5cdH07XG5cblx0Ly9yZXR1cm4gcm93cyBvdXRlciBoZWlnaHRcblx0R3JvdXAucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5vdXRlckhlaWdodDtcblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUuZ2V0R3JvdXAgPSBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH07XG5cblx0R3JvdXAucHJvdG90eXBlLnJlaW5pdGlhbGl6ZUhlaWdodCA9IGZ1bmN0aW9uICgpIHt9O1xuXHRHcm91cC5wcm90b3R5cGUuY2FsY0hlaWdodCA9IGZ1bmN0aW9uICgpIHt9O1xuXHRHcm91cC5wcm90b3R5cGUuc2V0Q2VsbEhlaWdodCA9IGZ1bmN0aW9uICgpIHt9O1xuXHRHcm91cC5wcm90b3R5cGUuY2xlYXJDZWxsSGVpZ2h0ID0gZnVuY3Rpb24gKCkge307XG5cblx0Ly8vLy8vLy8vLy8vLy8vLyBPYmplY3QgR2VuZXJhdGlvbiAvLy8vLy8vLy8vLy8vLy8vL1xuXHRHcm91cC5wcm90b3R5cGUuZ2V0Q29tcG9uZW50ID0gZnVuY3Rpb24gKCkge1xuXHRcdGlmICghdGhpcy5jb21wb25lbnQpIHtcblx0XHRcdHRoaXMuY29tcG9uZW50ID0gbmV3IEdyb3VwQ29tcG9uZW50KHRoaXMpO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzLmNvbXBvbmVudDtcblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLyBHcm91cCBSb3cgRXh0ZW5zaW9uIC8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5cdHZhciBHcm91cFJvd3MgPSBmdW5jdGlvbiBHcm91cFJvd3ModGFibGUpIHtcblxuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIFRhYnVsYXRvciBvYmplY3RcblxuXHRcdHRoaXMuZ3JvdXBJRExvb2t1cHMgPSBmYWxzZTsgLy9lbmFibGUgdGFibGUgZ3JvdXBpbmcgYW5kIHNldCBmaWVsZCB0byBncm91cCBieVxuXHRcdHRoaXMuc3RhcnRPcGVuID0gW2Z1bmN0aW9uICgpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XTsgLy9zdGFydGluZyBzdGF0ZSBvZiBncm91cFxuXHRcdHRoaXMuaGVhZGVyR2VuZXJhdG9yID0gW2Z1bmN0aW9uICgpIHtcblx0XHRcdHJldHVybiBcIlwiO1xuXHRcdH1dO1xuXHRcdHRoaXMuZ3JvdXBMaXN0ID0gW107IC8vb3JkZXJlZCBsaXN0IG9mIGdyb3Vwc1xuXHRcdHRoaXMuYWxsb3dlZFZhbHVlcyA9IGZhbHNlO1xuXHRcdHRoaXMuZ3JvdXBzID0ge307IC8vaG9sZCByb3cgZ3JvdXBzXG5cdFx0dGhpcy5kaXNwbGF5SW5kZXggPSAwOyAvL2luZGV4IGluIGRpc3BsYXkgcGlwZWxpbmVcblx0fTtcblxuXHQvL2luaXRpYWxpemUgZ3JvdXAgY29uZmlndXJhdGlvblxuXHRHcm91cFJvd3MucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBncm91cEJ5ID0gc2VsZi50YWJsZS5vcHRpb25zLmdyb3VwQnksXG5cdFx0ICAgIHN0YXJ0T3BlbiA9IHNlbGYudGFibGUub3B0aW9ucy5ncm91cFN0YXJ0T3Blbixcblx0XHQgICAgZ3JvdXBIZWFkZXIgPSBzZWxmLnRhYmxlLm9wdGlvbnMuZ3JvdXBIZWFkZXI7XG5cblx0XHR0aGlzLmFsbG93ZWRWYWx1ZXMgPSBzZWxmLnRhYmxlLm9wdGlvbnMuZ3JvdXBWYWx1ZXM7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShncm91cEJ5KSAmJiBBcnJheS5pc0FycmF5KGdyb3VwSGVhZGVyKSAmJiBncm91cEJ5Lmxlbmd0aCA+IGdyb3VwSGVhZGVyLmxlbmd0aCkge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiRXJyb3IgY3JlYXRpbmcgZ3JvdXAgaGVhZGVycywgZ3JvdXBIZWFkZXIgYXJyYXkgaXMgc2hvcnRlciB0aGFuIGdyb3VwQnkgYXJyYXlcIik7XG5cdFx0fVxuXG5cdFx0c2VsZi5oZWFkZXJHZW5lcmF0b3IgPSBbZnVuY3Rpb24gKCkge1xuXHRcdFx0cmV0dXJuIFwiXCI7XG5cdFx0fV07XG5cdFx0dGhpcy5zdGFydE9wZW4gPSBbZnVuY3Rpb24gKCkge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1dOyAvL3N0YXJ0aW5nIHN0YXRlIG9mIGdyb3VwXG5cblx0XHRzZWxmLnRhYmxlLm1vZHVsZXMubG9jYWxpemUuYmluZChcImdyb3Vwc3xpdGVtXCIsIGZ1bmN0aW9uIChsYW5nVmFsdWUsIGxhbmcpIHtcblx0XHRcdHNlbGYuaGVhZGVyR2VuZXJhdG9yWzBdID0gZnVuY3Rpb24gKHZhbHVlLCBjb3VudCwgZGF0YSkge1xuXHRcdFx0XHQvL2hlYWRlciBsYXlvdXQgZnVuY3Rpb25cblx0XHRcdFx0cmV0dXJuICh0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCIgPyBcIlwiIDogdmFsdWUpICsgXCI8c3Bhbj4oXCIgKyBjb3VudCArIFwiIFwiICsgKGNvdW50ID09PSAxID8gbGFuZ1ZhbHVlIDogbGFuZy5ncm91cHMuaXRlbXMpICsgXCIpPC9zcGFuPlwiO1xuXHRcdFx0fTtcblx0XHR9KTtcblxuXHRcdHRoaXMuZ3JvdXBJRExvb2t1cHMgPSBbXTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGdyb3VwQnkpIHx8IGdyb3VwQnkpIHtcblx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpICYmIHRoaXMudGFibGUub3B0aW9ucy5jb2x1bW5DYWxjcyAhPSBcInRhYmxlXCIgJiYgdGhpcy50YWJsZS5vcHRpb25zLmNvbHVtbkNhbGNzICE9IFwiYm90aFwiKSB7XG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5yZW1vdmVDYWxjcygpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiKSAmJiB0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1uQ2FsY3MgIT0gXCJncm91cFwiKSB7XG5cblx0XHRcdFx0dmFyIGNvbHMgPSB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0UmVhbENvbHVtbnMoKTtcblxuXHRcdFx0XHRjb2xzLmZvckVhY2goZnVuY3Rpb24gKGNvbCkge1xuXHRcdFx0XHRcdGlmIChjb2wuZGVmaW5pdGlvbi50b3BDYWxjKSB7XG5cdFx0XHRcdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MuaW5pdGlhbGl6ZVRvcFJvdygpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChjb2wuZGVmaW5pdGlvbi5ib3R0b21DYWxjKSB7XG5cdFx0XHRcdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MuaW5pdGlhbGl6ZUJvdHRvbVJvdygpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCFBcnJheS5pc0FycmF5KGdyb3VwQnkpKSB7XG5cdFx0XHRncm91cEJ5ID0gW2dyb3VwQnldO1xuXHRcdH1cblxuXHRcdGdyb3VwQnkuZm9yRWFjaChmdW5jdGlvbiAoZ3JvdXAsIGkpIHtcblx0XHRcdHZhciBsb29rdXBGdW5jLCBjb2x1bW47XG5cblx0XHRcdGlmICh0eXBlb2YgZ3JvdXAgPT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGxvb2t1cEZ1bmMgPSBncm91cDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvbHVtbiA9IHNlbGYudGFibGUuY29sdW1uTWFuYWdlci5nZXRDb2x1bW5CeUZpZWxkKGdyb3VwKTtcblxuXHRcdFx0XHRpZiAoY29sdW1uKSB7XG5cdFx0XHRcdFx0bG9va3VwRnVuYyA9IGZ1bmN0aW9uIGxvb2t1cEZ1bmMoZGF0YSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGNvbHVtbi5nZXRGaWVsZFZhbHVlKGRhdGEpO1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0bG9va3VwRnVuYyA9IGZ1bmN0aW9uIGxvb2t1cEZ1bmMoZGF0YSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGRhdGFbZ3JvdXBdO1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0c2VsZi5ncm91cElETG9va3Vwcy5wdXNoKHtcblx0XHRcdFx0ZmllbGQ6IHR5cGVvZiBncm91cCA9PT0gXCJmdW5jdGlvblwiID8gZmFsc2UgOiBncm91cCxcblx0XHRcdFx0ZnVuYzogbG9va3VwRnVuYyxcblx0XHRcdFx0dmFsdWVzOiBzZWxmLmFsbG93ZWRWYWx1ZXMgPyBzZWxmLmFsbG93ZWRWYWx1ZXNbaV0gOiBmYWxzZVxuXHRcdFx0fSk7XG5cdFx0fSk7XG5cblx0XHRpZiAoc3RhcnRPcGVuKSB7XG5cblx0XHRcdGlmICghQXJyYXkuaXNBcnJheShzdGFydE9wZW4pKSB7XG5cdFx0XHRcdHN0YXJ0T3BlbiA9IFtzdGFydE9wZW5dO1xuXHRcdFx0fVxuXG5cdFx0XHRzdGFydE9wZW4uZm9yRWFjaChmdW5jdGlvbiAobGV2ZWwpIHtcblx0XHRcdFx0bGV2ZWwgPSB0eXBlb2YgbGV2ZWwgPT0gXCJmdW5jdGlvblwiID8gbGV2ZWwgOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdH07XG5cdFx0XHR9KTtcblxuXHRcdFx0c2VsZi5zdGFydE9wZW4gPSBzdGFydE9wZW47XG5cdFx0fVxuXG5cdFx0aWYgKGdyb3VwSGVhZGVyKSB7XG5cdFx0XHRzZWxmLmhlYWRlckdlbmVyYXRvciA9IEFycmF5LmlzQXJyYXkoZ3JvdXBIZWFkZXIpID8gZ3JvdXBIZWFkZXIgOiBbZ3JvdXBIZWFkZXJdO1xuXHRcdH1cblxuXHRcdHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuXHR9O1xuXG5cdEdyb3VwUm93cy5wcm90b3R5cGUuc2V0RGlzcGxheUluZGV4ID0gZnVuY3Rpb24gKGluZGV4KSB7XG5cdFx0dGhpcy5kaXNwbGF5SW5kZXggPSBpbmRleDtcblx0fTtcblxuXHRHcm91cFJvd3MucHJvdG90eXBlLmdldERpc3BsYXlJbmRleCA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5kaXNwbGF5SW5kZXg7XG5cdH07XG5cblx0Ly9yZXR1cm4gYXBwcm9wcmlhdGUgcm93cyB3aXRoIGdyb3VwIGhlYWRlcnNcblx0R3JvdXBSb3dzLnByb3RvdHlwZS5nZXRSb3dzID0gZnVuY3Rpb24gKHJvd3MpIHtcblx0XHRpZiAodGhpcy5ncm91cElETG9va3Vwcy5sZW5ndGgpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLmRhdGFHcm91cGluZy5jYWxsKHRoaXMudGFibGUpO1xuXG5cdFx0XHR0aGlzLmdlbmVyYXRlR3JvdXBzKHJvd3MpO1xuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmRhdGFHcm91cGVkKSB7XG5cdFx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5kYXRhR3JvdXBlZC5jYWxsKHRoaXMudGFibGUsIHRoaXMuZ2V0R3JvdXBzKHRydWUpKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHRoaXMudXBkYXRlR3JvdXBSb3dzKCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiByb3dzLnNsaWNlKDApO1xuXHRcdH1cblx0fTtcblxuXHRHcm91cFJvd3MucHJvdG90eXBlLmdldEdyb3VwcyA9IGZ1bmN0aW9uIChjb21wb21lbnQpIHtcblx0XHR2YXIgZ3JvdXBDb21wb25lbnRzID0gW107XG5cblx0XHR0aGlzLmdyb3VwTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChncm91cCkge1xuXHRcdFx0Z3JvdXBDb21wb25lbnRzLnB1c2goY29tcG9tZW50ID8gZ3JvdXAuZ2V0Q29tcG9uZW50KCkgOiBncm91cCk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gZ3JvdXBDb21wb25lbnRzO1xuXHR9O1xuXG5cdEdyb3VwUm93cy5wcm90b3R5cGUuZ2V0Q2hpbGRHcm91cHMgPSBmdW5jdGlvbiAoZ3JvdXApIHtcblx0XHR2YXIgX3RoaXM1OSA9IHRoaXM7XG5cblx0XHR2YXIgZ3JvdXBDb21wb25lbnRzID0gW107XG5cblx0XHRpZiAoIWdyb3VwKSB7XG5cdFx0XHRncm91cCA9IHRoaXM7XG5cdFx0fVxuXG5cdFx0Z3JvdXAuZ3JvdXBMaXN0LmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XG5cdFx0XHRpZiAoY2hpbGQuZ3JvdXBMaXN0Lmxlbmd0aCkge1xuXHRcdFx0XHRncm91cENvbXBvbmVudHMgPSBncm91cENvbXBvbmVudHMuY29uY2F0KF90aGlzNTkuZ2V0Q2hpbGRHcm91cHMoY2hpbGQpKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdyb3VwQ29tcG9uZW50cy5wdXNoKGNoaWxkKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiBncm91cENvbXBvbmVudHM7XG5cdH07XG5cblx0R3JvdXBSb3dzLnByb3RvdHlwZS53aXBlID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMuZ3JvdXBMaXN0LmZvckVhY2goZnVuY3Rpb24gKGdyb3VwKSB7XG5cdFx0XHRncm91cC53aXBlKCk7XG5cdFx0fSk7XG5cdH07XG5cblx0R3JvdXBSb3dzLnByb3RvdHlwZS5wdWxsR3JvdXBMaXN0RGF0YSA9IGZ1bmN0aW9uIChncm91cExpc3QpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cdFx0dmFyIGdyb3VwTGlzdERhdGEgPSBbXTtcblxuXHRcdGdyb3VwTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChncm91cCkge1xuXHRcdFx0dmFyIGdyb3VwSGVhZGVyID0ge307XG5cdFx0XHRncm91cEhlYWRlci5sZXZlbCA9IDA7XG5cdFx0XHRncm91cEhlYWRlci5yb3dDb3VudCA9IDA7XG5cdFx0XHRncm91cEhlYWRlci5oZWFkZXJDb250ZW50ID0gXCJcIjtcblx0XHRcdHZhciBjaGlsZERhdGEgPSBbXTtcblxuXHRcdFx0aWYgKGdyb3VwLmhhc1N1Ykdyb3Vwcykge1xuXHRcdFx0XHRjaGlsZERhdGEgPSBzZWxmLnB1bGxHcm91cExpc3REYXRhKGdyb3VwLmdyb3VwTGlzdCk7XG5cblx0XHRcdFx0Z3JvdXBIZWFkZXIubGV2ZWwgPSBncm91cC5sZXZlbDtcblx0XHRcdFx0Z3JvdXBIZWFkZXIucm93Q291bnQgPSBjaGlsZERhdGEubGVuZ3RoIC0gZ3JvdXAuZ3JvdXBMaXN0Lmxlbmd0aDsgLy8gZGF0YSBsZW5ndGggbWludXMgbnVtYmVyIG9mIHN1Yi1oZWFkZXJzXG5cdFx0XHRcdGdyb3VwSGVhZGVyLmhlYWRlckNvbnRlbnQgPSBncm91cC5nZW5lcmF0b3IoZ3JvdXAua2V5LCBncm91cEhlYWRlci5yb3dDb3VudCwgZ3JvdXAucm93cywgZ3JvdXApO1xuXG5cdFx0XHRcdGdyb3VwTGlzdERhdGEucHVzaChncm91cEhlYWRlcik7XG5cdFx0XHRcdGdyb3VwTGlzdERhdGEgPSBncm91cExpc3REYXRhLmNvbmNhdChjaGlsZERhdGEpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3JvdXBIZWFkZXIubGV2ZWwgPSBncm91cC5sZXZlbDtcblx0XHRcdFx0Z3JvdXBIZWFkZXIuaGVhZGVyQ29udGVudCA9IGdyb3VwLmdlbmVyYXRvcihncm91cC5rZXksIGdyb3VwLnJvd3MubGVuZ3RoLCBncm91cC5yb3dzLCBncm91cCk7XG5cdFx0XHRcdGdyb3VwSGVhZGVyLnJvd0NvdW50ID0gZ3JvdXAuZ2V0Um93cygpLmxlbmd0aDtcblxuXHRcdFx0XHRncm91cExpc3REYXRhLnB1c2goZ3JvdXBIZWFkZXIpO1xuXG5cdFx0XHRcdGdyb3VwLmdldFJvd3MoKS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0XHRncm91cExpc3REYXRhLnB1c2gocm93LmdldERhdGEoXCJkYXRhXCIpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gZ3JvdXBMaXN0RGF0YTtcblx0fTtcblxuXHRHcm91cFJvd3MucHJvdG90eXBlLmdldEdyb3VwZWREYXRhID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMucHVsbEdyb3VwTGlzdERhdGEodGhpcy5ncm91cExpc3QpO1xuXHR9O1xuXG5cdEdyb3VwUm93cy5wcm90b3R5cGUuZ2V0Um93R3JvdXAgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIG1hdGNoID0gZmFsc2U7XG5cblx0XHR0aGlzLmdyb3VwTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChncm91cCkge1xuXHRcdFx0dmFyIHJlc3VsdCA9IGdyb3VwLmdldFJvd0dyb3VwKHJvdyk7XG5cblx0XHRcdGlmIChyZXN1bHQpIHtcblx0XHRcdFx0bWF0Y2ggPSByZXN1bHQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gbWF0Y2g7XG5cdH07XG5cblx0R3JvdXBSb3dzLnByb3RvdHlwZS5jb3VudEdyb3VwcyA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5ncm91cExpc3QubGVuZ3RoO1xuXHR9O1xuXG5cdEdyb3VwUm93cy5wcm90b3R5cGUuZ2VuZXJhdGVHcm91cHMgPSBmdW5jdGlvbiAocm93cykge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgb2xkR3JvdXBzID0gc2VsZi5ncm91cHM7XG5cblx0XHRzZWxmLmdyb3VwcyA9IHt9O1xuXHRcdHNlbGYuZ3JvdXBMaXN0ID0gW107XG5cblx0XHRpZiAodGhpcy5hbGxvd2VkVmFsdWVzICYmIHRoaXMuYWxsb3dlZFZhbHVlc1swXSkge1xuXHRcdFx0dGhpcy5hbGxvd2VkVmFsdWVzWzBdLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0XHRcdHNlbGYuY3JlYXRlR3JvdXAodmFsdWUsIDAsIG9sZEdyb3Vwcyk7XG5cdFx0XHR9KTtcblxuXHRcdFx0cm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0c2VsZi5hc3NpZ25Sb3dUb0V4aXN0aW5nR3JvdXAocm93LCBvbGRHcm91cHMpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRcdHNlbGYuYXNzaWduUm93VG9Hcm91cChyb3csIG9sZEdyb3Vwcyk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH07XG5cblx0R3JvdXBSb3dzLnByb3RvdHlwZS5jcmVhdGVHcm91cCA9IGZ1bmN0aW9uIChncm91cElELCBsZXZlbCwgb2xkR3JvdXBzKSB7XG5cdFx0dmFyIGdyb3VwS2V5ID0gbGV2ZWwgKyBcIl9cIiArIGdyb3VwSUQsXG5cdFx0ICAgIGdyb3VwO1xuXG5cdFx0b2xkR3JvdXBzID0gb2xkR3JvdXBzIHx8IFtdO1xuXG5cdFx0Z3JvdXAgPSBuZXcgR3JvdXAodGhpcywgZmFsc2UsIGxldmVsLCBncm91cElELCB0aGlzLmdyb3VwSURMb29rdXBzWzBdLmZpZWxkLCB0aGlzLmhlYWRlckdlbmVyYXRvclswXSwgb2xkR3JvdXBzW2dyb3VwS2V5XSk7XG5cblx0XHR0aGlzLmdyb3Vwc1tncm91cEtleV0gPSBncm91cDtcblx0XHR0aGlzLmdyb3VwTGlzdC5wdXNoKGdyb3VwKTtcblx0fTtcblxuXHQvLyBHcm91cFJvd3MucHJvdG90eXBlLmFzc2lnblJvd1RvR3JvdXAgPSBmdW5jdGlvbihyb3csIG9sZEdyb3Vwcyl7XG5cdC8vIFx0dmFyIGdyb3VwSUQgPSB0aGlzLmdyb3VwSURMb29rdXBzWzBdLmZ1bmMocm93LmdldERhdGEoKSksXG5cdC8vIFx0Z3JvdXBLZXkgPSBcIjBfXCIgKyBncm91cElEO1xuXG5cdC8vIFx0aWYoIXRoaXMuZ3JvdXBzW2dyb3VwS2V5XSl7XG5cdC8vIFx0XHR0aGlzLmNyZWF0ZUdyb3VwKGdyb3VwSUQsIDAsIG9sZEdyb3Vwcyk7XG5cdC8vIFx0fVxuXG5cdC8vIFx0dGhpcy5ncm91cHNbZ3JvdXBLZXldLmFkZFJvdyhyb3cpO1xuXHQvLyB9O1xuXG5cdEdyb3VwUm93cy5wcm90b3R5cGUuYXNzaWduUm93VG9FeGlzdGluZ0dyb3VwID0gZnVuY3Rpb24gKHJvdywgb2xkR3JvdXBzKSB7XG5cdFx0dmFyIGdyb3VwSUQgPSB0aGlzLmdyb3VwSURMb29rdXBzWzBdLmZ1bmMocm93LmdldERhdGEoKSksXG5cdFx0ICAgIGdyb3VwS2V5ID0gXCIwX1wiICsgZ3JvdXBJRDtcblxuXHRcdGlmICh0aGlzLmdyb3Vwc1tncm91cEtleV0pIHtcblx0XHRcdHRoaXMuZ3JvdXBzW2dyb3VwS2V5XS5hZGRSb3cocm93KTtcblx0XHR9XG5cdH07XG5cblx0R3JvdXBSb3dzLnByb3RvdHlwZS5hc3NpZ25Sb3dUb0dyb3VwID0gZnVuY3Rpb24gKHJvdywgb2xkR3JvdXBzKSB7XG5cdFx0dmFyIGdyb3VwSUQgPSB0aGlzLmdyb3VwSURMb29rdXBzWzBdLmZ1bmMocm93LmdldERhdGEoKSksXG5cdFx0ICAgIG5ld0dyb3VwTmVlZGVkID0gIXRoaXMuZ3JvdXBzW1wiMF9cIiArIGdyb3VwSURdO1xuXG5cdFx0aWYgKG5ld0dyb3VwTmVlZGVkKSB7XG5cdFx0XHR0aGlzLmNyZWF0ZUdyb3VwKGdyb3VwSUQsIDAsIG9sZEdyb3Vwcyk7XG5cdFx0fVxuXG5cdFx0dGhpcy5ncm91cHNbXCIwX1wiICsgZ3JvdXBJRF0uYWRkUm93KHJvdyk7XG5cblx0XHRyZXR1cm4gIW5ld0dyb3VwTmVlZGVkO1xuXHR9O1xuXG5cdEdyb3VwUm93cy5wcm90b3R5cGUudXBkYXRlR3JvdXBSb3dzID0gZnVuY3Rpb24gKGZvcmNlKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBvdXRwdXQgPSBbXSxcblx0XHQgICAgb2xkUm93Q291bnQ7XG5cblx0XHRzZWxmLmdyb3VwTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChncm91cCkge1xuXHRcdFx0b3V0cHV0ID0gb3V0cHV0LmNvbmNhdChncm91cC5nZXRIZWFkZXJzQW5kUm93cygpKTtcblx0XHR9KTtcblxuXHRcdC8vZm9yY2UgdXBkYXRlIG9mIHRhYmxlIGRpc3BsYXlcblx0XHRpZiAoZm9yY2UpIHtcblxuXHRcdFx0dmFyIGRpc3BsYXlJbmRleCA9IHNlbGYudGFibGUucm93TWFuYWdlci5zZXREaXNwbGF5Um93cyhvdXRwdXQsIHRoaXMuZ2V0RGlzcGxheUluZGV4KCkpO1xuXG5cdFx0XHRpZiAoZGlzcGxheUluZGV4ICE9PSB0cnVlKSB7XG5cdFx0XHRcdHRoaXMuc2V0RGlzcGxheUluZGV4KGRpc3BsYXlJbmRleCk7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYudGFibGUucm93TWFuYWdlci5yZWZyZXNoQWN0aXZlRGF0YShcImdyb3VwXCIsIHRydWUsIHRydWUpO1xuXHRcdH1cblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0R3JvdXBSb3dzLnByb3RvdHlwZS5zY3JvbGxIZWFkZXJzID0gZnVuY3Rpb24gKGxlZnQpIHtcblx0XHRsZWZ0ID0gbGVmdCArIFwicHhcIjtcblxuXHRcdHRoaXMuZ3JvdXBMaXN0LmZvckVhY2goZnVuY3Rpb24gKGdyb3VwKSB7XG5cdFx0XHRncm91cC5zY3JvbGxIZWFkZXIobGVmdCk7XG5cdFx0fSk7XG5cdH07XG5cblx0R3JvdXBSb3dzLnByb3RvdHlwZS5yZW1vdmVHcm91cCA9IGZ1bmN0aW9uIChncm91cCkge1xuXHRcdHZhciBncm91cEtleSA9IGdyb3VwLmxldmVsICsgXCJfXCIgKyBncm91cC5rZXksXG5cdFx0ICAgIGluZGV4O1xuXG5cdFx0aWYgKHRoaXMuZ3JvdXBzW2dyb3VwS2V5XSkge1xuXHRcdFx0ZGVsZXRlIHRoaXMuZ3JvdXBzW2dyb3VwS2V5XTtcblxuXHRcdFx0aW5kZXggPSB0aGlzLmdyb3VwTGlzdC5pbmRleE9mKGdyb3VwKTtcblxuXHRcdFx0aWYgKGluZGV4ID4gLTEpIHtcblx0XHRcdFx0dGhpcy5ncm91cExpc3Quc3BsaWNlKGluZGV4LCAxKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcImdyb3VwUm93c1wiLCBHcm91cFJvd3MpO1xuXHR2YXIgSGlzdG9yeSA9IGZ1bmN0aW9uIEhpc3RvcnkodGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cblx0XHR0aGlzLmhpc3RvcnkgPSBbXTtcblx0XHR0aGlzLmluZGV4ID0gLTE7XG5cdH07XG5cblx0SGlzdG9yeS5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy5oaXN0b3J5ID0gW107XG5cdFx0dGhpcy5pbmRleCA9IC0xO1xuXHR9O1xuXG5cdEhpc3RvcnkucHJvdG90eXBlLmFjdGlvbiA9IGZ1bmN0aW9uICh0eXBlLCBjb21wb25lbnQsIGRhdGEpIHtcblxuXHRcdHRoaXMuaGlzdG9yeSA9IHRoaXMuaGlzdG9yeS5zbGljZSgwLCB0aGlzLmluZGV4ICsgMSk7XG5cblx0XHR0aGlzLmhpc3RvcnkucHVzaCh7XG5cdFx0XHR0eXBlOiB0eXBlLFxuXHRcdFx0Y29tcG9uZW50OiBjb21wb25lbnQsXG5cdFx0XHRkYXRhOiBkYXRhXG5cdFx0fSk7XG5cblx0XHR0aGlzLmluZGV4Kys7XG5cdH07XG5cblx0SGlzdG9yeS5wcm90b3R5cGUuZ2V0SGlzdG9yeVVuZG9TaXplID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB0aGlzLmluZGV4ICsgMTtcblx0fTtcblxuXHRIaXN0b3J5LnByb3RvdHlwZS5nZXRIaXN0b3J5UmVkb1NpemUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIHRoaXMuaGlzdG9yeS5sZW5ndGggLSAodGhpcy5pbmRleCArIDEpO1xuXHR9O1xuXG5cdEhpc3RvcnkucHJvdG90eXBlLnVuZG8gPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5pbmRleCA+IC0xKSB7XG5cdFx0XHR2YXIgYWN0aW9uID0gdGhpcy5oaXN0b3J5W3RoaXMuaW5kZXhdO1xuXG5cdFx0XHR0aGlzLnVuZG9lcnNbYWN0aW9uLnR5cGVdLmNhbGwodGhpcywgYWN0aW9uKTtcblxuXHRcdFx0dGhpcy5pbmRleC0tO1xuXG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuaGlzdG9yeVVuZG8uY2FsbCh0aGlzLnRhYmxlLCBhY3Rpb24udHlwZSwgYWN0aW9uLmNvbXBvbmVudC5nZXRDb21wb25lbnQoKSwgYWN0aW9uLmRhdGEpO1xuXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiSGlzdG9yeSBVbmRvIEVycm9yIC0gTm8gbW9yZSBoaXN0b3J5IHRvIHVuZG9cIik7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdEhpc3RvcnkucHJvdG90eXBlLnJlZG8gPSBmdW5jdGlvbiAoKSB7XG5cdFx0aWYgKHRoaXMuaGlzdG9yeS5sZW5ndGggLSAxID4gdGhpcy5pbmRleCkge1xuXG5cdFx0XHR0aGlzLmluZGV4Kys7XG5cblx0XHRcdHZhciBhY3Rpb24gPSB0aGlzLmhpc3RvcnlbdGhpcy5pbmRleF07XG5cblx0XHRcdHRoaXMucmVkb2Vyc1thY3Rpb24udHlwZV0uY2FsbCh0aGlzLCBhY3Rpb24pO1xuXG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuaGlzdG9yeVJlZG8uY2FsbCh0aGlzLnRhYmxlLCBhY3Rpb24udHlwZSwgYWN0aW9uLmNvbXBvbmVudC5nZXRDb21wb25lbnQoKSwgYWN0aW9uLmRhdGEpO1xuXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiSGlzdG9yeSBSZWRvIEVycm9yIC0gTm8gbW9yZSBoaXN0b3J5IHRvIHJlZG9cIik7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdEhpc3RvcnkucHJvdG90eXBlLnVuZG9lcnMgPSB7XG5cdFx0Y2VsbEVkaXQ6IGZ1bmN0aW9uIGNlbGxFZGl0KGFjdGlvbikge1xuXHRcdFx0YWN0aW9uLmNvbXBvbmVudC5zZXRWYWx1ZVByb2Nlc3NEYXRhKGFjdGlvbi5kYXRhLm9sZFZhbHVlKTtcblx0XHR9LFxuXG5cdFx0cm93QWRkOiBmdW5jdGlvbiByb3dBZGQoYWN0aW9uKSB7XG5cdFx0XHRhY3Rpb24uY29tcG9uZW50LmRlbGV0ZUFjdHVhbCgpO1xuXHRcdH0sXG5cblx0XHRyb3dEZWxldGU6IGZ1bmN0aW9uIHJvd0RlbGV0ZShhY3Rpb24pIHtcblx0XHRcdHZhciBuZXdSb3cgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWRkUm93QWN0dWFsKGFjdGlvbi5kYXRhLmRhdGEsIGFjdGlvbi5kYXRhLnBvcywgYWN0aW9uLmRhdGEuaW5kZXgpO1xuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmdyb3VwQnkgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJncm91cFJvd3NcIikpIHtcblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmdyb3VwUm93cy51cGRhdGVHcm91cFJvd3ModHJ1ZSk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuX3JlYmluZFJvdyhhY3Rpb24uY29tcG9uZW50LCBuZXdSb3cpO1xuXHRcdH0sXG5cblx0XHRyb3dNb3ZlOiBmdW5jdGlvbiByb3dNb3ZlKGFjdGlvbikge1xuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLm1vdmVSb3dBY3R1YWwoYWN0aW9uLmNvbXBvbmVudCwgdGhpcy50YWJsZS5yb3dNYW5hZ2VyLnJvd3NbYWN0aW9uLmRhdGEucG9zRnJvbV0sICFhY3Rpb24uZGF0YS5hZnRlcik7XG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucmVkcmF3KCk7XG5cdFx0fVxuXHR9O1xuXG5cdEhpc3RvcnkucHJvdG90eXBlLnJlZG9lcnMgPSB7XG5cdFx0Y2VsbEVkaXQ6IGZ1bmN0aW9uIGNlbGxFZGl0KGFjdGlvbikge1xuXHRcdFx0YWN0aW9uLmNvbXBvbmVudC5zZXRWYWx1ZVByb2Nlc3NEYXRhKGFjdGlvbi5kYXRhLm5ld1ZhbHVlKTtcblx0XHR9LFxuXG5cdFx0cm93QWRkOiBmdW5jdGlvbiByb3dBZGQoYWN0aW9uKSB7XG5cdFx0XHR2YXIgbmV3Um93ID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmFkZFJvd0FjdHVhbChhY3Rpb24uZGF0YS5kYXRhLCBhY3Rpb24uZGF0YS5wb3MsIGFjdGlvbi5kYXRhLmluZGV4KTtcblxuXHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiZ3JvdXBSb3dzXCIpKSB7XG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5ncm91cFJvd3MudXBkYXRlR3JvdXBSb3dzKHRydWUpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLl9yZWJpbmRSb3coYWN0aW9uLmNvbXBvbmVudCwgbmV3Um93KTtcblx0XHR9LFxuXG5cdFx0cm93RGVsZXRlOiBmdW5jdGlvbiByb3dEZWxldGUoYWN0aW9uKSB7XG5cdFx0XHRhY3Rpb24uY29tcG9uZW50LmRlbGV0ZUFjdHVhbCgpO1xuXHRcdH0sXG5cblx0XHRyb3dNb3ZlOiBmdW5jdGlvbiByb3dNb3ZlKGFjdGlvbikge1xuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLm1vdmVSb3dBY3R1YWwoYWN0aW9uLmNvbXBvbmVudCwgdGhpcy50YWJsZS5yb3dNYW5hZ2VyLnJvd3NbYWN0aW9uLmRhdGEucG9zVG9dLCBhY3Rpb24uZGF0YS5hZnRlcik7XG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucmVkcmF3KCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vcmViaW5kIHJvd3MgdG8gbmV3IGVsZW1lbnQgYWZ0ZXIgZGVsZXRpb25cblx0SGlzdG9yeS5wcm90b3R5cGUuX3JlYmluZFJvdyA9IGZ1bmN0aW9uIChvbGRSb3csIG5ld1Jvdykge1xuXHRcdHRoaXMuaGlzdG9yeS5mb3JFYWNoKGZ1bmN0aW9uIChhY3Rpb24pIHtcblx0XHRcdGlmIChhY3Rpb24uY29tcG9uZW50IGluc3RhbmNlb2YgUm93KSB7XG5cdFx0XHRcdGlmIChhY3Rpb24uY29tcG9uZW50ID09PSBvbGRSb3cpIHtcblx0XHRcdFx0XHRhY3Rpb24uY29tcG9uZW50ID0gbmV3Um93O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKGFjdGlvbi5jb21wb25lbnQgaW5zdGFuY2VvZiBDZWxsKSB7XG5cdFx0XHRcdGlmIChhY3Rpb24uY29tcG9uZW50LnJvdyA9PT0gb2xkUm93KSB7XG5cdFx0XHRcdFx0dmFyIGZpZWxkID0gYWN0aW9uLmNvbXBvbmVudC5jb2x1bW4uZ2V0RmllbGQoKTtcblxuXHRcdFx0XHRcdGlmIChmaWVsZCkge1xuXHRcdFx0XHRcdFx0YWN0aW9uLmNvbXBvbmVudCA9IG5ld1Jvdy5nZXRDZWxsKGZpZWxkKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnJlZ2lzdGVyTW9kdWxlKFwiaGlzdG9yeVwiLCBIaXN0b3J5KTtcblx0dmFyIEh0bWxUYWJsZUltcG9ydCA9IGZ1bmN0aW9uIEh0bWxUYWJsZUltcG9ydCh0YWJsZSkge1xuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIFRhYnVsYXRvciBvYmplY3Rcblx0XHR0aGlzLmZpZWxkSW5kZXggPSBbXTtcblx0XHR0aGlzLmhhc0luZGV4ID0gZmFsc2U7XG5cdH07XG5cblx0SHRtbFRhYmxlSW1wb3J0LnByb3RvdHlwZS5wYXJzZVRhYmxlID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgZWxlbWVudCA9IHNlbGYudGFibGUuZWxlbWVudCxcblx0XHQgICAgb3B0aW9ucyA9IHNlbGYudGFibGUub3B0aW9ucyxcblx0XHQgICAgY29sdW1ucyA9IG9wdGlvbnMuY29sdW1ucyxcblx0XHQgICAgaGVhZGVycyA9IGVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ0aFwiKSxcblx0XHQgICAgcm93cyA9IGVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ0Ym9keVwiKVswXSxcblx0XHQgICAgZGF0YSA9IFtdLFxuXHRcdCAgICBuZXdUYWJsZTtcblxuXHRcdHNlbGYuaGFzSW5kZXggPSBmYWxzZTtcblxuXHRcdHNlbGYudGFibGUub3B0aW9ucy5odG1sSW1wb3J0aW5nLmNhbGwodGhpcy50YWJsZSk7XG5cblx0XHRyb3dzID0gcm93cyA/IHJvd3MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ0clwiKSA6IFtdO1xuXG5cdFx0Ly9jaGVjayBmb3IgdGFibGF0b3IgaW5saW5lIG9wdGlvbnNcblx0XHRzZWxmLl9leHRyYWN0T3B0aW9ucyhlbGVtZW50LCBvcHRpb25zKTtcblxuXHRcdGlmIChoZWFkZXJzLmxlbmd0aCkge1xuXHRcdFx0c2VsZi5fZXh0cmFjdEhlYWRlcnMoaGVhZGVycywgcm93cyk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHNlbGYuX2dlbmVyYXRlQmxhbmtIZWFkZXJzKGhlYWRlcnMsIHJvd3MpO1xuXHRcdH1cblxuXHRcdC8vaXRlcmF0ZSB0aHJvdWdoIHRhYmxlIHJvd3MgYW5kIGJ1aWxkIGRhdGEgc2V0XG5cdFx0Zm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHJvd3MubGVuZ3RoOyBpbmRleCsrKSB7XG5cdFx0XHR2YXIgcm93ID0gcm93c1tpbmRleF0sXG5cdFx0XHQgICAgY2VsbHMgPSByb3cuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ0ZFwiKSxcblx0XHRcdCAgICBpdGVtID0ge307XG5cblx0XHRcdC8vY3JlYXRlIGluZGV4IGlmIHRoZSBkb250IGV4aXN0IGluIHRhYmxlXG5cdFx0XHRpZiAoIXNlbGYuaGFzSW5kZXgpIHtcblx0XHRcdFx0aXRlbVtvcHRpb25zLmluZGV4XSA9IGluZGV4O1xuXHRcdFx0fVxuXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGNlbGxzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdHZhciBjZWxsID0gY2VsbHNbaV07XG5cdFx0XHRcdGlmICh0eXBlb2YgdGhpcy5maWVsZEluZGV4W2ldICE9PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdFx0aXRlbVt0aGlzLmZpZWxkSW5kZXhbaV1dID0gY2VsbC5pbm5lckhUTUw7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly9hZGQgcm93IGRhdGEgdG8gaXRlbVxuXHRcdFx0ZGF0YS5wdXNoKGl0ZW0pO1xuXHRcdH1cblxuXHRcdC8vY3JlYXRlIG5ldyBlbGVtZW50XG5cdFx0dmFyIG5ld0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG5cdFx0Ly90cmFuc2ZlciBhdHRyaWJ1dGVzIHRvIG5ldyBlbGVtZW50XG5cdFx0dmFyIGF0dHJpYnV0ZXMgPSBlbGVtZW50LmF0dHJpYnV0ZXM7XG5cblx0XHQvLyBsb29wIHRocm91Z2ggYXR0cmlidXRlcyBhbmQgYXBwbHkgdGhlbSBvbiBkaXZcblxuXHRcdGZvciAodmFyIGkgaW4gYXR0cmlidXRlcykge1xuXHRcdFx0aWYgKF90eXBlb2YoYXR0cmlidXRlc1tpXSkgPT0gXCJvYmplY3RcIikge1xuXHRcdFx0XHRuZXdFbGVtZW50LnNldEF0dHJpYnV0ZShhdHRyaWJ1dGVzW2ldLm5hbWUsIGF0dHJpYnV0ZXNbaV0udmFsdWUpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIHJlcGxhY2UgdGFibGUgd2l0aCBkaXYgZWxlbWVudFxuXHRcdGVsZW1lbnQucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQobmV3RWxlbWVudCwgZWxlbWVudCk7XG5cblx0XHRvcHRpb25zLmRhdGEgPSBkYXRhO1xuXG5cdFx0c2VsZi50YWJsZS5vcHRpb25zLmh0bWxJbXBvcnRlZC5jYWxsKHRoaXMudGFibGUpO1xuXG5cdFx0Ly8gLy8gbmV3RWxlbWVudC50YWJ1bGF0b3Iob3B0aW9ucyk7XG5cblx0XHR0aGlzLnRhYmxlLmVsZW1lbnQgPSBuZXdFbGVtZW50O1xuXHR9O1xuXG5cdC8vZXh0cmFjdCB0YWJ1bGF0b3IgYXR0cmlidXRlIG9wdGlvbnNcblx0SHRtbFRhYmxlSW1wb3J0LnByb3RvdHlwZS5fZXh0cmFjdE9wdGlvbnMgPSBmdW5jdGlvbiAoZWxlbWVudCwgb3B0aW9ucywgZGVmYXVsdE9wdGlvbnMpIHtcblx0XHR2YXIgYXR0cmlidXRlcyA9IGVsZW1lbnQuYXR0cmlidXRlcztcblx0XHR2YXIgb3B0aW9uc0FyciA9IGRlZmF1bHRPcHRpb25zID8gT2JqZWN0LmFzc2lnbihbXSwgZGVmYXVsdE9wdGlvbnMpIDogT2JqZWN0LmtleXMob3B0aW9ucyk7XG5cdFx0dmFyIG9wdGlvbnNMaXN0ID0ge307XG5cblx0XHRvcHRpb25zQXJyLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdG9wdGlvbnNMaXN0W2l0ZW0udG9Mb3dlckNhc2UoKV0gPSBpdGVtO1xuXHRcdH0pO1xuXG5cdFx0Zm9yICh2YXIgaW5kZXggaW4gYXR0cmlidXRlcykge1xuXHRcdFx0dmFyIGF0dHJpYiA9IGF0dHJpYnV0ZXNbaW5kZXhdO1xuXHRcdFx0dmFyIG5hbWU7XG5cblx0XHRcdGlmIChhdHRyaWIgJiYgKHR5cGVvZiBhdHRyaWIgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGF0dHJpYikpID09IFwib2JqZWN0XCIgJiYgYXR0cmliLm5hbWUgJiYgYXR0cmliLm5hbWUuaW5kZXhPZihcInRhYnVsYXRvci1cIikgPT09IDApIHtcblx0XHRcdFx0bmFtZSA9IGF0dHJpYi5uYW1lLnJlcGxhY2UoXCJ0YWJ1bGF0b3ItXCIsIFwiXCIpO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Ygb3B0aW9uc0xpc3RbbmFtZV0gIT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0XHRvcHRpb25zW29wdGlvbnNMaXN0W25hbWVdXSA9IHRoaXMuX2F0dHJpYlZhbHVlKGF0dHJpYi52YWx1ZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Ly9nZXQgdmFsdWUgb2YgYXR0cmlidXRlXG5cdEh0bWxUYWJsZUltcG9ydC5wcm90b3R5cGUuX2F0dHJpYlZhbHVlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0aWYgKHZhbHVlID09PSBcInRydWVcIikge1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXG5cdFx0aWYgKHZhbHVlID09PSBcImZhbHNlXCIpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdmFsdWU7XG5cdH07XG5cblx0Ly9maW5kIGNvbHVtbiBpZiBpdCBoYXMgYWxyZWFkeSBiZWVuIGRlZmluZWRcblx0SHRtbFRhYmxlSW1wb3J0LnByb3RvdHlwZS5fZmluZENvbCA9IGZ1bmN0aW9uICh0aXRsZSkge1xuXHRcdHZhciBtYXRjaCA9IHRoaXMudGFibGUub3B0aW9ucy5jb2x1bW5zLmZpbmQoZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdFx0cmV0dXJuIGNvbHVtbi50aXRsZSA9PT0gdGl0bGU7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gbWF0Y2ggfHwgZmFsc2U7XG5cdH07XG5cblx0Ly9leHRyYWN0IGNvbHVtbiBmcm9tIGhlYWRlcnNcblx0SHRtbFRhYmxlSW1wb3J0LnByb3RvdHlwZS5fZXh0cmFjdEhlYWRlcnMgPSBmdW5jdGlvbiAoaGVhZGVycywgcm93cykge1xuXHRcdGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBoZWFkZXJzLmxlbmd0aDsgaW5kZXgrKykge1xuXHRcdFx0dmFyIGhlYWRlciA9IGhlYWRlcnNbaW5kZXhdLFxuXHRcdFx0ICAgIGV4aXN0cyA9IGZhbHNlLFxuXHRcdFx0ICAgIGNvbCA9IHRoaXMuX2ZpbmRDb2woaGVhZGVyLnRleHRDb250ZW50KSxcblx0XHRcdCAgICB3aWR0aCxcblx0XHRcdCAgICBhdHRyaWJ1dGVzO1xuXG5cdFx0XHRpZiAoY29sKSB7XG5cdFx0XHRcdGV4aXN0cyA9IHRydWU7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb2wgPSB7IHRpdGxlOiBoZWFkZXIudGV4dENvbnRlbnQudHJpbSgpIH07XG5cdFx0XHR9XG5cblx0XHRcdGlmICghY29sLmZpZWxkKSB7XG5cdFx0XHRcdGNvbC5maWVsZCA9IGhlYWRlci50ZXh0Q29udGVudC50cmltKCkudG9Mb3dlckNhc2UoKS5yZXBsYWNlKFwiIFwiLCBcIl9cIik7XG5cdFx0XHR9XG5cblx0XHRcdHdpZHRoID0gaGVhZGVyLmdldEF0dHJpYnV0ZShcIndpZHRoXCIpO1xuXG5cdFx0XHRpZiAod2lkdGggJiYgIWNvbC53aWR0aCkge1xuXHRcdFx0XHRjb2wud2lkdGggPSB3aWR0aDtcblx0XHRcdH1cblxuXHRcdFx0Ly9jaGVjayBmb3IgdGFibGF0b3IgaW5saW5lIG9wdGlvbnNcblx0XHRcdGF0dHJpYnV0ZXMgPSBoZWFkZXIuYXR0cmlidXRlcztcblxuXHRcdFx0Ly8gLy9jaGVjayBmb3IgdGFibGF0b3IgaW5saW5lIG9wdGlvbnNcblx0XHRcdHRoaXMuX2V4dHJhY3RPcHRpb25zKGhlYWRlciwgY29sLCBDb2x1bW4ucHJvdG90eXBlLmRlZmF1bHRPcHRpb25MaXN0KTtcblxuXHRcdFx0dGhpcy5maWVsZEluZGV4W2luZGV4XSA9IGNvbC5maWVsZDtcblxuXHRcdFx0aWYgKGNvbC5maWVsZCA9PSB0aGlzLnRhYmxlLm9wdGlvbnMuaW5kZXgpIHtcblx0XHRcdFx0dGhpcy5oYXNJbmRleCA9IHRydWU7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghZXhpc3RzKSB7XG5cdFx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5jb2x1bW5zLnB1c2goY29sKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Ly9nZW5lcmF0ZSBibGFuayBoZWFkZXJzXG5cdEh0bWxUYWJsZUltcG9ydC5wcm90b3R5cGUuX2dlbmVyYXRlQmxhbmtIZWFkZXJzID0gZnVuY3Rpb24gKGhlYWRlcnMsIHJvd3MpIHtcblx0XHRmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgaGVhZGVycy5sZW5ndGg7IGluZGV4KyspIHtcblx0XHRcdHZhciBoZWFkZXIgPSBoZWFkZXJzW2luZGV4XSxcblx0XHRcdCAgICBjb2wgPSB7IHRpdGxlOiBcIlwiLCBmaWVsZDogXCJjb2xcIiArIGluZGV4IH07XG5cblx0XHRcdHRoaXMuZmllbGRJbmRleFtpbmRleF0gPSBjb2wuZmllbGQ7XG5cblx0XHRcdHZhciB3aWR0aCA9IGhlYWRlci5nZXRBdHRyaWJ1dGUoXCJ3aWR0aFwiKTtcblxuXHRcdFx0aWYgKHdpZHRoKSB7XG5cdFx0XHRcdGNvbC53aWR0aCA9IHdpZHRoO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1ucy5wdXNoKGNvbCk7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJodG1sVGFibGVJbXBvcnRcIiwgSHRtbFRhYmxlSW1wb3J0KTtcblx0dmFyIEtleWJpbmRpbmdzID0gZnVuY3Rpb24gS2V5YmluZGluZ3ModGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdFx0dGhpcy53YXRjaEtleXMgPSBudWxsO1xuXHRcdHRoaXMucHJlc3NlZEtleXMgPSBudWxsO1xuXHRcdHRoaXMua2V5dXBCaW5kaW5nID0gZmFsc2U7XG5cdFx0dGhpcy5rZXlkb3duQmluZGluZyA9IGZhbHNlO1xuXHR9O1xuXG5cdEtleWJpbmRpbmdzLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBiaW5kaW5ncyA9IHRoaXMudGFibGUub3B0aW9ucy5rZXliaW5kaW5ncyxcblx0XHQgICAgbWVyZ2VkQmluZGluZ3MgPSB7fTtcblxuXHRcdHRoaXMud2F0Y2hLZXlzID0ge307XG5cdFx0dGhpcy5wcmVzc2VkS2V5cyA9IFtdO1xuXG5cdFx0aWYgKGJpbmRpbmdzICE9PSBmYWxzZSkge1xuXG5cdFx0XHRmb3IgKHZhciBrZXkgaW4gdGhpcy5iaW5kaW5ncykge1xuXHRcdFx0XHRtZXJnZWRCaW5kaW5nc1trZXldID0gdGhpcy5iaW5kaW5nc1trZXldO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoT2JqZWN0LmtleXMoYmluZGluZ3MpLmxlbmd0aCkge1xuXG5cdFx0XHRcdGZvciAodmFyIF9rZXkgaW4gYmluZGluZ3MpIHtcblx0XHRcdFx0XHRtZXJnZWRCaW5kaW5nc1tfa2V5XSA9IGJpbmRpbmdzW19rZXldO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMubWFwQmluZGluZ3MobWVyZ2VkQmluZGluZ3MpO1xuXHRcdFx0dGhpcy5iaW5kRXZlbnRzKCk7XG5cdFx0fVxuXHR9O1xuXG5cdEtleWJpbmRpbmdzLnByb3RvdHlwZS5tYXBCaW5kaW5ncyA9IGZ1bmN0aW9uIChiaW5kaW5ncykge1xuXHRcdHZhciBfdGhpczYwID0gdGhpcztcblxuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHZhciBfbG9vcDIgPSBmdW5jdGlvbiBfbG9vcDIoa2V5KSB7XG5cblx0XHRcdGlmIChfdGhpczYwLmFjdGlvbnNba2V5XSkge1xuXG5cdFx0XHRcdGlmIChiaW5kaW5nc1trZXldKSB7XG5cblx0XHRcdFx0XHRpZiAoX3R5cGVvZihiaW5kaW5nc1trZXldKSAhPT0gXCJvYmplY3RcIikge1xuXHRcdFx0XHRcdFx0YmluZGluZ3Nba2V5XSA9IFtiaW5kaW5nc1trZXldXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRiaW5kaW5nc1trZXldLmZvckVhY2goZnVuY3Rpb24gKGJpbmRpbmcpIHtcblx0XHRcdFx0XHRcdHNlbGYubWFwQmluZGluZyhrZXksIGJpbmRpbmcpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJLZXkgQmluZGluZyBFcnJvciAtIG5vIHN1Y2ggYWN0aW9uOlwiLCBrZXkpO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHRmb3IgKHZhciBrZXkgaW4gYmluZGluZ3MpIHtcblx0XHRcdF9sb29wMihrZXkpO1xuXHRcdH1cblx0fTtcblxuXHRLZXliaW5kaW5ncy5wcm90b3R5cGUubWFwQmluZGluZyA9IGZ1bmN0aW9uIChhY3Rpb24sIHN5bWJvbHNMaXN0KSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0dmFyIGJpbmRpbmcgPSB7XG5cdFx0XHRhY3Rpb246IHRoaXMuYWN0aW9uc1thY3Rpb25dLFxuXHRcdFx0a2V5czogW10sXG5cdFx0XHRjdHJsOiBmYWxzZSxcblx0XHRcdHNoaWZ0OiBmYWxzZSxcblx0XHRcdG1ldGE6IGZhbHNlXG5cdFx0fTtcblxuXHRcdHZhciBzeW1ib2xzID0gc3ltYm9sc0xpc3QudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpLnNwbGl0KFwiIFwiKS5qb2luKFwiXCIpLnNwbGl0KFwiK1wiKTtcblxuXHRcdHN5bWJvbHMuZm9yRWFjaChmdW5jdGlvbiAoc3ltYm9sKSB7XG5cdFx0XHRzd2l0Y2ggKHN5bWJvbCkge1xuXHRcdFx0XHRjYXNlIFwiY3RybFwiOlxuXHRcdFx0XHRcdGJpbmRpbmcuY3RybCA9IHRydWU7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSBcInNoaWZ0XCI6XG5cdFx0XHRcdFx0YmluZGluZy5zaGlmdCA9IHRydWU7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSBcIm1ldGFcIjpcblx0XHRcdFx0XHRiaW5kaW5nLm1ldGEgPSB0cnVlO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0c3ltYm9sID0gcGFyc2VJbnQoc3ltYm9sKTtcblx0XHRcdFx0XHRiaW5kaW5nLmtleXMucHVzaChzeW1ib2wpO1xuXG5cdFx0XHRcdFx0aWYgKCFzZWxmLndhdGNoS2V5c1tzeW1ib2xdKSB7XG5cdFx0XHRcdFx0XHRzZWxmLndhdGNoS2V5c1tzeW1ib2xdID0gW107XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0c2VsZi53YXRjaEtleXNbc3ltYm9sXS5wdXNoKGJpbmRpbmcpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdEtleWJpbmRpbmdzLnByb3RvdHlwZS5iaW5kRXZlbnRzID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHRoaXMua2V5dXBCaW5kaW5nID0gZnVuY3Rpb24gKGUpIHtcblx0XHRcdHZhciBjb2RlID0gZS5rZXlDb2RlO1xuXHRcdFx0dmFyIGJpbmRpbmdzID0gc2VsZi53YXRjaEtleXNbY29kZV07XG5cblx0XHRcdGlmIChiaW5kaW5ncykge1xuXG5cdFx0XHRcdHNlbGYucHJlc3NlZEtleXMucHVzaChjb2RlKTtcblxuXHRcdFx0XHRiaW5kaW5ncy5mb3JFYWNoKGZ1bmN0aW9uIChiaW5kaW5nKSB7XG5cdFx0XHRcdFx0c2VsZi5jaGVja0JpbmRpbmcoZSwgYmluZGluZyk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHR0aGlzLmtleWRvd25CaW5kaW5nID0gZnVuY3Rpb24gKGUpIHtcblx0XHRcdHZhciBjb2RlID0gZS5rZXlDb2RlO1xuXHRcdFx0dmFyIGJpbmRpbmdzID0gc2VsZi53YXRjaEtleXNbY29kZV07XG5cblx0XHRcdGlmIChiaW5kaW5ncykge1xuXG5cdFx0XHRcdHZhciBpbmRleCA9IHNlbGYucHJlc3NlZEtleXMuaW5kZXhPZihjb2RlKTtcblxuXHRcdFx0XHRpZiAoaW5kZXggPiAtMSkge1xuXHRcdFx0XHRcdHNlbGYucHJlc3NlZEtleXMuc3BsaWNlKGluZGV4LCAxKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH07XG5cblx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5rZXl1cEJpbmRpbmcpO1xuXG5cdFx0dGhpcy50YWJsZS5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCB0aGlzLmtleWRvd25CaW5kaW5nKTtcblx0fTtcblxuXHRLZXliaW5kaW5ncy5wcm90b3R5cGUuY2xlYXJCaW5kaW5ncyA9IGZ1bmN0aW9uICgpIHtcblx0XHRpZiAodGhpcy5rZXl1cEJpbmRpbmcpIHtcblx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLmtleXVwQmluZGluZyk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMua2V5ZG93bkJpbmRpbmcpIHtcblx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5rZXlkb3duQmluZGluZyk7XG5cdFx0fVxuXHR9O1xuXG5cdEtleWJpbmRpbmdzLnByb3RvdHlwZS5jaGVja0JpbmRpbmcgPSBmdW5jdGlvbiAoZSwgYmluZGluZykge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgbWF0Y2ggPSB0cnVlO1xuXG5cdFx0aWYgKGUuY3RybEtleSA9PSBiaW5kaW5nLmN0cmwgJiYgZS5zaGlmdEtleSA9PSBiaW5kaW5nLnNoaWZ0ICYmIGUubWV0YUtleSA9PSBiaW5kaW5nLm1ldGEpIHtcblx0XHRcdGJpbmRpbmcua2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcblx0XHRcdFx0dmFyIGluZGV4ID0gc2VsZi5wcmVzc2VkS2V5cy5pbmRleE9mKGtleSk7XG5cblx0XHRcdFx0aWYgKGluZGV4ID09IC0xKSB7XG5cdFx0XHRcdFx0bWF0Y2ggPSBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChtYXRjaCkge1xuXHRcdFx0XHRiaW5kaW5nLmFjdGlvbi5jYWxsKHNlbGYsIGUpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH07XG5cblx0Ly9kZWZhdWx0IGJpbmRpbmdzXG5cdEtleWJpbmRpbmdzLnByb3RvdHlwZS5iaW5kaW5ncyA9IHtcblx0XHRuYXZQcmV2OiBcInNoaWZ0ICsgOVwiLFxuXHRcdG5hdk5leHQ6IDksXG5cdFx0bmF2VXA6IDM4LFxuXHRcdG5hdkRvd246IDQwLFxuXHRcdHNjcm9sbFBhZ2VVcDogMzMsXG5cdFx0c2Nyb2xsUGFnZURvd246IDM0LFxuXHRcdHNjcm9sbFRvU3RhcnQ6IDM2LFxuXHRcdHNjcm9sbFRvRW5kOiAzNSxcblx0XHR1bmRvOiBcImN0cmwgKyA5MFwiLFxuXHRcdHJlZG86IFwiY3RybCArIDg5XCIsXG5cdFx0Y29weVRvQ2xpcGJvYXJkOiBcImN0cmwgKyA2N1wiXG5cdH07XG5cblx0Ly9kZWZhdWx0IGFjdGlvbnNcblx0S2V5YmluZGluZ3MucHJvdG90eXBlLmFjdGlvbnMgPSB7XG5cdFx0a2V5QmxvY2s6IGZ1bmN0aW9uIGtleUJsb2NrKGUpIHtcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0fSxcblx0XHRzY3JvbGxQYWdlVXA6IGZ1bmN0aW9uIHNjcm9sbFBhZ2VVcChlKSB7XG5cdFx0XHR2YXIgcm93TWFuYWdlciA9IHRoaXMudGFibGUucm93TWFuYWdlcixcblx0XHRcdCAgICBuZXdQb3MgPSByb3dNYW5hZ2VyLnNjcm9sbFRvcCAtIHJvd01hbmFnZXIuaGVpZ2h0LFxuXHRcdFx0ICAgIHNjcm9sbE1heCA9IHJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxIZWlnaHQ7XG5cblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0aWYgKHJvd01hbmFnZXIuZGlzcGxheVJvd3NDb3VudCkge1xuXHRcdFx0XHRpZiAobmV3UG9zID49IDApIHtcblx0XHRcdFx0XHRyb3dNYW5hZ2VyLmVsZW1lbnQuc2Nyb2xsVG9wID0gbmV3UG9zO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHJvd01hbmFnZXIuc2Nyb2xsVG9Sb3cocm93TWFuYWdlci5nZXREaXNwbGF5Um93cygpWzBdKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuZm9jdXMoKTtcblx0XHR9LFxuXHRcdHNjcm9sbFBhZ2VEb3duOiBmdW5jdGlvbiBzY3JvbGxQYWdlRG93bihlKSB7XG5cdFx0XHR2YXIgcm93TWFuYWdlciA9IHRoaXMudGFibGUucm93TWFuYWdlcixcblx0XHRcdCAgICBuZXdQb3MgPSByb3dNYW5hZ2VyLnNjcm9sbFRvcCArIHJvd01hbmFnZXIuaGVpZ2h0LFxuXHRcdFx0ICAgIHNjcm9sbE1heCA9IHJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxIZWlnaHQ7XG5cblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0aWYgKHJvd01hbmFnZXIuZGlzcGxheVJvd3NDb3VudCkge1xuXHRcdFx0XHRpZiAobmV3UG9zIDw9IHNjcm9sbE1heCkge1xuXHRcdFx0XHRcdHJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxUb3AgPSBuZXdQb3M7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cm93TWFuYWdlci5zY3JvbGxUb1Jvdyhyb3dNYW5hZ2VyLmdldERpc3BsYXlSb3dzKClbcm93TWFuYWdlci5kaXNwbGF5Um93c0NvdW50IC0gMV0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5mb2N1cygpO1xuXHRcdH0sXG5cdFx0c2Nyb2xsVG9TdGFydDogZnVuY3Rpb24gc2Nyb2xsVG9TdGFydChlKSB7XG5cdFx0XHR2YXIgcm93TWFuYWdlciA9IHRoaXMudGFibGUucm93TWFuYWdlcjtcblxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRpZiAocm93TWFuYWdlci5kaXNwbGF5Um93c0NvdW50KSB7XG5cdFx0XHRcdHJvd01hbmFnZXIuc2Nyb2xsVG9Sb3cocm93TWFuYWdlci5nZXREaXNwbGF5Um93cygpWzBdKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy50YWJsZS5lbGVtZW50LmZvY3VzKCk7XG5cdFx0fSxcblx0XHRzY3JvbGxUb0VuZDogZnVuY3Rpb24gc2Nyb2xsVG9FbmQoZSkge1xuXHRcdFx0dmFyIHJvd01hbmFnZXIgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXI7XG5cblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0aWYgKHJvd01hbmFnZXIuZGlzcGxheVJvd3NDb3VudCkge1xuXHRcdFx0XHRyb3dNYW5hZ2VyLnNjcm9sbFRvUm93KHJvd01hbmFnZXIuZ2V0RGlzcGxheVJvd3MoKVtyb3dNYW5hZ2VyLmRpc3BsYXlSb3dzQ291bnQgLSAxXSk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5mb2N1cygpO1xuXHRcdH0sXG5cdFx0bmF2UHJldjogZnVuY3Rpb24gbmF2UHJldihlKSB7XG5cdFx0XHR2YXIgY2VsbCA9IGZhbHNlO1xuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJlZGl0XCIpKSB7XG5cdFx0XHRcdGNlbGwgPSB0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbDtcblxuXHRcdFx0XHRpZiAoY2VsbCkge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRjZWxsLm5hdigpLnByZXYoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRuYXZOZXh0OiBmdW5jdGlvbiBuYXZOZXh0KGUpIHtcblx0XHRcdHZhciBjZWxsID0gZmFsc2U7XG5cdFx0XHR2YXIgbmV3Um93ID0gdGhpcy50YWJsZS5vcHRpb25zLnRhYkVuZE5ld1Jvdztcblx0XHRcdHZhciBuYXY7XG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImVkaXRcIikpIHtcblx0XHRcdFx0Y2VsbCA9IHRoaXMudGFibGUubW9kdWxlcy5lZGl0LmN1cnJlbnRDZWxsO1xuXG5cdFx0XHRcdGlmIChjZWxsKSB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdFx0bmF2ID0gY2VsbC5uYXYoKTtcblxuXHRcdFx0XHRcdGlmICghbmF2Lm5leHQoKSkge1xuXHRcdFx0XHRcdFx0aWYgKG5ld1Jvdykge1xuXG5cdFx0XHRcdFx0XHRcdGNlbGwuZ2V0RWxlbWVudCgpLmZpcnN0Q2hpbGQuYmx1cigpO1xuXG5cdFx0XHRcdFx0XHRcdGlmIChuZXdSb3cgPT09IHRydWUpIHtcblx0XHRcdFx0XHRcdFx0XHRuZXdSb3cgPSB0aGlzLnRhYmxlLmFkZFJvdyh7fSk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBuZXdSb3cgPT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRuZXdSb3cgPSB0aGlzLnRhYmxlLmFkZFJvdyhuZXdSb3coY2VsbC5yb3cuZ2V0Q29tcG9uZW50KCkpKTtcblx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0bmV3Um93ID0gdGhpcy50YWJsZS5hZGRSb3coT2JqZWN0LmFzc2lnbih7fSwgbmV3Um93KSk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0bmV3Um93LnRoZW4oZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0bmF2Lm5leHQoKTtcblx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdG5hdkxlZnQ6IGZ1bmN0aW9uIG5hdkxlZnQoZSkge1xuXHRcdFx0dmFyIGNlbGwgPSBmYWxzZTtcblxuXHRcdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwiZWRpdFwiKSkge1xuXHRcdFx0XHRjZWxsID0gdGhpcy50YWJsZS5tb2R1bGVzLmVkaXQuY3VycmVudENlbGw7XG5cblx0XHRcdFx0aWYgKGNlbGwpIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0Y2VsbC5uYXYoKS5sZWZ0KCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0bmF2UmlnaHQ6IGZ1bmN0aW9uIG5hdlJpZ2h0KGUpIHtcblx0XHRcdHZhciBjZWxsID0gZmFsc2U7XG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImVkaXRcIikpIHtcblx0XHRcdFx0Y2VsbCA9IHRoaXMudGFibGUubW9kdWxlcy5lZGl0LmN1cnJlbnRDZWxsO1xuXG5cdFx0XHRcdGlmIChjZWxsKSB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdGNlbGwubmF2KCkucmlnaHQoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRuYXZVcDogZnVuY3Rpb24gbmF2VXAoZSkge1xuXHRcdFx0dmFyIGNlbGwgPSBmYWxzZTtcblxuXHRcdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwiZWRpdFwiKSkge1xuXHRcdFx0XHRjZWxsID0gdGhpcy50YWJsZS5tb2R1bGVzLmVkaXQuY3VycmVudENlbGw7XG5cblx0XHRcdFx0aWYgKGNlbGwpIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0Y2VsbC5uYXYoKS51cCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdG5hdkRvd246IGZ1bmN0aW9uIG5hdkRvd24oZSkge1xuXHRcdFx0dmFyIGNlbGwgPSBmYWxzZTtcblxuXHRcdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwiZWRpdFwiKSkge1xuXHRcdFx0XHRjZWxsID0gdGhpcy50YWJsZS5tb2R1bGVzLmVkaXQuY3VycmVudENlbGw7XG5cblx0XHRcdFx0aWYgKGNlbGwpIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0Y2VsbC5uYXYoKS5kb3duKCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0dW5kbzogZnVuY3Rpb24gdW5kbyhlKSB7XG5cdFx0XHR2YXIgY2VsbCA9IGZhbHNlO1xuXHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5oaXN0b3J5ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiaGlzdG9yeVwiKSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImVkaXRcIikpIHtcblxuXHRcdFx0XHRjZWxsID0gdGhpcy50YWJsZS5tb2R1bGVzLmVkaXQuY3VycmVudENlbGw7XG5cblx0XHRcdFx0aWYgKCFjZWxsKSB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5oaXN0b3J5LnVuZG8oKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRyZWRvOiBmdW5jdGlvbiByZWRvKGUpIHtcblx0XHRcdHZhciBjZWxsID0gZmFsc2U7XG5cdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmhpc3RvcnkgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJoaXN0b3J5XCIpICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiZWRpdFwiKSkge1xuXG5cdFx0XHRcdGNlbGwgPSB0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbDtcblxuXHRcdFx0XHRpZiAoIWNlbGwpIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmhpc3RvcnkucmVkbygpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdGNvcHlUb0NsaXBib2FyZDogZnVuY3Rpb24gY29weVRvQ2xpcGJvYXJkKGUpIHtcblx0XHRcdGlmICghdGhpcy50YWJsZS5tb2R1bGVzLmVkaXQuY3VycmVudENlbGwpIHtcblx0XHRcdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwiY2xpcGJvYXJkXCIsIHRydWUpKSB7XG5cdFx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmNsaXBib2FyZC5jb3B5KGZhbHNlLCB0cnVlKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnJlZ2lzdGVyTW9kdWxlKFwia2V5YmluZGluZ3NcIiwgS2V5YmluZGluZ3MpO1xuXHR2YXIgTWVudSA9IGZ1bmN0aW9uIE1lbnUodGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdFx0dGhpcy5tZW51RWwgPSBmYWxzZTtcblx0XHR0aGlzLmJsdXJFdmVudCA9IHRoaXMuaGlkZU1lbnUuYmluZCh0aGlzKTtcblx0XHR0aGlzLmVzY0V2ZW50ID0gdGhpcy5lc2NNZW51LmJpbmQodGhpcyk7XG5cdFx0dGhpcy5uZXN0ZWRNZW51QmxvY2sgPSBmYWxzZTtcblx0fTtcblxuXHRNZW51LnByb3RvdHlwZS5pbml0aWFsaXplQ29sdW1uSGVhZGVyID0gZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdHZhciBfdGhpczYxID0gdGhpcztcblxuXHRcdHZhciBoZWFkZXJNZW51RWw7XG5cblx0XHRpZiAoY29sdW1uLmRlZmluaXRpb24uaGVhZGVyQ29udGV4dE1lbnUpIHtcblx0XHRcdGNvbHVtbi5nZXRFbGVtZW50KCkuYWRkRXZlbnRMaXN0ZW5lcihcImNvbnRleHRtZW51XCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdHZhciBtZW51ID0gdHlwZW9mIGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckNvbnRleHRNZW51ID09IFwiZnVuY3Rpb25cIiA/IGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckNvbnRleHRNZW51KGNvbHVtbi5nZXRDb21wb25lbnQoKSkgOiBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJDb250ZXh0TWVudTtcblxuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdFx0X3RoaXM2MS5sb2FkTWVudShlLCBjb2x1bW4sIG1lbnUpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlck1lbnUpIHtcblxuXHRcdFx0aGVhZGVyTWVudUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG5cdFx0XHRoZWFkZXJNZW51RWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1oZWFkZXItbWVudS1idXR0b25cIik7XG5cdFx0XHRoZWFkZXJNZW51RWwuaW5uZXJIVE1MID0gXCImdmVsbGlwO1wiO1xuXG5cdFx0XHRoZWFkZXJNZW51RWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdHZhciBtZW51ID0gdHlwZW9mIGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlck1lbnUgPT0gXCJmdW5jdGlvblwiID8gY29sdW1uLmRlZmluaXRpb24uaGVhZGVyTWVudShjb2x1bW4uZ2V0Q29tcG9uZW50KCkpIDogY29sdW1uLmRlZmluaXRpb24uaGVhZGVyTWVudTtcblx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdF90aGlzNjEubG9hZE1lbnUoZSwgY29sdW1uLCBtZW51KTtcblx0XHRcdH0pO1xuXG5cdFx0XHRjb2x1bW4udGl0bGVFbGVtZW50Lmluc2VydEJlZm9yZShoZWFkZXJNZW51RWwsIGNvbHVtbi50aXRsZUVsZW1lbnQuZmlyc3RDaGlsZCk7XG5cdFx0fVxuXHR9O1xuXG5cdE1lbnUucHJvdG90eXBlLmluaXRpYWxpemVDZWxsID0gZnVuY3Rpb24gKGNlbGwpIHtcblx0XHR2YXIgX3RoaXM2MiA9IHRoaXM7XG5cblx0XHRjZWxsLmdldEVsZW1lbnQoKS5hZGRFdmVudExpc3RlbmVyKFwiY29udGV4dG1lbnVcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdHZhciBtZW51ID0gdHlwZW9mIGNlbGwuY29sdW1uLmRlZmluaXRpb24uY29udGV4dE1lbnUgPT0gXCJmdW5jdGlvblwiID8gY2VsbC5jb2x1bW4uZGVmaW5pdGlvbi5jb250ZXh0TWVudShjZWxsLmdldENvbXBvbmVudCgpKSA6IGNlbGwuY29sdW1uLmRlZmluaXRpb24uY29udGV4dE1lbnU7XG5cblx0XHRcdGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cblx0XHRcdF90aGlzNjIubG9hZE1lbnUoZSwgY2VsbCwgbWVudSk7XG5cdFx0fSk7XG5cdH07XG5cblx0TWVudS5wcm90b3R5cGUuaW5pdGlhbGl6ZVJvdyA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR2YXIgX3RoaXM2MyA9IHRoaXM7XG5cblx0XHRyb3cuZ2V0RWxlbWVudCgpLmFkZEV2ZW50TGlzdGVuZXIoXCJjb250ZXh0bWVudVwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0dmFyIG1lbnUgPSB0eXBlb2YgX3RoaXM2My50YWJsZS5vcHRpb25zLnJvd0NvbnRleHRNZW51ID09IFwiZnVuY3Rpb25cIiA/IF90aGlzNjMudGFibGUub3B0aW9ucy5yb3dDb250ZXh0TWVudShyb3cuZ2V0Q29tcG9uZW50KCkpIDogX3RoaXM2My50YWJsZS5vcHRpb25zLnJvd0NvbnRleHRNZW51O1xuXG5cdFx0XHRfdGhpczYzLmxvYWRNZW51KGUsIHJvdywgbWVudSk7XG5cdFx0fSk7XG5cdH07XG5cblx0TWVudS5wcm90b3R5cGUuaW5pdGlhbGl6ZUdyb3VwID0gZnVuY3Rpb24gKGdyb3VwKSB7XG5cdFx0dmFyIF90aGlzNjQgPSB0aGlzO1xuXG5cdFx0Z3JvdXAuZ2V0RWxlbWVudCgpLmFkZEV2ZW50TGlzdGVuZXIoXCJjb250ZXh0bWVudVwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0dmFyIG1lbnUgPSB0eXBlb2YgX3RoaXM2NC50YWJsZS5vcHRpb25zLmdyb3VwQ29udGV4dE1lbnUgPT0gXCJmdW5jdGlvblwiID8gX3RoaXM2NC50YWJsZS5vcHRpb25zLmdyb3VwQ29udGV4dE1lbnUoZ3JvdXAuZ2V0Q29tcG9uZW50KCkpIDogX3RoaXM2NC50YWJsZS5vcHRpb25zLmdyb3VwQ29udGV4dE1lbnU7XG5cblx0XHRcdF90aGlzNjQubG9hZE1lbnUoZSwgZ3JvdXAsIG1lbnUpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdE1lbnUucHJvdG90eXBlLmxvYWRNZW51ID0gZnVuY3Rpb24gKGUsIGNvbXBvbmVudCwgbWVudSkge1xuXHRcdHZhciBfdGhpczY1ID0gdGhpcztcblxuXHRcdHZhciBkb2NIZWlnaHQgPSBNYXRoLm1heChkb2N1bWVudC5ib2R5Lm9mZnNldEhlaWdodCwgd2luZG93LmlubmVySGVpZ2h0KTtcblxuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdC8vYWJvcnQgaWYgbm8gbWVudSBzZXRcblx0XHRpZiAoIW1lbnUgfHwgIW1lbnUubGVuZ3RoKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMubmVzdGVkTWVudUJsb2NrKSB7XG5cdFx0XHQvL2Fib3J0IGlmIGNoaWxkIG1lbnUgYWxyZWFkeSBvcGVuXG5cdFx0XHRpZiAodGhpcy5pc09wZW4oKSkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMubmVzdGVkTWVudUJsb2NrID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdF90aGlzNjUubmVzdGVkTWVudUJsb2NrID0gZmFsc2U7XG5cdFx0XHR9LCAxMDApO1xuXHRcdH1cblxuXHRcdHRoaXMuaGlkZU1lbnUoKTtcblxuXHRcdHRoaXMubWVudUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHR0aGlzLm1lbnVFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLW1lbnVcIik7XG5cblx0XHRtZW51LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdHZhciBpdGVtRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0dmFyIGxhYmVsID0gaXRlbS5sYWJlbDtcblx0XHRcdHZhciBkaXNhYmxlZCA9IGl0ZW0uZGlzYWJsZWQ7XG5cblx0XHRcdGlmIChpdGVtLnNlcGFyYXRvcikge1xuXHRcdFx0XHRpdGVtRWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1tZW51LXNlcGFyYXRvclwiKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGl0ZW1FbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLW1lbnUtaXRlbVwiKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mIGxhYmVsID09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdGxhYmVsID0gbGFiZWwoY29tcG9uZW50LmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChsYWJlbCBpbnN0YW5jZW9mIE5vZGUpIHtcblx0XHRcdFx0XHRpdGVtRWwuYXBwZW5kQ2hpbGQobGFiZWwpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGl0ZW1FbC5pbm5lckhUTUwgPSBsYWJlbDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2YgZGlzYWJsZWQgPT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0ZGlzYWJsZWQgPSBkaXNhYmxlZChjb21wb25lbnQuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGRpc2FibGVkKSB7XG5cdFx0XHRcdFx0aXRlbUVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItbWVudS1pdGVtLWRpc2FibGVkXCIpO1xuXHRcdFx0XHRcdGl0ZW1FbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aXRlbUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdFx0X3RoaXM2NS5oaWRlTWVudSgpO1xuXHRcdFx0XHRcdFx0aXRlbS5hY3Rpb24oZSwgY29tcG9uZW50LmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRfdGhpczY1Lm1lbnVFbC5hcHBlbmRDaGlsZChpdGVtRWwpO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5tZW51RWwuc3R5bGUudG9wID0gZS5wYWdlWSArIFwicHhcIjtcblx0XHR0aGlzLm1lbnVFbC5zdHlsZS5sZWZ0ID0gZS5wYWdlWCArIFwicHhcIjtcblxuXHRcdGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuYmx1ckV2ZW50KTtcblx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIHRoaXMuYmx1ckV2ZW50KTtcblxuXHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0ZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKFwiY29udGV4dG1lbnVcIiwgX3RoaXM2NS5ibHVyRXZlbnQpO1xuXHRcdH0sIDEwMCk7XG5cblx0XHRkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuZXNjRXZlbnQpO1xuXG5cdFx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLm1lbnVFbCk7XG5cblx0XHQvL21vdmUgbWVudSB0byBzdGFydCBvbiByaWdodCBlZGdlIGlmIGl0IGlzIHRvbyBjbG9zZSB0byB0aGUgZWRnZSBvZiB0aGUgc2NyZWVuXG5cdFx0aWYgKGUucGFnZVggKyB0aGlzLm1lbnVFbC5vZmZzZXRXaWR0aCA+PSBkb2N1bWVudC5ib2R5Lm9mZnNldFdpZHRoKSB7XG5cdFx0XHR0aGlzLm1lbnVFbC5zdHlsZS5sZWZ0ID0gXCJcIjtcblx0XHRcdHRoaXMubWVudUVsLnN0eWxlLnJpZ2h0ID0gZG9jdW1lbnQuYm9keS5vZmZzZXRXaWR0aCAtIGUucGFnZVggKyBcInB4XCI7XG5cdFx0fVxuXG5cdFx0Ly9tb3ZlIG1lbnUgdG8gc3RhcnQgb24gYm90dG9tIGVkZ2UgaWYgaXQgaXMgdG9vIGNsb3NlIHRvIHRoZSBlZGdlIG9mIHRoZSBzY3JlZW5cblx0XHRpZiAoZS5wYWdlWSArIHRoaXMubWVudUVsLm9mZnNldEhlaWdodCA+PSBkb2NIZWlnaHQpIHtcblx0XHRcdHRoaXMubWVudUVsLnN0eWxlLnRvcCA9IFwiXCI7XG5cdFx0XHR0aGlzLm1lbnVFbC5zdHlsZS5ib3R0b20gPSBkb2NIZWlnaHQgLSBlLnBhZ2VZICsgXCJweFwiO1xuXHRcdH1cblx0fTtcblxuXHRNZW51LnByb3RvdHlwZS5pc09wZW4gPSBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuICEhdGhpcy5tZW51RWwucGFyZW50Tm9kZTtcblx0fTtcblxuXHRNZW51LnByb3RvdHlwZS5lc2NNZW51ID0gZnVuY3Rpb24gKGUpIHtcblx0XHRpZiAoZS5rZXlDb2RlID09IDI3KSB7XG5cdFx0XHR0aGlzLmhpZGVNZW51KCk7XG5cdFx0fVxuXHR9O1xuXG5cdE1lbnUucHJvdG90eXBlLmhpZGVNZW51ID0gZnVuY3Rpb24gKCkge1xuXHRcdGlmICh0aGlzLm1lbnVFbC5wYXJlbnROb2RlKSB7XG5cdFx0XHR0aGlzLm1lbnVFbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMubWVudUVsKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5lc2NFdmVudCkge1xuXHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLmVzY0V2ZW50KTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5ibHVyRXZlbnQpIHtcblx0XHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuYmx1ckV2ZW50KTtcblx0XHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNvbnRleHRtZW51XCIsIHRoaXMuYmx1ckV2ZW50KTtcblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJzY3JvbGxcIiwgdGhpcy5ibHVyRXZlbnQpO1xuXHRcdH1cblx0fTtcblxuXHQvL2RlZmF1bHQgYWNjZXNzb3JzXG5cdE1lbnUucHJvdG90eXBlLm1lbnVzID0ge307XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcIm1lbnVcIiwgTWVudSk7XG5cdHZhciBNb3ZlQ29sdW1ucyA9IGZ1bmN0aW9uIE1vdmVDb2x1bW5zKHRhYmxlKSB7XG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlOyAvL2hvbGQgVGFidWxhdG9yIG9iamVjdFxuXHRcdHRoaXMucGxhY2Vob2xkZXJFbGVtZW50ID0gdGhpcy5jcmVhdGVQbGFjZWhvbGRlckVsZW1lbnQoKTtcblx0XHR0aGlzLmhvdmVyRWxlbWVudCA9IGZhbHNlOyAvL2Zsb2F0aW5nIGNvbHVtbiBoZWFkZXIgZWxlbWVudFxuXHRcdHRoaXMuY2hlY2tUaW1lb3V0ID0gZmFsc2U7IC8vY2xpY2sgY2hlY2sgdGltZW91dCBob2xkZXJcblx0XHR0aGlzLmNoZWNrUGVyaW9kID0gMjUwOyAvL3BlcmlvZCB0byB3YWl0IG9uIG1vdXNlZG93biB0byBjb25zaWRlciB0aGlzIGEgbW92ZSBhbmQgbm90IGEgY2xpY2tcblx0XHR0aGlzLm1vdmluZyA9IGZhbHNlOyAvL2N1cnJlbnRseSBtb3ZpbmcgY29sdW1uXG5cdFx0dGhpcy50b0NvbCA9IGZhbHNlOyAvL2Rlc3RpbmF0aW9uIGNvbHVtblxuXHRcdHRoaXMudG9Db2xBZnRlciA9IGZhbHNlOyAvL3Bvc2l0aW9uIG9mIG1vdmluZyBjb2x1bW4gcmVsYXRpdmUgdG8gdGhlIGRlc2l0bmF0aW9uIGNvbHVtblxuXHRcdHRoaXMuc3RhcnRYID0gMDsgLy9zdGFydGluZyBwb3NpdGlvbiB3aXRoaW4gaGVhZGVyIGVsZW1lbnRcblx0XHR0aGlzLmF1dG9TY3JvbGxNYXJnaW4gPSA0MDsgLy9hdXRvIHNjcm9sbCBvbiBlZGdlIHdoZW4gd2l0aGluIG1hcmdpblxuXHRcdHRoaXMuYXV0b1Njcm9sbFN0ZXAgPSA1OyAvL2F1dG8gc2Nyb2xsIGRpc3RhbmNlIGluIHBpeGVsc1xuXHRcdHRoaXMuYXV0b1Njcm9sbFRpbWVvdXQgPSBmYWxzZTsgLy9hdXRvIHNjcm9sbCB0aW1lb3V0XG5cdFx0dGhpcy50b3VjaE1vdmUgPSBmYWxzZTtcblxuXHRcdHRoaXMubW92ZUhvdmVyID0gdGhpcy5tb3ZlSG92ZXIuYmluZCh0aGlzKTtcblx0XHR0aGlzLmVuZE1vdmUgPSB0aGlzLmVuZE1vdmUuYmluZCh0aGlzKTtcblx0fTtcblxuXHRNb3ZlQ29sdW1ucy5wcm90b3R5cGUuY3JlYXRlUGxhY2Vob2xkZXJFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cblx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNvbFwiKTtcblx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNvbC1wbGFjZWhvbGRlclwiKTtcblxuXHRcdHJldHVybiBlbDtcblx0fTtcblxuXHRNb3ZlQ29sdW1ucy5wcm90b3R5cGUuaW5pdGlhbGl6ZUNvbHVtbiA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGNvbmZpZyA9IHt9LFxuXHRcdCAgICBjb2xFbDtcblxuXHRcdGlmICghY29sdW1uLm1vZHVsZXMuZnJvemVuKSB7XG5cblx0XHRcdGNvbEVsID0gY29sdW1uLmdldEVsZW1lbnQoKTtcblxuXHRcdFx0Y29uZmlnLm1vdXNlbW92ZSA9IGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGlmIChjb2x1bW4ucGFyZW50ID09PSBzZWxmLm1vdmluZy5wYXJlbnQpIHtcblx0XHRcdFx0XHRpZiAoKHNlbGYudG91Y2hNb3ZlID8gZS50b3VjaGVzWzBdLnBhZ2VYIDogZS5wYWdlWCkgLSBUYWJ1bGF0b3IucHJvdG90eXBlLmhlbHBlcnMuZWxPZmZzZXQoY29sRWwpLmxlZnQgKyBzZWxmLnRhYmxlLmNvbHVtbk1hbmFnZXIuZWxlbWVudC5zY3JvbGxMZWZ0ID4gY29sdW1uLmdldFdpZHRoKCkgLyAyKSB7XG5cdFx0XHRcdFx0XHRpZiAoc2VsZi50b0NvbCAhPT0gY29sdW1uIHx8ICFzZWxmLnRvQ29sQWZ0ZXIpIHtcblx0XHRcdFx0XHRcdFx0Y29sRWwucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoc2VsZi5wbGFjZWhvbGRlckVsZW1lbnQsIGNvbEVsLm5leHRTaWJsaW5nKTtcblx0XHRcdFx0XHRcdFx0c2VsZi5tb3ZlQ29sdW1uKGNvbHVtbiwgdHJ1ZSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGlmIChzZWxmLnRvQ29sICE9PSBjb2x1bW4gfHwgc2VsZi50b0NvbEFmdGVyKSB7XG5cdFx0XHRcdFx0XHRcdGNvbEVsLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHNlbGYucGxhY2Vob2xkZXJFbGVtZW50LCBjb2xFbCk7XG5cdFx0XHRcdFx0XHRcdHNlbGYubW92ZUNvbHVtbihjb2x1bW4sIGZhbHNlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0uYmluZChzZWxmKTtcblxuXHRcdFx0Y29sRWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRzZWxmLnRvdWNoTW92ZSA9IGZhbHNlO1xuXHRcdFx0XHRpZiAoZS53aGljaCA9PT0gMSkge1xuXHRcdFx0XHRcdHNlbGYuY2hlY2tUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRzZWxmLnN0YXJ0TW92ZShlLCBjb2x1bW4pO1xuXHRcdFx0XHRcdH0sIHNlbGYuY2hlY2tQZXJpb2QpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0Y29sRWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0aWYgKGUud2hpY2ggPT09IDEpIHtcblx0XHRcdFx0XHRpZiAoc2VsZi5jaGVja1RpbWVvdXQpIHtcblx0XHRcdFx0XHRcdGNsZWFyVGltZW91dChzZWxmLmNoZWNrVGltZW91dCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0c2VsZi5iaW5kVG91Y2hFdmVudHMoY29sdW1uKTtcblx0XHR9XG5cblx0XHRjb2x1bW4ubW9kdWxlcy5tb3ZlQ29sdW1uID0gY29uZmlnO1xuXHR9O1xuXG5cdE1vdmVDb2x1bW5zLnByb3RvdHlwZS5iaW5kVG91Y2hFdmVudHMgPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBjb2xFbCA9IGNvbHVtbi5nZXRFbGVtZW50KCksXG5cdFx0ICAgIHN0YXJ0WE1vdmUgPSBmYWxzZSxcblx0XHQgICAgLy9zaGlmdGluZyBjZW50ZXIgcG9zaXRpb24gb2YgdGhlIGNlbGxcblx0XHRkaXIgPSBmYWxzZSxcblx0XHQgICAgY3VycmVudENvbCxcblx0XHQgICAgbmV4dENvbCxcblx0XHQgICAgcHJldkNvbCxcblx0XHQgICAgbmV4dENvbFdpZHRoLFxuXHRcdCAgICBwcmV2Q29sV2lkdGgsXG5cdFx0ICAgIG5leHRDb2xXaWR0aExhc3QsXG5cdFx0ICAgIHByZXZDb2xXaWR0aExhc3Q7XG5cblx0XHRjb2xFbC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0c2VsZi5jaGVja1RpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0c2VsZi50b3VjaE1vdmUgPSB0cnVlO1xuXHRcdFx0XHRjdXJyZW50Q29sID0gY29sdW1uO1xuXHRcdFx0XHRuZXh0Q29sID0gY29sdW1uLm5leHRDb2x1bW4oKTtcblx0XHRcdFx0bmV4dENvbFdpZHRoID0gbmV4dENvbCA/IG5leHRDb2wuZ2V0V2lkdGgoKSAvIDIgOiAwO1xuXHRcdFx0XHRwcmV2Q29sID0gY29sdW1uLnByZXZDb2x1bW4oKTtcblx0XHRcdFx0cHJldkNvbFdpZHRoID0gcHJldkNvbCA/IHByZXZDb2wuZ2V0V2lkdGgoKSAvIDIgOiAwO1xuXHRcdFx0XHRuZXh0Q29sV2lkdGhMYXN0ID0gMDtcblx0XHRcdFx0cHJldkNvbFdpZHRoTGFzdCA9IDA7XG5cdFx0XHRcdHN0YXJ0WE1vdmUgPSBmYWxzZTtcblxuXHRcdFx0XHRzZWxmLnN0YXJ0TW92ZShlLCBjb2x1bW4pO1xuXHRcdFx0fSwgc2VsZi5jaGVja1BlcmlvZCk7XG5cdFx0fSwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuXG5cdFx0Y29sRWwuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNobW92ZVwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0dmFyIGhhbGZDb2wsIGRpZmYsIG1vdmVUb0NvbDtcblxuXHRcdFx0aWYgKHNlbGYubW92aW5nKSB7XG5cdFx0XHRcdHNlbGYubW92ZUhvdmVyKGUpO1xuXG5cdFx0XHRcdGlmICghc3RhcnRYTW92ZSkge1xuXHRcdFx0XHRcdHN0YXJ0WE1vdmUgPSBlLnRvdWNoZXNbMF0ucGFnZVg7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRkaWZmID0gZS50b3VjaGVzWzBdLnBhZ2VYIC0gc3RhcnRYTW92ZTtcblxuXHRcdFx0XHRpZiAoZGlmZiA+IDApIHtcblx0XHRcdFx0XHRpZiAobmV4dENvbCAmJiBkaWZmIC0gbmV4dENvbFdpZHRoTGFzdCA+IG5leHRDb2xXaWR0aCkge1xuXHRcdFx0XHRcdFx0bW92ZVRvQ29sID0gbmV4dENvbDtcblxuXHRcdFx0XHRcdFx0aWYgKG1vdmVUb0NvbCAhPT0gY29sdW1uKSB7XG5cdFx0XHRcdFx0XHRcdHN0YXJ0WE1vdmUgPSBlLnRvdWNoZXNbMF0ucGFnZVg7XG5cdFx0XHRcdFx0XHRcdG1vdmVUb0NvbC5nZXRFbGVtZW50KCkucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoc2VsZi5wbGFjZWhvbGRlckVsZW1lbnQsIG1vdmVUb0NvbC5nZXRFbGVtZW50KCkubmV4dFNpYmxpbmcpO1xuXHRcdFx0XHRcdFx0XHRzZWxmLm1vdmVDb2x1bW4obW92ZVRvQ29sLCB0cnVlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aWYgKHByZXZDb2wgJiYgLWRpZmYgLSBwcmV2Q29sV2lkdGhMYXN0ID4gcHJldkNvbFdpZHRoKSB7XG5cdFx0XHRcdFx0XHRtb3ZlVG9Db2wgPSBwcmV2Q29sO1xuXG5cdFx0XHRcdFx0XHRpZiAobW92ZVRvQ29sICE9PSBjb2x1bW4pIHtcblx0XHRcdFx0XHRcdFx0c3RhcnRYTW92ZSA9IGUudG91Y2hlc1swXS5wYWdlWDtcblx0XHRcdFx0XHRcdFx0bW92ZVRvQ29sLmdldEVsZW1lbnQoKS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShzZWxmLnBsYWNlaG9sZGVyRWxlbWVudCwgbW92ZVRvQ29sLmdldEVsZW1lbnQoKSk7XG5cdFx0XHRcdFx0XHRcdHNlbGYubW92ZUNvbHVtbihtb3ZlVG9Db2wsIGZhbHNlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAobW92ZVRvQ29sKSB7XG5cdFx0XHRcdFx0Y3VycmVudENvbCA9IG1vdmVUb0NvbDtcblx0XHRcdFx0XHRuZXh0Q29sID0gbW92ZVRvQ29sLm5leHRDb2x1bW4oKTtcblx0XHRcdFx0XHRuZXh0Q29sV2lkdGhMYXN0ID0gbmV4dENvbFdpZHRoO1xuXHRcdFx0XHRcdG5leHRDb2xXaWR0aCA9IG5leHRDb2wgPyBuZXh0Q29sLmdldFdpZHRoKCkgLyAyIDogMDtcblx0XHRcdFx0XHRwcmV2Q29sID0gbW92ZVRvQ29sLnByZXZDb2x1bW4oKTtcblx0XHRcdFx0XHRwcmV2Q29sV2lkdGhMYXN0ID0gcHJldkNvbFdpZHRoO1xuXHRcdFx0XHRcdHByZXZDb2xXaWR0aCA9IHByZXZDb2wgPyBwcmV2Q29sLmdldFdpZHRoKCkgLyAyIDogMDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcblxuXHRcdGNvbEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0aWYgKHNlbGYuY2hlY2tUaW1lb3V0KSB7XG5cdFx0XHRcdGNsZWFyVGltZW91dChzZWxmLmNoZWNrVGltZW91dCk7XG5cdFx0XHR9XG5cdFx0XHRpZiAoc2VsZi5tb3ZpbmcpIHtcblx0XHRcdFx0c2VsZi5lbmRNb3ZlKGUpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdE1vdmVDb2x1bW5zLnByb3RvdHlwZS5zdGFydE1vdmUgPSBmdW5jdGlvbiAoZSwgY29sdW1uKSB7XG5cdFx0dmFyIGVsZW1lbnQgPSBjb2x1bW4uZ2V0RWxlbWVudCgpO1xuXG5cdFx0dGhpcy5tb3ZpbmcgPSBjb2x1bW47XG5cdFx0dGhpcy5zdGFydFggPSAodGhpcy50b3VjaE1vdmUgPyBlLnRvdWNoZXNbMF0ucGFnZVggOiBlLnBhZ2VYKSAtIFRhYnVsYXRvci5wcm90b3R5cGUuaGVscGVycy5lbE9mZnNldChlbGVtZW50KS5sZWZ0O1xuXG5cdFx0dGhpcy50YWJsZS5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItYmxvY2stc2VsZWN0XCIpO1xuXG5cdFx0Ly9jcmVhdGUgcGxhY2Vob2xkZXJcblx0XHR0aGlzLnBsYWNlaG9sZGVyRWxlbWVudC5zdHlsZS53aWR0aCA9IGNvbHVtbi5nZXRXaWR0aCgpICsgXCJweFwiO1xuXHRcdHRoaXMucGxhY2Vob2xkZXJFbGVtZW50LnN0eWxlLmhlaWdodCA9IGNvbHVtbi5nZXRIZWlnaHQoKSArIFwicHhcIjtcblxuXHRcdGVsZW1lbnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5wbGFjZWhvbGRlckVsZW1lbnQsIGVsZW1lbnQpO1xuXHRcdGVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbGVtZW50KTtcblxuXHRcdC8vY3JlYXRlIGhvdmVyIGVsZW1lbnRcblx0XHR0aGlzLmhvdmVyRWxlbWVudCA9IGVsZW1lbnQuY2xvbmVOb2RlKHRydWUpO1xuXHRcdHRoaXMuaG92ZXJFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItbW92aW5nXCIpO1xuXG5cdFx0dGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldEVsZW1lbnQoKS5hcHBlbmRDaGlsZCh0aGlzLmhvdmVyRWxlbWVudCk7XG5cblx0XHR0aGlzLmhvdmVyRWxlbWVudC5zdHlsZS5sZWZ0ID0gXCIwXCI7XG5cdFx0dGhpcy5ob3ZlckVsZW1lbnQuc3R5bGUuYm90dG9tID0gXCIwXCI7XG5cblx0XHRpZiAoIXRoaXMudG91Y2hNb3ZlKSB7XG5cdFx0XHR0aGlzLl9iaW5kTW91c2VNb3ZlKCk7XG5cblx0XHRcdGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCB0aGlzLm1vdmVIb3Zlcik7XG5cdFx0XHRkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIHRoaXMuZW5kTW92ZSk7XG5cdFx0fVxuXG5cdFx0dGhpcy5tb3ZlSG92ZXIoZSk7XG5cdH07XG5cblx0TW92ZUNvbHVtbnMucHJvdG90eXBlLl9iaW5kTW91c2VNb3ZlID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5jb2x1bW5zQnlJbmRleC5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdGlmIChjb2x1bW4ubW9kdWxlcy5tb3ZlQ29sdW1uLm1vdXNlbW92ZSkge1xuXHRcdFx0XHRjb2x1bW4uZ2V0RWxlbWVudCgpLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgY29sdW1uLm1vZHVsZXMubW92ZUNvbHVtbi5tb3VzZW1vdmUpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdE1vdmVDb2x1bW5zLnByb3RvdHlwZS5fdW5iaW5kTW91c2VNb3ZlID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5jb2x1bW5zQnlJbmRleC5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdGlmIChjb2x1bW4ubW9kdWxlcy5tb3ZlQ29sdW1uLm1vdXNlbW92ZSkge1xuXHRcdFx0XHRjb2x1bW4uZ2V0RWxlbWVudCgpLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgY29sdW1uLm1vZHVsZXMubW92ZUNvbHVtbi5tb3VzZW1vdmUpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdE1vdmVDb2x1bW5zLnByb3RvdHlwZS5tb3ZlQ29sdW1uID0gZnVuY3Rpb24gKGNvbHVtbiwgYWZ0ZXIpIHtcblx0XHR2YXIgbW92aW5nQ2VsbHMgPSB0aGlzLm1vdmluZy5nZXRDZWxscygpO1xuXG5cdFx0dGhpcy50b0NvbCA9IGNvbHVtbjtcblx0XHR0aGlzLnRvQ29sQWZ0ZXIgPSBhZnRlcjtcblxuXHRcdGlmIChhZnRlcikge1xuXHRcdFx0Y29sdW1uLmdldENlbGxzKCkuZm9yRWFjaChmdW5jdGlvbiAoY2VsbCwgaSkge1xuXHRcdFx0XHR2YXIgY2VsbEVsID0gY2VsbC5nZXRFbGVtZW50KCk7XG5cdFx0XHRcdGNlbGxFbC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShtb3ZpbmdDZWxsc1tpXS5nZXRFbGVtZW50KCksIGNlbGxFbC5uZXh0U2libGluZyk7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y29sdW1uLmdldENlbGxzKCkuZm9yRWFjaChmdW5jdGlvbiAoY2VsbCwgaSkge1xuXHRcdFx0XHR2YXIgY2VsbEVsID0gY2VsbC5nZXRFbGVtZW50KCk7XG5cdFx0XHRcdGNlbGxFbC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShtb3ZpbmdDZWxsc1tpXS5nZXRFbGVtZW50KCksIGNlbGxFbCk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH07XG5cblx0TW92ZUNvbHVtbnMucHJvdG90eXBlLmVuZE1vdmUgPSBmdW5jdGlvbiAoZSkge1xuXHRcdGlmIChlLndoaWNoID09PSAxIHx8IHRoaXMudG91Y2hNb3ZlKSB7XG5cdFx0XHR0aGlzLl91bmJpbmRNb3VzZU1vdmUoKTtcblxuXHRcdFx0dGhpcy5wbGFjZWhvbGRlckVsZW1lbnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5tb3ZpbmcuZ2V0RWxlbWVudCgpLCB0aGlzLnBsYWNlaG9sZGVyRWxlbWVudC5uZXh0U2libGluZyk7XG5cdFx0XHR0aGlzLnBsYWNlaG9sZGVyRWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMucGxhY2Vob2xkZXJFbGVtZW50KTtcblx0XHRcdHRoaXMuaG92ZXJFbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5ob3ZlckVsZW1lbnQpO1xuXG5cdFx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcInRhYnVsYXRvci1ibG9jay1zZWxlY3RcIik7XG5cblx0XHRcdGlmICh0aGlzLnRvQ29sKSB7XG5cdFx0XHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5tb3ZlQ29sdW1uQWN0dWFsKHRoaXMubW92aW5nLCB0aGlzLnRvQ29sLCB0aGlzLnRvQ29sQWZ0ZXIpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLm1vdmluZyA9IGZhbHNlO1xuXHRcdFx0dGhpcy50b0NvbCA9IGZhbHNlO1xuXHRcdFx0dGhpcy50b0NvbEFmdGVyID0gZmFsc2U7XG5cblx0XHRcdGlmICghdGhpcy50b3VjaE1vdmUpIHtcblx0XHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIHRoaXMubW92ZUhvdmVyKTtcblx0XHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCB0aGlzLmVuZE1vdmUpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRNb3ZlQ29sdW1ucy5wcm90b3R5cGUubW92ZUhvdmVyID0gZnVuY3Rpb24gKGUpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGNvbHVtbkhvbGRlciA9IHNlbGYudGFibGUuY29sdW1uTWFuYWdlci5nZXRFbGVtZW50KCksXG5cdFx0ICAgIHNjcm9sbExlZnQgPSBjb2x1bW5Ib2xkZXIuc2Nyb2xsTGVmdCxcblx0XHQgICAgeFBvcyA9IChzZWxmLnRvdWNoTW92ZSA/IGUudG91Y2hlc1swXS5wYWdlWCA6IGUucGFnZVgpIC0gVGFidWxhdG9yLnByb3RvdHlwZS5oZWxwZXJzLmVsT2Zmc2V0KGNvbHVtbkhvbGRlcikubGVmdCArIHNjcm9sbExlZnQsXG5cdFx0ICAgIHNjcm9sbFBvcztcblxuXHRcdHNlbGYuaG92ZXJFbGVtZW50LnN0eWxlLmxlZnQgPSB4UG9zIC0gc2VsZi5zdGFydFggKyBcInB4XCI7XG5cblx0XHRpZiAoeFBvcyAtIHNjcm9sbExlZnQgPCBzZWxmLmF1dG9TY3JvbGxNYXJnaW4pIHtcblx0XHRcdGlmICghc2VsZi5hdXRvU2Nyb2xsVGltZW91dCkge1xuXHRcdFx0XHRzZWxmLmF1dG9TY3JvbGxUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0c2Nyb2xsUG9zID0gTWF0aC5tYXgoMCwgc2Nyb2xsTGVmdCAtIDUpO1xuXHRcdFx0XHRcdHNlbGYudGFibGUucm93TWFuYWdlci5nZXRFbGVtZW50KCkuc2Nyb2xsTGVmdCA9IHNjcm9sbFBvcztcblx0XHRcdFx0XHRzZWxmLmF1dG9TY3JvbGxUaW1lb3V0ID0gZmFsc2U7XG5cdFx0XHRcdH0sIDEpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChzY3JvbGxMZWZ0ICsgY29sdW1uSG9sZGVyLmNsaWVudFdpZHRoIC0geFBvcyA8IHNlbGYuYXV0b1Njcm9sbE1hcmdpbikge1xuXHRcdFx0aWYgKCFzZWxmLmF1dG9TY3JvbGxUaW1lb3V0KSB7XG5cdFx0XHRcdHNlbGYuYXV0b1Njcm9sbFRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRzY3JvbGxQb3MgPSBNYXRoLm1pbihjb2x1bW5Ib2xkZXIuY2xpZW50V2lkdGgsIHNjcm9sbExlZnQgKyA1KTtcblx0XHRcdFx0XHRzZWxmLnRhYmxlLnJvd01hbmFnZXIuZ2V0RWxlbWVudCgpLnNjcm9sbExlZnQgPSBzY3JvbGxQb3M7XG5cdFx0XHRcdFx0c2VsZi5hdXRvU2Nyb2xsVGltZW91dCA9IGZhbHNlO1xuXHRcdFx0XHR9LCAxKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcIm1vdmVDb2x1bW5cIiwgTW92ZUNvbHVtbnMpO1xuXG5cdHZhciBNb3ZlUm93cyA9IGZ1bmN0aW9uIE1vdmVSb3dzKHRhYmxlKSB7XG5cblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdFx0dGhpcy5wbGFjZWhvbGRlckVsZW1lbnQgPSB0aGlzLmNyZWF0ZVBsYWNlaG9sZGVyRWxlbWVudCgpO1xuXHRcdHRoaXMuaG92ZXJFbGVtZW50ID0gZmFsc2U7IC8vZmxvYXRpbmcgcm93IGhlYWRlciBlbGVtZW50XG5cdFx0dGhpcy5jaGVja1RpbWVvdXQgPSBmYWxzZTsgLy9jbGljayBjaGVjayB0aW1lb3V0IGhvbGRlclxuXHRcdHRoaXMuY2hlY2tQZXJpb2QgPSAxNTA7IC8vcGVyaW9kIHRvIHdhaXQgb24gbW91c2Vkb3duIHRvIGNvbnNpZGVyIHRoaXMgYSBtb3ZlIGFuZCBub3QgYSBjbGlja1xuXHRcdHRoaXMubW92aW5nID0gZmFsc2U7IC8vY3VycmVudGx5IG1vdmluZyByb3dcblx0XHR0aGlzLnRvUm93ID0gZmFsc2U7IC8vZGVzdGluYXRpb24gcm93XG5cdFx0dGhpcy50b1Jvd0FmdGVyID0gZmFsc2U7IC8vcG9zaXRpb24gb2YgbW92aW5nIHJvdyByZWxhdGl2ZSB0byB0aGUgZGVzaXRuYXRpb24gcm93XG5cdFx0dGhpcy5oYXNIYW5kbGUgPSBmYWxzZTsgLy9yb3cgaGFzIGhhbmRsZSBpbnN0ZWFkIG9mIGZ1bGx5IG1vdmFibGUgcm93XG5cdFx0dGhpcy5zdGFydFkgPSAwOyAvL3N0YXJ0aW5nIFkgcG9zaXRpb24gd2l0aGluIGhlYWRlciBlbGVtZW50XG5cdFx0dGhpcy5zdGFydFggPSAwOyAvL3N0YXJ0aW5nIFggcG9zaXRpb24gd2l0aGluIGhlYWRlciBlbGVtZW50XG5cblx0XHR0aGlzLm1vdmVIb3ZlciA9IHRoaXMubW92ZUhvdmVyLmJpbmQodGhpcyk7XG5cdFx0dGhpcy5lbmRNb3ZlID0gdGhpcy5lbmRNb3ZlLmJpbmQodGhpcyk7XG5cdFx0dGhpcy50YWJsZVJvd0Ryb3BFdmVudCA9IGZhbHNlO1xuXG5cdFx0dGhpcy50b3VjaE1vdmUgPSBmYWxzZTtcblxuXHRcdHRoaXMuY29ubmVjdGlvbiA9IGZhbHNlO1xuXHRcdHRoaXMuY29ubmVjdGlvblNlbGVjdG9yc1RhYmxlcyA9IGZhbHNlO1xuXHRcdHRoaXMuY29ubmVjdGlvblNlbGVjdG9yc0VsZW1lbnRzID0gZmFsc2U7XG5cdFx0dGhpcy5jb25uZWN0aW9uRWxlbWVudHMgPSBbXTtcblx0XHR0aGlzLmNvbm5lY3Rpb25zID0gW107XG5cblx0XHR0aGlzLmNvbm5lY3RlZFRhYmxlID0gZmFsc2U7XG5cdFx0dGhpcy5jb25uZWN0ZWRSb3cgPSBmYWxzZTtcblx0fTtcblxuXHRNb3ZlUm93cy5wcm90b3R5cGUuY3JlYXRlUGxhY2Vob2xkZXJFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cblx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXJvd1wiKTtcblx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXJvdy1wbGFjZWhvbGRlclwiKTtcblxuXHRcdHJldHVybiBlbDtcblx0fTtcblxuXHRNb3ZlUm93cy5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChoYW5kbGUpIHtcblx0XHR0aGlzLmNvbm5lY3Rpb25TZWxlY3RvcnNUYWJsZXMgPSB0aGlzLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3NDb25uZWN0ZWRUYWJsZXM7XG5cdFx0dGhpcy5jb25uZWN0aW9uU2VsZWN0b3JzRWxlbWVudHMgPSB0aGlzLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3NDb25uZWN0ZWRFbGVtZW50cztcblxuXHRcdHRoaXMuY29ubmVjdGlvbiA9IHRoaXMuY29ubmVjdGlvblNlbGVjdG9yc1RhYmxlcyB8fCB0aGlzLmNvbm5lY3Rpb25TZWxlY3RvcnNFbGVtZW50cztcblx0fTtcblxuXHRNb3ZlUm93cy5wcm90b3R5cGUuc2V0SGFuZGxlID0gZnVuY3Rpb24gKGhhbmRsZSkge1xuXHRcdHRoaXMuaGFzSGFuZGxlID0gaGFuZGxlO1xuXHR9O1xuXG5cdE1vdmVSb3dzLnByb3RvdHlwZS5pbml0aWFsaXplR3JvdXBIZWFkZXIgPSBmdW5jdGlvbiAoZ3JvdXApIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGNvbmZpZyA9IHt9LFxuXHRcdCAgICByb3dFbDtcblxuXHRcdC8vaW50ZXIgdGFibGUgZHJhZyBkcm9wXG5cdFx0Y29uZmlnLm1vdXNldXAgPSBmdW5jdGlvbiAoZSkge1xuXHRcdFx0c2VsZi50YWJsZVJvd0Ryb3AoZSwgcm93KTtcblx0XHR9LmJpbmQoc2VsZik7XG5cblx0XHQvL3NhbWUgdGFibGUgZHJhZyBkcm9wXG5cdFx0Y29uZmlnLm1vdXNlbW92ZSA9IGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRpZiAoZS5wYWdlWSAtIFRhYnVsYXRvci5wcm90b3R5cGUuaGVscGVycy5lbE9mZnNldChncm91cC5lbGVtZW50KS50b3AgKyBzZWxmLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxUb3AgPiBncm91cC5nZXRIZWlnaHQoKSAvIDIpIHtcblx0XHRcdFx0aWYgKHNlbGYudG9Sb3cgIT09IGdyb3VwIHx8ICFzZWxmLnRvUm93QWZ0ZXIpIHtcblx0XHRcdFx0XHR2YXIgcm93RWwgPSBncm91cC5nZXRFbGVtZW50KCk7XG5cdFx0XHRcdFx0cm93RWwucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoc2VsZi5wbGFjZWhvbGRlckVsZW1lbnQsIHJvd0VsLm5leHRTaWJsaW5nKTtcblx0XHRcdFx0XHRzZWxmLm1vdmVSb3coZ3JvdXAsIHRydWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAoc2VsZi50b1JvdyAhPT0gZ3JvdXAgfHwgc2VsZi50b1Jvd0FmdGVyKSB7XG5cdFx0XHRcdFx0dmFyIHJvd0VsID0gZ3JvdXAuZ2V0RWxlbWVudCgpO1xuXHRcdFx0XHRcdGlmIChyb3dFbC5wcmV2aW91c1NpYmxpbmcpIHtcblx0XHRcdFx0XHRcdHJvd0VsLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHNlbGYucGxhY2Vob2xkZXJFbGVtZW50LCByb3dFbCk7XG5cdFx0XHRcdFx0XHRzZWxmLm1vdmVSb3coZ3JvdXAsIGZhbHNlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LmJpbmQoc2VsZik7XG5cblx0XHRncm91cC5tb2R1bGVzLm1vdmVSb3cgPSBjb25maWc7XG5cdH07XG5cblx0TW92ZVJvd3MucHJvdG90eXBlLmluaXRpYWxpemVSb3cgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBjb25maWcgPSB7fSxcblx0XHQgICAgcm93RWw7XG5cblx0XHQvL2ludGVyIHRhYmxlIGRyYWcgZHJvcFxuXHRcdGNvbmZpZy5tb3VzZXVwID0gZnVuY3Rpb24gKGUpIHtcblx0XHRcdHNlbGYudGFibGVSb3dEcm9wKGUsIHJvdyk7XG5cdFx0fS5iaW5kKHNlbGYpO1xuXG5cdFx0Ly9zYW1lIHRhYmxlIGRyYWcgZHJvcFxuXHRcdGNvbmZpZy5tb3VzZW1vdmUgPSBmdW5jdGlvbiAoZSkge1xuXHRcdFx0aWYgKGUucGFnZVkgLSBUYWJ1bGF0b3IucHJvdG90eXBlLmhlbHBlcnMuZWxPZmZzZXQocm93LmVsZW1lbnQpLnRvcCArIHNlbGYudGFibGUucm93TWFuYWdlci5lbGVtZW50LnNjcm9sbFRvcCA+IHJvdy5nZXRIZWlnaHQoKSAvIDIpIHtcblx0XHRcdFx0aWYgKHNlbGYudG9Sb3cgIT09IHJvdyB8fCAhc2VsZi50b1Jvd0FmdGVyKSB7XG5cdFx0XHRcdFx0dmFyIHJvd0VsID0gcm93LmdldEVsZW1lbnQoKTtcblx0XHRcdFx0XHRyb3dFbC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShzZWxmLnBsYWNlaG9sZGVyRWxlbWVudCwgcm93RWwubmV4dFNpYmxpbmcpO1xuXHRcdFx0XHRcdHNlbGYubW92ZVJvdyhyb3csIHRydWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAoc2VsZi50b1JvdyAhPT0gcm93IHx8IHNlbGYudG9Sb3dBZnRlcikge1xuXHRcdFx0XHRcdHZhciByb3dFbCA9IHJvdy5nZXRFbGVtZW50KCk7XG5cdFx0XHRcdFx0cm93RWwucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoc2VsZi5wbGFjZWhvbGRlckVsZW1lbnQsIHJvd0VsKTtcblx0XHRcdFx0XHRzZWxmLm1vdmVSb3cocm93LCBmYWxzZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LmJpbmQoc2VsZik7XG5cblx0XHRpZiAoIXRoaXMuaGFzSGFuZGxlKSB7XG5cblx0XHRcdHJvd0VsID0gcm93LmdldEVsZW1lbnQoKTtcblxuXHRcdFx0cm93RWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRpZiAoZS53aGljaCA9PT0gMSkge1xuXHRcdFx0XHRcdHNlbGYuY2hlY2tUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRzZWxmLnN0YXJ0TW92ZShlLCByb3cpO1xuXHRcdFx0XHRcdH0sIHNlbGYuY2hlY2tQZXJpb2QpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0cm93RWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0aWYgKGUud2hpY2ggPT09IDEpIHtcblx0XHRcdFx0XHRpZiAoc2VsZi5jaGVja1RpbWVvdXQpIHtcblx0XHRcdFx0XHRcdGNsZWFyVGltZW91dChzZWxmLmNoZWNrVGltZW91dCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5iaW5kVG91Y2hFdmVudHMocm93LCByb3cuZ2V0RWxlbWVudCgpKTtcblx0XHR9XG5cblx0XHRyb3cubW9kdWxlcy5tb3ZlUm93ID0gY29uZmlnO1xuXHR9O1xuXG5cdE1vdmVSb3dzLnByb3RvdHlwZS5pbml0aWFsaXplQ2VsbCA9IGZ1bmN0aW9uIChjZWxsKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBjZWxsRWwgPSBjZWxsLmdldEVsZW1lbnQoKTtcblxuXHRcdGNlbGxFbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRpZiAoZS53aGljaCA9PT0gMSkge1xuXHRcdFx0XHRzZWxmLmNoZWNrVGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdHNlbGYuc3RhcnRNb3ZlKGUsIGNlbGwucm93KTtcblx0XHRcdFx0fSwgc2VsZi5jaGVja1BlcmlvZCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRjZWxsRWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdGlmIChlLndoaWNoID09PSAxKSB7XG5cdFx0XHRcdGlmIChzZWxmLmNoZWNrVGltZW91dCkge1xuXHRcdFx0XHRcdGNsZWFyVGltZW91dChzZWxmLmNoZWNrVGltZW91dCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHRoaXMuYmluZFRvdWNoRXZlbnRzKGNlbGwucm93LCBjZWxsLmdldEVsZW1lbnQoKSk7XG5cdH07XG5cblx0TW92ZVJvd3MucHJvdG90eXBlLmJpbmRUb3VjaEV2ZW50cyA9IGZ1bmN0aW9uIChyb3csIGVsZW1lbnQpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHN0YXJ0WU1vdmUgPSBmYWxzZSxcblx0XHQgICAgLy9zaGlmdGluZyBjZW50ZXIgcG9zaXRpb24gb2YgdGhlIGNlbGxcblx0XHRkaXIgPSBmYWxzZSxcblx0XHQgICAgY3VycmVudFJvdyxcblx0XHQgICAgbmV4dFJvdyxcblx0XHQgICAgcHJldlJvdyxcblx0XHQgICAgbmV4dFJvd0hlaWdodCxcblx0XHQgICAgcHJldlJvd0hlaWdodCxcblx0XHQgICAgbmV4dFJvd0hlaWdodExhc3QsXG5cdFx0ICAgIHByZXZSb3dIZWlnaHRMYXN0O1xuXG5cdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0c2VsZi5jaGVja1RpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0c2VsZi50b3VjaE1vdmUgPSB0cnVlO1xuXHRcdFx0XHRjdXJyZW50Um93ID0gcm93O1xuXHRcdFx0XHRuZXh0Um93ID0gcm93Lm5leHRSb3coKTtcblx0XHRcdFx0bmV4dFJvd0hlaWdodCA9IG5leHRSb3cgPyBuZXh0Um93LmdldEhlaWdodCgpIC8gMiA6IDA7XG5cdFx0XHRcdHByZXZSb3cgPSByb3cucHJldlJvdygpO1xuXHRcdFx0XHRwcmV2Um93SGVpZ2h0ID0gcHJldlJvdyA/IHByZXZSb3cuZ2V0SGVpZ2h0KCkgLyAyIDogMDtcblx0XHRcdFx0bmV4dFJvd0hlaWdodExhc3QgPSAwO1xuXHRcdFx0XHRwcmV2Um93SGVpZ2h0TGFzdCA9IDA7XG5cdFx0XHRcdHN0YXJ0WU1vdmUgPSBmYWxzZTtcblxuXHRcdFx0XHRzZWxmLnN0YXJ0TW92ZShlLCByb3cpO1xuXHRcdFx0fSwgc2VsZi5jaGVja1BlcmlvZCk7XG5cdFx0fSwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuXHRcdHRoaXMubW92aW5nLCB0aGlzLnRvUm93LCB0aGlzLnRvUm93QWZ0ZXI7XG5cdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdHZhciBoYWxmQ29sLCBkaWZmLCBtb3ZlVG9Sb3c7XG5cblx0XHRcdGlmIChzZWxmLm1vdmluZykge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdFx0c2VsZi5tb3ZlSG92ZXIoZSk7XG5cblx0XHRcdFx0aWYgKCFzdGFydFlNb3ZlKSB7XG5cdFx0XHRcdFx0c3RhcnRZTW92ZSA9IGUudG91Y2hlc1swXS5wYWdlWTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGRpZmYgPSBlLnRvdWNoZXNbMF0ucGFnZVkgLSBzdGFydFlNb3ZlO1xuXG5cdFx0XHRcdGlmIChkaWZmID4gMCkge1xuXHRcdFx0XHRcdGlmIChuZXh0Um93ICYmIGRpZmYgLSBuZXh0Um93SGVpZ2h0TGFzdCA+IG5leHRSb3dIZWlnaHQpIHtcblx0XHRcdFx0XHRcdG1vdmVUb1JvdyA9IG5leHRSb3c7XG5cblx0XHRcdFx0XHRcdGlmIChtb3ZlVG9Sb3cgIT09IHJvdykge1xuXHRcdFx0XHRcdFx0XHRzdGFydFlNb3ZlID0gZS50b3VjaGVzWzBdLnBhZ2VZO1xuXHRcdFx0XHRcdFx0XHRtb3ZlVG9Sb3cuZ2V0RWxlbWVudCgpLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHNlbGYucGxhY2Vob2xkZXJFbGVtZW50LCBtb3ZlVG9Sb3cuZ2V0RWxlbWVudCgpLm5leHRTaWJsaW5nKTtcblx0XHRcdFx0XHRcdFx0c2VsZi5tb3ZlUm93KG1vdmVUb1JvdywgdHJ1ZSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGlmIChwcmV2Um93ICYmIC1kaWZmIC0gcHJldlJvd0hlaWdodExhc3QgPiBwcmV2Um93SGVpZ2h0KSB7XG5cdFx0XHRcdFx0XHRtb3ZlVG9Sb3cgPSBwcmV2Um93O1xuXG5cdFx0XHRcdFx0XHRpZiAobW92ZVRvUm93ICE9PSByb3cpIHtcblx0XHRcdFx0XHRcdFx0c3RhcnRZTW92ZSA9IGUudG91Y2hlc1swXS5wYWdlWTtcblx0XHRcdFx0XHRcdFx0bW92ZVRvUm93LmdldEVsZW1lbnQoKS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShzZWxmLnBsYWNlaG9sZGVyRWxlbWVudCwgbW92ZVRvUm93LmdldEVsZW1lbnQoKSk7XG5cdFx0XHRcdFx0XHRcdHNlbGYubW92ZVJvdyhtb3ZlVG9Sb3csIGZhbHNlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAobW92ZVRvUm93KSB7XG5cdFx0XHRcdFx0Y3VycmVudFJvdyA9IG1vdmVUb1Jvdztcblx0XHRcdFx0XHRuZXh0Um93ID0gbW92ZVRvUm93Lm5leHRSb3coKTtcblx0XHRcdFx0XHRuZXh0Um93SGVpZ2h0TGFzdCA9IG5leHRSb3dIZWlnaHQ7XG5cdFx0XHRcdFx0bmV4dFJvd0hlaWdodCA9IG5leHRSb3cgPyBuZXh0Um93LmdldEhlaWdodCgpIC8gMiA6IDA7XG5cdFx0XHRcdFx0cHJldlJvdyA9IG1vdmVUb1Jvdy5wcmV2Um93KCk7XG5cdFx0XHRcdFx0cHJldlJvd0hlaWdodExhc3QgPSBwcmV2Um93SGVpZ2h0O1xuXHRcdFx0XHRcdHByZXZSb3dIZWlnaHQgPSBwcmV2Um93ID8gcHJldlJvdy5nZXRIZWlnaHQoKSAvIDIgOiAwO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0aWYgKHNlbGYuY2hlY2tUaW1lb3V0KSB7XG5cdFx0XHRcdGNsZWFyVGltZW91dChzZWxmLmNoZWNrVGltZW91dCk7XG5cdFx0XHR9XG5cdFx0XHRpZiAoc2VsZi5tb3ZpbmcpIHtcblx0XHRcdFx0c2VsZi5lbmRNb3ZlKGUpO1xuXHRcdFx0XHRzZWxmLnRvdWNoTW92ZSA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdE1vdmVSb3dzLnByb3RvdHlwZS5fYmluZE1vdXNlTW92ZSA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRzZWxmLnRhYmxlLnJvd01hbmFnZXIuZ2V0RGlzcGxheVJvd3MoKS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdGlmICgocm93LnR5cGUgPT09IFwicm93XCIgfHwgcm93LnR5cGUgPT09IFwiZ3JvdXBcIikgJiYgcm93Lm1vZHVsZXMubW92ZVJvdy5tb3VzZW1vdmUpIHtcblx0XHRcdFx0cm93LmdldEVsZW1lbnQoKS5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIHJvdy5tb2R1bGVzLm1vdmVSb3cubW91c2Vtb3ZlKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHRNb3ZlUm93cy5wcm90b3R5cGUuX3VuYmluZE1vdXNlTW92ZSA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRzZWxmLnRhYmxlLnJvd01hbmFnZXIuZ2V0RGlzcGxheVJvd3MoKS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdGlmICgocm93LnR5cGUgPT09IFwicm93XCIgfHwgcm93LnR5cGUgPT09IFwiZ3JvdXBcIikgJiYgcm93Lm1vZHVsZXMubW92ZVJvdy5tb3VzZW1vdmUpIHtcblx0XHRcdFx0cm93LmdldEVsZW1lbnQoKS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIHJvdy5tb2R1bGVzLm1vdmVSb3cubW91c2Vtb3ZlKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHRNb3ZlUm93cy5wcm90b3R5cGUuc3RhcnRNb3ZlID0gZnVuY3Rpb24gKGUsIHJvdykge1xuXHRcdHZhciBlbGVtZW50ID0gcm93LmdldEVsZW1lbnQoKTtcblxuXHRcdHRoaXMuc2V0U3RhcnRQb3NpdGlvbihlLCByb3cpO1xuXG5cdFx0dGhpcy5tb3ZpbmcgPSByb3c7XG5cblx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1ibG9jay1zZWxlY3RcIik7XG5cblx0XHQvL2NyZWF0ZSBwbGFjZWhvbGRlclxuXHRcdHRoaXMucGxhY2Vob2xkZXJFbGVtZW50LnN0eWxlLndpZHRoID0gcm93LmdldFdpZHRoKCkgKyBcInB4XCI7XG5cdFx0dGhpcy5wbGFjZWhvbGRlckVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gcm93LmdldEhlaWdodCgpICsgXCJweFwiO1xuXG5cdFx0aWYgKCF0aGlzLmNvbm5lY3Rpb24pIHtcblx0XHRcdGVsZW1lbnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5wbGFjZWhvbGRlckVsZW1lbnQsIGVsZW1lbnQpO1xuXHRcdFx0ZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsZW1lbnQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1tb3Zpbmdyb3ctc2VuZGluZ1wiKTtcblx0XHRcdHRoaXMuY29ubmVjdFRvVGFibGVzKHJvdyk7XG5cdFx0fVxuXG5cdFx0Ly9jcmVhdGUgaG92ZXIgZWxlbWVudFxuXHRcdHRoaXMuaG92ZXJFbGVtZW50ID0gZWxlbWVudC5jbG9uZU5vZGUodHJ1ZSk7XG5cdFx0dGhpcy5ob3ZlckVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1tb3ZpbmdcIik7XG5cblx0XHRpZiAodGhpcy5jb25uZWN0aW9uKSB7XG5cdFx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuaG92ZXJFbGVtZW50KTtcblx0XHRcdHRoaXMuaG92ZXJFbGVtZW50LnN0eWxlLmxlZnQgPSBcIjBcIjtcblx0XHRcdHRoaXMuaG92ZXJFbGVtZW50LnN0eWxlLnRvcCA9IFwiMFwiO1xuXHRcdFx0dGhpcy5ob3ZlckVsZW1lbnQuc3R5bGUud2lkdGggPSB0aGlzLnRhYmxlLmVsZW1lbnQuY2xpZW50V2lkdGggKyBcInB4XCI7XG5cdFx0XHR0aGlzLmhvdmVyRWxlbWVudC5zdHlsZS53aGl0ZVNwYWNlID0gXCJub3dyYXBcIjtcblx0XHRcdHRoaXMuaG92ZXJFbGVtZW50LnN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcblx0XHRcdHRoaXMuaG92ZXJFbGVtZW50LnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcIm5vbmVcIjtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldFRhYmxlRWxlbWVudCgpLmFwcGVuZENoaWxkKHRoaXMuaG92ZXJFbGVtZW50KTtcblxuXHRcdFx0dGhpcy5ob3ZlckVsZW1lbnQuc3R5bGUubGVmdCA9IFwiMFwiO1xuXHRcdFx0dGhpcy5ob3ZlckVsZW1lbnQuc3R5bGUudG9wID0gXCIwXCI7XG5cblx0XHRcdHRoaXMuX2JpbmRNb3VzZU1vdmUoKTtcblx0XHR9XG5cblx0XHRkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgdGhpcy5tb3ZlSG92ZXIpO1xuXHRcdGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgdGhpcy5lbmRNb3ZlKTtcblxuXHRcdHRoaXMubW92ZUhvdmVyKGUpO1xuXHR9O1xuXG5cdE1vdmVSb3dzLnByb3RvdHlwZS5zZXRTdGFydFBvc2l0aW9uID0gZnVuY3Rpb24gKGUsIHJvdykge1xuXHRcdHZhciBwYWdlWCA9IHRoaXMudG91Y2hNb3ZlID8gZS50b3VjaGVzWzBdLnBhZ2VYIDogZS5wYWdlWCxcblx0XHQgICAgcGFnZVkgPSB0aGlzLnRvdWNoTW92ZSA/IGUudG91Y2hlc1swXS5wYWdlWSA6IGUucGFnZVksXG5cdFx0ICAgIGVsZW1lbnQsXG5cdFx0ICAgIHBvc2l0aW9uO1xuXG5cdFx0ZWxlbWVudCA9IHJvdy5nZXRFbGVtZW50KCk7XG5cdFx0aWYgKHRoaXMuY29ubmVjdGlvbikge1xuXHRcdFx0cG9zaXRpb24gPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG5cdFx0XHR0aGlzLnN0YXJ0WCA9IHBvc2l0aW9uLmxlZnQgLSBwYWdlWCArIHdpbmRvdy5wYWdlWE9mZnNldDtcblx0XHRcdHRoaXMuc3RhcnRZID0gcG9zaXRpb24udG9wIC0gcGFnZVkgKyB3aW5kb3cucGFnZVlPZmZzZXQ7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuc3RhcnRZID0gcGFnZVkgLSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcblx0XHR9XG5cdH07XG5cblx0TW92ZVJvd3MucHJvdG90eXBlLmVuZE1vdmUgPSBmdW5jdGlvbiAoZSkge1xuXHRcdGlmICghZSB8fCBlLndoaWNoID09PSAxIHx8IHRoaXMudG91Y2hNb3ZlKSB7XG5cdFx0XHR0aGlzLl91bmJpbmRNb3VzZU1vdmUoKTtcblxuXHRcdFx0aWYgKCF0aGlzLmNvbm5lY3Rpb24pIHtcblx0XHRcdFx0dGhpcy5wbGFjZWhvbGRlckVsZW1lbnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5tb3ZpbmcuZ2V0RWxlbWVudCgpLCB0aGlzLnBsYWNlaG9sZGVyRWxlbWVudC5uZXh0U2libGluZyk7XG5cdFx0XHRcdHRoaXMucGxhY2Vob2xkZXJFbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5wbGFjZWhvbGRlckVsZW1lbnQpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmhvdmVyRWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuaG92ZXJFbGVtZW50KTtcblxuXHRcdFx0dGhpcy50YWJsZS5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItYmxvY2stc2VsZWN0XCIpO1xuXG5cdFx0XHRpZiAodGhpcy50b1Jvdykge1xuXHRcdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIubW92ZVJvdyh0aGlzLm1vdmluZywgdGhpcy50b1JvdywgdGhpcy50b1Jvd0FmdGVyKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5tb3ZpbmcgPSBmYWxzZTtcblx0XHRcdHRoaXMudG9Sb3cgPSBmYWxzZTtcblx0XHRcdHRoaXMudG9Sb3dBZnRlciA9IGZhbHNlO1xuXG5cdFx0XHRkb2N1bWVudC5ib2R5LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgdGhpcy5tb3ZlSG92ZXIpO1xuXHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCB0aGlzLmVuZE1vdmUpO1xuXG5cdFx0XHRpZiAodGhpcy5jb25uZWN0aW9uKSB7XG5cdFx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLW1vdmluZ3Jvdy1zZW5kaW5nXCIpO1xuXHRcdFx0XHR0aGlzLmRpc2Nvbm5lY3RGcm9tVGFibGVzKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdE1vdmVSb3dzLnByb3RvdHlwZS5tb3ZlUm93ID0gZnVuY3Rpb24gKHJvdywgYWZ0ZXIpIHtcblx0XHR0aGlzLnRvUm93ID0gcm93O1xuXHRcdHRoaXMudG9Sb3dBZnRlciA9IGFmdGVyO1xuXHR9O1xuXG5cdE1vdmVSb3dzLnByb3RvdHlwZS5tb3ZlSG92ZXIgPSBmdW5jdGlvbiAoZSkge1xuXHRcdGlmICh0aGlzLmNvbm5lY3Rpb24pIHtcblx0XHRcdHRoaXMubW92ZUhvdmVyQ29ubmVjdGlvbnMuY2FsbCh0aGlzLCBlKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5tb3ZlSG92ZXJUYWJsZS5jYWxsKHRoaXMsIGUpO1xuXHRcdH1cblx0fTtcblxuXHRNb3ZlUm93cy5wcm90b3R5cGUubW92ZUhvdmVyVGFibGUgPSBmdW5jdGlvbiAoZSkge1xuXHRcdHZhciByb3dIb2xkZXIgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0RWxlbWVudCgpLFxuXHRcdCAgICBzY3JvbGxUb3AgPSByb3dIb2xkZXIuc2Nyb2xsVG9wLFxuXHRcdCAgICB5UG9zID0gKHRoaXMudG91Y2hNb3ZlID8gZS50b3VjaGVzWzBdLnBhZ2VZIDogZS5wYWdlWSkgLSByb3dIb2xkZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wICsgc2Nyb2xsVG9wLFxuXHRcdCAgICBzY3JvbGxQb3M7XG5cblx0XHR0aGlzLmhvdmVyRWxlbWVudC5zdHlsZS50b3AgPSB5UG9zIC0gdGhpcy5zdGFydFkgKyBcInB4XCI7XG5cdH07XG5cblx0TW92ZVJvd3MucHJvdG90eXBlLm1vdmVIb3ZlckNvbm5lY3Rpb25zID0gZnVuY3Rpb24gKGUpIHtcblx0XHR0aGlzLmhvdmVyRWxlbWVudC5zdHlsZS5sZWZ0ID0gdGhpcy5zdGFydFggKyAodGhpcy50b3VjaE1vdmUgPyBlLnRvdWNoZXNbMF0ucGFnZVggOiBlLnBhZ2VYKSArIFwicHhcIjtcblx0XHR0aGlzLmhvdmVyRWxlbWVudC5zdHlsZS50b3AgPSB0aGlzLnN0YXJ0WSArICh0aGlzLnRvdWNoTW92ZSA/IGUudG91Y2hlc1swXS5wYWdlWSA6IGUucGFnZVkpICsgXCJweFwiO1xuXHR9O1xuXG5cdE1vdmVSb3dzLnByb3RvdHlwZS5lbGVtZW50Um93RHJvcCA9IGZ1bmN0aW9uIChlLCBlbGVtZW50LCByb3cpIHtcblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLm1vdmFibGVSb3dzRWxlbWVudERyb3ApIHtcblx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93c0VsZW1lbnREcm9wKGUsIGVsZW1lbnQsIHJvdyA/IHJvdy5nZXRDb21wb25lbnQoKSA6IGZhbHNlKTtcblx0XHR9XG5cdH07XG5cblx0Ly9lc3RhYmxpc2ggY29ubmVjdGlvbiB3aXRoIG90aGVyIHRhYmxlc1xuXHRNb3ZlUm93cy5wcm90b3R5cGUuY29ubmVjdFRvVGFibGVzID0gZnVuY3Rpb24gKHJvdykge1xuXHRcdHZhciBfdGhpczY2ID0gdGhpcztcblxuXHRcdHZhciBjb25uZWN0aW9uVGFibGVzO1xuXG5cdFx0aWYgKHRoaXMuY29ubmVjdGlvblNlbGVjdG9yc1RhYmxlcykge1xuXHRcdFx0Y29ubmVjdGlvblRhYmxlcyA9IHRoaXMudGFibGUubW9kdWxlcy5jb21tcy5nZXRDb25uZWN0aW9ucyh0aGlzLmNvbm5lY3Rpb25TZWxlY3RvcnNUYWJsZXMpO1xuXG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3NTZW5kaW5nU3RhcnQuY2FsbCh0aGlzLnRhYmxlLCBjb25uZWN0aW9uVGFibGVzKTtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmNvbW1zLnNlbmQodGhpcy5jb25uZWN0aW9uU2VsZWN0b3JzVGFibGVzLCBcIm1vdmVSb3dcIiwgXCJjb25uZWN0XCIsIHtcblx0XHRcdFx0cm93OiByb3dcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLmNvbm5lY3Rpb25TZWxlY3RvcnNFbGVtZW50cykge1xuXG5cdFx0XHR0aGlzLmNvbm5lY3Rpb25FbGVtZW50cyA9IFtdO1xuXG5cdFx0XHRpZiAoIUFycmF5LmlzQXJyYXkodGhpcy5jb25uZWN0aW9uU2VsZWN0b3JzRWxlbWVudHMpKSB7XG5cdFx0XHRcdHRoaXMuY29ubmVjdGlvblNlbGVjdG9yc0VsZW1lbnRzID0gW3RoaXMuY29ubmVjdGlvblNlbGVjdG9yc0VsZW1lbnRzXTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5jb25uZWN0aW9uU2VsZWN0b3JzRWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbiAocXVlcnkpIHtcblx0XHRcdFx0aWYgKHR5cGVvZiBxdWVyeSA9PT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHRcdF90aGlzNjYuY29ubmVjdGlvbkVsZW1lbnRzID0gX3RoaXM2Ni5jb25uZWN0aW9uRWxlbWVudHMuY29uY2F0KEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwocXVlcnkpKSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0X3RoaXM2Ni5jb25uZWN0aW9uRWxlbWVudHMucHVzaChxdWVyeSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLmNvbm5lY3Rpb25FbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7XG5cdFx0XHRcdHZhciBkcm9wRXZlbnQgPSBmdW5jdGlvbiBkcm9wRXZlbnQoZSkge1xuXHRcdFx0XHRcdF90aGlzNjYuZWxlbWVudFJvd0Ryb3AoZSwgZWxlbWVudCwgX3RoaXM2Ni5tb3ZpbmcpO1xuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZHJvcEV2ZW50KTtcblx0XHRcdFx0ZWxlbWVudC50YWJ1bGF0b3JFbGVtZW50RHJvcEV2ZW50ID0gZHJvcEV2ZW50O1xuXG5cdFx0XHRcdGVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1tb3Zpbmdyb3ctcmVjZWl2aW5nXCIpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vZGlzY29ubmVjdCBmcm9tIG90aGVyIHRhYmxlc1xuXHRNb3ZlUm93cy5wcm90b3R5cGUuZGlzY29ubmVjdEZyb21UYWJsZXMgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIGNvbm5lY3Rpb25UYWJsZXM7XG5cblx0XHRpZiAodGhpcy5jb25uZWN0aW9uU2VsZWN0b3JzVGFibGVzKSB7XG5cdFx0XHRjb25uZWN0aW9uVGFibGVzID0gdGhpcy50YWJsZS5tb2R1bGVzLmNvbW1zLmdldENvbm5lY3Rpb25zKHRoaXMuY29ubmVjdGlvblNlbGVjdG9yc1RhYmxlcyk7XG5cblx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93c1NlbmRpbmdTdG9wLmNhbGwodGhpcy50YWJsZSwgY29ubmVjdGlvblRhYmxlcyk7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5jb21tcy5zZW5kKHRoaXMuY29ubmVjdGlvblNlbGVjdG9yc1RhYmxlcywgXCJtb3ZlUm93XCIsIFwiZGlzY29ubmVjdFwiKTtcblx0XHR9XG5cblx0XHR0aGlzLmNvbm5lY3Rpb25FbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7XG5cdFx0XHRlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItbW92aW5ncm93LXJlY2VpdmluZ1wiKTtcblx0XHRcdGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZWxlbWVudC50YWJ1bGF0b3JFbGVtZW50RHJvcEV2ZW50KTtcblx0XHRcdGRlbGV0ZSBlbGVtZW50LnRhYnVsYXRvckVsZW1lbnREcm9wRXZlbnQ7XG5cdFx0fSk7XG5cdH07XG5cblx0Ly9hY2NlcHQgaW5jb21taW5nIGNvbm5lY3Rpb25cblx0TW92ZVJvd3MucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiAodGFibGUsIHJvdykge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblx0XHRpZiAoIXRoaXMuY29ubmVjdGVkVGFibGUpIHtcblx0XHRcdHRoaXMuY29ubmVjdGVkVGFibGUgPSB0YWJsZTtcblx0XHRcdHRoaXMuY29ubmVjdGVkUm93ID0gcm93O1xuXG5cdFx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1tb3Zpbmdyb3ctcmVjZWl2aW5nXCIpO1xuXG5cdFx0XHRzZWxmLnRhYmxlLnJvd01hbmFnZXIuZ2V0RGlzcGxheVJvd3MoKS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0aWYgKHJvdy50eXBlID09PSBcInJvd1wiICYmIHJvdy5tb2R1bGVzLm1vdmVSb3cgJiYgcm93Lm1vZHVsZXMubW92ZVJvdy5tb3VzZXVwKSB7XG5cdFx0XHRcdFx0cm93LmdldEVsZW1lbnQoKS5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCByb3cubW9kdWxlcy5tb3ZlUm93Lm1vdXNldXApO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0c2VsZi50YWJsZVJvd0Ryb3BFdmVudCA9IHNlbGYudGFibGVSb3dEcm9wLmJpbmQoc2VsZik7XG5cblx0XHRcdHNlbGYudGFibGUuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBzZWxmLnRhYmxlUm93RHJvcEV2ZW50KTtcblxuXHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLm1vdmFibGVSb3dzUmVjZWl2aW5nU3RhcnQuY2FsbCh0aGlzLnRhYmxlLCByb3csIHRhYmxlKTtcblxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIk1vdmUgUm93IEVycm9yIC0gVGFibGUgY2Fubm90IGFjY2VwdCBjb25uZWN0aW9uLCBhbHJlYWR5IGNvbm5lY3RlZCB0byB0YWJsZTpcIiwgdGhpcy5jb25uZWN0ZWRUYWJsZSk7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdC8vY2xvc2UgaW5jb21taW5nIGNvbm5lY3Rpb25cblx0TW92ZVJvd3MucHJvdG90eXBlLmRpc2Nvbm5lY3QgPSBmdW5jdGlvbiAodGFibGUpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cdFx0aWYgKHRhYmxlID09PSB0aGlzLmNvbm5lY3RlZFRhYmxlKSB7XG5cdFx0XHR0aGlzLmNvbm5lY3RlZFRhYmxlID0gZmFsc2U7XG5cdFx0XHR0aGlzLmNvbm5lY3RlZFJvdyA9IGZhbHNlO1xuXG5cdFx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcInRhYnVsYXRvci1tb3Zpbmdyb3ctcmVjZWl2aW5nXCIpO1xuXG5cdFx0XHRzZWxmLnRhYmxlLnJvd01hbmFnZXIuZ2V0RGlzcGxheVJvd3MoKS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0aWYgKHJvdy50eXBlID09PSBcInJvd1wiICYmIHJvdy5tb2R1bGVzLm1vdmVSb3cgJiYgcm93Lm1vZHVsZXMubW92ZVJvdy5tb3VzZXVwKSB7XG5cdFx0XHRcdFx0cm93LmdldEVsZW1lbnQoKS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCByb3cubW9kdWxlcy5tb3ZlUm93Lm1vdXNldXApO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0c2VsZi50YWJsZS5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIHNlbGYudGFibGVSb3dEcm9wRXZlbnQpO1xuXG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3NSZWNlaXZpbmdTdG9wLmNhbGwodGhpcy50YWJsZSwgdGFibGUpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJNb3ZlIFJvdyBFcnJvciAtIHRyeWluZyB0byBkaXNjb25uZWN0IGZyb20gbm9uIGNvbm5lY3RlZCB0YWJsZVwiKTtcblx0XHR9XG5cdH07XG5cblx0TW92ZVJvd3MucHJvdG90eXBlLmRyb3BDb21wbGV0ZSA9IGZ1bmN0aW9uICh0YWJsZSwgcm93LCBzdWNjZXNzKSB7XG5cdFx0dmFyIHNlbmRlciA9IGZhbHNlO1xuXG5cdFx0aWYgKHN1Y2Nlc3MpIHtcblxuXHRcdFx0c3dpdGNoIChfdHlwZW9mKHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93c1NlbmRlcikpIHtcblx0XHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHRcdHNlbmRlciA9IHRoaXMuc2VuZGVyc1t0aGlzLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3NTZW5kZXJdO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgXCJmdW5jdGlvblwiOlxuXHRcdFx0XHRcdHNlbmRlciA9IHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93c1NlbmRlcjtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdH1cblxuXHRcdFx0aWYgKHNlbmRlcikge1xuXHRcdFx0XHRzZW5kZXIuY2FsbCh0aGlzLCB0aGlzLm1vdmluZy5nZXRDb21wb25lbnQoKSwgcm93ID8gcm93LmdldENvbXBvbmVudCgpIDogdW5kZWZpbmVkLCB0YWJsZSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLm1vdmFibGVSb3dzU2VuZGVyKSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiTW92ZXIgUm93IEVycm9yIC0gbm8gbWF0Y2hpbmcgc2VuZGVyIGZvdW5kOlwiLCB0aGlzLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3NTZW5kZXIpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93c1NlbnQuY2FsbCh0aGlzLnRhYmxlLCB0aGlzLm1vdmluZy5nZXRDb21wb25lbnQoKSwgcm93ID8gcm93LmdldENvbXBvbmVudCgpIDogdW5kZWZpbmVkLCB0YWJsZSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93c1NlbnRGYWlsZWQuY2FsbCh0aGlzLnRhYmxlLCB0aGlzLm1vdmluZy5nZXRDb21wb25lbnQoKSwgcm93ID8gcm93LmdldENvbXBvbmVudCgpIDogdW5kZWZpbmVkLCB0YWJsZSk7XG5cdFx0fVxuXG5cdFx0dGhpcy5lbmRNb3ZlKCk7XG5cdH07XG5cblx0TW92ZVJvd3MucHJvdG90eXBlLnRhYmxlUm93RHJvcCA9IGZ1bmN0aW9uIChlLCByb3cpIHtcblx0XHR2YXIgcmVjZWl2ZXIgPSBmYWxzZSxcblx0XHQgICAgc3VjY2VzcyA9IGZhbHNlO1xuXG5cdFx0Y29uc29sZS50cmFjZShcImRyb3BcIik7XG5cblx0XHRlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXG5cdFx0c3dpdGNoIChfdHlwZW9mKHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93c1JlY2VpdmVyKSkge1xuXHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHRyZWNlaXZlciA9IHRoaXMucmVjZWl2ZXJzW3RoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93c1JlY2VpdmVyXTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJmdW5jdGlvblwiOlxuXHRcdFx0XHRyZWNlaXZlciA9IHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93c1JlY2VpdmVyO1xuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cblx0XHRpZiAocmVjZWl2ZXIpIHtcblx0XHRcdHN1Y2Nlc3MgPSByZWNlaXZlci5jYWxsKHRoaXMsIHRoaXMuY29ubmVjdGVkUm93LmdldENvbXBvbmVudCgpLCByb3cgPyByb3cuZ2V0Q29tcG9uZW50KCkgOiB1bmRlZmluZWQsIHRoaXMuY29ubmVjdGVkVGFibGUpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJNb3ZlciBSb3cgRXJyb3IgLSBubyBtYXRjaGluZyByZWNlaXZlciBmb3VuZDpcIiwgdGhpcy50YWJsZS5vcHRpb25zLm1vdmFibGVSb3dzUmVjZWl2ZXIpO1xuXHRcdH1cblxuXHRcdGlmIChzdWNjZXNzKSB7XG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3NSZWNlaXZlZC5jYWxsKHRoaXMudGFibGUsIHRoaXMuY29ubmVjdGVkUm93LmdldENvbXBvbmVudCgpLCByb3cgPyByb3cuZ2V0Q29tcG9uZW50KCkgOiB1bmRlZmluZWQsIHRoaXMuY29ubmVjdGVkVGFibGUpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3NSZWNlaXZlZEZhaWxlZC5jYWxsKHRoaXMudGFibGUsIHRoaXMuY29ubmVjdGVkUm93LmdldENvbXBvbmVudCgpLCByb3cgPyByb3cuZ2V0Q29tcG9uZW50KCkgOiB1bmRlZmluZWQsIHRoaXMuY29ubmVjdGVkVGFibGUpO1xuXHRcdH1cblxuXHRcdHRoaXMudGFibGUubW9kdWxlcy5jb21tcy5zZW5kKHRoaXMuY29ubmVjdGVkVGFibGUsIFwibW92ZVJvd1wiLCBcImRyb3Bjb21wbGV0ZVwiLCB7XG5cdFx0XHRyb3c6IHJvdyxcblx0XHRcdHN1Y2Nlc3M6IHN1Y2Nlc3Ncblx0XHR9KTtcblx0fTtcblxuXHRNb3ZlUm93cy5wcm90b3R5cGUucmVjZWl2ZXJzID0ge1xuXHRcdGluc2VydDogZnVuY3Rpb24gaW5zZXJ0KGZyb21Sb3csIHRvUm93LCBmcm9tVGFibGUpIHtcblx0XHRcdHRoaXMudGFibGUuYWRkUm93KGZyb21Sb3cuZ2V0RGF0YSgpLCB1bmRlZmluZWQsIHRvUm93KTtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH0sXG5cblx0XHRhZGQ6IGZ1bmN0aW9uIGFkZChmcm9tUm93LCB0b1JvdywgZnJvbVRhYmxlKSB7XG5cdFx0XHR0aGlzLnRhYmxlLmFkZFJvdyhmcm9tUm93LmdldERhdGEoKSk7XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9LFxuXG5cdFx0dXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUoZnJvbVJvdywgdG9Sb3csIGZyb21UYWJsZSkge1xuXHRcdFx0aWYgKHRvUm93KSB7XG5cdFx0XHRcdHRvUm93LnVwZGF0ZShmcm9tUm93LmdldERhdGEoKSk7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fSxcblxuXHRcdHJlcGxhY2U6IGZ1bmN0aW9uIHJlcGxhY2UoZnJvbVJvdywgdG9Sb3csIGZyb21UYWJsZSkge1xuXHRcdFx0aWYgKHRvUm93KSB7XG5cdFx0XHRcdHRoaXMudGFibGUuYWRkUm93KGZyb21Sb3cuZ2V0RGF0YSgpLCB1bmRlZmluZWQsIHRvUm93KTtcblx0XHRcdFx0dG9Sb3cuZGVsZXRlKCk7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdE1vdmVSb3dzLnByb3RvdHlwZS5zZW5kZXJzID0ge1xuXHRcdGRlbGV0ZTogZnVuY3Rpb24gX2RlbGV0ZShmcm9tUm93LCB0b1JvdywgdG9UYWJsZSkge1xuXHRcdFx0ZnJvbVJvdy5kZWxldGUoKTtcblx0XHR9XG5cdH07XG5cblx0TW92ZVJvd3MucHJvdG90eXBlLmNvbW1zUmVjZWl2ZWQgPSBmdW5jdGlvbiAodGFibGUsIGFjdGlvbiwgZGF0YSkge1xuXHRcdHN3aXRjaCAoYWN0aW9uKSB7XG5cdFx0XHRjYXNlIFwiY29ubmVjdFwiOlxuXHRcdFx0XHRyZXR1cm4gdGhpcy5jb25uZWN0KHRhYmxlLCBkYXRhLnJvdyk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiZGlzY29ubmVjdFwiOlxuXHRcdFx0XHRyZXR1cm4gdGhpcy5kaXNjb25uZWN0KHRhYmxlKTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJkcm9wY29tcGxldGVcIjpcblx0XHRcdFx0cmV0dXJuIHRoaXMuZHJvcENvbXBsZXRlKHRhYmxlLCBkYXRhLnJvdywgZGF0YS5zdWNjZXNzKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJtb3ZlUm93XCIsIE1vdmVSb3dzKTtcblx0dmFyIE11dGF0b3IgPSBmdW5jdGlvbiBNdXRhdG9yKHRhYmxlKSB7XG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlOyAvL2hvbGQgVGFidWxhdG9yIG9iamVjdFxuXHRcdHRoaXMuYWxsb3dlZFR5cGVzID0gW1wiXCIsIFwiZGF0YVwiLCBcImVkaXRcIiwgXCJjbGlwYm9hcmRcIl07IC8vbGlzdCBvZiBtdWF0YXRpb24gdHlwZXNcblx0XHR0aGlzLmVuYWJsZWQgPSB0cnVlO1xuXHR9O1xuXG5cdC8vaW5pdGlhbGl6ZSBjb2x1bW4gbXV0YXRvclxuXHRNdXRhdG9yLnByb3RvdHlwZS5pbml0aWFsaXplQ29sdW1uID0gZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgbWF0Y2ggPSBmYWxzZSxcblx0XHQgICAgY29uZmlnID0ge307XG5cblx0XHR0aGlzLmFsbG93ZWRUeXBlcy5mb3JFYWNoKGZ1bmN0aW9uICh0eXBlKSB7XG5cdFx0XHR2YXIga2V5ID0gXCJtdXRhdG9yXCIgKyAodHlwZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHR5cGUuc2xpY2UoMSkpLFxuXHRcdFx0ICAgIG11dGF0b3I7XG5cblx0XHRcdGlmIChjb2x1bW4uZGVmaW5pdGlvbltrZXldKSB7XG5cdFx0XHRcdG11dGF0b3IgPSBzZWxmLmxvb2t1cE11dGF0b3IoY29sdW1uLmRlZmluaXRpb25ba2V5XSk7XG5cblx0XHRcdFx0aWYgKG11dGF0b3IpIHtcblx0XHRcdFx0XHRtYXRjaCA9IHRydWU7XG5cblx0XHRcdFx0XHRjb25maWdba2V5XSA9IHtcblx0XHRcdFx0XHRcdG11dGF0b3I6IG11dGF0b3IsXG5cdFx0XHRcdFx0XHRwYXJhbXM6IGNvbHVtbi5kZWZpbml0aW9uW2tleSArIFwiUGFyYW1zXCJdIHx8IHt9XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0aWYgKG1hdGNoKSB7XG5cdFx0XHRjb2x1bW4ubW9kdWxlcy5tdXRhdGUgPSBjb25maWc7XG5cdFx0fVxuXHR9O1xuXG5cdE11dGF0b3IucHJvdG90eXBlLmxvb2t1cE11dGF0b3IgPSBmdW5jdGlvbiAodmFsdWUpIHtcblx0XHR2YXIgbXV0YXRvciA9IGZhbHNlO1xuXG5cdFx0Ly9zZXQgY29sdW1uIG11dGF0b3Jcblx0XHRzd2l0Y2ggKHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YodmFsdWUpKSB7XG5cdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdGlmICh0aGlzLm11dGF0b3JzW3ZhbHVlXSkge1xuXHRcdFx0XHRcdG11dGF0b3IgPSB0aGlzLm11dGF0b3JzW3ZhbHVlXTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJNdXRhdG9yIEVycm9yIC0gTm8gc3VjaCBtdXRhdG9yIGZvdW5kLCBpZ25vcmluZzogXCIsIHZhbHVlKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcImZ1bmN0aW9uXCI6XG5cdFx0XHRcdG11dGF0b3IgPSB2YWx1ZTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG11dGF0b3I7XG5cdH07XG5cblx0Ly9hcHBseSBtdXRhdG9yIHRvIHJvd1xuXHRNdXRhdG9yLnByb3RvdHlwZS50cmFuc2Zvcm1Sb3cgPSBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgdXBkYXRlZERhdGEpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGtleSA9IFwibXV0YXRvclwiICsgKHR5cGUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0eXBlLnNsaWNlKDEpKSxcblx0XHQgICAgdmFsdWU7XG5cblx0XHRpZiAodGhpcy5lbmFibGVkKSB7XG5cblx0XHRcdHNlbGYudGFibGUuY29sdW1uTWFuYWdlci50cmF2ZXJzZShmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0XHRcdHZhciBtdXRhdG9yLCBwYXJhbXMsIGNvbXBvbmVudDtcblxuXHRcdFx0XHRpZiAoY29sdW1uLm1vZHVsZXMubXV0YXRlKSB7XG5cdFx0XHRcdFx0bXV0YXRvciA9IGNvbHVtbi5tb2R1bGVzLm11dGF0ZVtrZXldIHx8IGNvbHVtbi5tb2R1bGVzLm11dGF0ZS5tdXRhdG9yIHx8IGZhbHNlO1xuXG5cdFx0XHRcdFx0aWYgKG11dGF0b3IpIHtcblx0XHRcdFx0XHRcdHZhbHVlID0gY29sdW1uLmdldEZpZWxkVmFsdWUodHlwZW9mIHVwZGF0ZWREYXRhICE9PSBcInVuZGVmaW5lZFwiID8gdXBkYXRlZERhdGEgOiBkYXRhKTtcblxuXHRcdFx0XHRcdFx0aWYgKHR5cGUgPT0gXCJkYXRhXCIgfHwgdHlwZW9mIHZhbHVlICE9PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdFx0XHRcdGNvbXBvbmVudCA9IGNvbHVtbi5nZXRDb21wb25lbnQoKTtcblx0XHRcdFx0XHRcdFx0cGFyYW1zID0gdHlwZW9mIG11dGF0b3IucGFyYW1zID09PSBcImZ1bmN0aW9uXCIgPyBtdXRhdG9yLnBhcmFtcyh2YWx1ZSwgZGF0YSwgdHlwZSwgY29tcG9uZW50KSA6IG11dGF0b3IucGFyYW1zO1xuXHRcdFx0XHRcdFx0XHRjb2x1bW4uc2V0RmllbGRWYWx1ZShkYXRhLCBtdXRhdG9yLm11dGF0b3IodmFsdWUsIGRhdGEsIHR5cGUsIHBhcmFtcywgY29tcG9uZW50KSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZGF0YTtcblx0fTtcblxuXHQvL2FwcGx5IG11dGF0b3IgdG8gbmV3IGNlbGwgdmFsdWVcblx0TXV0YXRvci5wcm90b3R5cGUudHJhbnNmb3JtQ2VsbCA9IGZ1bmN0aW9uIChjZWxsLCB2YWx1ZSkge1xuXHRcdHZhciBtdXRhdG9yID0gY2VsbC5jb2x1bW4ubW9kdWxlcy5tdXRhdGUubXV0YXRvckVkaXQgfHwgY2VsbC5jb2x1bW4ubW9kdWxlcy5tdXRhdGUubXV0YXRvciB8fCBmYWxzZSxcblx0XHQgICAgdGVtcERhdGEgPSB7fTtcblxuXHRcdGlmIChtdXRhdG9yKSB7XG5cdFx0XHR0ZW1wRGF0YSA9IE9iamVjdC5hc3NpZ24odGVtcERhdGEsIGNlbGwucm93LmdldERhdGEoKSk7XG5cdFx0XHRjZWxsLmNvbHVtbi5zZXRGaWVsZFZhbHVlKHRlbXBEYXRhLCB2YWx1ZSk7XG5cdFx0XHRyZXR1cm4gbXV0YXRvci5tdXRhdG9yKHZhbHVlLCB0ZW1wRGF0YSwgXCJlZGl0XCIsIG11dGF0b3IucGFyYW1zLCBjZWxsLmdldENvbXBvbmVudCgpKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdH1cblx0fTtcblxuXHRNdXRhdG9yLnByb3RvdHlwZS5lbmFibGUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy5lbmFibGVkID0gdHJ1ZTtcblx0fTtcblxuXHRNdXRhdG9yLnByb3RvdHlwZS5kaXNhYmxlID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMuZW5hYmxlZCA9IGZhbHNlO1xuXHR9O1xuXG5cdC8vZGVmYXVsdCBtdXRhdG9yc1xuXHRNdXRhdG9yLnByb3RvdHlwZS5tdXRhdG9ycyA9IHt9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJtdXRhdG9yXCIsIE11dGF0b3IpO1xuXHR2YXIgUGFnZSA9IGZ1bmN0aW9uIFBhZ2UodGFibGUpIHtcblxuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIFRhYnVsYXRvciBvYmplY3RcblxuXHRcdHRoaXMubW9kZSA9IFwibG9jYWxcIjtcblx0XHR0aGlzLnByb2dyZXNzaXZlTG9hZCA9IGZhbHNlO1xuXG5cdFx0dGhpcy5zaXplID0gMDtcblx0XHR0aGlzLnBhZ2UgPSAxO1xuXHRcdHRoaXMuY291bnQgPSA1O1xuXHRcdHRoaXMubWF4ID0gMTtcblxuXHRcdHRoaXMuZGlzcGxheUluZGV4ID0gMDsgLy9pbmRleCBpbiBkaXNwbGF5IHBpcGVsaW5lXG5cblx0XHR0aGlzLmluaXRpYWxMb2FkID0gdHJ1ZTtcblxuXHRcdHRoaXMucGFnZVNpemVzID0gW107XG5cblx0XHR0aGlzLmRhdGFSZWNlaXZlZE5hbWVzID0ge307XG5cdFx0dGhpcy5kYXRhU2VudE5hbWVzID0ge307XG5cblx0XHR0aGlzLmNyZWF0ZUVsZW1lbnRzKCk7XG5cdH07XG5cblx0UGFnZS5wcm90b3R5cGUuY3JlYXRlRWxlbWVudHMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgYnV0dG9uO1xuXG5cdFx0dGhpcy5lbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG5cdFx0dGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItcGFnaW5hdG9yXCIpO1xuXG5cdFx0dGhpcy5wYWdlc0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcblx0XHR0aGlzLnBhZ2VzRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXBhZ2VzXCIpO1xuXG5cdFx0YnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcblx0XHRidXR0b24uY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wYWdlXCIpO1xuXHRcdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwiYnV0dG9uXCIpO1xuXHRcdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwiYnV0dG9uXCIpO1xuXHRcdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIFwiXCIpO1xuXHRcdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCBcIlwiKTtcblxuXHRcdHRoaXMuZmlyc3RCdXQgPSBidXR0b24uY2xvbmVOb2RlKHRydWUpO1xuXHRcdHRoaXMuZmlyc3RCdXQuc2V0QXR0cmlidXRlKFwiZGF0YS1wYWdlXCIsIFwiZmlyc3RcIik7XG5cblx0XHR0aGlzLnByZXZCdXQgPSBidXR0b24uY2xvbmVOb2RlKHRydWUpO1xuXHRcdHRoaXMucHJldkJ1dC5zZXRBdHRyaWJ1dGUoXCJkYXRhLXBhZ2VcIiwgXCJwcmV2XCIpO1xuXG5cdFx0dGhpcy5uZXh0QnV0ID0gYnV0dG9uLmNsb25lTm9kZSh0cnVlKTtcblx0XHR0aGlzLm5leHRCdXQuc2V0QXR0cmlidXRlKFwiZGF0YS1wYWdlXCIsIFwibmV4dFwiKTtcblxuXHRcdHRoaXMubGFzdEJ1dCA9IGJ1dHRvbi5jbG9uZU5vZGUodHJ1ZSk7XG5cdFx0dGhpcy5sYXN0QnV0LnNldEF0dHJpYnV0ZShcImRhdGEtcGFnZVwiLCBcImxhc3RcIik7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25TaXplU2VsZWN0b3IpIHtcblx0XHRcdHRoaXMucGFnZVNpemVTZWxlY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2VsZWN0XCIpO1xuXHRcdFx0dGhpcy5wYWdlU2l6ZVNlbGVjdC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXBhZ2Utc2l6ZVwiKTtcblx0XHR9XG5cdH07XG5cblx0UGFnZS5wcm90b3R5cGUuZ2VuZXJhdGVQYWdlU2l6ZVNlbGVjdExpc3QgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIF90aGlzNjcgPSB0aGlzO1xuXG5cdFx0dmFyIHBhZ2VTaXplcyA9IFtdO1xuXG5cdFx0aWYgKHRoaXMucGFnZVNpemVTZWxlY3QpIHtcblxuXHRcdFx0aWYgKEFycmF5LmlzQXJyYXkodGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25TaXplU2VsZWN0b3IpKSB7XG5cdFx0XHRcdHBhZ2VTaXplcyA9IHRoaXMudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uU2l6ZVNlbGVjdG9yO1xuXHRcdFx0XHR0aGlzLnBhZ2VTaXplcyA9IHBhZ2VTaXplcztcblxuXHRcdFx0XHRpZiAodGhpcy5wYWdlU2l6ZXMuaW5kZXhPZih0aGlzLnNpemUpID09IC0xKSB7XG5cdFx0XHRcdFx0cGFnZVNpemVzLnVuc2hpZnQodGhpcy5zaXplKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRpZiAodGhpcy5wYWdlU2l6ZXMuaW5kZXhPZih0aGlzLnNpemUpID09IC0xKSB7XG5cdFx0XHRcdFx0cGFnZVNpemVzID0gW107XG5cblx0XHRcdFx0XHRmb3IgKHZhciBfaTkgPSAxOyBfaTkgPCA1OyBfaTkrKykge1xuXHRcdFx0XHRcdFx0cGFnZVNpemVzLnB1c2godGhpcy5zaXplICogX2k5KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHR0aGlzLnBhZ2VTaXplcyA9IHBhZ2VTaXplcztcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRwYWdlU2l6ZXMgPSB0aGlzLnBhZ2VTaXplcztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHR3aGlsZSAodGhpcy5wYWdlU2l6ZVNlbGVjdC5maXJzdENoaWxkKSB7XG5cdFx0XHRcdHRoaXMucGFnZVNpemVTZWxlY3QucmVtb3ZlQ2hpbGQodGhpcy5wYWdlU2l6ZVNlbGVjdC5maXJzdENoaWxkKTtcblx0XHRcdH1wYWdlU2l6ZXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0XHR2YXIgaXRlbUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcblx0XHRcdFx0aXRlbUVsLnZhbHVlID0gaXRlbTtcblxuXHRcdFx0XHRpZiAoaXRlbSA9PT0gdHJ1ZSkge1xuXHRcdFx0XHRcdF90aGlzNjcudGFibGUubW9kdWxlcy5sb2NhbGl6ZS5iaW5kKFwicGFnaW5hdGlvbnxhbGxcIiwgZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0XHRcdFx0XHRpdGVtRWwuaW5uZXJIVE1MID0gdmFsdWU7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aXRlbUVsLmlubmVySFRNTCA9IGl0ZW07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRfdGhpczY3LnBhZ2VTaXplU2VsZWN0LmFwcGVuZENoaWxkKGl0ZW1FbCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5wYWdlU2l6ZVNlbGVjdC52YWx1ZSA9IHRoaXMuc2l6ZTtcblx0XHR9XG5cdH07XG5cblx0Ly9zZXR1cCBwYWdlaW5hdGlvblxuXHRQYWdlLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKGhpZGRlbikge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgcGFnZVNlbGVjdExhYmVsLFxuXHRcdCAgICB0ZXN0RWxSb3csXG5cdFx0ICAgIHRlc3RFbENlbGw7XG5cblx0XHQvL3VwZGF0ZSBwYXJhbSBuYW1lc1xuXHRcdHRoaXMuZGF0YVNlbnROYW1lcyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMucGFnaW5hdGlvbkRhdGFTZW50TmFtZXMpO1xuXHRcdHRoaXMuZGF0YVNlbnROYW1lcyA9IE9iamVjdC5hc3NpZ24odGhpcy5kYXRhU2VudE5hbWVzLCB0aGlzLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvbkRhdGFTZW50KTtcblxuXHRcdHRoaXMuZGF0YVJlY2VpdmVkTmFtZXMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnBhZ2luYXRpb25EYXRhUmVjZWl2ZWROYW1lcyk7XG5cdFx0dGhpcy5kYXRhUmVjZWl2ZWROYW1lcyA9IE9iamVjdC5hc3NpZ24odGhpcy5kYXRhUmVjZWl2ZWROYW1lcywgdGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25EYXRhUmVjZWl2ZWQpO1xuXG5cdFx0Ly9idWlsZCBwYWdpbmF0aW9uIGVsZW1lbnRcblxuXHRcdC8vYmluZCBsb2NhbGl6YXRpb25zXG5cdFx0c2VsZi50YWJsZS5tb2R1bGVzLmxvY2FsaXplLmJpbmQoXCJwYWdpbmF0aW9ufGZpcnN0XCIsIGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdFx0c2VsZi5maXJzdEJ1dC5pbm5lckhUTUwgPSB2YWx1ZTtcblx0XHR9KTtcblxuXHRcdHNlbGYudGFibGUubW9kdWxlcy5sb2NhbGl6ZS5iaW5kKFwicGFnaW5hdGlvbnxmaXJzdF90aXRsZVwiLCBmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRcdHNlbGYuZmlyc3RCdXQuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCB2YWx1ZSk7XG5cdFx0XHRzZWxmLmZpcnN0QnV0LnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIHZhbHVlKTtcblx0XHR9KTtcblxuXHRcdHNlbGYudGFibGUubW9kdWxlcy5sb2NhbGl6ZS5iaW5kKFwicGFnaW5hdGlvbnxwcmV2XCIsIGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdFx0c2VsZi5wcmV2QnV0LmlubmVySFRNTCA9IHZhbHVlO1xuXHRcdH0pO1xuXG5cdFx0c2VsZi50YWJsZS5tb2R1bGVzLmxvY2FsaXplLmJpbmQoXCJwYWdpbmF0aW9ufHByZXZfdGl0bGVcIiwgZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0XHRzZWxmLnByZXZCdXQuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCB2YWx1ZSk7XG5cdFx0XHRzZWxmLnByZXZCdXQuc2V0QXR0cmlidXRlKFwidGl0bGVcIiwgdmFsdWUpO1xuXHRcdH0pO1xuXG5cdFx0c2VsZi50YWJsZS5tb2R1bGVzLmxvY2FsaXplLmJpbmQoXCJwYWdpbmF0aW9ufG5leHRcIiwgZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0XHRzZWxmLm5leHRCdXQuaW5uZXJIVE1MID0gdmFsdWU7XG5cdFx0fSk7XG5cblx0XHRzZWxmLnRhYmxlLm1vZHVsZXMubG9jYWxpemUuYmluZChcInBhZ2luYXRpb258bmV4dF90aXRsZVwiLCBmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRcdHNlbGYubmV4dEJ1dC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIHZhbHVlKTtcblx0XHRcdHNlbGYubmV4dEJ1dC5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCB2YWx1ZSk7XG5cdFx0fSk7XG5cblx0XHRzZWxmLnRhYmxlLm1vZHVsZXMubG9jYWxpemUuYmluZChcInBhZ2luYXRpb258bGFzdFwiLCBmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRcdHNlbGYubGFzdEJ1dC5pbm5lckhUTUwgPSB2YWx1ZTtcblx0XHR9KTtcblxuXHRcdHNlbGYudGFibGUubW9kdWxlcy5sb2NhbGl6ZS5iaW5kKFwicGFnaW5hdGlvbnxsYXN0X3RpdGxlXCIsIGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdFx0c2VsZi5sYXN0QnV0LnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgdmFsdWUpO1xuXHRcdFx0c2VsZi5sYXN0QnV0LnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIHZhbHVlKTtcblx0XHR9KTtcblxuXHRcdC8vY2xpY2sgYmluZGluZ3Ncblx0XHRzZWxmLmZpcnN0QnV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRzZWxmLnNldFBhZ2UoMSk7XG5cdFx0fSk7XG5cblx0XHRzZWxmLnByZXZCdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcblx0XHRcdHNlbGYucHJldmlvdXNQYWdlKCk7XG5cdFx0fSk7XG5cblx0XHRzZWxmLm5leHRCdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcblx0XHRcdHNlbGYubmV4dFBhZ2UoKS50aGVuKGZ1bmN0aW9uICgpIHt9KS5jYXRjaChmdW5jdGlvbiAoKSB7fSk7XG5cdFx0fSk7XG5cblx0XHRzZWxmLmxhc3RCdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcblx0XHRcdHNlbGYuc2V0UGFnZShzZWxmLm1heCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25FbGVtZW50KSB7XG5cdFx0XHRzZWxmLmVsZW1lbnQgPSBzZWxmLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvbkVsZW1lbnQ7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMucGFnZVNpemVTZWxlY3QpIHtcblx0XHRcdHBhZ2VTZWxlY3RMYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsYWJlbFwiKTtcblxuXHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLmxvY2FsaXplLmJpbmQoXCJwYWdpbmF0aW9ufHBhZ2Vfc2l6ZVwiLCBmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRcdFx0c2VsZi5wYWdlU2l6ZVNlbGVjdC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIHZhbHVlKTtcblx0XHRcdFx0c2VsZi5wYWdlU2l6ZVNlbGVjdC5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCB2YWx1ZSk7XG5cdFx0XHRcdHBhZ2VTZWxlY3RMYWJlbC5pbm5lckhUTUwgPSB2YWx1ZTtcblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLmVsZW1lbnQuYXBwZW5kQ2hpbGQocGFnZVNlbGVjdExhYmVsKTtcblx0XHRcdHNlbGYuZWxlbWVudC5hcHBlbmRDaGlsZChzZWxmLnBhZ2VTaXplU2VsZWN0KTtcblxuXHRcdFx0c2VsZi5wYWdlU2l6ZVNlbGVjdC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdHNlbGYuc2V0UGFnZVNpemUoc2VsZi5wYWdlU2l6ZVNlbGVjdC52YWx1ZSA9PSBcInRydWVcIiA/IHRydWUgOiBzZWxmLnBhZ2VTaXplU2VsZWN0LnZhbHVlKTtcblx0XHRcdFx0c2VsZi5zZXRQYWdlKDEpLnRoZW4oZnVuY3Rpb24gKCkge30pLmNhdGNoKGZ1bmN0aW9uICgpIHt9KTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8vYXBwZW5kIHRvIERPTVxuXHRcdHNlbGYuZWxlbWVudC5hcHBlbmRDaGlsZChzZWxmLmZpcnN0QnV0KTtcblx0XHRzZWxmLmVsZW1lbnQuYXBwZW5kQ2hpbGQoc2VsZi5wcmV2QnV0KTtcblx0XHRzZWxmLmVsZW1lbnQuYXBwZW5kQ2hpbGQoc2VsZi5wYWdlc0VsZW1lbnQpO1xuXHRcdHNlbGYuZWxlbWVudC5hcHBlbmRDaGlsZChzZWxmLm5leHRCdXQpO1xuXHRcdHNlbGYuZWxlbWVudC5hcHBlbmRDaGlsZChzZWxmLmxhc3RCdXQpO1xuXG5cdFx0aWYgKCFzZWxmLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvbkVsZW1lbnQgJiYgIWhpZGRlbikge1xuXHRcdFx0c2VsZi50YWJsZS5mb290ZXJNYW5hZ2VyLmFwcGVuZChzZWxmLmVsZW1lbnQsIHNlbGYpO1xuXHRcdH1cblxuXHRcdC8vc2V0IGRlZmF1bHQgdmFsdWVzXG5cdFx0c2VsZi5tb2RlID0gc2VsZi50YWJsZS5vcHRpb25zLnBhZ2luYXRpb247XG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25TaXplKSB7XG5cdFx0XHRzZWxmLnNpemUgPSBzZWxmLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvblNpemU7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRlc3RFbFJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0XHR0ZXN0RWxSb3cuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1yb3dcIik7XG5cdFx0XHR0ZXN0RWxSb3cuc3R5bGUudmlzaWJpbGl0eSA9IGhpZGRlbjtcblxuXHRcdFx0dGVzdEVsQ2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0XHR0ZXN0RWxDZWxsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItY2VsbFwiKTtcblx0XHRcdHRlc3RFbENlbGwuaW5uZXJIVE1MID0gXCJQYWdlIFJvdyBUZXN0XCI7XG5cblx0XHRcdHRlc3RFbFJvdy5hcHBlbmRDaGlsZCh0ZXN0RWxDZWxsKTtcblxuXHRcdFx0c2VsZi50YWJsZS5yb3dNYW5hZ2VyLmdldFRhYmxlRWxlbWVudCgpLmFwcGVuZENoaWxkKHRlc3RFbFJvdyk7XG5cblx0XHRcdHNlbGYuc2l6ZSA9IE1hdGguZmxvb3Ioc2VsZi50YWJsZS5yb3dNYW5hZ2VyLmdldEVsZW1lbnQoKS5jbGllbnRIZWlnaHQgLyB0ZXN0RWxSb3cub2Zmc2V0SGVpZ2h0KTtcblxuXHRcdFx0c2VsZi50YWJsZS5yb3dNYW5hZ2VyLmdldFRhYmxlRWxlbWVudCgpLnJlbW92ZUNoaWxkKHRlc3RFbFJvdyk7XG5cdFx0fVxuXG5cdFx0Ly8gc2VsZi5wYWdlID0gc2VsZi50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25Jbml0aWFsUGFnZSB8fCAxO1xuXHRcdHNlbGYuY291bnQgPSBzZWxmLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvbkJ1dHRvbkNvdW50O1xuXG5cdFx0c2VsZi5nZW5lcmF0ZVBhZ2VTaXplU2VsZWN0TGlzdCgpO1xuXHR9O1xuXG5cdFBhZ2UucHJvdG90eXBlLmluaXRpYWxpemVQcm9ncmVzc2l2ZSA9IGZ1bmN0aW9uIChtb2RlKSB7XG5cdFx0dGhpcy5pbml0aWFsaXplKHRydWUpO1xuXHRcdHRoaXMubW9kZSA9IFwicHJvZ3Jlc3NpdmVfXCIgKyBtb2RlO1xuXHRcdHRoaXMucHJvZ3Jlc3NpdmVMb2FkID0gdHJ1ZTtcblx0fTtcblxuXHRQYWdlLnByb3RvdHlwZS5zZXREaXNwbGF5SW5kZXggPSBmdW5jdGlvbiAoaW5kZXgpIHtcblx0XHR0aGlzLmRpc3BsYXlJbmRleCA9IGluZGV4O1xuXHR9O1xuXG5cdFBhZ2UucHJvdG90eXBlLmdldERpc3BsYXlJbmRleCA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5kaXNwbGF5SW5kZXg7XG5cdH07XG5cblx0Ly9jYWxjdWxhdGUgbWF4aW11bSBwYWdlIGZyb20gbnVtYmVyIG9mIHJvd3Ncblx0UGFnZS5wcm90b3R5cGUuc2V0TWF4Um93cyA9IGZ1bmN0aW9uIChyb3dDb3VudCkge1xuXHRcdGlmICghcm93Q291bnQpIHtcblx0XHRcdHRoaXMubWF4ID0gMTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5tYXggPSB0aGlzLnNpemUgPT09IHRydWUgPyAxIDogTWF0aC5jZWlsKHJvd0NvdW50IC8gdGhpcy5zaXplKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5wYWdlID4gdGhpcy5tYXgpIHtcblx0XHRcdHRoaXMucGFnZSA9IHRoaXMubWF4O1xuXHRcdH1cblx0fTtcblxuXHQvL3Jlc2V0IHRvIGZpcnN0IHBhZ2Ugd2l0aG91dCB0cmlnZ2VyaW5nIGFjdGlvblxuXHRQYWdlLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uIChmb3JjZSwgY29sdW1uc0NoYW5nZWQpIHtcblx0XHRpZiAodGhpcy5tb2RlID09IFwibG9jYWxcIiB8fCBmb3JjZSkge1xuXHRcdFx0dGhpcy5wYWdlID0gMTtcblx0XHR9XG5cblx0XHRpZiAoY29sdW1uc0NoYW5nZWQpIHtcblx0XHRcdHRoaXMuaW5pdGlhbExvYWQgPSB0cnVlO1xuXHRcdH1cblxuXHRcdHJldHVybiB0cnVlO1xuXHR9O1xuXG5cdC8vc2V0IHRoZSBtYXhtdW0gcGFnZVxuXHRQYWdlLnByb3RvdHlwZS5zZXRNYXhQYWdlID0gZnVuY3Rpb24gKG1heCkge1xuXG5cdFx0bWF4ID0gcGFyc2VJbnQobWF4KTtcblxuXHRcdHRoaXMubWF4ID0gbWF4IHx8IDE7XG5cblx0XHRpZiAodGhpcy5wYWdlID4gdGhpcy5tYXgpIHtcblx0XHRcdHRoaXMucGFnZSA9IHRoaXMubWF4O1xuXHRcdFx0dGhpcy50cmlnZ2VyKCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vc2V0IGN1cnJlbnQgcGFnZSBudW1iZXJcblx0UGFnZS5wcm90b3R5cGUuc2V0UGFnZSA9IGZ1bmN0aW9uIChwYWdlKSB7XG5cdFx0dmFyIF90aGlzNjggPSB0aGlzO1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0c3dpdGNoIChwYWdlKSB7XG5cdFx0XHRjYXNlIFwiZmlyc3RcIjpcblx0XHRcdFx0cmV0dXJuIHRoaXMuc2V0UGFnZSgxKTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJwcmV2XCI6XG5cdFx0XHRcdHJldHVybiB0aGlzLnByZXZpb3VzUGFnZSgpO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcIm5leHRcIjpcblx0XHRcdFx0cmV0dXJuIHRoaXMubmV4dFBhZ2UoKTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJsYXN0XCI6XG5cdFx0XHRcdHJldHVybiB0aGlzLnNldFBhZ2UodGhpcy5tYXgpO1xuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG5cdFx0XHRwYWdlID0gcGFyc2VJbnQocGFnZSk7XG5cblx0XHRcdGlmIChwYWdlID4gMCAmJiBwYWdlIDw9IF90aGlzNjgubWF4KSB7XG5cdFx0XHRcdF90aGlzNjgucGFnZSA9IHBhZ2U7XG5cdFx0XHRcdF90aGlzNjgudHJpZ2dlcigpLnRoZW4oZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdHJlamVjdCgpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlICYmIHNlbGYudGFibGUubW9kRXhpc3RzKFwicGVyc2lzdGVuY2VcIiwgdHJ1ZSkgJiYgc2VsZi50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLmNvbmZpZy5wYWdlKSB7XG5cdFx0XHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLnNhdmUoXCJwYWdlXCIpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJQYWdpbmF0aW9uIEVycm9yIC0gUmVxdWVzdGVkIHBhZ2UgaXMgb3V0IG9mIHJhbmdlIG9mIDEgLSBcIiArIF90aGlzNjgubWF4ICsgXCI6XCIsIHBhZ2UpO1xuXHRcdFx0XHRyZWplY3QoKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHRQYWdlLnByb3RvdHlwZS5zZXRQYWdlVG9Sb3cgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIF90aGlzNjkgPSB0aGlzO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdFx0dmFyIHJvd3MgPSBfdGhpczY5LnRhYmxlLnJvd01hbmFnZXIuZ2V0RGlzcGxheVJvd3MoX3RoaXM2OS5kaXNwbGF5SW5kZXggLSAxKTtcblx0XHRcdHZhciBpbmRleCA9IHJvd3MuaW5kZXhPZihyb3cpO1xuXG5cdFx0XHRpZiAoaW5kZXggPiAtMSkge1xuXHRcdFx0XHR2YXIgcGFnZSA9IF90aGlzNjkuc2l6ZSA9PT0gdHJ1ZSA/IDEgOiBNYXRoLmNlaWwoKGluZGV4ICsgMSkgLyBfdGhpczY5LnNpemUpO1xuXG5cdFx0XHRcdF90aGlzNjkuc2V0UGFnZShwYWdlKS50aGVuKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRyZWplY3QoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJQYWdpbmF0aW9uIEVycm9yIC0gUmVxdWVzdGVkIHJvdyBpcyBub3QgdmlzaWJsZVwiKTtcblx0XHRcdFx0cmVqZWN0KCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0UGFnZS5wcm90b3R5cGUuc2V0UGFnZVNpemUgPSBmdW5jdGlvbiAoc2l6ZSkge1xuXHRcdGlmIChzaXplICE9PSB0cnVlKSB7XG5cdFx0XHRzaXplID0gcGFyc2VJbnQoc2l6ZSk7XG5cdFx0fVxuXG5cdFx0aWYgKHNpemUgPiAwKSB7XG5cdFx0XHR0aGlzLnNpemUgPSBzaXplO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnBhZ2VTaXplU2VsZWN0KSB7XG5cdFx0XHQvLyB0aGlzLnBhZ2VTaXplU2VsZWN0LnZhbHVlID0gc2l6ZTtcblx0XHRcdHRoaXMuZ2VuZXJhdGVQYWdlU2l6ZVNlbGVjdExpc3QoKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwicGVyc2lzdGVuY2VcIiwgdHJ1ZSkgJiYgdGhpcy50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLmNvbmZpZy5wYWdlKSB7XG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMucGVyc2lzdGVuY2Uuc2F2ZShcInBhZ2VcIik7XG5cdFx0fVxuXHR9O1xuXG5cdC8vc2V0dXAgdGhlIHBhZ2luYXRpb24gYnV0dG9uc1xuXHRQYWdlLnByb3RvdHlwZS5fc2V0UGFnZUJ1dHRvbnMgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0dmFyIGxlZnRTaXplID0gTWF0aC5mbG9vcigodGhpcy5jb3VudCAtIDEpIC8gMik7XG5cdFx0dmFyIHJpZ2h0U2l6ZSA9IE1hdGguY2VpbCgodGhpcy5jb3VudCAtIDEpIC8gMik7XG5cdFx0dmFyIG1pbiA9IHRoaXMubWF4IC0gdGhpcy5wYWdlICsgbGVmdFNpemUgKyAxIDwgdGhpcy5jb3VudCA/IHRoaXMubWF4IC0gdGhpcy5jb3VudCArIDEgOiBNYXRoLm1heCh0aGlzLnBhZ2UgLSBsZWZ0U2l6ZSwgMSk7XG5cdFx0dmFyIG1heCA9IHRoaXMucGFnZSA8PSByaWdodFNpemUgPyBNYXRoLm1pbih0aGlzLmNvdW50LCB0aGlzLm1heCkgOiBNYXRoLm1pbih0aGlzLnBhZ2UgKyByaWdodFNpemUsIHRoaXMubWF4KTtcblxuXHRcdHdoaWxlIChzZWxmLnBhZ2VzRWxlbWVudC5maXJzdENoaWxkKSB7XG5cdFx0XHRzZWxmLnBhZ2VzRWxlbWVudC5yZW1vdmVDaGlsZChzZWxmLnBhZ2VzRWxlbWVudC5maXJzdENoaWxkKTtcblx0XHR9aWYgKHNlbGYucGFnZSA9PSAxKSB7XG5cdFx0XHRzZWxmLmZpcnN0QnV0LmRpc2FibGVkID0gdHJ1ZTtcblx0XHRcdHNlbGYucHJldkJ1dC5kaXNhYmxlZCA9IHRydWU7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHNlbGYuZmlyc3RCdXQuZGlzYWJsZWQgPSBmYWxzZTtcblx0XHRcdHNlbGYucHJldkJ1dC5kaXNhYmxlZCA9IGZhbHNlO1xuXHRcdH1cblxuXHRcdGlmIChzZWxmLnBhZ2UgPT0gc2VsZi5tYXgpIHtcblx0XHRcdHNlbGYubGFzdEJ1dC5kaXNhYmxlZCA9IHRydWU7XG5cdFx0XHRzZWxmLm5leHRCdXQuZGlzYWJsZWQgPSB0cnVlO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRzZWxmLmxhc3RCdXQuZGlzYWJsZWQgPSBmYWxzZTtcblx0XHRcdHNlbGYubmV4dEJ1dC5kaXNhYmxlZCA9IGZhbHNlO1xuXHRcdH1cblxuXHRcdGZvciAodmFyIF9pMTAgPSBtaW47IF9pMTAgPD0gbWF4OyBfaTEwKyspIHtcblx0XHRcdGlmIChfaTEwID4gMCAmJiBfaTEwIDw9IHNlbGYubWF4KSB7XG5cdFx0XHRcdHNlbGYucGFnZXNFbGVtZW50LmFwcGVuZENoaWxkKHNlbGYuX2dlbmVyYXRlUGFnZUJ1dHRvbihfaTEwKSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0dGhpcy5mb290ZXJSZWRyYXcoKTtcblx0fTtcblxuXHRQYWdlLnByb3RvdHlwZS5fZ2VuZXJhdGVQYWdlQnV0dG9uID0gZnVuY3Rpb24gKHBhZ2UpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG5cblx0XHRidXR0b24uY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wYWdlXCIpO1xuXHRcdGlmIChwYWdlID09IHNlbGYucGFnZSkge1xuXHRcdFx0YnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XG5cdFx0fVxuXG5cdFx0YnV0dG9uLnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJidXR0b25cIik7XG5cdFx0YnV0dG9uLnNldEF0dHJpYnV0ZShcInJvbGVcIiwgXCJidXR0b25cIik7XG5cblx0XHRzZWxmLnRhYmxlLm1vZHVsZXMubG9jYWxpemUuYmluZChcInBhZ2luYXRpb258cGFnZV90aXRsZVwiLCBmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRcdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIHZhbHVlICsgXCIgXCIgKyBwYWdlKTtcblx0XHRcdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCB2YWx1ZSArIFwiIFwiICsgcGFnZSk7XG5cdFx0fSk7XG5cblx0XHRidXR0b24uc2V0QXR0cmlidXRlKFwiZGF0YS1wYWdlXCIsIHBhZ2UpO1xuXHRcdGJ1dHRvbi50ZXh0Q29udGVudCA9IHBhZ2U7XG5cblx0XHRidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRzZWxmLnNldFBhZ2UocGFnZSk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gYnV0dG9uO1xuXHR9O1xuXG5cdC8vcHJldmlvdXMgcGFnZVxuXHRQYWdlLnByb3RvdHlwZS5wcmV2aW91c1BhZ2UgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIF90aGlzNzAgPSB0aGlzO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblx0XHRcdGlmIChfdGhpczcwLnBhZ2UgPiAxKSB7XG5cdFx0XHRcdF90aGlzNzAucGFnZS0tO1xuXHRcdFx0XHRfdGhpczcwLnRyaWdnZXIoKS50aGVuKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRyZWplY3QoKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0aWYgKF90aGlzNzAudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZSAmJiBfdGhpczcwLnRhYmxlLm1vZEV4aXN0cyhcInBlcnNpc3RlbmNlXCIsIHRydWUpICYmIF90aGlzNzAudGFibGUubW9kdWxlcy5wZXJzaXN0ZW5jZS5jb25maWcucGFnZSkge1xuXHRcdFx0XHRcdF90aGlzNzAudGFibGUubW9kdWxlcy5wZXJzaXN0ZW5jZS5zYXZlKFwicGFnZVwiKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiUGFnaW5hdGlvbiBFcnJvciAtIFByZXZpb3VzIHBhZ2Ugd291bGQgYmUgbGVzcyB0aGFuIHBhZ2UgMTpcIiwgMCk7XG5cdFx0XHRcdHJlamVjdCgpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdC8vbmV4dCBwYWdlXG5cdFBhZ2UucHJvdG90eXBlLm5leHRQYWdlID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBfdGhpczcxID0gdGhpcztcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0XHRpZiAoX3RoaXM3MS5wYWdlIDwgX3RoaXM3MS5tYXgpIHtcblx0XHRcdFx0X3RoaXM3MS5wYWdlKys7XG5cdFx0XHRcdF90aGlzNzEudHJpZ2dlcigpLnRoZW4oZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdHJlamVjdCgpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRpZiAoX3RoaXM3MS50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlICYmIF90aGlzNzEudGFibGUubW9kRXhpc3RzKFwicGVyc2lzdGVuY2VcIiwgdHJ1ZSkgJiYgX3RoaXM3MS50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLmNvbmZpZy5wYWdlKSB7XG5cdFx0XHRcdFx0X3RoaXM3MS50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLnNhdmUoXCJwYWdlXCIpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAoIV90aGlzNzEucHJvZ3Jlc3NpdmVMb2FkKSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiUGFnaW5hdGlvbiBFcnJvciAtIE5leHQgcGFnZSB3b3VsZCBiZSBncmVhdGVyIHRoYW4gbWF4aW11bSBwYWdlIG9mIFwiICsgX3RoaXM3MS5tYXggKyBcIjpcIiwgX3RoaXM3MS5tYXggKyAxKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZWplY3QoKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHQvL3JldHVybiBjdXJyZW50IHBhZ2UgbnVtYmVyXG5cdFBhZ2UucHJvdG90eXBlLmdldFBhZ2UgPSBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIHRoaXMucGFnZTtcblx0fTtcblxuXHQvL3JldHVybiBtYXggcGFnZSBudW1iZXJcblx0UGFnZS5wcm90b3R5cGUuZ2V0UGFnZU1heCA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5tYXg7XG5cdH07XG5cblx0UGFnZS5wcm90b3R5cGUuZ2V0UGFnZVNpemUgPSBmdW5jdGlvbiAoc2l6ZSkge1xuXHRcdHJldHVybiB0aGlzLnNpemU7XG5cdH07XG5cblx0UGFnZS5wcm90b3R5cGUuZ2V0TW9kZSA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5tb2RlO1xuXHR9O1xuXG5cdC8vcmV0dXJuIGFwcHJvcHJpYXRlIHJvd3MgZm9yIGN1cnJlbnQgcGFnZVxuXHRQYWdlLnByb3RvdHlwZS5nZXRSb3dzID0gZnVuY3Rpb24gKGRhdGEpIHtcblx0XHR2YXIgb3V0cHV0LCBzdGFydCwgZW5kO1xuXG5cdFx0aWYgKHRoaXMubW9kZSA9PSBcImxvY2FsXCIpIHtcblx0XHRcdG91dHB1dCA9IFtdO1xuXG5cdFx0XHRpZiAodGhpcy5zaXplID09PSB0cnVlKSB7XG5cdFx0XHRcdHN0YXJ0ID0gMDtcblx0XHRcdFx0ZW5kID0gZGF0YS5sZW5ndGggLSAxO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0c3RhcnQgPSB0aGlzLnNpemUgKiAodGhpcy5wYWdlIC0gMSk7XG5cdFx0XHRcdGVuZCA9IHN0YXJ0ICsgcGFyc2VJbnQodGhpcy5zaXplKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5fc2V0UGFnZUJ1dHRvbnMoKTtcblxuXHRcdFx0Zm9yICh2YXIgX2kxMSA9IHN0YXJ0OyBfaTExIDwgZW5kOyBfaTExKyspIHtcblx0XHRcdFx0aWYgKGRhdGFbX2kxMV0pIHtcblx0XHRcdFx0XHRvdXRwdXQucHVzaChkYXRhW19pMTFdKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gb3V0cHV0O1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHRoaXMuX3NldFBhZ2VCdXR0b25zKCk7XG5cblx0XHRcdHJldHVybiBkYXRhLnNsaWNlKDApO1xuXHRcdH1cblx0fTtcblxuXHRQYWdlLnByb3RvdHlwZS50cmlnZ2VyID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBfdGhpczcyID0gdGhpcztcblxuXHRcdHZhciBsZWZ0O1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdFx0c3dpdGNoIChfdGhpczcyLm1vZGUpIHtcblx0XHRcdFx0Y2FzZSBcImxvY2FsXCI6XG5cdFx0XHRcdFx0bGVmdCA9IF90aGlzNzIudGFibGUucm93TWFuYWdlci5zY3JvbGxMZWZ0O1xuXG5cdFx0XHRcdFx0X3RoaXM3Mi50YWJsZS5yb3dNYW5hZ2VyLnJlZnJlc2hBY3RpdmVEYXRhKFwicGFnZVwiKTtcblx0XHRcdFx0XHRfdGhpczcyLnRhYmxlLnJvd01hbmFnZXIuc2Nyb2xsSG9yaXpvbnRhbChsZWZ0KTtcblxuXHRcdFx0XHRcdF90aGlzNzIudGFibGUub3B0aW9ucy5wYWdlTG9hZGVkLmNhbGwoX3RoaXM3Mi50YWJsZSwgX3RoaXM3Mi5nZXRQYWdlKCkpO1xuXHRcdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRjYXNlIFwicmVtb3RlXCI6XG5cdFx0XHRcdGNhc2UgXCJwcm9ncmVzc2l2ZV9sb2FkXCI6XG5cdFx0XHRcdGNhc2UgXCJwcm9ncmVzc2l2ZV9zY3JvbGxcIjpcblx0XHRcdFx0XHRfdGhpczcyLnRhYmxlLm1vZHVsZXMuYWpheC5ibG9ja0FjdGl2ZVJlcXVlc3QoKTtcblx0XHRcdFx0XHRfdGhpczcyLl9nZXRSZW1vdGVQYWdlKCkudGhlbihmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0cmVqZWN0KCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJQYWdpbmF0aW9uIEVycm9yIC0gbm8gc3VjaCBwYWdpbmF0aW9uIG1vZGU6XCIsIF90aGlzNzIubW9kZSk7XG5cdFx0XHRcdFx0cmVqZWN0KCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0UGFnZS5wcm90b3R5cGUuX2dldFJlbW90ZVBhZ2UgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIF90aGlzNzMgPSB0aGlzO1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBvbGRQYXJhbXMsXG5cdFx0ICAgIHBhZ2VQYXJhbXM7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG5cdFx0XHRpZiAoIXNlbGYudGFibGUubW9kRXhpc3RzKFwiYWpheFwiLCB0cnVlKSkge1xuXHRcdFx0XHRyZWplY3QoKTtcblx0XHRcdH1cblxuXHRcdFx0Ly9yZWNvcmQgb2xkIHBhcmFtcyBhbmQgcmVzdG9yZSBhZnRlciByZXF1ZXN0IGhhcyBiZWVuIG1hZGVcblx0XHRcdG9sZFBhcmFtcyA9IFRhYnVsYXRvci5wcm90b3R5cGUuaGVscGVycy5kZWVwQ2xvbmUoc2VsZi50YWJsZS5tb2R1bGVzLmFqYXguZ2V0UGFyYW1zKCkgfHwge30pO1xuXHRcdFx0cGFnZVBhcmFtcyA9IHNlbGYudGFibGUubW9kdWxlcy5hamF4LmdldFBhcmFtcygpO1xuXG5cdFx0XHQvL2NvbmZpZ3VyZSByZXF1ZXN0IHBhcmFtc1xuXHRcdFx0cGFnZVBhcmFtc1tfdGhpczczLmRhdGFTZW50TmFtZXMucGFnZV0gPSBzZWxmLnBhZ2U7XG5cblx0XHRcdC8vc2V0IHBhZ2Ugc2l6ZSBpZiBkZWZpbmVkXG5cdFx0XHRpZiAoX3RoaXM3My5zaXplKSB7XG5cdFx0XHRcdHBhZ2VQYXJhbXNbX3RoaXM3My5kYXRhU2VudE5hbWVzLnNpemVdID0gX3RoaXM3My5zaXplO1xuXHRcdFx0fVxuXG5cdFx0XHQvL3NldCBzb3J0IGRhdGEgaWYgZGVmaW5lZFxuXHRcdFx0aWYgKF90aGlzNzMudGFibGUub3B0aW9ucy5hamF4U29ydGluZyAmJiBfdGhpczczLnRhYmxlLm1vZEV4aXN0cyhcInNvcnRcIikpIHtcblx0XHRcdFx0dmFyIHNvcnRlcnMgPSBzZWxmLnRhYmxlLm1vZHVsZXMuc29ydC5nZXRTb3J0KCk7XG5cblx0XHRcdFx0c29ydGVycy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRcdFx0ZGVsZXRlIGl0ZW0uY29sdW1uO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRwYWdlUGFyYW1zW190aGlzNzMuZGF0YVNlbnROYW1lcy5zb3J0ZXJzXSA9IHNvcnRlcnM7XG5cdFx0XHR9XG5cblx0XHRcdC8vc2V0IGZpbHRlciBkYXRhIGlmIGRlZmluZWRcblx0XHRcdGlmIChfdGhpczczLnRhYmxlLm9wdGlvbnMuYWpheEZpbHRlcmluZyAmJiBfdGhpczczLnRhYmxlLm1vZEV4aXN0cyhcImZpbHRlclwiKSkge1xuXHRcdFx0XHR2YXIgZmlsdGVycyA9IHNlbGYudGFibGUubW9kdWxlcy5maWx0ZXIuZ2V0RmlsdGVycyh0cnVlLCB0cnVlKTtcblx0XHRcdFx0cGFnZVBhcmFtc1tfdGhpczczLmRhdGFTZW50TmFtZXMuZmlsdGVyc10gPSBmaWx0ZXJzO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMuYWpheC5zZXRQYXJhbXMocGFnZVBhcmFtcyk7XG5cblx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5hamF4LnNlbmRSZXF1ZXN0KF90aGlzNzMucHJvZ3Jlc3NpdmVMb2FkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG5cdFx0XHRcdHNlbGYuX3BhcnNlUmVtb3RlRGF0YShkYXRhKTtcblx0XHRcdFx0cmVzb2x2ZSgpO1xuXHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0cmVqZWN0KCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLmFqYXguc2V0UGFyYW1zKG9sZFBhcmFtcyk7XG5cdFx0fSk7XG5cdH07XG5cblx0UGFnZS5wcm90b3R5cGUuX3BhcnNlUmVtb3RlRGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBsZWZ0LFxuXHRcdCAgICBkYXRhLFxuXHRcdCAgICBtYXJnaW47XG5cblx0XHRpZiAodHlwZW9mIGRhdGFbdGhpcy5kYXRhUmVjZWl2ZWROYW1lcy5sYXN0X3BhZ2VdID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJSZW1vdGUgUGFnaW5hdGlvbiBFcnJvciAtIFNlcnZlciByZXNwb25zZSBtaXNzaW5nICdcIiArIHRoaXMuZGF0YVJlY2VpdmVkTmFtZXMubGFzdF9wYWdlICsgXCInIHByb3BlcnR5XCIpO1xuXHRcdH1cblxuXHRcdGlmIChkYXRhW3RoaXMuZGF0YVJlY2VpdmVkTmFtZXMuZGF0YV0pIHtcblx0XHRcdHRoaXMubWF4ID0gcGFyc2VJbnQoZGF0YVt0aGlzLmRhdGFSZWNlaXZlZE5hbWVzLmxhc3RfcGFnZV0pIHx8IDE7XG5cblx0XHRcdGlmICh0aGlzLnByb2dyZXNzaXZlTG9hZCkge1xuXHRcdFx0XHRzd2l0Y2ggKHRoaXMubW9kZSkge1xuXHRcdFx0XHRcdGNhc2UgXCJwcm9ncmVzc2l2ZV9sb2FkXCI6XG5cblx0XHRcdFx0XHRcdGlmICh0aGlzLnBhZ2UgPT0gMSkge1xuXHRcdFx0XHRcdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuc2V0RGF0YShkYXRhW3RoaXMuZGF0YVJlY2VpdmVkTmFtZXMuZGF0YV0sIGZhbHNlLCB0aGlzLmluaXRpYWxMb2FkICYmIHRoaXMucGFnZSA9PSAxKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5hZGRSb3dzKGRhdGFbdGhpcy5kYXRhUmVjZWl2ZWROYW1lcy5kYXRhXSk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmICh0aGlzLnBhZ2UgPCB0aGlzLm1heCkge1xuXHRcdFx0XHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRzZWxmLm5leHRQYWdlKCkudGhlbihmdW5jdGlvbiAoKSB7fSkuY2F0Y2goZnVuY3Rpb24gKCkge30pO1xuXHRcdFx0XHRcdFx0XHR9LCBzZWxmLnRhYmxlLm9wdGlvbnMuYWpheFByb2dyZXNzaXZlTG9hZERlbGF5KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSBcInByb2dyZXNzaXZlX3Njcm9sbFwiOlxuXHRcdFx0XHRcdFx0ZGF0YSA9IHRoaXMudGFibGUucm93TWFuYWdlci5nZXREYXRhKCkuY29uY2F0KGRhdGFbdGhpcy5kYXRhUmVjZWl2ZWROYW1lcy5kYXRhXSk7XG5cblx0XHRcdFx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5zZXREYXRhKGRhdGEsIHRydWUsIHRoaXMuaW5pdGlhbExvYWQgJiYgdGhpcy5wYWdlID09IDEpO1xuXG5cdFx0XHRcdFx0XHRtYXJnaW4gPSB0aGlzLnRhYmxlLm9wdGlvbnMuYWpheFByb2dyZXNzaXZlTG9hZFNjcm9sbE1hcmdpbiB8fCB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5jbGllbnRIZWlnaHQgKiAyO1xuXG5cdFx0XHRcdFx0XHRpZiAoc2VsZi50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQuc2Nyb2xsSGVpZ2h0IDw9IHNlbGYudGFibGUucm93TWFuYWdlci5lbGVtZW50LmNsaWVudEhlaWdodCArIG1hcmdpbikge1xuXHRcdFx0XHRcdFx0XHRzZWxmLm5leHRQYWdlKCkudGhlbihmdW5jdGlvbiAoKSB7fSkuY2F0Y2goZnVuY3Rpb24gKCkge30pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGxlZnQgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuc2Nyb2xsTGVmdDtcblxuXHRcdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuc2V0RGF0YShkYXRhW3RoaXMuZGF0YVJlY2VpdmVkTmFtZXMuZGF0YV0sIGZhbHNlLCB0aGlzLmluaXRpYWxMb2FkICYmIHRoaXMucGFnZSA9PSAxKTtcblxuXHRcdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuc2Nyb2xsSG9yaXpvbnRhbChsZWZ0KTtcblxuXHRcdFx0XHR0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuc2Nyb2xsSG9yaXpvbnRhbChsZWZ0KTtcblxuXHRcdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMucGFnZUxvYWRlZC5jYWxsKHRoaXMudGFibGUsIHRoaXMuZ2V0UGFnZSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5pbml0aWFsTG9hZCA9IGZhbHNlO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJSZW1vdGUgUGFnaW5hdGlvbiBFcnJvciAtIFNlcnZlciByZXNwb25zZSBtaXNzaW5nICdcIiArIHRoaXMuZGF0YVJlY2VpdmVkTmFtZXMuZGF0YSArIFwiJyBwcm9wZXJ0eVwiKTtcblx0XHR9XG5cdH07XG5cblx0Ly9oYW5kbGUgdGhlIGZvb3RlciBlbGVtZW50IGJlaW5nIHJlZHJhd25cblx0UGFnZS5wcm90b3R5cGUuZm9vdGVyUmVkcmF3ID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBmb290ZXIgPSB0aGlzLnRhYmxlLmZvb3Rlck1hbmFnZXIuZWxlbWVudDtcblxuXHRcdGlmIChNYXRoLmNlaWwoZm9vdGVyLmNsaWVudFdpZHRoKSAtIGZvb3Rlci5zY3JvbGxXaWR0aCA8IDApIHtcblx0XHRcdHRoaXMucGFnZXNFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMucGFnZXNFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnJztcblxuXHRcdFx0aWYgKE1hdGguY2VpbChmb290ZXIuY2xpZW50V2lkdGgpIC0gZm9vdGVyLnNjcm9sbFdpZHRoIDwgMCkge1xuXHRcdFx0XHR0aGlzLnBhZ2VzRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHQvL3NldCB0aGUgcGFyYW10ZXIgbmFtZXMgZm9yIHBhZ2luYXRpb24gcmVxdWVzdHNcblx0UGFnZS5wcm90b3R5cGUucGFnaW5hdGlvbkRhdGFTZW50TmFtZXMgPSB7XG5cdFx0XCJwYWdlXCI6IFwicGFnZVwiLFxuXHRcdFwic2l6ZVwiOiBcInNpemVcIixcblx0XHRcInNvcnRlcnNcIjogXCJzb3J0ZXJzXCIsXG5cdFx0Ly8gXCJzb3J0X2RpclwiOlwic29ydF9kaXJcIixcblx0XHRcImZpbHRlcnNcIjogXCJmaWx0ZXJzXCJcblx0XHQvLyBcImZpbHRlcl92YWx1ZVwiOlwiZmlsdGVyX3ZhbHVlXCIsXG5cdFx0Ly8gXCJmaWx0ZXJfdHlwZVwiOlwiZmlsdGVyX3R5cGVcIixcblx0fTtcblxuXHQvL3NldCB0aGUgcHJvcGVydHkgbmFtZXMgZm9yIHBhZ2luYXRpb24gcmVzcG9uc2VzXG5cdFBhZ2UucHJvdG90eXBlLnBhZ2luYXRpb25EYXRhUmVjZWl2ZWROYW1lcyA9IHtcblx0XHRcImN1cnJlbnRfcGFnZVwiOiBcImN1cnJlbnRfcGFnZVwiLFxuXHRcdFwibGFzdF9wYWdlXCI6IFwibGFzdF9wYWdlXCIsXG5cdFx0XCJkYXRhXCI6IFwiZGF0YVwiXG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcInBhZ2VcIiwgUGFnZSk7XG5cblx0dmFyIFBlcnNpc3RlbmNlID0gZnVuY3Rpb24gUGVyc2lzdGVuY2UodGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdFx0dGhpcy5tb2RlID0gXCJcIjtcblx0XHR0aGlzLmlkID0gXCJcIjtcblx0XHQvLyB0aGlzLnBlcnNpc3RQcm9wcyA9IFtcImZpZWxkXCIsIFwid2lkdGhcIiwgXCJ2aXNpYmxlXCJdO1xuXHRcdHRoaXMuZGVmV2F0Y2hlckJsb2NrID0gZmFsc2U7XG5cdFx0dGhpcy5jb25maWcgPSB7fTtcblx0XHR0aGlzLnJlYWRGdW5jID0gZmFsc2U7XG5cdFx0dGhpcy53cml0ZUZ1bmMgPSBmYWxzZTtcblx0fTtcblxuXHQvLyBUZXN0IGZvciB3aGV0aGVyIGxvY2FsU3RvcmFnZSBpcyBhdmFpbGFibGUgZm9yIHVzZS5cblx0UGVyc2lzdGVuY2UucHJvdG90eXBlLmxvY2FsU3RvcmFnZVRlc3QgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIHRlc3RLZXkgPSBcIl90YWJ1bGF0b3JfdGVzdFwiO1xuXG5cdFx0dHJ5IHtcblx0XHRcdHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0ZXN0S2V5LCB0ZXN0S2V5KTtcblx0XHRcdHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0ZXN0S2V5KTtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH0gY2F0Y2ggKGUpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0Ly9zZXR1cCBwYXJhbWV0ZXJzXG5cdFBlcnNpc3RlbmNlLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuXHRcdC8vZGV0ZXJtaW5lIHBlcnNpc3RlbnQgbGF5b3V0IHN0b3JhZ2UgdHlwZVxuXG5cdFx0dmFyIG1vZGUgPSB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2VNb2RlLFxuXHRcdCAgICBpZCA9IHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZUlELFxuXHRcdCAgICByZXRyZWl2ZWREYXRhO1xuXG5cdFx0dGhpcy5tb2RlID0gbW9kZSAhPT0gdHJ1ZSA/IG1vZGUgOiB0aGlzLmxvY2FsU3RvcmFnZVRlc3QoKSA/IFwibG9jYWxcIiA6IFwiY29va2llXCI7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlUmVhZGVyRnVuYykge1xuXHRcdFx0aWYgKHR5cGVvZiB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2VSZWFkZXJGdW5jID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0dGhpcy5yZWFkRnVuYyA9IHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZVJlYWRlckZ1bmM7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAodGhpcy5yZWFkZXJzW3RoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZVJlYWRlckZ1bmNdKSB7XG5cdFx0XHRcdFx0dGhpcy5yZWFkRnVuYyA9IHRoaXMucmVhZGVyc1t0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2VSZWFkZXJGdW5jXTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJQZXJzaXN0ZW5jZSBSZWFkIEVycm9yIC0gaW52YWxpZCByZWFkZXIgc2V0XCIsIHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZVJlYWRlckZ1bmMpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlmICh0aGlzLnJlYWRlcnNbdGhpcy5tb2RlXSkge1xuXHRcdFx0XHR0aGlzLnJlYWRGdW5jID0gdGhpcy5yZWFkZXJzW3RoaXMubW9kZV07XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJQZXJzaXN0ZW5jZSBSZWFkIEVycm9yIC0gaW52YWxpZCByZWFkZXIgc2V0XCIsIHRoaXMubW9kZSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZVdyaXRlckZ1bmMpIHtcblx0XHRcdGlmICh0eXBlb2YgdGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlV3JpdGVyRnVuYyA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdHRoaXMud3JpdGVGdW5jID0gdGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlV3JpdGVyRnVuYztcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmICh0aGlzLnJlYWRlcnNbdGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlV3JpdGVyRnVuY10pIHtcblx0XHRcdFx0XHR0aGlzLndyaXRlRnVuYyA9IHRoaXMucmVhZGVyc1t0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2VXcml0ZXJGdW5jXTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJQZXJzaXN0ZW5jZSBXcml0ZSBFcnJvciAtIGludmFsaWQgcmVhZGVyIHNldFwiLCB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2VXcml0ZXJGdW5jKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRpZiAodGhpcy53cml0ZXJzW3RoaXMubW9kZV0pIHtcblx0XHRcdFx0dGhpcy53cml0ZUZ1bmMgPSB0aGlzLndyaXRlcnNbdGhpcy5tb2RlXTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIlBlcnNpc3RlbmNlIFdyaXRlIEVycm9yIC0gaW52YWxpZCB3cml0ZXIgc2V0XCIsIHRoaXMubW9kZSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly9zZXQgc3RvcmFnZSB0YWdcblx0XHR0aGlzLmlkID0gXCJ0YWJ1bGF0b3ItXCIgKyAoaWQgfHwgdGhpcy50YWJsZS5lbGVtZW50LmdldEF0dHJpYnV0ZShcImlkXCIpIHx8IFwiXCIpO1xuXG5cdFx0dGhpcy5jb25maWcgPSB7XG5cdFx0XHRzb3J0OiB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UgPT09IHRydWUgfHwgdGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlLnNvcnQsXG5cdFx0XHRmaWx0ZXI6IHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZSA9PT0gdHJ1ZSB8fCB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UuZmlsdGVyLFxuXHRcdFx0Z3JvdXA6IHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZSA9PT0gdHJ1ZSB8fCB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UuZ3JvdXAsXG5cdFx0XHRwYWdlOiB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UgPT09IHRydWUgfHwgdGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlLnBhZ2UsXG5cdFx0XHRjb2x1bW5zOiB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UgPT09IHRydWUgPyBbXCJ0aXRsZVwiLCBcIndpZHRoXCIsIFwidmlzaWJsZVwiXSA6IHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZS5jb2x1bW5zXG5cdFx0fTtcblxuXHRcdC8vbG9hZCBwYWdpbmF0aW9uIGRhdGEgaWYgbmVlZGVkXG5cdFx0aWYgKHRoaXMuY29uZmlnLnBhZ2UpIHtcblx0XHRcdHJldHJlaXZlZERhdGEgPSB0aGlzLnJldHJlaXZlRGF0YShcInBhZ2VcIik7XG5cblx0XHRcdGlmIChyZXRyZWl2ZWREYXRhKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YgcmV0cmVpdmVkRGF0YS5wYWdpbmF0aW9uU2l6ZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiAodGhpcy5jb25maWcucGFnZSA9PT0gdHJ1ZSB8fCB0aGlzLmNvbmZpZy5wYWdlLnNpemUpKSB7XG5cdFx0XHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25TaXplID0gcmV0cmVpdmVkRGF0YS5wYWdpbmF0aW9uU2l6ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2YgcmV0cmVpdmVkRGF0YS5wYWdpbmF0aW9uSW5pdGlhbFBhZ2UgIT09IFwidW5kZWZpbmVkXCIgJiYgKHRoaXMuY29uZmlnLnBhZ2UgPT09IHRydWUgfHwgdGhpcy5jb25maWcucGFnZS5wYWdlKSkge1xuXHRcdFx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uSW5pdGlhbFBhZ2UgPSByZXRyZWl2ZWREYXRhLnBhZ2luYXRpb25Jbml0aWFsUGFnZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vbG9hZCBncm91cCBkYXRhIGlmIG5lZWRlZFxuXHRcdGlmICh0aGlzLmNvbmZpZy5ncm91cCkge1xuXHRcdFx0cmV0cmVpdmVkRGF0YSA9IHRoaXMucmV0cmVpdmVEYXRhKFwiZ3JvdXBcIik7XG5cblx0XHRcdGlmIChyZXRyZWl2ZWREYXRhKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YgcmV0cmVpdmVkRGF0YS5ncm91cEJ5ICE9PSBcInVuZGVmaW5lZFwiICYmICh0aGlzLmNvbmZpZy5ncm91cCA9PT0gdHJ1ZSB8fCB0aGlzLmNvbmZpZy5ncm91cC5ncm91cEJ5KSkge1xuXHRcdFx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5ID0gcmV0cmVpdmVkRGF0YS5ncm91cEJ5O1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmICh0eXBlb2YgcmV0cmVpdmVkRGF0YS5ncm91cFN0YXJ0T3BlbiAhPT0gXCJ1bmRlZmluZWRcIiAmJiAodGhpcy5jb25maWcuZ3JvdXAgPT09IHRydWUgfHwgdGhpcy5jb25maWcuZ3JvdXAuZ3JvdXBTdGFydE9wZW4pKSB7XG5cdFx0XHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLmdyb3VwU3RhcnRPcGVuID0gcmV0cmVpdmVkRGF0YS5ncm91cFN0YXJ0T3Blbjtcblx0XHRcdFx0fVxuXHRcdFx0XHRpZiAodHlwZW9mIHJldHJlaXZlZERhdGEuZ3JvdXBIZWFkZXIgIT09IFwidW5kZWZpbmVkXCIgJiYgKHRoaXMuY29uZmlnLmdyb3VwID09PSB0cnVlIHx8IHRoaXMuY29uZmlnLmdyb3VwLmdyb3VwSGVhZGVyKSkge1xuXHRcdFx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5ncm91cEhlYWRlciA9IHJldHJlaXZlZERhdGEuZ3JvdXBIZWFkZXI7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0UGVyc2lzdGVuY2UucHJvdG90eXBlLmluaXRpYWxpemVDb2x1bW4gPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBkZWYsXG5cdFx0ICAgIGtleXM7XG5cblx0XHRpZiAodGhpcy5jb25maWcuY29sdW1ucykge1xuXHRcdFx0dGhpcy5kZWZXYXRjaGVyQmxvY2sgPSB0cnVlO1xuXG5cdFx0XHRkZWYgPSBjb2x1bW4uZ2V0RGVmaW5pdGlvbigpO1xuXG5cdFx0XHRrZXlzID0gdGhpcy5jb25maWcuY29sdW1ucyA9PT0gdHJ1ZSA/IE9iamVjdC5rZXlzKGRlZikgOiB0aGlzLmNvbmZpZy5jb2x1bW5zO1xuXG5cdFx0XHRrZXlzLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuXHRcdFx0XHR2YXIgcHJvcHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGRlZiwga2V5KTtcblx0XHRcdFx0dmFyIHZhbHVlID0gZGVmW2tleV07XG5cdFx0XHRcdGlmIChwcm9wcykge1xuXHRcdFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkZWYsIGtleSwge1xuXHRcdFx0XHRcdFx0c2V0OiBmdW5jdGlvbiBzZXQobmV3VmFsdWUpIHtcblx0XHRcdFx0XHRcdFx0dmFsdWUgPSBuZXdWYWx1ZTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoIXNlbGYuZGVmV2F0Y2hlckJsb2NrKSB7XG5cdFx0XHRcdFx0XHRcdFx0c2VsZi5zYXZlKFwiY29sdW1uc1wiKTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdGlmIChwcm9wcy5zZXQpIHtcblx0XHRcdFx0XHRcdFx0XHRwcm9wcy5zZXQobmV3VmFsdWUpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0Z2V0OiBmdW5jdGlvbiBnZXQoKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChwcm9wcy5nZXQpIHtcblx0XHRcdFx0XHRcdFx0XHRwcm9wcy5nZXQoKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLmRlZldhdGNoZXJCbG9jayA9IGZhbHNlO1xuXHRcdH1cblx0fTtcblxuXHQvL2xvYWQgc2F2ZWQgZGVmaW5pdGlvbnNcblx0UGVyc2lzdGVuY2UucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbiAodHlwZSwgY3VycmVudCkge1xuXHRcdHZhciBkYXRhID0gdGhpcy5yZXRyZWl2ZURhdGEodHlwZSk7XG5cblx0XHRpZiAoY3VycmVudCkge1xuXHRcdFx0ZGF0YSA9IGRhdGEgPyB0aGlzLm1lcmdlRGVmaW5pdGlvbihjdXJyZW50LCBkYXRhKSA6IGN1cnJlbnQ7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGRhdGE7XG5cdH07XG5cblx0Ly9yZXRyZWl2ZSBkYXRhIGZyb20gbWVtb3J5XG5cdFBlcnNpc3RlbmNlLnByb3RvdHlwZS5yZXRyZWl2ZURhdGEgPSBmdW5jdGlvbiAodHlwZSkge1xuXHRcdHJldHVybiB0aGlzLnJlYWRGdW5jID8gdGhpcy5yZWFkRnVuYyh0aGlzLmlkLCB0eXBlKSA6IGZhbHNlO1xuXHR9O1xuXG5cdC8vbWVyZ2Ugb2xkIGFuZCBuZXcgY29sdW1uIGRlZmluaXRpb25zXG5cdFBlcnNpc3RlbmNlLnByb3RvdHlwZS5tZXJnZURlZmluaXRpb24gPSBmdW5jdGlvbiAob2xkQ29scywgbmV3Q29scykge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgb3V0cHV0ID0gW107XG5cblx0XHQvLyBvbGRDb2xzID0gb2xkQ29scyB8fCBbXTtcblx0XHRuZXdDb2xzID0gbmV3Q29scyB8fCBbXTtcblxuXHRcdG5ld0NvbHMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uLCB0bykge1xuXG5cdFx0XHR2YXIgZnJvbSA9IHNlbGYuX2ZpbmRDb2x1bW4ob2xkQ29scywgY29sdW1uKSxcblx0XHRcdCAgICBrZXlzO1xuXG5cdFx0XHRpZiAoZnJvbSkge1xuXG5cdFx0XHRcdGlmIChzZWxmLmNvbmZpZy5jb2x1bW5zID09PSB0cnVlIHx8IHNlbGYuY29uZmlnLmNvbHVtbnMgPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0a2V5cyA9IE9iamVjdC5rZXlzKGZyb20pO1xuXHRcdFx0XHRcdGtleXMucHVzaChcIndpZHRoXCIpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGtleXMgPSBzZWxmLmNvbmZpZy5jb2x1bW5zO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0a2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbHVtbltrZXldICE9PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdFx0XHRmcm9tW2tleV0gPSBjb2x1bW5ba2V5XTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGlmIChmcm9tLmNvbHVtbnMpIHtcblx0XHRcdFx0XHRmcm9tLmNvbHVtbnMgPSBzZWxmLm1lcmdlRGVmaW5pdGlvbihmcm9tLmNvbHVtbnMsIGNvbHVtbi5jb2x1bW5zKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdG91dHB1dC5wdXNoKGZyb20pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0b2xkQ29scy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4sIGkpIHtcblx0XHRcdHZhciBmcm9tID0gc2VsZi5fZmluZENvbHVtbihuZXdDb2xzLCBjb2x1bW4pO1xuXHRcdFx0aWYgKCFmcm9tKSB7XG5cdFx0XHRcdGlmIChvdXRwdXQubGVuZ3RoID4gaSkge1xuXHRcdFx0XHRcdG91dHB1dC5zcGxpY2UoaSwgMCwgY29sdW1uKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvdXRwdXQucHVzaChjb2x1bW4pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9O1xuXG5cdC8vZmluZCBtYXRjaGluZyBjb2x1bW5zXG5cdFBlcnNpc3RlbmNlLnByb3RvdHlwZS5fZmluZENvbHVtbiA9IGZ1bmN0aW9uIChjb2x1bW5zLCBzdWJqZWN0KSB7XG5cdFx0dmFyIHR5cGUgPSBzdWJqZWN0LmNvbHVtbnMgPyBcImdyb3VwXCIgOiBzdWJqZWN0LmZpZWxkID8gXCJmaWVsZFwiIDogXCJvYmplY3RcIjtcblxuXHRcdHJldHVybiBjb2x1bW5zLmZpbmQoZnVuY3Rpb24gKGNvbCkge1xuXHRcdFx0c3dpdGNoICh0eXBlKSB7XG5cdFx0XHRcdGNhc2UgXCJncm91cFwiOlxuXHRcdFx0XHRcdHJldHVybiBjb2wudGl0bGUgPT09IHN1YmplY3QudGl0bGUgJiYgY29sLmNvbHVtbnMubGVuZ3RoID09PSBzdWJqZWN0LmNvbHVtbnMubGVuZ3RoO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgXCJmaWVsZFwiOlxuXHRcdFx0XHRcdHJldHVybiBjb2wuZmllbGQgPT09IHN1YmplY3QuZmllbGQ7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSBcIm9iamVjdFwiOlxuXHRcdFx0XHRcdHJldHVybiBjb2wgPT09IHN1YmplY3Q7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0Ly9zYXZlIGRhdGFcblx0UGVyc2lzdGVuY2UucHJvdG90eXBlLnNhdmUgPSBmdW5jdGlvbiAodHlwZSkge1xuXHRcdHZhciBkYXRhID0ge307XG5cblx0XHRzd2l0Y2ggKHR5cGUpIHtcblx0XHRcdGNhc2UgXCJjb2x1bW5zXCI6XG5cdFx0XHRcdGRhdGEgPSB0aGlzLnBhcnNlQ29sdW1ucyh0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0Q29sdW1ucygpKTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJmaWx0ZXJcIjpcblx0XHRcdFx0ZGF0YSA9IHRoaXMudGFibGUubW9kdWxlcy5maWx0ZXIuZ2V0RmlsdGVycygpO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcInNvcnRcIjpcblx0XHRcdFx0ZGF0YSA9IHRoaXMudmFsaWRhdGVTb3J0ZXJzKHRoaXMudGFibGUubW9kdWxlcy5zb3J0LmdldFNvcnQoKSk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiZ3JvdXBcIjpcblx0XHRcdFx0ZGF0YSA9IHRoaXMuZ2V0R3JvdXBDb25maWcoKTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJwYWdlXCI6XG5cdFx0XHRcdGRhdGEgPSB0aGlzLmdldFBhZ2VDb25maWcoKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMud3JpdGVGdW5jKSB7XG5cdFx0XHR0aGlzLndyaXRlRnVuYyh0aGlzLmlkLCB0eXBlLCBkYXRhKTtcblx0XHR9XG5cdH07XG5cblx0Ly9lbnN1cmUgc29ydGVycyBjb250YWluIG5vIGZ1bmN0aW9uIGRhdGFcblx0UGVyc2lzdGVuY2UucHJvdG90eXBlLnZhbGlkYXRlU29ydGVycyA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cdFx0ZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRpdGVtLmNvbHVtbiA9IGl0ZW0uZmllbGQ7XG5cdFx0XHRkZWxldGUgaXRlbS5maWVsZDtcblx0XHR9KTtcblxuXHRcdHJldHVybiBkYXRhO1xuXHR9O1xuXG5cdFBlcnNpc3RlbmNlLnByb3RvdHlwZS5nZXRHcm91cENvbmZpZyA9IGZ1bmN0aW9uICgpIHtcblx0XHRpZiAodGhpcy5jb25maWcuZ3JvdXApIHtcblx0XHRcdGlmICh0aGlzLmNvbmZpZy5ncm91cCA9PT0gdHJ1ZSB8fCB0aGlzLmNvbmZpZy5ncm91cC5ncm91cEJ5KSB7XG5cdFx0XHRcdGRhdGEuZ3JvdXBCeSA9IHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5O1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGhpcy5jb25maWcuZ3JvdXAgPT09IHRydWUgfHwgdGhpcy5jb25maWcuZ3JvdXAuZ3JvdXBTdGFydE9wZW4pIHtcblx0XHRcdFx0ZGF0YS5ncm91cFN0YXJ0T3BlbiA9IHRoaXMudGFibGUub3B0aW9ucy5ncm91cFN0YXJ0T3Blbjtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHRoaXMuY29uZmlnLmdyb3VwID09PSB0cnVlIHx8IHRoaXMuY29uZmlnLmdyb3VwLmdyb3VwSGVhZGVyKSB7XG5cdFx0XHRcdGRhdGEuZ3JvdXBIZWFkZXIgPSB0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBIZWFkZXI7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGRhdGE7XG5cdH07XG5cblx0UGVyc2lzdGVuY2UucHJvdG90eXBlLmdldFBhZ2VDb25maWcgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIGRhdGEgPSB7fTtcblxuXHRcdGlmICh0aGlzLmNvbmZpZy5wYWdlKSB7XG5cdFx0XHRpZiAodGhpcy5jb25maWcucGFnZSA9PT0gdHJ1ZSB8fCB0aGlzLmNvbmZpZy5wYWdlLnNpemUpIHtcblx0XHRcdFx0ZGF0YS5wYWdpbmF0aW9uU2l6ZSA9IHRoaXMudGFibGUubW9kdWxlcy5wYWdlLmdldFBhZ2VTaXplKCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLmNvbmZpZy5wYWdlID09PSB0cnVlIHx8IHRoaXMuY29uZmlnLnBhZ2UucGFnZSkge1xuXHRcdFx0XHRkYXRhLnBhZ2luYXRpb25Jbml0aWFsUGFnZSA9IHRoaXMudGFibGUubW9kdWxlcy5wYWdlLmdldFBhZ2UoKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gZGF0YTtcblx0fTtcblxuXHQvL3BhcnNlIGNvbHVtbnMgZm9yIGRhdGEgdG8gc3RvcmVcblx0UGVyc2lzdGVuY2UucHJvdG90eXBlLnBhcnNlQ29sdW1ucyA9IGZ1bmN0aW9uIChjb2x1bW5zKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBkZWZpbml0aW9ucyA9IFtdO1xuXG5cdFx0Y29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdHZhciBkZWZTdG9yZSA9IHt9LFxuXHRcdFx0ICAgIGNvbERlZiA9IGNvbHVtbi5nZXREZWZpbml0aW9uKCksXG5cdFx0XHQgICAga2V5cztcblxuXHRcdFx0aWYgKGNvbHVtbi5pc0dyb3VwKSB7XG5cdFx0XHRcdGRlZlN0b3JlLnRpdGxlID0gY29sRGVmLnRpdGxlO1xuXHRcdFx0XHRkZWZTdG9yZS5jb2x1bW5zID0gc2VsZi5wYXJzZUNvbHVtbnMoY29sdW1uLmdldENvbHVtbnMoKSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRkZWZTdG9yZS5maWVsZCA9IGNvbHVtbi5nZXRGaWVsZCgpO1xuXG5cdFx0XHRcdGlmIChzZWxmLmNvbmZpZy5jb2x1bW5zID09PSB0cnVlIHx8IHNlbGYuY29uZmlnLmNvbHVtbnMgPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0a2V5cyA9IE9iamVjdC5rZXlzKGNvbERlZik7XG5cdFx0XHRcdFx0a2V5cy5wdXNoKFwid2lkdGhcIik7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0a2V5cyA9IHNlbGYuY29uZmlnLmNvbHVtbnM7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRrZXlzLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuXG5cdFx0XHRcdFx0c3dpdGNoIChrZXkpIHtcblx0XHRcdFx0XHRcdGNhc2UgXCJ3aWR0aFwiOlxuXHRcdFx0XHRcdFx0XHRkZWZTdG9yZS53aWR0aCA9IGNvbHVtbi5nZXRXaWR0aCgpO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdGNhc2UgXCJ2aXNpYmxlXCI6XG5cdFx0XHRcdFx0XHRcdGRlZlN0b3JlLnZpc2libGUgPSBjb2x1bW4udmlzaWJsZTtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHRcdGRlZlN0b3JlW2tleV0gPSBjb2xEZWZba2V5XTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZpbml0aW9ucy5wdXNoKGRlZlN0b3JlKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBkZWZpbml0aW9ucztcblx0fTtcblxuXHQvLyByZWFkIHBlcmlzdGVuY2UgaW5mb3JtYXRpb24gZnJvbSBzdG9yYWdlXG5cdFBlcnNpc3RlbmNlLnByb3RvdHlwZS5yZWFkZXJzID0ge1xuXHRcdGxvY2FsOiBmdW5jdGlvbiBsb2NhbChpZCwgdHlwZSkge1xuXHRcdFx0dmFyIGRhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShpZCArIFwiLVwiICsgdHlwZSk7XG5cblx0XHRcdHJldHVybiBkYXRhID8gSlNPTi5wYXJzZShkYXRhKSA6IGZhbHNlO1xuXHRcdH0sXG5cdFx0Y29va2llOiBmdW5jdGlvbiBjb29raWUoaWQsIHR5cGUpIHtcblx0XHRcdHZhciBjb29raWUgPSBkb2N1bWVudC5jb29raWUsXG5cdFx0XHQgICAga2V5ID0gaWQgKyBcIi1cIiArIHR5cGUsXG5cdFx0XHQgICAgY29va2llUG9zID0gY29va2llLmluZGV4T2Yoa2V5ICsgXCI9XCIpLFxuXHRcdFx0ICAgIGVuZCxcblx0XHRcdCAgICBkYXRhO1xuXG5cdFx0XHQvL2lmIGNvb2tpZSBleGlzdHMsIGRlY29kZSBhbmQgbG9hZCBjb2x1bW4gZGF0YSBpbnRvIHRhYnVsYXRvclxuXHRcdFx0aWYgKGNvb2tpZVBvcyA+IC0xKSB7XG5cdFx0XHRcdGNvb2tpZSA9IGNvb2tpZS5zdWJzdHIoY29va2llUG9zKTtcblxuXHRcdFx0XHRlbmQgPSBjb29raWUuaW5kZXhPZihcIjtcIik7XG5cblx0XHRcdFx0aWYgKGVuZCA+IC0xKSB7XG5cdFx0XHRcdFx0Y29va2llID0gY29va2llLnN1YnN0cigwLCBlbmQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZGF0YSA9IGNvb2tpZS5yZXBsYWNlKGtleSArIFwiPVwiLCBcIlwiKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGRhdGEgPyBKU09OLnBhcnNlKGRhdGEpIDogZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdC8vd3JpdGUgcGVyc2lzdGVuY2UgaW5mb3JtYXRpb24gdG8gc3RvcmFnZVxuXHRQZXJzaXN0ZW5jZS5wcm90b3R5cGUud3JpdGVycyA9IHtcblx0XHRsb2NhbDogZnVuY3Rpb24gbG9jYWwoaWQsIHR5cGUsIGRhdGEpIHtcblx0XHRcdGxvY2FsU3RvcmFnZS5zZXRJdGVtKGlkICsgXCItXCIgKyB0eXBlLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG5cdFx0fSxcblx0XHRjb29raWU6IGZ1bmN0aW9uIGNvb2tpZShpZCwgdHlwZSwgZGF0YSkge1xuXHRcdFx0dmFyIGV4cGlyZURhdGUgPSBuZXcgRGF0ZSgpO1xuXG5cdFx0XHRleHBpcmVEYXRlLnNldERhdGUoZXhwaXJlRGF0ZS5nZXREYXRlKCkgKyAxMDAwMCk7XG5cblx0XHRcdGRvY3VtZW50LmNvb2tpZSA9IGlkICsgXCItXCIgKyB0eXBlICsgXCI9XCIgKyBKU09OLnN0cmluZ2lmeShkYXRhKSArIFwiOyBleHBpcmVzPVwiICsgZXhwaXJlRGF0ZS50b1VUQ1N0cmluZygpO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnJlZ2lzdGVyTW9kdWxlKFwicGVyc2lzdGVuY2VcIiwgUGVyc2lzdGVuY2UpO1xuXG5cdHZhciBQcmludCA9IGZ1bmN0aW9uIFByaW50KHRhYmxlKSB7XG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlOyAvL2hvbGQgVGFidWxhdG9yIG9iamVjdFxuXHRcdHRoaXMuZWxlbWVudCA9IGZhbHNlO1xuXHRcdHRoaXMubWFudWFsQmxvY2sgPSBmYWxzZTtcblx0fTtcblxuXHRQcmludC5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcblx0XHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImJlZm9yZXByaW50XCIsIHRoaXMucmVwbGFjZVRhYmxlLmJpbmQodGhpcykpO1xuXHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiYWZ0ZXJwcmludFwiLCB0aGlzLmNsZWFudXAuYmluZCh0aGlzKSk7XG5cdH07XG5cblx0UHJpbnQucHJvdG90eXBlLnJlcGxhY2VUYWJsZSA9IGZ1bmN0aW9uICgpIHtcblx0XHRpZiAoIXRoaXMubWFudWFsQmxvY2spIHtcblx0XHRcdHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0XHR0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wcmludC10YWJsZVwiKTtcblxuXHRcdFx0dGhpcy5lbGVtZW50LmFwcGVuZENoaWxkKHRoaXMudGFibGUubW9kdWxlcy5leHBvcnQuZ2VuZXJlYXRlVGFibGUodGhpcy50YWJsZS5vcHRpb25zLnByaW50Q29uZmlnLCB0aGlzLnRhYmxlLm9wdGlvbnMucHJpbnRTdHlsZWQsIHRoaXMudGFibGUub3B0aW9ucy5wcmludFJvd1JhbmdlLCBcInByaW50XCIpKTtcblxuXHRcdFx0dGhpcy50YWJsZS5lbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblxuXHRcdFx0dGhpcy50YWJsZS5lbGVtZW50LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMuZWxlbWVudCwgdGhpcy50YWJsZS5lbGVtZW50KTtcblx0XHR9XG5cdH07XG5cblx0UHJpbnQucHJvdG90eXBlLmNsZWFudXAgPSBmdW5jdGlvbiAoKSB7XG5cdFx0ZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLXByaW50LWZ1bGxzY3JlZW4taGlkZVwiKTtcblxuXHRcdGlmICh0aGlzLmVsZW1lbnQgJiYgdGhpcy5lbGVtZW50LnBhcmVudE5vZGUpIHtcblx0XHRcdHRoaXMuZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudCk7XG5cdFx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwiXCI7XG5cdFx0fVxuXHR9O1xuXG5cdFByaW50LnByb3RvdHlwZS5wcmludEZ1bGxzY3JlZW4gPSBmdW5jdGlvbiAodmlzaWJsZSwgc3R5bGUsIGNvbmZpZykge1xuXHRcdHZhciBzY3JvbGxYID0gd2luZG93LnNjcm9sbFgsXG5cdFx0ICAgIHNjcm9sbFkgPSB3aW5kb3cuc2Nyb2xsWSxcblx0XHQgICAgaGVhZGVyRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLFxuXHRcdCAgICBmb290ZXJFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiksXG5cdFx0ICAgIHRhYmxlRWwgPSB0aGlzLnRhYmxlLm1vZHVsZXMuZXhwb3J0LmdlbmVyZWF0ZVRhYmxlKHR5cGVvZiBjb25maWcgIT0gXCJ1bmRlZmluZWRcIiA/IGNvbmZpZyA6IHRoaXMudGFibGUub3B0aW9ucy5wcmludENvbmZpZywgdHlwZW9mIHN0eWxlICE9IFwidW5kZWZpbmVkXCIgPyBzdHlsZSA6IHRoaXMudGFibGUub3B0aW9ucy5wcmludFN0eWxlZCwgdmlzaWJsZSwgXCJwcmludFwiKSxcblx0XHQgICAgaGVhZGVyQ29udGVudCxcblx0XHQgICAgZm9vdGVyQ29udGVudDtcblxuXHRcdHRoaXMubWFudWFsQmxvY2sgPSB0cnVlO1xuXG5cdFx0dGhpcy5lbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHR0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wcmludC1mdWxsc2NyZWVuXCIpO1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5wcmludEhlYWRlcikge1xuXHRcdFx0aGVhZGVyRWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wcmludC1oZWFkZXJcIik7XG5cblx0XHRcdGhlYWRlckNvbnRlbnQgPSB0eXBlb2YgdGhpcy50YWJsZS5vcHRpb25zLnByaW50SGVhZGVyID09IFwiZnVuY3Rpb25cIiA/IHRoaXMudGFibGUub3B0aW9ucy5wcmludEhlYWRlci5jYWxsKHRoaXMudGFibGUpIDogdGhpcy50YWJsZS5vcHRpb25zLnByaW50SGVhZGVyO1xuXG5cdFx0XHRpZiAodHlwZW9mIGhlYWRlckNvbnRlbnQgPT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHRoZWFkZXJFbC5pbm5lckhUTUwgPSBoZWFkZXJDb250ZW50O1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aGVhZGVyRWwuYXBwZW5kQ2hpbGQoaGVhZGVyQ29udGVudCk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZChoZWFkZXJFbCk7XG5cdFx0fVxuXG5cdFx0dGhpcy5lbGVtZW50LmFwcGVuZENoaWxkKHRhYmxlRWwpO1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5wcmludEZvb3Rlcikge1xuXHRcdFx0Zm9vdGVyRWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wcmludC1mb290ZXJcIik7XG5cblx0XHRcdGZvb3RlckNvbnRlbnQgPSB0eXBlb2YgdGhpcy50YWJsZS5vcHRpb25zLnByaW50Rm9vdGVyID09IFwiZnVuY3Rpb25cIiA/IHRoaXMudGFibGUub3B0aW9ucy5wcmludEZvb3Rlci5jYWxsKHRoaXMudGFibGUpIDogdGhpcy50YWJsZS5vcHRpb25zLnByaW50Rm9vdGVyO1xuXG5cdFx0XHRpZiAodHlwZW9mIGZvb3RlckNvbnRlbnQgPT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHRmb290ZXJFbC5pbm5lckhUTUwgPSBmb290ZXJDb250ZW50O1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Zm9vdGVyRWwuYXBwZW5kQ2hpbGQoZm9vdGVyQ29udGVudCk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZChmb290ZXJFbCk7XG5cdFx0fVxuXG5cdFx0ZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXByaW50LWZ1bGxzY3JlZW4taGlkZVwiKTtcblx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuZWxlbWVudCk7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnByaW50Rm9ybWF0dGVyKSB7XG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMucHJpbnRGb3JtYXR0ZXIodGhpcy5lbGVtZW50LCB0YWJsZUVsKTtcblx0XHR9XG5cblx0XHR3aW5kb3cucHJpbnQoKTtcblxuXHRcdHRoaXMuY2xlYW51cCgpO1xuXG5cdFx0d2luZG93LnNjcm9sbFRvKHNjcm9sbFgsIHNjcm9sbFkpO1xuXG5cdFx0dGhpcy5tYW51YWxCbG9jayA9IGZhbHNlO1xuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJwcmludFwiLCBQcmludCk7XG5cdHZhciBSZWFjdGl2ZURhdGEgPSBmdW5jdGlvbiBSZWFjdGl2ZURhdGEodGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdFx0dGhpcy5kYXRhID0gZmFsc2U7XG5cdFx0dGhpcy5ibG9ja2VkID0gZmFsc2U7IC8vYmxvY2sgcmVhY3Rpdml0eSB3aGlsZSBwZXJmb3JtaW5nIHVwZGF0ZVxuXHRcdHRoaXMub3JpZ0Z1bmNzID0ge307IC8vIGhvbGQgb3JpZ2luYWwgZGF0YSBhcnJheSBmdW5jdGlvbnMgdG8gYWxsb3cgcmVwbGFjZW1lbnQgYWZ0ZXIgZGF0YSBpcyBkb25lIHdpdGhcblx0XHR0aGlzLmN1cnJlbnRWZXJzaW9uID0gMDtcblx0fTtcblxuXHRSZWFjdGl2ZURhdGEucHJvdG90eXBlLndhdGNoRGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBwdXNoRnVuYyxcblx0XHQgICAgdmVyc2lvbjtcblxuXHRcdHRoaXMuY3VycmVudFZlcnNpb24rKztcblxuXHRcdHZlcnNpb24gPSB0aGlzLmN1cnJlbnRWZXJzaW9uO1xuXG5cdFx0c2VsZi51bndhdGNoRGF0YSgpO1xuXG5cdFx0c2VsZi5kYXRhID0gZGF0YTtcblxuXHRcdC8vb3ZlcnJpZGUgYXJyYXkgcHVzaCBmdW5jdGlvblxuXHRcdHNlbGYub3JpZ0Z1bmNzLnB1c2ggPSBkYXRhLnB1c2g7XG5cblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoc2VsZi5kYXRhLCBcInB1c2hcIiwge1xuXHRcdFx0ZW51bWVyYWJsZTogZmFsc2UsXG5cdFx0XHRjb25maWd1cmFibGU6IHRydWUsXG5cdFx0XHR2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7XG5cdFx0XHRcdHZhciBhcmdzID0gQXJyYXkuZnJvbShhcmd1bWVudHMpO1xuXG5cdFx0XHRcdGlmICghc2VsZi5ibG9ja2VkICYmIHZlcnNpb24gPT09IHNlbGYuY3VycmVudFZlcnNpb24pIHtcblx0XHRcdFx0XHRhcmdzLmZvckVhY2goZnVuY3Rpb24gKGFyZykge1xuXHRcdFx0XHRcdFx0c2VsZi50YWJsZS5yb3dNYW5hZ2VyLmFkZFJvd0FjdHVhbChhcmcsIGZhbHNlKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBzZWxmLm9yaWdGdW5jcy5wdXNoLmFwcGx5KGRhdGEsIGFyZ3VtZW50cyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvL292ZXJyaWRlIGFycmF5IHVuc2hpZnQgZnVuY3Rpb25cblx0XHRzZWxmLm9yaWdGdW5jcy51bnNoaWZ0ID0gZGF0YS51bnNoaWZ0O1xuXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHNlbGYuZGF0YSwgXCJ1bnNoaWZ0XCIsIHtcblx0XHRcdGVudW1lcmFibGU6IGZhbHNlLFxuXHRcdFx0Y29uZmlndXJhYmxlOiB0cnVlLFxuXHRcdFx0dmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkge1xuXHRcdFx0XHR2YXIgYXJncyA9IEFycmF5LmZyb20oYXJndW1lbnRzKTtcblxuXHRcdFx0XHRpZiAoIXNlbGYuYmxvY2tlZCAmJiB2ZXJzaW9uID09PSBzZWxmLmN1cnJlbnRWZXJzaW9uKSB7XG5cdFx0XHRcdFx0YXJncy5mb3JFYWNoKGZ1bmN0aW9uIChhcmcpIHtcblx0XHRcdFx0XHRcdHNlbGYudGFibGUucm93TWFuYWdlci5hZGRSb3dBY3R1YWwoYXJnLCB0cnVlKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBzZWxmLm9yaWdGdW5jcy51bnNoaWZ0LmFwcGx5KGRhdGEsIGFyZ3VtZW50cyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvL292ZXJyaWRlIGFycmF5IHNoaWZ0IGZ1bmN0aW9uXG5cdFx0c2VsZi5vcmlnRnVuY3Muc2hpZnQgPSBkYXRhLnNoaWZ0O1xuXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHNlbGYuZGF0YSwgXCJzaGlmdFwiLCB7XG5cdFx0XHRlbnVtZXJhYmxlOiBmYWxzZSxcblx0XHRcdGNvbmZpZ3VyYWJsZTogdHJ1ZSxcblx0XHRcdHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHtcblx0XHRcdFx0dmFyIHJvdztcblxuXHRcdFx0XHRpZiAoIXNlbGYuYmxvY2tlZCAmJiB2ZXJzaW9uID09PSBzZWxmLmN1cnJlbnRWZXJzaW9uKSB7XG5cdFx0XHRcdFx0aWYgKHNlbGYuZGF0YS5sZW5ndGgpIHtcblx0XHRcdFx0XHRcdHJvdyA9IHNlbGYudGFibGUucm93TWFuYWdlci5nZXRSb3dGcm9tRGF0YU9iamVjdChzZWxmLmRhdGFbMF0pO1xuXG5cdFx0XHRcdFx0XHRpZiAocm93KSB7XG5cdFx0XHRcdFx0XHRcdHJvdy5kZWxldGVBY3R1YWwoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gc2VsZi5vcmlnRnVuY3Muc2hpZnQuY2FsbChkYXRhKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdC8vb3ZlcnJpZGUgYXJyYXkgcG9wIGZ1bmN0aW9uXG5cdFx0c2VsZi5vcmlnRnVuY3MucG9wID0gZGF0YS5wb3A7XG5cblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoc2VsZi5kYXRhLCBcInBvcFwiLCB7XG5cdFx0XHRlbnVtZXJhYmxlOiBmYWxzZSxcblx0XHRcdGNvbmZpZ3VyYWJsZTogdHJ1ZSxcblx0XHRcdHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHtcblx0XHRcdFx0dmFyIHJvdztcblx0XHRcdFx0aWYgKCFzZWxmLmJsb2NrZWQgJiYgdmVyc2lvbiA9PT0gc2VsZi5jdXJyZW50VmVyc2lvbikge1xuXHRcdFx0XHRcdGlmIChzZWxmLmRhdGEubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHRyb3cgPSBzZWxmLnRhYmxlLnJvd01hbmFnZXIuZ2V0Um93RnJvbURhdGFPYmplY3Qoc2VsZi5kYXRhW3NlbGYuZGF0YS5sZW5ndGggLSAxXSk7XG5cblx0XHRcdFx0XHRcdGlmIChyb3cpIHtcblx0XHRcdFx0XHRcdFx0cm93LmRlbGV0ZUFjdHVhbCgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gc2VsZi5vcmlnRnVuY3MucG9wLmNhbGwoZGF0YSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvL292ZXJyaWRlIGFycmF5IHNwbGljZSBmdW5jdGlvblxuXHRcdHNlbGYub3JpZ0Z1bmNzLnNwbGljZSA9IGRhdGEuc3BsaWNlO1xuXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHNlbGYuZGF0YSwgXCJzcGxpY2VcIiwge1xuXHRcdFx0ZW51bWVyYWJsZTogZmFsc2UsXG5cdFx0XHRjb25maWd1cmFibGU6IHRydWUsXG5cdFx0XHR2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7XG5cdFx0XHRcdHZhciBhcmdzID0gQXJyYXkuZnJvbShhcmd1bWVudHMpLFxuXHRcdFx0XHQgICAgc3RhcnQgPSBhcmdzWzBdIDwgMCA/IGRhdGEubGVuZ3RoICsgYXJnc1swXSA6IGFyZ3NbMF0sXG5cdFx0XHRcdCAgICBlbmQgPSBhcmdzWzFdLFxuXHRcdFx0XHQgICAgbmV3Um93cyA9IGFyZ3NbMl0gPyBhcmdzLnNsaWNlKDIpIDogZmFsc2UsXG5cdFx0XHRcdCAgICBzdGFydFJvdztcblxuXHRcdFx0XHRpZiAoIXNlbGYuYmxvY2tlZCAmJiB2ZXJzaW9uID09PSBzZWxmLmN1cnJlbnRWZXJzaW9uKSB7XG5cblx0XHRcdFx0XHQvL2FkZCBuZXcgcm93c1xuXHRcdFx0XHRcdGlmIChuZXdSb3dzKSB7XG5cdFx0XHRcdFx0XHRzdGFydFJvdyA9IGRhdGFbc3RhcnRdID8gc2VsZi50YWJsZS5yb3dNYW5hZ2VyLmdldFJvd0Zyb21EYXRhT2JqZWN0KGRhdGFbc3RhcnRdKSA6IGZhbHNlO1xuXG5cdFx0XHRcdFx0XHRpZiAoc3RhcnRSb3cpIHtcblx0XHRcdFx0XHRcdFx0bmV3Um93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3dEYXRhKSB7XG5cdFx0XHRcdFx0XHRcdFx0c2VsZi50YWJsZS5yb3dNYW5hZ2VyLmFkZFJvd0FjdHVhbChyb3dEYXRhLCB0cnVlLCBzdGFydFJvdywgdHJ1ZSk7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0bmV3Um93cyA9IG5ld1Jvd3Muc2xpY2UoKS5yZXZlcnNlKCk7XG5cblx0XHRcdFx0XHRcdFx0bmV3Um93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3dEYXRhKSB7XG5cdFx0XHRcdFx0XHRcdFx0c2VsZi50YWJsZS5yb3dNYW5hZ2VyLmFkZFJvd0FjdHVhbChyb3dEYXRhLCB0cnVlLCBmYWxzZSwgdHJ1ZSk7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vZGVsZXRlIHJlbW92ZWQgcm93c1xuXHRcdFx0XHRcdGlmIChlbmQgIT09IDApIHtcblx0XHRcdFx0XHRcdHZhciBvbGRSb3dzID0gZGF0YS5zbGljZShzdGFydCwgdHlwZW9mIGFyZ3NbMV0gPT09IFwidW5kZWZpbmVkXCIgPyBhcmdzWzFdIDogc3RhcnQgKyBlbmQpO1xuXG5cdFx0XHRcdFx0XHRvbGRSb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvd0RhdGEsIGkpIHtcblx0XHRcdFx0XHRcdFx0dmFyIHJvdyA9IHNlbGYudGFibGUucm93TWFuYWdlci5nZXRSb3dGcm9tRGF0YU9iamVjdChyb3dEYXRhKTtcblxuXHRcdFx0XHRcdFx0XHRpZiAocm93KSB7XG5cdFx0XHRcdFx0XHRcdFx0cm93LmRlbGV0ZUFjdHVhbChpICE9PSBvbGRSb3dzLmxlbmd0aCAtIDEpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAobmV3Um93cyB8fCBlbmQgIT09IDApIHtcblx0XHRcdFx0XHRcdHNlbGYudGFibGUucm93TWFuYWdlci5yZVJlbmRlckluUG9zaXRpb24oKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gc2VsZi5vcmlnRnVuY3Muc3BsaWNlLmFwcGx5KGRhdGEsIGFyZ3VtZW50cyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0UmVhY3RpdmVEYXRhLnByb3RvdHlwZS51bndhdGNoRGF0YSA9IGZ1bmN0aW9uICgpIHtcblx0XHRpZiAodGhpcy5kYXRhICE9PSBmYWxzZSkge1xuXHRcdFx0Zm9yICh2YXIga2V5IGluIHRoaXMub3JpZ0Z1bmNzKSB7XG5cdFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLmRhdGEsIGtleSwge1xuXHRcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG5cdFx0XHRcdFx0Y29uZmlndXJhYmxlOiB0cnVlLFxuXHRcdFx0XHRcdHdyaXRhYmxlOiB0cnVlLFxuXHRcdFx0XHRcdHZhbHVlOiB0aGlzLm9yaWdGdW5jcy5rZXlcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFJlYWN0aXZlRGF0YS5wcm90b3R5cGUud2F0Y2hSb3cgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBkYXRhID0gcm93LmdldERhdGEoKTtcblxuXHRcdHRoaXMuYmxvY2tlZCA9IHRydWU7XG5cblx0XHRmb3IgKHZhciBrZXkgaW4gZGF0YSkge1xuXHRcdFx0dGhpcy53YXRjaEtleShyb3csIGRhdGEsIGtleSk7XG5cdFx0fVxuXG5cdFx0dGhpcy5ibG9ja2VkID0gZmFsc2U7XG5cdH07XG5cblx0UmVhY3RpdmVEYXRhLnByb3RvdHlwZS53YXRjaEtleSA9IGZ1bmN0aW9uIChyb3csIGRhdGEsIGtleSkge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgcHJvcHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGRhdGEsIGtleSksXG5cdFx0ICAgIHZhbHVlID0gZGF0YVtrZXldLFxuXHRcdCAgICB2ZXJzaW9uID0gdGhpcy5jdXJyZW50VmVyc2lvbjtcblxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkYXRhLCBrZXksIHtcblx0XHRcdHNldDogZnVuY3Rpb24gc2V0KG5ld1ZhbHVlKSB7XG5cdFx0XHRcdHZhbHVlID0gbmV3VmFsdWU7XG5cdFx0XHRcdGlmICghc2VsZi5ibG9ja2VkICYmIHZlcnNpb24gPT09IHNlbGYuY3VycmVudFZlcnNpb24pIHtcblx0XHRcdFx0XHR2YXIgdXBkYXRlID0ge307XG5cdFx0XHRcdFx0dXBkYXRlW2tleV0gPSBuZXdWYWx1ZTtcblx0XHRcdFx0XHRyb3cudXBkYXRlRGF0YSh1cGRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHByb3BzLnNldCkge1xuXHRcdFx0XHRcdHByb3BzLnNldChuZXdWYWx1ZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cdFx0XHRnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcblxuXHRcdFx0XHRpZiAocHJvcHMuZ2V0KSB7XG5cdFx0XHRcdFx0cHJvcHMuZ2V0KCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0UmVhY3RpdmVEYXRhLnByb3RvdHlwZS51bndhdGNoUm93ID0gZnVuY3Rpb24gKHJvdykge1xuXHRcdHZhciBkYXRhID0gcm93LmdldERhdGEoKTtcblxuXHRcdGZvciAodmFyIGtleSBpbiBkYXRhKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZGF0YSwga2V5LCB7XG5cdFx0XHRcdHZhbHVlOiBkYXRhW2tleV1cblx0XHRcdH0pO1xuXHRcdH1cblx0fTtcblxuXHRSZWFjdGl2ZURhdGEucHJvdG90eXBlLmJsb2NrID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMuYmxvY2tlZCA9IHRydWU7XG5cdH07XG5cblx0UmVhY3RpdmVEYXRhLnByb3RvdHlwZS51bmJsb2NrID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMuYmxvY2tlZCA9IGZhbHNlO1xuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJyZWFjdGl2ZURhdGFcIiwgUmVhY3RpdmVEYXRhKTtcblxuXHR2YXIgUmVzaXplQ29sdW1ucyA9IGZ1bmN0aW9uIFJlc2l6ZUNvbHVtbnModGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdFx0dGhpcy5zdGFydENvbHVtbiA9IGZhbHNlO1xuXHRcdHRoaXMuc3RhcnRYID0gZmFsc2U7XG5cdFx0dGhpcy5zdGFydFdpZHRoID0gZmFsc2U7XG5cdFx0dGhpcy5oYW5kbGUgPSBudWxsO1xuXHRcdHRoaXMucHJldkhhbmRsZSA9IG51bGw7XG5cdH07XG5cblx0UmVzaXplQ29sdW1ucy5wcm90b3R5cGUuaW5pdGlhbGl6ZUNvbHVtbiA9IGZ1bmN0aW9uICh0eXBlLCBjb2x1bW4sIGVsZW1lbnQpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHZhcmlhYmxlSGVpZ2h0ID0gZmFsc2UsXG5cdFx0ICAgIG1vZGUgPSB0aGlzLnRhYmxlLm9wdGlvbnMucmVzaXphYmxlQ29sdW1ucztcblxuXHRcdC8vc2V0IGNvbHVtbiByZXNpemUgbW9kZVxuXHRcdGlmICh0eXBlID09PSBcImhlYWRlclwiKSB7XG5cdFx0XHR2YXJpYWJsZUhlaWdodCA9IGNvbHVtbi5kZWZpbml0aW9uLmZvcm1hdHRlciA9PSBcInRleHRhcmVhXCIgfHwgY29sdW1uLmRlZmluaXRpb24udmFyaWFibGVIZWlnaHQ7XG5cdFx0XHRjb2x1bW4ubW9kdWxlcy5yZXNpemUgPSB7IHZhcmlhYmxlSGVpZ2h0OiB2YXJpYWJsZUhlaWdodCB9O1xuXHRcdH1cblxuXHRcdGlmIChtb2RlID09PSB0cnVlIHx8IG1vZGUgPT0gdHlwZSkge1xuXG5cdFx0XHR2YXIgaGFuZGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cdFx0XHRoYW5kbGUuY2xhc3NOYW1lID0gXCJ0YWJ1bGF0b3ItY29sLXJlc2l6ZS1oYW5kbGVcIjtcblxuXHRcdFx0dmFyIHByZXZIYW5kbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRcdHByZXZIYW5kbGUuY2xhc3NOYW1lID0gXCJ0YWJ1bGF0b3ItY29sLXJlc2l6ZS1oYW5kbGUgcHJldlwiO1xuXG5cdFx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0dmFyIGhhbmRsZURvd24gPSBmdW5jdGlvbiBoYW5kbGVEb3duKGUpIHtcblx0XHRcdFx0dmFyIG5lYXJlc3RDb2x1bW4gPSBjb2x1bW4uZ2V0TGFzdENvbHVtbigpO1xuXG5cdFx0XHRcdGlmIChuZWFyZXN0Q29sdW1uICYmIHNlbGYuX2NoZWNrUmVzaXphYmlsaXR5KG5lYXJlc3RDb2x1bW4pKSB7XG5cdFx0XHRcdFx0c2VsZi5zdGFydENvbHVtbiA9IGNvbHVtbjtcblx0XHRcdFx0XHRzZWxmLl9tb3VzZURvd24oZSwgbmVhcmVzdENvbHVtbiwgaGFuZGxlKTtcblx0XHRcdFx0fVxuXHRcdFx0fTtcblxuXHRcdFx0aGFuZGxlLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgaGFuZGxlRG93bik7XG5cdFx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgaGFuZGxlRG93biwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuXG5cdFx0XHQvL3Jlc3ppZSBjb2x1bW4gb24gIGRvdWJsZSBjbGlja1xuXHRcdFx0aGFuZGxlLmFkZEV2ZW50TGlzdGVuZXIoXCJkYmxjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHR2YXIgY29sID0gY29sdW1uLmdldExhc3RDb2x1bW4oKTtcblxuXHRcdFx0XHRpZiAoY29sICYmIHNlbGYuX2NoZWNrUmVzaXphYmlsaXR5KGNvbCkpIHtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdGNvbC5yZWluaXRpYWxpemVXaWR0aCh0cnVlKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHByZXZIYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0dmFyIHByZXZIYW5kbGVEb3duID0gZnVuY3Rpb24gcHJldkhhbmRsZURvd24oZSkge1xuXHRcdFx0XHR2YXIgbmVhcmVzdENvbHVtbiwgY29sSW5kZXgsIHByZXZDb2x1bW47XG5cblx0XHRcdFx0bmVhcmVzdENvbHVtbiA9IGNvbHVtbi5nZXRGaXJzdENvbHVtbigpO1xuXG5cdFx0XHRcdGlmIChuZWFyZXN0Q29sdW1uKSB7XG5cdFx0XHRcdFx0Y29sSW5kZXggPSBzZWxmLnRhYmxlLmNvbHVtbk1hbmFnZXIuZmluZENvbHVtbkluZGV4KG5lYXJlc3RDb2x1bW4pO1xuXHRcdFx0XHRcdHByZXZDb2x1bW4gPSBjb2xJbmRleCA+IDAgPyBzZWxmLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0Q29sdW1uQnlJbmRleChjb2xJbmRleCAtIDEpIDogZmFsc2U7XG5cblx0XHRcdFx0XHRpZiAocHJldkNvbHVtbiAmJiBzZWxmLl9jaGVja1Jlc2l6YWJpbGl0eShwcmV2Q29sdW1uKSkge1xuXHRcdFx0XHRcdFx0c2VsZi5zdGFydENvbHVtbiA9IGNvbHVtbjtcblx0XHRcdFx0XHRcdHNlbGYuX21vdXNlRG93bihlLCBwcmV2Q29sdW1uLCBwcmV2SGFuZGxlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH07XG5cblx0XHRcdHByZXZIYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBwcmV2SGFuZGxlRG93bik7XG5cdFx0XHRwcmV2SGFuZGxlLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIHByZXZIYW5kbGVEb3duLCB7IHBhc3NpdmU6IHRydWUgfSk7XG5cblx0XHRcdC8vcmVzaXplIGNvbHVtbiBvbiBkb3VibGUgY2xpY2tcblx0XHRcdHByZXZIYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcImRibGNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdHZhciBuZWFyZXN0Q29sdW1uLCBjb2xJbmRleCwgcHJldkNvbHVtbjtcblxuXHRcdFx0XHRuZWFyZXN0Q29sdW1uID0gY29sdW1uLmdldEZpcnN0Q29sdW1uKCk7XG5cblx0XHRcdFx0aWYgKG5lYXJlc3RDb2x1bW4pIHtcblx0XHRcdFx0XHRjb2xJbmRleCA9IHNlbGYudGFibGUuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uSW5kZXgobmVhcmVzdENvbHVtbik7XG5cdFx0XHRcdFx0cHJldkNvbHVtbiA9IGNvbEluZGV4ID4gMCA/IHNlbGYudGFibGUuY29sdW1uTWFuYWdlci5nZXRDb2x1bW5CeUluZGV4KGNvbEluZGV4IC0gMSkgOiBmYWxzZTtcblxuXHRcdFx0XHRcdGlmIChwcmV2Q29sdW1uICYmIHNlbGYuX2NoZWNrUmVzaXphYmlsaXR5KHByZXZDb2x1bW4pKSB7XG5cdFx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0cHJldkNvbHVtbi5yZWluaXRpYWxpemVXaWR0aCh0cnVlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRlbGVtZW50LmFwcGVuZENoaWxkKGhhbmRsZSk7XG5cdFx0XHRlbGVtZW50LmFwcGVuZENoaWxkKHByZXZIYW5kbGUpO1xuXHRcdH1cblx0fTtcblxuXHRSZXNpemVDb2x1bW5zLnByb3RvdHlwZS5fY2hlY2tSZXNpemFiaWxpdHkgPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0cmV0dXJuIHR5cGVvZiBjb2x1bW4uZGVmaW5pdGlvbi5yZXNpemFibGUgIT0gXCJ1bmRlZmluZWRcIiA/IGNvbHVtbi5kZWZpbml0aW9uLnJlc2l6YWJsZSA6IHRoaXMudGFibGUub3B0aW9ucy5yZXNpemFibGVDb2x1bW5zO1xuXHR9O1xuXG5cdFJlc2l6ZUNvbHVtbnMucHJvdG90eXBlLl9tb3VzZURvd24gPSBmdW5jdGlvbiAoZSwgY29sdW1uLCBoYW5kbGUpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRzZWxmLnRhYmxlLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1ibG9jay1zZWxlY3RcIik7XG5cblx0XHRmdW5jdGlvbiBtb3VzZU1vdmUoZSkge1xuXHRcdFx0Ly8gc2VsZi50YWJsZS5jb2x1bW5NYW5hZ2VyLnRlbXBTY3JvbGxCbG9jaygpO1xuXG5cdFx0XHRjb2x1bW4uc2V0V2lkdGgoc2VsZi5zdGFydFdpZHRoICsgKCh0eXBlb2YgZS5zY3JlZW5YID09PSBcInVuZGVmaW5lZFwiID8gZS50b3VjaGVzWzBdLnNjcmVlblggOiBlLnNjcmVlblgpIC0gc2VsZi5zdGFydFgpKTtcblxuXHRcdFx0aWYgKCFzZWxmLnRhYmxlLmJyb3dzZXJTbG93ICYmIGNvbHVtbi5tb2R1bGVzLnJlc2l6ZSAmJiBjb2x1bW4ubW9kdWxlcy5yZXNpemUudmFyaWFibGVIZWlnaHQpIHtcblx0XHRcdFx0Y29sdW1uLmNoZWNrQ2VsbEhlaWdodHMoKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRmdW5jdGlvbiBtb3VzZVVwKGUpIHtcblxuXHRcdFx0Ly9ibG9jayBlZGl0b3IgZnJvbSB0YWtpbmcgYWN0aW9uIHdoaWxlIHJlc2l6aW5nIGlzIHRha2luZyBwbGFjZVxuXHRcdFx0aWYgKHNlbGYuc3RhcnRDb2x1bW4ubW9kdWxlcy5lZGl0KSB7XG5cdFx0XHRcdHNlbGYuc3RhcnRDb2x1bW4ubW9kdWxlcy5lZGl0LmJsb2NrZWQgPSBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHNlbGYudGFibGUuYnJvd3NlclNsb3cgJiYgY29sdW1uLm1vZHVsZXMucmVzaXplICYmIGNvbHVtbi5tb2R1bGVzLnJlc2l6ZS52YXJpYWJsZUhlaWdodCkge1xuXHRcdFx0XHRjb2x1bW4uY2hlY2tDZWxsSGVpZ2h0cygpO1xuXHRcdFx0fVxuXG5cdFx0XHRkb2N1bWVudC5ib2R5LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIG1vdXNlVXApO1xuXHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIG1vdXNlTW92ZSk7XG5cblx0XHRcdGhhbmRsZS5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIG1vdXNlTW92ZSk7XG5cdFx0XHRoYW5kbGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIG1vdXNlVXApO1xuXG5cdFx0XHRzZWxmLnRhYmxlLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcInRhYnVsYXRvci1ibG9jay1zZWxlY3RcIik7XG5cblx0XHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UgJiYgc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJwZXJzaXN0ZW5jZVwiLCB0cnVlKSAmJiBzZWxmLnRhYmxlLm1vZHVsZXMucGVyc2lzdGVuY2UuY29uZmlnLmNvbHVtbnMpIHtcblx0XHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLnNhdmUoXCJjb2x1bW5zXCIpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMuY29sdW1uUmVzaXplZC5jYWxsKHNlbGYudGFibGUsIGNvbHVtbi5nZXRDb21wb25lbnQoKSk7XG5cdFx0fVxuXG5cdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTsgLy9wcmV2ZW50IHJlc2l6ZSBmcm9tIGludGVyZmVyZWluZyB3aXRoIG1vdmFibGUgY29sdW1uc1xuXG5cdFx0Ly9ibG9jayBlZGl0b3IgZnJvbSB0YWtpbmcgYWN0aW9uIHdoaWxlIHJlc2l6aW5nIGlzIHRha2luZyBwbGFjZVxuXHRcdGlmIChzZWxmLnN0YXJ0Q29sdW1uLm1vZHVsZXMuZWRpdCkge1xuXHRcdFx0c2VsZi5zdGFydENvbHVtbi5tb2R1bGVzLmVkaXQuYmxvY2tlZCA9IHRydWU7XG5cdFx0fVxuXG5cdFx0c2VsZi5zdGFydFggPSB0eXBlb2YgZS5zY3JlZW5YID09PSBcInVuZGVmaW5lZFwiID8gZS50b3VjaGVzWzBdLnNjcmVlblggOiBlLnNjcmVlblg7XG5cdFx0c2VsZi5zdGFydFdpZHRoID0gY29sdW1uLmdldFdpZHRoKCk7XG5cblx0XHRkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgbW91c2VNb3ZlKTtcblx0XHRkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIG1vdXNlVXApO1xuXHRcdGhhbmRsZS5hZGRFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIG1vdXNlTW92ZSwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuXHRcdGhhbmRsZS5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgbW91c2VVcCk7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcInJlc2l6ZUNvbHVtbnNcIiwgUmVzaXplQ29sdW1ucyk7XG5cdHZhciBSZXNpemVSb3dzID0gZnVuY3Rpb24gUmVzaXplUm93cyh0YWJsZSkge1xuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIFRhYnVsYXRvciBvYmplY3Rcblx0XHR0aGlzLnN0YXJ0Q29sdW1uID0gZmFsc2U7XG5cdFx0dGhpcy5zdGFydFkgPSBmYWxzZTtcblx0XHR0aGlzLnN0YXJ0SGVpZ2h0ID0gZmFsc2U7XG5cdFx0dGhpcy5oYW5kbGUgPSBudWxsO1xuXHRcdHRoaXMucHJldkhhbmRsZSA9IG51bGw7XG5cdH07XG5cblx0UmVzaXplUm93cy5wcm90b3R5cGUuaW5pdGlhbGl6ZVJvdyA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHJvd0VsID0gcm93LmdldEVsZW1lbnQoKTtcblxuXHRcdHZhciBoYW5kbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRoYW5kbGUuY2xhc3NOYW1lID0gXCJ0YWJ1bGF0b3Itcm93LXJlc2l6ZS1oYW5kbGVcIjtcblxuXHRcdHZhciBwcmV2SGFuZGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cdFx0cHJldkhhbmRsZS5jbGFzc05hbWUgPSBcInRhYnVsYXRvci1yb3ctcmVzaXplLWhhbmRsZSBwcmV2XCI7XG5cblx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdH0pO1xuXG5cdFx0dmFyIGhhbmRsZURvd24gPSBmdW5jdGlvbiBoYW5kbGVEb3duKGUpIHtcblx0XHRcdHNlbGYuc3RhcnRSb3cgPSByb3c7XG5cdFx0XHRzZWxmLl9tb3VzZURvd24oZSwgcm93LCBoYW5kbGUpO1xuXHRcdH07XG5cblx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBoYW5kbGVEb3duKTtcblx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgaGFuZGxlRG93biwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuXG5cdFx0cHJldkhhbmRsZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0fSk7XG5cblx0XHR2YXIgcHJldkhhbmRsZURvd24gPSBmdW5jdGlvbiBwcmV2SGFuZGxlRG93bihlKSB7XG5cdFx0XHR2YXIgcHJldlJvdyA9IHNlbGYudGFibGUucm93TWFuYWdlci5wcmV2RGlzcGxheVJvdyhyb3cpO1xuXG5cdFx0XHRpZiAocHJldlJvdykge1xuXHRcdFx0XHRzZWxmLnN0YXJ0Um93ID0gcHJldlJvdztcblx0XHRcdFx0c2VsZi5fbW91c2VEb3duKGUsIHByZXZSb3csIHByZXZIYW5kbGUpO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHRwcmV2SGFuZGxlLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgcHJldkhhbmRsZURvd24pO1xuXHRcdHByZXZIYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgcHJldkhhbmRsZURvd24sIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcblxuXHRcdHJvd0VsLmFwcGVuZENoaWxkKGhhbmRsZSk7XG5cdFx0cm93RWwuYXBwZW5kQ2hpbGQocHJldkhhbmRsZSk7XG5cdH07XG5cblx0UmVzaXplUm93cy5wcm90b3R5cGUuX21vdXNlRG93biA9IGZ1bmN0aW9uIChlLCByb3csIGhhbmRsZSkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHNlbGYudGFibGUuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWJsb2NrLXNlbGVjdFwiKTtcblxuXHRcdGZ1bmN0aW9uIG1vdXNlTW92ZShlKSB7XG5cdFx0XHRyb3cuc2V0SGVpZ2h0KHNlbGYuc3RhcnRIZWlnaHQgKyAoKHR5cGVvZiBlLnNjcmVlblkgPT09IFwidW5kZWZpbmVkXCIgPyBlLnRvdWNoZXNbMF0uc2NyZWVuWSA6IGUuc2NyZWVuWSkgLSBzZWxmLnN0YXJ0WSkpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIG1vdXNlVXAoZSkge1xuXG5cdFx0XHQvLyAvL2Jsb2NrIGVkaXRvciBmcm9tIHRha2luZyBhY3Rpb24gd2hpbGUgcmVzaXppbmcgaXMgdGFraW5nIHBsYWNlXG5cdFx0XHQvLyBpZihzZWxmLnN0YXJ0Q29sdW1uLm1vZHVsZXMuZWRpdCl7XG5cdFx0XHQvLyBcdHNlbGYuc3RhcnRDb2x1bW4ubW9kdWxlcy5lZGl0LmJsb2NrZWQgPSBmYWxzZTtcblx0XHRcdC8vIH1cblxuXHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBtb3VzZU1vdmUpO1xuXHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIG1vdXNlTW92ZSk7XG5cblx0XHRcdGhhbmRsZS5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIG1vdXNlTW92ZSk7XG5cdFx0XHRoYW5kbGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIG1vdXNlVXApO1xuXG5cdFx0XHRzZWxmLnRhYmxlLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcInRhYnVsYXRvci1ibG9jay1zZWxlY3RcIik7XG5cblx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5yb3dSZXNpemVkLmNhbGwodGhpcy50YWJsZSwgcm93LmdldENvbXBvbmVudCgpKTtcblx0XHR9XG5cblx0XHRlLnN0b3BQcm9wYWdhdGlvbigpOyAvL3ByZXZlbnQgcmVzaXplIGZyb20gaW50ZXJmZXJlaW5nIHdpdGggbW92YWJsZSBjb2x1bW5zXG5cblx0XHQvL2Jsb2NrIGVkaXRvciBmcm9tIHRha2luZyBhY3Rpb24gd2hpbGUgcmVzaXppbmcgaXMgdGFraW5nIHBsYWNlXG5cdFx0Ly8gaWYoc2VsZi5zdGFydENvbHVtbi5tb2R1bGVzLmVkaXQpe1xuXHRcdC8vIFx0c2VsZi5zdGFydENvbHVtbi5tb2R1bGVzLmVkaXQuYmxvY2tlZCA9IHRydWU7XG5cdFx0Ly8gfVxuXG5cdFx0c2VsZi5zdGFydFkgPSB0eXBlb2YgZS5zY3JlZW5ZID09PSBcInVuZGVmaW5lZFwiID8gZS50b3VjaGVzWzBdLnNjcmVlblkgOiBlLnNjcmVlblk7XG5cdFx0c2VsZi5zdGFydEhlaWdodCA9IHJvdy5nZXRIZWlnaHQoKTtcblxuXHRcdGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBtb3VzZU1vdmUpO1xuXHRcdGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgbW91c2VVcCk7XG5cblx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNobW92ZVwiLCBtb3VzZU1vdmUsIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcblx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIG1vdXNlVXApO1xuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJyZXNpemVSb3dzXCIsIFJlc2l6ZVJvd3MpO1xuXHR2YXIgUmVzaXplVGFibGUgPSBmdW5jdGlvbiBSZXNpemVUYWJsZSh0YWJsZSkge1xuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIFRhYnVsYXRvciBvYmplY3Rcblx0XHR0aGlzLmJpbmRpbmcgPSBmYWxzZTtcblx0XHR0aGlzLm9ic2VydmVyID0gZmFsc2U7XG5cdFx0dGhpcy5jb250YWluZXJPYnNlcnZlciA9IGZhbHNlO1xuXG5cdFx0dGhpcy50YWJsZUhlaWdodCA9IDA7XG5cdFx0dGhpcy50YWJsZVdpZHRoID0gMDtcblx0XHR0aGlzLmNvbnRhaW5lckhlaWdodCA9IDA7XG5cdFx0dGhpcy5jb250YWluZXJXaWR0aCA9IDA7XG5cblx0XHR0aGlzLmF1dG9SZXNpemUgPSBmYWxzZTtcblx0fTtcblxuXHRSZXNpemVUYWJsZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR2YXIgX3RoaXM3NCA9IHRoaXM7XG5cblx0XHR2YXIgdGFibGUgPSB0aGlzLnRhYmxlLFxuXHRcdCAgICB0YWJsZVN0eWxlO1xuXG5cdFx0dGhpcy50YWJsZUhlaWdodCA9IHRhYmxlLmVsZW1lbnQuY2xpZW50SGVpZ2h0O1xuXHRcdHRoaXMudGFibGVXaWR0aCA9IHRhYmxlLmVsZW1lbnQuY2xpZW50V2lkdGg7XG5cblx0XHRpZiAodGFibGUuZWxlbWVudC5wYXJlbnROb2RlKSB7XG5cdFx0XHR0aGlzLmNvbnRhaW5lckhlaWdodCA9IHRhYmxlLmVsZW1lbnQucGFyZW50Tm9kZS5jbGllbnRIZWlnaHQ7XG5cdFx0XHR0aGlzLmNvbnRhaW5lcldpZHRoID0gdGFibGUuZWxlbWVudC5wYXJlbnROb2RlLmNsaWVudFdpZHRoO1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YgUmVzaXplT2JzZXJ2ZXIgIT09IFwidW5kZWZpbmVkXCIgJiYgdGFibGUucm93TWFuYWdlci5nZXRSZW5kZXJNb2RlKCkgPT09IFwidmlydHVhbFwiKSB7XG5cblx0XHRcdHRoaXMuYXV0b1Jlc2l6ZSA9IHRydWU7XG5cblx0XHRcdHRoaXMub2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoZnVuY3Rpb24gKGVudHJ5KSB7XG5cdFx0XHRcdGlmICghdGFibGUuYnJvd3Nlck1vYmlsZSB8fCB0YWJsZS5icm93c2VyTW9iaWxlICYmICF0YWJsZS5tb2R1bGVzLmVkaXQuY3VycmVudENlbGwpIHtcblxuXHRcdFx0XHRcdHZhciBub2RlSGVpZ2h0ID0gTWF0aC5mbG9vcihlbnRyeVswXS5jb250ZW50UmVjdC5oZWlnaHQpO1xuXHRcdFx0XHRcdHZhciBub2RlV2lkdGggPSBNYXRoLmZsb29yKGVudHJ5WzBdLmNvbnRlbnRSZWN0LndpZHRoKTtcblxuXHRcdFx0XHRcdGlmIChfdGhpczc0LnRhYmxlSGVpZ2h0ICE9IG5vZGVIZWlnaHQgfHwgX3RoaXM3NC50YWJsZVdpZHRoICE9IG5vZGVXaWR0aCkge1xuXHRcdFx0XHRcdFx0X3RoaXM3NC50YWJsZUhlaWdodCA9IG5vZGVIZWlnaHQ7XG5cdFx0XHRcdFx0XHRfdGhpczc0LnRhYmxlV2lkdGggPSBub2RlV2lkdGg7XG5cblx0XHRcdFx0XHRcdGlmICh0YWJsZS5lbGVtZW50LnBhcmVudE5vZGUpIHtcblx0XHRcdFx0XHRcdFx0X3RoaXM3NC5jb250YWluZXJIZWlnaHQgPSB0YWJsZS5lbGVtZW50LnBhcmVudE5vZGUuY2xpZW50SGVpZ2h0O1xuXHRcdFx0XHRcdFx0XHRfdGhpczc0LmNvbnRhaW5lcldpZHRoID0gdGFibGUuZWxlbWVudC5wYXJlbnROb2RlLmNsaWVudFdpZHRoO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHR0YWJsZS5yZWRyYXcoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLm9ic2VydmVyLm9ic2VydmUodGFibGUuZWxlbWVudCk7XG5cblx0XHRcdHRhYmxlU3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0YWJsZS5lbGVtZW50KTtcblxuXHRcdFx0aWYgKHRoaXMudGFibGUuZWxlbWVudC5wYXJlbnROb2RlICYmICF0aGlzLnRhYmxlLnJvd01hbmFnZXIuZml4ZWRIZWlnaHQgJiYgKHRhYmxlU3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShcIm1heC1oZWlnaHRcIikgfHwgdGFibGVTdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKFwibWluLWhlaWdodFwiKSkpIHtcblxuXHRcdFx0XHR0aGlzLmNvbnRhaW5lck9ic2VydmVyID0gbmV3IFJlc2l6ZU9ic2VydmVyKGZ1bmN0aW9uIChlbnRyeSkge1xuXHRcdFx0XHRcdGlmICghdGFibGUuYnJvd3Nlck1vYmlsZSB8fCB0YWJsZS5icm93c2VyTW9iaWxlICYmICF0YWJsZS5tb2R1bGVzLmVkaXQuY3VycmVudENlbGwpIHtcblxuXHRcdFx0XHRcdFx0dmFyIG5vZGVIZWlnaHQgPSBNYXRoLmZsb29yKGVudHJ5WzBdLmNvbnRlbnRSZWN0LmhlaWdodCk7XG5cdFx0XHRcdFx0XHR2YXIgbm9kZVdpZHRoID0gTWF0aC5mbG9vcihlbnRyeVswXS5jb250ZW50UmVjdC53aWR0aCk7XG5cblx0XHRcdFx0XHRcdGlmIChfdGhpczc0LmNvbnRhaW5lckhlaWdodCAhPSBub2RlSGVpZ2h0IHx8IF90aGlzNzQuY29udGFpbmVyV2lkdGggIT0gbm9kZVdpZHRoKSB7XG5cdFx0XHRcdFx0XHRcdF90aGlzNzQuY29udGFpbmVySGVpZ2h0ID0gbm9kZUhlaWdodDtcblx0XHRcdFx0XHRcdFx0X3RoaXM3NC5jb250YWluZXJXaWR0aCA9IG5vZGVXaWR0aDtcblx0XHRcdFx0XHRcdFx0X3RoaXM3NC50YWJsZUhlaWdodCA9IHRhYmxlLmVsZW1lbnQuY2xpZW50SGVpZ2h0O1xuXHRcdFx0XHRcdFx0XHRfdGhpczc0LnRhYmxlV2lkdGggPSB0YWJsZS5lbGVtZW50LmNsaWVudFdpZHRoO1xuXG5cdFx0XHRcdFx0XHRcdHRhYmxlLnJlZHJhdygpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHR0YWJsZS5yZWRyYXcoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHRoaXMuY29udGFpbmVyT2JzZXJ2ZXIub2JzZXJ2ZSh0aGlzLnRhYmxlLmVsZW1lbnQucGFyZW50Tm9kZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuYmluZGluZyA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0aWYgKCF0YWJsZS5icm93c2VyTW9iaWxlIHx8IHRhYmxlLmJyb3dzZXJNb2JpbGUgJiYgIXRhYmxlLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbCkge1xuXHRcdFx0XHRcdHRhYmxlLnJlZHJhdygpO1xuXHRcdFx0XHR9XG5cdFx0XHR9O1xuXG5cdFx0XHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCB0aGlzLmJpbmRpbmcpO1xuXHRcdH1cblx0fTtcblxuXHRSZXNpemVUYWJsZS5wcm90b3R5cGUuY2xlYXJCaW5kaW5ncyA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHRpZiAodGhpcy5iaW5kaW5nKSB7XG5cdFx0XHR3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCB0aGlzLmJpbmRpbmcpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLm9ic2VydmVyKSB7XG5cdFx0XHR0aGlzLm9ic2VydmVyLnVub2JzZXJ2ZSh0aGlzLnRhYmxlLmVsZW1lbnQpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLmNvbnRhaW5lck9ic2VydmVyKSB7XG5cdFx0XHR0aGlzLmNvbnRhaW5lck9ic2VydmVyLnVub2JzZXJ2ZSh0aGlzLnRhYmxlLmVsZW1lbnQucGFyZW50Tm9kZSk7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJyZXNpemVUYWJsZVwiLCBSZXNpemVUYWJsZSk7XG5cdHZhciBSZXNwb25zaXZlTGF5b3V0ID0gZnVuY3Rpb24gUmVzcG9uc2l2ZUxheW91dCh0YWJsZSkge1xuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIFRhYnVsYXRvciBvYmplY3Rcblx0XHR0aGlzLmNvbHVtbnMgPSBbXTtcblx0XHR0aGlzLmhpZGRlbkNvbHVtbnMgPSBbXTtcblx0XHR0aGlzLm1vZGUgPSBcIlwiO1xuXHRcdHRoaXMuaW5kZXggPSAwO1xuXHRcdHRoaXMuY29sbGFwc2VGb3JtYXR0ZXIgPSBbXTtcblx0XHR0aGlzLmNvbGxhcHNlU3RhcnRPcGVuID0gdHJ1ZTtcblx0XHR0aGlzLmNvbGxhcHNlSGFuZGxlQ29sdW1uID0gZmFsc2U7XG5cdH07XG5cblx0Ly9nZW5lcmF0ZSByZXNwb3NpdmUgY29sdW1ucyBsaXN0XG5cdFJlc3BvbnNpdmVMYXlvdXQucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBjb2x1bW5zID0gW107XG5cblx0XHR0aGlzLm1vZGUgPSB0aGlzLnRhYmxlLm9wdGlvbnMucmVzcG9uc2l2ZUxheW91dDtcblx0XHR0aGlzLmNvbGxhcHNlRm9ybWF0dGVyID0gdGhpcy50YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXRDb2xsYXBzZUZvcm1hdHRlciB8fCB0aGlzLmZvcm1hdENvbGxhcHNlZERhdGE7XG5cdFx0dGhpcy5jb2xsYXBzZVN0YXJ0T3BlbiA9IHRoaXMudGFibGUub3B0aW9ucy5yZXNwb25zaXZlTGF5b3V0Q29sbGFwc2VTdGFydE9wZW47XG5cdFx0dGhpcy5oaWRkZW5Db2x1bW5zID0gW107XG5cblx0XHQvL2RldGVtaW5lIGxldmVsIG9mIHJlc3BvbnNpdml0eSBmb3IgZWFjaCBjb2x1bW5cblx0XHR0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuY29sdW1uc0J5SW5kZXguZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uLCBpKSB7XG5cdFx0XHRpZiAoY29sdW1uLm1vZHVsZXMucmVzcG9uc2l2ZSkge1xuXHRcdFx0XHRpZiAoY29sdW1uLm1vZHVsZXMucmVzcG9uc2l2ZS5vcmRlciAmJiBjb2x1bW4ubW9kdWxlcy5yZXNwb25zaXZlLnZpc2libGUpIHtcblx0XHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5yZXNwb25zaXZlLmluZGV4ID0gaTtcblx0XHRcdFx0XHRjb2x1bW5zLnB1c2goY29sdW1uKTtcblxuXHRcdFx0XHRcdGlmICghY29sdW1uLnZpc2libGUgJiYgc2VsZi5tb2RlID09PSBcImNvbGxhcHNlXCIpIHtcblx0XHRcdFx0XHRcdHNlbGYuaGlkZGVuQ29sdW1ucy5wdXNoKGNvbHVtbik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvL3NvcnQgbGlzdCBieSByZXNwb25zaXZpdHlcblx0XHRjb2x1bW5zID0gY29sdW1ucy5yZXZlcnNlKCk7XG5cdFx0Y29sdW1ucyA9IGNvbHVtbnMuc29ydChmdW5jdGlvbiAoYSwgYikge1xuXHRcdFx0dmFyIGRpZmYgPSBiLm1vZHVsZXMucmVzcG9uc2l2ZS5vcmRlciAtIGEubW9kdWxlcy5yZXNwb25zaXZlLm9yZGVyO1xuXHRcdFx0cmV0dXJuIGRpZmYgfHwgYi5tb2R1bGVzLnJlc3BvbnNpdmUuaW5kZXggLSBhLm1vZHVsZXMucmVzcG9uc2l2ZS5pbmRleDtcblx0XHR9KTtcblxuXHRcdHRoaXMuY29sdW1ucyA9IGNvbHVtbnM7XG5cblx0XHRpZiAodGhpcy5tb2RlID09PSBcImNvbGxhcHNlXCIpIHtcblx0XHRcdHRoaXMuZ2VuZXJhdGVDb2xsYXBzZWRDb250ZW50KCk7XG5cdFx0fVxuXG5cdFx0Ly9hc3NpZ24gY29sbGFwc2UgY29sdW1uXG5cdFx0Zm9yICh2YXIgX2l0ZXJhdG9yID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmNvbHVtbnNCeUluZGV4LCBfaXNBcnJheSA9IEFycmF5LmlzQXJyYXkoX2l0ZXJhdG9yKSwgX2kxMiA9IDAsIF9pdGVyYXRvciA9IF9pc0FycmF5ID8gX2l0ZXJhdG9yIDogX2l0ZXJhdG9yW1N5bWJvbC5pdGVyYXRvcl0oKTs7KSB7XG5cdFx0XHR2YXIgX3JlZjtcblxuXHRcdFx0aWYgKF9pc0FycmF5KSB7XG5cdFx0XHRcdGlmIChfaTEyID49IF9pdGVyYXRvci5sZW5ndGgpIGJyZWFrO1xuXHRcdFx0XHRfcmVmID0gX2l0ZXJhdG9yW19pMTIrK107XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfaTEyID0gX2l0ZXJhdG9yLm5leHQoKTtcblx0XHRcdFx0aWYgKF9pMTIuZG9uZSkgYnJlYWs7XG5cdFx0XHRcdF9yZWYgPSBfaTEyLnZhbHVlO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgY29sID0gX3JlZjtcblxuXHRcdFx0aWYgKGNvbC5kZWZpbml0aW9uLmZvcm1hdHRlciA9PSBcInJlc3BvbnNpdmVDb2xsYXBzZVwiKSB7XG5cdFx0XHRcdHRoaXMuY29sbGFwc2VIYW5kbGVDb2x1bW4gPSBjb2w7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0aGlzLmNvbGxhcHNlSGFuZGxlQ29sdW1uKSB7XG5cdFx0XHRpZiAodGhpcy5oaWRkZW5Db2x1bW5zLmxlbmd0aCkge1xuXHRcdFx0XHR0aGlzLmNvbGxhcHNlSGFuZGxlQ29sdW1uLnNob3coKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuY29sbGFwc2VIYW5kbGVDb2x1bW4uaGlkZSgpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHQvL2RlZmluZSBsYXlvdXQgaW5mb3JtYXRpb25cblx0UmVzcG9uc2l2ZUxheW91dC5wcm90b3R5cGUuaW5pdGlhbGl6ZUNvbHVtbiA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHR2YXIgZGVmID0gY29sdW1uLmdldERlZmluaXRpb24oKTtcblxuXHRcdGNvbHVtbi5tb2R1bGVzLnJlc3BvbnNpdmUgPSB7IG9yZGVyOiB0eXBlb2YgZGVmLnJlc3BvbnNpdmUgPT09IFwidW5kZWZpbmVkXCIgPyAxIDogZGVmLnJlc3BvbnNpdmUsIHZpc2libGU6IGRlZi52aXNpYmxlID09PSBmYWxzZSA/IGZhbHNlIDogdHJ1ZSB9O1xuXHR9O1xuXG5cdFJlc3BvbnNpdmVMYXlvdXQucHJvdG90eXBlLmluaXRpYWxpemVSb3cgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIGVsO1xuXG5cdFx0aWYgKHJvdy50eXBlICE9PSBcImNhbGNcIikge1xuXHRcdFx0ZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1yZXNwb25zaXZlLWNvbGxhcHNlXCIpO1xuXG5cdFx0XHRyb3cubW9kdWxlcy5yZXNwb25zaXZlTGF5b3V0ID0ge1xuXHRcdFx0XHRlbGVtZW50OiBlbCxcblx0XHRcdFx0b3BlbjogdGhpcy5jb2xsYXBzZVN0YXJ0T3BlblxuXHRcdFx0fTtcblxuXHRcdFx0aWYgKCF0aGlzLmNvbGxhcHNlU3RhcnRPcGVuKSB7XG5cdFx0XHRcdGVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFJlc3BvbnNpdmVMYXlvdXQucHJvdG90eXBlLmxheW91dFJvdyA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR2YXIgcm93RWwgPSByb3cuZ2V0RWxlbWVudCgpO1xuXG5cdFx0aWYgKHJvdy5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQpIHtcblx0XHRcdHJvd0VsLmFwcGVuZENoaWxkKHJvdy5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQuZWxlbWVudCk7XG5cdFx0XHR0aGlzLmdlbmVyYXRlQ29sbGFwc2VkUm93Q29udGVudChyb3cpO1xuXHRcdH1cblx0fTtcblxuXHQvL3VwZGF0ZSBjb2x1bW4gdmlzaWJpbGl0eVxuXHRSZXNwb25zaXZlTGF5b3V0LnByb3RvdHlwZS51cGRhdGVDb2x1bW5WaXNpYmlsaXR5ID0gZnVuY3Rpb24gKGNvbHVtbiwgdmlzaWJsZSkge1xuXHRcdHZhciBpbmRleDtcblx0XHRpZiAoY29sdW1uLm1vZHVsZXMucmVzcG9uc2l2ZSkge1xuXHRcdFx0Y29sdW1uLm1vZHVsZXMucmVzcG9uc2l2ZS52aXNpYmxlID0gdmlzaWJsZTtcblx0XHRcdHRoaXMuaW5pdGlhbGl6ZSgpO1xuXHRcdH1cblx0fTtcblxuXHRSZXNwb25zaXZlTGF5b3V0LnByb3RvdHlwZS5oaWRlQ29sdW1uID0gZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdHZhciBjb2xDb3VudCA9IHRoaXMuaGlkZGVuQ29sdW1ucy5sZW5ndGg7XG5cblx0XHRjb2x1bW4uaGlkZShmYWxzZSwgdHJ1ZSk7XG5cblx0XHRpZiAodGhpcy5tb2RlID09PSBcImNvbGxhcHNlXCIpIHtcblx0XHRcdHRoaXMuaGlkZGVuQ29sdW1ucy51bnNoaWZ0KGNvbHVtbik7XG5cdFx0XHR0aGlzLmdlbmVyYXRlQ29sbGFwc2VkQ29udGVudCgpO1xuXG5cdFx0XHRpZiAodGhpcy5jb2xsYXBzZUhhbmRsZUNvbHVtbiAmJiAhY29sQ291bnQpIHtcblx0XHRcdFx0dGhpcy5jb2xsYXBzZUhhbmRsZUNvbHVtbi5zaG93KCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFJlc3BvbnNpdmVMYXlvdXQucHJvdG90eXBlLnNob3dDb2x1bW4gPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0dmFyIGluZGV4O1xuXG5cdFx0Y29sdW1uLnNob3coZmFsc2UsIHRydWUpO1xuXHRcdC8vc2V0IGNvbHVtbiB3aWR0aCB0byBwcmV2ZW50IGNhbGN1bGF0aW9uIGxvb3BzIG9uIHVuaW5pdGlhbGl6ZWQgY29sdW1uc1xuXHRcdGNvbHVtbi5zZXRXaWR0aChjb2x1bW4uZ2V0V2lkdGgoKSk7XG5cblx0XHRpZiAodGhpcy5tb2RlID09PSBcImNvbGxhcHNlXCIpIHtcblx0XHRcdGluZGV4ID0gdGhpcy5oaWRkZW5Db2x1bW5zLmluZGV4T2YoY29sdW1uKTtcblxuXHRcdFx0aWYgKGluZGV4ID4gLTEpIHtcblx0XHRcdFx0dGhpcy5oaWRkZW5Db2x1bW5zLnNwbGljZShpbmRleCwgMSk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuZ2VuZXJhdGVDb2xsYXBzZWRDb250ZW50KCk7XG5cblx0XHRcdGlmICh0aGlzLmNvbGxhcHNlSGFuZGxlQ29sdW1uICYmICF0aGlzLmhpZGRlbkNvbHVtbnMubGVuZ3RoKSB7XG5cdFx0XHRcdHRoaXMuY29sbGFwc2VIYW5kbGVDb2x1bW4uaGlkZSgpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHQvL3JlZHJhdyBjb2x1bW5zIHRvIGZpdCBzcGFjZVxuXHRSZXNwb25zaXZlTGF5b3V0LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICB3b3JraW5nID0gdHJ1ZTtcblxuXHRcdHdoaWxlICh3b3JraW5nKSB7XG5cblx0XHRcdHZhciB3aWR0aCA9IHNlbGYudGFibGUubW9kdWxlcy5sYXlvdXQuZ2V0TW9kZSgpID09IFwiZml0Q29sdW1uc1wiID8gc2VsZi50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldEZsZXhCYXNlV2lkdGgoKSA6IHNlbGYudGFibGUuY29sdW1uTWFuYWdlci5nZXRXaWR0aCgpO1xuXG5cdFx0XHR2YXIgZGlmZiA9IChzZWxmLnRhYmxlLm9wdGlvbnMuaGVhZGVyVmlzaWJsZSA/IHNlbGYudGFibGUuY29sdW1uTWFuYWdlci5lbGVtZW50LmNsaWVudFdpZHRoIDogc2VsZi50YWJsZS5lbGVtZW50LmNsaWVudFdpZHRoKSAtIHdpZHRoO1xuXG5cdFx0XHRpZiAoZGlmZiA8IDApIHtcblx0XHRcdFx0Ly90YWJsZSBpcyB0b28gd2lkZVxuXHRcdFx0XHR2YXIgY29sdW1uID0gc2VsZi5jb2x1bW5zW3NlbGYuaW5kZXhdO1xuXG5cdFx0XHRcdGlmIChjb2x1bW4pIHtcblx0XHRcdFx0XHRzZWxmLmhpZGVDb2x1bW4oY29sdW1uKTtcblx0XHRcdFx0XHRzZWxmLmluZGV4Kys7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0d29ya2luZyA9IGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdC8vdGFibGUgaGFzIHNwYXJlIHNwYWNlXG5cdFx0XHRcdHZhciBfY29sdW1uID0gc2VsZi5jb2x1bW5zW3NlbGYuaW5kZXggLSAxXTtcblxuXHRcdFx0XHRpZiAoX2NvbHVtbikge1xuXHRcdFx0XHRcdGlmIChkaWZmID4gMCkge1xuXHRcdFx0XHRcdFx0aWYgKGRpZmYgPj0gX2NvbHVtbi5nZXRXaWR0aCgpKSB7XG5cdFx0XHRcdFx0XHRcdHNlbGYuc2hvd0NvbHVtbihfY29sdW1uKTtcblx0XHRcdFx0XHRcdFx0c2VsZi5pbmRleC0tO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0d29ya2luZyA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHR3b3JraW5nID0gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHdvcmtpbmcgPSBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXNlbGYudGFibGUucm93TWFuYWdlci5hY3RpdmVSb3dzQ291bnQpIHtcblx0XHRcdFx0c2VsZi50YWJsZS5yb3dNYW5hZ2VyLnJlbmRlckVtcHR5U2Nyb2xsKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFJlc3BvbnNpdmVMYXlvdXQucHJvdG90eXBlLmdlbmVyYXRlQ29sbGFwc2VkQ29udGVudCA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHJvd3MgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0RGlzcGxheVJvd3MoKTtcblxuXHRcdHJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRzZWxmLmdlbmVyYXRlQ29sbGFwc2VkUm93Q29udGVudChyb3cpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdFJlc3BvbnNpdmVMYXlvdXQucHJvdG90eXBlLmdlbmVyYXRlQ29sbGFwc2VkUm93Q29udGVudCA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR2YXIgZWwsIGNvbnRlbnRzO1xuXG5cdFx0aWYgKHJvdy5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQpIHtcblx0XHRcdGVsID0gcm93Lm1vZHVsZXMucmVzcG9uc2l2ZUxheW91dC5lbGVtZW50O1xuXG5cdFx0XHR3aGlsZSAoZWwuZmlyc3RDaGlsZCkge1xuXHRcdFx0XHRlbC5yZW1vdmVDaGlsZChlbC5maXJzdENoaWxkKTtcblx0XHRcdH1jb250ZW50cyA9IHRoaXMuY29sbGFwc2VGb3JtYXR0ZXIodGhpcy5nZW5lcmF0ZUNvbGxhcHNlZFJvd0RhdGEocm93KSk7XG5cdFx0XHRpZiAoY29udGVudHMpIHtcblx0XHRcdFx0ZWwuYXBwZW5kQ2hpbGQoY29udGVudHMpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRSZXNwb25zaXZlTGF5b3V0LnByb3RvdHlwZS5nZW5lcmF0ZUNvbGxhcHNlZFJvd0RhdGEgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBkYXRhID0gcm93LmdldERhdGEoKSxcblx0XHQgICAgb3V0cHV0ID0gW10sXG5cdFx0ICAgIG1vY2tDZWxsQ29tcG9uZW50O1xuXG5cdFx0dGhpcy5oaWRkZW5Db2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdFx0dmFyIHZhbHVlID0gY29sdW1uLmdldEZpZWxkVmFsdWUoZGF0YSk7XG5cblx0XHRcdGlmIChjb2x1bW4uZGVmaW5pdGlvbi50aXRsZSAmJiBjb2x1bW4uZmllbGQpIHtcblx0XHRcdFx0aWYgKGNvbHVtbi5tb2R1bGVzLmZvcm1hdCAmJiBzZWxmLnRhYmxlLm9wdGlvbnMucmVzcG9uc2l2ZUxheW91dENvbGxhcHNlVXNlRm9ybWF0dGVycykge1xuXG5cdFx0XHRcdFx0bW9ja0NlbGxDb21wb25lbnQgPSB7XG5cdFx0XHRcdFx0XHR2YWx1ZTogZmFsc2UsXG5cdFx0XHRcdFx0XHRkYXRhOiB7fSxcblx0XHRcdFx0XHRcdGdldFZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdGdldERhdGE6IGZ1bmN0aW9uIGdldERhdGEoKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBkYXRhO1xuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdGdldEVsZW1lbnQ6IGZ1bmN0aW9uIGdldEVsZW1lbnQoKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdGdldFJvdzogZnVuY3Rpb24gZ2V0Um93KCkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcm93LmdldENvbXBvbmVudCgpO1xuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdGdldENvbHVtbjogZnVuY3Rpb24gZ2V0Q29sdW1uKCkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gY29sdW1uLmdldENvbXBvbmVudCgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH07XG5cblx0XHRcdFx0XHRvdXRwdXQucHVzaCh7XG5cdFx0XHRcdFx0XHR0aXRsZTogY29sdW1uLmRlZmluaXRpb24udGl0bGUsXG5cdFx0XHRcdFx0XHR2YWx1ZTogY29sdW1uLm1vZHVsZXMuZm9ybWF0LmZvcm1hdHRlci5jYWxsKHNlbGYudGFibGUubW9kdWxlcy5mb3JtYXQsIG1vY2tDZWxsQ29tcG9uZW50LCBjb2x1bW4ubW9kdWxlcy5mb3JtYXQucGFyYW1zKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG91dHB1dC5wdXNoKHtcblx0XHRcdFx0XHRcdHRpdGxlOiBjb2x1bW4uZGVmaW5pdGlvbi50aXRsZSxcblx0XHRcdFx0XHRcdHZhbHVlOiB2YWx1ZVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9O1xuXG5cdFJlc3BvbnNpdmVMYXlvdXQucHJvdG90eXBlLmZvcm1hdENvbGxhcHNlZERhdGEgPSBmdW5jdGlvbiAoZGF0YSkge1xuXHRcdHZhciBsaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRhYmxlXCIpLFxuXHRcdCAgICBsaXN0Q29udGVudHMgPSBcIlwiO1xuXG5cdFx0ZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHR2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuXHRcdFx0aWYgKGl0ZW0udmFsdWUgaW5zdGFuY2VvZiBOb2RlKSB7XG5cdFx0XHRcdGRpdi5hcHBlbmRDaGlsZChpdGVtLnZhbHVlKTtcblx0XHRcdFx0aXRlbS52YWx1ZSA9IGRpdi5pbm5lckhUTUw7XG5cdFx0XHR9XG5cblx0XHRcdGxpc3RDb250ZW50cyArPSBcIjx0cj48dGQ+PHN0cm9uZz5cIiArIGl0ZW0udGl0bGUgKyBcIjwvc3Ryb25nPjwvdGQ+PHRkPlwiICsgaXRlbS52YWx1ZSArIFwiPC90ZD48L3RyPlwiO1xuXHRcdH0pO1xuXG5cdFx0bGlzdC5pbm5lckhUTUwgPSBsaXN0Q29udGVudHM7XG5cblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZGF0YSkubGVuZ3RoID8gbGlzdCA6IFwiXCI7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcInJlc3BvbnNpdmVMYXlvdXRcIiwgUmVzcG9uc2l2ZUxheW91dCk7XG5cblx0dmFyIFNlbGVjdFJvdyA9IGZ1bmN0aW9uIFNlbGVjdFJvdyh0YWJsZSkge1xuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIFRhYnVsYXRvciBvYmplY3Rcblx0XHR0aGlzLnNlbGVjdGluZyA9IGZhbHNlOyAvL2ZsYWcgc2VsZWN0aW5nIGluIHByb2dyZXNzXG5cdFx0dGhpcy5sYXN0Q2xpY2tlZFJvdyA9IGZhbHNlOyAvL2xhc3QgY2xpY2tlZCByb3dcblx0XHR0aGlzLnNlbGVjdFByZXYgPSBbXTsgLy9ob2xkIHByZXZpb3VzbHkgc2VsZWN0ZWQgZWxlbWVudCBmb3IgZHJhZyBkcm9wIHNlbGVjdGlvblxuXHRcdHRoaXMuc2VsZWN0ZWRSb3dzID0gW107IC8vaG9sZCBzZWxlY3RlZCByb3dzXG5cdFx0dGhpcy5oZWFkZXJDaGVja2JveEVsZW1lbnQgPSBudWxsOyAvLyBob2xkIGhlYWRlciBzZWxlY3QgZWxlbWVudFxuXHR9O1xuXG5cdFNlbGVjdFJvdy5wcm90b3R5cGUuY2xlYXJTZWxlY3Rpb25EYXRhID0gZnVuY3Rpb24gKHNpbGVudCkge1xuXHRcdHRoaXMuc2VsZWN0aW5nID0gZmFsc2U7XG5cdFx0dGhpcy5sYXN0Q2xpY2tlZFJvdyA9IGZhbHNlO1xuXHRcdHRoaXMuc2VsZWN0UHJldiA9IFtdO1xuXHRcdHRoaXMuc2VsZWN0ZWRSb3dzID0gW107XG5cblx0XHRpZiAoIXNpbGVudCkge1xuXHRcdFx0dGhpcy5fcm93U2VsZWN0aW9uQ2hhbmdlZCgpO1xuXHRcdH1cblx0fTtcblxuXHRTZWxlY3RSb3cucHJvdG90eXBlLmluaXRpYWxpemVSb3cgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBlbGVtZW50ID0gcm93LmdldEVsZW1lbnQoKTtcblxuXHRcdC8vIHRyaWdnZXIgZW5kIG9mIHJvdyBzZWxlY3Rpb25cblx0XHR2YXIgZW5kU2VsZWN0ID0gZnVuY3Rpb24gZW5kU2VsZWN0KCkge1xuXG5cdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0c2VsZi5zZWxlY3RpbmcgPSBmYWxzZTtcblx0XHRcdH0sIDUwKTtcblxuXHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBlbmRTZWxlY3QpO1xuXHRcdH07XG5cblx0XHRyb3cubW9kdWxlcy5zZWxlY3QgPSB7IHNlbGVjdGVkOiBmYWxzZSB9O1xuXG5cdFx0Ly9zZXQgcm93IHNlbGVjdGlvbiBjbGFzc1xuXHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZUNoZWNrLmNhbGwodGhpcy50YWJsZSwgcm93LmdldENvbXBvbmVudCgpKSkge1xuXHRcdFx0ZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXNlbGVjdGFibGVcIik7XG5cdFx0XHRlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItdW5zZWxlY3RhYmxlXCIpO1xuXG5cdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnNlbGVjdGFibGUgJiYgc2VsZi50YWJsZS5vcHRpb25zLnNlbGVjdGFibGUgIT0gXCJoaWdobGlnaHRcIikge1xuXHRcdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnNlbGVjdGFibGVSYW5nZU1vZGUgPT09IFwiY2xpY2tcIikge1xuXHRcdFx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0XHRpZiAoZS5zaGlmdEtleSkge1xuXHRcdFx0XHRcdFx0XHRzZWxmLnRhYmxlLl9jbGVhclNlbGVjdGlvbigpO1xuXHRcdFx0XHRcdFx0XHRzZWxmLmxhc3RDbGlja2VkUm93ID0gc2VsZi5sYXN0Q2xpY2tlZFJvdyB8fCByb3c7XG5cblx0XHRcdFx0XHRcdFx0dmFyIGxhc3RDbGlja2VkUm93SWR4ID0gc2VsZi50YWJsZS5yb3dNYW5hZ2VyLmdldERpc3BsYXlSb3dJbmRleChzZWxmLmxhc3RDbGlja2VkUm93KTtcblx0XHRcdFx0XHRcdFx0dmFyIHJvd0lkeCA9IHNlbGYudGFibGUucm93TWFuYWdlci5nZXREaXNwbGF5Um93SW5kZXgocm93KTtcblxuXHRcdFx0XHRcdFx0XHR2YXIgZnJvbVJvd0lkeCA9IGxhc3RDbGlja2VkUm93SWR4IDw9IHJvd0lkeCA/IGxhc3RDbGlja2VkUm93SWR4IDogcm93SWR4O1xuXHRcdFx0XHRcdFx0XHR2YXIgdG9Sb3dJZHggPSBsYXN0Q2xpY2tlZFJvd0lkeCA+PSByb3dJZHggPyBsYXN0Q2xpY2tlZFJvd0lkeCA6IHJvd0lkeDtcblxuXHRcdFx0XHRcdFx0XHR2YXIgcm93cyA9IHNlbGYudGFibGUucm93TWFuYWdlci5nZXREaXNwbGF5Um93cygpLnNsaWNlKDApO1xuXHRcdFx0XHRcdFx0XHR2YXIgdG9nZ2xlZFJvd3MgPSByb3dzLnNwbGljZShmcm9tUm93SWR4LCB0b1Jvd0lkeCAtIGZyb21Sb3dJZHggKyAxKTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoZS5jdHJsS2V5IHx8IGUubWV0YUtleSkge1xuXHRcdFx0XHRcdFx0XHRcdHRvZ2dsZWRSb3dzLmZvckVhY2goZnVuY3Rpb24gKHRvZ2dsZWRSb3cpIHtcblx0XHRcdFx0XHRcdFx0XHRcdGlmICh0b2dnbGVkUm93ICE9PSBzZWxmLmxhc3RDbGlja2VkUm93KSB7XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5zZWxlY3RhYmxlICE9PSB0cnVlICYmICFzZWxmLmlzUm93U2VsZWN0ZWQocm93KSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChzZWxmLnNlbGVjdGVkUm93cy5sZW5ndGggPCBzZWxmLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0c2VsZi50b2dnbGVSb3codG9nZ2xlZFJvdyk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHNlbGYudG9nZ2xlUm93KHRvZ2dsZWRSb3cpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0c2VsZi5sYXN0Q2xpY2tlZFJvdyA9IHJvdztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRzZWxmLmRlc2VsZWN0Um93cyh1bmRlZmluZWQsIHRydWUpO1xuXG5cdFx0XHRcdFx0XHRcdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5zZWxlY3RhYmxlICE9PSB0cnVlKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAodG9nZ2xlZFJvd3MubGVuZ3RoID4gc2VsZi50YWJsZS5vcHRpb25zLnNlbGVjdGFibGUpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0dG9nZ2xlZFJvd3MgPSB0b2dnbGVkUm93cy5zbGljZSgwLCBzZWxmLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZSk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0c2VsZi5zZWxlY3RSb3dzKHRvZ2dsZWRSb3dzKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRzZWxmLnRhYmxlLl9jbGVhclNlbGVjdGlvbigpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmIChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSB7XG5cdFx0XHRcdFx0XHRcdHNlbGYudG9nZ2xlUm93KHJvdyk7XG5cdFx0XHRcdFx0XHRcdHNlbGYubGFzdENsaWNrZWRSb3cgPSByb3c7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRzZWxmLmRlc2VsZWN0Um93cyh1bmRlZmluZWQsIHRydWUpO1xuXHRcdFx0XHRcdFx0XHRzZWxmLnNlbGVjdFJvd3Mocm93KTtcblx0XHRcdFx0XHRcdFx0c2VsZi5sYXN0Q2xpY2tlZFJvdyA9IHJvdztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdFx0aWYgKCFzZWxmLnRhYmxlLm1vZEV4aXN0cyhcImVkaXRcIikgfHwgIXNlbGYudGFibGUubW9kdWxlcy5lZGl0LmdldEN1cnJlbnRDZWxsKCkpIHtcblx0XHRcdFx0XHRcdFx0c2VsZi50YWJsZS5fY2xlYXJTZWxlY3Rpb24oKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKCFzZWxmLnNlbGVjdGluZykge1xuXHRcdFx0XHRcdFx0XHRzZWxmLnRvZ2dsZVJvdyhyb3cpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0XHRpZiAoZS5zaGlmdEtleSkge1xuXHRcdFx0XHRcdFx0XHRzZWxmLnRhYmxlLl9jbGVhclNlbGVjdGlvbigpO1xuXG5cdFx0XHRcdFx0XHRcdHNlbGYuc2VsZWN0aW5nID0gdHJ1ZTtcblxuXHRcdFx0XHRcdFx0XHRzZWxmLnNlbGVjdFByZXYgPSBbXTtcblxuXHRcdFx0XHRcdFx0XHRkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIGVuZFNlbGVjdCk7XG5cdFx0XHRcdFx0XHRcdGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIGVuZFNlbGVjdCk7XG5cblx0XHRcdFx0XHRcdFx0c2VsZi50b2dnbGVSb3cocm93KTtcblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWVudGVyXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0XHRpZiAoc2VsZi5zZWxlY3RpbmcpIHtcblx0XHRcdFx0XHRcdFx0c2VsZi50YWJsZS5fY2xlYXJTZWxlY3Rpb24oKTtcblx0XHRcdFx0XHRcdFx0c2VsZi50b2dnbGVSb3cocm93KTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoc2VsZi5zZWxlY3RQcmV2WzFdID09IHJvdykge1xuXHRcdFx0XHRcdFx0XHRcdHNlbGYudG9nZ2xlUm93KHNlbGYuc2VsZWN0UHJldlswXSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3V0XCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0XHRpZiAoc2VsZi5zZWxlY3RpbmcpIHtcblx0XHRcdFx0XHRcdFx0c2VsZi50YWJsZS5fY2xlYXJTZWxlY3Rpb24oKTtcblx0XHRcdFx0XHRcdFx0c2VsZi5zZWxlY3RQcmV2LnVuc2hpZnQocm93KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRlbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItdW5zZWxlY3RhYmxlXCIpO1xuXHRcdFx0ZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLXNlbGVjdGFibGVcIik7XG5cdFx0fVxuXHR9O1xuXG5cdC8vdG9nZ2xlIHJvdyBzZWxlY3Rpb25cblx0U2VsZWN0Um93LnByb3RvdHlwZS50b2dnbGVSb3cgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5zZWxlY3RhYmxlQ2hlY2suY2FsbCh0aGlzLnRhYmxlLCByb3cuZ2V0Q29tcG9uZW50KCkpKSB7XG5cdFx0XHRpZiAocm93Lm1vZHVsZXMuc2VsZWN0ICYmIHJvdy5tb2R1bGVzLnNlbGVjdC5zZWxlY3RlZCkge1xuXHRcdFx0XHR0aGlzLl9kZXNlbGVjdFJvdyhyb3cpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fc2VsZWN0Um93KHJvdyk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdC8vc2VsZWN0IGEgbnVtYmVyIG9mIHJvd3Ncblx0U2VsZWN0Um93LnByb3RvdHlwZS5zZWxlY3RSb3dzID0gZnVuY3Rpb24gKHJvd3MpIHtcblx0XHR2YXIgX3RoaXM3NSA9IHRoaXM7XG5cblx0XHR2YXIgcm93TWF0Y2g7XG5cblx0XHRzd2l0Y2ggKHR5cGVvZiByb3dzID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihyb3dzKSkge1xuXHRcdFx0Y2FzZSBcInVuZGVmaW5lZFwiOlxuXHRcdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0XHRfdGhpczc1Ll9zZWxlY3RSb3cocm93LCB0cnVlLCB0cnVlKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0dGhpcy5fcm93U2VsZWN0aW9uQ2hhbmdlZCgpO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXG5cdFx0XHRcdHJvd01hdGNoID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmZpbmRSb3cocm93cyk7XG5cblx0XHRcdFx0aWYgKHJvd01hdGNoKSB7XG5cdFx0XHRcdFx0dGhpcy5fc2VsZWN0Um93KHJvd01hdGNoLCB0cnVlLCB0cnVlKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0Um93cyhyb3dzKS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0XHRcdF90aGlzNzUuX3NlbGVjdFJvdyhyb3csIHRydWUsIHRydWUpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGhpcy5fcm93U2VsZWN0aW9uQ2hhbmdlZCgpO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocm93cykpIHtcblx0XHRcdFx0XHRyb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0XHRcdFx0X3RoaXM3NS5fc2VsZWN0Um93KHJvdywgdHJ1ZSwgdHJ1ZSk7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHR0aGlzLl9yb3dTZWxlY3Rpb25DaGFuZ2VkKCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fc2VsZWN0Um93KHJvd3MsIGZhbHNlLCB0cnVlKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cdH07XG5cblx0Ly9zZWxlY3QgYW4gaW5kaXZpZHVhbCByb3dcblx0U2VsZWN0Um93LnByb3RvdHlwZS5fc2VsZWN0Um93ID0gZnVuY3Rpb24gKHJvd0luZm8sIHNpbGVudCwgZm9yY2UpIHtcblx0XHR2YXIgaW5kZXg7XG5cblx0XHQvL2hhbmRsZSBtYXggcm93IGNvdW50XG5cdFx0aWYgKCFpc05hTih0aGlzLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZSkgJiYgdGhpcy50YWJsZS5vcHRpb25zLnNlbGVjdGFibGUgIT09IHRydWUgJiYgIWZvcmNlKSB7XG5cdFx0XHRpZiAodGhpcy5zZWxlY3RlZFJvd3MubGVuZ3RoID49IHRoaXMudGFibGUub3B0aW9ucy5zZWxlY3RhYmxlKSB7XG5cdFx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZVJvbGxpbmdTZWxlY3Rpb24pIHtcblx0XHRcdFx0XHR0aGlzLl9kZXNlbGVjdFJvdyh0aGlzLnNlbGVjdGVkUm93c1swXSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0dmFyIHJvdyA9IHRoaXMudGFibGUucm93TWFuYWdlci5maW5kUm93KHJvd0luZm8pO1xuXG5cdFx0aWYgKHJvdykge1xuXHRcdFx0aWYgKHRoaXMuc2VsZWN0ZWRSb3dzLmluZGV4T2Yocm93KSA9PSAtMSkge1xuXHRcdFx0XHRpZiAoIXJvdy5tb2R1bGVzLnNlbGVjdCkge1xuXHRcdFx0XHRcdHJvdy5tb2R1bGVzLnNlbGVjdCA9IHt9O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cm93Lm1vZHVsZXMuc2VsZWN0LnNlbGVjdGVkID0gdHJ1ZTtcblx0XHRcdFx0aWYgKHJvdy5tb2R1bGVzLnNlbGVjdC5jaGVja2JveEVsKSB7XG5cdFx0XHRcdFx0cm93Lm1vZHVsZXMuc2VsZWN0LmNoZWNrYm94RWwuY2hlY2tlZCA9IHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdFx0cm93LmdldEVsZW1lbnQoKS5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXNlbGVjdGVkXCIpO1xuXG5cdFx0XHRcdHRoaXMuc2VsZWN0ZWRSb3dzLnB1c2gocm93KTtcblxuXHRcdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmRhdGFUcmVlU2VsZWN0UHJvcGFnYXRlKSB7XG5cdFx0XHRcdFx0dGhpcy5jaGlsZFJvd1NlbGVjdGlvbihyb3csIHRydWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCFzaWxlbnQpIHtcblx0XHRcdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMucm93U2VsZWN0ZWQuY2FsbCh0aGlzLnRhYmxlLCByb3cuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGhpcy5fcm93U2VsZWN0aW9uQ2hhbmdlZChzaWxlbnQpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRpZiAoIXNpbGVudCkge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJTZWxlY3Rpb24gRXJyb3IgLSBObyBzdWNoIHJvdyBmb3VuZCwgaWdub3Jpbmcgc2VsZWN0aW9uOlwiICsgcm93SW5mbyk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFNlbGVjdFJvdy5wcm90b3R5cGUuaXNSb3dTZWxlY3RlZCA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHRyZXR1cm4gdGhpcy5zZWxlY3RlZFJvd3MuaW5kZXhPZihyb3cpICE9PSAtMTtcblx0fTtcblxuXHQvL2Rlc2VsZWN0IGEgbnVtYmVyIG9mIHJvd3Ncblx0U2VsZWN0Um93LnByb3RvdHlwZS5kZXNlbGVjdFJvd3MgPSBmdW5jdGlvbiAocm93cywgc2lsZW50KSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICByb3dDb3VudDtcblxuXHRcdGlmICh0eXBlb2Ygcm93cyA9PSBcInVuZGVmaW5lZFwiKSB7XG5cblx0XHRcdHJvd0NvdW50ID0gc2VsZi5zZWxlY3RlZFJvd3MubGVuZ3RoO1xuXG5cdFx0XHRmb3IgKHZhciBfaTEzID0gMDsgX2kxMyA8IHJvd0NvdW50OyBfaTEzKyspIHtcblx0XHRcdFx0c2VsZi5fZGVzZWxlY3RSb3coc2VsZi5zZWxlY3RlZFJvd3NbMF0sIHRydWUpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLl9yb3dTZWxlY3Rpb25DaGFuZ2VkKHNpbGVudCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJvd3MpKSB7XG5cdFx0XHRcdHJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRcdFx0c2VsZi5fZGVzZWxlY3RSb3cocm93LCB0cnVlKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0c2VsZi5fcm93U2VsZWN0aW9uQ2hhbmdlZChzaWxlbnQpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0c2VsZi5fZGVzZWxlY3RSb3cocm93cywgc2lsZW50KTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Ly9kZXNlbGVjdCBhbiBpbmRpdmlkdWFsIHJvd1xuXHRTZWxlY3RSb3cucHJvdG90eXBlLl9kZXNlbGVjdFJvdyA9IGZ1bmN0aW9uIChyb3dJbmZvLCBzaWxlbnQpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHJvdyA9IHNlbGYudGFibGUucm93TWFuYWdlci5maW5kUm93KHJvd0luZm8pLFxuXHRcdCAgICBpbmRleDtcblxuXHRcdGlmIChyb3cpIHtcblx0XHRcdGluZGV4ID0gc2VsZi5zZWxlY3RlZFJvd3MuZmluZEluZGV4KGZ1bmN0aW9uIChzZWxlY3RlZFJvdykge1xuXHRcdFx0XHRyZXR1cm4gc2VsZWN0ZWRSb3cgPT0gcm93O1xuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChpbmRleCA+IC0xKSB7XG5cblx0XHRcdFx0aWYgKCFyb3cubW9kdWxlcy5zZWxlY3QpIHtcblx0XHRcdFx0XHRyb3cubW9kdWxlcy5zZWxlY3QgPSB7fTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJvdy5tb2R1bGVzLnNlbGVjdC5zZWxlY3RlZCA9IGZhbHNlO1xuXHRcdFx0XHRpZiAocm93Lm1vZHVsZXMuc2VsZWN0LmNoZWNrYm94RWwpIHtcblx0XHRcdFx0XHRyb3cubW9kdWxlcy5zZWxlY3QuY2hlY2tib3hFbC5jaGVja2VkID0gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdFx0cm93LmdldEVsZW1lbnQoKS5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLXNlbGVjdGVkXCIpO1xuXHRcdFx0XHRzZWxmLnNlbGVjdGVkUm93cy5zcGxpY2UoaW5kZXgsIDEpO1xuXG5cdFx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuZGF0YVRyZWVTZWxlY3RQcm9wYWdhdGUpIHtcblx0XHRcdFx0XHR0aGlzLmNoaWxkUm93U2VsZWN0aW9uKHJvdywgZmFsc2UpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCFzaWxlbnQpIHtcblx0XHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMucm93RGVzZWxlY3RlZC5jYWxsKHRoaXMudGFibGUsIHJvdy5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxmLl9yb3dTZWxlY3Rpb25DaGFuZ2VkKHNpbGVudCk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlmICghc2lsZW50KSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkRlc2VsZWN0aW9uIEVycm9yIC0gTm8gc3VjaCByb3cgZm91bmQsIGlnbm9yaW5nIHNlbGVjdGlvbjpcIiArIHJvd0luZm8pO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRTZWxlY3RSb3cucHJvdG90eXBlLmdldFNlbGVjdGVkRGF0YSA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgZGF0YSA9IFtdO1xuXG5cdFx0dGhpcy5zZWxlY3RlZFJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRkYXRhLnB1c2gocm93LmdldERhdGEoKSk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gZGF0YTtcblx0fTtcblxuXHRTZWxlY3RSb3cucHJvdG90eXBlLmdldFNlbGVjdGVkUm93cyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciByb3dzID0gW107XG5cblx0XHR0aGlzLnNlbGVjdGVkUm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdHJvd3MucHVzaChyb3cuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJvd3M7XG5cdH07XG5cblx0U2VsZWN0Um93LnByb3RvdHlwZS5fcm93U2VsZWN0aW9uQ2hhbmdlZCA9IGZ1bmN0aW9uIChzaWxlbnQpIHtcblx0XHRpZiAodGhpcy5oZWFkZXJDaGVja2JveEVsZW1lbnQpIHtcblx0XHRcdGlmICh0aGlzLnNlbGVjdGVkUm93cy5sZW5ndGggPT09IDApIHtcblx0XHRcdFx0dGhpcy5oZWFkZXJDaGVja2JveEVsZW1lbnQuY2hlY2tlZCA9IGZhbHNlO1xuXHRcdFx0XHR0aGlzLmhlYWRlckNoZWNrYm94RWxlbWVudC5pbmRldGVybWluYXRlID0gZmFsc2U7XG5cdFx0XHR9IGVsc2UgaWYgKHRoaXMudGFibGUucm93TWFuYWdlci5yb3dzLmxlbmd0aCA9PT0gdGhpcy5zZWxlY3RlZFJvd3MubGVuZ3RoKSB7XG5cdFx0XHRcdHRoaXMuaGVhZGVyQ2hlY2tib3hFbGVtZW50LmNoZWNrZWQgPSB0cnVlO1xuXHRcdFx0XHR0aGlzLmhlYWRlckNoZWNrYm94RWxlbWVudC5pbmRldGVybWluYXRlID0gZmFsc2U7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLmhlYWRlckNoZWNrYm94RWxlbWVudC5pbmRldGVybWluYXRlID0gdHJ1ZTtcblx0XHRcdFx0dGhpcy5oZWFkZXJDaGVja2JveEVsZW1lbnQuY2hlY2tlZCA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghc2lsZW50KSB7XG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMucm93U2VsZWN0aW9uQ2hhbmdlZC5jYWxsKHRoaXMudGFibGUsIHRoaXMuZ2V0U2VsZWN0ZWREYXRhKCksIHRoaXMuZ2V0U2VsZWN0ZWRSb3dzKCkpO1xuXHRcdH1cblx0fTtcblxuXHRTZWxlY3RSb3cucHJvdG90eXBlLnJlZ2lzdGVyUm93U2VsZWN0Q2hlY2tib3ggPSBmdW5jdGlvbiAocm93LCBlbGVtZW50KSB7XG5cdFx0aWYgKCFyb3cuX3Jvdy5tb2R1bGVzLnNlbGVjdCkge1xuXHRcdFx0cm93Ll9yb3cubW9kdWxlcy5zZWxlY3QgPSB7fTtcblx0XHR9XG5cblx0XHRyb3cuX3Jvdy5tb2R1bGVzLnNlbGVjdC5jaGVja2JveEVsID0gZWxlbWVudDtcblx0fTtcblxuXHRTZWxlY3RSb3cucHJvdG90eXBlLnJlZ2lzdGVySGVhZGVyU2VsZWN0Q2hlY2tib3ggPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuXHRcdHRoaXMuaGVhZGVyQ2hlY2tib3hFbGVtZW50ID0gZWxlbWVudDtcblx0fTtcblxuXHRTZWxlY3RSb3cucHJvdG90eXBlLmNoaWxkUm93U2VsZWN0aW9uID0gZnVuY3Rpb24gKHJvdywgc2VsZWN0KSB7XG5cdFx0dmFyIGNoaWxkcmVuID0gdGhpcy50YWJsZS5tb2R1bGVzLmRhdGFUcmVlLmdldENoaWxkcmVuKHJvdyk7XG5cblx0XHRpZiAoc2VsZWN0KSB7XG5cdFx0XHRmb3IgKHZhciBfaXRlcmF0b3IyID0gY2hpbGRyZW4sIF9pc0FycmF5MiA9IEFycmF5LmlzQXJyYXkoX2l0ZXJhdG9yMiksIF9pMTQgPSAwLCBfaXRlcmF0b3IyID0gX2lzQXJyYXkyID8gX2l0ZXJhdG9yMiA6IF9pdGVyYXRvcjJbU3ltYm9sLml0ZXJhdG9yXSgpOzspIHtcblx0XHRcdFx0dmFyIF9yZWYyO1xuXG5cdFx0XHRcdGlmIChfaXNBcnJheTIpIHtcblx0XHRcdFx0XHRpZiAoX2kxNCA+PSBfaXRlcmF0b3IyLmxlbmd0aCkgYnJlYWs7XG5cdFx0XHRcdFx0X3JlZjIgPSBfaXRlcmF0b3IyW19pMTQrK107XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0X2kxNCA9IF9pdGVyYXRvcjIubmV4dCgpO1xuXHRcdFx0XHRcdGlmIChfaTE0LmRvbmUpIGJyZWFrO1xuXHRcdFx0XHRcdF9yZWYyID0gX2kxNC52YWx1ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHZhciBjaGlsZCA9IF9yZWYyO1xuXG5cdFx0XHRcdHRoaXMuX3NlbGVjdFJvdyhjaGlsZCwgdHJ1ZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGZvciAodmFyIF9pdGVyYXRvcjMgPSBjaGlsZHJlbiwgX2lzQXJyYXkzID0gQXJyYXkuaXNBcnJheShfaXRlcmF0b3IzKSwgX2kxNSA9IDAsIF9pdGVyYXRvcjMgPSBfaXNBcnJheTMgPyBfaXRlcmF0b3IzIDogX2l0ZXJhdG9yM1tTeW1ib2wuaXRlcmF0b3JdKCk7Oykge1xuXHRcdFx0XHR2YXIgX3JlZjM7XG5cblx0XHRcdFx0aWYgKF9pc0FycmF5Mykge1xuXHRcdFx0XHRcdGlmIChfaTE1ID49IF9pdGVyYXRvcjMubGVuZ3RoKSBicmVhaztcblx0XHRcdFx0XHRfcmVmMyA9IF9pdGVyYXRvcjNbX2kxNSsrXTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRfaTE1ID0gX2l0ZXJhdG9yMy5uZXh0KCk7XG5cdFx0XHRcdFx0aWYgKF9pMTUuZG9uZSkgYnJlYWs7XG5cdFx0XHRcdFx0X3JlZjMgPSBfaTE1LnZhbHVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dmFyIF9jaGlsZCA9IF9yZWYzO1xuXG5cdFx0XHRcdHRoaXMuX2Rlc2VsZWN0Um93KF9jaGlsZCwgdHJ1ZSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJzZWxlY3RSb3dcIiwgU2VsZWN0Um93KTtcblxuXHR2YXIgU29ydCA9IGZ1bmN0aW9uIFNvcnQodGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdFx0dGhpcy5zb3J0TGlzdCA9IFtdOyAvL2hvbGRlciBjdXJyZW50IHNvcnRcblx0XHR0aGlzLmNoYW5nZWQgPSBmYWxzZTsgLy9oYXMgdGhlIHNvcnQgY2hhbmdlZCBzaW5jZSBsYXN0IHJlbmRlclxuXHR9O1xuXG5cdC8vaW5pdGlhbGl6ZSBjb2x1bW4gaGVhZGVyIGZvciBzb3J0aW5nXG5cdFNvcnQucHJvdG90eXBlLmluaXRpYWxpemVDb2x1bW4gPSBmdW5jdGlvbiAoY29sdW1uLCBjb250ZW50KSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBzb3J0ZXIgPSBmYWxzZSxcblx0XHQgICAgY29sRWwsXG5cdFx0ICAgIGFycm93RWw7XG5cblx0XHRzd2l0Y2ggKF90eXBlb2YoY29sdW1uLmRlZmluaXRpb24uc29ydGVyKSkge1xuXHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHRpZiAoc2VsZi5zb3J0ZXJzW2NvbHVtbi5kZWZpbml0aW9uLnNvcnRlcl0pIHtcblx0XHRcdFx0XHRzb3J0ZXIgPSBzZWxmLnNvcnRlcnNbY29sdW1uLmRlZmluaXRpb24uc29ydGVyXTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJTb3J0IEVycm9yIC0gTm8gc3VjaCBzb3J0ZXIgZm91bmQ6IFwiLCBjb2x1bW4uZGVmaW5pdGlvbi5zb3J0ZXIpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0c29ydGVyID0gY29sdW1uLmRlZmluaXRpb24uc29ydGVyO1xuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cblx0XHRjb2x1bW4ubW9kdWxlcy5zb3J0ID0ge1xuXHRcdFx0c29ydGVyOiBzb3J0ZXIsIGRpcjogXCJub25lXCIsXG5cdFx0XHRwYXJhbXM6IGNvbHVtbi5kZWZpbml0aW9uLnNvcnRlclBhcmFtcyB8fCB7fSxcblx0XHRcdHN0YXJ0aW5nRGlyOiBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJTb3J0U3RhcnRpbmdEaXIgfHwgXCJhc2NcIixcblx0XHRcdHRyaXN0YXRlOiB0eXBlb2YgY29sdW1uLmRlZmluaXRpb24uaGVhZGVyU29ydFRyaXN0YXRlICE9PSBcInVuZGVmaW5lZFwiID8gY29sdW1uLmRlZmluaXRpb24uaGVhZGVyU29ydFRyaXN0YXRlIDogdGhpcy50YWJsZS5vcHRpb25zLmhlYWRlclNvcnRUcmlzdGF0ZVxuXHRcdH07XG5cblx0XHRpZiAodHlwZW9mIGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlclNvcnQgPT09IFwidW5kZWZpbmVkXCIgPyB0aGlzLnRhYmxlLm9wdGlvbnMuaGVhZGVyU29ydCAhPT0gZmFsc2UgOiBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJTb3J0ICE9PSBmYWxzZSkge1xuXG5cdFx0XHRjb2xFbCA9IGNvbHVtbi5nZXRFbGVtZW50KCk7XG5cblx0XHRcdGNvbEVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itc29ydGFibGVcIik7XG5cblx0XHRcdGFycm93RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0YXJyb3dFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWFycm93XCIpO1xuXHRcdFx0Ly9jcmVhdGUgc29ydGVyIGFycm93XG5cdFx0XHRjb250ZW50LmFwcGVuZENoaWxkKGFycm93RWwpO1xuXG5cdFx0XHQvL3NvcnQgb24gY2xpY2tcblx0XHRcdGNvbEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHR2YXIgZGlyID0gXCJcIixcblx0XHRcdFx0ICAgIHNvcnRlcnMgPSBbXSxcblx0XHRcdFx0ICAgIG1hdGNoID0gZmFsc2U7XG5cblx0XHRcdFx0aWYgKGNvbHVtbi5tb2R1bGVzLnNvcnQpIHtcblx0XHRcdFx0XHRpZiAoY29sdW1uLm1vZHVsZXMuc29ydC50cmlzdGF0ZSkge1xuXHRcdFx0XHRcdFx0aWYgKGNvbHVtbi5tb2R1bGVzLnNvcnQuZGlyID09IFwibm9uZVwiKSB7XG5cdFx0XHRcdFx0XHRcdGRpciA9IGNvbHVtbi5tb2R1bGVzLnNvcnQuc3RhcnRpbmdEaXI7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRpZiAoY29sdW1uLm1vZHVsZXMuc29ydC5kaXIgPT0gY29sdW1uLm1vZHVsZXMuc29ydC5zdGFydGluZ0Rpcikge1xuXHRcdFx0XHRcdFx0XHRcdGRpciA9IGNvbHVtbi5tb2R1bGVzLnNvcnQuZGlyID09IFwiYXNjXCIgPyBcImRlc2NcIiA6IFwiYXNjXCI7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0ZGlyID0gXCJub25lXCI7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0c3dpdGNoIChjb2x1bW4ubW9kdWxlcy5zb3J0LmRpcikge1xuXHRcdFx0XHRcdFx0XHRjYXNlIFwiYXNjXCI6XG5cdFx0XHRcdFx0XHRcdFx0ZGlyID0gXCJkZXNjXCI7XG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdFx0Y2FzZSBcImRlc2NcIjpcblx0XHRcdFx0XHRcdFx0XHRkaXIgPSBcImFzY1wiO1xuXHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHRcdFx0ZGlyID0gY29sdW1uLm1vZHVsZXMuc29ydC5zdGFydGluZ0Rpcjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLmNvbHVtbkhlYWRlclNvcnRNdWx0aSAmJiAoZS5zaGlmdEtleSB8fCBlLmN0cmxLZXkpKSB7XG5cdFx0XHRcdFx0XHRzb3J0ZXJzID0gc2VsZi5nZXRTb3J0KCk7XG5cblx0XHRcdFx0XHRcdG1hdGNoID0gc29ydGVycy5maW5kSW5kZXgoZnVuY3Rpb24gKHNvcnRlcikge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gc29ydGVyLmZpZWxkID09PSBjb2x1bW4uZ2V0RmllbGQoKTtcblx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRpZiAobWF0Y2ggPiAtMSkge1xuXHRcdFx0XHRcdFx0XHRzb3J0ZXJzW21hdGNoXS5kaXIgPSBkaXI7XG5cblx0XHRcdFx0XHRcdFx0aWYgKG1hdGNoICE9IHNvcnRlcnMubGVuZ3RoIC0gMSkge1xuXHRcdFx0XHRcdFx0XHRcdG1hdGNoID0gc29ydGVycy5zcGxpY2UobWF0Y2gsIDEpWzBdO1xuXHRcdFx0XHRcdFx0XHRcdGlmIChkaXIgIT0gXCJub25lXCIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHNvcnRlcnMucHVzaChtYXRjaCk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRpZiAoZGlyICE9IFwibm9uZVwiKSB7XG5cdFx0XHRcdFx0XHRcdFx0c29ydGVycy5wdXNoKHsgY29sdW1uOiBjb2x1bW4sIGRpcjogZGlyIH0pO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vYWRkIHRvIGV4aXN0aW5nIHNvcnRcblx0XHRcdFx0XHRcdHNlbGYuc2V0U29ydChzb3J0ZXJzKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0aWYgKGRpciA9PSBcIm5vbmVcIikge1xuXHRcdFx0XHRcdFx0XHRzZWxmLmNsZWFyKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHQvL3NvcnQgYnkgY29sdW1uIG9ubHlcblx0XHRcdFx0XHRcdFx0c2VsZi5zZXRTb3J0KGNvbHVtbiwgZGlyKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRzZWxmLnRhYmxlLnJvd01hbmFnZXIuc29ydGVyUmVmcmVzaCghc2VsZi5zb3J0TGlzdC5sZW5ndGgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cdH07XG5cblx0Ly9jaGVjayBpZiB0aGUgc29ydGVycyBoYXZlIGNoYW5nZWQgc2luY2UgbGFzdCB1c2Vcblx0U29ydC5wcm90b3R5cGUuaGFzQ2hhbmdlZCA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgY2hhbmdlZCA9IHRoaXMuY2hhbmdlZDtcblx0XHR0aGlzLmNoYW5nZWQgPSBmYWxzZTtcblx0XHRyZXR1cm4gY2hhbmdlZDtcblx0fTtcblxuXHQvL3JldHVybiBjdXJyZW50IHNvcnRlcnNcblx0U29ydC5wcm90b3R5cGUuZ2V0U29ydCA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHNvcnRlcnMgPSBbXTtcblxuXHRcdHNlbGYuc29ydExpc3QuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0aWYgKGl0ZW0uY29sdW1uKSB7XG5cdFx0XHRcdHNvcnRlcnMucHVzaCh7IGNvbHVtbjogaXRlbS5jb2x1bW4uZ2V0Q29tcG9uZW50KCksIGZpZWxkOiBpdGVtLmNvbHVtbi5nZXRGaWVsZCgpLCBkaXI6IGl0ZW0uZGlyIH0pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHNvcnRlcnM7XG5cdH07XG5cblx0Ly9jaGFuZ2Ugc29ydCBsaXN0IGFuZCB0cmlnZ2VyIHNvcnRcblx0U29ydC5wcm90b3R5cGUuc2V0U29ydCA9IGZ1bmN0aW9uIChzb3J0TGlzdCwgZGlyKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBuZXdTb3J0TGlzdCA9IFtdO1xuXG5cdFx0aWYgKCFBcnJheS5pc0FycmF5KHNvcnRMaXN0KSkge1xuXHRcdFx0c29ydExpc3QgPSBbeyBjb2x1bW46IHNvcnRMaXN0LCBkaXI6IGRpciB9XTtcblx0XHR9XG5cblx0XHRzb3J0TGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHR2YXIgY29sdW1uO1xuXG5cdFx0XHRjb2x1bW4gPSBzZWxmLnRhYmxlLmNvbHVtbk1hbmFnZXIuZmluZENvbHVtbihpdGVtLmNvbHVtbik7XG5cblx0XHRcdGlmIChjb2x1bW4pIHtcblx0XHRcdFx0aXRlbS5jb2x1bW4gPSBjb2x1bW47XG5cdFx0XHRcdG5ld1NvcnRMaXN0LnB1c2goaXRlbSk7XG5cdFx0XHRcdHNlbGYuY2hhbmdlZCA9IHRydWU7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJTb3J0IFdhcm5pbmcgLSBTb3J0IGZpZWxkIGRvZXMgbm90IGV4aXN0IGFuZCBpcyBiZWluZyBpZ25vcmVkOiBcIiwgaXRlbS5jb2x1bW4pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0c2VsZi5zb3J0TGlzdCA9IG5ld1NvcnRMaXN0O1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInBlcnNpc3RlbmNlXCIsIHRydWUpICYmIHRoaXMudGFibGUubW9kdWxlcy5wZXJzaXN0ZW5jZS5jb25maWcuc29ydCkge1xuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLnNhdmUoXCJzb3J0XCIpO1xuXHRcdH1cblx0fTtcblxuXHQvL2NsZWFyIHNvcnRlcnNcblx0U29ydC5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy5zZXRTb3J0KFtdKTtcblx0fTtcblxuXHQvL2ZpbmQgYXBwcm9wcmlhdGUgc29ydGVyIGZvciBjb2x1bW5cblx0U29ydC5wcm90b3R5cGUuZmluZFNvcnRlciA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHR2YXIgcm93ID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmFjdGl2ZVJvd3NbMF0sXG5cdFx0ICAgIHNvcnRlciA9IFwic3RyaW5nXCIsXG5cdFx0ICAgIGZpZWxkLFxuXHRcdCAgICB2YWx1ZTtcblxuXHRcdGlmIChyb3cpIHtcblx0XHRcdHJvdyA9IHJvdy5nZXREYXRhKCk7XG5cdFx0XHRmaWVsZCA9IGNvbHVtbi5nZXRGaWVsZCgpO1xuXG5cdFx0XHRpZiAoZmllbGQpIHtcblxuXHRcdFx0XHR2YWx1ZSA9IGNvbHVtbi5nZXRGaWVsZFZhbHVlKHJvdyk7XG5cblx0XHRcdFx0c3dpdGNoICh0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKHZhbHVlKSkge1xuXHRcdFx0XHRcdGNhc2UgXCJ1bmRlZmluZWRcIjpcblx0XHRcdFx0XHRcdHNvcnRlciA9IFwic3RyaW5nXCI7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgXCJib29sZWFuXCI6XG5cdFx0XHRcdFx0XHRzb3J0ZXIgPSBcImJvb2xlYW5cIjtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRcdGlmICghaXNOYU4odmFsdWUpICYmIHZhbHVlICE9PSBcIlwiKSB7XG5cdFx0XHRcdFx0XHRcdHNvcnRlciA9IFwibnVtYmVyXCI7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRpZiAodmFsdWUubWF0Y2goLygoXlswLTldK1thLXpdKyl8KF5bYS16XStbMC05XSspKSskL2kpKSB7XG5cdFx0XHRcdFx0XHRcdFx0c29ydGVyID0gXCJhbHBoYW51bVwiO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzLnNvcnRlcnNbc29ydGVyXTtcblx0fTtcblxuXHQvL3dvcmsgdGhyb3VnaCBzb3J0IGxpc3Qgc29ydGluZyBkYXRhXG5cdFNvcnQucHJvdG90eXBlLnNvcnQgPSBmdW5jdGlvbiAoZGF0YSkge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgc29ydExpc3QgPSB0aGlzLnRhYmxlLm9wdGlvbnMuc29ydE9yZGVyUmV2ZXJzZSA/IHNlbGYuc29ydExpc3Quc2xpY2UoKS5yZXZlcnNlKCkgOiBzZWxmLnNvcnRMaXN0LFxuXHRcdCAgICBzb3J0TGlzdEFjdHVhbCA9IFtdLFxuXHRcdCAgICByb3dDb21wb25lbnRzID0gW10sXG5cdFx0ICAgIGxhc3RTb3J0O1xuXG5cdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5kYXRhU29ydGluZykge1xuXHRcdFx0c2VsZi50YWJsZS5vcHRpb25zLmRhdGFTb3J0aW5nLmNhbGwoc2VsZi50YWJsZSwgc2VsZi5nZXRTb3J0KCkpO1xuXHRcdH1cblxuXHRcdHNlbGYuY2xlYXJDb2x1bW5IZWFkZXJzKCk7XG5cblx0XHRpZiAoIXNlbGYudGFibGUub3B0aW9ucy5hamF4U29ydGluZykge1xuXG5cdFx0XHQvL2J1aWxkIGxpc3Qgb2YgdmFsaWQgc29ydGVycyBhbmQgdHJpZ2dlciBjb2x1bW4gc3BlY2lmaWMgY2FsbGJhY2tzIGJlZm9yZSBzb3J0IGJlZ2luc1xuXHRcdFx0c29ydExpc3QuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaSkge1xuXHRcdFx0XHR2YXIgc29ydE9iaiA9IGl0ZW0uY29sdW1uLm1vZHVsZXMuc29ydDtcblxuXHRcdFx0XHRpZiAoaXRlbS5jb2x1bW4gJiYgc29ydE9iaikge1xuXG5cdFx0XHRcdFx0Ly9pZiBubyBzb3J0ZXIgaGFzIGJlZW4gZGVmaW5lZCwgdGFrZSBhIGd1ZXNzXG5cdFx0XHRcdFx0aWYgKCFzb3J0T2JqLnNvcnRlcikge1xuXHRcdFx0XHRcdFx0c29ydE9iai5zb3J0ZXIgPSBzZWxmLmZpbmRTb3J0ZXIoaXRlbS5jb2x1bW4pO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGl0ZW0ucGFyYW1zID0gdHlwZW9mIHNvcnRPYmoucGFyYW1zID09PSBcImZ1bmN0aW9uXCIgPyBzb3J0T2JqLnBhcmFtcyhpdGVtLmNvbHVtbi5nZXRDb21wb25lbnQoKSwgaXRlbS5kaXIpIDogc29ydE9iai5wYXJhbXM7XG5cblx0XHRcdFx0XHRzb3J0TGlzdEFjdHVhbC5wdXNoKGl0ZW0pO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsZi5zZXRDb2x1bW5IZWFkZXIoaXRlbS5jb2x1bW4sIGl0ZW0uZGlyKTtcblx0XHRcdH0pO1xuXG5cdFx0XHQvL3NvcnQgZGF0YVxuXHRcdFx0aWYgKHNvcnRMaXN0QWN0dWFsLmxlbmd0aCkge1xuXHRcdFx0XHRzZWxmLl9zb3J0SXRlbXMoZGF0YSwgc29ydExpc3RBY3R1YWwpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRzb3J0TGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpKSB7XG5cdFx0XHRcdHNlbGYuc2V0Q29sdW1uSGVhZGVyKGl0ZW0uY29sdW1uLCBpdGVtLmRpcik7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLmRhdGFTb3J0ZWQpIHtcblx0XHRcdGRhdGEuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRcdHJvd0NvbXBvbmVudHMucHVzaChyb3cuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5kYXRhU29ydGVkLmNhbGwoc2VsZi50YWJsZSwgc2VsZi5nZXRTb3J0KCksIHJvd0NvbXBvbmVudHMpO1xuXHRcdH1cblx0fTtcblxuXHQvL2NsZWFyIHNvcnQgYXJyb3dzIG9uIGNvbHVtbnNcblx0U29ydC5wcm90b3R5cGUuY2xlYXJDb2x1bW5IZWFkZXJzID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRSZWFsQ29sdW1ucygpLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdFx0aWYgKGNvbHVtbi5tb2R1bGVzLnNvcnQpIHtcblx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuc29ydC5kaXIgPSBcIm5vbmVcIjtcblx0XHRcdFx0Y29sdW1uLmdldEVsZW1lbnQoKS5zZXRBdHRyaWJ1dGUoXCJhcmlhLXNvcnRcIiwgXCJub25lXCIpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdC8vc2V0IHRoZSBjb2x1bW4gaGVhZGVyIHNvcnQgZGlyZWN0aW9uXG5cdFNvcnQucHJvdG90eXBlLnNldENvbHVtbkhlYWRlciA9IGZ1bmN0aW9uIChjb2x1bW4sIGRpcikge1xuXHRcdGNvbHVtbi5tb2R1bGVzLnNvcnQuZGlyID0gZGlyO1xuXHRcdGNvbHVtbi5nZXRFbGVtZW50KCkuc2V0QXR0cmlidXRlKFwiYXJpYS1zb3J0XCIsIGRpcik7XG5cdH07XG5cblx0Ly9zb3J0IGVhY2ggaXRlbSBpbiBzb3J0IGxpc3Rcblx0U29ydC5wcm90b3R5cGUuX3NvcnRJdGVtcyA9IGZ1bmN0aW9uIChkYXRhLCBzb3J0TGlzdCkge1xuXHRcdHZhciBfdGhpczc2ID0gdGhpcztcblxuXHRcdHZhciBzb3J0ZXJDb3VudCA9IHNvcnRMaXN0Lmxlbmd0aCAtIDE7XG5cblx0XHRkYXRhLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcblx0XHRcdHZhciByZXN1bHQ7XG5cblx0XHRcdGZvciAodmFyIGkgPSBzb3J0ZXJDb3VudDsgaSA+PSAwOyBpLS0pIHtcblx0XHRcdFx0dmFyIHNvcnRJdGVtID0gc29ydExpc3RbaV07XG5cblx0XHRcdFx0cmVzdWx0ID0gX3RoaXM3Ni5fc29ydFJvdyhhLCBiLCBzb3J0SXRlbS5jb2x1bW4sIHNvcnRJdGVtLmRpciwgc29ydEl0ZW0ucGFyYW1zKTtcblxuXHRcdFx0XHRpZiAocmVzdWx0ICE9PSAwKSB7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHJlc3VsdDtcblx0XHR9KTtcblx0fTtcblxuXHQvL3Byb2Nlc3MgaW5kaXZpZHVhbCByb3dzIGZvciBhIHNvcnQgZnVuY3Rpb24gb24gYWN0aXZlIGRhdGFcblx0U29ydC5wcm90b3R5cGUuX3NvcnRSb3cgPSBmdW5jdGlvbiAoYSwgYiwgY29sdW1uLCBkaXIsIHBhcmFtcykge1xuXHRcdHZhciBlbDFDb21wLCBlbDJDb21wLCBjb2xDb21wO1xuXG5cdFx0Ly9zd2l0Y2ggZWxlbWVudHMgZGVwZW5kaW5nIG9uIHNlYXJjaCBkaXJlY3Rpb25cblx0XHR2YXIgZWwxID0gZGlyID09IFwiYXNjXCIgPyBhIDogYjtcblx0XHR2YXIgZWwyID0gZGlyID09IFwiYXNjXCIgPyBiIDogYTtcblxuXHRcdGEgPSBjb2x1bW4uZ2V0RmllbGRWYWx1ZShlbDEuZ2V0RGF0YSgpKTtcblx0XHRiID0gY29sdW1uLmdldEZpZWxkVmFsdWUoZWwyLmdldERhdGEoKSk7XG5cblx0XHRhID0gdHlwZW9mIGEgIT09IFwidW5kZWZpbmVkXCIgPyBhIDogXCJcIjtcblx0XHRiID0gdHlwZW9mIGIgIT09IFwidW5kZWZpbmVkXCIgPyBiIDogXCJcIjtcblxuXHRcdGVsMUNvbXAgPSBlbDEuZ2V0Q29tcG9uZW50KCk7XG5cdFx0ZWwyQ29tcCA9IGVsMi5nZXRDb21wb25lbnQoKTtcblxuXHRcdHJldHVybiBjb2x1bW4ubW9kdWxlcy5zb3J0LnNvcnRlci5jYWxsKHRoaXMsIGEsIGIsIGVsMUNvbXAsIGVsMkNvbXAsIGNvbHVtbi5nZXRDb21wb25lbnQoKSwgZGlyLCBwYXJhbXMpO1xuXHR9O1xuXG5cdC8vZGVmYXVsdCBkYXRhIHNvcnRlcnNcblx0U29ydC5wcm90b3R5cGUuc29ydGVycyA9IHtcblxuXHRcdC8vc29ydCBudW1iZXJzXG5cdFx0bnVtYmVyOiBmdW5jdGlvbiBudW1iZXIoYSwgYiwgYVJvdywgYlJvdywgY29sdW1uLCBkaXIsIHBhcmFtcykge1xuXHRcdFx0dmFyIGFsaWduRW1wdHlWYWx1ZXMgPSBwYXJhbXMuYWxpZ25FbXB0eVZhbHVlcztcblx0XHRcdHZhciBkZWNpbWFsID0gcGFyYW1zLmRlY2ltYWxTZXBhcmF0b3IgfHwgXCIuXCI7XG5cdFx0XHR2YXIgdGhvdXNhbmQgPSBwYXJhbXMudGhvdXNhbmRTZXBhcmF0b3IgfHwgXCIsXCI7XG5cdFx0XHR2YXIgZW1wdHlBbGlnbiA9IDA7XG5cblx0XHRcdGEgPSBwYXJzZUZsb2F0KFN0cmluZyhhKS5zcGxpdCh0aG91c2FuZCkuam9pbihcIlwiKS5zcGxpdChkZWNpbWFsKS5qb2luKFwiLlwiKSk7XG5cdFx0XHRiID0gcGFyc2VGbG9hdChTdHJpbmcoYikuc3BsaXQodGhvdXNhbmQpLmpvaW4oXCJcIikuc3BsaXQoZGVjaW1hbCkuam9pbihcIi5cIikpO1xuXG5cdFx0XHQvL2hhbmRsZSBub24gbnVtZXJpYyB2YWx1ZXNcblx0XHRcdGlmIChpc05hTihhKSkge1xuXHRcdFx0XHRlbXB0eUFsaWduID0gaXNOYU4oYikgPyAwIDogLTE7XG5cdFx0XHR9IGVsc2UgaWYgKGlzTmFOKGIpKSB7XG5cdFx0XHRcdGVtcHR5QWxpZ24gPSAxO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly9jb21wYXJlIHZhbGlkIHZhbHVlc1xuXHRcdFx0XHRyZXR1cm4gYSAtIGI7XG5cdFx0XHR9XG5cblx0XHRcdC8vZml4IGVtcHR5IHZhbHVlcyBpbiBwb3NpdGlvblxuXHRcdFx0aWYgKGFsaWduRW1wdHlWYWx1ZXMgPT09IFwidG9wXCIgJiYgZGlyID09PSBcImRlc2NcIiB8fCBhbGlnbkVtcHR5VmFsdWVzID09PSBcImJvdHRvbVwiICYmIGRpciA9PT0gXCJhc2NcIikge1xuXHRcdFx0XHRlbXB0eUFsaWduICo9IC0xO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZW1wdHlBbGlnbjtcblx0XHR9LFxuXG5cdFx0Ly9zb3J0IHN0cmluZ3Ncblx0XHRzdHJpbmc6IGZ1bmN0aW9uIHN0cmluZyhhLCBiLCBhUm93LCBiUm93LCBjb2x1bW4sIGRpciwgcGFyYW1zKSB7XG5cdFx0XHR2YXIgYWxpZ25FbXB0eVZhbHVlcyA9IHBhcmFtcy5hbGlnbkVtcHR5VmFsdWVzO1xuXHRcdFx0dmFyIGVtcHR5QWxpZ24gPSAwO1xuXHRcdFx0dmFyIGxvY2FsZTtcblxuXHRcdFx0Ly9oYW5kbGUgZW1wdHkgdmFsdWVzXG5cdFx0XHRpZiAoIWEpIHtcblx0XHRcdFx0ZW1wdHlBbGlnbiA9ICFiID8gMCA6IC0xO1xuXHRcdFx0fSBlbHNlIGlmICghYikge1xuXHRcdFx0XHRlbXB0eUFsaWduID0gMTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vY29tcGFyZSB2YWxpZCB2YWx1ZXNcblx0XHRcdFx0c3dpdGNoIChfdHlwZW9mKHBhcmFtcy5sb2NhbGUpKSB7XG5cdFx0XHRcdFx0Y2FzZSBcImJvb2xlYW5cIjpcblx0XHRcdFx0XHRcdGlmIChwYXJhbXMubG9jYWxlKSB7XG5cdFx0XHRcdFx0XHRcdGxvY2FsZSA9IHRoaXMudGFibGUubW9kdWxlcy5sb2NhbGl6ZS5nZXRMb2NhbGUoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0XHRcdGxvY2FsZSA9IHBhcmFtcy5sb2NhbGU7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBTdHJpbmcoYSkudG9Mb3dlckNhc2UoKS5sb2NhbGVDb21wYXJlKFN0cmluZyhiKS50b0xvd2VyQ2FzZSgpLCBsb2NhbGUpO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2ZpeCBlbXB0eSB2YWx1ZXMgaW4gcG9zaXRpb25cblx0XHRcdGlmIChhbGlnbkVtcHR5VmFsdWVzID09PSBcInRvcFwiICYmIGRpciA9PT0gXCJkZXNjXCIgfHwgYWxpZ25FbXB0eVZhbHVlcyA9PT0gXCJib3R0b21cIiAmJiBkaXIgPT09IFwiYXNjXCIpIHtcblx0XHRcdFx0ZW1wdHlBbGlnbiAqPSAtMTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGVtcHR5QWxpZ247XG5cdFx0fSxcblxuXHRcdC8vc29ydCBkYXRlXG5cdFx0ZGF0ZTogZnVuY3Rpb24gZGF0ZShhLCBiLCBhUm93LCBiUm93LCBjb2x1bW4sIGRpciwgcGFyYW1zKSB7XG5cdFx0XHRpZiAoIXBhcmFtcy5mb3JtYXQpIHtcblx0XHRcdFx0cGFyYW1zLmZvcm1hdCA9IFwiREQvTU0vWVlZWVwiO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcy5zb3J0ZXJzLmRhdGV0aW1lLmNhbGwodGhpcywgYSwgYiwgYVJvdywgYlJvdywgY29sdW1uLCBkaXIsIHBhcmFtcyk7XG5cdFx0fSxcblxuXHRcdC8vc29ydCBISDptbSBmb3JtYXR0ZWQgdGltZXNcblx0XHR0aW1lOiBmdW5jdGlvbiB0aW1lKGEsIGIsIGFSb3csIGJSb3csIGNvbHVtbiwgZGlyLCBwYXJhbXMpIHtcblx0XHRcdGlmICghcGFyYW1zLmZvcm1hdCkge1xuXHRcdFx0XHRwYXJhbXMuZm9ybWF0ID0gXCJISDptbVwiO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcy5zb3J0ZXJzLmRhdGV0aW1lLmNhbGwodGhpcywgYSwgYiwgYVJvdywgYlJvdywgY29sdW1uLCBkaXIsIHBhcmFtcyk7XG5cdFx0fSxcblxuXHRcdC8vc29ydCBkYXRldGltZVxuXHRcdGRhdGV0aW1lOiBmdW5jdGlvbiBkYXRldGltZShhLCBiLCBhUm93LCBiUm93LCBjb2x1bW4sIGRpciwgcGFyYW1zKSB7XG5cdFx0XHR2YXIgZm9ybWF0ID0gcGFyYW1zLmZvcm1hdCB8fCBcIkREL01NL1lZWVkgSEg6bW06c3NcIixcblx0XHRcdCAgICBhbGlnbkVtcHR5VmFsdWVzID0gcGFyYW1zLmFsaWduRW1wdHlWYWx1ZXMsXG5cdFx0XHQgICAgZW1wdHlBbGlnbiA9IDA7XG5cblx0XHRcdGlmICh0eXBlb2YgbW9tZW50ICE9IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0YSA9IG1vbWVudChhLCBmb3JtYXQpO1xuXHRcdFx0XHRiID0gbW9tZW50KGIsIGZvcm1hdCk7XG5cblx0XHRcdFx0aWYgKCFhLmlzVmFsaWQoKSkge1xuXHRcdFx0XHRcdGVtcHR5QWxpZ24gPSAhYi5pc1ZhbGlkKCkgPyAwIDogLTE7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIWIuaXNWYWxpZCgpKSB7XG5cdFx0XHRcdFx0ZW1wdHlBbGlnbiA9IDE7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Ly9jb21wYXJlIHZhbGlkIHZhbHVlc1xuXHRcdFx0XHRcdHJldHVybiBhIC0gYjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vZml4IGVtcHR5IHZhbHVlcyBpbiBwb3NpdGlvblxuXHRcdFx0XHRpZiAoYWxpZ25FbXB0eVZhbHVlcyA9PT0gXCJ0b3BcIiAmJiBkaXIgPT09IFwiZGVzY1wiIHx8IGFsaWduRW1wdHlWYWx1ZXMgPT09IFwiYm90dG9tXCIgJiYgZGlyID09PSBcImFzY1wiKSB7XG5cdFx0XHRcdFx0ZW1wdHlBbGlnbiAqPSAtMTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBlbXB0eUFsaWduO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29uc29sZS5lcnJvcihcIlNvcnQgRXJyb3IgLSAnZGF0ZXRpbWUnIHNvcnRlciBpcyBkZXBlbmRhbnQgb24gbW9tZW50LmpzXCIpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvL3NvcnQgYm9vbGVhbnNcblx0XHRib29sZWFuOiBmdW5jdGlvbiBib29sZWFuKGEsIGIsIGFSb3csIGJSb3csIGNvbHVtbiwgZGlyLCBwYXJhbXMpIHtcblx0XHRcdHZhciBlbDEgPSBhID09PSB0cnVlIHx8IGEgPT09IFwidHJ1ZVwiIHx8IGEgPT09IFwiVHJ1ZVwiIHx8IGEgPT09IDEgPyAxIDogMDtcblx0XHRcdHZhciBlbDIgPSBiID09PSB0cnVlIHx8IGIgPT09IFwidHJ1ZVwiIHx8IGIgPT09IFwiVHJ1ZVwiIHx8IGIgPT09IDEgPyAxIDogMDtcblxuXHRcdFx0cmV0dXJuIGVsMSAtIGVsMjtcblx0XHR9LFxuXG5cdFx0Ly9zb3J0IGlmIGVsZW1lbnQgY29udGFpbnMgYW55IGRhdGFcblx0XHRhcnJheTogZnVuY3Rpb24gYXJyYXkoYSwgYiwgYVJvdywgYlJvdywgY29sdW1uLCBkaXIsIHBhcmFtcykge1xuXHRcdFx0dmFyIGVsMSA9IDA7XG5cdFx0XHR2YXIgZWwyID0gMDtcblx0XHRcdHZhciB0eXBlID0gcGFyYW1zLnR5cGUgfHwgXCJsZW5ndGhcIjtcblx0XHRcdHZhciBhbGlnbkVtcHR5VmFsdWVzID0gcGFyYW1zLmFsaWduRW1wdHlWYWx1ZXM7XG5cdFx0XHR2YXIgZW1wdHlBbGlnbiA9IDA7XG5cblx0XHRcdGZ1bmN0aW9uIGNhbGModmFsdWUpIHtcblxuXHRcdFx0XHRzd2l0Y2ggKHR5cGUpIHtcblx0XHRcdFx0XHRjYXNlIFwibGVuZ3RoXCI6XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWUubGVuZ3RoO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFwic3VtXCI6XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWUucmVkdWNlKGZ1bmN0aW9uIChjLCBkKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBjICsgZDtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFwibWF4XCI6XG5cdFx0XHRcdFx0XHRyZXR1cm4gTWF0aC5tYXguYXBwbHkobnVsbCwgdmFsdWUpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFwibWluXCI6XG5cdFx0XHRcdFx0XHRyZXR1cm4gTWF0aC5taW4uYXBwbHkobnVsbCwgdmFsdWUpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFwiYXZnXCI6XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWUucmVkdWNlKGZ1bmN0aW9uIChjLCBkKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBjICsgZDtcblx0XHRcdFx0XHRcdH0pIC8gdmFsdWUubGVuZ3RoO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly9oYW5kbGUgbm9uIGFycmF5IHZhbHVlc1xuXHRcdFx0aWYgKCFBcnJheS5pc0FycmF5KGEpKSB7XG5cdFx0XHRcdGFsaWduRW1wdHlWYWx1ZXMgPSAhQXJyYXkuaXNBcnJheShiKSA/IDAgOiAtMTtcblx0XHRcdH0gZWxzZSBpZiAoIUFycmF5LmlzQXJyYXkoYikpIHtcblx0XHRcdFx0YWxpZ25FbXB0eVZhbHVlcyA9IDE7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdC8vY29tcGFyZSB2YWxpZCB2YWx1ZXNcblx0XHRcdFx0ZWwxID0gYSA/IGNhbGMoYSkgOiAwO1xuXHRcdFx0XHRlbDIgPSBiID8gY2FsYyhiKSA6IDA7XG5cblx0XHRcdFx0cmV0dXJuIGVsMSAtIGVsMjtcblx0XHRcdH1cblxuXHRcdFx0Ly9maXggZW1wdHkgdmFsdWVzIGluIHBvc2l0aW9uXG5cdFx0XHRpZiAoYWxpZ25FbXB0eVZhbHVlcyA9PT0gXCJ0b3BcIiAmJiBkaXIgPT09IFwiZGVzY1wiIHx8IGFsaWduRW1wdHlWYWx1ZXMgPT09IFwiYm90dG9tXCIgJiYgZGlyID09PSBcImFzY1wiKSB7XG5cdFx0XHRcdGVtcHR5QWxpZ24gKj0gLTE7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBlbXB0eUFsaWduO1xuXHRcdH0sXG5cblx0XHQvL3NvcnQgaWYgZWxlbWVudCBjb250YWlucyBhbnkgZGF0YVxuXHRcdGV4aXN0czogZnVuY3Rpb24gZXhpc3RzKGEsIGIsIGFSb3csIGJSb3csIGNvbHVtbiwgZGlyLCBwYXJhbXMpIHtcblx0XHRcdHZhciBlbDEgPSB0eXBlb2YgYSA9PSBcInVuZGVmaW5lZFwiID8gMCA6IDE7XG5cdFx0XHR2YXIgZWwyID0gdHlwZW9mIGIgPT0gXCJ1bmRlZmluZWRcIiA/IDAgOiAxO1xuXG5cdFx0XHRyZXR1cm4gZWwxIC0gZWwyO1xuXHRcdH0sXG5cblx0XHQvL3NvcnQgYWxwaGEgbnVtZXJpYyBzdHJpbmdzXG5cdFx0YWxwaGFudW06IGZ1bmN0aW9uIGFscGhhbnVtKGFzLCBicywgYVJvdywgYlJvdywgY29sdW1uLCBkaXIsIHBhcmFtcykge1xuXHRcdFx0dmFyIGEsXG5cdFx0XHQgICAgYixcblx0XHRcdCAgICBhMSxcblx0XHRcdCAgICBiMSxcblx0XHRcdCAgICBpID0gMCxcblx0XHRcdCAgICBMLFxuXHRcdFx0ICAgIHJ4ID0gLyhcXGQrKXwoXFxEKykvZyxcblx0XHRcdCAgICByZCA9IC9cXGQvO1xuXHRcdFx0dmFyIGFsaWduRW1wdHlWYWx1ZXMgPSBwYXJhbXMuYWxpZ25FbXB0eVZhbHVlcztcblx0XHRcdHZhciBlbXB0eUFsaWduID0gMDtcblxuXHRcdFx0Ly9oYW5kbGUgZW1wdHkgdmFsdWVzXG5cdFx0XHRpZiAoIWFzICYmIGFzICE9PSAwKSB7XG5cdFx0XHRcdGVtcHR5QWxpZ24gPSAhYnMgJiYgYnMgIT09IDAgPyAwIDogLTE7XG5cdFx0XHR9IGVsc2UgaWYgKCFicyAmJiBicyAhPT0gMCkge1xuXHRcdFx0XHRlbXB0eUFsaWduID0gMTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0aWYgKGlzRmluaXRlKGFzKSAmJiBpc0Zpbml0ZShicykpIHJldHVybiBhcyAtIGJzO1xuXHRcdFx0XHRhID0gU3RyaW5nKGFzKS50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRiID0gU3RyaW5nKGJzKS50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRpZiAoYSA9PT0gYikgcmV0dXJuIDA7XG5cdFx0XHRcdGlmICghKHJkLnRlc3QoYSkgJiYgcmQudGVzdChiKSkpIHJldHVybiBhID4gYiA/IDEgOiAtMTtcblx0XHRcdFx0YSA9IGEubWF0Y2gocngpO1xuXHRcdFx0XHRiID0gYi5tYXRjaChyeCk7XG5cdFx0XHRcdEwgPSBhLmxlbmd0aCA+IGIubGVuZ3RoID8gYi5sZW5ndGggOiBhLmxlbmd0aDtcblx0XHRcdFx0d2hpbGUgKGkgPCBMKSB7XG5cdFx0XHRcdFx0YTEgPSBhW2ldO1xuXHRcdFx0XHRcdGIxID0gYltpKytdO1xuXHRcdFx0XHRcdGlmIChhMSAhPT0gYjEpIHtcblx0XHRcdFx0XHRcdGlmIChpc0Zpbml0ZShhMSkgJiYgaXNGaW5pdGUoYjEpKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChhMS5jaGFyQXQoMCkgPT09IFwiMFwiKSBhMSA9IFwiLlwiICsgYTE7XG5cdFx0XHRcdFx0XHRcdGlmIChiMS5jaGFyQXQoMCkgPT09IFwiMFwiKSBiMSA9IFwiLlwiICsgYjE7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBhMSAtIGIxO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHJldHVybiBhMSA+IGIxID8gMSA6IC0xO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBhLmxlbmd0aCA+IGIubGVuZ3RoO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2ZpeCBlbXB0eSB2YWx1ZXMgaW4gcG9zaXRpb25cblx0XHRcdGlmIChhbGlnbkVtcHR5VmFsdWVzID09PSBcInRvcFwiICYmIGRpciA9PT0gXCJkZXNjXCIgfHwgYWxpZ25FbXB0eVZhbHVlcyA9PT0gXCJib3R0b21cIiAmJiBkaXIgPT09IFwiYXNjXCIpIHtcblx0XHRcdFx0ZW1wdHlBbGlnbiAqPSAtMTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGVtcHR5QWxpZ247XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJzb3J0XCIsIFNvcnQpO1xuXG5cdHZhciBWYWxpZGF0ZSA9IGZ1bmN0aW9uIFZhbGlkYXRlKHRhYmxlKSB7XG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlO1xuXHRcdHRoaXMuaW52YWxpZENlbGxzID0gW107XG5cdH07XG5cblx0Ly92YWxpZGF0ZVxuXHRWYWxpZGF0ZS5wcm90b3R5cGUuaW5pdGlhbGl6ZUNvbHVtbiA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGNvbmZpZyA9IFtdLFxuXHRcdCAgICB2YWxpZGF0b3I7XG5cblx0XHRpZiAoY29sdW1uLmRlZmluaXRpb24udmFsaWRhdG9yKSB7XG5cblx0XHRcdGlmIChBcnJheS5pc0FycmF5KGNvbHVtbi5kZWZpbml0aW9uLnZhbGlkYXRvcikpIHtcblx0XHRcdFx0Y29sdW1uLmRlZmluaXRpb24udmFsaWRhdG9yLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdFx0XHR2YWxpZGF0b3IgPSBzZWxmLl9leHRyYWN0VmFsaWRhdG9yKGl0ZW0pO1xuXG5cdFx0XHRcdFx0aWYgKHZhbGlkYXRvcikge1xuXHRcdFx0XHRcdFx0Y29uZmlnLnB1c2godmFsaWRhdG9yKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dmFsaWRhdG9yID0gdGhpcy5fZXh0cmFjdFZhbGlkYXRvcihjb2x1bW4uZGVmaW5pdGlvbi52YWxpZGF0b3IpO1xuXG5cdFx0XHRcdGlmICh2YWxpZGF0b3IpIHtcblx0XHRcdFx0XHRjb25maWcucHVzaCh2YWxpZGF0b3IpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGNvbHVtbi5tb2R1bGVzLnZhbGlkYXRlID0gY29uZmlnLmxlbmd0aCA/IGNvbmZpZyA6IGZhbHNlO1xuXHRcdH1cblx0fTtcblxuXHRWYWxpZGF0ZS5wcm90b3R5cGUuX2V4dHJhY3RWYWxpZGF0b3IgPSBmdW5jdGlvbiAodmFsdWUpIHtcblx0XHR2YXIgdHlwZSwgcGFyYW1zLCBwb3M7XG5cblx0XHRzd2l0Y2ggKHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YodmFsdWUpKSB7XG5cdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdHBvcyA9IHZhbHVlLmluZGV4T2YoJzonKTtcblxuXHRcdFx0XHRpZiAocG9zID4gLTEpIHtcblx0XHRcdFx0XHR0eXBlID0gdmFsdWUuc3Vic3RyaW5nKDAsIHBvcyk7XG5cdFx0XHRcdFx0cGFyYW1zID0gdmFsdWUuc3Vic3RyaW5nKHBvcyArIDEpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHR5cGUgPSB2YWx1ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiB0aGlzLl9idWlsZFZhbGlkYXRvcih0eXBlLCBwYXJhbXMpO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcImZ1bmN0aW9uXCI6XG5cdFx0XHRcdHJldHVybiB0aGlzLl9idWlsZFZhbGlkYXRvcih2YWx1ZSk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwib2JqZWN0XCI6XG5cdFx0XHRcdHJldHVybiB0aGlzLl9idWlsZFZhbGlkYXRvcih2YWx1ZS50eXBlLCB2YWx1ZS5wYXJhbWV0ZXJzKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9O1xuXG5cdFZhbGlkYXRlLnByb3RvdHlwZS5fYnVpbGRWYWxpZGF0b3IgPSBmdW5jdGlvbiAodHlwZSwgcGFyYW1zKSB7XG5cblx0XHR2YXIgZnVuYyA9IHR5cGVvZiB0eXBlID09IFwiZnVuY3Rpb25cIiA/IHR5cGUgOiB0aGlzLnZhbGlkYXRvcnNbdHlwZV07XG5cblx0XHRpZiAoIWZ1bmMpIHtcblx0XHRcdGNvbnNvbGUud2FybihcIlZhbGlkYXRvciBTZXR1cCBFcnJvciAtIE5vIG1hdGNoaW5nIHZhbGlkYXRvciBmb3VuZDpcIiwgdHlwZSk7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdHR5cGU6IHR5cGVvZiB0eXBlID09IFwiZnVuY3Rpb25cIiA/IFwiZnVuY3Rpb25cIiA6IHR5cGUsXG5cdFx0XHRcdGZ1bmM6IGZ1bmMsXG5cdFx0XHRcdHBhcmFtczogcGFyYW1zXG5cdFx0XHR9O1xuXHRcdH1cblx0fTtcblxuXHRWYWxpZGF0ZS5wcm90b3R5cGUudmFsaWRhdGUgPSBmdW5jdGlvbiAodmFsaWRhdG9ycywgY2VsbCwgdmFsdWUpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHZhbGlkID0gW10sXG5cdFx0ICAgIGludmFsaWRJbmRleCA9IHRoaXMuaW52YWxpZENlbGxzLmluZGV4T2YoY2VsbCk7XG5cblx0XHRpZiAodmFsaWRhdG9ycykge1xuXHRcdFx0dmFsaWRhdG9ycy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRcdGlmICghaXRlbS5mdW5jLmNhbGwoc2VsZiwgY2VsbC5nZXRDb21wb25lbnQoKSwgdmFsdWUsIGl0ZW0ucGFyYW1zKSkge1xuXHRcdFx0XHRcdHZhbGlkLnB1c2goe1xuXHRcdFx0XHRcdFx0dHlwZTogaXRlbS50eXBlLFxuXHRcdFx0XHRcdFx0cGFyYW1ldGVyczogaXRlbS5wYXJhbXNcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0dmFsaWQgPSB2YWxpZC5sZW5ndGggPyB2YWxpZCA6IHRydWU7XG5cblx0XHRpZiAoIWNlbGwubW9kdWxlcy52YWxpZGF0ZSkge1xuXHRcdFx0Y2VsbC5tb2R1bGVzLnZhbGlkYXRlID0ge307XG5cdFx0fVxuXG5cdFx0aWYgKHZhbGlkID09PSB0cnVlKSB7XG5cdFx0XHRjZWxsLm1vZHVsZXMudmFsaWRhdGUuaW52YWxpZCA9IGZhbHNlO1xuXHRcdFx0Y2VsbC5nZXRFbGVtZW50KCkuY2xhc3NMaXN0LnJlbW92ZShcInRhYnVsYXRvci12YWxpZGF0aW9uLWZhaWxcIik7XG5cblx0XHRcdGlmIChpbnZhbGlkSW5kZXggPiAtMSkge1xuXHRcdFx0XHR0aGlzLmludmFsaWRDZWxscy5zcGxpY2UoaW52YWxpZEluZGV4LCAxKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Y2VsbC5tb2R1bGVzLnZhbGlkYXRlLmludmFsaWQgPSB0cnVlO1xuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnZhbGlkYXRpb25Nb2RlICE9PSBcIm1hbnVhbFwiKSB7XG5cdFx0XHRcdGNlbGwuZ2V0RWxlbWVudCgpLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItdmFsaWRhdGlvbi1mYWlsXCIpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoaW52YWxpZEluZGV4ID09IC0xKSB7XG5cdFx0XHRcdHRoaXMuaW52YWxpZENlbGxzLnB1c2goY2VsbCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHZhbGlkO1xuXHR9O1xuXG5cdFZhbGlkYXRlLnByb3RvdHlwZS5nZXRJbnZhbGlkQ2VsbHMgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIG91dHB1dCA9IFtdO1xuXG5cdFx0dGhpcy5pbnZhbGlkQ2VsbHMuZm9yRWFjaChmdW5jdGlvbiAoY2VsbCkge1xuXHRcdFx0b3V0cHV0LnB1c2goY2VsbC5nZXRDb21wb25lbnQoKSk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9O1xuXG5cdFZhbGlkYXRlLnByb3RvdHlwZS5jbGVhclZhbGlkYXRpb24gPSBmdW5jdGlvbiAoY2VsbCkge1xuXHRcdHZhciBpbnZhbGlkSW5kZXg7XG5cblx0XHRpZiAoY2VsbC5tb2R1bGVzLnZhbGlkYXRlICYmIGNlbGwubW9kdWxlcy52YWxpZGF0ZS5pbnZhbGlkKSB7XG5cblx0XHRcdGNlbGwuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLXZhbGlkYXRpb24tZmFpbFwiKTtcblx0XHRcdGNlbGwubW9kdWxlcy52YWxpZGF0ZS5pbnZhbGlkID0gZmFsc2U7XG5cblx0XHRcdGludmFsaWRJbmRleCA9IHRoaXMuaW52YWxpZENlbGxzLmluZGV4T2YoY2VsbCk7XG5cblx0XHRcdGlmIChpbnZhbGlkSW5kZXggPiAtMSkge1xuXHRcdFx0XHR0aGlzLmludmFsaWRDZWxscy5zcGxpY2UoaW52YWxpZEluZGV4LCAxKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0VmFsaWRhdGUucHJvdG90eXBlLnZhbGlkYXRvcnMgPSB7XG5cblx0XHQvL2lzIGludGVnZXJcblx0XHRpbnRlZ2VyOiBmdW5jdGlvbiBpbnRlZ2VyKGNlbGwsIHZhbHVlLCBwYXJhbWV0ZXJzKSB7XG5cdFx0XHRpZiAodmFsdWUgPT09IFwiXCIgfHwgdmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIHZhbHVlID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0dmFsdWUgPSBOdW1iZXIodmFsdWUpO1xuXHRcdFx0cmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgJiYgaXNGaW5pdGUodmFsdWUpICYmIE1hdGguZmxvb3IodmFsdWUpID09PSB2YWx1ZTtcblx0XHR9LFxuXG5cdFx0Ly9pcyBmbG9hdFxuXHRcdGZsb2F0OiBmdW5jdGlvbiBmbG9hdChjZWxsLCB2YWx1ZSwgcGFyYW1ldGVycykge1xuXHRcdFx0aWYgKHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdHZhbHVlID0gTnVtYmVyKHZhbHVlKTtcblx0XHRcdHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInICYmIGlzRmluaXRlKHZhbHVlKSAmJiB2YWx1ZSAlIDEgIT09IDA7XG5cdFx0fSxcblxuXHRcdC8vbXVzdCBiZSBhIG51bWJlclxuXHRcdG51bWVyaWM6IGZ1bmN0aW9uIG51bWVyaWMoY2VsbCwgdmFsdWUsIHBhcmFtZXRlcnMpIHtcblx0XHRcdGlmICh2YWx1ZSA9PT0gXCJcIiB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gIWlzTmFOKHZhbHVlKTtcblx0XHR9LFxuXG5cdFx0Ly9tdXN0IGJlIGEgc3RyaW5nXG5cdFx0c3RyaW5nOiBmdW5jdGlvbiBzdHJpbmcoY2VsbCwgdmFsdWUsIHBhcmFtZXRlcnMpIHtcblx0XHRcdGlmICh2YWx1ZSA9PT0gXCJcIiB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gaXNOYU4odmFsdWUpO1xuXHRcdH0sXG5cblx0XHQvL21heGltdW0gdmFsdWVcblx0XHRtYXg6IGZ1bmN0aW9uIG1heChjZWxsLCB2YWx1ZSwgcGFyYW1ldGVycykge1xuXHRcdFx0aWYgKHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdHJldHVybiBwYXJzZUZsb2F0KHZhbHVlKSA8PSBwYXJhbWV0ZXJzO1xuXHRcdH0sXG5cblx0XHQvL21pbmltdW0gdmFsdWVcblx0XHRtaW46IGZ1bmN0aW9uIG1pbihjZWxsLCB2YWx1ZSwgcGFyYW1ldGVycykge1xuXHRcdFx0aWYgKHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdHJldHVybiBwYXJzZUZsb2F0KHZhbHVlKSA+PSBwYXJhbWV0ZXJzO1xuXHRcdH0sXG5cblx0XHQvL3N0YXJ0cyB3aXRoICB2YWx1ZVxuXHRcdHN0YXJ0czogZnVuY3Rpb24gc3RhcnRzKGNlbGwsIHZhbHVlLCBwYXJhbWV0ZXJzKSB7XG5cdFx0XHRpZiAodmFsdWUgPT09IFwiXCIgfHwgdmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIHZhbHVlID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIFN0cmluZyh2YWx1ZSkudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKFN0cmluZyhwYXJhbWV0ZXJzKS50b0xvd2VyQ2FzZSgpKTtcblx0XHR9LFxuXG5cdFx0Ly9lbmRzIHdpdGggIHZhbHVlXG5cdFx0ZW5kczogZnVuY3Rpb24gZW5kcyhjZWxsLCB2YWx1ZSwgcGFyYW1ldGVycykge1xuXHRcdFx0aWYgKHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdHJldHVybiBTdHJpbmcodmFsdWUpLnRvTG93ZXJDYXNlKCkuZW5kc1dpdGgoU3RyaW5nKHBhcmFtZXRlcnMpLnRvTG93ZXJDYXNlKCkpO1xuXHRcdH0sXG5cblx0XHQvL21pbmltdW0gc3RyaW5nIGxlbmd0aFxuXHRcdG1pbkxlbmd0aDogZnVuY3Rpb24gbWluTGVuZ3RoKGNlbGwsIHZhbHVlLCBwYXJhbWV0ZXJzKSB7XG5cdFx0XHRpZiAodmFsdWUgPT09IFwiXCIgfHwgdmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIHZhbHVlID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIFN0cmluZyh2YWx1ZSkubGVuZ3RoID49IHBhcmFtZXRlcnM7XG5cdFx0fSxcblxuXHRcdC8vbWF4aW11bSBzdHJpbmcgbGVuZ3RoXG5cdFx0bWF4TGVuZ3RoOiBmdW5jdGlvbiBtYXhMZW5ndGgoY2VsbCwgdmFsdWUsIHBhcmFtZXRlcnMpIHtcblx0XHRcdGlmICh2YWx1ZSA9PT0gXCJcIiB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gU3RyaW5nKHZhbHVlKS5sZW5ndGggPD0gcGFyYW1ldGVycztcblx0XHR9LFxuXG5cdFx0Ly9pbiBwcm92aWRlZCB2YWx1ZSBsaXN0XG5cdFx0aW46IGZ1bmN0aW9uIF9pbihjZWxsLCB2YWx1ZSwgcGFyYW1ldGVycykge1xuXHRcdFx0aWYgKHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdGlmICh0eXBlb2YgcGFyYW1ldGVycyA9PSBcInN0cmluZ1wiKSB7XG5cdFx0XHRcdHBhcmFtZXRlcnMgPSBwYXJhbWV0ZXJzLnNwbGl0KFwifFwiKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHZhbHVlID09PSBcIlwiIHx8IHBhcmFtZXRlcnMuaW5kZXhPZih2YWx1ZSkgPiAtMTtcblx0XHR9LFxuXG5cdFx0Ly9tdXN0IG1hdGNoIHByb3ZpZGVkIHJlZ2V4XG5cdFx0cmVnZXg6IGZ1bmN0aW9uIHJlZ2V4KGNlbGwsIHZhbHVlLCBwYXJhbWV0ZXJzKSB7XG5cdFx0XHRpZiAodmFsdWUgPT09IFwiXCIgfHwgdmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIHZhbHVlID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0dmFyIHJlZyA9IG5ldyBSZWdFeHAocGFyYW1ldGVycyk7XG5cblx0XHRcdHJldHVybiByZWcudGVzdCh2YWx1ZSk7XG5cdFx0fSxcblxuXHRcdC8vdmFsdWUgbXVzdCBiZSB1bmlxdWUgaW4gdGhpcyBjb2x1bW5cblx0XHR1bmlxdWU6IGZ1bmN0aW9uIHVuaXF1ZShjZWxsLCB2YWx1ZSwgcGFyYW1ldGVycykge1xuXHRcdFx0aWYgKHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdHZhciB1bmlxdWUgPSB0cnVlO1xuXG5cdFx0XHR2YXIgY2VsbERhdGEgPSBjZWxsLmdldERhdGEoKTtcblx0XHRcdHZhciBjb2x1bW4gPSBjZWxsLmdldENvbHVtbigpLl9nZXRTZWxmKCk7XG5cblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5yb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0XHR2YXIgZGF0YSA9IHJvdy5nZXREYXRhKCk7XG5cblx0XHRcdFx0aWYgKGRhdGEgIT09IGNlbGxEYXRhKSB7XG5cdFx0XHRcdFx0aWYgKHZhbHVlID09IGNvbHVtbi5nZXRGaWVsZFZhbHVlKGRhdGEpKSB7XG5cdFx0XHRcdFx0XHR1bmlxdWUgPSBmYWxzZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gdW5pcXVlO1xuXHRcdH0sXG5cblx0XHQvL211c3QgaGF2ZSBhIHZhbHVlXG5cdFx0cmVxdWlyZWQ6IGZ1bmN0aW9uIHJlcXVpcmVkKGNlbGwsIHZhbHVlLCBwYXJhbWV0ZXJzKSB7XG5cdFx0XHRyZXR1cm4gdmFsdWUgIT09IFwiXCIgJiYgdmFsdWUgIT09IG51bGwgJiYgdHlwZW9mIHZhbHVlICE9PSBcInVuZGVmaW5lZFwiO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnJlZ2lzdGVyTW9kdWxlKFwidmFsaWRhdGVcIiwgVmFsaWRhdGUpO1xuXG5cdHJldHVybiBUYWJ1bGF0b3I7XG59KTsiLCJpbXBvcnQgUmVhY3QsIHtDb21wb25lbnR9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgVGFidWxhdG9yIGZyb20gXCJ0YWJ1bGF0b3ItdGFibGVzXCI7IC8vaW1wb3J0IFRhYnVsYXRvciBsaWJyYXJ5XG5pbXBvcnQgXCJ0YWJ1bGF0b3ItdGFibGVzL2Rpc3QvY3NzL3RhYnVsYXRvci5taW4uY3NzXCI7IC8vaW1wb3J0IFRhYnVsYXRvciBzdHlsZXNoZWV0XG5cbi8qKlxuICogRXhhbXBsZUNvbXBvbmVudCBpcyBhbiBleGFtcGxlIGNvbXBvbmVudC5cbiAqIEl0IHRha2VzIGEgcHJvcGVydHksIGBsYWJlbGAsIGFuZFxuICogZGlzcGxheXMgaXQuXG4gKiBJdCByZW5kZXJzIGFuIGlucHV0IHdpdGggdGhlIHByb3BlcnR5IGB2YWx1ZWBcbiAqIHdoaWNoIGlzIGVkaXRhYmxlIGJ5IHRoZSB1c2VyLlxuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBEYXNoVGFidWxhdG9yIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHtpZCwgbGFiZWwsIHNldFByb3BzLCB2YWx1ZX0gPSB0aGlzLnByb3BzO1xuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8ZGl2IGlkPXtpZH0+XG4gICAgICAgICAgICAgICAgRXhhbXBsZUNvbXBvbmVudDoge2xhYmVsfSZuYnNwO1xuICAgICAgICAgICAgICAgIDxpbnB1dFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dmFsdWV9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiBTZW5kIHRoZSBuZXcgdmFsdWUgdG8gdGhlIHBhcmVudCBjb21wb25lbnQuXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiBzZXRQcm9wcyBpcyBhIHByb3AgdGhhdCBpcyBhdXRvbWF0aWNhbGx5IHN1cHBsaWVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiBieSBkYXNoJ3MgZnJvbnQtZW5kIChcImRhc2gtcmVuZGVyZXJcIikuXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiBJbiBhIERhc2ggYXBwLCB0aGlzIHdpbGwgdXBkYXRlIHRoZSBjb21wb25lbnQnc1xuICAgICAgICAgICAgICAgICAgICAgICAgICogcHJvcHMgYW5kIHNlbmQgdGhlIGRhdGEgYmFjayB0byB0aGUgUHl0aG9uIERhc2hcbiAgICAgICAgICAgICAgICAgICAgICAgICAqIGFwcCBzZXJ2ZXIgaWYgYSBjYWxsYmFjayB1c2VzIHRoZSBtb2RpZmllZCBwcm9wIGFzXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiBJbnB1dCBvciBTdGF0ZS5cbiAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgZSA9PiBzZXRQcm9wcyh7IHZhbHVlOiBlLnRhcmdldC52YWx1ZSB9KVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cbn1cblxuRGFzaFRhYnVsYXRvci5kZWZhdWx0UHJvcHMgPSB7fTtcblxuRGFzaFRhYnVsYXRvci5wcm9wVHlwZXMgPSB7XG4gICAgLyoqXG4gICAgICogVGhlIElEIHVzZWQgdG8gaWRlbnRpZnkgdGhpcyBjb21wb25lbnQgaW4gRGFzaCBjYWxsYmFja3MuXG4gICAgICovXG4gICAgaWQ6IFByb3BUeXBlcy5zdHJpbmcsXG5cbiAgICAvKipcbiAgICAgKiBBIGxhYmVsIHRoYXQgd2lsbCBiZSBwcmludGVkIHdoZW4gdGhpcyBjb21wb25lbnQgaXMgcmVuZGVyZWQuXG4gICAgICovXG4gICAgbGFiZWw6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcblxuICAgIC8qKlxuICAgICAqIFRoZSB2YWx1ZSBkaXNwbGF5ZWQgaW4gdGhlIGlucHV0LlxuICAgICAqL1xuICAgIHZhbHVlOiBQcm9wVHlwZXMuc3RyaW5nLFxuXG4gICAgLyoqXG4gICAgICogRGFzaC1hc3NpZ25lZCBjYWxsYmFjayB0aGF0IHNob3VsZCBiZSBjYWxsZWQgdG8gcmVwb3J0IHByb3BlcnR5IGNoYW5nZXNcbiAgICAgKiB0byBEYXNoLCB0byBtYWtlIHRoZW0gYXZhaWxhYmxlIGZvciBjYWxsYmFja3MuXG4gICAgICovXG4gICAgc2V0UHJvcHM6IFByb3BUeXBlcy5mdW5jXG59O1xuIl0sInNvdXJjZVJvb3QiOiIifQ==